"use strict";(self.webpackChunkangular=self.webpackChunkangular||[]).push([[179],{12:()=>{function Lt(t){return"function"==typeof t}function bl(t){const i=t(r=>{Error.call(r),r.stack=(new Error).stack});return i.prototype=Object.create(Error.prototype),i.prototype.constructor=i,i}const Sl=bl(t=>function(i){t(this),this.message=i?`${i.length} errors occurred during unsubscription:\n${i.map((r,o)=>`${o+1}) ${r.toString()}`).join("\n  ")}`:"",this.name="UnsubscriptionError",this.errors=i});function Vs(t,n){if(t){const i=t.indexOf(n);0<=i&&t.splice(i,1)}}class di{constructor(n){this.initialTeardown=n,this.closed=!1,this._parentage=null,this._finalizers=null}unsubscribe(){let n;if(!this.closed){this.closed=!0;const{_parentage:i}=this;if(i)if(this._parentage=null,Array.isArray(i))for(const s of i)s.remove(this);else i.remove(this);const{initialTeardown:r}=this;if(Lt(r))try{r()}catch(s){n=s instanceof Sl?s.errors:[s]}const{_finalizers:o}=this;if(o){this._finalizers=null;for(const s of o)try{Xp(s)}catch(l){n=n??[],l instanceof Sl?n=[...n,...l.errors]:n.push(l)}}if(n)throw new Sl(n)}}add(n){var i;if(n&&n!==this)if(this.closed)Xp(n);else{if(n instanceof di){if(n.closed||n._hasParent(this))return;n._addParent(this)}(this._finalizers=null!==(i=this._finalizers)&&void 0!==i?i:[]).push(n)}}_hasParent(n){const{_parentage:i}=this;return i===n||Array.isArray(i)&&i.includes(n)}_addParent(n){const{_parentage:i}=this;this._parentage=Array.isArray(i)?(i.push(n),i):i?[i,n]:n}_removeParent(n){const{_parentage:i}=this;i===n?this._parentage=null:Array.isArray(i)&&Vs(i,n)}remove(n){const{_finalizers:i}=this;i&&Vs(i,n),n instanceof di&&n._removeParent(this)}}di.EMPTY=(()=>{const t=new di;return t.closed=!0,t})();const zp=di.EMPTY;function $p(t){return t instanceof di||t&&"closed"in t&&Lt(t.remove)&&Lt(t.add)&&Lt(t.unsubscribe)}function Xp(t){Lt(t)?t():t.unsubscribe()}const Pr={onUnhandledError:null,onStoppedNotification:null,Promise:void 0,useDeprecatedSynchronousErrorHandling:!1,useDeprecatedNextContext:!1},Tl={setTimeout(t,n,...i){const{delegate:r}=Tl;return r?.setTimeout?r.setTimeout(t,n,...i):setTimeout(t,n,...i)},clearTimeout(t){const{delegate:n}=Tl;return(n?.clearTimeout||clearTimeout)(t)},delegate:void 0};function qp(t){Tl.setTimeout(()=>{const{onUnhandledError:n}=Pr;if(!n)throw t;n(t)})}function Zp(){}const fD=ud("C",void 0,void 0);function ud(t,n,i){return{kind:t,value:n,error:i}}let Nr=null;function xl(t){if(Pr.useDeprecatedSynchronousErrorHandling){const n=!Nr;if(n&&(Nr={errorThrown:!1,error:null}),t(),n){const{errorThrown:i,error:r}=Nr;if(Nr=null,i)throw r}}else t()}class dd extends di{constructor(n){super(),this.isStopped=!1,n?(this.destination=n,$p(n)&&n.add(this)):this.destination=wD}static create(n,i,r){return new Us(n,i,r)}next(n){this.isStopped?fd(function pD(t){return ud("N",t,void 0)}(n),this):this._next(n)}error(n){this.isStopped?fd(function gD(t){return ud("E",void 0,t)}(n),this):(this.isStopped=!0,this._error(n))}complete(){this.isStopped?fd(fD,this):(this.isStopped=!0,this._complete())}unsubscribe(){this.closed||(this.isStopped=!0,super.unsubscribe(),this.destination=null)}_next(n){this.destination.next(n)}_error(n){try{this.destination.error(n)}finally{this.unsubscribe()}}_complete(){try{this.destination.complete()}finally{this.unsubscribe()}}}const _D=Function.prototype.bind;function hd(t,n){return _D.call(t,n)}class vD{constructor(n){this.partialObserver=n}next(n){const{partialObserver:i}=this;if(i.next)try{i.next(n)}catch(r){Al(r)}}error(n){const{partialObserver:i}=this;if(i.error)try{i.error(n)}catch(r){Al(r)}else Al(n)}complete(){const{partialObserver:n}=this;if(n.complete)try{n.complete()}catch(i){Al(i)}}}class Us extends dd{constructor(n,i,r){let o;if(super(),Lt(n)||!n)o={next:n??void 0,error:i??void 0,complete:r??void 0};else{let s;this&&Pr.useDeprecatedNextContext?(s=Object.create(n),s.unsubscribe=()=>this.unsubscribe(),o={next:n.next&&hd(n.next,s),error:n.error&&hd(n.error,s),complete:n.complete&&hd(n.complete,s)}):o=n}this.destination=new vD(o)}}function Al(t){Pr.useDeprecatedSynchronousErrorHandling?function mD(t){Pr.useDeprecatedSynchronousErrorHandling&&Nr&&(Nr.errorThrown=!0,Nr.error=t)}(t):qp(t)}function fd(t,n){const{onStoppedNotification:i}=Pr;i&&Tl.setTimeout(()=>i(t,n))}const wD={closed:!0,next:Zp,error:function yD(t){throw t},complete:Zp},gd="function"==typeof Symbol&&Symbol.observable||"@@observable";function pd(t){return t}let mn=(()=>{class t{constructor(i){i&&(this._subscribe=i)}lift(i){const r=new t;return r.source=this,r.operator=i,r}subscribe(i,r,o){const s=function ED(t){return t&&t instanceof dd||function CD(t){return t&&Lt(t.next)&&Lt(t.error)&&Lt(t.complete)}(t)&&$p(t)}(i)?i:new Us(i,r,o);return xl(()=>{const{operator:l,source:h}=this;s.add(l?l.call(s,h):h?this._subscribe(s):this._trySubscribe(s))}),s}_trySubscribe(i){try{return this._subscribe(i)}catch(r){i.error(r)}}forEach(i,r){return new(r=Qp(r))((o,s)=>{const l=new Us({next:h=>{try{i(h)}catch(p){s(p),l.unsubscribe()}},error:s,complete:o});this.subscribe(l)})}_subscribe(i){var r;return null===(r=this.source)||void 0===r?void 0:r.subscribe(i)}[gd](){return this}pipe(...i){return function Kp(t){return 0===t.length?pd:1===t.length?t[0]:function(i){return t.reduce((r,o)=>o(r),i)}}(i)(this)}toPromise(i){return new(i=Qp(i))((r,o)=>{let s;this.subscribe(l=>s=l,l=>o(l),()=>r(s))})}}return t.create=n=>new t(n),t})();function Qp(t){var n;return null!==(n=t??Pr.Promise)&&void 0!==n?n:Promise}const ID=bl(t=>function(){t(this),this.name="ObjectUnsubscribedError",this.message="object unsubscribed"});let Ol=(()=>{class t extends mn{constructor(){super(),this.closed=!1,this.currentObservers=null,this.observers=[],this.isStopped=!1,this.hasError=!1,this.thrownError=null}lift(i){const r=new Jp(this,this);return r.operator=i,r}_throwIfClosed(){if(this.closed)throw new ID}next(i){xl(()=>{if(this._throwIfClosed(),!this.isStopped){this.currentObservers||(this.currentObservers=Array.from(this.observers));for(const r of this.currentObservers)r.next(i)}})}error(i){xl(()=>{if(this._throwIfClosed(),!this.isStopped){this.hasError=this.isStopped=!0,this.thrownError=i;const{observers:r}=this;for(;r.length;)r.shift().error(i)}})}complete(){xl(()=>{if(this._throwIfClosed(),!this.isStopped){this.isStopped=!0;const{observers:i}=this;for(;i.length;)i.shift().complete()}})}unsubscribe(){this.isStopped=this.closed=!0,this.observers=this.currentObservers=null}get observed(){var i;return(null===(i=this.observers)||void 0===i?void 0:i.length)>0}_trySubscribe(i){return this._throwIfClosed(),super._trySubscribe(i)}_subscribe(i){return this._throwIfClosed(),this._checkFinalizedStatuses(i),this._innerSubscribe(i)}_innerSubscribe(i){const{hasError:r,isStopped:o,observers:s}=this;return r||o?zp:(this.currentObservers=null,s.push(i),new di(()=>{this.currentObservers=null,Vs(s,i)}))}_checkFinalizedStatuses(i){const{hasError:r,thrownError:o,isStopped:s}=this;r?i.error(o):s&&i.complete()}asObservable(){const i=new mn;return i.source=this,i}}return t.create=(n,i)=>new Jp(n,i),t})();class Jp extends Ol{constructor(n,i){super(),this.destination=n,this.source=i}next(n){var i,r;null===(r=null===(i=this.destination)||void 0===i?void 0:i.next)||void 0===r||r.call(i,n)}error(n){var i,r;null===(r=null===(i=this.destination)||void 0===i?void 0:i.error)||void 0===r||r.call(i,n)}complete(){var n,i;null===(i=null===(n=this.destination)||void 0===n?void 0:n.complete)||void 0===i||i.call(n)}_subscribe(n){var i,r;return null!==(r=null===(i=this.source)||void 0===i?void 0:i.subscribe(n))&&void 0!==r?r:zp}}function kr(t){return n=>{if(function DD(t){return Lt(t?.lift)}(n))return n.lift(function(i){try{return t(i,this)}catch(r){this.error(r)}});throw new TypeError("Unable to lift unknown Observable type")}}function Br(t,n,i,r,o){return new bD(t,n,i,r,o)}class bD extends dd{constructor(n,i,r,o,s,l){super(n),this.onFinalize=s,this.shouldUnsubscribe=l,this._next=i?function(h){try{i(h)}catch(p){n.error(p)}}:super._next,this._error=o?function(h){try{o(h)}catch(p){n.error(p)}finally{this.unsubscribe()}}:super._error,this._complete=r?function(){try{r()}catch(h){n.error(h)}finally{this.unsubscribe()}}:super._complete}unsubscribe(){var n;if(!this.shouldUnsubscribe||this.shouldUnsubscribe()){const{closed:i}=this;super.unsubscribe(),!i&&(null===(n=this.onFinalize)||void 0===n||n.call(this))}}}function lr(t){return this instanceof lr?(this.v=t,this):new lr(t)}function im(t){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var i,n=t[Symbol.asyncIterator];return n?n.call(t):(t=function yd(t){var n="function"==typeof Symbol&&Symbol.iterator,i=n&&t[n],r=0;if(i)return i.call(t);if(t&&"number"==typeof t.length)return{next:function(){return t&&r>=t.length&&(t=void 0),{value:t&&t[r++],done:!t}}};throw new TypeError(n?"Object is not iterable.":"Symbol.iterator is not defined.")}(t),i={},r("next"),r("throw"),r("return"),i[Symbol.asyncIterator]=function(){return this},i);function r(s){i[s]=t[s]&&function(l){return new Promise(function(h,p){!function o(s,l,h,p){Promise.resolve(p).then(function(C){s({value:C,done:h})},l)}(h,p,(l=t[s](l)).done,l.value)})}}}"function"==typeof SuppressedError&&SuppressedError;const rm=t=>t&&"number"==typeof t.length&&"function"!=typeof t;function om(t){return Lt(t?.then)}function sm(t){return Lt(t[gd])}function am(t){return Symbol.asyncIterator&&Lt(t?.[Symbol.asyncIterator])}function lm(t){return new TypeError(`You provided ${null!==t&&"object"==typeof t?"an invalid object":`'${t}'`} where a stream was expected. You can provide an Observable, Promise, ReadableStream, Array, AsyncIterable, or Iterable.`)}const cm=function XD(){return"function"==typeof Symbol&&Symbol.iterator?Symbol.iterator:"@@iterator"}();function um(t){return Lt(t?.[cm])}function dm(t){return function nm(t,n,i){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var o,r=i.apply(t,n||[]),s=[];return o={},l("next"),l("throw"),l("return"),o[Symbol.asyncIterator]=function(){return this},o;function l(A){r[A]&&(o[A]=function(M){return new Promise(function(P,B){s.push([A,M,P,B])>1||h(A,M)})})}function h(A,M){try{!function p(A){A.value instanceof lr?Promise.resolve(A.value.v).then(C,D):T(s[0][2],A)}(r[A](M))}catch(P){T(s[0][3],P)}}function C(A){h("next",A)}function D(A){h("throw",A)}function T(A,M){A(M),s.shift(),s.length&&h(s[0][0],s[0][1])}}(this,arguments,function*(){const i=t.getReader();try{for(;;){const{value:r,done:o}=yield lr(i.read());if(o)return yield lr(void 0);yield yield lr(r)}}finally{i.releaseLock()}})}function hm(t){return Lt(t?.getReader)}function Ai(t){if(t instanceof mn)return t;if(null!=t){if(sm(t))return function qD(t){return new mn(n=>{const i=t[gd]();if(Lt(i.subscribe))return i.subscribe(n);throw new TypeError("Provided object does not correctly implement Symbol.observable")})}(t);if(rm(t))return function ZD(t){return new mn(n=>{for(let i=0;i<t.length&&!n.closed;i++)n.next(t[i]);n.complete()})}(t);if(om(t))return function KD(t){return new mn(n=>{t.then(i=>{n.closed||(n.next(i),n.complete())},i=>n.error(i)).then(null,qp)})}(t);if(am(t))return fm(t);if(um(t))return function QD(t){return new mn(n=>{for(const i of t)if(n.next(i),n.closed)return;n.complete()})}(t);if(hm(t))return function JD(t){return fm(dm(t))}(t)}throw lm(t)}function fm(t){return new mn(n=>{(function eb(t,n){var i,r,o,s;return function em(t,n,i,r){return new(i||(i=Promise))(function(s,l){function h(D){try{C(r.next(D))}catch(T){l(T)}}function p(D){try{C(r.throw(D))}catch(T){l(T)}}function C(D){D.done?s(D.value):function o(s){return s instanceof i?s:new i(function(l){l(s)})}(D.value).then(h,p)}C((r=r.apply(t,n||[])).next())})}(this,void 0,void 0,function*(){try{for(i=im(t);!(r=yield i.next()).done;)if(n.next(r.value),n.closed)return}catch(l){o={error:l}}finally{try{r&&!r.done&&(s=i.return)&&(yield s.call(i))}finally{if(o)throw o.error}}n.complete()})})(t,n).catch(i=>n.error(i))})}function cr(t,n,i,r=0,o=!1){const s=n.schedule(function(){i(),o?t.add(this.schedule(null,r)):this.unsubscribe()},r);if(t.add(s),!o)return s}function gm(t,n,i=1/0){return Lt(n)?gm((r,o)=>function SD(t,n){return kr((i,r)=>{let o=0;i.subscribe(Br(r,s=>{r.next(t.call(n,s,o++))}))})}((s,l)=>n(r,s,o,l))(Ai(t(r,o))),i):("number"==typeof n&&(i=n),kr((r,o)=>function tb(t,n,i,r,o,s,l,h){const p=[];let C=0,D=0,T=!1;const A=()=>{T&&!p.length&&!C&&n.complete()},M=B=>C<r?P(B):p.push(B),P=B=>{s&&n.next(B),C++;let k=!1;Ai(i(B,D++)).subscribe(Br(n,U=>{o?.(U),s?M(U):n.next(U)},()=>{k=!0},void 0,()=>{if(k)try{for(C--;p.length&&C<r;){const U=p.shift();l?cr(n,l,()=>P(U)):P(U)}A()}catch(U){n.error(U)}}))};return t.subscribe(Br(n,M,()=>{T=!0,A()})),()=>{h?.()}}(r,o,t,i)))}const pm=new mn(t=>t.complete());function wd(t){return t[t.length-1]}function mm(t){return function rb(t){return t&&Lt(t.schedule)}(wd(t))?t.pop():void 0}function _m(t,n=0){return kr((i,r)=>{i.subscribe(Br(r,o=>cr(r,t,()=>r.next(o),n),()=>cr(r,t,()=>r.complete(),n),o=>cr(r,t,()=>r.error(o),n)))})}function vm(t,n=0){return kr((i,r)=>{r.add(t.schedule(()=>i.subscribe(r),n))})}function ym(t,n){if(!t)throw new Error("Iterable cannot be null");return new mn(i=>{cr(i,n,()=>{const r=t[Symbol.asyncIterator]();cr(i,n,()=>{r.next().then(o=>{o.done?i.complete():i.next(o.value)})},0,!0)})})}function wm(t,n){return n?function db(t,n){if(null!=t){if(sm(t))return function sb(t,n){return Ai(t).pipe(vm(n),_m(n))}(t,n);if(rm(t))return function lb(t,n){return new mn(i=>{let r=0;return n.schedule(function(){r===t.length?i.complete():(i.next(t[r++]),i.closed||this.schedule())})})}(t,n);if(om(t))return function ab(t,n){return Ai(t).pipe(vm(n),_m(n))}(t,n);if(am(t))return ym(t,n);if(um(t))return function cb(t,n){return new mn(i=>{let r;return cr(i,n,()=>{r=t[cm](),cr(i,n,()=>{let o,s;try{({value:o,done:s}=r.next())}catch(l){return void i.error(l)}s?i.complete():i.next(o)},0,!0)}),()=>Lt(r?.return)&&r.return()})}(t,n);if(hm(t))return function ub(t,n){return ym(dm(t),n)}(t,n)}throw lm(t)}(t,n):Ai(t)}function hb(...t){const n=mm(t),i=function ob(t,n){return"number"==typeof wd(t)?t.pop():n}(t,1/0),r=t;return r.length?1===r.length?Ai(r[0]):function nb(t=1/0){return gm(pd,t)}(i)(wm(r,n)):pm}class fb extends Ol{constructor(n){super(),this._value=n}get value(){return this.getValue()}_subscribe(n){const i=super._subscribe(n);return!i.closed&&n.next(this._value),i}getValue(){const{hasError:n,thrownError:i,_value:r}=this;if(n)throw i;return this._throwIfClosed(),r}next(n){super.next(this._value=n)}}function Cm(t={}){const{connector:n=(()=>new Ol),resetOnError:i=!0,resetOnComplete:r=!0,resetOnRefCountZero:o=!0}=t;return s=>{let l,h,p,C=0,D=!1,T=!1;const A=()=>{h?.unsubscribe(),h=void 0},M=()=>{A(),l=p=void 0,D=T=!1},P=()=>{const B=l;M(),B?.unsubscribe()};return kr((B,k)=>{C++,!T&&!D&&A();const U=p=p??n();k.add(()=>{C--,0===C&&!T&&!D&&(h=Cd(P,o))}),U.subscribe(k),!l&&C>0&&(l=new Us({next:V=>U.next(V),error:V=>{T=!0,A(),h=Cd(M,i,V),U.error(V)},complete:()=>{D=!0,A(),h=Cd(M,r),U.complete()}}),Ai(B).subscribe(l))})(s)}}function Cd(t,n,...i){if(!0===n)return void t();if(!1===n)return;const r=new Us({next:()=>{r.unsubscribe(),t()}});return Ai(n(...i)).subscribe(r)}function _b(t,n){return t===n}function gt(t){for(let n in t)if(t[n]===gt)return n;throw Error("Could not find renamed property on target object.")}function Yt(t){if("string"==typeof t)return t;if(Array.isArray(t))return"["+t.map(Yt).join(", ")+"]";if(null==t)return""+t;if(t.overriddenName)return`${t.overriddenName}`;if(t.name)return`${t.name}`;const n=t.toString();if(null==n)return""+n;const i=n.indexOf("\n");return-1===i?n:n.substring(0,i)}function Ed(t,n){return null==t||""===t?null===n?"":n:null==n||""===n?t:t+" "+n}const vb=gt({__forward_ref__:gt});function Id(t){return t.__forward_ref__=Id,t.toString=function(){return Yt(this())},t}function Pe(t){return function Dd(t){return"function"==typeof t&&t.hasOwnProperty(vb)&&t.__forward_ref__===Id}(t)?t():t}function bd(t){return t&&!!t.\u0275providers}class De extends Error{constructor(n,i){super(function Rl(t,n){return`NG0${Math.abs(t)}${n?": "+n:""}`}(n,i)),this.code=n}}function ht(t){return"function"==typeof t?t.name||t.toString():"object"==typeof t&&null!=t&&"function"==typeof t.type?t.type.name||t.type.toString():function ke(t){return"string"==typeof t?t:null==t?"":String(t)}(t)}function Sd(t,n){throw new De(-201,!1)}function Vn(t,n){null==t&&function Le(t,n,i,r){throw new Error(`ASSERTION ERROR: ${t}`+(null==r?"":` [Expected=> ${i} ${r} ${n} <=Actual]`))}(n,t,null,"!=")}function vt(t){return{token:t.token,providedIn:t.providedIn||null,factory:t.factory,value:void 0}}function mo(t){return{providers:t.providers||[],imports:t.imports||[]}}function Ll(t){return Im(t,Pl)||Im(t,Dm)}function Im(t,n){return t.hasOwnProperty(n)?t[n]:null}function Fl(t){return t&&(t.hasOwnProperty(Td)||t.hasOwnProperty(bb))?t[Td]:null}const Pl=gt({\u0275prov:gt}),Td=gt({\u0275inj:gt}),Dm=gt({ngInjectableDef:gt}),bb=gt({ngInjectorDef:gt});var et=function(t){return t[t.Default=0]="Default",t[t.Host=1]="Host",t[t.Self=2]="Self",t[t.SkipSelf=4]="SkipSelf",t[t.Optional=8]="Optional",t}(et||{});let xd;function _n(t){const n=xd;return xd=t,n}function Sm(t,n,i){const r=Ll(t);return r&&"root"==r.providedIn?void 0===r.value?r.value=r.factory():r.value:i&et.Optional?null:void 0!==n?n:void Sd(Yt(t))}const Ct=globalThis;class Ne{constructor(n,i){this._desc=n,this.ngMetadataName="InjectionToken",this.\u0275prov=void 0,"number"==typeof i?this.__NG_ELEMENT_ID__=i:void 0!==i&&(this.\u0275prov=vt({token:this,providedIn:i.providedIn||"root",factory:i.factory}))}get multi(){return this}toString(){return`InjectionToken ${this._desc}`}}const Gs={},Ld="__NG_DI_FLAG__",Nl="ngTempTokenPath",xb=/\n/gm,xm="__source";let _o;function ur(t){const n=_o;return _o=t,n}function Mb(t,n=et.Default){if(void 0===_o)throw new De(-203,!1);return null===_o?Sm(t,void 0,n):_o.get(t,n&et.Optional?null:void 0,n)}function it(t,n=et.Default){return(function bm(){return xd}()||Mb)(Pe(t),n)}function Et(t,n=et.Default){return it(t,kl(n))}function kl(t){return typeof t>"u"||"number"==typeof t?t:0|(t.optional&&8)|(t.host&&1)|(t.self&&2)|(t.skipSelf&&4)}function Fd(t){const n=[];for(let i=0;i<t.length;i++){const r=Pe(t[i]);if(Array.isArray(r)){if(0===r.length)throw new De(900,!1);let o,s=et.Default;for(let l=0;l<r.length;l++){const h=r[l],p=Rb(h);"number"==typeof p?-1===p?o=h.token:s|=p:o=h}n.push(it(o,s))}else n.push(it(r))}return n}function Hs(t,n){return t[Ld]=n,t.prototype[Ld]=n,t}function Rb(t){return t[Ld]}function Oi(t){return{toString:t}.toString()}var Bl=function(t){return t[t.OnPush=0]="OnPush",t[t.Default=1]="Default",t}(Bl||{}),Qn=function(t){return t[t.Emulated=0]="Emulated",t[t.None=2]="None",t[t.ShadowDom=3]="ShadowDom",t}(Qn||{});const hi={},lt=[],jl=gt({\u0275cmp:gt}),Pd=gt({\u0275dir:gt}),Nd=gt({\u0275pipe:gt}),Om=gt({\u0275mod:gt}),Mi=gt({\u0275fac:gt}),Ws=gt({__NG_ELEMENT_ID__:gt}),Mm=gt({__NG_ENV_ID__:gt});function Rm(t,n,i){let r=t.length;for(;;){const o=t.indexOf(n,i);if(-1===o)return o;if(0===o||t.charCodeAt(o-1)<=32){const s=n.length;if(o+s===r||t.charCodeAt(o+s)<=32)return o}i=o+1}}function kd(t,n,i){let r=0;for(;r<i.length;){const o=i[r];if("number"==typeof o){if(0!==o)break;r++;const s=i[r++],l=i[r++],h=i[r++];t.setAttribute(n,l,h,s)}else{const s=o,l=i[++r];Fm(s)?t.setProperty(n,s,l):t.setAttribute(n,s,l),r++}}return r}function Lm(t){return 3===t||4===t||6===t}function Fm(t){return 64===t.charCodeAt(0)}function Ys(t,n){if(null!==n&&0!==n.length)if(null===t||0===t.length)t=n.slice();else{let i=-1;for(let r=0;r<n.length;r++){const o=n[r];"number"==typeof o?i=o:0===i||Pm(t,i,o,null,-1===i||2===i?n[++r]:null)}}return t}function Pm(t,n,i,r,o){let s=0,l=t.length;if(-1===n)l=-1;else for(;s<t.length;){const h=t[s++];if("number"==typeof h){if(h===n){l=-1;break}if(h>n){l=s-1;break}}}for(;s<t.length;){const h=t[s];if("number"==typeof h)break;if(h===i){if(null===r)return void(null!==o&&(t[s+1]=o));if(r===t[s+1])return void(t[s+2]=o)}s++,null!==r&&s++,null!==o&&s++}-1!==l&&(t.splice(l,0,n),s=l+1),t.splice(s++,0,i),null!==r&&t.splice(s++,0,r),null!==o&&t.splice(s++,0,o)}const Nm="ng-template";function Pb(t,n,i){let r=0,o=!0;for(;r<t.length;){let s=t[r++];if("string"==typeof s&&o){const l=t[r++];if(i&&"class"===s&&-1!==Rm(l.toLowerCase(),n,0))return!0}else{if(1===s){for(;r<t.length&&"string"==typeof(s=t[r++]);)if(s.toLowerCase()===n)return!0;return!1}"number"==typeof s&&(o=!1)}}return!1}function km(t){return 4===t.type&&t.value!==Nm}function Nb(t,n,i){return n===(4!==t.type||i?t.value:Nm)}function kb(t,n,i){let r=4;const o=t.attrs||[],s=function Vb(t){for(let n=0;n<t.length;n++)if(Lm(t[n]))return n;return t.length}(o);let l=!1;for(let h=0;h<n.length;h++){const p=n[h];if("number"!=typeof p){if(!l)if(4&r){if(r=2|1&r,""!==p&&!Nb(t,p,i)||""===p&&1===n.length){if(Jn(r))return!1;l=!0}}else{const C=8&r?p:n[++h];if(8&r&&null!==t.attrs){if(!Pb(t.attrs,C,i)){if(Jn(r))return!1;l=!0}continue}const T=Bb(8&r?"class":p,o,km(t),i);if(-1===T){if(Jn(r))return!1;l=!0;continue}if(""!==C){let A;A=T>s?"":o[T+1].toLowerCase();const M=8&r?A:null;if(M&&-1!==Rm(M,C,0)||2&r&&C!==A){if(Jn(r))return!1;l=!0}}}}else{if(!l&&!Jn(r)&&!Jn(p))return!1;if(l&&Jn(p))continue;l=!1,r=p|1&r}}return Jn(r)||l}function Jn(t){return 0==(1&t)}function Bb(t,n,i,r){if(null===n)return-1;let o=0;if(r||!i){let s=!1;for(;o<n.length;){const l=n[o];if(l===t)return o;if(3===l||6===l)s=!0;else{if(1===l||2===l){let h=n[++o];for(;"string"==typeof h;)h=n[++o];continue}if(4===l)break;if(0===l){o+=4;continue}}o+=s?1:2}return-1}return function Ub(t,n){let i=t.indexOf(4);if(i>-1)for(i++;i<t.length;){const r=t[i];if("number"==typeof r)return-1;if(r===n)return i;i++}return-1}(n,t)}function Bm(t,n,i=!1){for(let r=0;r<n.length;r++)if(kb(t,n[r],i))return!0;return!1}function jm(t,n){return t?":not("+n.trim()+")":n}function Hb(t){let n=t[0],i=1,r=2,o="",s=!1;for(;i<t.length;){let l=t[i];if("string"==typeof l)if(2&r){const h=t[++i];o+="["+l+(h.length>0?'="'+h+'"':"")+"]"}else 8&r?o+="."+l:4&r&&(o+=" "+l);else""!==o&&!Jn(l)&&(n+=jm(s,o),o=""),r=l,s=s||!Jn(r);i++}return""!==o&&(n+=jm(s,o)),n}function zs(t){return Oi(()=>{const n=Um(t),i={...n,decls:t.decls,vars:t.vars,template:t.template,consts:t.consts||null,ngContentSelectors:t.ngContentSelectors,onPush:t.changeDetection===Bl.OnPush,directiveDefs:null,pipeDefs:null,dependencies:n.standalone&&t.dependencies||null,getStandaloneInjector:null,signals:t.signals??!1,data:t.data||{},encapsulation:t.encapsulation||Qn.Emulated,styles:t.styles||lt,_:null,schemas:t.schemas||null,tView:null,id:""};Gm(i);const r=t.dependencies;return i.directiveDefs=Vl(r,!1),i.pipeDefs=Vl(r,!0),i.id=function Kb(t){let n=0;const i=[t.selectors,t.ngContentSelectors,t.hostVars,t.hostAttrs,t.consts,t.vars,t.decls,t.encapsulation,t.standalone,t.signals,t.exportAs,JSON.stringify(t.inputs),JSON.stringify(t.outputs),Object.getOwnPropertyNames(t.type.prototype),!!t.contentQueries,!!t.viewQuery].join("|");for(const o of i)n=Math.imul(31,n)+o.charCodeAt(0)<<0;return n+=2147483648,"c"+n}(i),i})}function $b(t){return rt(t)||qt(t)}function Xb(t){return null!==t}function $s(t){return Oi(()=>({type:t.type,bootstrap:t.bootstrap||lt,declarations:t.declarations||lt,imports:t.imports||lt,exports:t.exports||lt,transitiveCompileScopes:null,schemas:t.schemas||null,id:t.id||null}))}function Vm(t,n){if(null==t)return hi;const i={};for(const r in t)if(t.hasOwnProperty(r)){let o=t[r],s=o;Array.isArray(o)&&(s=o[1],o=o[0]),i[o]=r,n&&(n[o]=s)}return i}function Un(t){return Oi(()=>{const n=Um(t);return Gm(n),n})}function rt(t){return t[jl]||null}function qt(t){return t[Pd]||null}function sn(t){return t[Nd]||null}function Um(t){const n={};return{type:t.type,providersResolver:null,factory:null,hostBindings:t.hostBindings||null,hostVars:t.hostVars||0,hostAttrs:t.hostAttrs||null,contentQueries:t.contentQueries||null,declaredInputs:n,inputTransforms:null,inputConfig:t.inputs||hi,exportAs:t.exportAs||null,standalone:!0===t.standalone,signals:!0===t.signals,selectors:t.selectors||lt,viewQuery:t.viewQuery||null,features:t.features||null,setInput:null,findHostDirectiveDefs:null,hostDirectives:null,inputs:Vm(t.inputs,n),outputs:Vm(t.outputs)}}function Gm(t){t.features?.forEach(n=>n(t))}function Vl(t,n){if(!t)return null;const i=n?sn:$b;return()=>("function"==typeof t?t():t).map(r=>i(r)).filter(Xb)}const Ft=0,Ee=1,Ge=2,At=3,ei=4,qs=5,tn=6,vo=7,Bt=8,dr=9,yo=10,Be=11,Zs=12,Hm=13,wo=14,jt=15,Ks=16,Co=17,fi=18,Qs=19,Wm=20,hr=21,Ri=22,Js=23,ea=24,Ze=25,Bd=1,Ym=2,gi=7,Eo=9,Zt=11;function yn(t){return Array.isArray(t)&&"object"==typeof t[Bd]}function an(t){return Array.isArray(t)&&!0===t[Bd]}function jd(t){return 0!=(4&t.flags)}function Vr(t){return t.componentOffset>-1}function Gl(t){return 1==(1&t.flags)}function ti(t){return!!t.template}function Vd(t){return 0!=(512&t[Ge])}function Ur(t,n){return t.hasOwnProperty(Mi)?t[Mi]:null}let Kt=null,Hl=!1;function Gn(t){const n=Kt;return Kt=t,n}const Xm={version:0,dirty:!1,producerNode:void 0,producerLastReadVersion:void 0,producerIndexOfThis:void 0,nextProducerIndex:0,liveConsumerNode:void 0,liveConsumerIndexOfThis:void 0,consumerAllowSignalWrites:!1,consumerIsAlwaysLive:!1,producerMustRecompute:()=>!1,producerRecomputeValue:()=>{},consumerMarkedDirty:()=>{}};function Zm(t){if(!na(t)||t.dirty){if(!t.producerMustRecompute(t)&&!Jm(t))return void(t.dirty=!1);t.producerRecomputeValue(t),t.dirty=!1}}function Qm(t){t.dirty=!0,function Km(t){if(void 0===t.liveConsumerNode)return;const n=Hl;Hl=!0;try{for(const i of t.liveConsumerNode)i.dirty||Qm(i)}finally{Hl=n}}(t),t.consumerMarkedDirty?.(t)}function Gd(t){return t&&(t.nextProducerIndex=0),Gn(t)}function Hd(t,n){if(Gn(n),t&&void 0!==t.producerNode&&void 0!==t.producerIndexOfThis&&void 0!==t.producerLastReadVersion){if(na(t))for(let i=t.nextProducerIndex;i<t.producerNode.length;i++)Wl(t.producerNode[i],t.producerIndexOfThis[i]);for(;t.producerNode.length>t.nextProducerIndex;)t.producerNode.pop(),t.producerLastReadVersion.pop(),t.producerIndexOfThis.pop()}}function Jm(t){Io(t);for(let n=0;n<t.producerNode.length;n++){const i=t.producerNode[n],r=t.producerLastReadVersion[n];if(r!==i.version||(Zm(i),r!==i.version))return!0}return!1}function e_(t){if(Io(t),na(t))for(let n=0;n<t.producerNode.length;n++)Wl(t.producerNode[n],t.producerIndexOfThis[n]);t.producerNode.length=t.producerLastReadVersion.length=t.producerIndexOfThis.length=0,t.liveConsumerNode&&(t.liveConsumerNode.length=t.liveConsumerIndexOfThis.length=0)}function Wl(t,n){if(function n_(t){t.liveConsumerNode??=[],t.liveConsumerIndexOfThis??=[]}(t),Io(t),1===t.liveConsumerNode.length)for(let r=0;r<t.producerNode.length;r++)Wl(t.producerNode[r],t.producerIndexOfThis[r]);const i=t.liveConsumerNode.length-1;if(t.liveConsumerNode[n]=t.liveConsumerNode[i],t.liveConsumerIndexOfThis[n]=t.liveConsumerIndexOfThis[i],t.liveConsumerNode.length--,t.liveConsumerIndexOfThis.length--,n<t.liveConsumerNode.length){const r=t.liveConsumerIndexOfThis[n],o=t.liveConsumerNode[n];Io(o),o.producerIndexOfThis[r]=n}}function na(t){return t.consumerIsAlwaysLive||(t?.liveConsumerNode?.length??0)>0}function Io(t){t.producerNode??=[],t.producerIndexOfThis??=[],t.producerLastReadVersion??=[]}let i_=null;const a_=()=>{},uS=(()=>({...Xm,consumerIsAlwaysLive:!0,consumerAllowSignalWrites:!1,consumerMarkedDirty:t=>{t.schedule(t.ref)},hasRun:!1,cleanupFn:a_}))();class dS{constructor(n,i,r){this.previousValue=n,this.currentValue=i,this.firstChange=r}isFirstChange(){return this.firstChange}}function l_(t){return t.type.prototype.ngOnChanges&&(t.setInput=fS),hS}function hS(){const t=u_(this),n=t?.current;if(n){const i=t.previous;if(i===hi)t.previous=n;else for(let r in n)i[r]=n[r];t.current=null,this.ngOnChanges(n)}}function fS(t,n,i,r){const o=this.declaredInputs[i],s=u_(t)||function gS(t,n){return t[c_]=n}(t,{previous:hi,current:null}),l=s.current||(s.current={}),h=s.previous,p=h[o];l[o]=new dS(p&&p.currentValue,n,h===hi),t[r]=n}const c_="__ngSimpleChanges__";function u_(t){return t[c_]||null}const pi=function(t,n,i){};function It(t){for(;Array.isArray(t);)t=t[Ft];return t}function wn(t,n){return It(n[t.index])}function f_(t,n){return t.data[n]}function An(t,n){const i=n[t];return yn(i)?i:i[Ft]}function gr(t,n){return null==n?null:t[n]}function g_(t){t[Co]=0}function wS(t){1024&t[Ge]||(t[Ge]|=1024,m_(t,1))}function p_(t){1024&t[Ge]&&(t[Ge]&=-1025,m_(t,-1))}function m_(t,n){let i=t[At];if(null===i)return;i[qs]+=n;let r=i;for(i=i[At];null!==i&&(1===n&&1===r[qs]||-1===n&&0===r[qs]);)i[qs]+=n,r=i,i=i[At]}const Fe={lFrame:T_(null),bindingsEnabled:!0,skipHydrationRootTNode:null};function y_(){return Fe.bindingsEnabled}function se(){return Fe.lFrame.lView}function ot(){return Fe.lFrame.tView}function Qt(){let t=w_();for(;null!==t&&64===t.type;)t=t.parent;return t}function w_(){return Fe.lFrame.currentTNode}function mi(t,n){const i=Fe.lFrame;i.currentTNode=t,i.isParent=n}function Xd(){return Fe.lFrame.isParent}function FS(t,n){const i=Fe.lFrame;i.bindingIndex=i.bindingRootIndex=t,Zd(n)}function Zd(t){Fe.lFrame.currentDirectiveIndex=t}function D_(){return Fe.lFrame.currentQueryIndex}function Qd(t){Fe.lFrame.currentQueryIndex=t}function NS(t){const n=t[Ee];return 2===n.type?n.declTNode:1===n.type?t[tn]:null}function b_(t,n,i){if(i&et.SkipSelf){let o=n,s=t;for(;!(o=o.parent,null!==o||i&et.Host||(o=NS(s),null===o||(s=s[wo],10&o.type))););if(null===o)return!1;n=o,t=s}const r=Fe.lFrame=S_();return r.currentTNode=n,r.lView=t,!0}function Jd(t){const n=S_(),i=t[Ee];Fe.lFrame=n,n.currentTNode=i.firstChild,n.lView=t,n.tView=i,n.contextLView=t,n.bindingIndex=i.bindingStartIndex,n.inI18n=!1}function S_(){const t=Fe.lFrame,n=null===t?null:t.child;return null===n?T_(t):n}function T_(t){const n={currentTNode:null,isParent:!0,lView:null,tView:null,selectedIndex:-1,contextLView:null,elementDepthCount:0,currentNamespace:null,currentDirectiveIndex:-1,bindingRootIndex:-1,bindingIndex:-1,currentQueryIndex:0,parent:t,child:null,inI18n:!1};return null!==t&&(t.child=n),n}function x_(){const t=Fe.lFrame;return Fe.lFrame=t.parent,t.currentTNode=null,t.lView=null,t}const A_=x_;function eh(){const t=x_();t.isParent=!0,t.tView=null,t.selectedIndex=-1,t.contextLView=null,t.elementDepthCount=0,t.currentDirectiveIndex=-1,t.currentNamespace=null,t.bindingRootIndex=-1,t.bindingIndex=-1,t.currentQueryIndex=0}function cn(){return Fe.lFrame.selectedIndex}function Gr(t){Fe.lFrame.selectedIndex=t}let M_=!0;function $l(){return M_}function pr(t){M_=t}function Xl(t,n){for(let i=n.directiveStart,r=n.directiveEnd;i<r;i++){const s=t.data[i].type.prototype,{ngAfterContentInit:l,ngAfterContentChecked:h,ngAfterViewInit:p,ngAfterViewChecked:C,ngOnDestroy:D}=s;l&&(t.contentHooks??=[]).push(-i,l),h&&((t.contentHooks??=[]).push(i,h),(t.contentCheckHooks??=[]).push(i,h)),p&&(t.viewHooks??=[]).push(-i,p),C&&((t.viewHooks??=[]).push(i,C),(t.viewCheckHooks??=[]).push(i,C)),null!=D&&(t.destroyHooks??=[]).push(i,D)}}function ql(t,n,i){R_(t,n,3,i)}function Zl(t,n,i,r){(3&t[Ge])===i&&R_(t,n,i,r)}function th(t,n){let i=t[Ge];(3&i)===n&&(i&=8191,i+=1,t[Ge]=i)}function R_(t,n,i,r){const s=r??-1,l=n.length-1;let h=0;for(let p=void 0!==r?65535&t[Co]:0;p<l;p++)if("number"==typeof n[p+1]){if(h=n[p],null!=r&&h>=r)break}else n[p]<0&&(t[Co]+=65536),(h<s||-1==s)&&(WS(t,i,n,p),t[Co]=(4294901760&t[Co])+p+2),p++}function L_(t,n){pi(4,t,n);const i=Gn(null);try{n.call(t)}finally{Gn(i),pi(5,t,n)}}function WS(t,n,i,r){const o=i[r]<0,s=i[r+1],h=t[o?-i[r]:i[r]];o?t[Ge]>>13<t[Co]>>16&&(3&t[Ge])===n&&(t[Ge]+=8192,L_(h,s)):L_(h,s)}const To=-1;class ra{constructor(n,i,r){this.factory=n,this.resolving=!1,this.canSeeViewProviders=i,this.injectImpl=r}}function ih(t){return t!==To}function oa(t){return 32767&t}function sa(t,n){let i=function XS(t){return t>>16}(t),r=n;for(;i>0;)r=r[wo],i--;return r}let rh=!0;function Kl(t){const n=rh;return rh=t,n}const F_=255,P_=5;let qS=0;const _i={};function Ql(t,n){const i=N_(t,n);if(-1!==i)return i;const r=n[Ee];r.firstCreatePass&&(t.injectorIndex=n.length,oh(r.data,t),oh(n,null),oh(r.blueprint,null));const o=Jl(t,n),s=t.injectorIndex;if(ih(o)){const l=oa(o),h=sa(o,n),p=h[Ee].data;for(let C=0;C<8;C++)n[s+C]=h[l+C]|p[l+C]}return n[s+8]=o,s}function oh(t,n){t.push(0,0,0,0,0,0,0,0,n)}function N_(t,n){return-1===t.injectorIndex||t.parent&&t.parent.injectorIndex===t.injectorIndex||null===n[t.injectorIndex+8]?-1:t.injectorIndex}function Jl(t,n){if(t.parent&&-1!==t.parent.injectorIndex)return t.parent.injectorIndex;let i=0,r=null,o=n;for(;null!==o;){if(r=H_(o),null===r)return To;if(i++,o=o[wo],-1!==r.injectorIndex)return r.injectorIndex|i<<16}return To}function sh(t,n,i){!function ZS(t,n,i){let r;"string"==typeof i?r=i.charCodeAt(0)||0:i.hasOwnProperty(Ws)&&(r=i[Ws]),null==r&&(r=i[Ws]=qS++);const o=r&F_;n.data[t+(o>>P_)]|=1<<o}(t,n,i)}function k_(t,n,i){if(i&et.Optional||void 0!==t)return t;Sd()}function B_(t,n,i,r){if(i&et.Optional&&void 0===r&&(r=null),!(i&(et.Self|et.Host))){const o=t[dr],s=_n(void 0);try{return o?o.get(n,r,i&et.Optional):Sm(n,r,i&et.Optional)}finally{_n(s)}}return k_(r,0,i)}function j_(t,n,i,r=et.Default,o){if(null!==t){if(2048&n[Ge]&&!(r&et.Self)){const l=function iT(t,n,i,r,o){let s=t,l=n;for(;null!==s&&null!==l&&2048&l[Ge]&&!(512&l[Ge]);){const h=V_(s,l,i,r|et.Self,_i);if(h!==_i)return h;let p=s.parent;if(!p){const C=l[Wm];if(C){const D=C.get(i,_i,r);if(D!==_i)return D}p=H_(l),l=l[wo]}s=p}return o}(t,n,i,r,_i);if(l!==_i)return l}const s=V_(t,n,i,r,_i);if(s!==_i)return s}return B_(n,i,r,o)}function V_(t,n,i,r,o){const s=function JS(t){if("string"==typeof t)return t.charCodeAt(0)||0;const n=t.hasOwnProperty(Ws)?t[Ws]:void 0;return"number"==typeof n?n>=0?n&F_:tT:n}(i);if("function"==typeof s){if(!b_(n,t,r))return r&et.Host?k_(o,0,r):B_(n,i,r,o);try{let l;if(l=s(r),null!=l||r&et.Optional)return l;Sd()}finally{A_()}}else if("number"==typeof s){let l=null,h=N_(t,n),p=To,C=r&et.Host?n[jt][tn]:null;for((-1===h||r&et.SkipSelf)&&(p=-1===h?Jl(t,n):n[h+8],p!==To&&G_(r,!1)?(l=n[Ee],h=oa(p),n=sa(p,n)):h=-1);-1!==h;){const D=n[Ee];if(U_(s,h,D.data)){const T=QS(h,n,i,l,r,C);if(T!==_i)return T}p=n[h+8],p!==To&&G_(r,n[Ee].data[h+8]===C)&&U_(s,h,n)?(l=D,h=oa(p),n=sa(p,n)):h=-1}}return o}function QS(t,n,i,r,o,s){const l=n[Ee],h=l.data[t+8],D=ec(h,l,i,null==r?Vr(h)&&rh:r!=l&&0!=(3&h.type),o&et.Host&&s===h);return null!==D?Hr(n,l,D,h):_i}function ec(t,n,i,r,o){const s=t.providerIndexes,l=n.data,h=1048575&s,p=t.directiveStart,D=s>>20,A=o?h+D:t.directiveEnd;for(let M=r?h:h+D;M<A;M++){const P=l[M];if(M<p&&i===P||M>=p&&P.type===i)return M}if(o){const M=l[p];if(M&&ti(M)&&M.type===i)return p}return null}function Hr(t,n,i,r){let o=t[i];const s=n.data;if(function YS(t){return t instanceof ra}(o)){const l=o;l.resolving&&function yb(t,n){const i=n?`. Dependency path: ${n.join(" > ")} > ${t}`:"";throw new De(-200,`Circular dependency in DI detected for ${t}${i}`)}(ht(s[i]));const h=Kl(l.canSeeViewProviders);l.resolving=!0;const C=l.injectImpl?_n(l.injectImpl):null;b_(t,r,et.Default);try{o=t[i]=l.factory(void 0,s,t,r),n.firstCreatePass&&i>=r.directiveStart&&function HS(t,n,i){const{ngOnChanges:r,ngOnInit:o,ngDoCheck:s}=n.type.prototype;if(r){const l=l_(n);(i.preOrderHooks??=[]).push(t,l),(i.preOrderCheckHooks??=[]).push(t,l)}o&&(i.preOrderHooks??=[]).push(0-t,o),s&&((i.preOrderHooks??=[]).push(t,s),(i.preOrderCheckHooks??=[]).push(t,s))}(i,s[i],n)}finally{null!==C&&_n(C),Kl(h),l.resolving=!1,A_()}}return o}function U_(t,n,i){return!!(i[n+(t>>P_)]&1<<t)}function G_(t,n){return!(t&et.Self||t&et.Host&&n)}class un{constructor(n,i){this._tNode=n,this._lView=i}get(n,i,r){return j_(this._tNode,this._lView,n,kl(r),i)}}function tT(){return new un(Qt(),se())}function H_(t){const n=t[Ee],i=n.type;return 2===i?n.declTNode:1===i?t[tn]:null}const Ao="__parameters__";function Mo(t,n,i){return Oi(()=>{const r=function ch(t){return function(...i){if(t){const r=t(...i);for(const o in r)this[o]=r[o]}}}(n);function o(...s){if(this instanceof o)return r.apply(this,s),this;const l=new o(...s);return h.annotation=l,h;function h(p,C,D){const T=p.hasOwnProperty(Ao)?p[Ao]:Object.defineProperty(p,Ao,{value:[]})[Ao];for(;T.length<=D;)T.push(null);return(T[D]=T[D]||[]).push(l),p}}return i&&(o.prototype=Object.create(i.prototype)),o.prototype.ngMetadataName=t,o.annotationCls=o,o})}function Lo(t,n){t.forEach(i=>Array.isArray(i)?Lo(i,n):n(i))}function Y_(t,n,i){n>=t.length?t.push(i):t.splice(n,0,i)}function tc(t,n){return n>=t.length-1?t.pop():t.splice(n,1)[0]}const hh=Hs(Mo("Optional"),8),fh=Hs(Mo("SkipSelf"),4);function ac(t){return 128==(128&t.flags)}var mr=function(t){return t[t.Important=1]="Important",t[t.DashCase=2]="DashCase",t}(mr||{});const _h=new Map;let FT=0;const yh="__ngContext__";function nn(t,n){yn(n)?(t[yh]=n[Qs],function NT(t){_h.set(t[Qs],t)}(n)):t[yh]=n}let wh;function Ch(t,n){return wh(t,n)}function ha(t){const n=t[At];return an(n)?n[At]:n}function hv(t){return gv(t[Zs])}function fv(t){return gv(t[ei])}function gv(t){for(;null!==t&&!an(t);)t=t[ei];return t}function ko(t,n,i,r,o){if(null!=r){let s,l=!1;an(r)?s=r:yn(r)&&(l=!0,r=r[Ft]);const h=It(r);0===t&&null!==i?null==o?vv(n,i,h):Wr(n,i,h,o||null,!0):1===t&&null!==i?Wr(n,i,h,o||null,!0):2===t?function gc(t,n,i){const r=hc(t,n);r&&function tx(t,n,i,r){t.removeChild(n,i,r)}(t,r,n,i)}(n,h,l):3===t&&n.destroyNode(h),null!=s&&function rx(t,n,i,r,o){const s=i[gi];s!==It(i)&&ko(n,t,r,s,o);for(let h=Zt;h<i.length;h++){const p=i[h];ga(p[Ee],p,t,n,r,s)}}(n,t,s,i,o)}}function uc(t,n,i){return t.createElement(n,i)}function mv(t,n){const i=t[Eo],r=i.indexOf(n);p_(n),i.splice(r,1)}function dc(t,n){if(t.length<=Zt)return;const i=Zt+n,r=t[i];if(r){const o=r[Ks];null!==o&&o!==t&&mv(o,r),n>0&&(t[i-1][ei]=r[ei]);const s=tc(t,Zt+n);!function $T(t,n){ga(t,n,n[Be],2,null,null),n[Ft]=null,n[tn]=null}(r[Ee],r);const l=s[fi];null!==l&&l.detachView(s[Ee]),r[At]=null,r[ei]=null,r[Ge]&=-129}return r}function Ih(t,n){if(!(256&n[Ge])){const i=n[Be];n[Js]&&e_(n[Js]),n[ea]&&e_(n[ea]),i.destroyNode&&ga(t,n,i,3,null,null),function ZT(t){let n=t[Zs];if(!n)return Dh(t[Ee],t);for(;n;){let i=null;if(yn(n))i=n[Zs];else{const r=n[Zt];r&&(i=r)}if(!i){for(;n&&!n[ei]&&n!==t;)yn(n)&&Dh(n[Ee],n),n=n[At];null===n&&(n=t),yn(n)&&Dh(n[Ee],n),i=n&&n[ei]}n=i}}(n)}}function Dh(t,n){if(!(256&n[Ge])){n[Ge]&=-129,n[Ge]|=256,function ex(t,n){let i;if(null!=t&&null!=(i=t.destroyHooks))for(let r=0;r<i.length;r+=2){const o=n[i[r]];if(!(o instanceof ra)){const s=i[r+1];if(Array.isArray(s))for(let l=0;l<s.length;l+=2){const h=o[s[l]],p=s[l+1];pi(4,h,p);try{p.call(h)}finally{pi(5,h,p)}}else{pi(4,o,s);try{s.call(o)}finally{pi(5,o,s)}}}}}(t,n),function JT(t,n){const i=t.cleanup,r=n[vo];if(null!==i)for(let s=0;s<i.length-1;s+=2)if("string"==typeof i[s]){const l=i[s+3];l>=0?r[l]():r[-l].unsubscribe(),s+=2}else i[s].call(r[i[s+1]]);null!==r&&(n[vo]=null);const o=n[hr];if(null!==o){n[hr]=null;for(let s=0;s<o.length;s++)(0,o[s])()}}(t,n),1===n[Ee].type&&n[Be].destroy();const i=n[Ks];if(null!==i&&an(n[At])){i!==n[At]&&mv(i,n);const r=n[fi];null!==r&&r.detachView(t)}!function kT(t){_h.delete(t[Qs])}(n)}}function bh(t,n,i){return function _v(t,n,i){let r=n;for(;null!==r&&40&r.type;)r=(n=r).parent;if(null===r)return i[Ft];{const{componentOffset:o}=r;if(o>-1){const{encapsulation:s}=t.data[r.directiveStart+o];if(s===Qn.None||s===Qn.Emulated)return null}return wn(r,i)}}(t,n.parent,i)}function Wr(t,n,i,r,o){t.insertBefore(n,i,r,o)}function vv(t,n,i){t.appendChild(n,i)}function yv(t,n,i,r,o){null!==r?Wr(t,n,i,r,o):vv(t,n,i)}function hc(t,n){return t.parentNode(n)}let Sh,Oh,Ev=function Cv(t,n,i){return 40&t.type?wn(t,i):null};function fc(t,n,i,r){const o=bh(t,r,n),s=n[Be],h=function wv(t,n,i){return Ev(t,n,i)}(r.parent||n[tn],r,n);if(null!=o)if(Array.isArray(i))for(let p=0;p<i.length;p++)yv(s,o,i[p],h,!1);else yv(s,o,i,h,!1);void 0!==Sh&&Sh(s,r,n,i,o)}function fa(t,n){if(null!==n){const i=n.type;if(3&i)return wn(n,t);if(4&i)return Th(-1,t[n.index]);if(8&i){const r=n.child;if(null!==r)return fa(t,r);{const o=t[n.index];return an(o)?Th(-1,o):It(o)}}if(32&i)return Ch(n,t)()||It(t[n.index]);{const r=Dv(t,n);return null!==r?Array.isArray(r)?r[0]:fa(ha(t[jt]),r):fa(t,n.next)}}return null}function Dv(t,n){return null!==n?t[jt][tn].projection[n.projection]:null}function Th(t,n){const i=Zt+t+1;if(i<n.length){const r=n[i],o=r[Ee].firstChild;if(null!==o)return fa(r,o)}return n[gi]}function xh(t,n,i,r,o,s,l){for(;null!=i;){const h=r[i.index],p=i.type;if(l&&0===n&&(h&&nn(It(h),r),i.flags|=2),32!=(32&i.flags))if(8&p)xh(t,n,i.child,r,o,s,!1),ko(n,t,o,h,s);else if(32&p){const C=Ch(i,r);let D;for(;D=C();)ko(n,t,o,D,s);ko(n,t,o,h,s)}else 16&p?Sv(t,n,r,i,o,s):ko(n,t,o,h,s);i=l?i.projectionNext:i.next}}function ga(t,n,i,r,o,s){xh(i,r,t.firstChild,n,o,s,!1)}function Sv(t,n,i,r,o,s){const l=i[jt],p=l[tn].projection[r.projection];if(Array.isArray(p))for(let C=0;C<p.length;C++)ko(n,t,o,p[C],s);else{let C=p;const D=l[At];ac(r)&&(C.flags|=128),xh(t,n,C,D,o,s,!0)}}function Tv(t,n,i){""===i?t.removeAttribute(n,"class"):t.setAttribute(n,"class",i)}function xv(t,n,i){const{mergedAttrs:r,classes:o,styles:s}=i;null!==r&&kd(t,n,r),null!==o&&Tv(t,n,o),null!==s&&function sx(t,n,i){t.setAttribute(n,"style",i)}(t,n,s)}const vc=new Ne("ENVIRONMENT_INITIALIZER"),Uv=new Ne("INJECTOR",-1),Gv=new Ne("INJECTOR_DEF_TYPES");class Nh{get(n,i=Gs){if(i===Gs){const r=new Error(`NullInjectorError: No provider for ${Yt(n)}!`);throw r.name="NullInjectorError",r}return i}}function Fx(...t){return{\u0275providers:Wv(0,t),\u0275fromNgModule:!0}}function Wv(t,...n){const i=[],r=new Set;let o;const s=l=>{i.push(l)};return Lo(n,l=>{const h=l;yc(h,s,[],r)&&(o||=[],o.push(h))}),void 0!==o&&Yv(o,s),i}function Yv(t,n){for(let i=0;i<t.length;i++){const{ngModule:r,providers:o}=t[i];kh(o,s=>{n(s,r)})}}function yc(t,n,i,r){if(!(t=Pe(t)))return!1;let o=null,s=Fl(t);const l=!s&&rt(t);if(s||l){if(l&&!l.standalone)return!1;o=t}else{const p=t.ngModule;if(s=Fl(p),!s)return!1;o=p}const h=r.has(o);if(l){if(h)return!1;if(r.add(o),l.dependencies){const p="function"==typeof l.dependencies?l.dependencies():l.dependencies;for(const C of p)yc(C,n,i,r)}}else{if(!s)return!1;{if(null!=s.imports&&!h){let C;r.add(o);try{Lo(s.imports,D=>{yc(D,n,i,r)&&(C||=[],C.push(D))})}finally{}void 0!==C&&Yv(C,n)}if(!h){const C=Ur(o)||(()=>new o);n({provide:o,useFactory:C,deps:lt},o),n({provide:Gv,useValue:o,multi:!0},o),n({provide:vc,useValue:()=>it(o),multi:!0},o)}const p=s.providers;if(null!=p&&!h){const C=t;kh(p,D=>{n(D,C)})}}}return o!==t&&void 0!==t.providers}function kh(t,n){for(let i of t)bd(i)&&(i=i.\u0275providers),Array.isArray(i)?kh(i,n):n(i)}const Px=gt({provide:String,useValue:gt});function Bh(t){return null!==t&&"object"==typeof t&&Px in t}function Yr(t){return"function"==typeof t}const jh=new Ne("Set Injector scope."),wc={},kx={};let Vh;function Cc(){return void 0===Vh&&(Vh=new Nh),Vh}class Ni{}class Uo extends Ni{get destroyed(){return this._destroyed}constructor(n,i,r,o){super(),this.parent=i,this.source=r,this.scopes=o,this.records=new Map,this._ngOnDestroyHooks=new Set,this._onDestroyHooks=[],this._destroyed=!1,Gh(n,l=>this.processProvider(l)),this.records.set(Uv,Go(void 0,this)),o.has("environment")&&this.records.set(Ni,Go(void 0,this));const s=this.records.get(jh);null!=s&&"string"==typeof s.value&&this.scopes.add(s.value),this.injectorDefTypes=new Set(this.get(Gv.multi,lt,et.Self))}destroy(){this.assertNotDestroyed(),this._destroyed=!0;try{for(const i of this._ngOnDestroyHooks)i.ngOnDestroy();const n=this._onDestroyHooks;this._onDestroyHooks=[];for(const i of n)i()}finally{this.records.clear(),this._ngOnDestroyHooks.clear(),this.injectorDefTypes.clear()}}onDestroy(n){return this.assertNotDestroyed(),this._onDestroyHooks.push(n),()=>this.removeOnDestroy(n)}runInContext(n){this.assertNotDestroyed();const i=ur(this),r=_n(void 0);try{return n()}finally{ur(i),_n(r)}}get(n,i=Gs,r=et.Default){if(this.assertNotDestroyed(),n.hasOwnProperty(Mm))return n[Mm](this);r=kl(r);const s=ur(this),l=_n(void 0);try{if(!(r&et.SkipSelf)){let p=this.records.get(n);if(void 0===p){const C=function Gx(t){return"function"==typeof t||"object"==typeof t&&t instanceof Ne}(n)&&Ll(n);p=C&&this.injectableDefInScope(C)?Go(Uh(n),wc):null,this.records.set(n,p)}if(null!=p)return this.hydrate(n,p)}return(r&et.Self?Cc():this.parent).get(n,i=r&et.Optional&&i===Gs?null:i)}catch(h){if("NullInjectorError"===h.name){if((h[Nl]=h[Nl]||[]).unshift(Yt(n)),s)throw h;return function Lb(t,n,i,r){const o=t[Nl];throw n[xm]&&o.unshift(n[xm]),t.message=function Fb(t,n,i,r=null){t=t&&"\n"===t.charAt(0)&&"\u0275"==t.charAt(1)?t.slice(2):t;let o=Yt(n);if(Array.isArray(n))o=n.map(Yt).join(" -> ");else if("object"==typeof n){let s=[];for(let l in n)if(n.hasOwnProperty(l)){let h=n[l];s.push(l+":"+("string"==typeof h?JSON.stringify(h):Yt(h)))}o=`{${s.join(", ")}}`}return`${i}${r?"("+r+")":""}[${o}]: ${t.replace(xb,"\n  ")}`}("\n"+t.message,o,i,r),t.ngTokenPath=o,t[Nl]=null,t}(h,n,"R3InjectorError",this.source)}throw h}finally{_n(l),ur(s)}}resolveInjectorInitializers(){const n=ur(this),i=_n(void 0);try{const o=this.get(vc.multi,lt,et.Self);for(const s of o)s()}finally{ur(n),_n(i)}}toString(){const n=[],i=this.records;for(const r of i.keys())n.push(Yt(r));return`R3Injector[${n.join(", ")}]`}assertNotDestroyed(){if(this._destroyed)throw new De(205,!1)}processProvider(n){let i=Yr(n=Pe(n))?n:Pe(n&&n.provide);const r=function jx(t){return Bh(t)?Go(void 0,t.useValue):Go(function Xv(t,n,i){let r;if(Yr(t)){const o=Pe(t);return Ur(o)||Uh(o)}if(Bh(t))r=()=>Pe(t.useValue);else if(function $v(t){return!(!t||!t.useFactory)}(t))r=()=>t.useFactory(...Fd(t.deps||[]));else if(function zv(t){return!(!t||!t.useExisting)}(t))r=()=>it(Pe(t.useExisting));else{const o=Pe(t&&(t.useClass||t.provide));if(!function Vx(t){return!!t.deps}(t))return Ur(o)||Uh(o);r=()=>new o(...Fd(t.deps))}return r}(t),wc)}(n);if(Yr(n)||!0!==n.multi)this.records.get(i);else{let o=this.records.get(i);o||(o=Go(void 0,wc,!0),o.factory=()=>Fd(o.multi),this.records.set(i,o)),i=n,o.multi.push(n)}this.records.set(i,r)}hydrate(n,i){return i.value===wc&&(i.value=kx,i.value=i.factory()),"object"==typeof i.value&&i.value&&function Ux(t){return null!==t&&"object"==typeof t&&"function"==typeof t.ngOnDestroy}(i.value)&&this._ngOnDestroyHooks.add(i.value),i.value}injectableDefInScope(n){if(!n.providedIn)return!1;const i=Pe(n.providedIn);return"string"==typeof i?"any"===i||this.scopes.has(i):this.injectorDefTypes.has(i)}removeOnDestroy(n){const i=this._onDestroyHooks.indexOf(n);-1!==i&&this._onDestroyHooks.splice(i,1)}}function Uh(t){const n=Ll(t),i=null!==n?n.factory:Ur(t);if(null!==i)return i;if(t instanceof Ne)throw new De(204,!1);if(t instanceof Function)return function Bx(t){const n=t.length;if(n>0)throw function ca(t,n){const i=[];for(let r=0;r<t;r++)i.push(n);return i}(n,"?"),new De(204,!1);const i=function Db(t){return t&&(t[Pl]||t[Dm])||null}(t);return null!==i?()=>i.factory(t):()=>new t}(t);throw new De(204,!1)}function Go(t,n,i=!1){return{factory:t,value:n,multi:i?[]:void 0}}function Gh(t,n){for(const i of t)Array.isArray(i)?Gh(i,n):i&&bd(i)?Gh(i.\u0275providers,n):n(i)}const Ec=new Ne("AppId",{providedIn:"root",factory:()=>Hx}),Hx="ng",qv=new Ne("Platform Initializer"),Ho=new Ne("Platform ID",{providedIn:"platform",factory:()=>"unknown"}),Zv=new Ne("CSP nonce",{providedIn:"root",factory:()=>function jo(){if(void 0!==Oh)return Oh;if(typeof document<"u")return document;throw new De(210,!1)}().body?.querySelector("[ngCspNonce]")?.getAttribute("ngCspNonce")||null});let Kv=(t,n,i)=>null;function Zh(t,n,i=!1){return Kv(t,n,i)}class Jx{}class ey{}class tA{resolveComponentFactory(n){throw function eA(t){const n=Error(`No component factory found for ${Yt(t)}.`);return n.ngComponent=t,n}(n)}}let xc=(()=>{class t{static#e=this.NULL=new tA}return t})();function nA(){return zo(Qt(),se())}function zo(t,n){return new $o(wn(t,n))}let $o=(()=>{class t{constructor(i){this.nativeElement=i}static#e=this.__NG_ELEMENT_ID__=nA}return t})();function iA(t){return t instanceof $o?t.nativeElement:t}class ny{}let iy=(()=>{class t{constructor(){this.destroyNode=null}static#e=this.__NG_ELEMENT_ID__=()=>function rA(){const t=se(),i=An(Qt().index,t);return(yn(i)?i:t)[Be]}()}return t})(),oA=(()=>{class t{static#e=this.\u0275prov=vt({token:t,providedIn:"root",factory:()=>null})}return t})();class Jh{constructor(n){this.full=n,this.major=n.split(".")[0],this.minor=n.split(".")[1],this.patch=n.split(".").slice(2).join(".")}}const sA=new Jh("16.2.12"),ef={};function ay(t,n=null,i=null,r){const o=ly(t,n,i,r);return o.resolveInjectorInitializers(),o}function ly(t,n=null,i=null,r,o=new Set){const s=[i||lt,Fx(t)];return r=r||("object"==typeof t?void 0:Yt(t)),new Uo(s,n||Cc(),r||null,o)}let vi=(()=>{class t{static#e=this.THROW_IF_NOT_FOUND=Gs;static#t=this.NULL=new Nh;static create(i,r){if(Array.isArray(i))return ay({name:""},r,i,"");{const o=i.name??"";return ay({name:o},i.parent,i.providers,o)}}static#n=this.\u0275prov=vt({token:t,providedIn:"any",factory:()=>it(Uv)});static#i=this.__NG_ELEMENT_ID__=-1}return t})();function nf(t){return t.ngOriginalError}class ki{constructor(){this._console=console}handleError(n){const i=this._findOriginalError(n);this._console.error("ERROR",n),i&&this._console.error("ORIGINAL ERROR",i)}_findOriginalError(n){let i=n&&nf(n);for(;i&&nf(i);)i=nf(i);return i||null}}function of(t){return n=>{setTimeout(t,void 0,n)}}const Bi=class fA extends Ol{constructor(n=!1){super(),this.__isAsync=n}emit(n){super.next(n)}subscribe(n,i,r){let o=n,s=i||(()=>null),l=r;if(n&&"object"==typeof n){const p=n;o=p.next?.bind(p),s=p.error?.bind(p),l=p.complete?.bind(p)}this.__isAsync&&(s=of(s),o&&(o=of(o)),l&&(l=of(l)));const h=super.subscribe({next:o,error:s,complete:l});return n instanceof di&&n.add(h),h}};function uy(...t){}class Pt{constructor({enableLongStackTrace:n=!1,shouldCoalesceEventChangeDetection:i=!1,shouldCoalesceRunChangeDetection:r=!1}){if(this.hasPendingMacrotasks=!1,this.hasPendingMicrotasks=!1,this.isStable=!0,this.onUnstable=new Bi(!1),this.onMicrotaskEmpty=new Bi(!1),this.onStable=new Bi(!1),this.onError=new Bi(!1),typeof Zone>"u")throw new De(908,!1);Zone.assertZonePatched();const o=this;o._nesting=0,o._outer=o._inner=Zone.current,Zone.TaskTrackingZoneSpec&&(o._inner=o._inner.fork(new Zone.TaskTrackingZoneSpec)),n&&Zone.longStackTraceZoneSpec&&(o._inner=o._inner.fork(Zone.longStackTraceZoneSpec)),o.shouldCoalesceEventChangeDetection=!r&&i,o.shouldCoalesceRunChangeDetection=r,o.lastRequestAnimationFrameId=-1,o.nativeRequestAnimationFrame=function gA(){const t="function"==typeof Ct.requestAnimationFrame;let n=Ct[t?"requestAnimationFrame":"setTimeout"],i=Ct[t?"cancelAnimationFrame":"clearTimeout"];if(typeof Zone<"u"&&n&&i){const r=n[Zone.__symbol__("OriginalDelegate")];r&&(n=r);const o=i[Zone.__symbol__("OriginalDelegate")];o&&(i=o)}return{nativeRequestAnimationFrame:n,nativeCancelAnimationFrame:i}}().nativeRequestAnimationFrame,function _A(t){const n=()=>{!function mA(t){t.isCheckStableRunning||-1!==t.lastRequestAnimationFrameId||(t.lastRequestAnimationFrameId=t.nativeRequestAnimationFrame.call(Ct,()=>{t.fakeTopEventTask||(t.fakeTopEventTask=Zone.root.scheduleEventTask("fakeTopEventTask",()=>{t.lastRequestAnimationFrameId=-1,af(t),t.isCheckStableRunning=!0,sf(t),t.isCheckStableRunning=!1},void 0,()=>{},()=>{})),t.fakeTopEventTask.invoke()}),af(t))}(t)};t._inner=t._inner.fork({name:"angular",properties:{isAngularZone:!0},onInvokeTask:(i,r,o,s,l,h)=>{if(function yA(t){return!(!Array.isArray(t)||1!==t.length)&&!0===t[0].data?.__ignore_ng_zone__}(h))return i.invokeTask(o,s,l,h);try{return dy(t),i.invokeTask(o,s,l,h)}finally{(t.shouldCoalesceEventChangeDetection&&"eventTask"===s.type||t.shouldCoalesceRunChangeDetection)&&n(),hy(t)}},onInvoke:(i,r,o,s,l,h,p)=>{try{return dy(t),i.invoke(o,s,l,h,p)}finally{t.shouldCoalesceRunChangeDetection&&n(),hy(t)}},onHasTask:(i,r,o,s)=>{i.hasTask(o,s),r===o&&("microTask"==s.change?(t._hasPendingMicrotasks=s.microTask,af(t),sf(t)):"macroTask"==s.change&&(t.hasPendingMacrotasks=s.macroTask))},onHandleError:(i,r,o,s)=>(i.handleError(o,s),t.runOutsideAngular(()=>t.onError.emit(s)),!1)})}(o)}static isInAngularZone(){return typeof Zone<"u"&&!0===Zone.current.get("isAngularZone")}static assertInAngularZone(){if(!Pt.isInAngularZone())throw new De(909,!1)}static assertNotInAngularZone(){if(Pt.isInAngularZone())throw new De(909,!1)}run(n,i,r){return this._inner.run(n,i,r)}runTask(n,i,r,o){const s=this._inner,l=s.scheduleEventTask("NgZoneEvent: "+o,n,pA,uy,uy);try{return s.runTask(l,i,r)}finally{s.cancelTask(l)}}runGuarded(n,i,r){return this._inner.runGuarded(n,i,r)}runOutsideAngular(n){return this._outer.run(n)}}const pA={};function sf(t){if(0==t._nesting&&!t.hasPendingMicrotasks&&!t.isStable)try{t._nesting++,t.onMicrotaskEmpty.emit(null)}finally{if(t._nesting--,!t.hasPendingMicrotasks)try{t.runOutsideAngular(()=>t.onStable.emit(null))}finally{t.isStable=!0}}}function af(t){t.hasPendingMicrotasks=!!(t._hasPendingMicrotasks||(t.shouldCoalesceEventChangeDetection||t.shouldCoalesceRunChangeDetection)&&-1!==t.lastRequestAnimationFrameId)}function dy(t){t._nesting++,t.isStable&&(t.isStable=!1,t.onUnstable.emit(null))}function hy(t){t._nesting--,sf(t)}class vA{constructor(){this.hasPendingMicrotasks=!1,this.hasPendingMacrotasks=!1,this.isStable=!0,this.onUnstable=new Bi,this.onMicrotaskEmpty=new Bi,this.onStable=new Bi,this.onError=new Bi}run(n,i,r){return n.apply(i,r)}runGuarded(n,i,r){return n.apply(i,r)}runOutsideAngular(n){return n()}runTask(n,i,r,o){return n.apply(i,r)}}const fy=new Ne("",{providedIn:"root",factory:gy});function gy(){const t=Et(Pt);let n=!0;return hb(new mn(o=>{n=t.isStable&&!t.hasPendingMacrotasks&&!t.hasPendingMicrotasks,t.runOutsideAngular(()=>{o.next(n),o.complete()})}),new mn(o=>{let s;t.runOutsideAngular(()=>{s=t.onStable.subscribe(()=>{Pt.assertNotInAngularZone(),queueMicrotask(()=>{!n&&!t.hasPendingMacrotasks&&!t.hasPendingMicrotasks&&(n=!0,o.next(!0))})})});const l=t.onUnstable.subscribe(()=>{Pt.assertInAngularZone(),n&&(n=!1,t.runOutsideAngular(()=>{o.next(!1)}))});return()=>{s.unsubscribe(),l.unsubscribe()}}).pipe(Cm()))}let lf=(()=>{class t{constructor(){this.renderDepth=0,this.handler=null}begin(){this.handler?.validateBegin(),this.renderDepth++}end(){this.renderDepth--,0===this.renderDepth&&this.handler?.execute()}ngOnDestroy(){this.handler?.destroy(),this.handler=null}static#e=this.\u0275prov=vt({token:t,providedIn:"root",factory:()=>new t})}return t})();function wa(t){for(;t;){t[Ge]|=64;const n=ha(t);if(Vd(t)&&!n)return t;t=n}return null}const yy=new Ne("",{providedIn:"root",factory:()=>!1});let Oc=null;function Iy(t,n){return t[n]??Sy()}function Dy(t,n){const i=Sy();i.producerNode?.length&&(t[n]=Oc,i.lView=t,Oc=by())}const AA={...Xm,consumerIsAlwaysLive:!0,consumerMarkedDirty:t=>{wa(t.lView)},lView:null};function by(){return Object.create(AA)}function Sy(){return Oc??=by(),Oc}const Ue={};function Ca(t){Ty(ot(),se(),cn()+t,!1)}function Ty(t,n,i,r){if(!r)if(3==(3&n[Ge])){const s=t.preOrderCheckHooks;null!==s&&ql(n,s,i)}else{const s=t.preOrderHooks;null!==s&&Zl(n,s,0,i)}Gr(i)}function ze(t,n=et.Default){const i=se();return null===i?it(t,n):j_(Qt(),i,Pe(t),n)}function Mc(t,n,i,r,o,s,l,h,p,C,D){const T=n.blueprint.slice();return T[Ft]=o,T[Ge]=140|r,(null!==C||t&&2048&t[Ge])&&(T[Ge]|=2048),g_(T),T[At]=T[wo]=t,T[Bt]=i,T[yo]=l||t&&t[yo],T[Be]=h||t&&t[Be],T[dr]=p||t&&t[dr]||null,T[tn]=s,T[Qs]=function PT(){return FT++}(),T[Ri]=D,T[Wm]=C,T[jt]=2==n.type?t[jt]:T,T}function Zo(t,n,i,r,o){let s=t.data[n];if(null===s)s=function cf(t,n,i,r,o){const s=w_(),l=Xd(),p=t.data[n]=function BA(t,n,i,r,o,s){let l=n?n.injectorIndex:-1,h=0;return function bo(){return null!==Fe.skipHydrationRootTNode}()&&(h|=128),{type:i,index:r,insertBeforeIndex:null,injectorIndex:l,directiveStart:-1,directiveEnd:-1,directiveStylingLast:-1,componentOffset:-1,propertyBindings:null,flags:h,providerIndexes:0,value:o,attrs:s,mergedAttrs:null,localNames:null,initialInputs:void 0,inputs:null,outputs:null,tView:null,next:null,prev:null,projectionNext:null,child:null,parent:n,projection:null,styles:null,stylesWithoutHost:null,residualStyles:void 0,classes:null,classesWithoutHost:null,residualClasses:void 0,classBindings:0,styleBindings:0}}(0,l?s:s&&s.parent,i,n,r,o);return null===t.firstChild&&(t.firstChild=p),null!==s&&(l?null==s.child&&null!==p.parent&&(s.child=p):null===s.next&&(s.next=p,p.prev=s)),p}(t,n,i,r,o),function LS(){return Fe.lFrame.inI18n}()&&(s.flags|=32);else if(64&s.type){s.type=i,s.value=r,s.attrs=o;const l=function ia(){const t=Fe.lFrame,n=t.currentTNode;return t.isParent?n:n.parent}();s.injectorIndex=null===l?-1:l.injectorIndex}return mi(s,!0),s}function Ea(t,n,i,r){if(0===i)return-1;const o=n.length;for(let s=0;s<i;s++)n.push(r),t.blueprint.push(r),t.data.push(null);return o}function xy(t,n,i,r,o){const s=Iy(n,Js),l=cn(),h=2&r;try{Gr(-1),h&&n.length>Ze&&Ty(t,n,Ze,!1),pi(h?2:0,o);const C=h?s:null,D=Gd(C);try{null!==C&&(C.dirty=!1),i(r,o)}finally{Hd(C,D)}}finally{h&&null===n[Js]&&Dy(n,Js),Gr(l),pi(h?3:1,o)}}function uf(t,n,i){if(jd(n)){const r=Gn(null);try{const s=n.directiveEnd;for(let l=n.directiveStart;l<s;l++){const h=t.data[l];h.contentQueries&&h.contentQueries(1,i[l],l)}}finally{Gn(r)}}}function df(t,n,i){y_()&&(function YA(t,n,i,r){const o=i.directiveStart,s=i.directiveEnd;Vr(i)&&function QA(t,n,i){const r=wn(n,t),o=Ay(i);let l=16;i.signals?l=4096:i.onPush&&(l=64);const h=Rc(t,Mc(t,o,null,l,r,n,null,t[yo].rendererFactory.createRenderer(r,i),null,null,null));t[n.index]=h}(n,i,t.data[o+i.componentOffset]),t.firstCreatePass||Ql(i,n),nn(r,n);const l=i.initialInputs;for(let h=o;h<s;h++){const p=t.data[h],C=Hr(n,t,h,i);nn(C,n),null!==l&&JA(0,h-o,C,p,0,l),ti(p)&&(An(i.index,n)[Bt]=Hr(n,t,h,i))}}(t,n,i,wn(i,n)),64==(64&i.flags)&&Fy(t,n,i))}function hf(t,n,i=wn){const r=n.localNames;if(null!==r){let o=n.index+1;for(let s=0;s<r.length;s+=2){const l=r[s+1],h=-1===l?i(n,t):t[l];t[o++]=h}}}function Ay(t){const n=t.tView;return null===n||n.incompleteFirstPass?t.tView=ff(1,null,t.template,t.decls,t.vars,t.directiveDefs,t.pipeDefs,t.viewQuery,t.schemas,t.consts,t.id):n}function ff(t,n,i,r,o,s,l,h,p,C,D){const T=Ze+r,A=T+o,M=function RA(t,n){const i=[];for(let r=0;r<n;r++)i.push(r<t?null:Ue);return i}(T,A),P="function"==typeof C?C():C;return M[Ee]={type:t,blueprint:M,template:i,queries:null,viewQuery:h,declTNode:n,data:M.slice().fill(null,T),bindingStartIndex:T,expandoStartIndex:A,hostBindingOpCodes:null,firstCreatePass:!0,firstUpdatePass:!0,staticViewQueries:!1,staticContentQueries:!1,preOrderHooks:null,preOrderCheckHooks:null,contentHooks:null,contentCheckHooks:null,viewHooks:null,viewCheckHooks:null,destroyHooks:null,cleanup:null,contentQueries:null,components:null,directiveRegistry:"function"==typeof s?s():s,pipeRegistry:"function"==typeof l?l():l,firstChild:null,schemas:p,consts:P,incompleteFirstPass:!1,ssrId:D}}let Oy=t=>null;function My(t,n,i,r){for(let o in t)if(t.hasOwnProperty(o)){i=null===i?{}:i;const s=t[o];null===r?Ry(i,n,o,s):r.hasOwnProperty(o)&&Ry(i,n,r[o],s)}return i}function Ry(t,n,i,r){t.hasOwnProperty(i)?t[i].push(n,r):t[i]=[n,r]}function gf(t,n,i,r){if(y_()){const o=null===r?null:{"":-1},s=function $A(t,n){const i=t.directiveRegistry;let r=null,o=null;if(i)for(let s=0;s<i.length;s++){const l=i[s];if(Bm(n,l.selectors,!1))if(r||(r=[]),ti(l))if(null!==l.findHostDirectiveDefs){const h=[];o=o||new Map,l.findHostDirectiveDefs(l,h,o),r.unshift(...h,l),pf(t,n,h.length)}else r.unshift(l),pf(t,n,0);else o=o||new Map,l.findHostDirectiveDefs?.(l,r,o),r.push(l)}return null===r?null:[r,o]}(t,i);let l,h;null===s?l=h=null:[l,h]=s,null!==l&&Ly(t,n,i,l,o,h),o&&function XA(t,n,i){if(n){const r=t.localNames=[];for(let o=0;o<n.length;o+=2){const s=i[n[o+1]];if(null==s)throw new De(-301,!1);r.push(n[o],s)}}}(i,r,o)}i.mergedAttrs=Ys(i.mergedAttrs,i.attrs)}function Ly(t,n,i,r,o,s){for(let C=0;C<r.length;C++)sh(Ql(i,n),t,r[C].type);!function ZA(t,n,i){t.flags|=1,t.directiveStart=n,t.directiveEnd=n+i,t.providerIndexes=n}(i,t.data.length,r.length);for(let C=0;C<r.length;C++){const D=r[C];D.providersResolver&&D.providersResolver(D)}let l=!1,h=!1,p=Ea(t,n,r.length,null);for(let C=0;C<r.length;C++){const D=r[C];i.mergedAttrs=Ys(i.mergedAttrs,D.hostAttrs),KA(t,i,n,p,D),qA(p,D,o),null!==D.contentQueries&&(i.flags|=4),(null!==D.hostBindings||null!==D.hostAttrs||0!==D.hostVars)&&(i.flags|=64);const T=D.type.prototype;!l&&(T.ngOnChanges||T.ngOnInit||T.ngDoCheck)&&((t.preOrderHooks??=[]).push(i.index),l=!0),!h&&(T.ngOnChanges||T.ngDoCheck)&&((t.preOrderCheckHooks??=[]).push(i.index),h=!0),p++}!function jA(t,n,i){const o=n.directiveEnd,s=t.data,l=n.attrs,h=[];let p=null,C=null;for(let D=n.directiveStart;D<o;D++){const T=s[D],A=i?i.get(T):null,P=A?A.outputs:null;p=My(T.inputs,D,p,A?A.inputs:null),C=My(T.outputs,D,C,P);const B=null===p||null===l||km(n)?null:e1(p,D,l);h.push(B)}null!==p&&(p.hasOwnProperty("class")&&(n.flags|=8),p.hasOwnProperty("style")&&(n.flags|=16)),n.initialInputs=h,n.inputs=p,n.outputs=C}(t,i,s)}function Fy(t,n,i){const r=i.directiveStart,o=i.directiveEnd,s=i.index,l=function PS(){return Fe.lFrame.currentDirectiveIndex}();try{Gr(s);for(let h=r;h<o;h++){const p=t.data[h],C=n[h];Zd(h),(null!==p.hostBindings||0!==p.hostVars||null!==p.hostAttrs)&&zA(p,C)}}finally{Gr(-1),Zd(l)}}function zA(t,n){null!==t.hostBindings&&t.hostBindings(1,n)}function pf(t,n,i){n.componentOffset=i,(t.components??=[]).push(n.index)}function qA(t,n,i){if(i){if(n.exportAs)for(let r=0;r<n.exportAs.length;r++)i[n.exportAs[r]]=t;ti(n)&&(i[""]=t)}}function KA(t,n,i,r,o){t.data[r]=o;const s=o.factory||(o.factory=Ur(o.type)),l=new ra(s,ti(o),ze);t.blueprint[r]=l,i[r]=l,function HA(t,n,i,r,o){const s=o.hostBindings;if(s){let l=t.hostBindingOpCodes;null===l&&(l=t.hostBindingOpCodes=[]);const h=~n.index;(function WA(t){let n=t.length;for(;n>0;){const i=t[--n];if("number"==typeof i&&i<0)return i}return 0})(l)!=h&&l.push(h),l.push(i,r,s)}}(t,n,r,Ea(t,i,o.hostVars,Ue),o)}function JA(t,n,i,r,o,s){const l=s[n];if(null!==l)for(let h=0;h<l.length;)Py(r,i,l[h++],l[h++],l[h++])}function Py(t,n,i,r,o){const s=Gn(null);try{const l=t.inputTransforms;null!==l&&l.hasOwnProperty(r)&&(o=l[r].call(n,o)),null!==t.setInput?t.setInput(n,o,i,r):n[r]=o}finally{Gn(s)}}function e1(t,n,i){let r=null,o=0;for(;o<i.length;){const s=i[o];if(0!==s)if(5!==s){if("number"==typeof s)break;if(t.hasOwnProperty(s)){null===r&&(r=[]);const l=t[s];for(let h=0;h<l.length;h+=2)if(l[h]===n){r.push(s,l[h+1],i[o+1]);break}}o+=2}else o+=2;else o+=4}return r}function Ny(t,n,i,r){return[t,!0,!1,n,null,0,r,i,null,null,null]}function ky(t,n){const i=t.contentQueries;if(null!==i)for(let r=0;r<i.length;r+=2){const s=i[r+1];if(-1!==s){const l=t.data[s];Qd(i[r]),l.contentQueries(2,n[s],s)}}}function Rc(t,n){return t[Zs]?t[Hm][ei]=n:t[Zs]=n,t[Hm]=n,n}function _f(t,n,i){Qd(0);const r=Gn(null);try{n(t,i)}finally{Gn(r)}}function By(t){return t[vo]||(t[vo]=[])}function jy(t){return t.cleanup||(t.cleanup=[])}function Uy(t,n){const i=t[dr],r=i?i.get(ki,null):null;r&&r.handleError(n)}function vf(t,n,i,r,o){for(let s=0;s<i.length;){const l=i[s++],h=i[s++];Py(t.data[l],n[l],r,h,o)}}function t1(t,n){const i=An(n,t),r=i[Ee];!function n1(t,n){for(let i=n.length;i<t.blueprint.length;i++)n.push(t.blueprint[i])}(r,i);const o=i[Ft];null!==o&&null===i[Ri]&&(i[Ri]=Zh(o,i[dr])),yf(r,i,i[Bt])}function yf(t,n,i){Jd(n);try{const r=t.viewQuery;null!==r&&_f(1,r,i);const o=t.template;null!==o&&xy(t,n,o,1,i),t.firstCreatePass&&(t.firstCreatePass=!1),t.staticContentQueries&&ky(t,n),t.staticViewQueries&&_f(2,t.viewQuery,i);const s=t.components;null!==s&&function i1(t,n){for(let i=0;i<n.length;i++)t1(t,n[i])}(n,s)}catch(r){throw t.firstCreatePass&&(t.incompleteFirstPass=!0,t.firstCreatePass=!1),r}finally{n[Ge]&=-5,eh()}}let Gy=(()=>{class t{constructor(){this.all=new Set,this.queue=new Map}create(i,r,o){const s=typeof Zone>"u"?null:Zone.current,l=function cS(t,n,i){const r=Object.create(uS);i&&(r.consumerAllowSignalWrites=!0),r.fn=t,r.schedule=n;const o=l=>{r.cleanupFn=l};return r.ref={notify:()=>Qm(r),run:()=>{if(r.dirty=!1,r.hasRun&&!Jm(r))return;r.hasRun=!0;const l=Gd(r);try{r.cleanupFn(),r.cleanupFn=a_,r.fn(o)}finally{Hd(r,l)}},cleanup:()=>r.cleanupFn()},r.ref}(i,C=>{this.all.has(C)&&this.queue.set(C,s)},o);let h;this.all.add(l),l.notify();const p=()=>{l.cleanup(),h?.(),this.all.delete(l),this.queue.delete(l)};return h=r?.onDestroy(p),{destroy:p}}flush(){if(0!==this.queue.size)for(const[i,r]of this.queue)this.queue.delete(i),r?r.run(()=>i.run()):i.run()}get isQueueEmpty(){return 0===this.queue.size}static#e=this.\u0275prov=vt({token:t,providedIn:"root",factory:()=>new t})}return t})();function Lc(t,n,i){let r=i?t.styles:null,o=i?t.classes:null,s=0;if(null!==n)for(let l=0;l<n.length;l++){const h=n[l];"number"==typeof h?s=h:1==s?o=Ed(o,h):2==s&&(r=Ed(r,h+": "+n[++l]+";"))}i?t.styles=r:t.stylesWithoutHost=r,i?t.classes=o:t.classesWithoutHost=o}function Ia(t,n,i,r,o=!1){for(;null!==i;){const s=n[i.index];null!==s&&r.push(It(s)),an(s)&&Hy(s,r);const l=i.type;if(8&l)Ia(t,n,i.child,r);else if(32&l){const h=Ch(i,n);let p;for(;p=h();)r.push(p)}else if(16&l){const h=Dv(n,i);if(Array.isArray(h))r.push(...h);else{const p=ha(n[jt]);Ia(p[Ee],p,h,r,!0)}}i=o?i.projectionNext:i.next}return r}function Hy(t,n){for(let i=Zt;i<t.length;i++){const r=t[i],o=r[Ee].firstChild;null!==o&&Ia(r[Ee],r,o,n)}t[gi]!==t[Ft]&&n.push(t[gi])}function Fc(t,n,i,r=!0){const o=n[yo],s=o.rendererFactory,l=o.afterRenderEventManager;s.begin?.(),l?.begin();try{Wy(t,n,t.template,i)}catch(p){throw r&&Uy(n,p),p}finally{s.end?.(),o.effectManager?.flush(),l?.end()}}function Wy(t,n,i,r){const o=n[Ge];if(256!=(256&o)){n[yo].effectManager?.flush(),Jd(n);try{g_(n),function E_(t){return Fe.lFrame.bindingIndex=t}(t.bindingStartIndex),null!==i&&xy(t,n,i,2,r);const l=3==(3&o);if(l){const C=t.preOrderCheckHooks;null!==C&&ql(n,C,null)}else{const C=t.preOrderHooks;null!==C&&Zl(n,C,0,null),th(n,0)}if(function s1(t){for(let n=hv(t);null!==n;n=fv(n)){if(!n[Ym])continue;const i=n[Eo];for(let r=0;r<i.length;r++){wS(i[r])}}}(n),Yy(n,2),null!==t.contentQueries&&ky(t,n),l){const C=t.contentCheckHooks;null!==C&&ql(n,C)}else{const C=t.contentHooks;null!==C&&Zl(n,C,1),th(n,1)}!function MA(t,n){const i=t.hostBindingOpCodes;if(null===i)return;const r=Iy(n,ea);try{for(let o=0;o<i.length;o++){const s=i[o];if(s<0)Gr(~s);else{const l=s,h=i[++o],p=i[++o];FS(h,l),r.dirty=!1;const C=Gd(r);try{p(2,n[l])}finally{Hd(r,C)}}}}finally{null===n[ea]&&Dy(n,ea),Gr(-1)}}(t,n);const h=t.components;null!==h&&$y(n,h,0);const p=t.viewQuery;if(null!==p&&_f(2,p,r),l){const C=t.viewCheckHooks;null!==C&&ql(n,C)}else{const C=t.viewHooks;null!==C&&Zl(n,C,2),th(n,2)}!0===t.firstUpdatePass&&(t.firstUpdatePass=!1),n[Ge]&=-73,p_(n)}finally{eh()}}}function Yy(t,n){for(let i=hv(t);null!==i;i=fv(i))for(let r=Zt;r<i.length;r++)zy(i[r],n)}function a1(t,n,i){zy(An(n,t),i)}function zy(t,n){if(!function vS(t){return 128==(128&t[Ge])}(t))return;const i=t[Ee],r=t[Ge];if(80&r&&0===n||1024&r||2===n)Wy(i,t,i.template,t[Bt]);else if(t[qs]>0){Yy(t,1);const o=i.components;null!==o&&$y(t,o,1)}}function $y(t,n,i){for(let r=0;r<n.length;r++)a1(t,n[r],i)}class Da{get rootNodes(){const n=this._lView,i=n[Ee];return Ia(i,n,i.firstChild,[])}constructor(n,i){this._lView=n,this._cdRefInjectingView=i,this._appRef=null,this._attachedToViewContainer=!1}get context(){return this._lView[Bt]}set context(n){this._lView[Bt]=n}get destroyed(){return 256==(256&this._lView[Ge])}destroy(){if(this._appRef)this._appRef.detachView(this);else if(this._attachedToViewContainer){const n=this._lView[At];if(an(n)){const i=n[8],r=i?i.indexOf(this):-1;r>-1&&(dc(n,r),tc(i,r))}this._attachedToViewContainer=!1}Ih(this._lView[Ee],this._lView)}onDestroy(n){!function __(t,n){if(256==(256&t[Ge]))throw new De(911,!1);null===t[hr]&&(t[hr]=[]),t[hr].push(n)}(this._lView,n)}markForCheck(){wa(this._cdRefInjectingView||this._lView)}detach(){this._lView[Ge]&=-129}reattach(){this._lView[Ge]|=128}detectChanges(){Fc(this._lView[Ee],this._lView,this.context)}checkNoChanges(){}attachToViewContainerRef(){if(this._appRef)throw new De(902,!1);this._attachedToViewContainer=!0}detachFromAppRef(){this._appRef=null,function qT(t,n){ga(t,n,n[Be],2,null,null)}(this._lView[Ee],this._lView)}attachToAppRef(n){if(this._attachedToViewContainer)throw new De(902,!1);this._appRef=n}}class l1 extends Da{constructor(n){super(n),this._view=n}detectChanges(){const n=this._view;Fc(n[Ee],n,n[Bt],!1)}checkNoChanges(){}get context(){return null}}class Xy extends xc{constructor(n){super(),this.ngModule=n}resolveComponentFactory(n){const i=rt(n);return new ba(i,this.ngModule)}}function qy(t){const n=[];for(let i in t)t.hasOwnProperty(i)&&n.push({propName:t[i],templateName:i});return n}class u1{constructor(n,i){this.injector=n,this.parentInjector=i}get(n,i,r){r=kl(r);const o=this.injector.get(n,ef,r);return o!==ef||i===ef?o:this.parentInjector.get(n,i,r)}}class ba extends ey{get inputs(){const n=this.componentDef,i=n.inputTransforms,r=qy(n.inputs);if(null!==i)for(const o of r)i.hasOwnProperty(o.propName)&&(o.transform=i[o.propName]);return r}get outputs(){return qy(this.componentDef.outputs)}constructor(n,i){super(),this.componentDef=n,this.ngModule=i,this.componentType=n.type,this.selector=function Wb(t){return t.map(Hb).join(",")}(n.selectors),this.ngContentSelectors=n.ngContentSelectors?n.ngContentSelectors:[],this.isBoundToModule=!!i}create(n,i,r,o){let s=(o=o||this.ngModule)instanceof Ni?o:o?.injector;s&&null!==this.componentDef.getStandaloneInjector&&(s=this.componentDef.getStandaloneInjector(s)||s);const l=s?new u1(n,s):n,h=l.get(ny,null);if(null===h)throw new De(407,!1);const T={rendererFactory:h,sanitizer:l.get(oA,null),effectManager:l.get(Gy,null),afterRenderEventManager:l.get(lf,null)},A=h.createRenderer(null,this.componentDef),M=this.componentDef.selectors[0][0]||"div",P=r?function LA(t,n,i,r){const s=r.get(yy,!1)||i===Qn.ShadowDom,l=t.selectRootElement(n,s);return function FA(t){Oy(t)}(l),l}(A,r,this.componentDef.encapsulation,l):uc(A,M,function c1(t){const n=t.toLowerCase();return"svg"===n?"svg":"math"===n?"math":null}(M)),U=this.componentDef.signals?4608:this.componentDef.onPush?576:528;let V=null;null!==P&&(V=Zh(P,l,!0));const q=ff(0,null,null,1,0,null,null,null,null,null,null),ce=Mc(null,q,null,U,null,null,T,A,l,null,V);let ge,ve;Jd(ce);try{const me=this.componentDef;let S,we=null;me.findHostDirectiveDefs?(S=[],we=new Map,me.findHostDirectiveDefs(me,S,we),S.push(me)):S=[me];const Me=function h1(t,n){const i=t[Ee],r=Ze;return t[r]=n,Zo(i,r,2,"#host",null)}(ce,P),nt=function f1(t,n,i,r,o,s,l){const h=o[Ee];!function g1(t,n,i,r){for(const o of t)n.mergedAttrs=Ys(n.mergedAttrs,o.hostAttrs);null!==n.mergedAttrs&&(Lc(n,n.mergedAttrs,!0),null!==i&&xv(r,i,n))}(r,t,n,l);let p=null;null!==n&&(p=Zh(n,o[dr]));const C=s.rendererFactory.createRenderer(n,i);let D=16;i.signals?D=4096:i.onPush&&(D=64);const T=Mc(o,Ay(i),null,D,o[t.index],t,s,C,null,null,p);return h.firstCreatePass&&pf(h,t,r.length-1),Rc(o,T),o[t.index]=T}(Me,P,me,S,ce,T,A);ve=f_(q,Ze),P&&function m1(t,n,i,r){if(r)kd(t,i,["ng-version",sA.full]);else{const{attrs:o,classes:s}=function Yb(t){const n=[],i=[];let r=1,o=2;for(;r<t.length;){let s=t[r];if("string"==typeof s)2===o?""!==s&&n.push(s,t[++r]):8===o&&i.push(s);else{if(!Jn(o))break;o=s}r++}return{attrs:n,classes:i}}(n.selectors[0]);o&&kd(t,i,o),s&&s.length>0&&Tv(t,i,s.join(" "))}}(A,me,P,r),void 0!==i&&function _1(t,n,i){const r=t.projection=[];for(let o=0;o<n.length;o++){const s=i[o];r.push(null!=s?Array.from(s):null)}}(ve,this.ngContentSelectors,i),ge=function p1(t,n,i,r,o,s){const l=Qt(),h=o[Ee],p=wn(l,o);Ly(h,o,l,i,null,r);for(let D=0;D<i.length;D++)nn(Hr(o,h,l.directiveStart+D,l),o);Fy(h,o,l),p&&nn(p,o);const C=Hr(o,h,l.directiveStart+l.componentOffset,l);if(t[Bt]=o[Bt]=C,null!==s)for(const D of s)D(C,n);return uf(h,l,t),C}(nt,me,S,we,ce,[v1]),yf(q,ce,null)}finally{eh()}return new d1(this.componentType,ge,zo(ve,ce),ce,ve)}}class d1 extends Jx{constructor(n,i,r,o,s){super(),this.location=r,this._rootLView=o,this._tNode=s,this.previousInputValues=null,this.instance=i,this.hostView=this.changeDetectorRef=new l1(o),this.componentType=n}setInput(n,i){const r=this._tNode.inputs;let o;if(null!==r&&(o=r[n])){if(this.previousInputValues??=new Map,this.previousInputValues.has(n)&&Object.is(this.previousInputValues.get(n),i))return;const s=this._rootLView;vf(s[Ee],s,o,n,i),this.previousInputValues.set(n,i),wa(An(this._tNode.index,s))}}get injector(){return new un(this._tNode,this._rootLView)}destroy(){this.hostView.destroy()}onDestroy(n){this.hostView.onDestroy(n)}}function v1(){const t=Qt();Xl(se()[Ee],t)}function wf(t){return null!==t&&("function"==typeof t||"object"==typeof t)}function rn(t,n,i){return!Object.is(t[n],i)&&(t[n]=i,!0)}function Sf(t,n,i,r,o,s,l,h){const p=se(),C=ot(),D=t+Ze,T=C.firstCreatePass?function X1(t,n,i,r,o,s,l,h,p){const C=n.consts,D=Zo(n,t,4,l||null,gr(C,h));gf(n,i,D,gr(C,p)),Xl(n,D);const T=D.tView=ff(2,D,r,o,s,n.directiveRegistry,n.pipeRegistry,null,n.schemas,C,null);return null!==n.queries&&(n.queries.template(n,D),T.queries=n.queries.embeddedTView(D)),D}(D,C,p,n,i,r,o,s,l):C.data[D];mi(T,!1);const A=p0(C,p,T,t);$l()&&fc(C,p,A,T),nn(A,p),Rc(p,p[D]=Ny(A,p,A,T)),Gl(T)&&df(C,p,T),null!=l&&hf(p,T,h)}let p0=function m0(t,n,i,r){return pr(!0),n[Be].createComment("")};function ss(t,n,i){const r=se();return rn(r,function So(){return Fe.lFrame.bindingIndex++}(),n)&&function Mn(t,n,i,r,o,s,l,h){const p=wn(n,i);let D,C=n.inputs;!h&&null!=C&&(D=C[r])?(vf(t,i,D,r,o),Vr(n)&&function UA(t,n){const i=An(n,t);16&i[Ge]||(i[Ge]|=64)}(i,n.index)):3&n.type&&(r=function VA(t){return"class"===t?"className":"for"===t?"htmlFor":"formaction"===t?"formAction":"innerHtml"===t?"innerHTML":"readonly"===t?"readOnly":"tabindex"===t?"tabIndex":t}(r),o=null!=l?l(o,n.value||"",r):o,s.setProperty(p,r,o))}(ot(),function Mt(){const t=Fe.lFrame;return f_(t.tView,t.selectedIndex)}(),r,t,n,r[Be],i,!1),ss}function Tf(t,n,i,r,o){const l=o?"class":"style";vf(t,i,n.inputs[l],l,r)}function vr(t,n,i,r){const o=se(),s=ot(),l=Ze+t,h=o[Be],p=s.firstCreatePass?function J1(t,n,i,r,o,s){const l=n.consts,p=Zo(n,t,2,r,gr(l,o));return gf(n,i,p,gr(l,s)),null!==p.attrs&&Lc(p,p.attrs,!1),null!==p.mergedAttrs&&Lc(p,p.mergedAttrs,!0),null!==n.queries&&n.queries.elementStart(n,p),p}(l,s,o,n,i,r):s.data[l],C=_0(s,o,p,h,n,t);o[l]=C;const D=Gl(p);return mi(p,!0),xv(h,C,p),32!=(32&p.flags)&&$l()&&fc(s,o,C,p),0===function ES(){return Fe.lFrame.elementDepthCount}()&&nn(C,o),function IS(){Fe.lFrame.elementDepthCount++}(),D&&(df(s,o,p),uf(s,p,o)),null!==r&&hf(o,p),vr}function yr(){let t=Qt();Xd()?function qd(){Fe.lFrame.isParent=!1}():(t=t.parent,mi(t,!1));const n=t;(function bS(t){return Fe.skipHydrationRootTNode===t})(n)&&function AS(){Fe.skipHydrationRootTNode=null}(),function DS(){Fe.lFrame.elementDepthCount--}();const i=ot();return i.firstCreatePass&&(Xl(i,t),jd(t)&&i.queries.elementEnd(t)),null!=n.classesWithoutHost&&function zS(t){return 0!=(8&t.flags)}(n)&&Tf(i,n,se(),n.classesWithoutHost,!0),null!=n.stylesWithoutHost&&function $S(t){return 0!=(16&t.flags)}(n)&&Tf(i,n,se(),n.stylesWithoutHost,!1),yr}function $r(t,n,i,r){return vr(t,n,i,r),yr(),$r}let _0=(t,n,i,r,o,s)=>(pr(!0),uc(r,o,function O_(){return Fe.lFrame.currentNamespace}()));function Of(t){return!!t&&"function"==typeof t.then}function w0(t){return!!t&&"function"==typeof t.subscribe}function Oa(t,n,i,r){const o=se(),s=ot(),l=Qt();return function E0(t,n,i,r,o,s,l){const h=Gl(r),C=t.firstCreatePass&&jy(t),D=n[Bt],T=By(n);let A=!0;if(3&r.type||l){const B=wn(r,n),k=l?l(B):B,U=T.length,V=l?ce=>l(It(ce[r.index])):r.index;let q=null;if(!l&&h&&(q=function sO(t,n,i,r){const o=t.cleanup;if(null!=o)for(let s=0;s<o.length-1;s+=2){const l=o[s];if(l===i&&o[s+1]===r){const h=n[vo],p=o[s+2];return h.length>p?h[p]:null}"string"==typeof l&&(s+=2)}return null}(t,n,o,r.index)),null!==q)(q.__ngLastListenerFn__||q).__ngNextListenerFn__=s,q.__ngLastListenerFn__=s,A=!1;else{s=D0(r,n,D,s,!1);const ce=i.listen(k,o,s);T.push(s,ce),C&&C.push(o,V,U,U+1)}}else s=D0(r,n,D,s,!1);const M=r.outputs;let P;if(A&&null!==M&&(P=M[o])){const B=P.length;if(B)for(let k=0;k<B;k+=2){const ge=n[P[k]][P[k+1]].subscribe(s),ve=T.length;T.push(s,ge),C&&C.push(o,r.index,ve,-(ve+1))}}}(s,o,o[Be],l,t,n,r),Oa}function I0(t,n,i,r){try{return pi(6,n,i),!1!==i(r)}catch(o){return Uy(t,o),!1}finally{pi(7,n,i)}}function D0(t,n,i,r,o){return function s(l){if(l===Function)return r;wa(t.componentOffset>-1?An(t.index,n):n);let p=I0(n,i,r,l),C=s.__ngNextListenerFn__;for(;C;)p=I0(n,i,C,l)&&p,C=C.__ngNextListenerFn__;return o&&!1===p&&l.preventDefault(),p}}function Ra(t,n=""){const i=se(),r=ot(),o=t+Ze,s=r.firstCreatePass?Zo(r,o,1,n,null):r.data[o],l=q0(r,i,s,n,t);i[o]=l,$l()&&fc(r,i,l,s),mi(s,!1)}let q0=(t,n,i,r,o)=>(pr(!0),function cc(t,n){return t.createText(n)}(n[Be],r));const cs="en-US";let vw=cs;class Zr{}class tR{}class Hf extends Zr{constructor(n,i,r){super(),this._parent=i,this._bootstrapComponents=[],this.destroyCbs=[],this.componentFactoryResolver=new Xy(this);const o=function xn(t,n){const i=t[Om]||null;if(!i&&!0===n)throw new Error(`Type ${Yt(t)} does not have '\u0275mod' property.`);return i}(n);this._bootstrapComponents=function ji(t){return t instanceof Function?t():t}(o.bootstrap),this._r3Injector=ly(n,i,[{provide:Zr,useValue:this},{provide:xc,useValue:this.componentFactoryResolver},...r],Yt(n),new Set(["environment"])),this._r3Injector.resolveInjectorInitializers(),this.instance=this._r3Injector.get(n)}get injector(){return this._r3Injector}destroy(){const n=this._r3Injector;!n.destroyed&&n.destroy(),this.destroyCbs.forEach(i=>i()),this.destroyCbs=null}onDestroy(n){this.destroyCbs.push(n)}}class Wf extends tR{constructor(n){super(),this.moduleType=n}create(n){return new Hf(this.moduleType,n,[])}}function zf(t,n,i,r){return function Kw(t,n,i,r,o,s){const l=n+i;return rn(t,l,o)?function wi(t,n,i){return t[n]=i}(t,l+1,s?r.call(s,o):r(o)):function Ba(t,n){const i=t[n];return i===Ue?void 0:i}(t,l+1)}(se(),function ln(){const t=Fe.lFrame;let n=t.bindingRootIndex;return-1===n&&(n=t.bindingRootIndex=t.tView.bindingStartIndex),n}(),t,n,i,r)}function MR(){return this._results[Symbol.iterator]()}class $f{static#e=Symbol.iterator;get changes(){return this._changes||(this._changes=new Bi)}constructor(n=!1){this._emitDistinctChangesOnly=n,this.dirty=!0,this._results=[],this._changesDetected=!1,this._changes=null,this.length=0,this.first=void 0,this.last=void 0;const i=$f.prototype;i[Symbol.iterator]||(i[Symbol.iterator]=MR)}get(n){return this._results[n]}map(n){return this._results.map(n)}filter(n){return this._results.filter(n)}find(n){return this._results.find(n)}reduce(n,i){return this._results.reduce(n,i)}forEach(n){this._results.forEach(n)}some(n){return this._results.some(n)}toArray(){return this._results.slice()}toString(){return this._results.toString()}reset(n,i){const r=this;r.dirty=!1;const o=function Hn(t){return t.flat(Number.POSITIVE_INFINITY)}(n);(this._changesDetected=!function lT(t,n,i){if(t.length!==n.length)return!1;for(let r=0;r<t.length;r++){let o=t[r],s=n[r];if(i&&(o=i(o),s=i(s)),s!==o)return!1}return!0}(r._results,o,i))&&(r._results=o,r.length=o.length,r.last=o[this.length-1],r.first=o[0])}notifyOnChanges(){this._changes&&(this._changesDetected||!this._emitDistinctChangesOnly)&&this._changes.emit(this)}setDirty(){this.dirty=!0}destroy(){this.changes.complete(),this.changes.unsubscribe()}}function LR(t,n,i,r=!0){const o=n[Ee];if(function KT(t,n,i,r){const o=Zt+r,s=i.length;r>0&&(i[o-1][ei]=n),r<s-Zt?(n[ei]=i[o],Y_(i,Zt+r,n)):(i.push(n),n[ei]=null),n[At]=i;const l=n[Ks];null!==l&&i!==l&&function QT(t,n){const i=t[Eo];n[jt]!==n[At][At][jt]&&(t[Ym]=!0),null===i?t[Eo]=[n]:i.push(n)}(l,n);const h=n[fi];null!==h&&h.insertView(t),n[Ge]|=128}(o,n,t,i),r){const s=Th(i,t),l=n[Be],h=hc(l,t[gi]);null!==h&&function XT(t,n,i,r,o,s){r[Ft]=o,r[tn]=n,ga(t,r,i,1,o,s)}(o,t[tn],l,n,h,s)}}let Ui=(()=>{class t{static#e=this.__NG_ELEMENT_ID__=NR}return t})();const FR=Ui,PR=class extends FR{constructor(n,i,r){super(),this._declarationLView=n,this._declarationTContainer=i,this.elementRef=r}get ssrId(){return this._declarationTContainer.tView?.ssrId||null}createEmbeddedView(n,i){return this.createEmbeddedViewImpl(n,i)}createEmbeddedViewImpl(n,i,r){const o=function RR(t,n,i,r){const o=n.tView,h=Mc(t,o,i,4096&t[Ge]?4096:16,null,n,null,null,null,r?.injector??null,r?.hydrationInfo??null);h[Ks]=t[n.index];const C=t[fi];return null!==C&&(h[fi]=C.createEmbeddedView(o)),yf(o,h,i),h}(this._declarationLView,this._declarationTContainer,n,{injector:i,hydrationInfo:r});return new Da(o)}};function NR(){return $c(Qt(),se())}function $c(t,n){return 4&t.type?new PR(n,t,zo(t,n)):null}let Ii=(()=>{class t{static#e=this.__NG_ELEMENT_ID__=GR}return t})();function GR(){return lC(Qt(),se())}const HR=Ii,sC=class extends HR{constructor(n,i,r){super(),this._lContainer=n,this._hostTNode=i,this._hostLView=r}get element(){return zo(this._hostTNode,this._hostLView)}get injector(){return new un(this._hostTNode,this._hostLView)}get parentInjector(){const n=Jl(this._hostTNode,this._hostLView);if(ih(n)){const i=sa(n,this._hostLView),r=oa(n);return new un(i[Ee].data[r+8],i)}return new un(null,this._hostLView)}clear(){for(;this.length>0;)this.remove(this.length-1)}get(n){const i=aC(this._lContainer);return null!==i&&i[n]||null}get length(){return this._lContainer.length-Zt}createEmbeddedView(n,i,r){let o,s;"number"==typeof r?o=r:null!=r&&(o=r.index,s=r.injector);const h=n.createEmbeddedViewImpl(i||{},s,null);return this.insertImpl(h,o,false),h}createComponent(n,i,r,o,s){const l=n&&!function la(t){return"function"==typeof t}(n);let h;if(l)h=i;else{const B=i||{};h=B.index,r=B.injector,o=B.projectableNodes,s=B.environmentInjector||B.ngModuleRef}const p=l?n:new ba(rt(n)),C=r||this.parentInjector;if(!s&&null==p.ngModule){const k=(l?C:this.parentInjector).get(Ni,null);k&&(s=k)}rt(p.componentType??{});const M=p.create(C,o,null,s);return this.insertImpl(M.hostView,h,false),M}insert(n,i){return this.insertImpl(n,i,!1)}insertImpl(n,i,r){const o=n._lView;if(function yS(t){return an(t[At])}(o)){const p=this.indexOf(n);if(-1!==p)this.detach(p);else{const C=o[At],D=new sC(C,C[tn],C[At]);D.detach(D.indexOf(n))}}const l=this._adjustIndex(i),h=this._lContainer;return LR(h,o,l,!r),n.attachToViewContainerRef(),Y_(Xf(h),l,n),n}move(n,i){return this.insert(n,i)}indexOf(n){const i=aC(this._lContainer);return null!==i?i.indexOf(n):-1}remove(n){const i=this._adjustIndex(n,-1),r=dc(this._lContainer,i);r&&(tc(Xf(this._lContainer),i),Ih(r[Ee],r))}detach(n){const i=this._adjustIndex(n,-1),r=dc(this._lContainer,i);return r&&null!=tc(Xf(this._lContainer),i)?new Da(r):null}_adjustIndex(n,i=0){return n??this.length+i}};function aC(t){return t[8]}function Xf(t){return t[8]||(t[8]=[])}function lC(t,n){let i;const r=n[t.index];return an(r)?i=r:(i=Ny(r,n,null,t),n[t.index]=i,Rc(n,i)),cC(i,n,t,r),new sC(i,t,n)}let cC=function uC(t,n,i,r){if(t[gi])return;let o;o=8&i.type?It(r):function WR(t,n){const i=t[Be],r=i.createComment(""),o=wn(n,t);return Wr(i,hc(i,o),r,function nx(t,n){return t.nextSibling(n)}(i,o),!1),r}(n,i),t[gi]=o};class qf{constructor(n){this.queryList=n,this.matches=null}clone(){return new qf(this.queryList)}setDirty(){this.queryList.setDirty()}}class Zf{constructor(n=[]){this.queries=n}createEmbeddedView(n){const i=n.queries;if(null!==i){const r=null!==n.contentQueries?n.contentQueries[0]:i.length,o=[];for(let s=0;s<r;s++){const l=i.getByIndex(s);o.push(this.queries[l.indexInDeclarationView].clone())}return new Zf(o)}return null}insertView(n){this.dirtyQueriesWithMatches(n)}detachView(n){this.dirtyQueriesWithMatches(n)}dirtyQueriesWithMatches(n){for(let i=0;i<this.queries.length;i++)null!==pC(n,i).matches&&this.queries[i].setDirty()}}class dC{constructor(n,i,r=null){this.predicate=n,this.flags=i,this.read=r}}class Kf{constructor(n=[]){this.queries=n}elementStart(n,i){for(let r=0;r<this.queries.length;r++)this.queries[r].elementStart(n,i)}elementEnd(n){for(let i=0;i<this.queries.length;i++)this.queries[i].elementEnd(n)}embeddedTView(n){let i=null;for(let r=0;r<this.length;r++){const o=null!==i?i.length:0,s=this.getByIndex(r).embeddedTView(n,o);s&&(s.indexInDeclarationView=r,null!==i?i.push(s):i=[s])}return null!==i?new Kf(i):null}template(n,i){for(let r=0;r<this.queries.length;r++)this.queries[r].template(n,i)}getByIndex(n){return this.queries[n]}get length(){return this.queries.length}track(n){this.queries.push(n)}}class Qf{constructor(n,i=-1){this.metadata=n,this.matches=null,this.indexInDeclarationView=-1,this.crossesNgTemplate=!1,this._appliesToNextNode=!0,this._declarationNodeIndex=i}elementStart(n,i){this.isApplyingToNode(i)&&this.matchTNode(n,i)}elementEnd(n){this._declarationNodeIndex===n.index&&(this._appliesToNextNode=!1)}template(n,i){this.elementStart(n,i)}embeddedTView(n,i){return this.isApplyingToNode(n)?(this.crossesNgTemplate=!0,this.addMatch(-n.index,i),new Qf(this.metadata)):null}isApplyingToNode(n){if(this._appliesToNextNode&&1!=(1&this.metadata.flags)){const i=this._declarationNodeIndex;let r=n.parent;for(;null!==r&&8&r.type&&r.index!==i;)r=r.parent;return i===(null!==r?r.index:-1)}return this._appliesToNextNode}matchTNode(n,i){const r=this.metadata.predicate;if(Array.isArray(r))for(let o=0;o<r.length;o++){const s=r[o];this.matchTNodeWithReadOption(n,i,$R(i,s)),this.matchTNodeWithReadOption(n,i,ec(i,n,s,!1,!1))}else r===Ui?4&i.type&&this.matchTNodeWithReadOption(n,i,-1):this.matchTNodeWithReadOption(n,i,ec(i,n,r,!1,!1))}matchTNodeWithReadOption(n,i,r){if(null!==r){const o=this.metadata.read;if(null!==o)if(o===$o||o===Ii||o===Ui&&4&i.type)this.addMatch(i.index,-2);else{const s=ec(i,n,o,!1,!1);null!==s&&this.addMatch(i.index,s)}else this.addMatch(i.index,r)}}addMatch(n,i){null===this.matches?this.matches=[n,i]:this.matches.push(n,i)}}function $R(t,n){const i=t.localNames;if(null!==i)for(let r=0;r<i.length;r+=2)if(i[r]===n)return i[r+1];return null}function qR(t,n,i,r){return-1===i?function XR(t,n){return 11&t.type?zo(t,n):4&t.type?$c(t,n):null}(n,t):-2===i?function ZR(t,n,i){return i===$o?zo(n,t):i===Ui?$c(n,t):i===Ii?lC(n,t):void 0}(t,n,r):Hr(t,t[Ee],i,n)}function hC(t,n,i,r){const o=n[fi].queries[r];if(null===o.matches){const s=t.data,l=i.matches,h=[];for(let p=0;p<l.length;p+=2){const C=l[p];h.push(C<0?null:qR(n,s[C],l[p+1],i.metadata.read))}o.matches=h}return o.matches}function Jf(t,n,i,r){const o=t.queries.getByIndex(i),s=o.matches;if(null!==s){const l=hC(t,n,o,i);for(let h=0;h<s.length;h+=2){const p=s[h];if(p>0)r.push(l[h/2]);else{const C=s[h+1],D=n[-p];for(let T=Zt;T<D.length;T++){const A=D[T];A[Ks]===A[At]&&Jf(A[Ee],A,C,r)}if(null!==D[Eo]){const T=D[Eo];for(let A=0;A<T.length;A++){const M=T[A];Jf(M[Ee],M,C,r)}}}}}return r}function eg(t){const n=se(),i=ot(),r=D_();Qd(r+1);const o=pC(i,r);if(t.dirty&&function _S(t){return 4==(4&t[Ge])}(n)===(2==(2&o.metadata.flags))){if(null===o.matches)t.reset([]);else{const s=o.crossesNgTemplate?Jf(i,n,r,[]):hC(i,n,o,r);t.reset(s,iA),t.notifyOnChanges()}return!0}return!1}function tg(t,n,i){const r=ot();r.firstCreatePass&&(function gC(t,n,i){null===t.queries&&(t.queries=new Kf),t.queries.track(new Qf(n,i))}(r,new dC(t,n,i),-1),2==(2&n)&&(r.staticViewQueries=!0)),function fC(t,n,i){const r=new $f(4==(4&i));(function kA(t,n,i,r){const o=By(n);o.push(i),t.firstCreatePass&&jy(t).push(r,o.length-1)})(t,n,r,r.destroy),null===n[fi]&&(n[fi]=new Zf),n[fi].queries.push(new qf(r))}(r,se(),n)}function ng(){return function QR(t,n){return t[fi].queries[n].queryList}(se(),D_())}function pC(t,n){return t.queries.getByIndex(n)}const CL=new Ne("Application Initializer");let ag=(()=>{class t{constructor(){this.initialized=!1,this.done=!1,this.donePromise=new Promise((i,r)=>{this.resolve=i,this.reject=r}),this.appInits=Et(CL,{optional:!0})??[]}runInitializers(){if(this.initialized)return;const i=[];for(const o of this.appInits){const s=o();if(Of(s))i.push(s);else if(w0(s)){const l=new Promise((h,p)=>{s.subscribe({complete:h,error:p})});i.push(l)}}const r=()=>{this.done=!0,this.resolve()};Promise.all(i).then(()=>{r()}).catch(o=>{this.reject(o)}),0===i.length&&r(),this.initialized=!0}static#e=this.\u0275fac=function(r){return new(r||t)};static#t=this.\u0275prov=vt({token:t,factory:t.\u0275fac,providedIn:"root"})}return t})();const Gi=new Ne("LocaleId",{providedIn:"root",factory:()=>Et(Gi,et.Optional|et.SkipSelf)||function IL(){return typeof $localize<"u"&&$localize.locale||cs}()});let SL=(()=>{class t{constructor(){this.taskId=0,this.pendingTasks=new Set,this.hasPendingTasks=new fb(!1)}add(){this.hasPendingTasks.next(!0);const i=this.taskId++;return this.pendingTasks.add(i),i}remove(i){this.pendingTasks.delete(i),0===this.pendingTasks.size&&this.hasPendingTasks.next(!1)}ngOnDestroy(){this.pendingTasks.clear(),this.hasPendingTasks.next(!1)}static#e=this.\u0275fac=function(r){return new(r||t)};static#t=this.\u0275prov=vt({token:t,factory:t.\u0275fac,providedIn:"root"})}return t})();const NC=new Ne(""),Kc=new Ne("");let hg,ug=(()=>{class t{constructor(i,r,o){this._ngZone=i,this.registry=r,this._pendingCount=0,this._isZoneStable=!0,this._didWork=!1,this._callbacks=[],this.taskTrackingZone=null,hg||(function qL(t){hg=t}(o),o.addToWindow(r)),this._watchAngularEvents(),i.run(()=>{this.taskTrackingZone=typeof Zone>"u"?null:Zone.current.get("TaskTrackingZone")})}_watchAngularEvents(){this._ngZone.onUnstable.subscribe({next:()=>{this._didWork=!0,this._isZoneStable=!1}}),this._ngZone.runOutsideAngular(()=>{this._ngZone.onStable.subscribe({next:()=>{Pt.assertNotInAngularZone(),queueMicrotask(()=>{this._isZoneStable=!0,this._runCallbacksIfReady()})}})})}increasePendingRequestCount(){return this._pendingCount+=1,this._didWork=!0,this._pendingCount}decreasePendingRequestCount(){if(this._pendingCount-=1,this._pendingCount<0)throw new Error("pending async requests below zero");return this._runCallbacksIfReady(),this._pendingCount}isStable(){return this._isZoneStable&&0===this._pendingCount&&!this._ngZone.hasPendingMacrotasks}_runCallbacksIfReady(){if(this.isStable())queueMicrotask(()=>{for(;0!==this._callbacks.length;){let i=this._callbacks.pop();clearTimeout(i.timeoutId),i.doneCb(this._didWork)}this._didWork=!1});else{let i=this.getPendingTasks();this._callbacks=this._callbacks.filter(r=>!r.updateCb||!r.updateCb(i)||(clearTimeout(r.timeoutId),!1)),this._didWork=!0}}getPendingTasks(){return this.taskTrackingZone?this.taskTrackingZone.macroTasks.map(i=>({source:i.source,creationLocation:i.creationLocation,data:i.data})):[]}addCallback(i,r,o){let s=-1;r&&r>0&&(s=setTimeout(()=>{this._callbacks=this._callbacks.filter(l=>l.timeoutId!==s),i(this._didWork,this.getPendingTasks())},r)),this._callbacks.push({doneCb:i,timeoutId:s,updateCb:o})}whenStable(i,r,o){if(o&&!this.taskTrackingZone)throw new Error('Task tracking zone is required when passing an update callback to whenStable(). Is "zone.js/plugins/task-tracking" loaded?');this.addCallback(i,r,o),this._runCallbacksIfReady()}getPendingRequestCount(){return this._pendingCount}registerApplication(i){this.registry.registerApplication(i,this)}unregisterApplication(i){this.registry.unregisterApplication(i)}findProviders(i,r,o){return[]}static#e=this.\u0275fac=function(r){return new(r||t)(it(Pt),it(dg),it(Kc))};static#t=this.\u0275prov=vt({token:t,factory:t.\u0275fac})}return t})(),dg=(()=>{class t{constructor(){this._applications=new Map}registerApplication(i,r){this._applications.set(i,r)}unregisterApplication(i){this._applications.delete(i)}unregisterAllApplications(){this._applications.clear()}getTestability(i){return this._applications.get(i)||null}getAllTestabilities(){return Array.from(this._applications.values())}getAllRootElements(){return Array.from(this._applications.keys())}findTestabilityInTree(i,r=!0){return hg?.findTestabilityInTree(this,i,r)??null}static#e=this.\u0275fac=function(r){return new(r||t)};static#t=this.\u0275prov=vt({token:t,factory:t.\u0275fac,providedIn:"platform"})}return t})(),Cr=null;const kC=new Ne("AllowMultipleToken"),fg=new Ne("PlatformDestroyListeners"),BC=new Ne("appBootstrapListener");function UC(t,n,i=[]){const r=`Platform: ${n}`,o=new Ne(r);return(s=[])=>{let l=gg();if(!l||l.injector.get(kC,!1)){const h=[...i,...s,{provide:o,useValue:!0}];t?t(h):function QL(t){if(Cr&&!Cr.get(kC,!1))throw new De(400,!1);(function jC(){!function rS(t){i_=t}(()=>{throw new De(600,!1)})})(),Cr=t;const n=t.get(HC);(function VC(t){t.get(qv,null)?.forEach(i=>i())})(t)}(function GC(t=[],n){return vi.create({name:n,providers:[{provide:jh,useValue:"platform"},{provide:fg,useValue:new Set([()=>Cr=null])},...t]})}(h,r))}return function eF(t){const n=gg();if(!n)throw new De(401,!1);return n}()}}function gg(){return Cr?.get(HC)??null}let HC=(()=>{class t{constructor(i){this._injector=i,this._modules=[],this._destroyListeners=[],this._destroyed=!1}bootstrapModuleFactory(i,r){const o=function tF(t="zone.js",n){return"noop"===t?new vA:"zone.js"===t?new Pt(n):t}(r?.ngZone,function WC(t){return{enableLongStackTrace:!1,shouldCoalesceEventChangeDetection:t?.eventCoalescing??!1,shouldCoalesceRunChangeDetection:t?.runCoalescing??!1}}({eventCoalescing:r?.ngZoneEventCoalescing,runCoalescing:r?.ngZoneRunCoalescing}));return o.run(()=>{const s=function iR(t,n,i){return new Hf(t,n,i)}(i.moduleType,this.injector,function qC(t){return[{provide:Pt,useFactory:t},{provide:vc,multi:!0,useFactory:()=>{const n=Et(iF,{optional:!0});return()=>n.initialize()}},{provide:XC,useFactory:nF},{provide:fy,useFactory:gy}]}(()=>o)),l=s.injector.get(ki,null);return o.runOutsideAngular(()=>{const h=o.onError.subscribe({next:p=>{l.handleError(p)}});s.onDestroy(()=>{Qc(this._modules,s),h.unsubscribe()})}),function YC(t,n,i){try{const r=i();return Of(r)?r.catch(o=>{throw n.runOutsideAngular(()=>t.handleError(o)),o}):r}catch(r){throw n.runOutsideAngular(()=>t.handleError(r)),r}}(l,o,()=>{const h=s.injector.get(ag);return h.runInitializers(),h.donePromise.then(()=>(function yw(t){Vn(t,"Expected localeId to be defined"),"string"==typeof t&&(vw=t.toLowerCase().replace(/_/g,"-"))}(s.injector.get(Gi,cs)||cs),this._moduleDoBootstrap(s),s))})})}bootstrapModule(i,r=[]){const o=zC({},r);return function ZL(t,n,i){const r=new Wf(i);return Promise.resolve(r)}(0,0,i).then(s=>this.bootstrapModuleFactory(s,o))}_moduleDoBootstrap(i){const r=i.injector.get(Ga);if(i._bootstrapComponents.length>0)i._bootstrapComponents.forEach(o=>r.bootstrap(o));else{if(!i.instance.ngDoBootstrap)throw new De(-403,!1);i.instance.ngDoBootstrap(r)}this._modules.push(i)}onDestroy(i){this._destroyListeners.push(i)}get injector(){return this._injector}destroy(){if(this._destroyed)throw new De(404,!1);this._modules.slice().forEach(r=>r.destroy()),this._destroyListeners.forEach(r=>r());const i=this._injector.get(fg,null);i&&(i.forEach(r=>r()),i.clear()),this._destroyed=!0}get destroyed(){return this._destroyed}static#e=this.\u0275fac=function(r){return new(r||t)(it(vi))};static#t=this.\u0275prov=vt({token:t,factory:t.\u0275fac,providedIn:"platform"})}return t})();function zC(t,n){return Array.isArray(n)?n.reduce(zC,t):{...t,...n}}let Ga=(()=>{class t{constructor(){this._bootstrapListeners=[],this._runningTick=!1,this._destroyed=!1,this._destroyListeners=[],this._views=[],this.internalErrorHandler=Et(XC),this.zoneIsStable=Et(fy),this.componentTypes=[],this.components=[],this.isStable=Et(SL).hasPendingTasks.pipe(function pb(t,n){return kr((i,r)=>{let o=null,s=0,l=!1;const h=()=>l&&!o&&r.complete();i.subscribe(Br(r,p=>{o?.unsubscribe();let C=0;const D=s++;Ai(t(p,D)).subscribe(o=Br(r,T=>r.next(n?n(p,T,D,C++):T),()=>{o=null,h()}))},()=>{l=!0,h()}))})}(i=>i?function gb(...t){return wm(t,mm(t))}(!1):this.zoneIsStable),function mb(t,n=pd){return t=t??_b,kr((i,r)=>{let o,s=!0;i.subscribe(Br(r,l=>{const h=n(l);(s||!t(o,h))&&(s=!1,o=h,r.next(l))}))})}(),Cm()),this._injector=Et(Ni)}get destroyed(){return this._destroyed}get injector(){return this._injector}bootstrap(i,r){const o=i instanceof ey;if(!this._injector.get(ag).done)throw!o&&function Xs(t){const n=rt(t)||qt(t)||sn(t);return null!==n&&n.standalone}(i),new De(405,!1);let l;l=o?i:this._injector.get(xc).resolveComponentFactory(i),this.componentTypes.push(l.componentType);const h=function KL(t){return t.isBoundToModule}(l)?void 0:this._injector.get(Zr),C=l.create(vi.NULL,[],r||l.selector,h),D=C.location.nativeElement,T=C.injector.get(NC,null);return T?.registerApplication(D),C.onDestroy(()=>{this.detachView(C.hostView),Qc(this.components,C),T?.unregisterApplication(D)}),this._loadComponent(C),C}tick(){if(this._runningTick)throw new De(101,!1);try{this._runningTick=!0;for(let i of this._views)i.detectChanges()}catch(i){this.internalErrorHandler(i)}finally{this._runningTick=!1}}attachView(i){const r=i;this._views.push(r),r.attachToAppRef(this)}detachView(i){const r=i;Qc(this._views,r),r.detachFromAppRef()}_loadComponent(i){this.attachView(i.hostView),this.tick(),this.components.push(i);const r=this._injector.get(BC,[]);r.push(...this._bootstrapListeners),r.forEach(o=>o(i))}ngOnDestroy(){if(!this._destroyed)try{this._destroyListeners.forEach(i=>i()),this._views.slice().forEach(i=>i.destroy())}finally{this._destroyed=!0,this._views=[],this._bootstrapListeners=[],this._destroyListeners=[]}}onDestroy(i){return this._destroyListeners.push(i),()=>Qc(this._destroyListeners,i)}destroy(){if(this._destroyed)throw new De(406,!1);const i=this._injector;i.destroy&&!i.destroyed&&i.destroy()}get viewCount(){return this._views.length}warnIfDestroyed(){}static#e=this.\u0275fac=function(r){return new(r||t)};static#t=this.\u0275prov=vt({token:t,factory:t.\u0275fac,providedIn:"root"})}return t})();function Qc(t,n){const i=t.indexOf(n);i>-1&&t.splice(i,1)}const XC=new Ne("",{providedIn:"root",factory:()=>Et(ki).handleError.bind(void 0)});function nF(){const t=Et(Pt),n=Et(ki);return i=>t.runOutsideAngular(()=>n.handleError(i))}let iF=(()=>{class t{constructor(){this.zone=Et(Pt),this.applicationRef=Et(Ga)}initialize(){this._onMicrotaskEmptySubscription||(this._onMicrotaskEmptySubscription=this.zone.onMicrotaskEmpty.subscribe({next:()=>{this.zone.run(()=>{this.applicationRef.tick()})}}))}ngOnDestroy(){this._onMicrotaskEmptySubscription?.unsubscribe()}static#e=this.\u0275fac=function(r){return new(r||t)};static#t=this.\u0275prov=vt({token:t,factory:t.\u0275fac,providedIn:"root"})}return t})();class nE{constructor(){}supports(n){return n instanceof Map||wf(n)}create(){return new mF}}class mF{constructor(){this._records=new Map,this._mapHead=null,this._appendAfter=null,this._previousMapHead=null,this._changesHead=null,this._changesTail=null,this._additionsHead=null,this._additionsTail=null,this._removalsHead=null,this._removalsTail=null}get isDirty(){return null!==this._additionsHead||null!==this._changesHead||null!==this._removalsHead}forEachItem(n){let i;for(i=this._mapHead;null!==i;i=i._next)n(i)}forEachPreviousItem(n){let i;for(i=this._previousMapHead;null!==i;i=i._nextPrevious)n(i)}forEachChangedItem(n){let i;for(i=this._changesHead;null!==i;i=i._nextChanged)n(i)}forEachAddedItem(n){let i;for(i=this._additionsHead;null!==i;i=i._nextAdded)n(i)}forEachRemovedItem(n){let i;for(i=this._removalsHead;null!==i;i=i._nextRemoved)n(i)}diff(n){if(n){if(!(n instanceof Map||wf(n)))throw new De(900,!1)}else n=new Map;return this.check(n)?this:null}onDestroy(){}check(n){this._reset();let i=this._mapHead;if(this._appendAfter=null,this._forEach(n,(r,o)=>{if(i&&i.key===o)this._maybeAddToChanges(i,r),this._appendAfter=i,i=i._next;else{const s=this._getOrCreateRecordForKey(o,r);i=this._insertBeforeOrAppend(i,s)}}),i){i._prev&&(i._prev._next=null),this._removalsHead=i;for(let r=i;null!==r;r=r._nextRemoved)r===this._mapHead&&(this._mapHead=null),this._records.delete(r.key),r._nextRemoved=r._next,r.previousValue=r.currentValue,r.currentValue=null,r._prev=null,r._next=null}return this._changesTail&&(this._changesTail._nextChanged=null),this._additionsTail&&(this._additionsTail._nextAdded=null),this.isDirty}_insertBeforeOrAppend(n,i){if(n){const r=n._prev;return i._next=n,i._prev=r,n._prev=i,r&&(r._next=i),n===this._mapHead&&(this._mapHead=i),this._appendAfter=n,n}return this._appendAfter?(this._appendAfter._next=i,i._prev=this._appendAfter):this._mapHead=i,this._appendAfter=i,null}_getOrCreateRecordForKey(n,i){if(this._records.has(n)){const o=this._records.get(n);this._maybeAddToChanges(o,i);const s=o._prev,l=o._next;return s&&(s._next=l),l&&(l._prev=s),o._next=null,o._prev=null,o}const r=new _F(n);return this._records.set(n,r),r.currentValue=i,this._addToAdditions(r),r}_reset(){if(this.isDirty){let n;for(this._previousMapHead=this._mapHead,n=this._previousMapHead;null!==n;n=n._next)n._nextPrevious=n._next;for(n=this._changesHead;null!==n;n=n._nextChanged)n.previousValue=n.currentValue;for(n=this._additionsHead;null!=n;n=n._nextAdded)n.previousValue=n.currentValue;this._changesHead=this._changesTail=null,this._additionsHead=this._additionsTail=null,this._removalsHead=null}}_maybeAddToChanges(n,i){Object.is(i,n.currentValue)||(n.previousValue=n.currentValue,n.currentValue=i,this._addToChanges(n))}_addToAdditions(n){null===this._additionsHead?this._additionsHead=this._additionsTail=n:(this._additionsTail._nextAdded=n,this._additionsTail=n)}_addToChanges(n){null===this._changesHead?this._changesHead=this._changesTail=n:(this._changesTail._nextChanged=n,this._changesTail=n)}_forEach(n,i){n instanceof Map?n.forEach(i):Object.keys(n).forEach(r=>i(n[r],r))}}class _F{constructor(n){this.key=n,this.previousValue=null,this.currentValue=null,this._nextPrevious=null,this._next=null,this._prev=null,this._nextAdded=null,this._nextRemoved=null,this._nextChanged=null}}function rE(){return new Ha([new nE])}let Ha=(()=>{class t{static#e=this.\u0275prov=vt({token:t,providedIn:"root",factory:rE});constructor(i){this.factories=i}static create(i,r){if(r){const o=r.factories.slice();i=i.concat(o)}return new t(i)}static extend(i){return{provide:t,useFactory:r=>t.create(i,r||rE()),deps:[[t,new fh,new hh]]}}find(i){const r=this.factories.find(o=>o.supports(i));if(r)return r;throw new De(901,!1)}}return t})();const wF=UC(null,"core",[]);let CF=(()=>{class t{constructor(i){}static#e=this.\u0275fac=function(r){return new(r||t)(it(Ga))};static#t=this.\u0275mod=$s({type:t});static#n=this.\u0275inj=mo({})}return t})(),wg=null;function Cg(){return wg}class FF{}const Qr=new Ne("DocumentToken");let DE=(()=>{class t{constructor(i,r){this._viewContainer=i,this._context=new bP,this._thenTemplateRef=null,this._elseTemplateRef=null,this._thenViewRef=null,this._elseViewRef=null,this._thenTemplateRef=r}set ngIf(i){this._context.$implicit=this._context.ngIf=i,this._updateView()}set ngIfThen(i){bE("ngIfThen",i),this._thenTemplateRef=i,this._thenViewRef=null,this._updateView()}set ngIfElse(i){bE("ngIfElse",i),this._elseTemplateRef=i,this._elseViewRef=null,this._updateView()}_updateView(){this._context.$implicit?this._thenViewRef||(this._viewContainer.clear(),this._elseViewRef=null,this._thenTemplateRef&&(this._thenViewRef=this._viewContainer.createEmbeddedView(this._thenTemplateRef,this._context))):this._elseViewRef||(this._viewContainer.clear(),this._thenViewRef=null,this._elseTemplateRef&&(this._elseViewRef=this._viewContainer.createEmbeddedView(this._elseTemplateRef,this._context)))}static ngTemplateContextGuard(i,r){return!0}static#e=this.\u0275fac=function(r){return new(r||t)(ze(Ii),ze(Ui))};static#t=this.\u0275dir=Un({type:t,selectors:[["","ngIf",""]],inputs:{ngIf:"ngIf",ngIfThen:"ngIfThen",ngIfElse:"ngIfElse"},standalone:!0})}return t})();class bP{constructor(){this.$implicit=null,this.ngIf=null}}function bE(t,n){if(n&&!n.createEmbeddedView)throw new Error(`${t} must be a TemplateRef, but received '${Yt(n)}'.`)}let TE=(()=>{class t{constructor(i,r,o){this._ngEl=i,this._differs=r,this._renderer=o,this._ngStyle=null,this._differ=null}set ngStyle(i){this._ngStyle=i,!this._differ&&i&&(this._differ=this._differs.find(i).create())}ngDoCheck(){if(this._differ){const i=this._differ.diff(this._ngStyle);i&&this._applyChanges(i)}}_setStyle(i,r){const[o,s]=i.split("."),l=-1===o.indexOf("-")?void 0:mr.DashCase;null!=r?this._renderer.setStyle(this._ngEl.nativeElement,o,s?`${r}${s}`:r,l):this._renderer.removeStyle(this._ngEl.nativeElement,o,l)}_applyChanges(i){i.forEachRemovedItem(r=>this._setStyle(r.key,null)),i.forEachAddedItem(r=>this._setStyle(r.key,r.currentValue)),i.forEachChangedItem(r=>this._setStyle(r.key,r.currentValue))}static#e=this.\u0275fac=function(r){return new(r||t)(ze($o),ze(Ha),ze(iy))};static#t=this.\u0275dir=Un({type:t,selectors:[["","ngStyle",""]],inputs:{ngStyle:"ngStyle"},standalone:!0})}return t})(),KP=(()=>{class t{static#e=this.\u0275fac=function(r){return new(r||t)};static#t=this.\u0275mod=$s({type:t});static#n=this.\u0275inj=mo({})}return t})();function OE(t){return"server"===t}class bN extends FF{constructor(){super(...arguments),this.supportsDOMEvents=!0}}class Bg extends bN{static makeCurrent(){!function LF(t){wg||(wg=t)}(new Bg)}onAndCancel(n,i,r){return n.addEventListener(i,r),()=>{n.removeEventListener(i,r)}}dispatchEvent(n,i){n.dispatchEvent(i)}remove(n){n.parentNode&&n.parentNode.removeChild(n)}createElement(n,i){return(i=i||this.getDefaultDocument()).createElement(n)}createHtmlDocument(){return document.implementation.createHTMLDocument("fakeTitle")}getDefaultDocument(){return document}isElementNode(n){return n.nodeType===Node.ELEMENT_NODE}isShadowRoot(n){return n instanceof DocumentFragment}getGlobalEventTarget(n,i){return"window"===i?window:"document"===i?n:"body"===i?n.body:null}getBaseHref(n){const i=function SN(){return $a=$a||document.querySelector("base"),$a?$a.getAttribute("href"):null}();return null==i?null:function TN(t){pu=pu||document.createElement("a"),pu.setAttribute("href",t);const n=pu.pathname;return"/"===n.charAt(0)?n:`/${n}`}(i)}resetBaseElement(){$a=null}getUserAgent(){return window.navigator.userAgent}getCookie(n){return function wP(t,n){n=encodeURIComponent(n);for(const i of t.split(";")){const r=i.indexOf("="),[o,s]=-1==r?[i,""]:[i.slice(0,r),i.slice(r+1)];if(o.trim()===n)return decodeURIComponent(s)}return null}(document.cookie,n)}}let pu,$a=null,AN=(()=>{class t{build(){return new XMLHttpRequest}static#e=this.\u0275fac=function(r){return new(r||t)};static#t=this.\u0275prov=vt({token:t,factory:t.\u0275fac})}return t})();const jg=new Ne("EventManagerPlugins");let PE=(()=>{class t{constructor(i,r){this._zone=r,this._eventNameToPlugin=new Map,i.forEach(o=>{o.manager=this}),this._plugins=i.slice().reverse()}addEventListener(i,r,o){return this._findPluginFor(r).addEventListener(i,r,o)}getZone(){return this._zone}_findPluginFor(i){let r=this._eventNameToPlugin.get(i);if(r)return r;if(r=this._plugins.find(s=>s.supports(i)),!r)throw new De(5101,!1);return this._eventNameToPlugin.set(i,r),r}static#e=this.\u0275fac=function(r){return new(r||t)(it(jg),it(Pt))};static#t=this.\u0275prov=vt({token:t,factory:t.\u0275fac})}return t})();class NE{constructor(n){this._doc=n}}const Vg="ng-app-id";let kE=(()=>{class t{constructor(i,r,o,s={}){this.doc=i,this.appId=r,this.nonce=o,this.platformId=s,this.styleRef=new Map,this.hostNodes=new Set,this.styleNodesInDOM=this.collectServerRenderedStyles(),this.platformIsServer=OE(s),this.resetHostNodes()}addStyles(i){for(const r of i)1===this.changeUsageCount(r,1)&&this.onStyleAdded(r)}removeStyles(i){for(const r of i)this.changeUsageCount(r,-1)<=0&&this.onStyleRemoved(r)}ngOnDestroy(){const i=this.styleNodesInDOM;i&&(i.forEach(r=>r.remove()),i.clear());for(const r of this.getAllStyles())this.onStyleRemoved(r);this.resetHostNodes()}addHost(i){this.hostNodes.add(i);for(const r of this.getAllStyles())this.addStyleToHost(i,r)}removeHost(i){this.hostNodes.delete(i)}getAllStyles(){return this.styleRef.keys()}onStyleAdded(i){for(const r of this.hostNodes)this.addStyleToHost(r,i)}onStyleRemoved(i){const r=this.styleRef;r.get(i)?.elements?.forEach(o=>o.remove()),r.delete(i)}collectServerRenderedStyles(){const i=this.doc.head?.querySelectorAll(`style[${Vg}="${this.appId}"]`);if(i?.length){const r=new Map;return i.forEach(o=>{null!=o.textContent&&r.set(o.textContent,o)}),r}return null}changeUsageCount(i,r){const o=this.styleRef;if(o.has(i)){const s=o.get(i);return s.usage+=r,s.usage}return o.set(i,{usage:r,elements:[]}),r}getStyleElement(i,r){const o=this.styleNodesInDOM,s=o?.get(r);if(s?.parentNode===i)return o.delete(r),s.removeAttribute(Vg),s;{const l=this.doc.createElement("style");return this.nonce&&l.setAttribute("nonce",this.nonce),l.textContent=r,this.platformIsServer&&l.setAttribute(Vg,this.appId),l}}addStyleToHost(i,r){const o=this.getStyleElement(i,r);i.appendChild(o);const s=this.styleRef,l=s.get(r)?.elements;l?l.push(o):s.set(r,{elements:[o],usage:1})}resetHostNodes(){const i=this.hostNodes;i.clear(),i.add(this.doc.head)}static#e=this.\u0275fac=function(r){return new(r||t)(it(Qr),it(Ec),it(Zv,8),it(Ho))};static#t=this.\u0275prov=vt({token:t,factory:t.\u0275fac})}return t})();const Ug={svg:"http://www.w3.org/2000/svg",xhtml:"http://www.w3.org/1999/xhtml",xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/",math:"http://www.w3.org/1998/MathML/"},Gg=/%COMP%/g,LN=new Ne("RemoveStylesOnCompDestroy",{providedIn:"root",factory:()=>!1});function jE(t,n){return n.map(i=>i.replace(Gg,t))}let VE=(()=>{class t{constructor(i,r,o,s,l,h,p,C=null){this.eventManager=i,this.sharedStylesHost=r,this.appId=o,this.removeStylesOnCompDestroy=s,this.doc=l,this.platformId=h,this.ngZone=p,this.nonce=C,this.rendererByCompId=new Map,this.platformIsServer=OE(h),this.defaultRenderer=new Hg(i,l,p,this.platformIsServer)}createRenderer(i,r){if(!i||!r)return this.defaultRenderer;this.platformIsServer&&r.encapsulation===Qn.ShadowDom&&(r={...r,encapsulation:Qn.Emulated});const o=this.getOrCreateRenderer(i,r);return o instanceof GE?o.applyToHost(i):o instanceof Wg&&o.applyStyles(),o}getOrCreateRenderer(i,r){const o=this.rendererByCompId;let s=o.get(r.id);if(!s){const l=this.doc,h=this.ngZone,p=this.eventManager,C=this.sharedStylesHost,D=this.removeStylesOnCompDestroy,T=this.platformIsServer;switch(r.encapsulation){case Qn.Emulated:s=new GE(p,C,r,this.appId,D,l,h,T);break;case Qn.ShadowDom:return new kN(p,C,i,r,l,h,this.nonce,T);default:s=new Wg(p,C,r,D,l,h,T)}o.set(r.id,s)}return s}ngOnDestroy(){this.rendererByCompId.clear()}static#e=this.\u0275fac=function(r){return new(r||t)(it(PE),it(kE),it(Ec),it(LN),it(Qr),it(Ho),it(Pt),it(Zv))};static#t=this.\u0275prov=vt({token:t,factory:t.\u0275fac})}return t})();class Hg{constructor(n,i,r,o){this.eventManager=n,this.doc=i,this.ngZone=r,this.platformIsServer=o,this.data=Object.create(null),this.destroyNode=null}destroy(){}createElement(n,i){return i?this.doc.createElementNS(Ug[i]||i,n):this.doc.createElement(n)}createComment(n){return this.doc.createComment(n)}createText(n){return this.doc.createTextNode(n)}appendChild(n,i){(UE(n)?n.content:n).appendChild(i)}insertBefore(n,i,r){n&&(UE(n)?n.content:n).insertBefore(i,r)}removeChild(n,i){n&&n.removeChild(i)}selectRootElement(n,i){let r="string"==typeof n?this.doc.querySelector(n):n;if(!r)throw new De(-5104,!1);return i||(r.textContent=""),r}parentNode(n){return n.parentNode}nextSibling(n){return n.nextSibling}setAttribute(n,i,r,o){if(o){i=o+":"+i;const s=Ug[o];s?n.setAttributeNS(s,i,r):n.setAttribute(i,r)}else n.setAttribute(i,r)}removeAttribute(n,i,r){if(r){const o=Ug[r];o?n.removeAttributeNS(o,i):n.removeAttribute(`${r}:${i}`)}else n.removeAttribute(i)}addClass(n,i){n.classList.add(i)}removeClass(n,i){n.classList.remove(i)}setStyle(n,i,r,o){o&(mr.DashCase|mr.Important)?n.style.setProperty(i,r,o&mr.Important?"important":""):n.style[i]=r}removeStyle(n,i,r){r&mr.DashCase?n.style.removeProperty(i):n.style[i]=""}setProperty(n,i,r){n[i]=r}setValue(n,i){n.nodeValue=i}listen(n,i,r){if("string"==typeof n&&!(n=Cg().getGlobalEventTarget(this.doc,n)))throw new Error(`Unsupported event target ${n} for event ${i}`);return this.eventManager.addEventListener(n,i,this.decoratePreventDefault(r))}decoratePreventDefault(n){return i=>{if("__ngUnwrap__"===i)return n;!1===(this.platformIsServer?this.ngZone.runGuarded(()=>n(i)):n(i))&&i.preventDefault()}}}function UE(t){return"TEMPLATE"===t.tagName&&void 0!==t.content}class kN extends Hg{constructor(n,i,r,o,s,l,h,p){super(n,s,l,p),this.sharedStylesHost=i,this.hostEl=r,this.shadowRoot=r.attachShadow({mode:"open"}),this.sharedStylesHost.addHost(this.shadowRoot);const C=jE(o.id,o.styles);for(const D of C){const T=document.createElement("style");h&&T.setAttribute("nonce",h),T.textContent=D,this.shadowRoot.appendChild(T)}}nodeOrShadowRoot(n){return n===this.hostEl?this.shadowRoot:n}appendChild(n,i){return super.appendChild(this.nodeOrShadowRoot(n),i)}insertBefore(n,i,r){return super.insertBefore(this.nodeOrShadowRoot(n),i,r)}removeChild(n,i){return super.removeChild(this.nodeOrShadowRoot(n),i)}parentNode(n){return this.nodeOrShadowRoot(super.parentNode(this.nodeOrShadowRoot(n)))}destroy(){this.sharedStylesHost.removeHost(this.shadowRoot)}}class Wg extends Hg{constructor(n,i,r,o,s,l,h,p){super(n,s,l,h),this.sharedStylesHost=i,this.removeStylesOnCompDestroy=o,this.styles=p?jE(p,r.styles):r.styles}applyStyles(){this.sharedStylesHost.addStyles(this.styles)}destroy(){this.removeStylesOnCompDestroy&&this.sharedStylesHost.removeStyles(this.styles)}}class GE extends Wg{constructor(n,i,r,o,s,l,h,p){const C=o+"-"+r.id;super(n,i,r,s,l,h,p,C),this.contentAttr=function FN(t){return"_ngcontent-%COMP%".replace(Gg,t)}(C),this.hostAttr=function PN(t){return"_nghost-%COMP%".replace(Gg,t)}(C)}applyToHost(n){this.applyStyles(),this.setAttribute(n,this.hostAttr,"")}createElement(n,i){const r=super.createElement(n,i);return super.setAttribute(r,this.contentAttr,""),r}}let BN=(()=>{class t extends NE{constructor(i){super(i)}supports(i){return!0}addEventListener(i,r,o){return i.addEventListener(r,o,!1),()=>this.removeEventListener(i,r,o)}removeEventListener(i,r,o){return i.removeEventListener(r,o)}static#e=this.\u0275fac=function(r){return new(r||t)(it(Qr))};static#t=this.\u0275prov=vt({token:t,factory:t.\u0275fac})}return t})();const HE=["alt","control","meta","shift"],jN={"\b":"Backspace","\t":"Tab","\x7f":"Delete","\x1b":"Escape",Del:"Delete",Esc:"Escape",Left:"ArrowLeft",Right:"ArrowRight",Up:"ArrowUp",Down:"ArrowDown",Menu:"ContextMenu",Scroll:"ScrollLock",Win:"OS"},VN={alt:t=>t.altKey,control:t=>t.ctrlKey,meta:t=>t.metaKey,shift:t=>t.shiftKey};let UN=(()=>{class t extends NE{constructor(i){super(i)}supports(i){return null!=t.parseEventName(i)}addEventListener(i,r,o){const s=t.parseEventName(r),l=t.eventCallback(s.fullKey,o,this.manager.getZone());return this.manager.getZone().runOutsideAngular(()=>Cg().onAndCancel(i,s.domEventName,l))}static parseEventName(i){const r=i.toLowerCase().split("."),o=r.shift();if(0===r.length||"keydown"!==o&&"keyup"!==o)return null;const s=t._normalizeKey(r.pop());let l="",h=r.indexOf("code");if(h>-1&&(r.splice(h,1),l="code."),HE.forEach(C=>{const D=r.indexOf(C);D>-1&&(r.splice(D,1),l+=C+".")}),l+=s,0!=r.length||0===s.length)return null;const p={};return p.domEventName=o,p.fullKey=l,p}static matchEventFullKeyCode(i,r){let o=jN[i.key]||i.key,s="";return r.indexOf("code.")>-1&&(o=i.code,s="code."),!(null==o||!o)&&(o=o.toLowerCase()," "===o?o="space":"."===o&&(o="dot"),HE.forEach(l=>{l!==o&&(0,VN[l])(i)&&(s+=l+".")}),s+=o,s===r)}static eventCallback(i,r,o){return s=>{t.matchEventFullKeyCode(s,i)&&o.runGuarded(()=>r(s))}}static _normalizeKey(i){return"esc"===i?"escape":i}static#e=this.\u0275fac=function(r){return new(r||t)(it(Qr))};static#t=this.\u0275prov=vt({token:t,factory:t.\u0275fac})}return t})();const YE=[{provide:Ho,useValue:"browser"},{provide:qv,useValue:function GN(){Bg.makeCurrent()},multi:!0},{provide:Qr,useFactory:function WN(){return function ux(t){Oh=t}(document),document},deps:[]}],YN=UC(wF,"browser",YE),zN=new Ne(""),zE=[{provide:Kc,useClass:class xN{addToWindow(n){Ct.getAngularTestability=(r,o=!0)=>{const s=n.findTestabilityInTree(r,o);if(null==s)throw new De(5103,!1);return s},Ct.getAllAngularTestabilities=()=>n.getAllTestabilities(),Ct.getAllAngularRootElements=()=>n.getAllRootElements(),Ct.frameworkStabilizers||(Ct.frameworkStabilizers=[]),Ct.frameworkStabilizers.push(r=>{const o=Ct.getAllAngularTestabilities();let s=o.length,l=!1;const h=function(p){l=l||p,s--,0==s&&r(l)};o.forEach(p=>{p.whenStable(h)})})}findTestabilityInTree(n,i,r){return null==i?null:n.getTestability(i)??(r?Cg().isShadowRoot(i)?this.findTestabilityInTree(n,i.host,!0):this.findTestabilityInTree(n,i.parentElement,!0):null)}},deps:[]},{provide:NC,useClass:ug,deps:[Pt,dg,Kc]},{provide:ug,useClass:ug,deps:[Pt,dg,Kc]}],$E=[{provide:jh,useValue:"root"},{provide:ki,useFactory:function HN(){return new ki},deps:[]},{provide:jg,useClass:BN,multi:!0,deps:[Qr,Pt,Ho]},{provide:jg,useClass:UN,multi:!0,deps:[Qr]},VE,kE,PE,{provide:ny,useExisting:VE},{provide:class nN{},useClass:AN,deps:[]},[]];let $N=(()=>{class t{constructor(i){}static withServerTransition(i){return{ngModule:t,providers:[{provide:Ec,useValue:i.appId}]}}static#e=this.\u0275fac=function(r){return new(r||t)(it(zN,12))};static#t=this.\u0275mod=$s({type:t});static#n=this.\u0275inj=mo({providers:[...$E,...zE],imports:[KP,CF]})}return t})();function KE(t,n,i,r,o,s,l){try{var h=t[s](l),p=h.value}catch(C){return void i(C)}h.done?n(p):Promise.resolve(p).then(r,o)}function J(t){return function(){var n=this,i=arguments;return new Promise(function(r,o){var s=t.apply(n,i);function l(p){KE(s,r,o,l,h,"next",p)}function h(p){KE(s,r,o,l,h,"throw",p)}l(void 0)})}}function $e(t,n,i,r){if("a"===i&&!r)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof n?t!==n||!r:!n.has(t))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===i?r:"a"===i?r.call(t):r?r.value:n.get(t)}function Jr(t,n,i,r,o){if("m"===r)throw new TypeError("Private method is not writable");if("a"===r&&!o)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof n?t!==n||!o:!n.has(t))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===r?o.call(t,i):o?o.value=i:n.set(t,i),i}var eo,Di,Oe,t;typeof window<"u"&&window,"function"==typeof SuppressedError&&SuppressedError,(t=eo||(eo={}))[t.BOPM_BLOCK=0]="BOPM_BLOCK",t[t.BOPM_UPDATE=1]="BOPM_UPDATE",function(t){t[t.CCUT_AUTO=0]="CCUT_AUTO",t[t.CCUT_FULL_CHANNEL=1]="CCUT_FULL_CHANNEL",t[t.CCUT_Y_CHANNEL_ONLY=2]="CCUT_Y_CHANNEL_ONLY",t[t.CCUT_RGB_R_CHANNEL_ONLY=3]="CCUT_RGB_R_CHANNEL_ONLY",t[t.CCUT_RGB_G_CHANNEL_ONLY=4]="CCUT_RGB_G_CHANNEL_ONLY",t[t.CCUT_RGB_B_CHANNEL_ONLY=5]="CCUT_RGB_B_CHANNEL_ONLY"}(Di||(Di={})),function(t){t[t.IPF_BINARY=0]="IPF_BINARY",t[t.IPF_BINARYINVERTED=1]="IPF_BINARYINVERTED",t[t.IPF_GRAYSCALED=2]="IPF_GRAYSCALED",t[t.IPF_NV21=3]="IPF_NV21",t[t.IPF_RGB_565=4]="IPF_RGB_565",t[t.IPF_RGB_555=5]="IPF_RGB_555",t[t.IPF_RGB_888=6]="IPF_RGB_888",t[t.IPF_ARGB_8888=7]="IPF_ARGB_8888",t[t.IPF_RGB_161616=8]="IPF_RGB_161616",t[t.IPF_ARGB_16161616=9]="IPF_ARGB_16161616",t[t.IPF_ABGR_8888=10]="IPF_ABGR_8888",t[t.IPF_ABGR_16161616=11]="IPF_ABGR_16161616",t[t.IPF_BGR_888=12]="IPF_BGR_888",t[t.IPF_BINARY_8=13]="IPF_BINARY_8",t[t.IPF_NV12=14]="IPF_NV12"}(Oe||(Oe={}));const QE=t=>Object.prototype.toString.call(t),zg=t=>Array.isArray?Array.isArray(t):"[object Array]"===QE(t),$g=t=>"[object Boolean]"===QE(t),kt=t=>"number"==typeof t&&!Number.isNaN(t),si=t=>null!==t&&"object"==typeof t&&!Array.isArray(t),tk=t=>!!si(t)&&!!kt(t.imageId)&&"type"in t,fs=t=>!!si(t)&&!!kt(t.x)&&!!kt(t.y),Xa=(t,n)=>{let i=t.split("."),r=n.split(".");for(let o=0;o<i.length&&o<r.length;++o){let s=i[o],l=r[o];if(s===l)continue;let h=parseInt(i[o]),p=parseInt(r[o]);return h===p||Number.isNaN(h)&&Number.isNaN(p)?s<l?-1:1:h<p||Number.isNaN(h)&&Number.isInteger(p)?-1:1}return i.length===r.length?0:i.length<r.length?-1:1};var mu,Ht,to,qa,Za,$n,no,qg;class Xn{get _isFetchingStarted(){return $e(this,Za,"f")}constructor(){mu.add(this),Ht.set(this,[]),to.set(this,1),qa.set(this,eo.BOPM_BLOCK),Za.set(this,!1),$n.set(this,void 0),no.set(this,Di.CCUT_AUTO)}setErrorListener(n){}addImageToBuffer(n){var i;if(!(t=>!(!si(t)||!(t.bytes instanceof Uint8Array)||!kt(t.width)||t.width<=0||!kt(t.height)||t.height<=0||!kt(t.stride)||t.stride<=0||!("format"in t)||"tag"in t&&!tk(t.tag)))(n))throw new TypeError("Invalid 'image'.");if(null!==(i=n.tag)&&void 0!==i&&i.hasOwnProperty("imageId")&&"number"==typeof n.tag.imageId&&this.hasImage(n.tag.imageId))throw new Error("Existed imageId.");if($e(this,Ht,"f").length>=$e(this,to,"f"))switch($e(this,qa,"f")){case eo.BOPM_BLOCK:break;case eo.BOPM_UPDATE:if($e(this,Ht,"f").push(n),si($e(this,$n,"f"))&&kt($e(this,$n,"f").imageId)&&1==$e(this,$n,"f").keepInBuffer)for(;$e(this,Ht,"f").length>$e(this,to,"f");){const r=$e(this,Ht,"f").findIndex(o=>{var s;return(null===(s=o.tag)||void 0===s?void 0:s.imageId)!==$e(this,$n,"f").imageId});$e(this,Ht,"f").splice(r,1)}else $e(this,Ht,"f").splice(0,$e(this,Ht,"f").length-$e(this,to,"f"))}else $e(this,Ht,"f").push(n)}getImage(){if(0===$e(this,Ht,"f").length)return null;let n;if($e(this,$n,"f")&&kt($e(this,$n,"f").imageId)){const i=$e(this,mu,"m",qg).call(this,$e(this,$n,"f").imageId);if(i<0)throw new Error(`Image with id ${$e(this,$n,"f").imageId} doesn't exist.`);n=$e(this,Ht,"f").slice(i,i+1)[0]}else n=$e(this,Ht,"f").pop();if([Oe.IPF_RGB_565,Oe.IPF_RGB_555,Oe.IPF_RGB_888,Oe.IPF_ARGB_8888,Oe.IPF_RGB_161616,Oe.IPF_ARGB_16161616,Oe.IPF_ABGR_8888,Oe.IPF_ABGR_16161616,Oe.IPF_BGR_888].includes(n.format)){if($e(this,no,"f")===Di.CCUT_RGB_R_CHANNEL_ONLY){Xn._onLog&&Xn._onLog("only get R channel data.");const i=new Uint8Array(n.width*n.height);for(let r=0;r<i.length;r++)switch(n.format){case Oe.IPF_RGB_565:case Oe.IPF_RGB_555:case Oe.IPF_RGB_888:case Oe.IPF_RGB_161616:i[r]=n.bytes[3*r+2];break;case Oe.IPF_ARGB_8888:case Oe.IPF_ARGB_16161616:i[r]=n.bytes[4*r+2];break;case Oe.IPF_BGR_888:i[r]=n.bytes[3*r];break;case Oe.IPF_ABGR_8888:case Oe.IPF_ABGR_16161616:i[r]=n.bytes[4*r]}n.bytes=i,n.stride=n.width,n.format=Oe.IPF_GRAYSCALED}else if($e(this,no,"f")===Di.CCUT_RGB_G_CHANNEL_ONLY){Xn._onLog&&Xn._onLog("only get G channel data.");const i=new Uint8Array(n.width*n.height);for(let r=0;r<i.length;r++)switch(n.format){case Oe.IPF_RGB_565:case Oe.IPF_RGB_555:case Oe.IPF_RGB_888:case Oe.IPF_RGB_161616:case Oe.IPF_BGR_888:i[r]=n.bytes[3*r+1];break;case Oe.IPF_ARGB_8888:case Oe.IPF_ARGB_16161616:case Oe.IPF_ABGR_8888:case Oe.IPF_ABGR_16161616:i[r]=n.bytes[4*r+1]}n.bytes=i,n.stride=n.width,n.format=Oe.IPF_GRAYSCALED}else if($e(this,no,"f")===Di.CCUT_RGB_B_CHANNEL_ONLY){Xn._onLog&&Xn._onLog("only get B channel data.");const i=new Uint8Array(n.width*n.height);for(let r=0;r<i.length;r++)switch(n.format){case Oe.IPF_RGB_565:case Oe.IPF_RGB_555:case Oe.IPF_RGB_888:case Oe.IPF_RGB_161616:i[r]=n.bytes[3*r];break;case Oe.IPF_ARGB_8888:case Oe.IPF_ARGB_16161616:i[r]=n.bytes[4*r];break;case Oe.IPF_BGR_888:i[r]=n.bytes[3*r+2];break;case Oe.IPF_ABGR_8888:case Oe.IPF_ABGR_16161616:i[r]=n.bytes[4*r+2]}n.bytes=i,n.stride=n.width,n.format=Oe.IPF_GRAYSCALED}}else[Oe.IPF_NV21,Oe.IPF_NV12].includes(n.format)&&Xn._onLog&&Xn._onLog("NV21 or NV12 is not supported.");return n}setNextImageToReturn(n,i){if(!((...r)=>0!==r.length&&r.every(o=>kt(o)))(n))throw new TypeError("Invalid 'imageId'.");if(void 0!==i&&!$g(i))throw new TypeError("Invalid 'keepInBuffer'.");Jr(this,$n,{imageId:n,keepInBuffer:i},"f")}_resetNextReturnedImage(){Jr(this,$n,null,"f")}hasImage(n){return $e(this,mu,"m",qg).call(this,n)>=0}startFetching(){Jr(this,Za,!0,"f")}stopFetching(){Jr(this,Za,!1,"f")}setMaxImageCount(n){if("number"!=typeof n)throw new TypeError("Invalid 'count'.");if(n<1||Math.round(n)!==n)throw new Error("Invalid 'count'.");for(Jr(this,to,n,"f");$e(this,Ht,"f")&&$e(this,Ht,"f").length>n;)$e(this,Ht,"f").shift()}getMaxImageCount(){return $e(this,to,"f")}getImageCount(){return $e(this,Ht,"f").length}clearBuffer(){$e(this,Ht,"f").length=0}isBufferEmpty(){return 0===$e(this,Ht,"f").length}setBufferOverflowProtectionMode(n){Jr(this,qa,n,"f")}getBufferOverflowProtectionMode(){return $e(this,qa,"f")}setColourChannelUsageType(n){Jr(this,no,n,"f")}getColourChannelUsageType(){return $e(this,no,"f")}}Ht=new WeakMap,to=new WeakMap,qa=new WeakMap,Za=new WeakMap,$n=new WeakMap,no=new WeakMap,mu=new WeakSet,qg=function(t){if("number"!=typeof t)throw new TypeError("Invalid 'imageId'.");return $e(this,Ht,"f").findIndex(n=>{var i;return(null===(i=n.tag)||void 0===i?void 0:i.imageId)===t})};const _u=typeof self>"u",vu=(()=>{if(!_u&&document.currentScript){let t=document.currentScript.src,n=t.indexOf("?");if(-1!=n)t=t.substring(0,n);else{let i=t.indexOf("#");-1!=i&&(t=t.substring(0,i))}return t.substring(0,t.lastIndexOf("/")+1)}return"./"})(),yu=t=>{if(null==t&&(t="./"),!_u){let n=document.createElement("a");n.href=t,t=n.href}return t.endsWith("/")||(t+="/"),t};let Ka,Yi,wu,Cu,Dn;typeof navigator<"u"&&(Ka=navigator,Yi=Ka.userAgent,wu=Ka.platform,Cu=Ka.mediaDevices),function(){if(!_u){const t={Edge:{search:"Edg",verSearch:"Edg"},OPR:null,Chrome:null,Safari:{str:Ka.vendor,search:"Apple",verSearch:["Version","iPhone OS","CPU OS"]},Firefox:null,Explorer:{search:"MSIE",verSearch:"MSIE"}},n={HarmonyOS:null,Android:null,iPhone:null,iPad:null,Windows:{str:wu,search:"Win"},Mac:{str:wu},Linux:{str:wu}};let i="unknownBrowser",r=0,o="unknownOS";for(let s in t){const l=t[s]||{};let C=l.verStr||Yi,D=l.verSearch||s;if(D instanceof Array||(D=[D]),-1!=(l.str||Yi).indexOf(l.search||s)){i=s;for(let T of D){let A=C.indexOf(T);if(-1!=A){r=parseFloat(C.substring(A+T.length+1));break}}break}}for(let s in n){const l=n[s]||{};if(-1!=(l.str||Yi).indexOf(l.search||s)){o=s;break}}"Linux"==o&&-1!=Yi.indexOf("Windows NT")&&(o="HarmonyOS"),Dn={browser:i,version:r,OS:o}}_u&&(Dn={browser:"ssr",version:0,OS:"ssr"})}();const sk=typeof WebAssembly<"u"&&Yi&&!(/Safari/.test(Yi)&&!/Chrome/.test(Yi)&&/\(.+\s11_2_([2-6]).*\)/.test(Yi)),ak=!(typeof Worker>"u"),eI=!(!Cu||!Cu.getUserMedia),lk=function(){var t=J(function*(){let n=!1;if(eI)try{(yield Cu.getUserMedia({video:!0})).getTracks().forEach(i=>{i.stop()}),n=!0}catch{}return n});return function(){return t.apply(this,arguments)}}(),tI=t=>t&&"object"==typeof t&&"function"==typeof t.then;class nI extends Promise{constructor(n){let i,r;super((o,s)=>{i=o,r=s}),this._s="pending",this.resolve=o=>{this.isPending&&(tI(o)?this.task=o:(this._s="fulfilled",i(o)))},this.reject=o=>{this.isPending&&(this._s="rejected",r(o))},this.task=n}get status(){return this._s}get isPending(){return"pending"===this._s}get isFulfilled(){return"fulfilled"===this._s}get isRejected(){return"rejected"===this._s}get task(){return this._task}set task(n){var i=this;let r;this._task=n,tI(n)?r=n:"function"==typeof n&&(r=new Promise(n)),r&&J(function*(){try{const o=yield r;n===i._task&&i.resolve(o)}catch(o){n===i._task&&i.reject(o)}})()}get isEmpty(){return null==this._task}}const gs={},Eu=t=>{let n=gs[t],i=!1;return n?n.isEmpty?n.task=()=>{}:i=!0:n=gs[t]=new nI(()=>{}),{p:n,justWait:i}};let tt,iI=0;const St=()=>iI++,dt={};let Ir,Zg=!1;const io={},bn={},Kg=t=>"std"===t?yu(vu+"../../dynamsoft-capture-vision-std@1.0.0/dist/"):"dip"===t?yu(vu+"../../dynamsoft-image-processing@2.0.30/dist/"):"dcm"===t?yu(vu+"../../dynamsoft-label-recognizer-data@1.0.0/dist/"):void 0,at={std:{version:"1.0.0",path:Kg("std")},core:{version:"3.0.32",path:vu},dip:{version:"2.0.30",path:Kg("dip")},dcm:Kg("dcm")},Qa=new Proxy(at,{get(t,n,i){let r=Reflect.get(t,n,i);return r&&r.path&&(r=r.path),r}}),ps={core:{js:!0,wasm:!0},dip:{wasm:!0}},zi=function(){var t=J(function*(n){n instanceof Array||(n=n?[n]:[]),n=n.map(p=>p.toLowerCase()).filter(p=>"core"!=p&&"std"!=p);for(let p of n)if(!ps[p]&&"dedicator"!==p)throw Error("Module '"+p+"' not existed.");n.some(p=>["dbr","dlr","ddn"].includes(p))&&(n.unshift("dip"),n=[...new Set(n)]);let i=!1;const r=[];{const{p,justWait:C}=Eu("core");C?yield p:(r.push(p),i=!0)}const o={};for(let p of n){const{p:C,justWait:D}=Eu(p);D?yield C:r.push(C),o[p]=ps[p]}if(0==r.length)return;const s={};for(let p in Qa){if("rootDirectory"==p)continue;let C=Qa[p];Qa.rootDirectory&&(C=Qa.rootDirectory+"/"+C),s[p]=yu(C)}const l={engineResourcePaths:s,autoResources:o,names:n};if(i){l.needLoadCore=!0;let p=s.core+Xt._workerName;s.rootDirectory&&(p=s.rootDirectory+p),p.startsWith(location.origin)||(p=yield fetch(p).then(C=>C.blob()).then(C=>URL.createObjectURL(C))),tt=new Worker(p),tt.onerror=C=>{let D=new Error(C.message);for(let T of r)T.reject(D)},tt.addEventListener("message",C=>{let D=C.data?C.data:C;switch(D.type){case"log":Ir&&Ir(D.message);break;case"task":{let T=D.id,A=D.body;try{dt[T](A),delete dt[T]}catch(M){throw delete dt[T],M}break}case"event":{let T=D.id,A=D.body;try{dt[T](A)}catch(M){throw M}break}default:console.log(C)}}),l.bLog=!!Ir,l.bd=Zg,l.dm=location.origin.startsWith("http")?location.origin:"https://localhost"}let h=iI++;return dt[h]=p=>{if(p.success){Object.assign(io,p.versions),"{}"!==JSON.stringify(p.versions)&&(Xt._versions=p.versions);for(let C of r)C.resolve(void 0)}else{const C=Error(p.message);p.stack&&(C.stack=p.stack);for(let D of r)D.reject(C)}},tt.postMessage({type:"loadWasm",body:l,id:h}),r[0]});return function(i){return t.apply(this,arguments)}}();class Xt{static get engineResourcePaths(){return Qa}static set engineResourcePaths(n){Object.assign(at,n)}static get bSupportDce4Module(){return this._bSupportDce4Module}static get bSupportIRTModule(){return this._bSupportIRTModule}static get versions(){return this._versions}static get onLog(){return Ir}static set onLog(n){(t=>{Ir=t,tt&&tt.postMessage({type:"setBLog",body:{value:!!t}})})(n)}static get _bDebug(){return Zg}static set _bDebug(n){(t=>{Zg=t,tt&&tt.postMessage({type:"setBDebug",body:{value:!!t}})})(n)}static isModuleLoaded(n){return n=(n=n||"core").toLowerCase(),!!gs[n]&&gs[n].isFulfilled}static loadWasm(n){return J(function*(){return yield zi(n)})()}static detectEnvironment(){return J(function*(){return yield J(function*(){return{wasm:sk,worker:ak,getUserMedia:eI,camera:yield lk(),browser:Dn.browser,version:Dn.version,OS:Dn.OS}})()})()}static getModuleVersion(){return J(function*(){return yield new Promise((n,i)=>{let r=St();dt[r]=function(){var o=J(function*(s){if(s.success)return n(s.versions);{let l=new Error(s.message);return l.stack=s.stack+"\n"+l.stack,i(l)}});return function(s){return o.apply(this,arguments)}}(),tt.postMessage({type:"getModuleVersion",id:r})})})()}static getVersion(){return`3.0.32(Worker: ${io.core&&io.core.worker||"Not Loaded"}, Wasm: ${io.core&&io.core.wasm||"Not Loaded"})`}static enableLogging(){Xn._onLog=console.log}static disableLogging(){Xn._onLog=null}static cfd(n){return J(function*(){return yield new Promise((i,r)=>{let o=St();dt[o]=function(){var s=J(function*(l){if(l.success)return i();{let h=new Error(l.message);return h.stack=l.stack+"\n"+h.stack,r(h)}});return function(l){return s.apply(this,arguments)}}(),tt.postMessage({type:"cfd",id:o,body:{count:n}})})})()}}var Re,rI,Qg,oI,sI,Iu,aI,lI,ms,cI,uI;Xt._bSupportDce4Module=-1,Xt._bSupportIRTModule=-1,Xt._versions=null,Xt._workerName="core.worker.js",Xt.browserInfo=Dn,function(t){t[t.CRIT_ORIGINAL_IMAGE=1]="CRIT_ORIGINAL_IMAGE",t[t.CRIT_BARCODE=2]="CRIT_BARCODE",t[t.CRIT_TEXT_LINE=4]="CRIT_TEXT_LINE",t[t.CRIT_DETECTED_QUAD=8]="CRIT_DETECTED_QUAD",t[t.CRIT_NORMALIZED_IMAGE=16]="CRIT_NORMALIZED_IMAGE",t[t.CRIT_PARSED_RESULT=32]="CRIT_PARSED_RESULT"}(Re||(Re={})),function(t){t[t.CT_NORMAL_INTERSECTED=0]="CT_NORMAL_INTERSECTED",t[t.CT_T_INTERSECTED=1]="CT_T_INTERSECTED",t[t.CT_CROSS_INTERSECTED=2]="CT_CROSS_INTERSECTED",t[t.CT_NOT_INTERSECTED=3]="CT_NOT_INTERSECTED"}(rI||(rI={})),function(t){t[t.EC_OK=0]="EC_OK",t[t.EC_UNKNOWN=-1e4]="EC_UNKNOWN",t[t.EC_NO_MEMORY=-10001]="EC_NO_MEMORY",t[t.EC_NULL_POINTER=-10002]="EC_NULL_POINTER",t[t.EC_LICENSE_INVALID=-10003]="EC_LICENSE_INVALID",t[t.EC_LICENSE_EXPIRED=-10004]="EC_LICENSE_EXPIRED",t[t.EC_FILE_NOT_FOUND=-10005]="EC_FILE_NOT_FOUND",t[t.EC_FILE_TYPE_NOT_SUPPORTED=-10006]="EC_FILE_TYPE_NOT_SUPPORTED",t[t.EC_BPP_NOT_SUPPORTED=-10007]="EC_BPP_NOT_SUPPORTED",t[t.EC_INDEX_INVALID=-10008]="EC_INDEX_INVALID",t[t.EC_CUSTOM_REGION_INVALID=-10010]="EC_CUSTOM_REGION_INVALID",t[t.EC_IMAGE_READ_FAILED=-10012]="EC_IMAGE_READ_FAILED",t[t.EC_TIFF_READ_FAILED=-10013]="EC_TIFF_READ_FAILED",t[t.EC_DIB_BUFFER_INVALID=-10018]="EC_DIB_BUFFER_INVALID",t[t.EC_PDF_READ_FAILED=-10021]="EC_PDF_READ_FAILED",t[t.EC_PDF_DLL_MISSING=-10022]="EC_PDF_DLL_MISSING",t[t.EC_PAGE_NUMBER_INVALID=-10023]="EC_PAGE_NUMBER_INVALID",t[t.EC_CUSTOM_SIZE_INVALID=-10024]="EC_CUSTOM_SIZE_INVALID",t[t.EC_TIMEOUT=-10026]="EC_TIMEOUT",t[t.EC_JSON_PARSE_FAILED=-10030]="EC_JSON_PARSE_FAILED",t[t.EC_JSON_TYPE_INVALID=-10031]="EC_JSON_TYPE_INVALID",t[t.EC_JSON_KEY_INVALID=-10032]="EC_JSON_KEY_INVALID",t[t.EC_JSON_VALUE_INVALID=-10033]="EC_JSON_VALUE_INVALID",t[t.EC_JSON_NAME_KEY_MISSING=-10034]="EC_JSON_NAME_KEY_MISSING",t[t.EC_JSON_NAME_VALUE_DUPLICATED=-10035]="EC_JSON_NAME_VALUE_DUPLICATED",t[t.EC_TEMPLATE_NAME_INVALID=-10036]="EC_TEMPLATE_NAME_INVALID",t[t.EC_JSON_NAME_REFERENCE_INVALID=-10037]="EC_JSON_NAME_REFERENCE_INVALID",t[t.EC_PARAMETER_VALUE_INVALID=-10038]="EC_PARAMETER_VALUE_INVALID",t[t.EC_DOMAIN_NOT_MATCH=-10039]="EC_DOMAIN_NOT_MATCH",t[t.EC_RESERVED_INFO_NOT_MATCH=-10040]="EC_RESERVED_INFO_NOT_MATCH",t[t.EC_LICENSE_KEY_NOT_MATCH=-10043]="EC_LICENSE_KEY_NOT_MATCH",t[t.EC_REQUEST_FAILED=-10044]="EC_REQUEST_FAILED",t[t.EC_LICENSE_INIT_FAILED=-10045]="EC_LICENSE_INIT_FAILED",t[t.EC_SET_MODE_ARGUMENT_ERROR=-10051]="EC_SET_MODE_ARGUMENT_ERROR",t[t.EC_LICENSE_CONTENT_INVALID=-10052]="EC_LICENSE_CONTENT_INVALID",t[t.EC_LICENSE_KEY_INVALID=-10053]="EC_LICENSE_KEY_INVALID",t[t.EC_LICENSE_DEVICE_RUNS_OUT=-10054]="EC_LICENSE_DEVICE_RUNS_OUT",t[t.EC_GET_MODE_ARGUMENT_ERROR=-10055]="EC_GET_MODE_ARGUMENT_ERROR",t[t.EC_IRT_LICENSE_INVALID=-10056]="EC_IRT_LICENSE_INVALID",t[t.EC_FILE_SAVE_FAILED=-10058]="EC_FILE_SAVE_FAILED",t[t.EC_STAGE_TYPE_INVALID=-10059]="EC_STAGE_TYPE_INVALID",t[t.EC_IMAGE_ORIENTATION_INVALID=-10060]="EC_IMAGE_ORIENTATION_INVALID",t[t.EC_CONVERT_COMPLEX_TEMPLATE_ERROR=-10061]="EC_CONVERT_COMPLEX_TEMPLATE_ERROR",t[t.EC_CALL_REJECTED_WHEN_CAPTURING=-10062]="EC_CALL_REJECTED_WHEN_CAPTURING",t[t.EC_NO_IMAGE_SOURCE=-10063]="EC_NO_IMAGE_SOURCE",t[t.EC_READ_DIRECTORY_FAILED=-10064]="EC_READ_DIRECTORY_FAILED",t[t.EC_MODULE_NOT_FOUND=-10065]="EC_MODULE_NOT_FOUND",t[t.EC_MULTI_PAGES_NOT_SUPPORTED=-10066]="EC_MULTI_PAGES_NOT_SUPPORTED",t[t.EC_FILE_ALREADY_EXISTS=-10067]="EC_FILE_ALREADY_EXISTS",t[t.EC_CREATE_FILE_FAILED=-10068]="EC_CREATE_FILE_FAILED",t[t.EC_IMAGE_DATA_INVALID=-10069]="EC_IMAGE_DATA_INVALID",t[t.EC_NO_LICENSE=-2e4]="EC_NO_LICENSE",t[t.EC_HANDSHAKE_CODE_INVALID=-20001]="EC_HANDSHAKE_CODE_INVALID",t[t.EC_LICENSE_BUFFER_FAILED=-20002]="EC_LICENSE_BUFFER_FAILED",t[t.EC_LICENSE_SYNC_FAILED=-20003]="EC_LICENSE_SYNC_FAILED",t[t.EC_DEVICE_NOT_MATCH=-20004]="EC_DEVICE_NOT_MATCH",t[t.EC_BIND_DEVICE_FAILED=-20005]="EC_BIND_DEVICE_FAILED",t[t.EC_INSTANCE_COUNT_OVER_LIMIT=-20008]="EC_INSTANCE_COUNT_OVER_LIMIT",t[t.EC_TRIAL_LICENSE=-20010]="EC_TRIAL_LICENSE",t[t.EC_LICENSE_VERSION_NOT_MATCH=-20011]="EC_LICENSE_VERSION_NOT_MATCH",t[t.EC_FAILED_TO_REACH_DLS=-20200]="EC_FAILED_TO_REACH_DLS",t[t.EC_BARCODE_FORMAT_INVALID=-30009]="EC_BARCODE_FORMAT_INVALID",t[t.EC_QR_LICENSE_INVALID=-30016]="EC_QR_LICENSE_INVALID",t[t.EC_1D_LICENSE_INVALID=-30017]="EC_1D_LICENSE_INVALID",t[t.EC_PDF417_LICENSE_INVALID=-30019]="EC_PDF417_LICENSE_INVALID",t[t.EC_DATAMATRIX_LICENSE_INVALID=-30020]="EC_DATAMATRIX_LICENSE_INVALID",t[t.EC_CUSTOM_MODULESIZE_INVALID=-30025]="EC_CUSTOM_MODULESIZE_INVALID",t[t.EC_AZTEC_LICENSE_INVALID=-30041]="EC_AZTEC_LICENSE_INVALID",t[t.EC_PATCHCODE_LICENSE_INVALID=-30046]="EC_PATCHCODE_LICENSE_INVALID",t[t.EC_POSTALCODE_LICENSE_INVALID=-30047]="EC_POSTALCODE_LICENSE_INVALID",t[t.EC_DPM_LICENSE_INVALID=-30048]="EC_DPM_LICENSE_INVALID",t[t.EC_FRAME_DECODING_THREAD_EXISTS=-30049]="EC_FRAME_DECODING_THREAD_EXISTS",t[t.EC_STOP_DECODING_THREAD_FAILED=-30050]="EC_STOP_DECODING_THREAD_FAILED",t[t.EC_MAXICODE_LICENSE_INVALID=-30057]="EC_MAXICODE_LICENSE_INVALID",t[t.EC_GS1_DATABAR_LICENSE_INVALID=-30058]="EC_GS1_DATABAR_LICENSE_INVALID",t[t.EC_GS1_COMPOSITE_LICENSE_INVALID=-30059]="EC_GS1_COMPOSITE_LICENSE_INVALID",t[t.EC_DOTCODE_LICENSE_INVALID=-30061]="EC_DOTCODE_LICENSE_INVALID",t[t.EC_PHARMACODE_LICENSE_INVALID=-30062]="EC_PHARMACODE_LICENSE_INVALID",t[t.EC_CHARACTER_MODEL_FILE_NOT_FOUND=-40100]="EC_CHARACTER_MODEL_FILE_NOT_FOUND",t[t.EC_QUADRILATERAL_INVALID=-50057]="EC_QUADRILATERAL_INVALID",t[t.EC_PANORAMA_LICENSE_INVALID=-70060]="EC_PANORAMA_LICENSE_INVALID",t[t.EC_RESOURCE_PATH_NOT_EXIST=-90001]="EC_RESOURCE_PATH_NOT_EXIST",t[t.EC_RESOURCE_LOAD_FAILED=-90002]="EC_RESOURCE_LOAD_FAILED",t[t.EC_CODE_SPECIFICATION_NOT_FOUND=-90003]="EC_CODE_SPECIFICATION_NOT_FOUND",t[t.EC_FULL_CODE_EMPTY=-90004]="EC_FULL_CODE_EMPTY",t[t.EC_FULL_CODE_PREPROCESS_FAILED=-90005]="EC_FULL_CODE_PREPROCESS_FAILED",t[t.EC_ZA_DL_LICENSE_INVALID=-90006]="EC_ZA_DL_LICENSE_INVALID",t[t.EC_AAMVA_DL_ID_LICENSE_INVALID=-90007]="EC_AAMVA_DL_ID_LICENSE_INVALID",t[t.EC_AADHAAR_LICENSE_INVALID=-90008]="EC_AADHAAR_LICENSE_INVALID",t[t.EC_MRTD_LICENSE_INVALID=-90009]="EC_MRTD_LICENSE_INVALID",t[t.EC_VIN_LICENSE_INVALID=-90010]="EC_VIN_LICENSE_INVALID",t[t.EC_CUSTOMIZED_CODE_TYPE_LICENSE_INVALID=-90011]="EC_CUSTOMIZED_CODE_TYPE_LICENSE_INVALID"}(Qg||(Qg={})),function(t){t[t.GEM_SKIP=0]="GEM_SKIP",t[t.GEM_AUTO=1]="GEM_AUTO",t[t.GEM_GENERAL=2]="GEM_GENERAL",t[t.GEM_GRAY_EQUALIZE=4]="GEM_GRAY_EQUALIZE",t[t.GEM_GRAY_SMOOTH=8]="GEM_GRAY_SMOOTH",t[t.GEM_SHARPEN_SMOOTH=16]="GEM_SHARPEN_SMOOTH",t[t.GEM_REV=-2147483648]="GEM_REV"}(oI||(oI={})),function(t){t[t.GTM_SKIP=0]="GTM_SKIP",t[t.GTM_INVERTED=1]="GTM_INVERTED",t[t.GTM_ORIGINAL=2]="GTM_ORIGINAL",t[t.GTM_AUTO=4]="GTM_AUTO",t[t.GTM_REV=-2147483648]="GTM_REV"}(sI||(sI={})),function(t){t[t.ITT_FILE_IMAGE=0]="ITT_FILE_IMAGE",t[t.ITT_VIDEO_FRAME=1]="ITT_VIDEO_FRAME"}(Iu||(Iu={})),function(t){t[t.PDFRM_VECTOR=1]="PDFRM_VECTOR",t[t.PDFRM_RASTER=2]="PDFRM_RASTER",t[t.PDFRM_REV=-2147483648]="PDFRM_REV"}(aI||(aI={})),function(t){t[t.RDS_RASTERIZED_PAGES=0]="RDS_RASTERIZED_PAGES",t[t.RDS_EXTRACTED_IMAGES=1]="RDS_EXTRACTED_IMAGES"}(lI||(lI={})),function(t){t[t.IRUT_NULL=0]="IRUT_NULL",t[t.IRUT_COLOUR_IMAGE=1]="IRUT_COLOUR_IMAGE",t[t.IRUT_SCALED_DOWN_COLOUR_IMAGE=2]="IRUT_SCALED_DOWN_COLOUR_IMAGE",t[t.IRUT_GRAYSCALE_IMAGE=4]="IRUT_GRAYSCALE_IMAGE",t[t.IRUT_TRANSOFORMED_GRAYSCALE_IMAGE=8]="IRUT_TRANSOFORMED_GRAYSCALE_IMAGE",t[t.IRUT_ENHANCED_GRAYSCALE_IMAGE=16]="IRUT_ENHANCED_GRAYSCALE_IMAGE",t[t.IRUT_PREDETECTED_REGIONS=32]="IRUT_PREDETECTED_REGIONS",t[t.IRUT_BINARY_IMAGE=64]="IRUT_BINARY_IMAGE",t[t.IRUT_TEXTURE_DETECTION_RESULT=128]="IRUT_TEXTURE_DETECTION_RESULT",t[t.IRUT_TEXTURE_REMOVED_GRAYSCALE_IMAGE=256]="IRUT_TEXTURE_REMOVED_GRAYSCALE_IMAGE",t[t.IRUT_TEXTURE_REMOVED_BINARY_IMAGE=512]="IRUT_TEXTURE_REMOVED_BINARY_IMAGE",t[t.IRUT_CONTOURS=1024]="IRUT_CONTOURS",t[t.IRUT_LINE_SEGMENTS=2048]="IRUT_LINE_SEGMENTS",t[t.IRUT_TEXT_ZONES=4096]="IRUT_TEXT_ZONES",t[t.IRUT_TEXT_REMOVED_BINARY_IMAGE=8192]="IRUT_TEXT_REMOVED_BINARY_IMAGE",t[t.IRUT_CANDIDATE_BARCODE_ZONES=16384]="IRUT_CANDIDATE_BARCODE_ZONES",t[t.IRUT_LOCALIZED_BARCODES=32768]="IRUT_LOCALIZED_BARCODES",t[t.IRUT_SCALED_UP_BARCODE_IMAGE=65536]="IRUT_SCALED_UP_BARCODE_IMAGE",t[t.IRUT_DEFORMATION_RESISTED_BARCODE_IMAGE=131072]="IRUT_DEFORMATION_RESISTED_BARCODE_IMAGE",t[t.IRUT_COMPLEMENTED_BARCODE_IMAGE=262144]="IRUT_COMPLEMENTED_BARCODE_IMAGE",t[t.IRUT_DECODED_BARCODES=524288]="IRUT_DECODED_BARCODES",t[t.IRUT_LONG_LINES=1048576]="IRUT_LONG_LINES",t[t.IRUT_CORNERS=2097152]="IRUT_CORNERS",t[t.IRUT_CANDIDATE_QUAD_EDGES=4194304]="IRUT_CANDIDATE_QUAD_EDGES",t[t.IRUT_DETECTED_QUADS=8388608]="IRUT_DETECTED_QUADS",t[t.IRUT_LOCALIZED_TEXT_LINES=16777216]="IRUT_LOCALIZED_TEXT_LINES",t[t.IRUT_RECOGNIZED_TEXT_LINES=33554432]="IRUT_RECOGNIZED_TEXT_LINES",t[t.IRUT_NORMALIZED_IMAGES=67108864]="IRUT_NORMALIZED_IMAGES",t[t.IRUT_ALL=134217727]="IRUT_ALL"}(ms||(ms={})),function(t){t[t.ROET_PREDETECTED_REGION=0]="ROET_PREDETECTED_REGION",t[t.ROET_LOCALIZED_BARCODE=1]="ROET_LOCALIZED_BARCODE",t[t.ROET_DECODED_BARCODE=2]="ROET_DECODED_BARCODE",t[t.ROET_LOCALIZED_TEXT_LINE=3]="ROET_LOCALIZED_TEXT_LINE",t[t.ROET_RECOGNIZED_TEXT_LINE=4]="ROET_RECOGNIZED_TEXT_LINE",t[t.ROET_DETECTED_QUAD=5]="ROET_DETECTED_QUAD",t[t.ROET_NORMALIZED_IMAGE=6]="ROET_NORMALIZED_IMAGE",t[t.ROET_SOURCE_IMAGE=7]="ROET_SOURCE_IMAGE",t[t.ROET_TARGET_ROI=8]="ROET_TARGET_ROI"}(cI||(cI={})),function(t){t[t.ST_NULL=0]="ST_NULL",t[t.ST_REGION_PREDETECTION=1]="ST_REGION_PREDETECTION",t[t.ST_BARCODE_LOCALIZATION=2]="ST_BARCODE_LOCALIZATION",t[t.ST_BARCODE_DECODING=3]="ST_BARCODE_DECODING",t[t.ST_TEXT_LINE_LOCALIZATION=4]="ST_TEXT_LINE_LOCALIZATION",t[t.ST_TEXT_LINE_RECOGNITION=5]="ST_TEXT_LINE_RECOGNITION",t[t.ST_DOCUMENT_DETECTION=6]="ST_DOCUMENT_DETECTION",t[t.ST_DOCUMENT_NORMALIZATION=7]="ST_DOCUMENT_NORMALIZATION"}(uI||(uI={}));const Dr=typeof self>"u",dI=Dr?{}:self,hI=(()=>{if(!Dr&&document.currentScript){let t=document.currentScript.src,n=t.indexOf("?");if(-1!=n)t=t.substring(0,n);else{let i=t.indexOf("#");-1!=i&&(t=t.substring(0,i))}return t.substring(0,t.lastIndexOf("/")+1)}return"./"})(),fI=t=>t&&"object"==typeof t&&"function"==typeof t.then,Du=" is not allowed to change after `createInstance` or `loadWasm` is called.",dk=!Dr&&document.currentScript&&(document.currentScript.getAttribute("data-license")||document.currentScript.getAttribute("data-productKeys")||document.currentScript.getAttribute("data-licenseKey")||document.currentScript.getAttribute("data-handshakeCode")||document.currentScript.getAttribute("data-organizationID"))||"",gI=(t,n)=>{const i=t;if(!i._pLoad.isEmpty)throw new Error("`license`"+Du);i._license=n};!Dr&&document.currentScript&&document.currentScript.getAttribute("data-sessionPassword");const pI=t=>{if(null==t)t=[];else{t=t instanceof Array?[...t]:[t];for(let n=0;n<t.length;++n){if(!Dr){let i=document.createElement("a");i.href=t[n],t[n]=i.href}t[n].endsWith("/")||(t[n]+="/")}}return t},mI=(t,n)=>{const i=t;if(!i._pLoad.isEmpty)throw new Error("`licenseServer`"+Du);i._licenseServer=pI(n)},_I=(t,n)=>{const i=t;if(!i._pLoad.isEmpty)throw new Error("`deviceFriendlyName`"+Du);i._deviceFriendlyName=n||""};let Ja,$i,bu,Jg,ai,ep,_s;typeof navigator<"u"&&(Ja=navigator,$i=Ja.userAgent,bu=Ja.platform,Jg=Ja.mediaDevices),function(){if(!Dr){const t={Edge:{search:"Edg",verSearch:"Edg"},OPR:null,Chrome:null,Safari:{str:Ja.vendor,search:"Apple",verSearch:["Version","iPhone OS","CPU OS"]},Firefox:null,Explorer:{search:"MSIE",verSearch:"MSIE"}},n={HarmonyOS:null,Android:null,iPhone:null,iPad:null,Windows:{str:bu,search:"Win"},Mac:{str:bu},Linux:{str:bu}};let i="unknownBrowser",r=0,o="unknownOS";for(let s in t){const l=t[s]||{};let C=l.verStr||$i,D=l.verSearch||s;if(D instanceof Array||(D=[D]),-1!=(l.str||$i).indexOf(l.search||s)){i=s;for(let T of D){let A=C.indexOf(T);if(-1!=A){r=parseFloat(C.substring(A+T.length+1));break}}break}}for(let s in n){const l=n[s]||{};if(-1!=(l.str||$i).indexOf(l.search||s)){o=s;break}}"Linux"==o&&-1!=$i.indexOf("Windows NT")&&(o="HarmonyOS"),ai={browser:i,version:r,OS:o}}Dr&&(ai={browser:"ssr",version:0,OS:"ssr"})}(),typeof WebAssembly<"u"&&$i&&(!/Safari/.test($i)||/Chrome/.test($i)||/\(.+\s11_2_([2-6]).*\)/.test($i));const vI=function(){var t=J(function*(){yield zi("license");const{p:n,justWait:i}=Eu("dynamsoft_inited");if(i)return n;try{let{lt:r,l:o,ls:s,sp:l,rmk:h,cv:p}=((D,T=!1)=>{const A=D;if(A._pLoad.isEmpty){let M,P,B,k=A._license||"",U=JSON.parse(JSON.stringify(A._licenseServer)),V=A._sessionPassword,q=0;if(k.startsWith("t")||k.startsWith("f"))q=0;else if(0===k.length||k.startsWith("P")||k.startsWith("L")||k.startsWith("Y")||k.startsWith("A"))q=1;else{q=2;const ce=k.indexOf(":");-1!=ce&&(k=k.substring(ce+1));const ge=k.indexOf("?");if(-1!=ge&&(P=k.substring(ge+1),k=k.substring(0,ge)),k.startsWith("DLC2"))q=0;else{if(k.startsWith("DLS2")){let ve;try{let me=k.substring(4);me=atob(me),ve=JSON.parse(me)}catch{throw new Error("Format Error: The license string you specified is invalid, please check to make sure it is correct.")}if(k=ve.handshakeCode?ve.handshakeCode:ve.organizationID?ve.organizationID:"","number"==typeof k&&(k=JSON.stringify(k)),0===U.length){let me=[];ve.mainServerURL&&(me[0]=ve.mainServerURL),ve.standbyServerURL&&(me[1]=ve.standbyServerURL),U=pI(me)}!V&&ve.sessionPassword&&(V=ve.sessionPassword),M=ve.remark}("200001"===k||k.startsWith("200001-"))&&(U&&U.length||(k="")),k||(q=1)}}if(q&&(T||(dI.crypto||(B="Please upgrade your browser to support online key."),dI.crypto.subtle||(B="Require https to use online key in this browser."))),B){if(1!==q)throw new Error(B);q=0,console.warn(B),A._lastErrorCode=-1,A._lastErrorString=B}return 1===q&&(k="",console.warn("Applying for a public trial license ...")),{lt:q,l:k,ls:U,sp:V,rmk:M,cv:P}}throw new Error("Can't preprocess license again"+Du)})(xt);xt._pLoad.task=n;let C=St();return dt[C]=D=>{if(D.message&&xt._onAuthMessage){let A=xt._onAuthMessage(D.message);null!=A&&(D.message=A)}let T=!1;if(1===r&&(T=!0),D.success?(Ir&&Ir("init license success"),D.message&&console.warn(D.message),Xt._bSupportIRTModule=D.bSupportIRTModule,Xt._bSupportDce4Module=D.bSupportDce4Module,xt.bPassValidation=!0):(_s=Error(D.message),D.stack&&(_s.stack=D.stack),T||111==D.ltsErrorCode&&-1!=D.message.toLowerCase().indexOf("trial license")&&(T=!0)),T){let A=at.license;at.rootDirectory&&(A=at.rootDirectory+"/"+A),A=(M=>{if(null==M&&(M="./"),!Dr){let P=document.createElement("a");P.href=M,M=P.href}return M.endsWith("/")||(M+="/"),M})(A),(M=J(function*(P,B,k){if(!P._bNeverShowDialog)try{let U=yield fetch(P.engineResourcePath+"dls.license.dialog.html");if(!U.ok)throw Error("Get license dialog fail. Network Error: "+U.statusText);let V=yield U.text();if(!V.trim().startsWith("<"))throw Error("Get license dialog fail. Can't get valid HTMLElement.");let q=document.createElement("div");q.innerHTML=V;let ce=[];for(let f=0;f<q.childElementCount;++f){let g=q.children[f];g instanceof HTMLStyleElement&&(ce.push(g),document.head.append(g))}let ge=1==q.childElementCount?q.children[0]:q;ge.remove();let ve,me,S,we,Me,nt=[ge],m=ge.children;for(let f of m)nt.push(f);for(let f=0;f<nt.length;++f)for(let g of nt[f].children)nt.push(g);for(let f of nt)if(!ve&&f.classList.contains("dls-license-mask"))ve=f,f.addEventListener("click",g=>{if(f==g.target){ge.remove();for(let v of ce)v.remove()}});else if(!me&&f.classList.contains("dls-license-icon-close"))me=f,f.addEventListener("click",()=>{ge.remove();for(let g of ce)g.remove()});else if(!S&&f.classList.contains("dls-license-icon-error"))S=f,"error"!=B&&f.remove();else if(!we&&f.classList.contains("dls-license-icon-warn"))we=f,"warn"!=B&&f.remove();else if(!Me&&f.classList.contains("dls-license-msg-content")){Me=f;let g=k;for(;g;){let v=g.indexOf("["),a=g.indexOf("]",v),c=g.indexOf("(",a),_=g.indexOf(")",c);if(-1==v||-1==a||-1==c||-1==_){f.appendChild(new Text(g));break}v>0&&f.appendChild(new Text(g.substring(0,v)));let I=document.createElement("a"),y=g.substring(v+1,a);I.innerText=y;let w=g.substring(c+1,_);I.setAttribute("href",w),I.setAttribute("target","_blank"),f.appendChild(I),g=g.substring(_+1)}}document.body.appendChild(ge)}catch(U){P._onLog&&P._onLog(U.message||U)}}),function(P,B,k){return M.apply(this,arguments)})({_bNeverShowDialog:xt._bNeverShowDialog,engineResourcePath:A,_onLog:Ir},D.success?"warn":"error",D.message)}var M;D.success?n.resolve(void 0):n.reject(_s)},o&&(o.startsWith("t")||o.startsWith("f"))&&(ep=o),tt.postMessage({type:"dynamsoft",body:{v:"3.0.20",brtk:!!r,bptk:1===r,l:o,os:ai,fn:xt.deviceFriendlyName,ls:s,sp:l,rmk:h,cv:p},id:C}),xt.bCallInitLicense=!0,n}catch(r){throw _s=r,n.reject(r),r}});return function(){return t.apply(this,arguments)}}();bn.license={},bn.license.dynamsoft=vI,bn.license.getAR=J(function*(){if(_s)throw _s;return tt?new Promise((t,n)=>{let i=St();dt[i]=function(){var r=J(function*(o){if(o.success)if(delete o.success,ep&&(o.pk=ep),Object.keys(o).length){if(o.lem){let s=Error(o.lem);s.ltsErrorCode=o.lec,delete o.lem,delete o.lec,o.ae=s}t(o)}else t(null);else{let s=Error(o.message);o.stack&&(s.stack=o.stack),n(s)}});return function(o){return r.apply(this,arguments)}}(),tt.postMessage({type:"getAR",id:i})}):null});class xt{static setLicenseServer(n){mI(xt,n)}static get license(){return this._license}static set license(n){gI(xt,n)}static get licenseServer(){return this._licenseServer}static set licenseServer(n){mI(xt,n)}static get deviceFriendlyName(){return this._deviceFriendlyName}static set deviceFriendlyName(n){_I(xt,n)}static initLicense(n,i){if(gI(xt,n),xt.bCallInitLicense=!0,i)return J(function*(){try{yield vI()}catch(r){return{isSuccess:!1,error:r.message||r}}return{isSuccess:!0,error:"Successful."}})()}static setDeviceFriendlyName(n){_I(xt,n)}static getDeviceFriendlyName(){return xt._deviceFriendlyName}static getDeviceUUID(){return J(function*(){const{p:n,justWait:i}=Eu("license_uuid");if(i)return n;yield zi();let r=St();return dt[r]=o=>{if(o.success)n.resolve(o.uuid);else{const s=Error(o.message);o.stack&&(s.stack=o.stack),n.reject(s)}},tt.postMessage({type:"getDeviceUUID",id:r}),n})()}}if(xt._pLoad=new class extends Promise{constructor(t){let n,i;super((r,o)=>{n=r,i=o}),this._s="pending",this.resolve=r=>{this.isPending&&(fI(r)?this.task=r:(this._s="fulfilled",n(r)))},this.reject=r=>{this.isPending&&(this._s="rejected",i(r))},this.task=t}get status(){return this._s}get isPending(){return"pending"===this._s}get isFulfilled(){return"fulfilled"===this._s}get isRejected(){return"rejected"===this._s}get task(){return this._task}set task(t){var n=this;let i;this._task=t,fI(t)?i=t:"function"==typeof t&&(i=new Promise(t)),i&&J(function*(){try{const r=yield i;t===n._task&&n.resolve(r)}catch(r){t===n._task&&n.reject(r)}})()}get isEmpty(){return null==this._task}},xt.bPassValidation=!1,xt.bCallInitLicense=!1,xt._license=dk,xt._licenseServer=[],xt._deviceFriendlyName="",null==at.license&&(at.license=hI),ps.license={wasm:!0},bn.license.LicenseManager=xt,at.std.version&&Xa(at.std.version,"1.0.0")<0){const t="1.0.0";at.std.version=t,at.std.path=hI+`../../dynamsoft-capture-vision-std@${t}/dist/`}const yI=typeof self>"u",tp=(()=>{if(!yI&&document.currentScript){let t=document.currentScript.src,n=t.indexOf("?");if(-1!=n)t=t.substring(0,n);else{let i=t.indexOf("#");-1!=i&&(t=t.substring(0,i))}return t.substring(0,t.lastIndexOf("/")+1)}return"./"})(),wI=t=>{if(null==t&&(t="./"),!yI){let n=document.createElement("a");n.href=t,t=n.href}return t.endsWith("/")||(t+="/"),t};null==at.dbr&&(at.dbr=tp),ps.dbr={js:!1,wasm:!0},bn.dbr={};const np="1.0.0";at.std.version&&Xa(at.std.version,np)<0&&(at.std.version=np,at.std.path=wI(tp+`../../dynamsoft-capture-vision-std@${np}/dist/`));const ip="2.0.30";var CI,EI,II,DI;at.dip.version&&Xa(at.dip.version,ip)<0&&(at.dip.version=ip,at.dip.path=wI(tp+`../../dynamsoft-image-processing@${ip}/dist/`)),"function"==typeof BigInt&&(BigInt(0),BigInt(0x10000000000000000),BigInt(4265345023),BigInt(3147775),BigInt(260096),BigInt(1),BigInt(2),BigInt(4),BigInt(8),BigInt(16),BigInt(32),BigInt(64),BigInt(128),BigInt(256),BigInt(512),BigInt(1024),BigInt(2048),BigInt(4096),BigInt(8192),BigInt(16384),BigInt(32768),BigInt(65536),BigInt(131072),BigInt(262144),BigInt(16777216),BigInt(33554432),BigInt(67108864),BigInt(134217728),BigInt(268435456),BigInt(536870912),BigInt(1073741824),BigInt(524288),BigInt(2147483648),BigInt(1048576),BigInt(2097152),BigInt(4194304),BigInt(8388608),BigInt(68719476736),BigInt(0x3f0000000000000),BigInt(4294967296),BigInt(4503599627370496),BigInt(9007199254740992),BigInt(0x40000000000000),BigInt(0x80000000000000),BigInt(72057594037927940),BigInt(0x200000000000000),BigInt(8589934592),BigInt(17179869184),BigInt(34359738368),BigInt(51539607552)),function(t){t[t.EBRT_STANDARD_RESULT=0]="EBRT_STANDARD_RESULT",t[t.EBRT_CANDIDATE_RESULT=1]="EBRT_CANDIDATE_RESULT",t[t.EBRT_PARTIAL_RESULT=2]="EBRT_PARTIAL_RESULT"}(CI||(CI={})),function(t){t[t.QRECL_ERROR_CORRECTION_H=0]="QRECL_ERROR_CORRECTION_H",t[t.QRECL_ERROR_CORRECTION_L=1]="QRECL_ERROR_CORRECTION_L",t[t.QRECL_ERROR_CORRECTION_M=2]="QRECL_ERROR_CORRECTION_M",t[t.QRECL_ERROR_CORRECTION_Q=3]="QRECL_ERROR_CORRECTION_Q"}(EI||(EI={})),function(t){t[t.LM_AUTO=1]="LM_AUTO",t[t.LM_CONNECTED_BLOCKS=2]="LM_CONNECTED_BLOCKS",t[t.LM_STATISTICS=4]="LM_STATISTICS",t[t.LM_LINES=8]="LM_LINES",t[t.LM_SCAN_DIRECTLY=16]="LM_SCAN_DIRECTLY",t[t.LM_STATISTICS_MARKS=32]="LM_STATISTICS_MARKS",t[t.LM_STATISTICS_POSTAL_CODE=64]="LM_STATISTICS_POSTAL_CODE",t[t.LM_CENTRE=128]="LM_CENTRE",t[t.LM_ONED_FAST_SCAN=256]="LM_ONED_FAST_SCAN",t[t.LM_REV=-2147483648]="LM_REV",t[t.LM_SKIP=0]="LM_SKIP"}(II||(II={})),function(t){t[t.DM_DIRECT_BINARIZATION=1]="DM_DIRECT_BINARIZATION",t[t.DM_THRESHOLD_BINARIZATION=2]="DM_THRESHOLD_BINARIZATION",t[t.DM_GRAY_EQUALIZATION=4]="DM_GRAY_EQUALIZATION",t[t.DM_SMOOTHING=8]="DM_SMOOTHING",t[t.DM_MORPHING=16]="DM_MORPHING",t[t.DM_DEEP_ANALYSIS=32]="DM_DEEP_ANALYSIS",t[t.DM_SHARPENING=64]="DM_SHARPENING",t[t.DM_BASED_ON_LOC_BIN=128]="DM_BASED_ON_LOC_BIN",t[t.DM_SHARPENING_SMOOTHING=256]="DM_SHARPENING_SMOOTHING",t[t.DM_REV=-2147483648]="DM_REV",t[t.DM_SKIP=0]="DM_SKIP"}(DI||(DI={})),xt.initLicense("DLS2eyJoYW5kc2hha2VDb2RlIjoiMjAwMDAwLWRicl9qc19zYW1wbGVzIiwib3JnYW5pemF0aW9uSUQiOiIyMDAwMDAifQ=="),Xt.engineResourcePaths={std:"https://cdn.jsdelivr.net/npm/dynamsoft-capture-vision-std@1.0.0/dist/",dip:"https://cdn.jsdelivr.net/npm/dynamsoft-image-processing@2.0.30/dist/",core:"https://cdn.jsdelivr.net/npm/dynamsoft-core@3.0.32/dist/",license:"https://cdn.jsdelivr.net/npm/dynamsoft-license@3.0.20/dist/",cvr:"https://cdn.jsdelivr.net/npm/dynamsoft-capture-vision-router@2.0.31/dist/",dbr:"https://cdn.jsdelivr.net/npm/dynamsoft-barcode-reader@10.0.20/dist/",dce:"https://cdn.jsdelivr.net/npm/dynamsoft-camera-enhancer@4.0.1/dist/"},Xt.loadWasm(["DBR"]);const bI=t=>t&&"object"==typeof t&&"function"==typeof t.then;class vs extends Promise{constructor(n){let i,r;super((o,s)=>{i=o,r=s}),this._s="pending",this.resolve=o=>{this.isPending&&(bI(o)?this.task=o:(this._s="fulfilled",i(o)))},this.reject=o=>{this.isPending&&(this._s="rejected",r(o))},this.task=n}get status(){return this._s}get isPending(){return"pending"===this._s}get isFulfilled(){return"fulfilled"===this._s}get isRejected(){return"rejected"===this._s}get task(){return this._task}set task(n){var i=this;let r;this._task=n,bI(n)?r=n:"function"==typeof n&&(r=new Promise(n)),r&&J(function*(){try{const o=yield r;n===i._task&&i.resolve(o)}catch(o){n===i._task&&i.reject(o)}})()}get isEmpty(){return null==this._task}}class hk{constructor(){this.intermediateResultReceiverSet=new Set}addResultReceiver(n){if("object"!=typeof n)throw new Error("Invalid receiver.");this.intermediateResultReceiverSet.add(n)}removeResultReceiver(n){this.intermediateResultReceiverSet.delete(n)}}var fk={onTaskResultsReceived:!1,onTaskResultsReceivedForDce:!1,onPredetectedRegionsReceived:!1,onLocalizedBarcodesReceived:!1,onDecodedBarcodesReceived:!1,onLocalizedTextLinesReceived:!1,onRecognizedTextLinesReceived:!1,onDetectedQuadsReceived:!1,onNormalizedImagesReceived:!1,onColourImageUnitReceived:!1,onScaledDownColourImageUnitReceived:!1,onGrayscaleImageUnitReceived:!1,onTransformedGrayscaleImageUnitReceived:!1,onEnhancedGrayscaleImageUnitReceived:!1,onBinaryImageUnitReceived:!1,onTextureDetectionResultUnitReceived:!1,onTextureRemovedGrayscaleImageUnitReceived:!1,onTextureRemovedBinaryImageUnitReceived:!1,onContoursUnitReceived:!1,onLineSegmentsUnitReceived:!1,onTextZonesUnitReceived:!1,onTextRemovedBinaryImageUnitReceived:!1,onLongLinesUnitReceived:!1,onCornersUnitReceived:!1,onCandidateQuadEdgesUnitReceived:!1,onCandidateBarcodeZonesUnitReceived:!1,onScaledUpBarcodeImageUnitReceived:!1,onDeformationResistedBarcodeImageUnitReceived:!1,onComplementedBarcodeImageUnitReceived:!1};const SI=typeof self>"u",rp=(()=>{if(!SI&&document.currentScript){let t=document.currentScript.src,n=t.indexOf("?");if(-1!=n)t=t.substring(0,n);else{let i=t.indexOf("#");-1!=i&&(t=t.substring(0,i))}return t.substring(0,t.lastIndexOf("/")+1)}return"./"})(),TI=t=>{if(null==t&&(t="./"),!SI){let n=document.createElement("a");n.href=t,t=n.href}return t.endsWith("/")||(t+="/"),t};var op;null==at.cvr&&(at.cvr=rp),ps.cvr={js:!0,wasm:!0},bn.cvr={};const sp="1.0.0";at.std.version&&Xa(at.std.version,sp)<0&&(at.std.version=sp,at.std.path=TI(rp+`../../dynamsoft-capture-vision-std@${sp}/dist/`));const ap="2.0.30";at.dip.version&&Xa(at.dip.version,ap)<0&&(at.dip.version=ap,at.dip.path=TI(rp+`../../dynamsoft-image-processing@${ap}/dist/`));class xI{static getVersion(){return this._version}}var Su,AI,lp,br;function OI(t,n){return cp.apply(this,arguments)}function cp(){return cp=J(function*(t,n){return yield new Promise((i,r)=>{let o=new XMLHttpRequest;o.open("GET",t,!0),o.responseType=n,o.send(),o.onloadend=J(function*(){i(o.response)}),o.onerror=()=>{r(new Error("Network Error: "+o.statusText))}})}),cp.apply(this,arguments)}xI._version=`2.0.31(Worker: ${null===(op=io.cvr)||void 0===op?void 0:op.worker}, Wasm: loading...`,function(t){t[t.ISS_BUFFER_EMPTY=0]="ISS_BUFFER_EMPTY",t[t.ISS_EXHAUSTED=1]="ISS_EXHAUSTED"}(Su||(Su={})),function(t){t[t.IRUT_NULL=0]="IRUT_NULL",t[t.IRUT_COLOUR_IMAGE=1]="IRUT_COLOUR_IMAGE",t[t.IRUT_SCALED_DOWN_COLOUR_IMAGE=2]="IRUT_SCALED_DOWN_COLOUR_IMAGE",t[t.IRUT_GRAYSCALE_IMAGE=4]="IRUT_GRAYSCALE_IMAGE",t[t.IRUT_TRANSOFORMED_GRAYSCALE_IMAGE=8]="IRUT_TRANSOFORMED_GRAYSCALE_IMAGE",t[t.IRUT_ENHANCED_GRAYSCALE_IMAGE=16]="IRUT_ENHANCED_GRAYSCALE_IMAGE",t[t.IRUT_PREDETECTED_REGIONS=32]="IRUT_PREDETECTED_REGIONS",t[t.IRUT_BINARY_IMAGE=64]="IRUT_BINARY_IMAGE",t[t.IRUT_TEXTURE_DETECTION_RESULT=128]="IRUT_TEXTURE_DETECTION_RESULT",t[t.IRUT_TEXTURE_REMOVED_GRAYSCALE_IMAGE=256]="IRUT_TEXTURE_REMOVED_GRAYSCALE_IMAGE",t[t.IRUT_TEXTURE_REMOVED_BINARY_IMAGE=512]="IRUT_TEXTURE_REMOVED_BINARY_IMAGE",t[t.IRUT_CONTOURS=1024]="IRUT_CONTOURS",t[t.IRUT_LINE_SEGMENTS=2048]="IRUT_LINE_SEGMENTS",t[t.IRUT_TEXT_ZONES=4096]="IRUT_TEXT_ZONES",t[t.IRUT_TEXT_REMOVED_BINARY_IMAGE=8192]="IRUT_TEXT_REMOVED_BINARY_IMAGE",t[t.IRUT_CANDIDATE_BARCODE_ZONES=16384]="IRUT_CANDIDATE_BARCODE_ZONES",t[t.IRUT_LOCALIZED_BARCODES=32768]="IRUT_LOCALIZED_BARCODES",t[t.IRUT_SCALED_UP_BARCODE_IMAGE=65536]="IRUT_SCALED_UP_BARCODE_IMAGE",t[t.IRUT_DEFORMATION_RESISTED_BARCODE_IMAGE=131072]="IRUT_DEFORMATION_RESISTED_BARCODE_IMAGE",t[t.IRUT_COMPLEMENTED_BARCODE_IMAGE=262144]="IRUT_COMPLEMENTED_BARCODE_IMAGE",t[t.IRUT_DECODED_BARCODES=524288]="IRUT_DECODED_BARCODES",t[t.IRUT_LONG_LINES=1048576]="IRUT_LONG_LINES",t[t.IRUT_CORNERS=2097152]="IRUT_CORNERS",t[t.IRUT_CANDIDATE_QUAD_EDGES=4194304]="IRUT_CANDIDATE_QUAD_EDGES",t[t.IRUT_DETECTED_QUADS=8388608]="IRUT_DETECTED_QUADS",t[t.IRUT_LOCALIZED_TEXT_LINES=16777216]="IRUT_LOCALIZED_TEXT_LINES",t[t.IRUT_RECOGNIZED_TEXT_LINES=33554432]="IRUT_RECOGNIZED_TEXT_LINES",t[t.IRUT_NORMALIZED_IMAGES=67108864]="IRUT_NORMALIZED_IMAGES",t[t.IRUT_ALL=134217727]="IRUT_ALL"}(AI||(AI={})),function(t){t[t.CRIT_ORIGINAL_IMAGE=1]="CRIT_ORIGINAL_IMAGE",t[t.CRIT_BARCODE=2]="CRIT_BARCODE",t[t.CRIT_TEXT_LINE=4]="CRIT_TEXT_LINE",t[t.CRIT_DETECTED_QUAD=8]="CRIT_DETECTED_QUAD",t[t.CRIT_NORMALIZED_IMAGE=16]="CRIT_NORMALIZED_IMAGE",t[t.CRIT_PARSED_RESULT=32]="CRIT_PARSED_RESULT"}(lp||(lp={})),function(t){t[t.IPF_BINARY=0]="IPF_BINARY",t[t.IPF_BINARYINVERTED=1]="IPF_BINARYINVERTED",t[t.IPF_GRAYSCALED=2]="IPF_GRAYSCALED",t[t.IPF_NV21=3]="IPF_NV21",t[t.IPF_RGB_565=4]="IPF_RGB_565",t[t.IPF_RGB_555=5]="IPF_RGB_555",t[t.IPF_RGB_888=6]="IPF_RGB_888",t[t.IPF_ARGB_8888=7]="IPF_ARGB_8888",t[t.IPF_RGB_161616=8]="IPF_RGB_161616",t[t.IPF_ARGB_16161616=9]="IPF_ARGB_16161616",t[t.IPF_ABGR_8888=10]="IPF_ABGR_8888",t[t.IPF_ABGR_16161616=11]="IPF_ABGR_16161616",t[t.IPF_BGR_888=12]="IPF_BGR_888",t[t.IPF_BINARY_8=13]="IPF_BINARY_8",t[t.IPF_NV12=14]="IPF_NV12"}(br||(br={}));const el=lp;function MI(t){const n={barcodeResultItems:[],textLineResultItems:[],quadsResultItems:[],normalizedImageResultItems:[],parsedResultItems:[]};return t.items.forEach(i=>{i.type===el.CRIT_BARCODE?n.barcodeResultItems.push(i):i.type===el.CRIT_TEXT_LINE?n.textLineResultItems.push(i):i.type===el.CRIT_DETECTED_QUAD?n.quadsResultItems.push(i):i.type===el.CRIT_NORMALIZED_IMAGE?n.normalizedImageResultItems.push(i):i.type===el.CRIT_PARSED_RESULT&&n.parsedResultItems.push(i)}),n}function gk(t){let n,i=t.bytes;if(!(i&&i instanceof Uint8Array))throw Error("Parameter type error");if(Number(t.format)===br.IPF_BGR_888){const r=i.length/3;n=new Uint8ClampedArray(4*r);for(let o=0;o<r;++o)n[4*o]=i[3*o],n[4*o+1]=i[3*o+1],n[4*o+2]=i[3*o+2],n[4*o+3]=255}else if(Number(t.format)===br.IPF_RGB_888){const r=i.length/3;n=new Uint8ClampedArray(4*r);for(let o=0;o<r;++o)n[4*o]=i[3*o+2],n[4*o+1]=i[3*o+1],n[4*o+2]=i[3*o],n[4*o+3]=255}else if(Number(t.format)===br.IPF_GRAYSCALED){const r=i.length;n=new Uint8ClampedArray(4*r);for(let o=0;o<r;o++)n[4*o]=n[4*o+1]=n[4*o+2]=i[o],n[4*o+3]=255}else if(Number(t.format)===br.IPF_BINARY_8){const r=i.length,o=t.width,l=t.stride;n=new Uint8ClampedArray(o*t.height*4);for(let h=0;h<r;h++){let p=i[h],C=h%l,D=Math.floor(h/l);for(let T=0;T<8;T++){let A=C+T,M=4*(D*o+A);if(A>=o)break;n[M]=n[M+1]=n[M+2]=(128&p)/128*255,n[M+3]=255,p<<=1}}}else if(Number(t.format)===br.IPF_ABGR_8888){const r=i.length/4;n=new Uint8ClampedArray(i.length);for(let o=0;o<r;++o)n[4*o]=i[4*o],n[4*o+1]=i[4*o+1],n[4*o+2]=i[4*o+2],n[4*o+3]=i[4*o+3]}else if(Number(t.format)===br.IPF_ARGB_8888){const r=i.length/4;n=new Uint8ClampedArray(i.length);for(let o=0;o<r;++o)n[4*o]=i[4*o],n[4*o+1]=i[4*o+1],n[4*o+2]=i[4*o+2],n[4*o+3]=i[4*o+3]}return new ImageData(n,t.width,t.height)}function pk(t,n){let i=t;i.toCanvas=()=>up(n),i.toImage=r=>function(o,s){const l=up(s);let h=new Image,p=l.toDataURL(o);return h.src=p,h}(r,n),i.toBlob=r=>RI(r,n),i.saveToFile=function(){var r=J(function*(o,s){if(!o)return null;if("string"!=typeof o)throw new TypeError("FileName must be of type string.");return(l=J(function*(h,p,C){return yield new Promise(function(){var D=J(function*(T,A){try{const M=p.split(".");let P=M[M.length-1];const B=yield RI(`image/${P}`,h);M.length<=1&&(P="png");const k=new File([B],p,{type:`image/${P}`});if(C){const U=URL.createObjectURL(k),V=document.createElement("a");V.href=U,V.download=p,V.click()}return T(k)}catch{return A()}});return function(T,A){return D.apply(this,arguments)}}())}),function(h,p,C){return l.apply(this,arguments)})(n,o,s);var l});return function(o,s){return r.apply(this,arguments)}}()}function up(t){const n=document.createElement("canvas");return n.width=t.width,n.height=t.height,n.getContext("2d",{willReadFrequently:!0}).putImageData(t,0,0),n}function RI(t,n){return dp.apply(this,arguments)}function dp(){return dp=J(function*(t,n){const i=up(n);return new Promise((r,o)=>{i.toBlob(s=>r(s),t)})}),dp.apply(this,arguments)}const mk="function"==typeof BigInt;class st{constructor(){this._maxCvsSideLength=["iPhone","Android","HarmonyOS"].includes(Xt.browserInfo.OS)?2048:4096,this._isa=null,this._dsImage=null,this._instanceID=void 0,this._bPauseScan=!0,this._bNeedOutputOriginalImage=!1,this._canvas=null,this._irrRegistryState=fk,this._resultReceiverSet=new Set,this._isaStateListenerSet=new Set,this._resultFilterSet=new Set,this._intermediateResultReceiverSet=new Set,this._intermediateResultManager=null,this._templateName="Default",this._bOpenDetectVerify=!1,this._bOpenNormalizeVerify=!1,this._bOpenBarcodeVerify=!1,this._bOpenLabelVerify=!1,this._minImageCaptureInterval=0,this._averageProcessintTimeArray=[],this._averageFetchImageTimeArray=[],this._currentSettings=null,this._averageTime=999,this.captureInParallel=!0,this.bDestroyed=!1,this._singleFrameModeCallbackBind=this._singleFrameModeCallback.bind(this),this._promiseStartScan=null}get maxCvsSideLength(){return this._maxCvsSideLength}set maxCvsSideLength(n){this._maxCvsSideLength=n}get isa(){return this._isa}set isa(n){this._isa=n}get disposed(){return this.bDestroyed}_checkIsDisposed(){if(this.disposed)throw new Error('"CaptureVisionRouter" instance has been disposed')}static createInstance(){return J(function*(){if(!bn.license)throw Error("Module `license` is not existed.");yield bn.license.dynamsoft(),yield zi(["dip","cvr"]);const n=new st,i=new vs;let r=St();return dt[r]=function(){var o=J(function*(s){var l;if(s.success)n._instanceID=s.instanceID,n._currentSettings=yield n.outputSettings("*"),xI._version=`2.0.31(Worker: ${null===(l=io.cvr)||void 0===l?void 0:l.worker}, Wasm: ${s.version})`,0===Xt.bSupportDce4Module&&(n._intermediateResultManager=n.getIntermediateResultManager(!0)),i.resolve(n);else{const h=Error(s.message);s.stack&&(h.stack=s.stack),i.reject(h)}});return function(s){return o.apply(this,arguments)}}(),tt.postMessage({type:"cvr_createInstance",id:r}),i})()}_singleFrameModeCallback(n){var i=this;return J(function*(){i.isa.getCameraView().setScanLaserVisible(!0);for(let h of i._resultReceiverSet)i._bNeedOutputOriginalImage&&h.onOriginalImageResultReceived&&h.onOriginalImageResultReceived({imageData:n});const r={bytes:new Uint8Array(n.bytes),width:n.width,height:n.height,stride:n.stride,format:n.format,tag:n.tag},o=yield i.capture(r,i._templateName,!0);o.originalImageTag=n.tag;for(let h of i._resultReceiverSet)h.isDce&&h.onCapturedResultReceived(o,{isDetectVerifyOpen:!1,isNormalizeVerifyOpen:!1,isBarcodeVerifyOpen:!1,isLabelVerifyOpen:!1});const s={originalImageHashId:o.originalImageHashId,originalImageTag:o.originalImageTag,errorCode:o.errorCode,errorString:o.errorString},l=MI(o);for(let h of i._resultReceiverSet)if(h.onDecodedBarcodesReceived&&l.barcodeResultItems.length&&h.onDecodedBarcodesReceived(Object.assign(Object.assign({},s),{barcodeResultItems:l.barcodeResultItems})),h.onRecognizedTextLinesReceived&&l.textLineResultItems.length&&h.onRecognizedTextLinesReceived(Object.assign(Object.assign({},s),{textLineResultItems:l.textLineResultItems})),h.onDetectedQuadsReceived&&l.quadsResultItems.length&&h.onDetectedQuadsReceived(Object.assign(Object.assign({},s),{quadsResultItems:l.quadsResultItems})),h.onNormalizedImagesReceived&&l.normalizedImageResultItems.length&&h.onNormalizedImagesReceived(Object.assign(Object.assign({},s),{normalizedImageResultItems:l.normalizedImageResultItems})),h.onParsedResultsReceived&&l.parsedResultItems.length&&h.onParsedResultsReceived(Object.assign(Object.assign({},s),{parsedResultItems:l.parsedResultItems})),h.onCapturedResultReceived&&!h.isDce){if(i._bNeedOutputOriginalImage){const p=o.items.findIndex(C=>1===C.type);-1!==p&&(o.items[p].imageData=n)}h.onCapturedResultReceived(o)}})()}setInput(n){if(this._checkIsDisposed(),n){if(this.isa=n,n.isCameraEnhancer){this._intermediateResultManager&&(this.isa._intermediateResultReceiver.isDce=!0,this._intermediateResultManager.addResultReceiver(this.isa._intermediateResultReceiver));const i=this.isa.getCameraView();if(i){const r=i._capturedResultReceiver;r.isDce=!0,this._resultReceiverSet.add(r)}}}else this.isa=null}getInput(){return this._isa}addImageSourceStateListener(n){if(this._checkIsDisposed(),"object"!=typeof n)return console.warn("Invalid ISA state listener.");n&&Object.keys(n)&&this._isaStateListenerSet.add(n)}removeImageSourceStateListener(n){return this._checkIsDisposed(),this._isaStateListenerSet.delete(n)}addResultReceiver(n){if(this._checkIsDisposed(),"object"!=typeof n)throw new Error("Invalid receiver.");n&&Object.keys(n).length&&(this._resultReceiverSet.add(n),this._setCrrRegistry())}removeResultReceiver(n){this._checkIsDisposed(),this._resultReceiverSet.delete(n),this._setCrrRegistry()}_setCrrRegistry(){var n=this;return J(function*(){const i={onCapturedResultReceived:!1,onDecodedBarcodesReceived:!1,onRecognizedTextLinesReceived:!1,onDetectedQuadsReceived:!1,onNormalizedImagesReceived:!1,onParsedResultsReceived:!1};for(let s of n._resultReceiverSet)s.isDce||(i.onCapturedResultReceived=!!s.onCapturedResultReceived,i.onDecodedBarcodesReceived=!!s.onDecodedBarcodesReceived,i.onRecognizedTextLinesReceived=!!s.onRecognizedTextLinesReceived,i.onDetectedQuadsReceived=!!s.onDetectedQuadsReceived,i.onNormalizedImagesReceived=!!s.onNormalizedImagesReceived,i.onParsedResultsReceived=!!s.onParsedResultsReceived);const r=new vs;let o=St();return dt[o]=function(){var s=J(function*(l){if(l.success)r.resolve();else{let h=new Error(l.message);h.stack=l.stack+"\n"+h.stack,r.reject()}});return function(l){return s.apply(this,arguments)}}(),tt.postMessage({type:"cvr_setCrrRegistry",id:o,instanceID:n._instanceID,body:{receiver:JSON.stringify(i)}}),r})()}addResultFilter(n){var i=this;return J(function*(){if(i._checkIsDisposed(),"object"!=typeof n)return console.warn("Invalid filter.");if(n&&Object.keys(n)){i._resultFilterSet.add(n),i._handleFilterSwitch();for(let r of i._resultFilterSet)yield i._enableResultCrossVerification(r.verificationEnabled),yield i._enableResultDeduplication(r.duplicateFilterEnabled),yield i._setDuplicateForgetTime(r.duplicateForgetTime)}})()}removeResultFilter(n){var i=this;return J(function*(){i._checkIsDisposed(),i._resultFilterSet.delete(n),i._handleFilterSwitch();for(let r of i._resultFilterSet)yield i._enableResultCrossVerification(r.verificationEnabled),yield i._enableResultDeduplication(r.duplicateFilterEnabled),yield i._setDuplicateForgetTime(r.duplicateForgetTime)})()}_handleFilterSwitch(){this._bOpenBarcodeVerify=!1,this._bOpenLabelVerify=!1,this._bOpenDetectVerify=!1,this._bOpenNormalizeVerify=!1;for(let n of this._resultFilterSet)n.isResultCrossVerificationEnabled(Re.CRIT_BARCODE)&&(this._bOpenBarcodeVerify=!0),n.isResultCrossVerificationEnabled(Re.CRIT_TEXT_LINE)&&(this._bOpenLabelVerify=!0),n.isResultCrossVerificationEnabled(Re.CRIT_DETECTED_QUAD)&&(this._bOpenDetectVerify=!0),n.isResultCrossVerificationEnabled(Re.CRIT_NORMALIZED_IMAGE)&&(this._bOpenNormalizeVerify=!0)}startCapturing(n="Default"){var i=this;return J(function*(){if(i._checkIsDisposed(),!i._bPauseScan)return;if(!i.isa)throw new Error("'ImageSourceAdapter' is not set. call 'setInput' before 'startCapturing'");const r=yield i.containsTask(n);return yield zi(r),i.isa.isCameraEnhancer&&(r.includes("ddn")?i.isa.setPixelFormat(Oe.IPF_ABGR_8888):i.isa.setPixelFormat(Oe.IPF_GRAYSCALED)),void 0!==i.isa.singleFrameMode&&"disabled"!==i.isa.singleFrameMode?(i._templateName=n,void i.isa.on("singleFrameAcquired",i._singleFrameModeCallbackBind)):(i.isa.getColourChannelUsageType()===Di.CCUT_AUTO&&i.isa.setColourChannelUsageType(r.includes("ddn")?Di.CCUT_FULL_CHANNEL:Di.CCUT_Y_CHANNEL_ONLY),i._promiseStartScan&&i._promiseStartScan.isPending?i._promiseStartScan:(i._promiseStartScan=new vs((o,s)=>{if(i.disposed)return;let l=St();dt[l]=function(){var h=J(function*(p){if(i._promiseStartScan&&!i._promiseStartScan.isFulfilled){if(!p.success){let C=new Error(p.message);return C.stack=p.stack+"\n"+C.stack,s(C)}for(let C of i._resultFilterSet)yield i.addResultFilter(C);i._bPauseScan=!1,i._bNeedOutputOriginalImage=p.bNeedOutputOriginalImage,i._loopReadVideoTimeoutId&&clearTimeout(i._loopReadVideoTimeoutId),i._loopReadVideoTimeoutId=setTimeout(J(function*(){-1!==i._minImageCaptureInterval&&i.isa.startFetching(),i._loopReadVideo(n),o()}),0),i.isa.isCameraEnhancer&&i.isa.getCameraView().setScanLaserVisible(!0)}});return function(p){return h.apply(this,arguments)}}(),tt.postMessage({type:"cvr_startCapturing",id:l,instanceID:i._instanceID,body:{templateName:n}})}),yield i._promiseStartScan))})()}stopCapturing(){this._checkIsDisposed(),this.isa&&(this.isa.isCameraEnhancer&&(this.isa.getCameraView().setScanLaserVisible(!1),void 0!==this.isa.singleFrameMode&&"disabled"!==this.isa.singleFrameMode)?this.isa.off("singleFrameAcquired",this._singleFrameModeCallbackBind):(this.isa.stopFetching(),this._clearVerifyList(),this._averageProcessintTimeArray=[],this._averageTime=999,this._bPauseScan=!0,this._promiseStartScan=null,this.isa.setColourChannelUsageType(Di.CCUT_AUTO)))}_clearVerifyList(){var n=this;return J(function*(){let i=St();const r=new vs;return dt[i]=function(){var o=J(function*(s){if(s.success)return r.resolve();{let l=new Error(s.message);return l.stack=s.stack+"\n"+l.stack,r.reject(l)}});return function(s){return o.apply(this,arguments)}}(),tt.postMessage({type:"cvr_clearVerifyList",id:i,instanceID:n._instanceID}),r})()}_getIntermediateResult(){var n=this;return J(function*(){n._checkIsDisposed();let i=St();const r=new vs;return dt[i]=function(){var o=J(function*(s){if(s.success)r.resolve(s.result);else{let l=new Error(s.message);l.stack=s.stack+"\n"+l.stack,r.reject(l)}});return function(s){return o.apply(this,arguments)}}(),tt.postMessage({type:"cvr_getIntermediateResult",id:i,instanceID:n._instanceID}),r})()}containsTask(n){var i=this;return J(function*(){return i._checkIsDisposed(),yield new Promise((r,o)=>{let s=St();dt[s]=function(){var l=J(function*(h){if(h.success)return r(JSON.parse(h.tasks));{let p=new Error(h.message);return p.stack=h.stack+"\n"+p.stack,o(p)}});return function(h){return l.apply(this,arguments)}}(),tt.postMessage({type:"cvr_containsTask",id:s,instanceID:i._instanceID,body:{templateName:n}})})})()}_loopReadVideo(n){var i=this;return J(function*(){if(i.disposed||i._bPauseScan)return;if(i.isa.isBufferEmpty())if(i.isa.hasNextImageToFetch())for(let s of i._isaStateListenerSet)s.onImageSourceStateReceived&&s.onImageSourceStateReceived(Su.ISS_BUFFER_EMPTY);else if(!i.isa.hasNextImageToFetch())for(let s of i._isaStateListenerSet)s.onImageSourceStateReceived&&s.onImageSourceStateReceived(Su.ISS_EXHAUSTED);if(-1===i._minImageCaptureInterval||i.isa.isBufferEmpty())try{i.isa.isBufferEmpty()&&st._onLog&&st._onLog("buffer is empty so fetch image"),st._onLog&&st._onLog(`DCE: start fetching a frame: ${Date.now()}`),i._dsImage=i.isa.fetchImage(),st._onLog&&st._onLog(`DCE: finish fetching a frame: ${Date.now()}`),i.isa.setImageFetchInterval(i._averageTime)}catch{return void i._reRunCurrnetFunc(n)}else if(i.isa.setImageFetchInterval(i._averageTime-(i._dsImage&&i._dsImage.tag?i._dsImage.tag.timeSpent:0)),i._dsImage=i.isa.getImage(),i._dsImage.tag&&Date.now()-i._dsImage.tag.timeStamp>200)return void i._reRunCurrnetFunc(n);if(!i._dsImage)return void i._reRunCurrnetFunc(n);for(let s of i._resultReceiverSet)i._bNeedOutputOriginalImage&&s.onOriginalImageResultReceived&&s.onOriginalImageResultReceived({imageData:i._dsImage});const r=Date.now();let o=null;i._captureDsimage(i._dsImage,n,!0).then(function(){var s=J(function*(l){if(st._onLog&&st._onLog("no js handle time: "+(Date.now()-r)),o=l,i._bPauseScan)return void i._reRunCurrnetFunc(n);const h=Date.now(),p=o.intermediateResult;if(p){if(p.taskSet)for(let A of p.taskSet.intermediateResultUnits)A.originalImageTag=i._dsImage.tag?i._dsImage.tag:null;for(let A of i._intermediateResultReceiverSet){if(p.taskSet&&A.onTaskResultsReceived&&A.onTaskResultsReceived({intermediateResultUnits:p.taskSet.intermediateResultUnits},p.taskSet.info),p.sectionSet)for(let M in p.sectionSet){for(let P of p.sectionSet[M].asStage)A[M]&&A[M](P.result,P.info);for(let P of p.sectionSet[M].asSection)A[M]&&A[M](P.result,P.info)}if(p.stageSet)for(let M in p.stageSet)for(let P of p.stageSet[M])A[M]&&A[M](P.result,P.info)}}o.originalImageTag=i._dsImage.tag?i._dsImage.tag:null;for(let A of i._resultReceiverSet)if(A.isDce){const M=Date.now();if(A.onCapturedResultReceived(o,{isDetectVerifyOpen:i._bOpenDetectVerify,isNormalizeVerifyOpen:i._bOpenNormalizeVerify,isBarcodeVerifyOpen:i._bOpenBarcodeVerify,isLabelVerifyOpen:i._bOpenLabelVerify}),st._onLog){const P=Date.now()-M;P>10&&st._onLog(`draw result time: ${P}`)}}for(let A of i._resultFilterSet)A.onDecodedBarcodesReceived(o.items),A.onRecognizedTextLinesReceived(o.items),A.onDetectedQuadsReceived(o.items),A.onNormalizedImagesReceived(o.items);const C=MI(o),D={originalImageHashId:o.originalImageHashId,originalImageTag:o.originalImageTag,errorCode:o.errorCode,errorString:o.errorString};for(let A of i._resultReceiverSet)A.onDecodedBarcodesReceived&&C.barcodeResultItems.length&&A.onDecodedBarcodesReceived(Object.assign(Object.assign({},D),{barcodeResultItems:C.barcodeResultItems.filter(M=>!M.isFilter)})),A.onRecognizedTextLinesReceived&&C.textLineResultItems.length&&A.onRecognizedTextLinesReceived(Object.assign(Object.assign({},D),{textLineResultItems:C.textLineResultItems.filter(M=>!M.isFilter)})),A.onDetectedQuadsReceived&&C.quadsResultItems.length&&A.onDetectedQuadsReceived(Object.assign(Object.assign({},D),{quadsResultItems:C.quadsResultItems.filter(M=>!M.isFilter)})),A.onNormalizedImagesReceived&&C.normalizedImageResultItems.length&&A.onNormalizedImagesReceived(Object.assign(Object.assign({},D),{normalizedImageResultItems:C.normalizedImageResultItems.filter(M=>!M.isFilter)})),A.onParsedResultsReceived&&C.parsedResultItems.length&&A.onParsedResultsReceived(Object.assign(Object.assign({},D),{parsedResultItems:C.parsedResultItems.filter(M=>!M.isFilter)})),A.onCapturedResultReceived&&!A.isDce&&(o.items=o.items.filter(M=>!M.isFilter),A.onCapturedResultReceived(o));if(st._onLog){const A=Date.now()-h;A>10&&st._onLog(`callback dispatch time: ${A}`)}const T=Date.now();if(i._minImageCaptureInterval>-1&&(5===i._averageProcessintTimeArray.length&&i._averageProcessintTimeArray.shift(),5===i._averageFetchImageTimeArray.length&&i._averageFetchImageTimeArray.shift(),i._averageProcessintTimeArray.push(Date.now()-r),i._averageFetchImageTimeArray.push(i._dsImage&&i._dsImage.tag?i._dsImage.tag.timeSpent:0),i._averageTime=Math.min(...i._averageProcessintTimeArray)-Math.max(...i._averageFetchImageTimeArray),i._averageTime=i._averageTime>0?i._averageTime:0,st._onLog&&(st._onLog(`minImageCaptureInterval: ${i._minImageCaptureInterval}`),st._onLog(`averageProcessintTimeArray: ${i._averageProcessintTimeArray}`),st._onLog(`averageFetchImageTimeArray: ${i._averageFetchImageTimeArray}`),st._onLog(`averageTime: ${i._averageTime}`))),st._onLog){const A=Date.now()-T;A>10&&st._onLog(`fetch image calculate time: ${A}`)}st._onLog&&st._onLog(`time finish decode: ${Date.now()}`),st._onLog&&st._onLog("main time: "+(Date.now()-r)),st._onLog&&st._onLog("===================================================="),i._loopReadVideoTimeoutId&&clearTimeout(i._loopReadVideoTimeoutId),i._loopReadVideoTimeoutId=i._minImageCaptureInterval>0&&i._minImageCaptureInterval>=i._averageTime?setTimeout(()=>{i._loopReadVideo(n)},i._minImageCaptureInterval-i._averageTime):setTimeout(()=>{i._loopReadVideo(n)},Math.max(i._minImageCaptureInterval,0))});return function(l){return s.apply(this,arguments)}}()).catch(s=>{i.isa.stopFetching(),i._loopReadVideoTimeoutId&&clearTimeout(i._loopReadVideoTimeoutId),i._loopReadVideoTimeoutId=setTimeout(()=>{i.isa.startFetching(),i._loopReadVideo(n)},Math.max(i._minImageCaptureInterval,1e3)),"platform error"!==s.message&&setTimeout(()=>{throw s},0)}).finally(()=>{o&&o.intermediateResult&&delete o.intermediateResult})})()}_reRunCurrnetFunc(n){this._loopReadVideoTimeoutId&&clearTimeout(this._loopReadVideoTimeoutId),this._loopReadVideoTimeoutId=setTimeout(()=>{this._loopReadVideo(n)},0)}capture(n,i="Default",r=!1){var o=this;return J(function*(){o._checkIsDisposed();const s=yield o.containsTask(i);let l;if(yield zi(s),(h=n)&&"object"==typeof h&&!Array.isArray(h)&&"bytes"in h&&"width"in h&&"height"in h&&"stride"in h&&"format"in h)l=yield o._captureDsimage(n,i,r);else if("string"==typeof n)l="data:image/"==n.substring(0,11)?yield o._captureBase64(n,i,r):yield o._captureUrl(n,i,r);else if(n instanceof Blob)l=yield o._captureBlob(n,i,r);else if(n instanceof HTMLImageElement)l=yield o._captureImage(n,i,r);else if(n instanceof HTMLCanvasElement)l=yield o._captureCanvas(n,i,r);else if(n instanceof HTMLVideoElement)l=yield o._captureVideo(n,i,r);else{if(!(n instanceof Uint8Array||n instanceof ArrayBuffer||n instanceof Uint8ClampedArray))throw new TypeError("'capture(imageOrFile, templateName)': Type of 'imageOrFile' should be 'DSImageData', 'Url', 'Base64', 'Blob', 'Uint8Array', 'ArrayBuffer', 'Uint8ClampedArray', 'HTMLImageElement', 'HTMLCanvasElement', 'HTMLVideoElement'.");l=yield o._captureBlob(new Blob([new Uint8Array(n)],{type:"image/png"}),i,r)}var h;const p=yield o._getIntermediateResult();if(p)for(let C of o._intermediateResultReceiverSet){if(p.taskSet&&C.onTaskResultsReceived&&C.onTaskResultsReceived({intermediateResultUnits:p.taskSet.intermediateResultUnits},p.taskSet.info),p.sectionSet)for(let D in p.sectionSet){for(let T of p.sectionSet[D].asStage)C[D]&&C[D](T.result,T.info);for(let T of p.sectionSet[D].asSection)C[D]&&C[D](T.result,T.info)}if(p.stageSet)for(let D in p.stageSet)for(let T of p.stageSet[D])C[D]&&C[D](T.result,T.info)}return l})()}_captureDsimage(n,i,r=!1){var o=this;return J(function*(){return yield o._captureInWorker(n,i,r)})()}_captureUrl(n,i,r=!1){var o=this;return J(function*(){let s=yield OI(n,"blob");return yield o._captureBlob(s,i,r)})()}_captureBase64(n,i,r=!1){var o=this;return J(function*(){n=n.substring(n.indexOf(",")+1);let s=atob(n),l=s.length,h=new Uint8Array(l);for(;l--;)h[l]=s.charCodeAt(l);return yield o._captureBlob(new Blob([h]),i,r)})()}_captureBlob(n,i,r=!1){var o=this;return J(function*(){let s=null,l=null;if(typeof createImageBitmap<"u")try{s=yield createImageBitmap(n)}catch{}var p;s||(l=yield(p=J(function*(C){return yield new Promise((D,T)=>{let A=URL.createObjectURL(C),M=new Image;M.src=A,M.onload=()=>{URL.revokeObjectURL(M.dbrObjUrl),D(M)},M.onerror=P=>{T(new Error("Can't convert blob to image : "+(P instanceof Event?P.type:P)))}})}),function(C){return p.apply(this,arguments)})(n));let h=yield o._captureImage(s||l,i,r);return s&&s.close(),h})()}_captureImage(n,i,r=!1){var o=this;return J(function*(){let s,l,h=n instanceof HTMLImageElement?n.naturalWidth:n.width,p=n instanceof HTMLImageElement?n.naturalHeight:n.height,C=Math.max(h,p);if(C>o.maxCvsSideLength){let T=o.maxCvsSideLength/C;s=Math.round(h*T),l=Math.round(p*T)}else s=h,l=p;o._canvas||(o._canvas=document.createElement("canvas"));const D=o._canvas;return D.width===s&&D.height===l||(D.width=s,D.height=l),D.ctx2d||(D.ctx2d=D.getContext("2d",{willReadFrequently:!0})),D.ctx2d.drawImage(n,0,0,h,p,0,0,s,l),n.dbrObjUrl&&URL.revokeObjectURL(n.dbrObjUrl),yield o._captureCanvas(D,i,r)})()}_captureCanvas(n,i,r=!1){var o=this;return J(function*(){if(n.crossOrigin&&"anonymous"!=n.crossOrigin)throw"cors";if([n.width,n.height].includes(0))throw Error("The width or height of the 'canvas' is 0.");const s=n.ctx2d||n.getContext("2d",{willReadFrequently:!0}),l={bytes:Uint8Array.from(s.getImageData(0,0,n.width,n.height).data),width:n.width,height:n.height,stride:4*n.width,format:10};return yield o._captureInWorker(l,i,r)})()}_captureVideo(n,i,r=!1){var o=this;return J(function*(){if(n.crossOrigin&&"anonymous"!=n.crossOrigin)throw"cors";let s,l,h=n.videoWidth,p=n.videoHeight,C=Math.max(h,p);if(C>o._maxCvsSideLength){let T=o._maxCvsSideLength/C;s=Math.round(h*T),l=Math.round(p*T)}else s=h,l=p;o._canvas||(o._canvas=document.createElement("canvas"));const D=o._canvas;return D.width===s&&D.height===l||(D.width=s,D.height=l),D.ctx2d||(D.ctx2d=D.getContext("2d",{willReadFrequently:!0})),D.ctx2d.drawImage(n,0,0,h,p,0,0,s,l),yield o._captureCanvas(D,i,r)})()}_captureInWorker(n,i,r=!1){var o=this;return J(function*(){const{bytes:s,width:l,height:h,stride:p,format:C}=n;let D=St();const T=new vs;return dt[D]=function(){var A=J(function*(M){var P;if(!M.success){let B=new Error(M.message);return B.stack=M.stack+"\n"+B.stack,T.reject(B)}{const B=Date.now();st._onLog&&(st._onLog(`get result time from worker: ${B}`),st._onLog("worker to main time consume: "+(B-M.workerReturnMsgTime)));try{const k=M.captureResult;n.bytes=M.bytes;for(let U=0;U<k.items.length;U++)if(k.items[U].type===Re.CRIT_NORMALIZED_IMAGE){const V=gk(k.items[U].imageData);pk(k.items[U],V)}else k.items[U].type===Re.CRIT_ORIGINAL_IMAGE?k.items[U].imageData=n:k.items[U].type===Re.CRIT_PARSED_RESULT&&(null===(P=bn.dcp)||void 0===P||P.handleParsedResultItem(k.items[U]));return T.resolve(k)}catch(k){return T.reject(k)}}});return function(M){return A.apply(this,arguments)}}(),st._onLog&&st._onLog(`send buffer to worker: ${Date.now()}`),tt.postMessage({type:"cvr_capture",id:D,instanceID:o._instanceID,body:{bytes:s,width:l,height:h,stride:p,format:C,templateName:i||"",bScanner:r}},[s.buffer]),T})()}initSettings(n){var i=this;return J(function*(){return i._checkIsDisposed(),n&&["string","object"].includes(typeof n)?("string"==typeof n&&(/^(https:\/\/www\.|http:\/\/www\.|https:\/\/|http:\/\/)|^[a-zA-Z0-9]{2,}(\.[a-zA-Z0-9]{2,})(\.[a-zA-Z0-9]{2,})?/.test(n)&&(n=yield OI(n,"text")),i._currentSettings=JSON.parse(n)),"object"==typeof n&&(i._currentSettings=n,n=JSON.stringify(n)),yield new Promise((r,o)=>{let s=St();dt[s]=function(){var l=J(function*(h){if(h.success){const p=JSON.parse(h.response);if(0!==p.exception){let T=new Error(p.description?p.description:"Init Settings Failed.");return T.errorCode=p.exception,o(T)}let C=[],D=JSON.parse(n).CaptureVisionTemplates;for(let T=0;T<D.length;T++){let A=yield i.containsTask(D[T].Name);C=C.concat(A)}return yield zi([...new Set(C)]),i._bNeedOutputOriginalImage=1===i._currentSettings.CaptureVisionTemplates[0].OutputOriginalImage,r(p)}{let p=new Error(h.message);return p.stack=h.stack+"\n"+p.stack,o(p)}});return function(h){return l.apply(this,arguments)}}(),tt.postMessage({type:"cvr_initSettings",id:s,instanceID:i._instanceID,body:{settings:n}})})):console.error("Invalid template.")})()}outputSettings(n){var i=this;return J(function*(){return i._checkIsDisposed(),yield new Promise((r,o)=>{let s=St();dt[s]=function(){var l=J(function*(h){if(h.success){const p=JSON.parse(h.settings);if(0!==p.errorCode){let C=new Error(p.errorString);return C.errorCode=p.errorCode,o(C)}return delete p.errorCode,delete p.errorString,r(p)}{let p=new Error(h.message);return p.stack=h.stack+"\n"+p.stack,o(p)}});return function(h){return l.apply(this,arguments)}}(),tt.postMessage({type:"cvr_outputSettings",id:s,instanceID:i._instanceID,body:{templateName:n||"Default"}})})})()}outputSettingsToFile(n,i,r){var o=this;return J(function*(){const s=yield o.outputSettings(n),l=new Blob([JSON.stringify(s,null,2,function(h,p){return p instanceof Array?JSON.stringify(p):p},2)],{type:"application/json"});if(r){const h=document.createElement("a");h.href=URL.createObjectURL(l),i.endsWith(".json")&&(i=i.replace(".json","")),h.download=`${i}.json`,h.onclick=()=>{setTimeout(()=>{URL.revokeObjectURL(h.href)},500)},h.click()}return l})()}getSimplifiedSettings(n="Default"){var i=this;return J(function*(){i._checkIsDisposed();const r=yield i.containsTask(n);return yield zi(r),yield new Promise((o,s)=>{let l=St();dt[l]=function(){var h=J(function*(p){if(p.success){const C=JSON.parse(p.settings,(D,T)=>mk&&"barcodeFormatIds"===D?BigInt(T):T);if(C.minImageCaptureInterval=i._minImageCaptureInterval,0!==C.code){let D=new Error(C.codeString);return D.errorCode=C.errorCode,s(D)}return delete C.code,delete C.codeString,o(C)}{let C=new Error(p.message);return C.stack=p.stack+"\n"+C.stack,s(C)}});return function(p){return h.apply(this,arguments)}}(),tt.postMessage({type:"cvr_getSimplifiedSettings",id:l,instanceID:i._instanceID,body:{templateName:n}})})})()}updateSettings(n,i){var r=this;return J(function*(){r._checkIsDisposed();const o=yield r.containsTask(n);return yield zi(o),yield new Promise((s,l)=>{let h=St();dt[h]=function(){var p=J(function*(C){if(C.success){const D=JSON.parse(C.response);if(i.minImageCaptureInterval&&i.minImageCaptureInterval>=-1&&(r._minImageCaptureInterval=i.minImageCaptureInterval),r._bNeedOutputOriginalImage=C.bNeedOutputOriginalImage,0!==D.exception){let T=new Error(D.description?D.description:"Update Settings Failed.");return T.errorCode=D.exception,l(T)}return r._currentSettings=yield r.outputSettings("*"),s(D)}{let D=new Error(C.message);return D.stack=C.stack+"\n"+D.stack,l(D)}});return function(C){return p.apply(this,arguments)}}(),tt.postMessage({type:"cvr_updateSettings",id:h,instanceID:r._instanceID,body:{settings:i,templateName:n}})})})()}resetSettings(){var n=this;return J(function*(){return n._checkIsDisposed(),yield new Promise((i,r)=>{let o=St();dt[o]=function(){var s=J(function*(l){if(l.success){const h=JSON.parse(l.response);if(0!==h.exception){let p=new Error(h.description?h.description:"Reset Settings Failed.");return p.errorCode=h.exception,r(p)}return n._currentSettings=yield n.outputSettings("*"),i(h)}{let h=new Error(l.message);return h.stack=l.stack+"\n"+h.stack,r(h)}});return function(l){return s.apply(this,arguments)}}(),tt.postMessage({type:"cvr_resetSettings",id:o,instanceID:n._instanceID})})})()}getIntermediateResultManager(n){var i=this;if(this._checkIsDisposed(),!n&&0!==Xt.bSupportIRTModule)throw new Error("The current license does not support the use of intermediate results.");return this._intermediateResultManager||(this._intermediateResultManager=new hk,this._intermediateResultManager.addResultReceiver=function(){var r=J(function*(o){if("object"!=typeof o)throw new Error("Invalid receiver.");return i._intermediateResultReceiverSet.add(o),i._handleIntermediateResultReceiver(),yield J(function*(){return yield new Promise((s,l)=>{let h=St();dt[h]=function(){var p=J(function*(C){if(C.success)return s();{let D=new Error(C.message);return D.stack=C.stack+"\n"+D.stack,l(D)}});return function(C){return p.apply(this,arguments)}}(),tt.postMessage({type:"cvr_setIrrRegistry",id:h,instanceID:i._instanceID,body:{receiverObj:i._irrRegistryState}})})})()});return function(o){return r.apply(this,arguments)}}(),this._intermediateResultManager.removeResultReceiver=function(){var r=J(function*(o){return i._intermediateResultReceiverSet.delete(o),i._handleIntermediateResultReceiver(),yield new Promise((s,l)=>{let h=St();dt[h]=function(){var p=J(function*(C){if(C.success)return s();{let D=new Error(C.message);return D.stack=C.stack+"\n"+D.stack,l(D)}});return function(C){return p.apply(this,arguments)}}(),tt.postMessage({type:"cvr_setIrrRegistry",id:h,instanceID:i._instanceID,body:{receiverObj:i._irrRegistryState}})})});return function(o){return r.apply(this,arguments)}}(),this._intermediateResultManager.getOriginalImage=function(){var r=J(function*(o){return i._dsImage});return function(o){return r.apply(this,arguments)}}()),this._intermediateResultManager}_handleIntermediateResultReceiver(){for(let n in this._irrRegistryState)this._irrRegistryState[n]=!1;for(let n of this._intermediateResultReceiverSet)if(n.isDce)this._irrRegistryState.onTaskResultsReceivedForDce=!0;else for(let i in n)this._irrRegistryState[i]||(this._irrRegistryState[i]=!!n[i])}_enableResultCrossVerification(n){var i=this;return J(function*(){return i._checkIsDisposed(),yield new Promise((r,o)=>{let s=St();dt[s]=function(){var l=J(function*(h){if(h.success)return r(h.result);{let p=new Error(h.message);return p.stack=h.stack+"\n"+p.stack,o(p)}});return function(h){return l.apply(this,arguments)}}(),tt.postMessage({type:"cvr_enableResultCrossVerification",id:s,instanceID:i._instanceID,body:{verificationEnabled:n}})})})()}_enableResultDeduplication(n){var i=this;return J(function*(){return i._checkIsDisposed(),yield new Promise((r,o)=>{let s=St();dt[s]=function(){var l=J(function*(h){if(h.success)return r(h.result);{let p=new Error(h.message);return p.stack=h.stack+"\n"+p.stack,o(p)}});return function(h){return l.apply(this,arguments)}}(),tt.postMessage({type:"cvr_enableResultDeduplication",id:s,instanceID:i._instanceID,body:{duplicateFilterEnabled:n}})})})()}_setDuplicateForgetTime(n){var i=this;return J(function*(){return i._checkIsDisposed(),yield new Promise((r,o)=>{let s=St();dt[s]=function(){var l=J(function*(h){if(h.success)return r(h.result);{let p=new Error(h.message);return p.stack=h.stack+"\n"+p.stack,o(p)}});return function(h){return l.apply(this,arguments)}}(),tt.postMessage({type:"cvr_setDuplicateForgetTime",id:s,instanceID:i._instanceID,body:{duplicateForgetTime:n}})})})()}_getDuplicateForgetTime(n){var i=this;return J(function*(){return i._checkIsDisposed(),yield new Promise((r,o)=>{let s=St();dt[s]=function(){var l=J(function*(h){if(h.success)return r(h.time);{let p=new Error(h.message);return p.stack=h.stack+"\n"+p.stack,o(p)}});return function(h){return l.apply(this,arguments)}}(),tt.postMessage({type:"cvr_getDuplicateForgetTime",id:s,instanceID:i._instanceID,body:{type:n}})})})()}parseRequiredResources(n){var i=this;return J(function*(){return i._checkIsDisposed(),yield new Promise((r,o)=>{let s=St();dt[s]=function(){var l=J(function*(h){if(h.success)return r(JSON.parse(h.resources));{let p=new Error(h.message);return p.stack=h.stack+"\n"+p.stack,o(p)}});return function(h){return l.apply(this,arguments)}}(),tt.postMessage({type:"cvr_parseRequiredResources",id:s,instanceID:i._instanceID,body:{templateName:n}})})})()}_setThresholdValue(n,i,r){var o=this;return J(function*(){return yield new Promise((s,l)=>{let h=St();dt[h]=function(){var p=J(function*(C){if(C.success)return s();{let D=new Error(C.message);return D.stack=C.stack+"\n"+D.stack,l(D)}});return function(C){return p.apply(this,arguments)}}(),tt.postMessage({type:"cvr_setThresholdValue",id:h,instanceID:o._instanceID,body:{threshold:n,leftLimit:i,rightLimit:r}})})})()}contains(n,i){return function(r,o){let s=o.x,l=o.y,h=r[0].x,p=r[0].y,C=r[1].x,D=r[1].y,T=r[2].x,A=r[2].y,M=r[3].x,P=r[3].y,B=q(s,l,h,p,C,D),k=q(s,l,C,D,T,A),U=q(s,l,T,A,M,P),V=q(s,l,M,P,h,p);function q(ce,ge,ve,me,S,we){return(ce-ve)*(we-me)-(ge-me)*(S-ve)}return B>=0&&k>=0&&U>=0&&V>=0||B<=0&&k<=0&&U<=0&&V<=0}(n,i)}dispose(){var n=this;return J(function*(){n._checkIsDisposed(),n._promiseStartScan&&n.stopCapturing(),n.isa=null,n._resultReceiverSet.clear(),n._isaStateListenerSet.clear(),n._resultFilterSet.clear(),n.bDestroyed=!0;let i=St();dt[i]=r=>{if(!r.success){let o=new Error(r.message);throw o.stack=r.stack+"\n"+o.stack,o}},tt.postMessage({type:"cvr_dispose",id:i,instanceID:n._instanceID})})()}}class _k{constructor(){this.onCapturedResultReceived=null,this.onOriginalImageResultReceived=null}}let vk=(()=>{class t{constructor(){var i=this;this.pInit=null,this.decodeImg=function(){var r=J(function*(o){try{const l=yield(yield i.pInit).capture(o.target.files[0],"ReadBarcodes_SpeedFirst");let h="";for(let p of l.items)console.log(p.text),h+=p.text+"\n";""!=h&&alert(h),l.items.length||alert("No barcode found")}catch(s){let l=s.message||s;console.error(l),alert(l)}o.target.value=""});return function(o){return r.apply(this,arguments)}}()}ngOnInit(){var i=this;return J(function*(){i.pInit=st.createInstance()})()}ngOnDestroy(){var i=this;return J(function*(){i.pInit&&(yield i.pInit).dispose(),console.log("ImageCapture Component Unmount")})()}static#e=this.\u0275fac=function(r){return new(r||t)};static#t=this.\u0275cmp=zs({type:t,selectors:[["app-image-capture"]],decls:2,vars:0,consts:[[1,"div-image-capture"],["type","file","accept",".jpg,.jpeg,.icon,.gif,.svg,.webp,.png,.bmp",3,"change"]],template:function(r,o){1&r&&(vr(0,"div",0)(1,"input",1),Oa("change",function(l){return o.decodeImg(l)}),yr()())},styles:[".div-image-capture[_ngcontent-%COMP%]{display:flex;justify-content:center;align-items:center;width:100%;border:1px solid black}"]})}return t})();var yk={653:(t,n,i)=>{var r,o,s,l,h,p,C,D,T,A,P,B,k,U,V,q,ce,ge,ve,me,m,f,g,v,S=S||{version:"5.2.1"};if(n.fabric=S,typeof document<"u"&&typeof window<"u")S.document=document instanceof(typeof HTMLDocument<"u"?HTMLDocument:Document)?document:document.implementation.createHTMLDocument(""),S.window=window;else{var we=new(i(192).JSDOM)(decodeURIComponent("%3C!DOCTYPE%20html%3E%3Chtml%3E%3Chead%3E%3C%2Fhead%3E%3Cbody%3E%3C%2Fbody%3E%3C%2Fhtml%3E"),{features:{FetchExternalResources:["img"]},resources:"usable"}).window;S.document=we.document,S.jsdomImplForWrapper=i(898).implForWrapper,S.nodeCanvas=i(245).Canvas,S.window=we,DOMParser=S.window.DOMParser}function Me(m,f){var g=m.canvas,v=f.targetCanvas,a=v.getContext("2d");a.translate(0,v.height),a.scale(1,-1),a.drawImage(g,0,g.height-v.height,v.width,v.height,0,0,v.width,v.height)}function nt(m,f){var g=f.targetCanvas.getContext("2d"),v=f.destinationWidth,a=f.destinationHeight,c=v*a*4,_=new Uint8Array(this.imageBuffer,0,c),I=new Uint8ClampedArray(this.imageBuffer,0,c);m.readPixels(0,0,v,a,m.RGBA,m.UNSIGNED_BYTE,_);var y=new ImageData(I,v,a);g.putImageData(y,0,0)}S.isTouchSupported="ontouchstart"in S.window||"ontouchstart"in S.document||S.window&&S.window.navigator&&S.window.navigator.maxTouchPoints>0,S.isLikelyNode=typeof Buffer<"u"&&typeof window>"u",S.SHARED_ATTRIBUTES=["display","transform","fill","fill-opacity","fill-rule","opacity","stroke","stroke-dasharray","stroke-linecap","stroke-dashoffset","stroke-linejoin","stroke-miterlimit","stroke-opacity","stroke-width","id","paint-order","vector-effect","instantiated_by_use","clip-path"],S.DPI=96,S.reNum="(?:[-+]?(?:\\d+|\\d*\\.\\d+)(?:[eE][-+]?\\d+)?)",S.commaWsp="(?:\\s+,?\\s*|,\\s*)",S.rePathCommand=/([-+]?((\d+\.\d+)|((\d+)|(\.\d+)))(?:[eE][-+]?\d+)?)/gi,S.reNonWord=/[ \n\.,;!\?\-]/,S.fontPaths={},S.iMatrix=[1,0,0,1,0,0],S.svgNS="http://www.w3.org/2000/svg",S.perfLimitSizeTotal=2097152,S.maxCacheSideLimit=4096,S.minCacheSideLimit=256,S.charWidthsCache={},S.textureSize=2048,S.disableStyleCopyPaste=!1,S.enableGLFiltering=!0,S.devicePixelRatio=S.window.devicePixelRatio||S.window.webkitDevicePixelRatio||S.window.mozDevicePixelRatio||1,S.browserShadowBlurConstant=1,S.arcToSegmentsCache={},S.boundsOfCurveCache={},S.cachesBoundsOfCurve=!0,S.forceGLPutImageData=!1,S.initFilterBackend=function(){return S.enableGLFiltering&&S.isWebglSupported&&S.isWebglSupported(S.textureSize)?(console.log("max texture size: "+S.maxTextureSize),new S.WebglFilterBackend({tileSize:S.textureSize})):S.Canvas2dFilterBackend?new S.Canvas2dFilterBackend:void 0},typeof document<"u"&&typeof window<"u"&&(window.fabric=S),function(){function m(g,v){if(this.__eventListeners[g]){var a=this.__eventListeners[g];v?a[a.indexOf(v)]=!1:S.util.array.fill(a,!1)}}function f(g,v){var a=function(){v.apply(this,arguments),this.off(g,a)}.bind(this);this.on(g,a)}S.Observable={fire:function(g,v){if(!this.__eventListeners)return this;var a=this.__eventListeners[g];if(!a)return this;for(var c=0,_=a.length;c<_;c++)a[c]&&a[c].call(this,v||{});return this.__eventListeners[g]=a.filter(function(I){return!1!==I}),this},on:function(g,v){if(this.__eventListeners||(this.__eventListeners={}),1===arguments.length)for(var a in g)this.on(a,g[a]);else this.__eventListeners[g]||(this.__eventListeners[g]=[]),this.__eventListeners[g].push(v);return this},once:function(g,v){if(1===arguments.length)for(var a in g)f.call(this,a,g[a]);else f.call(this,g,v);return this},off:function(g,v){if(!this.__eventListeners)return this;if(0===arguments.length)for(g in this.__eventListeners)m.call(this,g);else if(1===arguments.length&&"object"==typeof arguments[0])for(var a in g)m.call(this,a,g[a]);else m.call(this,g,v);return this}}}(),S.Collection={_objects:[],add:function(){if(this._objects.push.apply(this._objects,arguments),this._onObjectAdded)for(var m=0,f=arguments.length;m<f;m++)this._onObjectAdded(arguments[m]);return this.renderOnAddRemove&&this.requestRenderAll(),this},insertAt:function(m,f,g){var v=this._objects;return g?v[f]=m:v.splice(f,0,m),this._onObjectAdded&&this._onObjectAdded(m),this.renderOnAddRemove&&this.requestRenderAll(),this},remove:function(){for(var m,f=this._objects,g=!1,v=0,a=arguments.length;v<a;v++)-1!==(m=f.indexOf(arguments[v]))&&(g=!0,f.splice(m,1),this._onObjectRemoved&&this._onObjectRemoved(arguments[v]));return this.renderOnAddRemove&&g&&this.requestRenderAll(),this},forEachObject:function(m,f){for(var g=this.getObjects(),v=0,a=g.length;v<a;v++)m.call(f,g[v],v,g);return this},getObjects:function(m){return void 0===m?this._objects.concat():this._objects.filter(function(f){return f.type===m})},item:function(m){return this._objects[m]},isEmpty:function(){return 0===this._objects.length},size:function(){return this._objects.length},contains:function(m,f){return this._objects.indexOf(m)>-1||!!f&&this._objects.some(function(g){return"function"==typeof g.contains&&g.contains(m,!0)})},complexity:function(){return this._objects.reduce(function(m,f){return m+(f.complexity?f.complexity():0)},0)}},S.CommonMethods={_setOptions:function(m){for(var f in m)this.set(f,m[f])},_initGradient:function(m,f){!m||!m.colorStops||m instanceof S.Gradient||this.set(f,new S.Gradient(m))},_initPattern:function(m,f,g){!m||!m.source||m instanceof S.Pattern?g&&g():this.set(f,new S.Pattern(m,g))},_setObject:function(m){for(var f in m)this._set(f,m[f])},set:function(m,f){return"object"==typeof m?this._setObject(m):this._set(m,f),this},_set:function(m,f){this[m]=f},toggle:function(m){var f=this.get(m);return"boolean"==typeof f&&this.set(m,!f),this},get:function(m){return this[m]}},r=n,o=Math.sqrt,s=Math.atan2,l=Math.pow,h=Math.PI/180,p=Math.PI/2,S.util={cos:function(m){if(0===m)return 1;switch(m<0&&(m=-m),m/p){case 1:case 3:return 0;case 2:return-1}return Math.cos(m)},sin:function(m){if(0===m)return 0;var f=1;switch(m<0&&(f=-1),m/p){case 1:return f;case 2:return 0;case 3:return-f}return Math.sin(m)},removeFromArray:function(m,f){var g=m.indexOf(f);return-1!==g&&m.splice(g,1),m},getRandomInt:function(m,f){return Math.floor(Math.random()*(f-m+1))+m},degreesToRadians:function(m){return m*h},radiansToDegrees:function(m){return m/h},rotatePoint:function(m,f,g){var v=new S.Point(m.x-f.x,m.y-f.y),a=S.util.rotateVector(v,g);return new S.Point(a.x,a.y).addEquals(f)},rotateVector:function(m,f){var g=S.util.sin(f),v=S.util.cos(f);return{x:m.x*v-m.y*g,y:m.x*g+m.y*v}},createVector:function(m,f){return new S.Point(f.x-m.x,f.y-m.y)},calcAngleBetweenVectors:function(m,f){return Math.acos((m.x*f.x+m.y*f.y)/(Math.hypot(m.x,m.y)*Math.hypot(f.x,f.y)))},getHatVector:function(m){return new S.Point(m.x,m.y).multiply(1/Math.hypot(m.x,m.y))},getBisector:function(m,f,g){var v=S.util.createVector(m,f),a=S.util.createVector(m,g),c=S.util.calcAngleBetweenVectors(v,a),_=c*(0===S.util.calcAngleBetweenVectors(S.util.rotateVector(v,c),a)?1:-1)/2;return{vector:S.util.getHatVector(S.util.rotateVector(v,_)),angle:c}},projectStrokeOnPoints:function(m,f,g){var v=[],a=f.strokeWidth/2,c=f.strokeUniform?new S.Point(1/f.scaleX,1/f.scaleY):new S.Point(1,1),_=function(I){var y=a/Math.hypot(I.x,I.y);return new S.Point(I.x*y*c.x,I.y*y*c.y)};return m.length<=1||m.forEach(function(I,y){var w,b,x=new S.Point(I.x,I.y);0===y?(b=m[y+1],w=g?_(S.util.createVector(b,x)).addEquals(x):m[m.length-1]):y===m.length-1?(w=m[y-1],b=g?_(S.util.createVector(w,x)).addEquals(x):m[0]):(w=m[y-1],b=m[y+1]);var O,F,L=S.util.getBisector(x,w,b),N=L.vector;if("miter"===f.strokeLineJoin&&(O=-a/Math.sin(L.angle/2),F=new S.Point(N.x*O*c.x,N.y*O*c.y),Math.hypot(F.x,F.y)/a<=f.strokeMiterLimit))return v.push(x.add(F)),void v.push(x.subtract(F));O=-a*Math.SQRT2,F=new S.Point(N.x*O*c.x,N.y*O*c.y),v.push(x.add(F)),v.push(x.subtract(F))}),v},transformPoint:function(m,f,g){return g?new S.Point(f[0]*m.x+f[2]*m.y,f[1]*m.x+f[3]*m.y):new S.Point(f[0]*m.x+f[2]*m.y+f[4],f[1]*m.x+f[3]*m.y+f[5])},makeBoundingBoxFromPoints:function(m,f){if(f)for(var g=0;g<m.length;g++)m[g]=S.util.transformPoint(m[g],f);var v=[m[0].x,m[1].x,m[2].x,m[3].x],a=S.util.array.min(v),c=S.util.array.max(v)-a,_=[m[0].y,m[1].y,m[2].y,m[3].y],I=S.util.array.min(_);return{left:a,top:I,width:c,height:S.util.array.max(_)-I}},invertTransform:function(m){var f=1/(m[0]*m[3]-m[1]*m[2]),g=[f*m[3],-f*m[1],-f*m[2],f*m[0]],v=S.util.transformPoint({x:m[4],y:m[5]},g,!0);return g[4]=-v.x,g[5]=-v.y,g},toFixed:function(m,f){return parseFloat(Number(m).toFixed(f))},parseUnit:function(m,f){var g=/\D{0,2}$/.exec(m),v=parseFloat(m);switch(f||(f=S.Text.DEFAULT_SVG_FONT_SIZE),g[0]){case"mm":return v*S.DPI/25.4;case"cm":return v*S.DPI/2.54;case"in":return v*S.DPI;case"pt":return v*S.DPI/72;case"pc":return v*S.DPI/72*12;case"em":return v*f;default:return v}},falseFunction:function(){return!1},getKlass:function(m,f){return m=S.util.string.camelize(m.charAt(0).toUpperCase()+m.slice(1)),S.util.resolveNamespace(f)[m]},getSvgAttributes:function(m){var f=["instantiated_by_use","style","id","class"];switch(m){case"linearGradient":f=f.concat(["x1","y1","x2","y2","gradientUnits","gradientTransform"]);break;case"radialGradient":f=f.concat(["gradientUnits","gradientTransform","cx","cy","r","fx","fy","fr"]);break;case"stop":f=f.concat(["offset","stop-color","stop-opacity"])}return f},resolveNamespace:function(m){if(!m)return S;var f,g=m.split("."),v=g.length,a=r||S.window;for(f=0;f<v;++f)a=a[g[f]];return a},loadImage:function(m,f,g,v){if(m){var a=S.util.createImage(),c=function(){f&&f.call(g,a,!1),a=a.onload=a.onerror=null};a.onload=c,a.onerror=function(){S.log("Error loading "+a.src),f&&f.call(g,null,!0),a=a.onload=a.onerror=null},0!==m.indexOf("data")&&null!=v&&(a.crossOrigin=v),"data:image/svg"===m.substring(0,14)&&(a.onload=null,S.util.loadImageInDom(a,c)),a.src=m}else f&&f.call(g,m)},loadImageInDom:function(m,f){var g=S.document.createElement("div");g.style.width=g.style.height="1px",g.style.left=g.style.top="-100%",g.style.position="absolute",g.appendChild(m),S.document.querySelector("body").appendChild(g),m.onload=function(){f(),g.parentNode.removeChild(g),g=null}},enlivenObjects:function(m,f,g,v){var a=[],c=0,_=(m=m||[]).length;function I(){++c===_&&f&&f(a.filter(function(y){return y}))}_?m.forEach(function(y,w){y&&y.type?S.util.getKlass(y.type,g).fromObject(y,function(b,x){x||(a[w]=b),v&&v(y,b,x),I()}):I()}):f&&f(a)},enlivenObjectEnlivables:function(m,f,g){var v=S.Object.ENLIVEN_PROPS.filter(function(a){return!!m[a]});S.util.enlivenObjects(v.map(function(a){return m[a]}),function(a){var c={};v.forEach(function(_,I){c[_]=a[I],f&&(f[_]=a[I])}),g&&g(c)})},enlivenPatterns:function(m,f){function g(){++a===c&&f&&f(v)}var v=[],a=0,c=(m=m||[]).length;c?m.forEach(function(_,I){_&&_.source?new S.Pattern(_,function(y){v[I]=y,g()}):(v[I]=_,g())}):f&&f(v)},groupSVGElements:function(m,f,g){var v;return m&&1===m.length?m[0]:(f&&(f.width&&f.height?f.centerPoint={x:f.width/2,y:f.height/2}:(delete f.width,delete f.height)),v=new S.Group(m,f),void 0!==g&&(v.sourcePath=g),v)},populateWithProperties:function(m,f,g){if(g&&Array.isArray(g))for(var v=0,a=g.length;v<a;v++)g[v]in m&&(f[g[v]]=m[g[v]])},createCanvasElement:function(){return S.document.createElement("canvas")},copyCanvasElement:function(m){var f=S.util.createCanvasElement();return f.width=m.width,f.height=m.height,f.getContext("2d").drawImage(m,0,0),f},toDataURL:function(m,f,g){return m.toDataURL("image/"+f,g)},createImage:function(){return S.document.createElement("img")},multiplyTransformMatrices:function(m,f,g){return[m[0]*f[0]+m[2]*f[1],m[1]*f[0]+m[3]*f[1],m[0]*f[2]+m[2]*f[3],m[1]*f[2]+m[3]*f[3],g?0:m[0]*f[4]+m[2]*f[5]+m[4],g?0:m[1]*f[4]+m[3]*f[5]+m[5]]},qrDecompose:function(m){var f=s(m[1],m[0]),g=l(m[0],2)+l(m[1],2),v=o(g),a=(m[0]*m[3]-m[2]*m[1])/v,c=s(m[0]*m[2]+m[1]*m[3],g);return{angle:f/h,scaleX:v,scaleY:a,skewX:c/h,skewY:0,translateX:m[4],translateY:m[5]}},calcRotateMatrix:function(m){if(!m.angle)return S.iMatrix.concat();var f=S.util.degreesToRadians(m.angle),g=S.util.cos(f),v=S.util.sin(f);return[g,v,-v,g,0,0]},calcDimensionsMatrix:function(m){var f=void 0===m.scaleX?1:m.scaleX,g=void 0===m.scaleY?1:m.scaleY,v=[m.flipX?-f:f,0,0,m.flipY?-g:g,0,0],a=S.util.multiplyTransformMatrices,c=S.util.degreesToRadians;return m.skewX&&(v=a(v,[1,0,Math.tan(c(m.skewX)),1],!0)),m.skewY&&(v=a(v,[1,Math.tan(c(m.skewY)),0,1],!0)),v},composeMatrix:function(m){var f=[1,0,0,1,m.translateX||0,m.translateY||0],g=S.util.multiplyTransformMatrices;return m.angle&&(f=g(f,S.util.calcRotateMatrix(m))),(1!==m.scaleX||1!==m.scaleY||m.skewX||m.skewY||m.flipX||m.flipY)&&(f=g(f,S.util.calcDimensionsMatrix(m))),f},resetObjectTransform:function(m){m.scaleX=1,m.scaleY=1,m.skewX=0,m.skewY=0,m.flipX=!1,m.flipY=!1,m.rotate(0)},saveObjectTransform:function(m){return{scaleX:m.scaleX,scaleY:m.scaleY,skewX:m.skewX,skewY:m.skewY,angle:m.angle,left:m.left,flipX:m.flipX,flipY:m.flipY,top:m.top}},isTransparent:function(m,f,g,v){v>0&&(f>v?f-=v:f=0,g>v?g-=v:g=0);var a,c=!0,_=m.getImageData(f,g,2*v||1,2*v||1),I=_.data.length;for(a=3;a<I&&0!=(c=_.data[a]<=0);a+=4);return _=null,c},parsePreserveAspectRatioAttribute:function(m){var f,g="meet",v=m.split(" ");return v&&v.length&&("meet"!==(g=v.pop())&&"slice"!==g?(f=g,g="meet"):v.length&&(f=v.pop())),{meetOrSlice:g,alignX:"none"!==f?f.slice(1,4):"none",alignY:"none"!==f?f.slice(5,8):"none"}},clearFabricFontCache:function(m){(m=(m||"").toLowerCase())?S.charWidthsCache[m]&&delete S.charWidthsCache[m]:S.charWidthsCache={}},limitDimsByArea:function(m,f){var g=Math.sqrt(f*m),v=Math.floor(f/g);return{x:Math.floor(g),y:v}},capValue:function(m,f,g){return Math.max(m,Math.min(f,g))},findScaleToFit:function(m,f){return Math.min(f.width/m.width,f.height/m.height)},findScaleToCover:function(m,f){return Math.max(f.width/m.width,f.height/m.height)},matrixToSVG:function(m){return"matrix("+m.map(function(f){return S.util.toFixed(f,S.Object.NUM_FRACTION_DIGITS)}).join(" ")+")"},removeTransformFromObject:function(m,f){var g=S.util.invertTransform(f),v=S.util.multiplyTransformMatrices(g,m.calcOwnMatrix());S.util.applyTransformToObject(m,v)},addTransformToObject:function(m,f){S.util.applyTransformToObject(m,S.util.multiplyTransformMatrices(f,m.calcOwnMatrix()))},applyTransformToObject:function(m,f){var g=S.util.qrDecompose(f),v=new S.Point(g.translateX,g.translateY);m.flipX=!1,m.flipY=!1,m.set("scaleX",g.scaleX),m.set("scaleY",g.scaleY),m.skewX=g.skewX,m.skewY=g.skewY,m.angle=g.angle,m.setPositionByOrigin(v,"center","center")},sizeAfterTransform:function(m,f,g){var v=m/2,a=f/2,c=[{x:-v,y:-a},{x:v,y:-a},{x:-v,y:a},{x:v,y:a}],_=S.util.calcDimensionsMatrix(g),I=S.util.makeBoundingBoxFromPoints(c,_);return{x:I.width,y:I.height}},mergeClipPaths:function(m,f){var g=m,v=f;g.inverted&&!v.inverted&&(g=f,v=m),S.util.applyTransformToObject(v,S.util.multiplyTransformMatrices(S.util.invertTransform(g.calcTransformMatrix()),v.calcTransformMatrix()));var a=g.inverted&&v.inverted;return a&&(g.inverted=v.inverted=!1),new S.Group([g],{clipPath:v,inverted:a})}},function(){var m=Array.prototype.join,f={m:2,l:2,h:1,v:1,c:6,s:4,q:4,t:2,a:7},g={m:"l",M:"L"};function v(F,L,N,j,$,X,ie,ee,Q,W,H){var Z=S.util.cos(F),ne=S.util.sin(F),re=S.util.cos(L),z=S.util.sin(L),Y=N*$*re-j*X*z+ie,K=j*$*re+N*X*z+ee;return["C",W+Q*(-N*$*ne-j*X*Z),H+Q*(-j*$*ne+N*X*Z),Y+Q*(N*$*z+j*X*re),K+Q*(j*$*z-N*X*re),Y,K]}function a(F,L,N,j){var $=Math.atan2(L,F),X=Math.atan2(j,N);return X>=$?X-$:2*Math.PI-($-X)}function c(F,L,N){for(var Q=function(Z,ne,re,z,Y,K,oe){var te=Math.PI,ae=oe*te/180,_e=S.util.sin(ae),he=S.util.cos(ae),ue=0,pe=0,fe=-he*Z*.5-_e*ne*.5,Ce=-he*ne*.5+_e*Z*.5,Ae=(re=Math.abs(re))*re,Ie=(z=Math.abs(z))*z,Ye=Ce*Ce,ft=fe*fe,Zn=Ae*Ie-Ae*Ye-Ie*ft,ar=0;if(Zn<0){var ks=Math.sqrt(1-Zn/(Ae*Ie));re*=ks,z*=ks}else ar=(Y===K?-1:1)*Math.sqrt(Zn/(Ae*Ye+Ie*ft));var Ot=ar*re*Ce/z,Kn=-ar*z*fe/re,El=he*Ot-_e*Kn+.5*Z,Bs=_e*Ot+he*Kn+.5*ne,po=a(1,0,(fe-Ot)/re,(Ce-Kn)/z),js=a((fe-Ot)/re,(Ce-Kn)/z,(-fe-Ot)/re,(-Ce-Kn)/z);0===K&&js>0?js-=2*te:1===K&&js<0&&(js+=2*te);for(var hD=Math.ceil(Math.abs(js/te*2)),cd=[],Il=js/hD,$k=8/3*Math.sin(Il/4)*Math.sin(Il/4)/Math.sin(Il/2),Yp=po+Il,Dl=0;Dl<hD;Dl++)cd[Dl]=v(po,Yp,he,_e,re,z,El,Bs,$k,ue,pe),ue=cd[Dl][5],pe=cd[Dl][6],po=Yp,Yp+=Il;return cd}(N[6]-F,N[7]-L,N[1],N[2],N[4],N[5],N[3]),W=0,H=Q.length;W<H;W++)Q[W][1]+=F,Q[W][2]+=L,Q[W][3]+=F,Q[W][4]+=L,Q[W][5]+=F,Q[W][6]+=L;return Q}function _(F,L,N,j){return Math.sqrt((N-F)*(N-F)+(j-L)*(j-L))}function I(F,L,N,j,$,X,ie,ee){return function(Q){var W,z,H=(W=Q)*W*W,Z=3*(z=Q)*z*(1-z),ne=function(z){return 3*z*(1-z)*(1-z)}(Q),re=function(z){return(1-z)*(1-z)*(1-z)}(Q);return{x:ie*H+$*Z+N*ne+F*re,y:ee*H+X*Z+j*ne+L*re}}}function y(F,L,N,j,$,X,ie,ee){return function(Q){var W=1-Q;return Math.atan2(3*W*W*(j-L)+6*W*Q*(X-j)+3*Q*Q*(ee-X),3*W*W*(N-F)+6*W*Q*($-N)+3*Q*Q*(ie-$))}}function w(F,L,N,j,$,X){return function(ie){var ee,Z,Q=(ee=ie)*ee,W=2*(Z=ie)*(1-Z),H=function(Z){return(1-Z)*(1-Z)}(ie);return{x:$*Q+N*W+F*H,y:X*Q+j*W+L*H}}}function b(F,L,N,j,$,X){return function(ie){var ee=1-ie;return Math.atan2(2*ee*(j-L)+2*ie*(X-j),2*ee*(N-F)+2*ie*($-N))}}function x(F,L,N){var j,$,X={x:L,y:N},ie=0;for($=1;$<=100;$+=1)j=F($/100),ie+=_(X.x,X.y,j.x,j.y),X=j;return ie}function O(F){for(var L,N,j,$,X=0,ie=F.length,ee=0,Q=0,W=0,H=0,Z=[],ne=0;ne<ie;ne++){switch(j={x:ee,y:Q,command:(L=F[ne])[0]},L[0]){case"M":j.length=0,W=ee=L[1],H=Q=L[2];break;case"L":j.length=_(ee,Q,L[1],L[2]),ee=L[1],Q=L[2];break;case"C":N=I(ee,Q,L[1],L[2],L[3],L[4],L[5],L[6]),$=y(ee,Q,L[1],L[2],L[3],L[4],L[5],L[6]),j.iterator=N,j.angleFinder=$,j.length=x(N,ee,Q),ee=L[5],Q=L[6];break;case"Q":N=w(ee,Q,L[1],L[2],L[3],L[4]),$=b(ee,Q,L[1],L[2],L[3],L[4]),j.iterator=N,j.angleFinder=$,j.length=x(N,ee,Q),ee=L[3],Q=L[4];break;case"Z":case"z":j.destX=W,j.destY=H,j.length=_(ee,Q,W,H),ee=W,Q=H}X+=j.length,Z.push(j)}return Z.push({length:X,x:ee,y:Q}),Z}S.util.joinPath=function(F){return F.map(function(L){return L.join(" ")}).join(" ")},S.util.parsePath=function(F){var L,N,j,$,X,ie=[],ee=[],Q=S.rePathCommand,W="[-+]?(?:\\d*\\.\\d+|\\d+\\.?)(?:[eE][-+]?\\d+)?\\s*",H="("+W+")"+S.commaWsp,Z="([01])"+S.commaWsp+"?",ne=new RegExp(H+"?"+H+"?"+H+Z+Z+H+"?("+W+")","g");if(!F||!F.match)return ie;for(var re,z=0,Y=(X=F.match(/[mzlhvcsqta][^mzlhvcsqta]*/gi)).length;z<Y;z++){$=(L=X[z]).slice(1).trim(),ee.length=0;var K=L.charAt(0);if(re=[K],"a"===K.toLowerCase())for(var oe;oe=ne.exec($);)for(var te=1;te<oe.length;te++)ee.push(oe[te]);else for(;j=Q.exec($);)ee.push(j[0]);te=0;for(var ae=ee.length;te<ae;te++)N=parseFloat(ee[te]),isNaN(N)||re.push(N);var _e=f[K.toLowerCase()],he=g[K]||K;if(re.length-1>_e)for(var ue=1,pe=re.length;ue<pe;ue+=_e)ie.push([K].concat(re.slice(ue,ue+_e))),K=he;else ie.push(re)}return ie},S.util.makePathSimpler=function(F){var L,N,j,$,X,ie,ee=0,Q=0,W=F.length,H=0,Z=0,ne=[];for(N=0;N<W;++N){switch(j=!1,(L=F[N].slice(0))[0]){case"l":L[0]="L",L[1]+=ee,L[2]+=Q;case"L":ee=L[1],Q=L[2];break;case"h":L[1]+=ee;case"H":L[0]="L",L[2]=Q,ee=L[1];break;case"v":L[1]+=Q;case"V":L[0]="L",Q=L[1],L[1]=ee,L[2]=Q;break;case"m":L[0]="M",L[1]+=ee,L[2]+=Q;case"M":ee=L[1],Q=L[2],H=L[1],Z=L[2];break;case"c":L[0]="C",L[1]+=ee,L[2]+=Q,L[3]+=ee,L[4]+=Q,L[5]+=ee,L[6]+=Q;case"C":X=L[3],ie=L[4],ee=L[5],Q=L[6];break;case"s":L[0]="S",L[1]+=ee,L[2]+=Q,L[3]+=ee,L[4]+=Q;case"S":"C"===$?(X=2*ee-X,ie=2*Q-ie):(X=ee,ie=Q),ee=L[3],Q=L[4],L[0]="C",L[5]=L[3],L[6]=L[4],L[3]=L[1],L[4]=L[2],L[1]=X,L[2]=ie,X=L[3],ie=L[4];break;case"q":L[0]="Q",L[1]+=ee,L[2]+=Q,L[3]+=ee,L[4]+=Q;case"Q":X=L[1],ie=L[2],ee=L[3],Q=L[4];break;case"t":L[0]="T",L[1]+=ee,L[2]+=Q;case"T":"Q"===$?(X=2*ee-X,ie=2*Q-ie):(X=ee,ie=Q),L[0]="Q",ee=L[1],Q=L[2],L[1]=X,L[2]=ie,L[3]=ee,L[4]=Q;break;case"a":L[0]="A",L[6]+=ee,L[7]+=Q;case"A":j=!0,ne=ne.concat(c(ee,Q,L)),ee=L[6],Q=L[7];break;case"z":case"Z":ee=H,Q=Z}j||ne.push(L),$=L[0]}return ne},S.util.getSmoothPathFromPoints=function(F,L){var N,j=[],$=new S.Point(F[0].x,F[0].y),X=new S.Point(F[1].x,F[1].y),ie=F.length,ee=1,Q=0,W=ie>2;for(W&&(ee=F[2].x<X.x?-1:F[2].x===X.x?0:1,Q=F[2].y<X.y?-1:F[2].y===X.y?0:1),j.push(["M",$.x-ee*(L=L||0),$.y-Q*L]),N=1;N<ie;N++){if(!$.eq(X)){var H=$.midPointFrom(X);j.push(["Q",$.x,$.y,H.x,H.y])}$=F[N],N+1<F.length&&(X=F[N+1])}return W&&(ee=$.x>F[N-2].x?1:$.x===F[N-2].x?0:-1,Q=$.y>F[N-2].y?1:$.y===F[N-2].y?0:-1),j.push(["L",$.x+ee*L,$.y+Q*L]),j},S.util.getPathSegmentsInfo=O,S.util.getBoundsOfCurve=function(F,L,N,j,$,X,ie,ee){var Q;if(S.cachesBoundsOfCurve&&(Q=m.call(arguments),S.boundsOfCurveCache[Q]))return S.boundsOfCurveCache[Q];var W,H,Z,ne,re,z,Y,K,oe=Math.sqrt,te=Math.min,ae=Math.max,_e=Math.abs,he=[],ue=[[],[]];H=6*F-12*N+6*$,W=-3*F+9*N-9*$+3*ie,Z=3*N-3*F;for(var pe=0;pe<2;++pe)if(pe>0&&(H=6*L-12*j+6*X,W=-3*L+9*j-9*X+3*ee,Z=3*j-3*L),_e(W)<1e-12){if(_e(H)<1e-12)continue;0<(ne=-Z/H)&&ne<1&&he.push(ne)}else(Y=H*H-4*Z*W)<0||(0<(re=(-H+(K=oe(Y)))/(2*W))&&re<1&&he.push(re),0<(z=(-H-K)/(2*W))&&z<1&&he.push(z));for(var fe,Ae,Ie=he.length,Ye=Ie;Ie--;)fe=(Ae=1-(ne=he[Ie]))*Ae*Ae*F+3*Ae*Ae*ne*N+3*Ae*ne*ne*$+ne*ne*ne*ie,ue[0][Ie]=fe,ue[1][Ie]=Ae*Ae*Ae*L+3*Ae*Ae*ne*j+3*Ae*ne*ne*X+ne*ne*ne*ee;ue[0][Ye]=F,ue[1][Ye]=L,ue[0][Ye+1]=ie,ue[1][Ye+1]=ee;var ft=[{x:te.apply(null,ue[0]),y:te.apply(null,ue[1])},{x:ae.apply(null,ue[0]),y:ae.apply(null,ue[1])}];return S.cachesBoundsOfCurve&&(S.boundsOfCurveCache[Q]=ft),ft},S.util.getPointOnPath=function(F,L,N){N||(N=O(F));for(var j=0;L-N[j].length>0&&j<N.length-2;)L-=N[j].length,j++;var $,X=N[j],ie=L/X.length,Q=F[j];switch(X.command){case"M":return{x:X.x,y:X.y,angle:0};case"Z":case"z":return($=new S.Point(X.x,X.y).lerp(new S.Point(X.destX,X.destY),ie)).angle=Math.atan2(X.destY-X.y,X.destX-X.x),$;case"L":return($=new S.Point(X.x,X.y).lerp(new S.Point(Q[1],Q[2]),ie)).angle=Math.atan2(Q[2]-X.y,Q[1]-X.x),$;case"C":case"Q":return function(W,H){for(var Z,ne,re,z=0,Y=0,K=W.iterator,oe={x:W.x,y:W.y},te=.01,ae=W.angleFinder;Y<H&&te>1e-4;)Z=K(z),re=z,(ne=_(oe.x,oe.y,Z.x,Z.y))+Y>H?(z-=te,te/=2):(oe=Z,z+=te,Y+=ne);return Z.angle=ae(re),Z}(X,L)}},S.util.transformPath=function(F,L,N){return N&&(L=S.util.multiplyTransformMatrices(L,[1,0,0,1,-N.x,-N.y])),F.map(function(j){for(var $=j.slice(0),X={},ie=1;ie<j.length-1;ie+=2)X.x=j[ie],X.y=j[ie+1],X=S.util.transformPoint(X,L),$[ie]=X.x,$[ie+1]=X.y;return $})}}(),function(){var m=Array.prototype.slice;function f(g,v,a){if(g&&0!==g.length){var c=g.length-1,_=v?g[c][v]:g[c];if(v)for(;c--;)a(g[c][v],_)&&(_=g[c][v]);else for(;c--;)a(g[c],_)&&(_=g[c]);return _}}S.util.array={fill:function(g,v){for(var a=g.length;a--;)g[a]=v;return g},invoke:function(g,v){for(var a=m.call(arguments,2),c=[],_=0,I=g.length;_<I;_++)c[_]=a.length?g[_][v].apply(g[_],a):g[_][v].call(g[_]);return c},min:function(g,v){return f(g,v,function(a,c){return a<c})},max:function(g,v){return f(g,v,function(a,c){return a>=c})}}}(),function(){function m(f,g,v){if(v)if(!S.isLikelyNode&&g instanceof Element)f=g;else if(g instanceof Array){f=[];for(var a=0,c=g.length;a<c;a++)f[a]=m({},g[a],v)}else if(g&&"object"==typeof g)for(var _ in g)"canvas"===_||"group"===_?f[_]=null:g.hasOwnProperty(_)&&(f[_]=m({},g[_],v));else f=g;else for(var _ in g)f[_]=g[_];return f}S.util.object={extend:m,clone:function(f,g){return m({},f,g)}},S.util.object.extend(S.util,S.Observable)}(),function(){function m(f,g){var v=f.charCodeAt(g);if(isNaN(v))return"";if(v<55296||v>57343)return f.charAt(g);if(55296<=v&&v<=56319){if(f.length<=g+1)throw"High surrogate without following low surrogate";var a=f.charCodeAt(g+1);if(56320>a||a>57343)throw"High surrogate without following low surrogate";return f.charAt(g)+f.charAt(g+1)}if(0===g)throw"Low surrogate without preceding high surrogate";var c=f.charCodeAt(g-1);if(55296>c||c>56319)throw"Low surrogate without preceding high surrogate";return!1}S.util.string={camelize:function(f){return f.replace(/-+(.)?/g,function(g,v){return v?v.toUpperCase():""})},capitalize:function(f,g){return f.charAt(0).toUpperCase()+(g?f.slice(1):f.slice(1).toLowerCase())},escapeXml:function(f){return f.replace(/&/g,"&amp;").replace(/"/g,"&quot;").replace(/'/g,"&apos;").replace(/</g,"&lt;").replace(/>/g,"&gt;")},graphemeSplit:function(f){var g,v=0,a=[];for(v=0;v<f.length;v++)!1!==(g=m(f,v))&&a.push(g);return a}}}(),function(){var m=Array.prototype.slice,f=function(){},g=function(){for(var _ in{toString:1})if("toString"===_)return!1;return!0}(),v=function(_,I,y){for(var w in I)_.prototype[w]=w in _.prototype&&"function"==typeof _.prototype[w]&&(I[w]+"").indexOf("callSuper")>-1?function(b){return function(){var x=this.constructor.superclass;this.constructor.superclass=y;var O=I[b].apply(this,arguments);if(this.constructor.superclass=x,"initialize"!==b)return O}}(w):I[w],g&&(I.toString!==Object.prototype.toString&&(_.prototype.toString=I.toString),I.valueOf!==Object.prototype.valueOf&&(_.prototype.valueOf=I.valueOf))};function a(){}function c(_){for(var I=null,y=this;y.constructor.superclass;){var w=y.constructor.superclass.prototype[_];if(y[_]!==w){I=w;break}y=y.constructor.superclass.prototype}return I?arguments.length>1?I.apply(this,m.call(arguments,1)):I.call(this):console.log("tried to callSuper "+_+", method not found in prototype chain",this)}S.util.createClass=function(){var _=null,I=m.call(arguments,0);function y(){this.initialize.apply(this,arguments)}"function"==typeof I[0]&&(_=I.shift()),y.superclass=_,y.subclasses=[],_&&(a.prototype=_.prototype,y.prototype=new a,_.subclasses.push(y));for(var w=0,b=I.length;w<b;w++)v(y,I[w],_);return y.prototype.initialize||(y.prototype.initialize=f),y.prototype.constructor=y,y.prototype.callSuper=c,y}}(),C=!!S.document.createElement("div").attachEvent,D=["touchstart","touchmove","touchend"],S.util.addListener=function(m,f,g,v){m&&m.addEventListener(f,g,!C&&v)},S.util.removeListener=function(m,f,g,v){m&&m.removeEventListener(f,g,!C&&v)},S.util.getPointer=function(m){var a,c,g=S.util.getScrollLeftTop(m.target),v=(c=(a=m).changedTouches)&&c[0]?c[0]:a;return{x:v.clientX+g.left,y:v.clientY+g.top}},S.util.isTouchEvent=function(m){return D.indexOf(m.type)>-1||"touch"===m.pointerType},A="string"==typeof(T=S.document.createElement("div")).style.opacity,P=/alpha\s*\(\s*opacity\s*=\s*([^\)]+)\)/,B=function(m){return m},A?B=function(m,f){return m.style.opacity=f,m}:"string"==typeof T.style.filter&&(B=function(m,f){var g=m.style;return m.currentStyle&&!m.currentStyle.hasLayout&&(g.zoom=1),P.test(g.filter)?g.filter=g.filter.replace(P,f=f>=.9999?"":"alpha(opacity="+100*f+")"):g.filter+=" alpha(opacity="+100*f+")",m}),S.util.setStyle=function(m,f){var g=m.style;if(!g)return m;if("string"==typeof f)return m.style.cssText+=";"+f,f.indexOf("opacity")>-1?B(m,f.match(/opacity:\s*(\d?\.?\d*)/)[1]):m;for(var v in f)"opacity"===v?B(m,f[v]):g["float"===v||"cssFloat"===v?void 0===g.styleFloat?"cssFloat":"styleFloat":v]=f[v];return m},function(){var m,f,g,v,a=Array.prototype.slice,c=function(y){return a.call(y,0)};try{m=c(S.document.childNodes)instanceof Array}catch{}function _(y,w){var b=S.document.createElement(y);for(var x in w)"class"===x?b.className=w[x]:"for"===x?b.htmlFor=w[x]:b.setAttribute(x,w[x]);return b}function I(y){for(var w=0,b=0,x=S.document.documentElement,O=S.document.body||{scrollLeft:0,scrollTop:0};y&&(y.parentNode||y.host)&&((y=y.parentNode||y.host)===S.document?(w=O.scrollLeft||x.scrollLeft||0,b=O.scrollTop||x.scrollTop||0):(w+=y.scrollLeft||0,b+=y.scrollTop||0),1!==y.nodeType||"fixed"!==y.style.position););return{left:w,top:b}}m||(c=function(y){for(var w=new Array(y.length),b=y.length;b--;)w[b]=y[b];return w}),f=S.document.defaultView&&S.document.defaultView.getComputedStyle?function(y,w){var b=S.document.defaultView.getComputedStyle(y,null);return b?b[w]:void 0}:function(y,w){var b=y.style[w];return!b&&y.currentStyle&&(b=y.currentStyle[w]),b},v="userSelect"in(g=S.document.documentElement.style)?"userSelect":"MozUserSelect"in g?"MozUserSelect":"WebkitUserSelect"in g?"WebkitUserSelect":"KhtmlUserSelect"in g?"KhtmlUserSelect":"",S.util.makeElementUnselectable=function(y){return void 0!==y.onselectstart&&(y.onselectstart=S.util.falseFunction),v?y.style[v]="none":"string"==typeof y.unselectable&&(y.unselectable="on"),y},S.util.makeElementSelectable=function(y){return void 0!==y.onselectstart&&(y.onselectstart=null),v?y.style[v]="":"string"==typeof y.unselectable&&(y.unselectable=""),y},S.util.setImageSmoothing=function(y,w){y.imageSmoothingEnabled=y.imageSmoothingEnabled||y.webkitImageSmoothingEnabled||y.mozImageSmoothingEnabled||y.msImageSmoothingEnabled||y.oImageSmoothingEnabled,y.imageSmoothingEnabled=w},S.util.getById=function(y){return"string"==typeof y?S.document.getElementById(y):y},S.util.toArray=c,S.util.addClass=function(y,w){y&&-1===(" "+y.className+" ").indexOf(" "+w+" ")&&(y.className+=(y.className?" ":"")+w)},S.util.makeElement=_,S.util.wrapElement=function(y,w,b){return"string"==typeof w&&(w=_(w,b)),y.parentNode&&y.parentNode.replaceChild(w,y),w.appendChild(y),w},S.util.getScrollLeftTop=I,S.util.getElementOffset=function(y){var w,b,x=y&&y.ownerDocument,O={left:0,top:0},F={left:0,top:0},L={borderLeftWidth:"left",borderTopWidth:"top",paddingLeft:"left",paddingTop:"top"};if(!x)return F;for(var N in L)F[L[N]]+=parseInt(f(y,N),10)||0;return w=x.documentElement,void 0!==y.getBoundingClientRect&&(O=y.getBoundingClientRect()),b=I(y),{left:O.left+b.left-(w.clientLeft||0)+F.left,top:O.top+b.top-(w.clientTop||0)+F.top}},S.util.getNodeCanvas=function(y){var w=S.jsdomImplForWrapper(y);return w._canvas||w._image},S.util.cleanUpJsdomNode=function(y){if(S.isLikelyNode){var w=S.jsdomImplForWrapper(y);w&&(w._image=null,w._canvas=null,w._currentSrc=null,w._attributes=null,w._classList=null)}}}(),function(){function m(){}S.util.request=function(f,g){g||(g={});var I,y,v=g.method?g.method.toUpperCase():"GET",a=g.onComplete||function(){},c=new S.window.XMLHttpRequest,_=g.body||g.parameters;return c.onreadystatechange=function(){4===c.readyState&&(a(c),c.onreadystatechange=m)},"GET"===v&&(_=null,"string"==typeof g.parameters&&(y=g.parameters,f=(I=f)+(/\?/.test(I)?"&":"?")+y)),c.open(v,f,!0),"POST"!==v&&"PUT"!==v||c.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),c.send(_),c}}(),S.log=console.log,S.warn=console.warn,function(){var m=S.util.object.extend,f=S.util.object.clone,g=[];function v(){return!1}function a(y,w,b,x){return-b*Math.cos(y/x*(Math.PI/2))+b+w}S.util.object.extend(g,{cancelAll:function(){var y=this.splice(0);return y.forEach(function(w){w.cancel()}),y},cancelByCanvas:function(y){if(!y)return[];var w=this.filter(function(b){return"object"==typeof b.target&&b.target.canvas===y});return w.forEach(function(b){b.cancel()}),w},cancelByTarget:function(y){var w=this.findAnimationsByTarget(y);return w.forEach(function(b){b.cancel()}),w},findAnimationIndex:function(y){return this.indexOf(this.findAnimation(y))},findAnimation:function(y){return this.find(function(w){return w.cancel===y})},findAnimationsByTarget:function(y){return y?this.filter(function(w){return w.target===y}):[]}});var c=S.window.requestAnimationFrame||S.window.webkitRequestAnimationFrame||S.window.mozRequestAnimationFrame||S.window.oRequestAnimationFrame||S.window.msRequestAnimationFrame||function(y){return S.window.setTimeout(y,1e3/60)},_=S.window.cancelAnimationFrame||S.window.clearTimeout;function I(){return c.apply(S.window,arguments)}S.util.animate=function(y){y||(y={});var w,b=!1,x=function(){var O=S.runningAnimations.indexOf(w);return O>-1&&S.runningAnimations.splice(O,1)[0]};return w=m(f(y),{cancel:function(){return b=!0,x()},currentValue:"startValue"in y?y.startValue:0,completionRate:0,durationRate:0}),S.runningAnimations.push(w),I(function(O){var F,L=O||+new Date,N=y.duration||500,j=L+N,$=y.onChange||v,X=y.abort||v,ie=y.onComplete||v,ee=y.easing||a,Q="startValue"in y&&y.startValue.length>0,W="startValue"in y?y.startValue:0,H="endValue"in y?y.endValue:100,Z=y.byValue||(Q?W.map(function(ne,re){return H[re]-W[re]}):H-W);y.onStart&&y.onStart(),function ne(re){var z=(F=re||+new Date)>j?N:F-L,Y=z/N,K=Q?W.map(function(te,ae){return ee(z,W[ae],Z[ae],N)}):ee(z,W,Z,N),oe=Math.abs(Q?(K[0]-W[0])/Z[0]:(K-W)/Z);if(w.currentValue=Q?K.slice():K,w.completionRate=oe,w.durationRate=Y,!b){if(!X(K,oe,Y))return F>j?(w.currentValue=Q?H.slice():H,w.completionRate=1,w.durationRate=1,$(Q?H.slice():H,1,1),ie(H,1,1),void x()):($(K,oe,Y),void I(ne));x()}}(L)}),w.cancel},S.util.requestAnimFrame=I,S.util.cancelAnimFrame=function(){return _.apply(S.window,arguments)},S.runningAnimations=g}(),function(){function m(f,g,v){var a="rgba("+parseInt(f[0]+v*(g[0]-f[0]),10)+","+parseInt(f[1]+v*(g[1]-f[1]),10)+","+parseInt(f[2]+v*(g[2]-f[2]),10);return(a+=","+(f&&g?parseFloat(f[3]+v*(g[3]-f[3])):1))+")"}S.util.animateColor=function(f,g,v,a){var c=new S.Color(f).getSource(),_=new S.Color(g).getSource(),I=a.onComplete,y=a.onChange;return S.util.animate(S.util.object.extend(a=a||{},{duration:v||500,startValue:c,endValue:_,byValue:_,easing:function(w,b,x,O){return m(b,x,a.colorEasing?a.colorEasing(w,O):1-Math.cos(w/O*(Math.PI/2)))},onComplete:function(w,b,x){if(I)return I(m(_,_,0),b,x)},onChange:function(w,b,x){if(y){if(Array.isArray(w))return y(m(w,w,0),b,x);y(w,b,x)}}}))}}(),function(){function m(a,c,_,I){return a<Math.abs(c)?(a=c,I=_/4):I=0===c&&0===a?_/(2*Math.PI)*Math.asin(1):_/(2*Math.PI)*Math.asin(c/a),{a,c,p:_,s:I}}function f(a,c,_){return a.a*Math.pow(2,10*(c-=1))*Math.sin((c*_-a.s)*(2*Math.PI)/a.p)}function g(a,c,_,I){return _-v(I-a,0,_,I)+c}function v(a,c,_,I){return(a/=I)<1/2.75?_*(7.5625*a*a)+c:a<2/2.75?_*(7.5625*(a-=1.5/2.75)*a+.75)+c:a<2.5/2.75?_*(7.5625*(a-=2.25/2.75)*a+.9375)+c:_*(7.5625*(a-=2.625/2.75)*a+.984375)+c}S.util.ease={easeInQuad:function(a,c,_,I){return _*(a/=I)*a+c},easeOutQuad:function(a,c,_,I){return-_*(a/=I)*(a-2)+c},easeInOutQuad:function(a,c,_,I){return(a/=I/2)<1?_/2*a*a+c:-_/2*(--a*(a-2)-1)+c},easeInCubic:function(a,c,_,I){return _*(a/=I)*a*a+c},easeOutCubic:function(a,c,_,I){return _*((a=a/I-1)*a*a+1)+c},easeInOutCubic:function(a,c,_,I){return(a/=I/2)<1?_/2*a*a*a+c:_/2*((a-=2)*a*a+2)+c},easeInQuart:function(a,c,_,I){return _*(a/=I)*a*a*a+c},easeOutQuart:function(a,c,_,I){return-_*((a=a/I-1)*a*a*a-1)+c},easeInOutQuart:function(a,c,_,I){return(a/=I/2)<1?_/2*a*a*a*a+c:-_/2*((a-=2)*a*a*a-2)+c},easeInQuint:function(a,c,_,I){return _*(a/=I)*a*a*a*a+c},easeOutQuint:function(a,c,_,I){return _*((a=a/I-1)*a*a*a*a+1)+c},easeInOutQuint:function(a,c,_,I){return(a/=I/2)<1?_/2*a*a*a*a*a+c:_/2*((a-=2)*a*a*a*a+2)+c},easeInSine:function(a,c,_,I){return-_*Math.cos(a/I*(Math.PI/2))+_+c},easeOutSine:function(a,c,_,I){return _*Math.sin(a/I*(Math.PI/2))+c},easeInOutSine:function(a,c,_,I){return-_/2*(Math.cos(Math.PI*a/I)-1)+c},easeInExpo:function(a,c,_,I){return 0===a?c:_*Math.pow(2,10*(a/I-1))+c},easeOutExpo:function(a,c,_,I){return a===I?c+_:_*(1-Math.pow(2,-10*a/I))+c},easeInOutExpo:function(a,c,_,I){return 0===a?c:a===I?c+_:(a/=I/2)<1?_/2*Math.pow(2,10*(a-1))+c:_/2*(2-Math.pow(2,-10*--a))+c},easeInCirc:function(a,c,_,I){return-_*(Math.sqrt(1-(a/=I)*a)-1)+c},easeOutCirc:function(a,c,_,I){return _*Math.sqrt(1-(a=a/I-1)*a)+c},easeInOutCirc:function(a,c,_,I){return(a/=I/2)<1?-_/2*(Math.sqrt(1-a*a)-1)+c:_/2*(Math.sqrt(1-(a-=2)*a)+1)+c},easeInElastic:function(a,c,_,I){var y=0;return 0===a?c:1==(a/=I)?c+_:(y||(y=.3*I),-f(m(_,_,y,1.70158),a,I)+c)},easeOutElastic:function(a,c,_,I){var y=0;if(0===a)return c;if(1==(a/=I))return c+_;y||(y=.3*I);var w=m(_,_,y,1.70158);return w.a*Math.pow(2,-10*a)*Math.sin((a*I-w.s)*(2*Math.PI)/w.p)+w.c+c},easeInOutElastic:function(a,c,_,I){var y=0;if(0===a)return c;if(2==(a/=I/2))return c+_;y||(y=I*(.3*1.5));var w=m(_,_,y,1.70158);return a<1?-.5*f(w,a,I)+c:w.a*Math.pow(2,-10*(a-=1))*Math.sin((a*I-w.s)*(2*Math.PI)/w.p)*.5+w.c+c},easeInBack:function(a,c,_,I,y){return void 0===y&&(y=1.70158),_*(a/=I)*a*((y+1)*a-y)+c},easeOutBack:function(a,c,_,I,y){return void 0===y&&(y=1.70158),_*((a=a/I-1)*a*((y+1)*a+y)+1)+c},easeInOutBack:function(a,c,_,I,y){return void 0===y&&(y=1.70158),(a/=I/2)<1?_/2*(a*a*((1+(y*=1.525))*a-y))+c:_/2*((a-=2)*a*((1+(y*=1.525))*a+y)+2)+c},easeInBounce:g,easeOutBounce:v,easeInOutBounce:function(a,c,_,I){return a<I/2?.5*g(2*a,0,_,I)+c:.5*v(2*a-I,0,_,I)+.5*_+c}}}(),function(m){var f=m.fabric||(m.fabric={}),g=f.util.object.extend,v=f.util.object.clone,a=f.util.toFixed,c=f.util.parseUnit,_=f.util.multiplyTransformMatrices,I={cx:"left",x:"left",r:"radius",cy:"top",y:"top",display:"visible",visibility:"visible",transform:"transformMatrix","fill-opacity":"fillOpacity","fill-rule":"fillRule","font-family":"fontFamily","font-size":"fontSize","font-style":"fontStyle","font-weight":"fontWeight","letter-spacing":"charSpacing","paint-order":"paintFirst","stroke-dasharray":"strokeDashArray","stroke-dashoffset":"strokeDashOffset","stroke-linecap":"strokeLineCap","stroke-linejoin":"strokeLineJoin","stroke-miterlimit":"strokeMiterLimit","stroke-opacity":"strokeOpacity","stroke-width":"strokeWidth","text-decoration":"textDecoration","text-anchor":"textAnchor",opacity:"opacity","clip-path":"clipPath","clip-rule":"clipRule","vector-effect":"strokeUniform","image-rendering":"imageSmoothing"},y={stroke:"strokeOpacity",fill:"fillOpacity"},w="font-size",b="clip-path";function x(W){return W in I?I[W]:W}function O(W,H,Z,ne){var re,z=Array.isArray(H);if("fill"!==W&&"stroke"!==W||"none"!==H){if("strokeUniform"===W)return"non-scaling-stroke"===H;if("strokeDashArray"===W)H="none"===H?null:H.replace(/,/g," ").split(/\s+/).map(parseFloat);else if("transformMatrix"===W)H=Z&&Z.transformMatrix?_(Z.transformMatrix,f.parseTransformAttribute(H)):f.parseTransformAttribute(H);else if("visible"===W)H="none"!==H&&"hidden"!==H,Z&&!1===Z.visible&&(H=!1);else if("opacity"===W)H=parseFloat(H),Z&&void 0!==Z.opacity&&(H*=Z.opacity);else if("textAnchor"===W)H="start"===H?"left":"end"===H?"right":"center";else if("charSpacing"===W)re=c(H,ne)/ne*1e3;else if("paintFirst"===W){var Y=H.indexOf("fill"),K=H.indexOf("stroke");H="fill",(Y>-1&&K>-1&&K<Y||-1===Y&&K>-1)&&(H="stroke")}else{if("href"===W||"xlink:href"===W||"font"===W)return H;if("imageSmoothing"===W)return"optimizeQuality"===H;re=z?H.map(c):c(H,ne)}}else H="";return!z&&isNaN(re)?H:re}function F(W){return new RegExp("^("+W.join("|")+")\\b","i")}function L(W,H){var ne,re,z,Y=[];for(re=0,z=H.length;re<z;re++)ne=W.getElementsByTagName(H[re]),Y=Y.concat(Array.prototype.slice.call(ne));return Y}function N(W,H){var Z,ne=!0;return(Z=j(W,H.pop()))&&H.length&&(ne=function(re,z){for(var Y,K=!0;re.parentNode&&1===re.parentNode.nodeType&&z.length;)K&&(Y=z.pop()),K=j(re=re.parentNode,Y);return 0===z.length}(W,H)),Z&&ne&&0===H.length}function j(W,H){var Z,ne,re=W.nodeName,z=W.getAttribute("class"),Y=W.getAttribute("id");if(Z=new RegExp("^"+re,"i"),H=H.replace(Z,""),Y&&H.length&&(Z=new RegExp("#"+Y+"(?![a-zA-Z\\-]+)","i"),H=H.replace(Z,"")),z&&H.length)for(ne=(z=z.split(" ")).length;ne--;)Z=new RegExp("\\."+z[ne]+"(?![a-zA-Z\\-]+)","i"),H=H.replace(Z,"");return 0===H.length}function $(W,H){var Z;if(W.getElementById&&(Z=W.getElementById(H)),Z)return Z;var ne,re,z,Y=W.getElementsByTagName("*");for(re=0,z=Y.length;re<z;re++)if(H===(ne=Y[re]).getAttribute("id"))return ne}f.svgValidTagNamesRegEx=F(["path","circle","polygon","polyline","ellipse","rect","line","image","text"]),f.svgViewBoxElementsRegEx=F(["symbol","image","marker","pattern","view","svg"]),f.svgInvalidAncestorsRegEx=F(["pattern","defs","symbol","metadata","clipPath","mask","desc"]),f.svgValidParentsRegEx=F(["symbol","g","a","svg","clipPath","defs"]),f.cssRules={},f.gradientDefs={},f.clipPaths={},f.parseTransformAttribute=function(){function W(K,oe,te){K[te]=Math.tan(f.util.degreesToRadians(oe[0]))}var H=f.iMatrix,Z=f.reNum,ne=f.commaWsp,re="(?:(?:(matrix)\\s*\\(\\s*("+Z+")"+ne+"("+Z+")"+ne+"("+Z+")"+ne+"("+Z+")"+ne+"("+Z+")"+ne+"("+Z+")\\s*\\))|(?:(translate)\\s*\\(\\s*("+Z+")(?:"+ne+"("+Z+"))?\\s*\\))|(?:(scale)\\s*\\(\\s*("+Z+")(?:"+ne+"("+Z+"))?\\s*\\))|(?:(rotate)\\s*\\(\\s*("+Z+")(?:"+ne+"("+Z+")"+ne+"("+Z+"))?\\s*\\))|(?:(skewX)\\s*\\(\\s*("+Z+")\\s*\\))|(?:(skewY)\\s*\\(\\s*("+Z+")\\s*\\)))",z=new RegExp("^\\s*(?:(?:"+re+"(?:"+ne+"*"+re+")*)?)\\s*$"),Y=new RegExp(re,"g");return function(K){var oe=H.concat(),te=[];if(!K||K&&!z.test(K))return oe;K.replace(Y,function(_e){var fe,Ce,he=new RegExp(re).exec(_e).filter(function(fe){return!!fe}),ue=he[1],pe=he.slice(2).map(parseFloat);switch(ue){case"translate":(fe=oe)[4]=(Ce=pe)[0],2===Ce.length&&(fe[5]=Ce[1]);break;case"rotate":pe[0]=f.util.degreesToRadians(pe[0]),function(fe,Ce){var Ae=f.util.cos(Ce[0]),Ie=f.util.sin(Ce[0]),Ye=0,ft=0;3===Ce.length&&(Ye=Ce[1],ft=Ce[2]),fe[0]=Ae,fe[1]=Ie,fe[2]=-Ie,fe[3]=Ae,fe[4]=Ye-(Ae*Ye-Ie*ft),fe[5]=ft-(Ie*Ye+Ae*ft)}(oe,pe);break;case"scale":!function(fe,Ce){var Ie=2===Ce.length?Ce[1]:Ce[0];fe[0]=Ce[0],fe[3]=Ie}(oe,pe);break;case"skewX":W(oe,pe,2);break;case"skewY":W(oe,pe,1);break;case"matrix":oe=pe}te.push(oe.concat()),oe=H.concat()});for(var ae=te[0];te.length>1;)te.shift(),ae=f.util.multiplyTransformMatrices(ae,te[0]);return ae}}();var X=new RegExp("^\\s*("+f.reNum+"+)\\s*,?\\s*("+f.reNum+"+)\\s*,?\\s*("+f.reNum+"+)\\s*,?\\s*("+f.reNum+"+)\\s*$");function ie(W){if(!f.svgViewBoxElementsRegEx.test(W.nodeName))return{};var H,Z,ne,re,z,Y,K=W.getAttribute("viewBox"),oe=1,te=1,ae=W.getAttribute("width"),_e=W.getAttribute("height"),he=W.getAttribute("x")||0,ue=W.getAttribute("y")||0,pe=W.getAttribute("preserveAspectRatio")||"",fe=!K||!(K=K.match(X)),Ce=!ae||!_e||"100%"===ae||"100%"===_e,Ae=fe&&Ce,Ie={},Ye="",ft=0,Zn=0;if(Ie.width=0,Ie.height=0,Ie.toBeParsed=Ae,fe&&(he||ue)&&W.parentNode&&"#document"!==W.parentNode.nodeName&&(Ye=" translate("+c(he)+" "+c(ue)+") ",z=(W.getAttribute("transform")||"")+Ye,W.setAttribute("transform",z),W.removeAttribute("x"),W.removeAttribute("y")),Ae)return Ie;if(fe)return Ie.width=c(ae),Ie.height=c(_e),Ie;if(H=-parseFloat(K[1]),Z=-parseFloat(K[2]),ne=parseFloat(K[3]),re=parseFloat(K[4]),Ie.minX=H,Ie.minY=Z,Ie.viewBoxWidth=ne,Ie.viewBoxHeight=re,Ce?(Ie.width=ne,Ie.height=re):(Ie.width=c(ae),Ie.height=c(_e),oe=Ie.width/ne,te=Ie.height/re),"none"!==(pe=f.util.parsePreserveAspectRatioAttribute(pe)).alignX&&("meet"===pe.meetOrSlice&&(te=oe=oe>te?te:oe),"slice"===pe.meetOrSlice&&(te=oe=oe>te?oe:te),ft=Ie.width-ne*oe,Zn=Ie.height-re*oe,"Mid"===pe.alignX&&(ft/=2),"Mid"===pe.alignY&&(Zn/=2),"Min"===pe.alignX&&(ft=0),"Min"===pe.alignY&&(Zn=0)),1===oe&&1===te&&0===H&&0===Z&&0===he&&0===ue)return Ie;if((he||ue)&&"#document"!==W.parentNode.nodeName&&(Ye=" translate("+c(he)+" "+c(ue)+") "),z=Ye+" matrix("+oe+" 0 0 "+te+" "+(H*oe+ft)+" "+(Z*te+Zn)+") ","svg"===W.nodeName){for(Y=W.ownerDocument.createElementNS(f.svgNS,"g");W.firstChild;)Y.appendChild(W.firstChild);W.appendChild(Y)}else(Y=W).removeAttribute("x"),Y.removeAttribute("y"),z=Y.getAttribute("transform")+z;return Y.setAttribute("transform",z),Ie}function ee(W,H){var Z="xlink:href",ne=$(W,H.getAttribute(Z).slice(1));if(ne&&ne.getAttribute(Z)&&ee(W,ne),["gradientTransform","x1","x2","y1","y2","gradientUnits","cx","cy","r","fx","fy"].forEach(function(z){ne&&!H.hasAttribute(z)&&ne.hasAttribute(z)&&H.setAttribute(z,ne.getAttribute(z))}),!H.children.length)for(var re=ne.cloneNode(!0);re.firstChild;)H.appendChild(re.firstChild);H.removeAttribute(Z)}f.parseSVGDocument=function(W,H,Z,ne){if(W){!function(he){for(var ue=L(he,["use","svg:use"]),pe=0;ue.length&&pe<ue.length;){var fe=ue[pe],Ce=fe.getAttribute("xlink:href")||fe.getAttribute("href");if(null===Ce)return;var Ae,Ie,Ye,ft,Zn=Ce.slice(1),ar=fe.getAttribute("x")||0,ks=fe.getAttribute("y")||0,Ot=$(he,Zn).cloneNode(!0),Kn=(Ot.getAttribute("transform")||"")+" translate("+ar+", "+ks+")",El=ue.length,Bs=f.svgNS;if(ie(Ot),/^svg$/i.test(Ot.nodeName)){var po=Ot.ownerDocument.createElementNS(Bs,"g");for(Ie=0,ft=(Ye=Ot.attributes).length;Ie<ft;Ie++)Ae=Ye.item(Ie),po.setAttributeNS(Bs,Ae.nodeName,Ae.nodeValue);for(;Ot.firstChild;)po.appendChild(Ot.firstChild);Ot=po}for(Ie=0,ft=(Ye=fe.attributes).length;Ie<ft;Ie++)"x"!==(Ae=Ye.item(Ie)).nodeName&&"y"!==Ae.nodeName&&"xlink:href"!==Ae.nodeName&&"href"!==Ae.nodeName&&("transform"===Ae.nodeName?Kn=Ae.nodeValue+" "+Kn:Ot.setAttribute(Ae.nodeName,Ae.nodeValue));Ot.setAttribute("transform",Kn),Ot.setAttribute("instantiated_by_use","1"),Ot.removeAttribute("id"),fe.parentNode.replaceChild(Ot,fe),ue.length===El&&pe++}}(W);var re,z,Y=f.Object.__uid++,K=ie(W),oe=f.util.toArray(W.getElementsByTagName("*"));if(K.crossOrigin=ne&&ne.crossOrigin,K.svgUid=Y,0===oe.length&&f.isLikelyNode){var te=[];for(re=0,z=(oe=W.selectNodes('//*[name(.)!="svg"]')).length;re<z;re++)te[re]=oe[re];oe=te}var ae=oe.filter(function(he){return ie(he),f.svgValidTagNamesRegEx.test(he.nodeName.replace("svg:",""))&&!function(ue,pe){for(;ue&&(ue=ue.parentNode);)if(ue.nodeName&&pe.test(ue.nodeName.replace("svg:",""))&&!ue.getAttribute("instantiated_by_use"))return!0;return!1}(he,f.svgInvalidAncestorsRegEx)});if(!ae||ae&&!ae.length)H&&H([],{});else{var _e={};oe.filter(function(he){return"clipPath"===he.nodeName.replace("svg:","")}).forEach(function(he){var ue=he.getAttribute("id");_e[ue]=f.util.toArray(he.getElementsByTagName("*")).filter(function(pe){return f.svgValidTagNamesRegEx.test(pe.nodeName.replace("svg:",""))})}),f.gradientDefs[Y]=f.getGradientDefs(W),f.cssRules[Y]=f.getCSSRules(W),f.clipPaths[Y]=_e,f.parseElements(ae,function(he,ue){H&&(H(he,K,ue,oe),delete f.gradientDefs[Y],delete f.cssRules[Y],delete f.clipPaths[Y])},v(K),Z,ne)}}};var Q=new RegExp("(normal|italic)?\\s*(normal|small-caps)?\\s*(normal|bold|bolder|lighter|100|200|300|400|500|600|700|800|900)?\\s*("+f.reNum+"(?:px|cm|mm|em|pt|pc|in)*)(?:\\/(normal|"+f.reNum+"))?\\s+(.*)");g(f,{parseFontDeclaration:function(W,H){var Z=W.match(Q);if(Z){var ne=Z[1],re=Z[3],z=Z[4],Y=Z[5],K=Z[6];ne&&(H.fontStyle=ne),re&&(H.fontWeight=isNaN(parseFloat(re))?re:parseFloat(re)),z&&(H.fontSize=c(z)),K&&(H.fontFamily=K),Y&&(H.lineHeight="normal"===Y?1:Y)}},getGradientDefs:function(W){var H,Z=L(W,["linearGradient","radialGradient","svg:linearGradient","svg:radialGradient"]),ne=0,re={};for(ne=Z.length;ne--;)(H=Z[ne]).getAttribute("xlink:href")&&ee(W,H),re[H.getAttribute("id")]=H;return re},parseAttributes:function(W,H,Z){if(W){var ne,re,z,Y={};void 0===Z&&(Z=W.getAttribute("svgUid")),W.parentNode&&f.svgValidParentsRegEx.test(W.parentNode.nodeName)&&(Y=f.parseAttributes(W.parentNode,H,Z));var K=H.reduce(function(pe,fe){return(ne=W.getAttribute(fe))&&(pe[fe]=ne),pe},{}),oe=g(function(pe,fe){var Ce={};for(var Ae in f.cssRules[fe])if(N(pe,Ae.split(" ")))for(var Ie in f.cssRules[fe][Ae])Ce[Ie]=f.cssRules[fe][Ae][Ie];return Ce}(W,Z),f.parseStyleAttribute(W));K=g(K,oe),oe[b]&&W.setAttribute(b,oe[b]),re=z=Y.fontSize||f.Text.DEFAULT_SVG_FONT_SIZE,K[w]&&(K[w]=re=c(K[w],z));var te,ae,_e={};for(var he in K)ae=O(te=x(he),K[he],Y,re),_e[te]=ae;_e&&_e.font&&f.parseFontDeclaration(_e.font,_e);var ue=g(Y,_e);return f.svgValidParentsRegEx.test(W.nodeName)?ue:function(pe){for(var fe in y)if(void 0!==pe[y[fe]]&&""!==pe[fe]){if(void 0===pe[fe]){if(!f.Object.prototype[fe])continue;pe[fe]=f.Object.prototype[fe]}if(0!==pe[fe].indexOf("url(")){var Ce=new f.Color(pe[fe]);pe[fe]=Ce.setAlpha(a(Ce.getAlpha()*pe[y[fe]],2)).toRgba()}}return pe}(ue)}},parseElements:function(W,H,Z,ne,re){new f.ElementsParser(W,H,Z,ne,re).parse()},parseStyleAttribute:function(W){var re,z,Y,H={},Z=W.getAttribute("style");return Z&&("string"==typeof Z?(re=H,Z.replace(/;\s*$/,"").split(";").forEach(function(K){var oe=K.split(":");z=oe[0].trim().toLowerCase(),Y=oe[1].trim(),re[z]=Y})):function(ne,re){for(var K in ne)void 0!==ne[K]&&(re[K.toLowerCase()]=ne[K])}(Z,H)),H},parsePointsAttribute:function(W){if(!W)return null;var H,Z,ne=[];for(H=0,Z=(W=(W=W.replace(/,/g," ").trim()).split(/\s+/)).length;H<Z;H+=2)ne.push({x:parseFloat(W[H]),y:parseFloat(W[H+1])});return ne},getCSSRules:function(W){var H,Z,ne=W.getElementsByTagName("style"),re={};for(H=0,Z=ne.length;H<Z;H++){var z=ne[H].textContent;""!==(z=z.replace(/\/\*[\s\S]*?\*\//g,"")).trim()&&z.split("}").filter(function(Y){return Y.trim()}).forEach(function(Y){var K=Y.split("{"),oe={},te=K[1].trim().split(";").filter(function(ue){return ue.trim()});for(H=0,Z=te.length;H<Z;H++){var ae=te[H].split(":"),_e=ae[0].trim(),he=ae[1].trim();oe[_e]=he}(Y=K[0].trim()).split(",").forEach(function(ue){""!==(ue=ue.replace(/^svg/i,"").trim())&&(re[ue]?f.util.object.extend(re[ue],oe):re[ue]=f.util.object.clone(oe))})})}return re},loadSVGFromURL:function(W,H,Z,ne){W=W.replace(/^\n\s*/,"").trim(),new f.util.request(W,{method:"get",onComplete:function(re){var z=re.responseXML;if(!z||!z.documentElement)return H&&H(null),!1;f.parseSVGDocument(z.documentElement,function(Y,K,oe,te){H&&H(Y,K,oe,te)},Z,ne)}})},loadSVGFromString:function(W,H,Z,ne){var re=(new f.window.DOMParser).parseFromString(W.trim(),"text/xml");f.parseSVGDocument(re.documentElement,function(z,Y,K,oe){H(z,Y,K,oe)},Z,ne)}})}(n),S.ElementsParser=function(m,f,g,v,a,c){this.elements=m,this.callback=f,this.options=g,this.reviver=v,this.svgUid=g&&g.svgUid||0,this.parsingOptions=a,this.regexUrl=/^url\(['"]?#([^'"]+)['"]?\)/g,this.doc=c},(k=S.ElementsParser.prototype).parse=function(){this.instances=new Array(this.elements.length),this.numElements=this.elements.length,this.createObjects()},k.createObjects=function(){var m=this;this.elements.forEach(function(f,g){f.setAttribute("svgUid",m.svgUid),m.createObject(f,g)})},k.findTag=function(m){return S[S.util.string.capitalize(m.tagName.replace("svg:",""))]},k.createObject=function(m,f){var g=this.findTag(m);if(g&&g.fromElement)try{g.fromElement(m,this.createCallback(f,m),this.options)}catch(v){S.log(v)}else this.checkIfDone()},k.createCallback=function(m,f){var g=this;return function(v){var a;g.resolveGradient(v,f,"fill"),g.resolveGradient(v,f,"stroke"),v instanceof S.Image&&v._originalElement&&(a=v.parsePreserveAspectRatioAttribute(f)),v._removeTransformMatrix(a),g.resolveClipPath(v,f),g.reviver&&g.reviver(f,v),g.instances[m]=v,g.checkIfDone()}},k.extractPropertyDefinition=function(m,f,g){var v=m[f],a=this.regexUrl;if(a.test(v)){a.lastIndex=0;var c=a.exec(v)[1];return a.lastIndex=0,S[g][this.svgUid][c]}},k.resolveGradient=function(m,f,g){var v=this.extractPropertyDefinition(m,g,"gradientDefs");if(v){var a=f.getAttribute(g+"-opacity"),c=S.Gradient.fromElement(v,m,a,this.options);m.set(g,c)}},k.createClipPathCallback=function(m,f){return function(g){g._removeTransformMatrix(),g.fillRule=g.clipRule,f.push(g)}},k.resolveClipPath=function(m,f){var g,v,a,c,_=this.extractPropertyDefinition(m,"clipPath","clipPaths");if(_){a=[],v=S.util.invertTransform(m.calcTransformMatrix());for(var I=_[0].parentNode,y=f;y.parentNode&&y.getAttribute("clip-path")!==m.clipPath;)y=y.parentNode;y.parentNode.appendChild(I);for(var w=0;w<_.length;w++)this.findTag(g=_[w]).fromElement(g,this.createClipPathCallback(m,a),this.options);_=1===a.length?a[0]:new S.Group(a),c=S.util.multiplyTransformMatrices(v,_.calcTransformMatrix()),_.clipPath&&this.resolveClipPath(_,y);var b=S.util.qrDecompose(c);_.flipX=!1,_.flipY=!1,_.set("scaleX",b.scaleX),_.set("scaleY",b.scaleY),_.angle=b.angle,_.skewX=b.skewX,_.skewY=0,_.setPositionByOrigin({x:b.translateX,y:b.translateY},"center","center"),m.clipPath=_}else delete m.clipPath},k.checkIfDone=function(){0==--this.numElements&&(this.instances=this.instances.filter(function(m){return null!=m}),this.callback(this.instances,this.elements))},function(m){var f=m.fabric||(m.fabric={});function g(v,a){this.x=v,this.y=a}f.Point?f.warn("fabric.Point is already defined"):(f.Point=g,g.prototype={type:"point",constructor:g,add:function(v){return new g(this.x+v.x,this.y+v.y)},addEquals:function(v){return this.x+=v.x,this.y+=v.y,this},scalarAdd:function(v){return new g(this.x+v,this.y+v)},scalarAddEquals:function(v){return this.x+=v,this.y+=v,this},subtract:function(v){return new g(this.x-v.x,this.y-v.y)},subtractEquals:function(v){return this.x-=v.x,this.y-=v.y,this},scalarSubtract:function(v){return new g(this.x-v,this.y-v)},scalarSubtractEquals:function(v){return this.x-=v,this.y-=v,this},multiply:function(v){return new g(this.x*v,this.y*v)},multiplyEquals:function(v){return this.x*=v,this.y*=v,this},divide:function(v){return new g(this.x/v,this.y/v)},divideEquals:function(v){return this.x/=v,this.y/=v,this},eq:function(v){return this.x===v.x&&this.y===v.y},lt:function(v){return this.x<v.x&&this.y<v.y},lte:function(v){return this.x<=v.x&&this.y<=v.y},gt:function(v){return this.x>v.x&&this.y>v.y},gte:function(v){return this.x>=v.x&&this.y>=v.y},lerp:function(v,a){return void 0===a&&(a=.5),a=Math.max(Math.min(1,a),0),new g(this.x+(v.x-this.x)*a,this.y+(v.y-this.y)*a)},distanceFrom:function(v){var a=this.x-v.x,c=this.y-v.y;return Math.sqrt(a*a+c*c)},midPointFrom:function(v){return this.lerp(v)},min:function(v){return new g(Math.min(this.x,v.x),Math.min(this.y,v.y))},max:function(v){return new g(Math.max(this.x,v.x),Math.max(this.y,v.y))},toString:function(){return this.x+","+this.y},setXY:function(v,a){return this.x=v,this.y=a,this},setX:function(v){return this.x=v,this},setY:function(v){return this.y=v,this},setFromPoint:function(v){return this.x=v.x,this.y=v.y,this},swap:function(v){var a=this.x,c=this.y;this.x=v.x,this.y=v.y,v.x=a,v.y=c},clone:function(){return new g(this.x,this.y)}})}(n),function(m){var f=m.fabric||(m.fabric={});function g(v){this.status=v,this.points=[]}f.Intersection?f.warn("fabric.Intersection is already defined"):(f.Intersection=g,f.Intersection.prototype={constructor:g,appendPoint:function(v){return this.points.push(v),this},appendPoints:function(v){return this.points=this.points.concat(v),this}},f.Intersection.intersectLineLine=function(v,a,c,_){var I,y=(_.x-c.x)*(v.y-c.y)-(_.y-c.y)*(v.x-c.x),w=(a.x-v.x)*(v.y-c.y)-(a.y-v.y)*(v.x-c.x),b=(_.y-c.y)*(a.x-v.x)-(_.x-c.x)*(a.y-v.y);if(0!==b){var x=y/b,O=w/b;0<=x&&x<=1&&0<=O&&O<=1?(I=new g("Intersection")).appendPoint(new f.Point(v.x+x*(a.x-v.x),v.y+x*(a.y-v.y))):I=new g}else I=new g(0===y||0===w?"Coincident":"Parallel");return I},f.Intersection.intersectLinePolygon=function(v,a,c){var y,w,b=new g,x=c.length;for(w=0;w<x;w++)y=g.intersectLineLine(v,a,c[w],c[(w+1)%x]),b.appendPoints(y.points);return b.points.length>0&&(b.status="Intersection"),b},f.Intersection.intersectPolygonPolygon=function(v,a){var c,_=new g,I=v.length;for(c=0;c<I;c++){var b=g.intersectLinePolygon(v[c],v[(c+1)%I],a);_.appendPoints(b.points)}return _.points.length>0&&(_.status="Intersection"),_},f.Intersection.intersectPolygonRectangle=function(v,a,c){var _=a.min(c),I=a.max(c),y=new f.Point(I.x,_.y),w=new f.Point(_.x,I.y),b=g.intersectLinePolygon(_,y,v),x=g.intersectLinePolygon(y,I,v),O=g.intersectLinePolygon(I,w,v),F=g.intersectLinePolygon(w,_,v),L=new g;return L.appendPoints(b.points),L.appendPoints(x.points),L.appendPoints(O.points),L.appendPoints(F.points),L.points.length>0&&(L.status="Intersection"),L})}(n),function(m){var f=m.fabric||(m.fabric={});function g(a){a?this._tryParsingColor(a):this.setSource([0,0,0,1])}function v(a,c,_){return _<0&&(_+=1),_>1&&(_-=1),_<1/6?a+6*(c-a)*_:_<.5?c:_<2/3?a+(c-a)*(2/3-_)*6:a}f.Color?f.warn("fabric.Color is already defined."):(f.Color=g,f.Color.prototype={_tryParsingColor:function(a){var c;a in g.colorNameMap&&(a=g.colorNameMap[a]),"transparent"===a&&(c=[255,255,255,0]),c||(c=g.sourceFromHex(a)),c||(c=g.sourceFromRgb(a)),c||(c=g.sourceFromHsl(a)),c||(c=[0,0,0,1]),c&&this.setSource(c)},_rgbToHsl:function(a,c,_){var I,y,w,b=f.util.array.max([a/=255,c/=255,_/=255]),x=f.util.array.min([a,c,_]);if(w=(b+x)/2,b===x)I=y=0;else{var O=b-x;switch(y=w>.5?O/(2-b-x):O/(b+x),b){case a:I=(c-_)/O+(c<_?6:0);break;case c:I=(_-a)/O+2;break;case _:I=(a-c)/O+4}I/=6}return[Math.round(360*I),Math.round(100*y),Math.round(100*w)]},getSource:function(){return this._source},setSource:function(a){this._source=a},toRgb:function(){var a=this.getSource();return"rgb("+a[0]+","+a[1]+","+a[2]+")"},toRgba:function(){var a=this.getSource();return"rgba("+a[0]+","+a[1]+","+a[2]+","+a[3]+")"},toHsl:function(){var a=this.getSource(),c=this._rgbToHsl(a[0],a[1],a[2]);return"hsl("+c[0]+","+c[1]+"%,"+c[2]+"%)"},toHsla:function(){var a=this.getSource(),c=this._rgbToHsl(a[0],a[1],a[2]);return"hsla("+c[0]+","+c[1]+"%,"+c[2]+"%,"+a[3]+")"},toHex:function(){var a,c,_,I=this.getSource();return a=1===(a=I[0].toString(16)).length?"0"+a:a,c=1===(c=I[1].toString(16)).length?"0"+c:c,_=1===(_=I[2].toString(16)).length?"0"+_:_,a.toUpperCase()+c.toUpperCase()+_.toUpperCase()},toHexa:function(){var a,c=this.getSource();return a=1===(a=(a=Math.round(255*c[3])).toString(16)).length?"0"+a:a,this.toHex()+a.toUpperCase()},getAlpha:function(){return this.getSource()[3]},setAlpha:function(a){var c=this.getSource();return c[3]=a,this.setSource(c),this},toGrayscale:function(){var a=this.getSource(),c=parseInt((.3*a[0]+.59*a[1]+.11*a[2]).toFixed(0),10);return this.setSource([c,c,c,a[3]]),this},toBlackWhite:function(a){var c=this.getSource(),_=(.3*c[0]+.59*c[1]+.11*c[2]).toFixed(0),I=c[3];return a=a||127,_=Number(_)<Number(a)?0:255,this.setSource([_,_,_,I]),this},overlayWith:function(a){a instanceof g||(a=new g(a));var c,_=[],I=this.getAlpha(),y=this.getSource(),w=a.getSource();for(c=0;c<3;c++)_.push(Math.round(.5*y[c]+.5*w[c]));return _[3]=I,this.setSource(_),this}},f.Color.reRGBa=/^rgba?\(\s*(\d{1,3}(?:\.\d+)?\%?)\s*,\s*(\d{1,3}(?:\.\d+)?\%?)\s*,\s*(\d{1,3}(?:\.\d+)?\%?)\s*(?:\s*,\s*((?:\d*\.?\d+)?)\s*)?\)$/i,f.Color.reHSLa=/^hsla?\(\s*(\d{1,3})\s*,\s*(\d{1,3}\%)\s*,\s*(\d{1,3}\%)\s*(?:\s*,\s*(\d+(?:\.\d+)?)\s*)?\)$/i,f.Color.reHex=/^#?([0-9a-f]{8}|[0-9a-f]{6}|[0-9a-f]{4}|[0-9a-f]{3})$/i,f.Color.colorNameMap={aliceblue:"#F0F8FF",antiquewhite:"#FAEBD7",aqua:"#00FFFF",aquamarine:"#7FFFD4",azure:"#F0FFFF",beige:"#F5F5DC",bisque:"#FFE4C4",black:"#000000",blanchedalmond:"#FFEBCD",blue:"#0000FF",blueviolet:"#8A2BE2",brown:"#A52A2A",burlywood:"#DEB887",cadetblue:"#5F9EA0",chartreuse:"#7FFF00",chocolate:"#D2691E",coral:"#FF7F50",cornflowerblue:"#6495ED",cornsilk:"#FFF8DC",crimson:"#DC143C",cyan:"#00FFFF",darkblue:"#00008B",darkcyan:"#008B8B",darkgoldenrod:"#B8860B",darkgray:"#A9A9A9",darkgrey:"#A9A9A9",darkgreen:"#006400",darkkhaki:"#BDB76B",darkmagenta:"#8B008B",darkolivegreen:"#556B2F",darkorange:"#FF8C00",darkorchid:"#9932CC",darkred:"#8B0000",darksalmon:"#E9967A",darkseagreen:"#8FBC8F",darkslateblue:"#483D8B",darkslategray:"#2F4F4F",darkslategrey:"#2F4F4F",darkturquoise:"#00CED1",darkviolet:"#9400D3",deeppink:"#FF1493",deepskyblue:"#00BFFF",dimgray:"#696969",dimgrey:"#696969",dodgerblue:"#1E90FF",firebrick:"#B22222",floralwhite:"#FFFAF0",forestgreen:"#228B22",fuchsia:"#FF00FF",gainsboro:"#DCDCDC",ghostwhite:"#F8F8FF",gold:"#FFD700",goldenrod:"#DAA520",gray:"#808080",grey:"#808080",green:"#008000",greenyellow:"#ADFF2F",honeydew:"#F0FFF0",hotpink:"#FF69B4",indianred:"#CD5C5C",indigo:"#4B0082",ivory:"#FFFFF0",khaki:"#F0E68C",lavender:"#E6E6FA",lavenderblush:"#FFF0F5",lawngreen:"#7CFC00",lemonchiffon:"#FFFACD",lightblue:"#ADD8E6",lightcoral:"#F08080",lightcyan:"#E0FFFF",lightgoldenrodyellow:"#FAFAD2",lightgray:"#D3D3D3",lightgrey:"#D3D3D3",lightgreen:"#90EE90",lightpink:"#FFB6C1",lightsalmon:"#FFA07A",lightseagreen:"#20B2AA",lightskyblue:"#87CEFA",lightslategray:"#778899",lightslategrey:"#778899",lightsteelblue:"#B0C4DE",lightyellow:"#FFFFE0",lime:"#00FF00",limegreen:"#32CD32",linen:"#FAF0E6",magenta:"#FF00FF",maroon:"#800000",mediumaquamarine:"#66CDAA",mediumblue:"#0000CD",mediumorchid:"#BA55D3",mediumpurple:"#9370DB",mediumseagreen:"#3CB371",mediumslateblue:"#7B68EE",mediumspringgreen:"#00FA9A",mediumturquoise:"#48D1CC",mediumvioletred:"#C71585",midnightblue:"#191970",mintcream:"#F5FFFA",mistyrose:"#FFE4E1",moccasin:"#FFE4B5",navajowhite:"#FFDEAD",navy:"#000080",oldlace:"#FDF5E6",olive:"#808000",olivedrab:"#6B8E23",orange:"#FFA500",orangered:"#FF4500",orchid:"#DA70D6",palegoldenrod:"#EEE8AA",palegreen:"#98FB98",paleturquoise:"#AFEEEE",palevioletred:"#DB7093",papayawhip:"#FFEFD5",peachpuff:"#FFDAB9",peru:"#CD853F",pink:"#FFC0CB",plum:"#DDA0DD",powderblue:"#B0E0E6",purple:"#800080",rebeccapurple:"#663399",red:"#FF0000",rosybrown:"#BC8F8F",royalblue:"#4169E1",saddlebrown:"#8B4513",salmon:"#FA8072",sandybrown:"#F4A460",seagreen:"#2E8B57",seashell:"#FFF5EE",sienna:"#A0522D",silver:"#C0C0C0",skyblue:"#87CEEB",slateblue:"#6A5ACD",slategray:"#708090",slategrey:"#708090",snow:"#FFFAFA",springgreen:"#00FF7F",steelblue:"#4682B4",tan:"#D2B48C",teal:"#008080",thistle:"#D8BFD8",tomato:"#FF6347",turquoise:"#40E0D0",violet:"#EE82EE",wheat:"#F5DEB3",white:"#FFFFFF",whitesmoke:"#F5F5F5",yellow:"#FFFF00",yellowgreen:"#9ACD32"},f.Color.fromRgb=function(a){return g.fromSource(g.sourceFromRgb(a))},f.Color.sourceFromRgb=function(a){var c=a.match(g.reRGBa);if(c){var _=parseInt(c[1],10)/(/%$/.test(c[1])?100:1)*(/%$/.test(c[1])?255:1),I=parseInt(c[2],10)/(/%$/.test(c[2])?100:1)*(/%$/.test(c[2])?255:1),y=parseInt(c[3],10)/(/%$/.test(c[3])?100:1)*(/%$/.test(c[3])?255:1);return[parseInt(_,10),parseInt(I,10),parseInt(y,10),c[4]?parseFloat(c[4]):1]}},f.Color.fromRgba=g.fromRgb,f.Color.fromHsl=function(a){return g.fromSource(g.sourceFromHsl(a))},f.Color.sourceFromHsl=function(a){var c=a.match(g.reHSLa);if(c){var _,I,y,w=(parseFloat(c[1])%360+360)%360/360,b=parseFloat(c[2])/(/%$/.test(c[2])?100:1),x=parseFloat(c[3])/(/%$/.test(c[3])?100:1);if(0===b)_=I=y=x;else{var O=x<=.5?x*(b+1):x+b-x*b,F=2*x-O;_=v(F,O,w+1/3),I=v(F,O,w),y=v(F,O,w-1/3)}return[Math.round(255*_),Math.round(255*I),Math.round(255*y),c[4]?parseFloat(c[4]):1]}},f.Color.fromHsla=g.fromHsl,f.Color.fromHex=function(a){return g.fromSource(g.sourceFromHex(a))},f.Color.sourceFromHex=function(a){if(a.match(g.reHex)){var c=a.slice(a.indexOf("#")+1),_=3===c.length||4===c.length,I=8===c.length||4===c.length,y=_?c.charAt(0)+c.charAt(0):c.substring(0,2),w=_?c.charAt(1)+c.charAt(1):c.substring(2,4),b=_?c.charAt(2)+c.charAt(2):c.substring(4,6),x=I?_?c.charAt(3)+c.charAt(3):c.substring(6,8):"FF";return[parseInt(y,16),parseInt(w,16),parseInt(b,16),parseFloat((parseInt(x,16)/255).toFixed(2))]}},f.Color.fromSource=function(a){var c=new g;return c.setSource(a),c})}(n),function(m){var f=m.fabric||(m.fabric={}),g=["e","se","s","sw","w","nw","n","ne","e"],v=["ns","nesw","ew","nwse"],a={},c="left",_="top",I="right",y="bottom",w="center",b={top:y,bottom:_,left:I,right:c,center:w},x=f.util.radiansToDegrees,O=Math.sign||function(z){return(z>0)-(z<0)||+z};function F(z,Y){var K=z.angle+x(Math.atan2(Y.y,Y.x))+360;return Math.round(K%360/45)}function L(z,Y){var K=Y.transform.target,oe=K.canvas,te=f.util.object.clone(Y);te.target=K,oe&&oe.fire("object:"+z,te),K.fire(z,Y)}function N(z,Y){var K=Y.canvas,oe=z[K.uniScaleKey];return K.uniformScaling&&!oe||!K.uniformScaling&&oe}function j(z){return z.originX===w&&z.originY===w}function $(z,Y,K){var oe=z.lockScalingX,te=z.lockScalingY;return!((!oe||!te)&&(Y||!oe&&!te||!K)&&(!oe||"x"!==Y)&&(!te||"y"!==Y))}function X(z,Y,K,oe){return{e:z,transform:Y,pointer:{x:K,y:oe}}}function ie(z){return function(Y,K,oe,te){var ae=K.target,_e=ae.getCenterPoint(),he=ae.translateToOriginPoint(_e,K.originX,K.originY),ue=z(Y,K,oe,te);return ae.setPositionByOrigin(he,K.originX,K.originY),ue}}function ee(z,Y){return function(K,oe,te,ae){var _e=Y(K,oe,te,ae);return _e&&L(z,X(K,oe,te,ae)),_e}}function Q(z,Y,K,oe,te){var ae=z.target,_e=ae.controls[z.corner],he=ae.canvas.getZoom(),ue=ae.padding/he,pe=ae.toLocalPoint(new f.Point(oe,te),Y,K);return pe.x>=ue&&(pe.x-=ue),pe.x<=-ue&&(pe.x+=ue),pe.y>=ue&&(pe.y-=ue),pe.y<=ue&&(pe.y+=ue),pe.x-=_e.offsetX,pe.y-=_e.offsetY,pe}function W(z){return z.flipX!==z.flipY}function H(z,Y,K,oe,te){if(0!==z[Y]){var ae=te/z._getTransformedDimensions()[oe]*z[K];z.set(K,ae)}}function Z(z,Y,K,oe){var te,ae=Y.target,_e=ae._getTransformedDimensions(0,ae.skewY),he=Q(Y,Y.originX,Y.originY,K,oe),ue=Math.abs(2*he.x)-_e.x,pe=ae.skewX;ue<2?te=0:(te=x(Math.atan2(ue/ae.scaleX,_e.y/ae.scaleY)),Y.originX===c&&Y.originY===y&&(te=-te),Y.originX===I&&Y.originY===_&&(te=-te),W(ae)&&(te=-te));var fe=pe!==te;if(fe){var Ce=ae._getTransformedDimensions().y;ae.set("skewX",te),H(ae,"skewY","scaleY","y",Ce)}return fe}function ne(z,Y,K,oe){var te,ae=Y.target,_e=ae._getTransformedDimensions(ae.skewX,0),he=Q(Y,Y.originX,Y.originY,K,oe),ue=Math.abs(2*he.y)-_e.y,pe=ae.skewY;ue<2?te=0:(te=x(Math.atan2(ue/ae.scaleY,_e.x/ae.scaleX)),Y.originX===c&&Y.originY===y&&(te=-te),Y.originX===I&&Y.originY===_&&(te=-te),W(ae)&&(te=-te));var fe=pe!==te;if(fe){var Ce=ae._getTransformedDimensions().x;ae.set("skewY",te),H(ae,"skewX","scaleX","x",Ce)}return fe}function re(z,Y,K,oe,te){var ae,_e,he,ue,pe,fe,Ce=Y.target,Ae=Ce.lockScalingX,Ie=Ce.lockScalingY,Ye=(te=te||{}).by,ft=N(z,Ce),Zn=$(Ce,Ye,ft),ar=Y.gestureScale;if(Zn)return!1;if(ar)_e=Y.scaleX*ar,he=Y.scaleY*ar;else{if(ae=Q(Y,Y.originX,Y.originY,K,oe),pe="y"!==Ye?O(ae.x):1,fe="x"!==Ye?O(ae.y):1,Y.signX||(Y.signX=pe),Y.signY||(Y.signY=fe),Ce.lockScalingFlip&&(Y.signX!==pe||Y.signY!==fe))return!1;if(ue=Ce._getTransformedDimensions(),ft&&!Ye){var ks=Math.abs(ae.x)+Math.abs(ae.y),Ot=Y.original,Kn=ks/(Math.abs(ue.x*Ot.scaleX/Ce.scaleX)+Math.abs(ue.y*Ot.scaleY/Ce.scaleY));_e=Ot.scaleX*Kn,he=Ot.scaleY*Kn}else _e=Math.abs(ae.x*Ce.scaleX/ue.x),he=Math.abs(ae.y*Ce.scaleY/ue.y);j(Y)&&(_e*=2,he*=2),Y.signX!==pe&&"y"!==Ye&&(Y.originX=b[Y.originX],_e*=-1,Y.signX=pe),Y.signY!==fe&&"x"!==Ye&&(Y.originY=b[Y.originY],he*=-1,Y.signY=fe)}var El=Ce.scaleX,Bs=Ce.scaleY;return Ye?("x"===Ye&&Ce.set("scaleX",_e),"y"===Ye&&Ce.set("scaleY",he)):(!Ae&&Ce.set("scaleX",_e),!Ie&&Ce.set("scaleY",he)),El!==Ce.scaleX||Bs!==Ce.scaleY}a.scaleCursorStyleHandler=function(z,Y,K){var oe=N(z,K),te="";if(0!==Y.x&&0===Y.y?te="x":0===Y.x&&0!==Y.y&&(te="y"),$(K,te,oe))return"not-allowed";var ae=F(K,Y);return g[ae]+"-resize"},a.skewCursorStyleHandler=function(z,Y,K){if(0!==Y.x&&K.lockSkewingY||0!==Y.y&&K.lockSkewingX)return"not-allowed";var te=F(K,Y)%4;return v[te]+"-resize"},a.scaleSkewCursorStyleHandler=function(z,Y,K){return z[K.canvas.altActionKey]?a.skewCursorStyleHandler(z,Y,K):a.scaleCursorStyleHandler(z,Y,K)},a.rotationWithSnapping=ee("rotating",ie(function(z,Y,K,oe){var te=Y,ae=te.target,_e=ae.translateToOriginPoint(ae.getCenterPoint(),te.originX,te.originY);if(ae.lockRotation)return!1;var he,ue=Math.atan2(te.ey-_e.y,te.ex-_e.x),pe=Math.atan2(oe-_e.y,K-_e.x),fe=x(pe-ue+te.theta);if(ae.snapAngle>0){var Ce=ae.snapAngle,Ae=ae.snapThreshold||Ce,Ie=Math.ceil(fe/Ce)*Ce,Ye=Math.floor(fe/Ce)*Ce;Math.abs(fe-Ye)<Ae?fe=Ye:Math.abs(fe-Ie)<Ae&&(fe=Ie)}return fe<0&&(fe=360+fe),he=ae.angle!==(fe%=360),ae.angle=fe,he})),a.scalingEqually=ee("scaling",ie(function(z,Y,K,oe){return re(z,Y,K,oe)})),a.scalingX=ee("scaling",ie(function(z,Y,K,oe){return re(z,Y,K,oe,{by:"x"})})),a.scalingY=ee("scaling",ie(function(z,Y,K,oe){return re(z,Y,K,oe,{by:"y"})})),a.scalingYOrSkewingX=function(z,Y,K,oe){return z[Y.target.canvas.altActionKey]?a.skewHandlerX(z,Y,K,oe):a.scalingY(z,Y,K,oe)},a.scalingXOrSkewingY=function(z,Y,K,oe){return z[Y.target.canvas.altActionKey]?a.skewHandlerY(z,Y,K,oe):a.scalingX(z,Y,K,oe)},a.changeWidth=ee("resizing",ie(function(z,Y,K,oe){var te=Y.target,ae=Q(Y,Y.originX,Y.originY,K,oe),_e=te.strokeWidth/(te.strokeUniform?te.scaleX:1),he=j(Y)?2:1,ue=te.width,pe=Math.abs(ae.x*he/te.scaleX)-_e;return te.set("width",Math.max(pe,0)),ue!==pe})),a.skewHandlerX=function(z,Y,K,oe){var te,ae=Y.target,_e=ae.skewX,he=Y.originY;return!ae.lockSkewingX&&(0===_e?te=Q(Y,w,w,K,oe).x>0?c:I:(_e>0&&(te=he===_?c:I),_e<0&&(te=he===_?I:c),W(ae)&&(te=te===c?I:c)),Y.originX=te,ee("skewing",ie(Z))(z,Y,K,oe))},a.skewHandlerY=function(z,Y,K,oe){var te,ae=Y.target,_e=ae.skewY,he=Y.originX;return!ae.lockSkewingY&&(0===_e?te=Q(Y,w,w,K,oe).y>0?_:y:(_e>0&&(te=he===c?_:y),_e<0&&(te=he===c?y:_),W(ae)&&(te=te===_?y:_)),Y.originY=te,ee("skewing",ie(ne))(z,Y,K,oe))},a.dragHandler=function(z,Y,K,oe){var te=Y.target,ae=K-Y.offsetX,_e=oe-Y.offsetY,he=!te.get("lockMovementX")&&te.left!==ae,ue=!te.get("lockMovementY")&&te.top!==_e;return he&&te.set("left",ae),ue&&te.set("top",_e),(he||ue)&&L("moving",X(z,Y,K,oe)),he||ue},a.scaleOrSkewActionName=function(z,Y,K){var oe=z[K.canvas.altActionKey];return 0===Y.x?oe?"skewX":"scaleY":0===Y.y?oe?"skewY":"scaleX":void 0},a.rotationStyleHandler=function(z,Y,K){return K.lockRotation?"not-allowed":Y.cursorStyle},a.fireEvent=L,a.wrapWithFixedAnchor=ie,a.wrapWithFireEvent=ee,a.getLocalPoint=Q,f.controlsUtils=a}(n),f=(m=n).fabric||(m.fabric={}),g=f.util.degreesToRadians,(v=f.controlsUtils).renderCircleControl=function(a,c,_,I,y){I=I||{};var w,b=this.sizeX||I.cornerSize||y.cornerSize,x=this.sizeY||I.cornerSize||y.cornerSize,O=void 0!==I.transparentCorners?I.transparentCorners:y.transparentCorners,F=O?"stroke":"fill",L=!O&&(I.cornerStrokeColor||y.cornerStrokeColor),N=c,j=_;a.save(),a.fillStyle=I.cornerColor||y.cornerColor,a.strokeStyle=I.cornerStrokeColor||y.cornerStrokeColor,b>x?(w=b,a.scale(1,x/b),j=_*b/x):x>b?(w=x,a.scale(b/x,1),N=c*x/b):w=b,a.lineWidth=1,a.beginPath(),a.arc(N,j,w/2,0,2*Math.PI,!1),a[F](),L&&a.stroke(),a.restore()},v.renderSquareControl=function(a,c,_,I,y){I=I||{};var w=this.sizeX||I.cornerSize||y.cornerSize,b=this.sizeY||I.cornerSize||y.cornerSize,x=void 0!==I.transparentCorners?I.transparentCorners:y.transparentCorners,O=x?"stroke":"fill",F=!x&&(I.cornerStrokeColor||y.cornerStrokeColor),L=w/2,N=b/2;a.save(),a.fillStyle=I.cornerColor||y.cornerColor,a.strokeStyle=I.cornerStrokeColor||y.cornerStrokeColor,a.lineWidth=1,a.translate(c,_),a.rotate(g(y.angle)),a[O+"Rect"](-L,-N,w,b),F&&a.strokeRect(-L,-N,w,b),a.restore()},function(m){var f=m.fabric||(m.fabric={});f.Control=function(g){for(var v in g)this[v]=g[v]},f.Control.prototype={visible:!0,actionName:"scale",angle:0,x:0,y:0,offsetX:0,offsetY:0,sizeX:null,sizeY:null,touchSizeX:null,touchSizeY:null,cursorStyle:"crosshair",withConnection:!1,actionHandler:function(){},mouseDownHandler:function(){},mouseUpHandler:function(){},getActionHandler:function(){return this.actionHandler},getMouseDownHandler:function(){return this.mouseDownHandler},getMouseUpHandler:function(){return this.mouseUpHandler},cursorStyleHandler:function(g,v){return v.cursorStyle},getActionName:function(g,v){return v.actionName},getVisibility:function(g,v){var a=g._controlsVisibility;return a&&void 0!==a[v]?a[v]:this.visible},setVisibility:function(g){this.visible=g},positionHandler:function(g,v){return f.util.transformPoint({x:this.x*g.x+this.offsetX,y:this.y*g.y+this.offsetY},v)},calcCornerCoords:function(g,v,a,c,_){var I,y,w,b,x=_?this.touchSizeX:this.sizeX,O=_?this.touchSizeY:this.sizeY;if(x&&O&&x!==O){var F=Math.atan2(O,x),L=Math.sqrt(x*x+O*O)/2,N=F-f.util.degreesToRadians(g),j=Math.PI/2-F-f.util.degreesToRadians(g);I=L*f.util.cos(N),y=L*f.util.sin(N),w=L*f.util.cos(j),b=L*f.util.sin(j)}else L=.7071067812*(x&&O?x:v),N=f.util.degreesToRadians(45-g),I=w=L*f.util.cos(N),y=b=L*f.util.sin(N);return{tl:{x:a-b,y:c-w},tr:{x:a+I,y:c-y},bl:{x:a-I,y:c+y},br:{x:a+b,y:c+w}}},render:function(g,v,a,c,_){"circle"===((c=c||{}).cornerStyle||_.cornerStyle)?f.controlsUtils.renderCircleControl.call(this,g,v,a,c,_):f.controlsUtils.renderSquareControl.call(this,g,v,a,c,_)}}}(n),function(){function m(g,v){var a,c,_,I,y=g.getAttribute("style"),w=g.getAttribute("offset")||0;if(w=(w=parseFloat(w)/(/%$/.test(w)?100:1))<0?0:w>1?1:w,y){var b=y.split(/\s*;\s*/);for(""===b[b.length-1]&&b.pop(),I=b.length;I--;){var x=b[I].split(/\s*:\s*/),O=x[0].trim(),F=x[1].trim();"stop-color"===O?a=F:"stop-opacity"===O&&(_=F)}}return a||(a=g.getAttribute("stop-color")||"rgb(0,0,0)"),_||(_=g.getAttribute("stop-opacity")),c=(a=new S.Color(a)).getAlpha(),_=isNaN(parseFloat(_))?1:parseFloat(_),_*=c*v,{offset:w,color:a.toRgb(),opacity:_}}var f=S.util.object.clone;S.Gradient=S.util.createClass({offsetX:0,offsetY:0,gradientTransform:null,gradientUnits:"pixels",type:"linear",initialize:function(g){g||(g={}),g.coords||(g.coords={});var v,a=this;Object.keys(g).forEach(function(c){a[c]=g[c]}),this.id?this.id+="_"+S.Object.__uid++:this.id=S.Object.__uid++,v={x1:g.coords.x1||0,y1:g.coords.y1||0,x2:g.coords.x2||0,y2:g.coords.y2||0},"radial"===this.type&&(v.r1=g.coords.r1||0,v.r2=g.coords.r2||0),this.coords=v,this.colorStops=g.colorStops.slice()},addColorStop:function(g){for(var v in g){var a=new S.Color(g[v]);this.colorStops.push({offset:parseFloat(v),color:a.toRgb(),opacity:a.getAlpha()})}return this},toObject:function(g){var v={type:this.type,coords:this.coords,colorStops:this.colorStops,offsetX:this.offsetX,offsetY:this.offsetY,gradientUnits:this.gradientUnits,gradientTransform:this.gradientTransform?this.gradientTransform.concat():this.gradientTransform};return S.util.populateWithProperties(this,v,g),v},toSVG:function(g,v){var a,c,_,I,y=f(this.coords,!0),w=(v=v||{},f(this.colorStops,!0)),b=y.r1>y.r2,x=this.gradientTransform?this.gradientTransform.concat():S.iMatrix.concat(),O=-this.offsetX,F=-this.offsetY,L=!!v.additionalTransform,N="pixels"===this.gradientUnits?"userSpaceOnUse":"objectBoundingBox";if(w.sort(function(ie,ee){return ie.offset-ee.offset}),"objectBoundingBox"===N?(O/=g.width,F/=g.height):(O+=g.width/2,F+=g.height/2),"path"===g.type&&"percentage"!==this.gradientUnits&&(O-=g.pathOffset.x,F-=g.pathOffset.y),x[4]-=O,x[5]-=F,I='id="SVGID_'+this.id+'" gradientUnits="'+N+'"',I+=' gradientTransform="'+(L?v.additionalTransform+" ":"")+S.util.matrixToSVG(x)+'" ',"linear"===this.type?_=["<linearGradient ",I,' x1="',y.x1,'" y1="',y.y1,'" x2="',y.x2,'" y2="',y.y2,'">\n']:"radial"===this.type&&(_=["<radialGradient ",I,' cx="',b?y.x1:y.x2,'" cy="',b?y.y1:y.y2,'" r="',b?y.r1:y.r2,'" fx="',b?y.x2:y.x1,'" fy="',b?y.y2:y.y1,'">\n']),"radial"===this.type){if(b)for((w=w.concat()).reverse(),a=0,c=w.length;a<c;a++)w[a].offset=1-w[a].offset;var j=Math.min(y.r1,y.r2);if(j>0){var $=j/Math.max(y.r1,y.r2);for(a=0,c=w.length;a<c;a++)w[a].offset+=$*(1-w[a].offset)}}for(a=0,c=w.length;a<c;a++){var X=w[a];_.push("<stop ",'offset="',100*X.offset+"%",'" style="stop-color:',X.color,void 0!==X.opacity?";stop-opacity: "+X.opacity:";",'"/>\n')}return _.push("linear"===this.type?"</linearGradient>\n":"</radialGradient>\n"),_.join("")},toLive:function(g){var v,a,c,_=S.util.object.clone(this.coords);if(this.type){for("linear"===this.type?v=g.createLinearGradient(_.x1,_.y1,_.x2,_.y2):"radial"===this.type&&(v=g.createRadialGradient(_.x1,_.y1,_.r1,_.x2,_.y2,_.r2)),a=0,c=this.colorStops.length;a<c;a++){var I=this.colorStops[a].color,y=this.colorStops[a].opacity,w=this.colorStops[a].offset;void 0!==y&&(I=new S.Color(I).setAlpha(y).toRgba()),v.addColorStop(w,I)}return v}}}),S.util.object.extend(S.Gradient,{fromElement:function(g,v,a,c){var _=parseFloat(a)/(/%$/.test(a)?100:1);_=_<0?0:_>1?1:_,isNaN(_)&&(_=1);var I,y,w,b,$,X,ie,ee,Q,W,x=g.getElementsByTagName("stop"),O="userSpaceOnUse"===g.getAttribute("gradientUnits")?"pixels":"percentage",F=g.getAttribute("gradientTransform")||"",L=[],N=0,j=0;for("linearGradient"===g.nodeName||"LINEARGRADIENT"===g.nodeName?(I="linear",y={x1:($=g).getAttribute("x1")||0,y1:$.getAttribute("y1")||0,x2:$.getAttribute("x2")||"100%",y2:$.getAttribute("y2")||0}):(I="radial",y=function($){return{x1:$.getAttribute("fx")||$.getAttribute("cx")||"50%",y1:$.getAttribute("fy")||$.getAttribute("cy")||"50%",r1:0,x2:$.getAttribute("cx")||"50%",y2:$.getAttribute("cy")||"50%",r2:$.getAttribute("r")||"50%"}}(g)),w=x.length;w--;)L.push(m(x[w],_));return b=S.parseTransformAttribute(F),X=y,ie=c,ee=O,Object.keys(X).forEach(function(H){"Infinity"===(Q=X[H])?W=1:"-Infinity"===Q?W=0:(W=parseFloat(X[H],10),"string"==typeof Q&&/^(\d+\.\d+)%|(\d+)%$/.test(Q)&&(W*=.01,"pixels"===ee&&("x1"!==H&&"x2"!==H&&"r2"!==H||(W*=ie.viewBoxWidth||ie.width),"y1"!==H&&"y2"!==H||(W*=ie.viewBoxHeight||ie.height)))),X[H]=W}),"pixels"===O&&(N=-v.left,j=-v.top),new S.Gradient({id:g.getAttribute("id"),type:I,coords:y,colorStops:L,gradientUnits:O,gradientTransform:b,offsetX:N,offsetY:j})}})}(),U=S.util.toFixed,S.Pattern=S.util.createClass({repeat:"repeat",offsetX:0,offsetY:0,crossOrigin:"",patternTransform:null,initialize:function(m,f){if(m||(m={}),this.id=S.Object.__uid++,this.setOptions(m),!m.source||m.source&&"string"!=typeof m.source)f&&f(this);else{var g=this;this.source=S.util.createImage(),S.util.loadImage(m.source,function(v,a){g.source=v,f&&f(g,a)},null,this.crossOrigin)}},toObject:function(m){var f,g,v=S.Object.NUM_FRACTION_DIGITS;return"string"==typeof this.source.src?f=this.source.src:"object"==typeof this.source&&this.source.toDataURL&&(f=this.source.toDataURL()),g={type:"pattern",source:f,repeat:this.repeat,crossOrigin:this.crossOrigin,offsetX:U(this.offsetX,v),offsetY:U(this.offsetY,v),patternTransform:this.patternTransform?this.patternTransform.concat():null},S.util.populateWithProperties(this,g,m),g},toSVG:function(m){var f="function"==typeof this.source?this.source():this.source,g=f.width/m.width,v=f.height/m.height,a=this.offsetX/m.width,c=this.offsetY/m.height,_="";return"repeat-x"!==this.repeat&&"no-repeat"!==this.repeat||(v=1,c&&(v+=Math.abs(c))),"repeat-y"!==this.repeat&&"no-repeat"!==this.repeat||(g=1,a&&(g+=Math.abs(a))),f.src?_=f.src:f.toDataURL&&(_=f.toDataURL()),'<pattern id="SVGID_'+this.id+'" x="'+a+'" y="'+c+'" width="'+g+'" height="'+v+'">\n<image x="0" y="0" width="'+f.width+'" height="'+f.height+'" xlink:href="'+_+'"></image>\n</pattern>\n'},setOptions:function(m){for(var f in m)this[f]=m[f]},toLive:function(m){var f=this.source;return f&&(void 0===f.src||f.complete&&0!==f.naturalWidth&&0!==f.naturalHeight)?m.createPattern(f,this.repeat):""}}),function(m){var f=m.fabric||(m.fabric={}),g=f.util.toFixed;f.Shadow?f.warn("fabric.Shadow is already defined."):(f.Shadow=f.util.createClass({color:"rgb(0,0,0)",blur:0,offsetX:0,offsetY:0,affectStroke:!1,includeDefaultValues:!0,nonScaling:!1,initialize:function(v){for(var a in"string"==typeof v&&(v=this._parseShadow(v)),v)this[a]=v[a];this.id=f.Object.__uid++},_parseShadow:function(v){var a=v.trim(),c=f.Shadow.reOffsetsAndBlur.exec(a)||[];return{color:(a.replace(f.Shadow.reOffsetsAndBlur,"")||"rgb(0,0,0)").trim(),offsetX:parseFloat(c[1],10)||0,offsetY:parseFloat(c[2],10)||0,blur:parseFloat(c[3],10)||0}},toString:function(){return[this.offsetX,this.offsetY,this.blur,this.color].join("px ")},toSVG:function(v){var a=40,c=40,_=f.Object.NUM_FRACTION_DIGITS,I=f.util.rotateVector({x:this.offsetX,y:this.offsetY},f.util.degreesToRadians(-v.angle)),y=new f.Color(this.color);return v.width&&v.height&&(a=100*g((Math.abs(I.x)+this.blur)/v.width,_)+20,c=100*g((Math.abs(I.y)+this.blur)/v.height,_)+20),v.flipX&&(I.x*=-1),v.flipY&&(I.y*=-1),'<filter id="SVGID_'+this.id+'" y="-'+c+'%" height="'+(100+2*c)+'%" x="-'+a+'%" width="'+(100+2*a)+'%" >\n\t<feGaussianBlur in="SourceAlpha" stdDeviation="'+g(this.blur?this.blur/2:0,_)+'"></feGaussianBlur>\n\t<feOffset dx="'+g(I.x,_)+'" dy="'+g(I.y,_)+'" result="oBlur" ></feOffset>\n\t<feFlood flood-color="'+y.toRgb()+'" flood-opacity="'+y.getAlpha()+'"/>\n\t<feComposite in2="oBlur" operator="in" />\n\t<feMerge>\n\t\t<feMergeNode></feMergeNode>\n\t\t<feMergeNode in="SourceGraphic"></feMergeNode>\n\t</feMerge>\n</filter>\n'},toObject:function(){if(this.includeDefaultValues)return{color:this.color,blur:this.blur,offsetX:this.offsetX,offsetY:this.offsetY,affectStroke:this.affectStroke,nonScaling:this.nonScaling};var v={},a=f.Shadow.prototype;return["color","blur","offsetX","offsetY","affectStroke","nonScaling"].forEach(function(c){this[c]!==a[c]&&(v[c]=this[c])},this),v}}),f.Shadow.reOffsetsAndBlur=/(?:\s|^)(-?\d+(?:\.\d*)?(?:px)?(?:\s?|$))?(-?\d+(?:\.\d*)?(?:px)?(?:\s?|$))?(\d+(?:\.\d*)?(?:px)?)?(?:\s?|$)(?:$|\s)/)}(n),function(){if(S.StaticCanvas)S.warn("fabric.StaticCanvas is already defined.");else{var m=S.util.object.extend,f=S.util.getElementOffset,g=S.util.removeFromArray,v=S.util.toFixed,a=S.util.transformPoint,c=S.util.invertTransform,_=S.util.getNodeCanvas,I=S.util.createCanvasElement,y=new Error("Could not initialize `canvas` element");S.StaticCanvas=S.util.createClass(S.CommonMethods,{initialize:function(w,b){b||(b={}),this.renderAndResetBound=this.renderAndReset.bind(this),this.requestRenderAllBound=this.requestRenderAll.bind(this),this._initStatic(w,b)},backgroundColor:"",backgroundImage:null,overlayColor:"",overlayImage:null,includeDefaultValues:!0,stateful:!1,renderOnAddRemove:!0,controlsAboveOverlay:!1,allowTouchScrolling:!1,imageSmoothingEnabled:!0,viewportTransform:S.iMatrix.concat(),backgroundVpt:!0,overlayVpt:!0,enableRetinaScaling:!0,vptCoords:{},skipOffscreen:!0,clipPath:void 0,_initStatic:function(w,b){var x=this.requestRenderAllBound;this._objects=[],this._createLowerCanvas(w),this._initOptions(b),this.interactive||this._initRetinaScaling(),b.overlayImage&&this.setOverlayImage(b.overlayImage,x),b.backgroundImage&&this.setBackgroundImage(b.backgroundImage,x),b.backgroundColor&&this.setBackgroundColor(b.backgroundColor,x),b.overlayColor&&this.setOverlayColor(b.overlayColor,x),this.calcOffset()},_isRetinaScaling:function(){return S.devicePixelRatio>1&&this.enableRetinaScaling},getRetinaScaling:function(){return this._isRetinaScaling()?Math.max(1,S.devicePixelRatio):1},_initRetinaScaling:function(){if(this._isRetinaScaling()){var w=S.devicePixelRatio;this.__initRetinaScaling(w,this.lowerCanvasEl,this.contextContainer),this.upperCanvasEl&&this.__initRetinaScaling(w,this.upperCanvasEl,this.contextTop)}},__initRetinaScaling:function(w,b,x){b.setAttribute("width",this.width*w),b.setAttribute("height",this.height*w),x.scale(w,w)},calcOffset:function(){return this._offset=f(this.lowerCanvasEl),this},setOverlayImage:function(w,b,x){return this.__setBgOverlayImage("overlayImage",w,b,x)},setBackgroundImage:function(w,b,x){return this.__setBgOverlayImage("backgroundImage",w,b,x)},setOverlayColor:function(w,b){return this.__setBgOverlayColor("overlayColor",w,b)},setBackgroundColor:function(w,b){return this.__setBgOverlayColor("backgroundColor",w,b)},__setBgOverlayImage:function(w,b,x,O){return"string"==typeof b?S.util.loadImage(b,function(F,L){if(F){var N=new S.Image(F,O);this[w]=N,N.canvas=this}x&&x(F,L)},this,O&&O.crossOrigin):(O&&b.setOptions(O),this[w]=b,b&&(b.canvas=this),x&&x(b,!1)),this},__setBgOverlayColor:function(w,b,x){return this[w]=b,this._initGradient(b,w),this._initPattern(b,w,x),this},_createCanvasElement:function(){var w=I();if(!w||(w.style||(w.style={}),void 0===w.getContext))throw y;return w},_initOptions:function(w){var b=this.lowerCanvasEl;this._setOptions(w),this.width=this.width||parseInt(b.width,10)||0,this.height=this.height||parseInt(b.height,10)||0,this.lowerCanvasEl.style&&(b.width=this.width,b.height=this.height,b.style.width=this.width+"px",b.style.height=this.height+"px",this.viewportTransform=this.viewportTransform.slice())},_createLowerCanvas:function(w){this.lowerCanvasEl=w&&w.getContext?w:S.util.getById(w)||this._createCanvasElement(),S.util.addClass(this.lowerCanvasEl,"lower-canvas"),this._originalCanvasStyle=this.lowerCanvasEl.style,this.interactive&&this._applyCanvasStyle(this.lowerCanvasEl),this.contextContainer=this.lowerCanvasEl.getContext("2d")},getWidth:function(){return this.width},getHeight:function(){return this.height},setWidth:function(w,b){return this.setDimensions({width:w},b)},setHeight:function(w,b){return this.setDimensions({height:w},b)},setDimensions:function(w,b){var x;for(var O in b=b||{},w)x=w[O],b.cssOnly||(this._setBackstoreDimension(O,w[O]),x+="px",this.hasLostContext=!0),b.backstoreOnly||this._setCssDimension(O,x);return this._isCurrentlyDrawing&&this.freeDrawingBrush&&this.freeDrawingBrush._setBrushStyles(this.contextTop),this._initRetinaScaling(),this.calcOffset(),b.cssOnly||this.requestRenderAll(),this},_setBackstoreDimension:function(w,b){return this.lowerCanvasEl[w]=b,this.upperCanvasEl&&(this.upperCanvasEl[w]=b),this.cacheCanvasEl&&(this.cacheCanvasEl[w]=b),this[w]=b,this},_setCssDimension:function(w,b){return this.lowerCanvasEl.style[w]=b,this.upperCanvasEl&&(this.upperCanvasEl.style[w]=b),this.wrapperEl&&(this.wrapperEl.style[w]=b),this},getZoom:function(){return this.viewportTransform[0]},setViewportTransform:function(w){var b,x,O,F=this._activeObject,L=this.backgroundImage,N=this.overlayImage;for(this.viewportTransform=w,x=0,O=this._objects.length;x<O;x++)(b=this._objects[x]).group||b.setCoords(!0);return F&&F.setCoords(),L&&L.setCoords(!0),N&&N.setCoords(!0),this.calcViewportBoundaries(),this.renderOnAddRemove&&this.requestRenderAll(),this},zoomToPoint:function(w,b){var x=w,O=this.viewportTransform.slice(0);w=a(w,c(this.viewportTransform)),O[0]=b,O[3]=b;var F=a(w,O);return O[4]+=x.x-F.x,O[5]+=x.y-F.y,this.setViewportTransform(O)},setZoom:function(w){return this.zoomToPoint(new S.Point(0,0),w),this},absolutePan:function(w){var b=this.viewportTransform.slice(0);return b[4]=-w.x,b[5]=-w.y,this.setViewportTransform(b)},relativePan:function(w){return this.absolutePan(new S.Point(-w.x-this.viewportTransform[4],-w.y-this.viewportTransform[5]))},getElement:function(){return this.lowerCanvasEl},_onObjectAdded:function(w){this.stateful&&w.setupState(),w._set("canvas",this),w.setCoords(),this.fire("object:added",{target:w}),w.fire("added")},_onObjectRemoved:function(w){this.fire("object:removed",{target:w}),w.fire("removed"),delete w.canvas},clearContext:function(w){return w.clearRect(0,0,this.width,this.height),this},getContext:function(){return this.contextContainer},clear:function(){return this.remove.apply(this,this.getObjects()),this.backgroundImage=null,this.overlayImage=null,this.backgroundColor="",this.overlayColor="",this._hasITextHandlers&&(this.off("mouse:up",this._mouseUpITextHandler),this._iTextInstances=null,this._hasITextHandlers=!1),this.clearContext(this.contextContainer),this.fire("canvas:cleared"),this.renderOnAddRemove&&this.requestRenderAll(),this},renderAll:function(){return this.renderCanvas(this.contextContainer,this._objects),this},renderAndReset:function(){this.isRendering=0,this.renderAll()},requestRenderAll:function(){return this.isRendering||(this.isRendering=S.util.requestAnimFrame(this.renderAndResetBound)),this},calcViewportBoundaries:function(){var w={},b=this.width,x=this.height,O=c(this.viewportTransform);return w.tl=a({x:0,y:0},O),w.br=a({x:b,y:x},O),w.tr=new S.Point(w.br.x,w.tl.y),w.bl=new S.Point(w.tl.x,w.br.y),this.vptCoords=w,w},cancelRequestedRender:function(){this.isRendering&&(S.util.cancelAnimFrame(this.isRendering),this.isRendering=0)},renderCanvas:function(w,b){var x=this.viewportTransform,O=this.clipPath;this.cancelRequestedRender(),this.calcViewportBoundaries(),this.clearContext(w),S.util.setImageSmoothing(w,this.imageSmoothingEnabled),this.fire("before:render",{ctx:w}),this._renderBackground(w),w.save(),w.transform(x[0],x[1],x[2],x[3],x[4],x[5]),this._renderObjects(w,b),w.restore(),!this.controlsAboveOverlay&&this.interactive&&this.drawControls(w),O&&(O.canvas=this,O.shouldCache(),O._transformDone=!0,O.renderCache({forClipping:!0}),this.drawClipPathOnCanvas(w)),this._renderOverlay(w),this.controlsAboveOverlay&&this.interactive&&this.drawControls(w),this.fire("after:render",{ctx:w})},drawClipPathOnCanvas:function(w){var b=this.viewportTransform,x=this.clipPath;w.save(),w.transform(b[0],b[1],b[2],b[3],b[4],b[5]),w.globalCompositeOperation="destination-in",x.transform(w),w.scale(1/x.zoomX,1/x.zoomY),w.drawImage(x._cacheCanvas,-x.cacheTranslationX,-x.cacheTranslationY),w.restore()},_renderObjects:function(w,b){var x,O;for(x=0,O=b.length;x<O;++x)b[x]&&b[x].render(w)},_renderBackgroundOrOverlay:function(w,b){var x=this[b+"Color"],O=this[b+"Image"],F=this.viewportTransform,L=this[b+"Vpt"];if(x||O){if(x){w.save(),w.beginPath(),w.moveTo(0,0),w.lineTo(this.width,0),w.lineTo(this.width,this.height),w.lineTo(0,this.height),w.closePath(),w.fillStyle=x.toLive?x.toLive(w,this):x,L&&w.transform(F[0],F[1],F[2],F[3],F[4],F[5]),w.transform(1,0,0,1,x.offsetX||0,x.offsetY||0);var N=x.gradientTransform||x.patternTransform;N&&w.transform(N[0],N[1],N[2],N[3],N[4],N[5]),w.fill(),w.restore()}O&&(w.save(),L&&w.transform(F[0],F[1],F[2],F[3],F[4],F[5]),O.render(w),w.restore())}},_renderBackground:function(w){this._renderBackgroundOrOverlay(w,"background")},_renderOverlay:function(w){this._renderBackgroundOrOverlay(w,"overlay")},getCenter:function(){return{top:this.height/2,left:this.width/2}},getCenterPoint:function(){return new S.Point(this.width/2,this.height/2)},centerObjectH:function(w){return this._centerObject(w,new S.Point(this.getCenterPoint().x,w.getCenterPoint().y))},centerObjectV:function(w){return this._centerObject(w,new S.Point(w.getCenterPoint().x,this.getCenterPoint().y))},centerObject:function(w){var b=this.getCenterPoint();return this._centerObject(w,b)},viewportCenterObject:function(w){var b=this.getVpCenter();return this._centerObject(w,b)},viewportCenterObjectH:function(w){var b=this.getVpCenter();return this._centerObject(w,new S.Point(b.x,w.getCenterPoint().y)),this},viewportCenterObjectV:function(w){var b=this.getVpCenter();return this._centerObject(w,new S.Point(w.getCenterPoint().x,b.y))},getVpCenter:function(){var w=this.getCenterPoint(),b=c(this.viewportTransform);return a(w,b)},_centerObject:function(w,b){return w.setPositionByOrigin(b,"center","center"),w.setCoords(),this.renderOnAddRemove&&this.requestRenderAll(),this},toDatalessJSON:function(w){return this.toDatalessObject(w)},toObject:function(w){return this._toObjectMethod("toObject",w)},toDatalessObject:function(w){return this._toObjectMethod("toDatalessObject",w)},_toObjectMethod:function(w,b){var x=this.clipPath,O={version:S.version,objects:this._toObjects(w,b)};return x&&!x.excludeFromExport&&(O.clipPath=this._toObject(this.clipPath,w,b)),m(O,this.__serializeBgOverlay(w,b)),S.util.populateWithProperties(this,O,b),O},_toObjects:function(w,b){return this._objects.filter(function(x){return!x.excludeFromExport}).map(function(x){return this._toObject(x,w,b)},this)},_toObject:function(w,b,x){var O;this.includeDefaultValues||(O=w.includeDefaultValues,w.includeDefaultValues=!1);var F=w[b](x);return this.includeDefaultValues||(w.includeDefaultValues=O),F},__serializeBgOverlay:function(w,b){var x={},O=this.backgroundImage,F=this.overlayImage,L=this.backgroundColor,N=this.overlayColor;return L&&L.toObject?L.excludeFromExport||(x.background=L.toObject(b)):L&&(x.background=L),N&&N.toObject?N.excludeFromExport||(x.overlay=N.toObject(b)):N&&(x.overlay=N),O&&!O.excludeFromExport&&(x.backgroundImage=this._toObject(O,w,b)),F&&!F.excludeFromExport&&(x.overlayImage=this._toObject(F,w,b)),x},svgViewportTransformation:!0,toSVG:function(w,b){w||(w={}),w.reviver=b;var x=[];return this._setSVGPreamble(x,w),this._setSVGHeader(x,w),this.clipPath&&x.push('<g clip-path="url(#'+this.clipPath.clipPathId+')" >\n'),this._setSVGBgOverlayColor(x,"background"),this._setSVGBgOverlayImage(x,"backgroundImage",b),this._setSVGObjects(x,b),this.clipPath&&x.push("</g>\n"),this._setSVGBgOverlayColor(x,"overlay"),this._setSVGBgOverlayImage(x,"overlayImage",b),x.push("</svg>"),x.join("")},_setSVGPreamble:function(w,b){b.suppressPreamble||w.push('<?xml version="1.0" encoding="',b.encoding||"UTF-8",'" standalone="no" ?>\n','<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN" ','"http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">\n')},_setSVGHeader:function(w,b){var x,O=b.width||this.width,F=b.height||this.height,L='viewBox="0 0 '+this.width+" "+this.height+'" ',N=S.Object.NUM_FRACTION_DIGITS;b.viewBox?L='viewBox="'+b.viewBox.x+" "+b.viewBox.y+" "+b.viewBox.width+" "+b.viewBox.height+'" ':this.svgViewportTransformation&&(L='viewBox="'+v(-(x=this.viewportTransform)[4]/x[0],N)+" "+v(-x[5]/x[3],N)+" "+v(this.width/x[0],N)+" "+v(this.height/x[3],N)+'" '),w.push("<svg ",'xmlns="http://www.w3.org/2000/svg" ','xmlns:xlink="http://www.w3.org/1999/xlink" ','version="1.1" ','width="',O,'" ','height="',F,'" ',L,'xml:space="preserve">\n',"<desc>Created with Fabric.js ",S.version,"</desc>\n","<defs>\n",this.createSVGFontFacesMarkup(),this.createSVGRefElementsMarkup(),this.createSVGClipPathMarkup(b),"</defs>\n")},createSVGClipPathMarkup:function(w){var b=this.clipPath;return b?(b.clipPathId="CLIPPATH_"+S.Object.__uid++,'<clipPath id="'+b.clipPathId+'" >\n'+this.clipPath.toClipPathSVG(w.reviver)+"</clipPath>\n"):""},createSVGRefElementsMarkup:function(){var w=this;return["background","overlay"].map(function(b){var x=w[b+"Color"];if(x&&x.toLive){var O=w[b+"Vpt"],F=w.viewportTransform;return x.toSVG({width:w.width/(O?F[0]:1),height:w.height/(O?F[3]:1)},{additionalTransform:O?S.util.matrixToSVG(F):""})}}).join("")},createSVGFontFacesMarkup:function(){var w,b,x,O,F,L,N,j,$="",X={},ie=S.fontPaths,ee=[];for(this._objects.forEach(function W(H){ee.push(H),H._objects&&H._objects.forEach(W)}),N=0,j=ee.length;N<j;N++)if(b=(w=ee[N]).fontFamily,-1!==w.type.indexOf("text")&&!X[b]&&ie[b]&&(X[b]=!0,w.styles))for(F in x=w.styles)for(L in O=x[F])!X[b=O[L].fontFamily]&&ie[b]&&(X[b]=!0);for(var Q in X)$+=["\t\t@font-face {\n","\t\t\tfont-family: '",Q,"';\n","\t\t\tsrc: url('",ie[Q],"');\n","\t\t}\n"].join("");return $&&($=['\t<style type="text/css">',"<![CDATA[\n",$,"]]>","</style>\n"].join("")),$},_setSVGObjects:function(w,b){var x,O,F,L=this._objects;for(O=0,F=L.length;O<F;O++)(x=L[O]).excludeFromExport||this._setSVGObject(w,x,b)},_setSVGObject:function(w,b,x){w.push(b.toSVG(x))},_setSVGBgOverlayImage:function(w,b,x){this[b]&&!this[b].excludeFromExport&&this[b].toSVG&&w.push(this[b].toSVG(x))},_setSVGBgOverlayColor:function(w,b){var x=this[b+"Color"],F=this.width,L=this.height;if(x)if(x.toLive){var N=x.repeat,j=S.util.invertTransform(this.viewportTransform),$=this[b+"Vpt"]?S.util.matrixToSVG(j):"";w.push('<rect transform="'+$+" translate(",F/2,",",L/2,')"',' x="',x.offsetX-F/2,'" y="',x.offsetY-L/2,'" ','width="',"repeat-y"===N||"no-repeat"===N?x.source.width:F,'" height="',"repeat-x"===N||"no-repeat"===N?x.source.height:L,'" fill="url(#SVGID_'+x.id+')"',"></rect>\n")}else w.push('<rect x="0" y="0" width="100%" height="100%" ','fill="',x,'"',"></rect>\n")},sendToBack:function(w){if(!w)return this;var b,x,O,F=this._activeObject;if(w===F&&"activeSelection"===w.type)for(b=(O=F._objects).length;b--;)g(this._objects,x=O[b]),this._objects.unshift(x);else g(this._objects,w),this._objects.unshift(w);return this.renderOnAddRemove&&this.requestRenderAll(),this},bringToFront:function(w){if(!w)return this;var b,x,O,F=this._activeObject;if(w===F&&"activeSelection"===w.type)for(O=F._objects,b=0;b<O.length;b++)g(this._objects,x=O[b]),this._objects.push(x);else g(this._objects,w),this._objects.push(w);return this.renderOnAddRemove&&this.requestRenderAll(),this},sendBackwards:function(w,b){if(!w)return this;var x,O,F,L,N,j=this._activeObject,$=0;if(w===j&&"activeSelection"===w.type)for(N=j._objects,x=0;x<N.length;x++)(F=this._objects.indexOf(O=N[x]))>0+$&&(L=F-1,g(this._objects,O),this._objects.splice(L,0,O)),$++;else 0!==(F=this._objects.indexOf(w))&&(L=this._findNewLowerIndex(w,F,b),g(this._objects,w),this._objects.splice(L,0,w));return this.renderOnAddRemove&&this.requestRenderAll(),this},_findNewLowerIndex:function(w,b,x){var O,F;if(x){for(O=b,F=b-1;F>=0;--F)if(w.intersectsWithObject(this._objects[F])||w.isContainedWithinObject(this._objects[F])||this._objects[F].isContainedWithinObject(w)){O=F;break}}else O=b-1;return O},bringForward:function(w,b){if(!w)return this;var x,O,F,L,N,j=this._activeObject,$=0;if(w===j&&"activeSelection"===w.type)for(x=(N=j._objects).length;x--;)(F=this._objects.indexOf(O=N[x]))<this._objects.length-1-$&&(L=F+1,g(this._objects,O),this._objects.splice(L,0,O)),$++;else(F=this._objects.indexOf(w))!==this._objects.length-1&&(L=this._findNewUpperIndex(w,F,b),g(this._objects,w),this._objects.splice(L,0,w));return this.renderOnAddRemove&&this.requestRenderAll(),this},_findNewUpperIndex:function(w,b,x){var O,F,L;if(x){for(O=b,F=b+1,L=this._objects.length;F<L;++F)if(w.intersectsWithObject(this._objects[F])||w.isContainedWithinObject(this._objects[F])||this._objects[F].isContainedWithinObject(w)){O=F;break}}else O=b+1;return O},moveTo:function(w,b){return g(this._objects,w),this._objects.splice(b,0,w),this.renderOnAddRemove&&this.requestRenderAll()},dispose:function(){return this.isRendering&&(S.util.cancelAnimFrame(this.isRendering),this.isRendering=0),this.forEachObject(function(w){w.dispose&&w.dispose()}),this._objects=[],this.backgroundImage&&this.backgroundImage.dispose&&this.backgroundImage.dispose(),this.backgroundImage=null,this.overlayImage&&this.overlayImage.dispose&&this.overlayImage.dispose(),this.overlayImage=null,this._iTextInstances=null,this.contextContainer=null,this.lowerCanvasEl.classList.remove("lower-canvas"),S.util.setStyle(this.lowerCanvasEl,this._originalCanvasStyle),delete this._originalCanvasStyle,this.lowerCanvasEl.setAttribute("width",this.width),this.lowerCanvasEl.setAttribute("height",this.height),S.util.cleanUpJsdomNode(this.lowerCanvasEl),this.lowerCanvasEl=void 0,this},toString:function(){return"#<fabric.Canvas ("+this.complexity()+"): { objects: "+this._objects.length+" }>"}}),m(S.StaticCanvas.prototype,S.Observable),m(S.StaticCanvas.prototype,S.Collection),m(S.StaticCanvas.prototype,S.DataURLExporter),m(S.StaticCanvas,{EMPTY_JSON:'{"objects": [], "background": "white"}',supports:function(w){var b=I();if(!b||!b.getContext)return null;var x=b.getContext("2d");return x&&"setLineDash"===w?void 0!==x.setLineDash:null}}),S.StaticCanvas.prototype.toJSON=S.StaticCanvas.prototype.toObject,S.isLikelyNode&&(S.StaticCanvas.prototype.createPNGStream=function(){var w=_(this.lowerCanvasEl);return w&&w.createPNGStream()},S.StaticCanvas.prototype.createJPEGStream=function(w){var b=_(this.lowerCanvasEl);return b&&b.createJPEGStream(w)})}}(),S.BaseBrush=S.util.createClass({color:"rgb(0, 0, 0)",width:1,shadow:null,strokeLineCap:"round",strokeLineJoin:"round",strokeMiterLimit:10,strokeDashArray:null,limitedToCanvasSize:!1,_setBrushStyles:function(m){m.strokeStyle=this.color,m.lineWidth=this.width,m.lineCap=this.strokeLineCap,m.miterLimit=this.strokeMiterLimit,m.lineJoin=this.strokeLineJoin,m.setLineDash(this.strokeDashArray||[])},_saveAndTransform:function(m){var f=this.canvas.viewportTransform;m.save(),m.transform(f[0],f[1],f[2],f[3],f[4],f[5])},_setShadow:function(){if(this.shadow){var m=this.canvas,f=this.shadow,g=m.contextTop,v=m.getZoom();m&&m._isRetinaScaling()&&(v*=S.devicePixelRatio),g.shadowColor=f.color,g.shadowBlur=f.blur*v,g.shadowOffsetX=f.offsetX*v,g.shadowOffsetY=f.offsetY*v}},needsFullRender:function(){return new S.Color(this.color).getAlpha()<1||!!this.shadow},_resetShadow:function(){var m=this.canvas.contextTop;m.shadowColor="",m.shadowBlur=m.shadowOffsetX=m.shadowOffsetY=0},_isOutSideCanvas:function(m){return m.x<0||m.x>this.canvas.getWidth()||m.y<0||m.y>this.canvas.getHeight()}}),S.PencilBrush=S.util.createClass(S.BaseBrush,{decimate:.4,drawStraightLine:!1,straightLineKey:"shiftKey",initialize:function(m){this.canvas=m,this._points=[]},needsFullRender:function(){return this.callSuper("needsFullRender")||this._hasStraightLine},_drawSegment:function(m,f,g){var v=f.midPointFrom(g);return m.quadraticCurveTo(f.x,f.y,v.x,v.y),v},onMouseDown:function(m,f){this.canvas._isMainEvent(f.e)&&(this.drawStraightLine=f.e[this.straightLineKey],this._prepareForDrawing(m),this._captureDrawingPath(m),this._render())},onMouseMove:function(m,f){if(this.canvas._isMainEvent(f.e)&&(this.drawStraightLine=f.e[this.straightLineKey],(!0!==this.limitedToCanvasSize||!this._isOutSideCanvas(m))&&this._captureDrawingPath(m)&&this._points.length>1))if(this.needsFullRender())this.canvas.clearContext(this.canvas.contextTop),this._render();else{var g=this._points,v=g.length,a=this.canvas.contextTop;this._saveAndTransform(a),this.oldEnd&&(a.beginPath(),a.moveTo(this.oldEnd.x,this.oldEnd.y)),this.oldEnd=this._drawSegment(a,g[v-2],g[v-1],!0),a.stroke(),a.restore()}},onMouseUp:function(m){return!this.canvas._isMainEvent(m.e)||(this.drawStraightLine=!1,this.oldEnd=void 0,this._finalizeAndAddPath(),!1)},_prepareForDrawing:function(m){var f=new S.Point(m.x,m.y);this._reset(),this._addPoint(f),this.canvas.contextTop.moveTo(f.x,f.y)},_addPoint:function(m){return!(this._points.length>1&&m.eq(this._points[this._points.length-1])||(this.drawStraightLine&&this._points.length>1&&(this._hasStraightLine=!0,this._points.pop()),this._points.push(m),0))},_reset:function(){this._points=[],this._setBrushStyles(this.canvas.contextTop),this._setShadow(),this._hasStraightLine=!1},_captureDrawingPath:function(m){var f=new S.Point(m.x,m.y);return this._addPoint(f)},_render:function(m){var f,g,v=this._points[0],a=this._points[1];if(this._saveAndTransform(m=m||this.canvas.contextTop),m.beginPath(),2===this._points.length&&v.x===a.x&&v.y===a.y){var c=this.width/1e3;v=new S.Point(v.x,v.y),a=new S.Point(a.x,a.y),v.x-=c,a.x+=c}for(m.moveTo(v.x,v.y),f=1,g=this._points.length;f<g;f++)this._drawSegment(m,v,a),v=this._points[f],a=this._points[f+1];m.lineTo(v.x,v.y),m.stroke(),m.restore()},convertPointsToSVGPath:function(m){return S.util.getSmoothPathFromPoints(m,this.width/1e3)},_isEmptySVGPath:function(m){return"M 0 0 Q 0 0 0 0 L 0 0"===S.util.joinPath(m)},createPath:function(m){var f=new S.Path(m,{fill:null,stroke:this.color,strokeWidth:this.width,strokeLineCap:this.strokeLineCap,strokeMiterLimit:this.strokeMiterLimit,strokeLineJoin:this.strokeLineJoin,strokeDashArray:this.strokeDashArray});return this.shadow&&(this.shadow.affectStroke=!0,f.shadow=new S.Shadow(this.shadow)),f},decimatePoints:function(m,f){if(m.length<=2)return m;var g,v=this.canvas.getZoom(),a=Math.pow(f/v,2),c=m.length-1,_=m[0],I=[_];for(g=1;g<c-1;g++)Math.pow(_.x-m[g].x,2)+Math.pow(_.y-m[g].y,2)>=a&&I.push(_=m[g]);return I.push(m[c]),I},_finalizeAndAddPath:function(){this.canvas.contextTop.closePath(),this.decimate&&(this._points=this.decimatePoints(this._points,this.decimate));var m=this.convertPointsToSVGPath(this._points);if(this._isEmptySVGPath(m))this.canvas.requestRenderAll();else{var f=this.createPath(m);this.canvas.clearContext(this.canvas.contextTop),this.canvas.fire("before:path:created",{path:f}),this.canvas.add(f),this.canvas.requestRenderAll(),f.setCoords(),this._resetShadow(),this.canvas.fire("path:created",{path:f})}}}),S.CircleBrush=S.util.createClass(S.BaseBrush,{width:10,initialize:function(m){this.canvas=m,this.points=[]},drawDot:function(m){var f=this.addPoint(m),g=this.canvas.contextTop;this._saveAndTransform(g),this.dot(g,f),g.restore()},dot:function(m,f){m.fillStyle=f.fill,m.beginPath(),m.arc(f.x,f.y,f.radius,0,2*Math.PI,!1),m.closePath(),m.fill()},onMouseDown:function(m){this.points.length=0,this.canvas.clearContext(this.canvas.contextTop),this._setShadow(),this.drawDot(m)},_render:function(){var m,f,g=this.canvas.contextTop,v=this.points;for(this._saveAndTransform(g),m=0,f=v.length;m<f;m++)this.dot(g,v[m]);g.restore()},onMouseMove:function(m){!0===this.limitedToCanvasSize&&this._isOutSideCanvas(m)||(this.needsFullRender()?(this.canvas.clearContext(this.canvas.contextTop),this.addPoint(m),this._render()):this.drawDot(m))},onMouseUp:function(){var m,f,g=this.canvas.renderOnAddRemove;this.canvas.renderOnAddRemove=!1;var v=[];for(m=0,f=this.points.length;m<f;m++){var a=this.points[m],c=new S.Circle({radius:a.radius,left:a.x,top:a.y,originX:"center",originY:"center",fill:a.fill});this.shadow&&(c.shadow=new S.Shadow(this.shadow)),v.push(c)}var _=new S.Group(v);_.canvas=this.canvas,this.canvas.fire("before:path:created",{path:_}),this.canvas.add(_),this.canvas.fire("path:created",{path:_}),this.canvas.clearContext(this.canvas.contextTop),this._resetShadow(),this.canvas.renderOnAddRemove=g,this.canvas.requestRenderAll()},addPoint:function(m){var f=new S.Point(m.x,m.y),g=S.util.getRandomInt(Math.max(0,this.width-20),this.width+20)/2,v=new S.Color(this.color).setAlpha(S.util.getRandomInt(0,100)/100).toRgba();return f.radius=g,f.fill=v,this.points.push(f),f}}),S.SprayBrush=S.util.createClass(S.BaseBrush,{width:10,density:20,dotWidth:1,dotWidthVariance:1,randomOpacity:!1,optimizeOverlapping:!0,initialize:function(m){this.canvas=m,this.sprayChunks=[]},onMouseDown:function(m){this.sprayChunks.length=0,this.canvas.clearContext(this.canvas.contextTop),this._setShadow(),this.addSprayChunk(m),this.render(this.sprayChunkPoints)},onMouseMove:function(m){!0===this.limitedToCanvasSize&&this._isOutSideCanvas(m)||(this.addSprayChunk(m),this.render(this.sprayChunkPoints))},onMouseUp:function(){var m=this.canvas.renderOnAddRemove;this.canvas.renderOnAddRemove=!1;for(var f=[],g=0,v=this.sprayChunks.length;g<v;g++)for(var a=this.sprayChunks[g],c=0,_=a.length;c<_;c++){var I=new S.Rect({width:a[c].width,height:a[c].width,left:a[c].x+1,top:a[c].y+1,originX:"center",originY:"center",fill:this.color});f.push(I)}this.optimizeOverlapping&&(f=this._getOptimizedRects(f));var y=new S.Group(f);this.shadow&&y.set("shadow",new S.Shadow(this.shadow)),this.canvas.fire("before:path:created",{path:y}),this.canvas.add(y),this.canvas.fire("path:created",{path:y}),this.canvas.clearContext(this.canvas.contextTop),this._resetShadow(),this.canvas.renderOnAddRemove=m,this.canvas.requestRenderAll()},_getOptimizedRects:function(m){var f,g,v,a={};for(g=0,v=m.length;g<v;g++)a[f=m[g].left+""+m[g].top]||(a[f]=m[g]);var c=[];for(f in a)c.push(a[f]);return c},render:function(m){var f,g,v=this.canvas.contextTop;for(v.fillStyle=this.color,this._saveAndTransform(v),f=0,g=m.length;f<g;f++){var a=m[f];void 0!==a.opacity&&(v.globalAlpha=a.opacity),v.fillRect(a.x,a.y,a.width,a.width)}v.restore()},_render:function(){var m,f,g=this.canvas.contextTop;for(g.fillStyle=this.color,this._saveAndTransform(g),m=0,f=this.sprayChunks.length;m<f;m++)this.render(this.sprayChunks[m]);g.restore()},addSprayChunk:function(m){this.sprayChunkPoints=[];var f,g,v,a,c=this.width/2;for(a=0;a<this.density;a++){f=S.util.getRandomInt(m.x-c,m.x+c),g=S.util.getRandomInt(m.y-c,m.y+c),v=this.dotWidthVariance?S.util.getRandomInt(Math.max(1,this.dotWidth-this.dotWidthVariance),this.dotWidth+this.dotWidthVariance):this.dotWidth;var _=new S.Point(f,g);_.width=v,this.randomOpacity&&(_.opacity=S.util.getRandomInt(0,100)/100),this.sprayChunkPoints.push(_)}this.sprayChunks.push(this.sprayChunkPoints)}}),S.PatternBrush=S.util.createClass(S.PencilBrush,{getPatternSrc:function(){var m=S.util.createCanvasElement(),f=m.getContext("2d");return m.width=m.height=25,f.fillStyle=this.color,f.beginPath(),f.arc(10,10,10,0,2*Math.PI,!1),f.closePath(),f.fill(),m},getPatternSrcFunction:function(){return String(this.getPatternSrc).replace("this.color",'"'+this.color+'"')},getPattern:function(m){return m.createPattern(this.source||this.getPatternSrc(),"repeat")},_setBrushStyles:function(m){this.callSuper("_setBrushStyles",m),m.strokeStyle=this.getPattern(m)},createPath:function(m){var f=this.callSuper("createPath",m),g=f._getLeftTopCoords().scalarAdd(f.strokeWidth/2);return f.stroke=new S.Pattern({source:this.source||this.getPatternSrcFunction(),offsetX:-g.x,offsetY:-g.y}),f}}),function(){var m=S.util.getPointer,f=S.util.degreesToRadians,g=S.util.isTouchEvent;for(var v in S.Canvas=S.util.createClass(S.StaticCanvas,{initialize:function(a,c){c||(c={}),this.renderAndResetBound=this.renderAndReset.bind(this),this.requestRenderAllBound=this.requestRenderAll.bind(this),this._initStatic(a,c),this._initInteractive(),this._createCacheCanvas()},uniformScaling:!0,uniScaleKey:"shiftKey",centeredScaling:!1,centeredRotation:!1,centeredKey:"altKey",altActionKey:"shiftKey",interactive:!0,selection:!0,selectionKey:"shiftKey",altSelectionKey:null,selectionColor:"rgba(100, 100, 255, 0.3)",selectionDashArray:[],selectionBorderColor:"rgba(255, 255, 255, 0.3)",selectionLineWidth:1,selectionFullyContained:!1,hoverCursor:"move",moveCursor:"move",defaultCursor:"default",freeDrawingCursor:"crosshair",notAllowedCursor:"not-allowed",containerClass:"canvas-container",perPixelTargetFind:!1,targetFindTolerance:0,skipTargetFind:!1,isDrawingMode:!1,preserveObjectStacking:!1,snapAngle:0,snapThreshold:null,stopContextMenu:!1,fireRightClick:!1,fireMiddleClick:!1,targets:[],enablePointerEvents:!1,_hoveredTarget:null,_hoveredTargets:[],_initInteractive:function(){this._currentTransform=null,this._groupSelector=null,this._initWrapperElement(),this._createUpperCanvas(),this._initEventListeners(),this._initRetinaScaling(),this.freeDrawingBrush=S.PencilBrush&&new S.PencilBrush(this),this.calcOffset()},_chooseObjectsToRender:function(){var a,c,_,I=this.getActiveObjects();if(I.length>0&&!this.preserveObjectStacking){c=[],_=[];for(var y=0,w=this._objects.length;y<w;y++)-1===I.indexOf(a=this._objects[y])?c.push(a):_.push(a);I.length>1&&(this._activeObject._objects=_),c.push.apply(c,_)}else c=this._objects;return c},renderAll:function(){return!this.contextTopDirty||this._groupSelector||this.isDrawingMode||(this.clearContext(this.contextTop),this.contextTopDirty=!1),this.hasLostContext&&(this.renderTopLayer(this.contextTop),this.hasLostContext=!1),this.renderCanvas(this.contextContainer,this._chooseObjectsToRender()),this},renderTopLayer:function(a){a.save(),this.isDrawingMode&&this._isCurrentlyDrawing&&(this.freeDrawingBrush&&this.freeDrawingBrush._render(),this.contextTopDirty=!0),this.selection&&this._groupSelector&&(this._drawSelection(a),this.contextTopDirty=!0),a.restore()},renderTop:function(){var a=this.contextTop;return this.clearContext(a),this.renderTopLayer(a),this.fire("after:render"),this},_normalizePointer:function(a,c){var _=a.calcTransformMatrix(),I=S.util.invertTransform(_),y=this.restorePointerVpt(c);return S.util.transformPoint(y,I)},isTargetTransparent:function(a,c,_){if(a.shouldCache()&&a._cacheCanvas&&a!==this._activeObject){var I=this._normalizePointer(a,{x:c,y:_}),y=Math.max(a.cacheTranslationX+I.x*a.zoomX,0),w=Math.max(a.cacheTranslationY+I.y*a.zoomY,0);return S.util.isTransparent(a._cacheContext,Math.round(y),Math.round(w),this.targetFindTolerance)}var b=this.contextCache,x=a.selectionBackgroundColor,O=this.viewportTransform;return a.selectionBackgroundColor="",this.clearContext(b),b.save(),b.transform(O[0],O[1],O[2],O[3],O[4],O[5]),a.render(b),b.restore(),a.selectionBackgroundColor=x,S.util.isTransparent(b,c,_,this.targetFindTolerance)},_isSelectionKeyPressed:function(a){return Array.isArray(this.selectionKey)?!!this.selectionKey.find(function(c){return!0===a[c]}):a[this.selectionKey]},_shouldClearSelection:function(a,c){var _=this.getActiveObjects(),I=this._activeObject;return!c||c&&I&&_.length>1&&-1===_.indexOf(c)&&I!==c&&!this._isSelectionKeyPressed(a)||c&&!c.evented||c&&!c.selectable&&I&&I!==c},_shouldCenterTransform:function(a,c,_){var I;if(a)return"scale"===c||"scaleX"===c||"scaleY"===c||"resizing"===c?I=this.centeredScaling||a.centeredScaling:"rotate"===c&&(I=this.centeredRotation||a.centeredRotation),I?!_:_},_getOriginFromCorner:function(a,c){var _={x:a.originX,y:a.originY};return"ml"===c||"tl"===c||"bl"===c?_.x="right":"mr"!==c&&"tr"!==c&&"br"!==c||(_.x="left"),"tl"===c||"mt"===c||"tr"===c?_.y="bottom":"bl"!==c&&"mb"!==c&&"br"!==c||(_.y="top"),_},_getActionFromCorner:function(a,c,_,I){if(!c||!a)return"drag";var y=I.controls[c];return y.getActionName(_,y,I)},_setupCurrentTransform:function(a,c,_){if(c){var I=this.getPointer(a),y=c.__corner,w=c.controls[y],b=_&&y?w.getActionHandler(a,c,w):S.controlsUtils.dragHandler,x=this._getActionFromCorner(_,y,a,c),O=this._getOriginFromCorner(c,y),F=a[this.centeredKey],L={target:c,action:x,actionHandler:b,corner:y,scaleX:c.scaleX,scaleY:c.scaleY,skewX:c.skewX,skewY:c.skewY,offsetX:I.x-c.left,offsetY:I.y-c.top,originX:O.x,originY:O.y,ex:I.x,ey:I.y,lastX:I.x,lastY:I.y,theta:f(c.angle),width:c.width*c.scaleX,shiftKey:a.shiftKey,altKey:F,original:S.util.saveObjectTransform(c)};this._shouldCenterTransform(c,x,F)&&(L.originX="center",L.originY="center"),L.original.originX=O.x,L.original.originY=O.y,this._currentTransform=L,this._beforeTransform(a)}},setCursor:function(a){this.upperCanvasEl.style.cursor=a},_drawSelection:function(a){var c=this._groupSelector,_=new S.Point(c.ex,c.ey),I=S.util.transformPoint(_,this.viewportTransform),y=new S.Point(c.ex+c.left,c.ey+c.top),w=S.util.transformPoint(y,this.viewportTransform),b=Math.min(I.x,w.x),x=Math.min(I.y,w.y),O=Math.max(I.x,w.x),F=Math.max(I.y,w.y),L=this.selectionLineWidth/2;this.selectionColor&&(a.fillStyle=this.selectionColor,a.fillRect(b,x,O-b,F-x)),this.selectionLineWidth&&this.selectionBorderColor&&(a.lineWidth=this.selectionLineWidth,a.strokeStyle=this.selectionBorderColor,b+=L,x+=L,O-=L,F-=L,S.Object.prototype._setLineDash.call(this,a,this.selectionDashArray),a.strokeRect(b,x,O-b,F-x))},findTarget:function(a,c){if(!this.skipTargetFind){var _,I,y=this.getPointer(a,!0),w=this._activeObject,b=this.getActiveObjects(),x=g(a),O=b.length>1&&!c||1===b.length;if(this.targets=[],O&&w._findTargetCorner(y,x)||b.length>1&&!c&&w===this._searchPossibleTargets([w],y))return w;if(1===b.length&&w===this._searchPossibleTargets([w],y)){if(!this.preserveObjectStacking)return w;_=w,I=this.targets,this.targets=[]}var F=this._searchPossibleTargets(this._objects,y);return a[this.altSelectionKey]&&F&&_&&F!==_&&(F=_,this.targets=I),F}},_checkTarget:function(a,c,_){if(c&&c.visible&&c.evented&&c.containsPoint(a)&&(!this.perPixelTargetFind&&!c.perPixelTargetFind||c.isEditing||!this.isTargetTransparent(c,_.x,_.y)))return!0},_searchPossibleTargets:function(a,c){for(var _,I,y=a.length;y--;){var w=a[y],b=w.group?this._normalizePointer(w.group,c):c;if(this._checkTarget(b,w,c)){(_=a[y]).subTargetCheck&&_ instanceof S.Group&&(I=this._searchPossibleTargets(_._objects,c))&&this.targets.push(I);break}}return _},restorePointerVpt:function(a){return S.util.transformPoint(a,S.util.invertTransform(this.viewportTransform))},getPointer:function(a,c){if(this._absolutePointer&&!c)return this._absolutePointer;if(this._pointer&&c)return this._pointer;var _,I=m(a),y=this.upperCanvasEl,w=y.getBoundingClientRect(),b=w.width||0,x=w.height||0;b&&x||("top"in w&&"bottom"in w&&(x=Math.abs(w.top-w.bottom)),"right"in w&&"left"in w&&(b=Math.abs(w.right-w.left))),this.calcOffset(),I.x=I.x-this._offset.left,I.y=I.y-this._offset.top,c||(I=this.restorePointerVpt(I));var O=this.getRetinaScaling();return 1!==O&&(I.x/=O,I.y/=O),{x:I.x*(_=0===b||0===x?{width:1,height:1}:{width:y.width/b,height:y.height/x}).width,y:I.y*_.height}},_createUpperCanvas:function(){var a=this.lowerCanvasEl.className.replace(/\s*lower-canvas\s*/,""),c=this.lowerCanvasEl,_=this.upperCanvasEl;_?_.className="":(_=this._createCanvasElement(),this.upperCanvasEl=_),S.util.addClass(_,"upper-canvas "+a),this.wrapperEl.appendChild(_),this._copyCanvasStyle(c,_),this._applyCanvasStyle(_),this.contextTop=_.getContext("2d")},getTopContext:function(){return this.contextTop},_createCacheCanvas:function(){this.cacheCanvasEl=this._createCanvasElement(),this.cacheCanvasEl.setAttribute("width",this.width),this.cacheCanvasEl.setAttribute("height",this.height),this.contextCache=this.cacheCanvasEl.getContext("2d")},_initWrapperElement:function(){this.wrapperEl=S.util.wrapElement(this.lowerCanvasEl,"div",{class:this.containerClass}),S.util.setStyle(this.wrapperEl,{width:this.width+"px",height:this.height+"px",position:"relative"}),S.util.makeElementUnselectable(this.wrapperEl)},_applyCanvasStyle:function(a){var c=this.width||a.width,_=this.height||a.height;S.util.setStyle(a,{position:"absolute",width:c+"px",height:_+"px",left:0,top:0,"touch-action":this.allowTouchScrolling?"manipulation":"none","-ms-touch-action":this.allowTouchScrolling?"manipulation":"none"}),a.width=c,a.height=_,S.util.makeElementUnselectable(a)},_copyCanvasStyle:function(a,c){c.style.cssText=a.style.cssText},getSelectionContext:function(){return this.contextTop},getSelectionElement:function(){return this.upperCanvasEl},getActiveObject:function(){return this._activeObject},getActiveObjects:function(){var a=this._activeObject;return a?"activeSelection"===a.type&&a._objects?a._objects.slice(0):[a]:[]},_onObjectRemoved:function(a){a===this._activeObject&&(this.fire("before:selection:cleared",{target:a}),this._discardActiveObject(),this.fire("selection:cleared",{target:a}),a.fire("deselected")),a===this._hoveredTarget&&(this._hoveredTarget=null,this._hoveredTargets=[]),this.callSuper("_onObjectRemoved",a)},_fireSelectionEvents:function(a,c){var _=!1,I=this.getActiveObjects(),y=[],w=[];a.forEach(function(b){-1===I.indexOf(b)&&(_=!0,b.fire("deselected",{e:c,target:b}),w.push(b))}),I.forEach(function(b){-1===a.indexOf(b)&&(_=!0,b.fire("selected",{e:c,target:b}),y.push(b))}),a.length>0&&I.length>0?_&&this.fire("selection:updated",{e:c,selected:y,deselected:w}):I.length>0?this.fire("selection:created",{e:c,selected:y}):a.length>0&&this.fire("selection:cleared",{e:c,deselected:w})},setActiveObject:function(a,c){var _=this.getActiveObjects();return this._setActiveObject(a,c),this._fireSelectionEvents(_,c),this},_setActiveObject:function(a,c){return this._activeObject!==a&&!!this._discardActiveObject(c,a)&&!a.onSelect({e:c})&&(this._activeObject=a,!0)},_discardActiveObject:function(a,c){var _=this._activeObject;if(_){if(_.onDeselect({e:a,object:c}))return!1;this._activeObject=null}return!0},discardActiveObject:function(a){var c=this.getActiveObjects(),_=this.getActiveObject();return c.length&&this.fire("before:selection:cleared",{target:_,e:a}),this._discardActiveObject(a),this._fireSelectionEvents(c,a),this},dispose:function(){var a=this.wrapperEl;return this.removeListeners(),a.removeChild(this.upperCanvasEl),a.removeChild(this.lowerCanvasEl),this.contextCache=null,this.contextTop=null,["upperCanvasEl","cacheCanvasEl"].forEach(function(c){S.util.cleanUpJsdomNode(this[c]),this[c]=void 0}.bind(this)),a.parentNode&&a.parentNode.replaceChild(this.lowerCanvasEl,this.wrapperEl),delete this.wrapperEl,S.StaticCanvas.prototype.dispose.call(this),this},clear:function(){return this.discardActiveObject(),this.clearContext(this.contextTop),this.callSuper("clear")},drawControls:function(a){var c=this._activeObject;c&&c._renderControls(a)},_toObject:function(a,c,_){var I=this._realizeGroupTransformOnObject(a),y=this.callSuper("_toObject",a,c,_);return this._unwindGroupTransformOnObject(a,I),y},_realizeGroupTransformOnObject:function(a){if(a.group&&"activeSelection"===a.group.type&&this._activeObject===a.group){var c={};return["angle","flipX","flipY","left","scaleX","scaleY","skewX","skewY","top"].forEach(function(_){c[_]=a[_]}),S.util.addTransformToObject(a,this._activeObject.calcOwnMatrix()),c}return null},_unwindGroupTransformOnObject:function(a,c){c&&a.set(c)},_setSVGObject:function(a,c,_){var I=this._realizeGroupTransformOnObject(c);this.callSuper("_setSVGObject",a,c,_),this._unwindGroupTransformOnObject(c,I)},setViewportTransform:function(a){this.renderOnAddRemove&&this._activeObject&&this._activeObject.isEditing&&this._activeObject.clearContextTop(),S.StaticCanvas.prototype.setViewportTransform.call(this,a)}}),S.StaticCanvas)"prototype"!==v&&(S.Canvas[v]=S.StaticCanvas[v])}(),function(){var m=S.util.addListener,f=S.util.removeListener,g={passive:!1};function v(a,c){return a.button&&a.button===c-1}S.util.object.extend(S.Canvas.prototype,{mainTouchId:null,_initEventListeners:function(){this.removeListeners(),this._bindEvents(),this.addOrRemove(m,"add")},_getEventPrefix:function(){return this.enablePointerEvents?"pointer":"mouse"},addOrRemove:function(a,c){var _=this.upperCanvasEl,I=this._getEventPrefix();a(S.window,"resize",this._onResize),a(_,I+"down",this._onMouseDown),a(_,I+"move",this._onMouseMove,g),a(_,I+"out",this._onMouseOut),a(_,I+"enter",this._onMouseEnter),a(_,"wheel",this._onMouseWheel),a(_,"contextmenu",this._onContextMenu),a(_,"dblclick",this._onDoubleClick),a(_,"dragover",this._onDragOver),a(_,"dragenter",this._onDragEnter),a(_,"dragleave",this._onDragLeave),a(_,"drop",this._onDrop),this.enablePointerEvents||a(_,"touchstart",this._onTouchStart,g),typeof eventjs<"u"&&c in eventjs&&(eventjs[c](_,"gesture",this._onGesture),eventjs[c](_,"drag",this._onDrag),eventjs[c](_,"orientation",this._onOrientationChange),eventjs[c](_,"shake",this._onShake),eventjs[c](_,"longpress",this._onLongPress))},removeListeners:function(){this.addOrRemove(f,"remove");var a=this._getEventPrefix();f(S.document,a+"up",this._onMouseUp),f(S.document,"touchend",this._onTouchEnd,g),f(S.document,a+"move",this._onMouseMove,g),f(S.document,"touchmove",this._onMouseMove,g)},_bindEvents:function(){this.eventsBound||(this._onMouseDown=this._onMouseDown.bind(this),this._onTouchStart=this._onTouchStart.bind(this),this._onMouseMove=this._onMouseMove.bind(this),this._onMouseUp=this._onMouseUp.bind(this),this._onTouchEnd=this._onTouchEnd.bind(this),this._onResize=this._onResize.bind(this),this._onGesture=this._onGesture.bind(this),this._onDrag=this._onDrag.bind(this),this._onShake=this._onShake.bind(this),this._onLongPress=this._onLongPress.bind(this),this._onOrientationChange=this._onOrientationChange.bind(this),this._onMouseWheel=this._onMouseWheel.bind(this),this._onMouseOut=this._onMouseOut.bind(this),this._onMouseEnter=this._onMouseEnter.bind(this),this._onContextMenu=this._onContextMenu.bind(this),this._onDoubleClick=this._onDoubleClick.bind(this),this._onDragOver=this._onDragOver.bind(this),this._onDragEnter=this._simpleEventHandler.bind(this,"dragenter"),this._onDragLeave=this._simpleEventHandler.bind(this,"dragleave"),this._onDrop=this._onDrop.bind(this),this.eventsBound=!0)},_onGesture:function(a,c){this.__onTransformGesture&&this.__onTransformGesture(a,c)},_onDrag:function(a,c){this.__onDrag&&this.__onDrag(a,c)},_onMouseWheel:function(a){this.__onMouseWheel(a)},_onMouseOut:function(a){var c=this._hoveredTarget;this.fire("mouse:out",{target:c,e:a}),this._hoveredTarget=null,c&&c.fire("mouseout",{e:a});var _=this;this._hoveredTargets.forEach(function(I){_.fire("mouse:out",{target:c,e:a}),I&&c.fire("mouseout",{e:a})}),this._hoveredTargets=[],this._iTextInstances&&this._iTextInstances.forEach(function(I){I.isEditing&&I.hiddenTextarea.focus()})},_onMouseEnter:function(a){this._currentTransform||this.findTarget(a)||(this.fire("mouse:over",{target:null,e:a}),this._hoveredTarget=null,this._hoveredTargets=[])},_onOrientationChange:function(a,c){this.__onOrientationChange&&this.__onOrientationChange(a,c)},_onShake:function(a,c){this.__onShake&&this.__onShake(a,c)},_onLongPress:function(a,c){this.__onLongPress&&this.__onLongPress(a,c)},_onDragOver:function(a){a.preventDefault();var c=this._simpleEventHandler("dragover",a);this._fireEnterLeaveEvents(c,a)},_onDrop:function(a){return this._simpleEventHandler("drop:before",a),this._simpleEventHandler("drop",a)},_onContextMenu:function(a){return this.stopContextMenu&&(a.stopPropagation(),a.preventDefault()),!1},_onDoubleClick:function(a){this._cacheTransformEventData(a),this._handleEvent(a,"dblclick"),this._resetTransformEventData(a)},getPointerId:function(a){var c=a.changedTouches;return c?c[0]&&c[0].identifier:this.enablePointerEvents?a.pointerId:-1},_isMainEvent:function(a){return!0===a.isPrimary||!1!==a.isPrimary&&("touchend"===a.type&&0===a.touches.length||!a.changedTouches||a.changedTouches[0].identifier===this.mainTouchId)},_onTouchStart:function(a){a.preventDefault(),null===this.mainTouchId&&(this.mainTouchId=this.getPointerId(a)),this.__onMouseDown(a),this._resetTransformEventData();var c=this.upperCanvasEl,_=this._getEventPrefix();m(S.document,"touchend",this._onTouchEnd,g),m(S.document,"touchmove",this._onMouseMove,g),f(c,_+"down",this._onMouseDown)},_onMouseDown:function(a){this.__onMouseDown(a),this._resetTransformEventData();var c=this.upperCanvasEl,_=this._getEventPrefix();f(c,_+"move",this._onMouseMove,g),m(S.document,_+"up",this._onMouseUp),m(S.document,_+"move",this._onMouseMove,g)},_onTouchEnd:function(a){if(!(a.touches.length>0)){this.__onMouseUp(a),this._resetTransformEventData(),this.mainTouchId=null;var c=this._getEventPrefix();f(S.document,"touchend",this._onTouchEnd,g),f(S.document,"touchmove",this._onMouseMove,g);var _=this;this._willAddMouseDown&&clearTimeout(this._willAddMouseDown),this._willAddMouseDown=setTimeout(function(){m(_.upperCanvasEl,c+"down",_._onMouseDown),_._willAddMouseDown=0},400)}},_onMouseUp:function(a){this.__onMouseUp(a),this._resetTransformEventData();var c=this.upperCanvasEl,_=this._getEventPrefix();this._isMainEvent(a)&&(f(S.document,_+"up",this._onMouseUp),f(S.document,_+"move",this._onMouseMove,g),m(c,_+"move",this._onMouseMove,g))},_onMouseMove:function(a){!this.allowTouchScrolling&&a.preventDefault&&a.preventDefault(),this.__onMouseMove(a)},_onResize:function(){this.calcOffset()},_shouldRender:function(a){var c=this._activeObject;return!!(!!c!=!!a||c&&a&&c!==a)||!1},__onMouseUp:function(a){var c,_=this._currentTransform,I=this._groupSelector,y=!1,w=!I||0===I.left&&0===I.top;if(this._cacheTransformEventData(a),c=this._target,this._handleEvent(a,"up:before"),v(a,3))this.fireRightClick&&this._handleEvent(a,"up",3,w);else{if(v(a,2))return this.fireMiddleClick&&this._handleEvent(a,"up",2,w),void this._resetTransformEventData();if(this.isDrawingMode&&this._isCurrentlyDrawing)this._onMouseUpInDrawingMode(a);else if(this._isMainEvent(a)){if(_&&(this._finalizeCurrentTransform(a),y=_.actionPerformed),!w){var b=c===this._activeObject;this._maybeGroupObjects(a),y||(y=this._shouldRender(c)||!b&&c===this._activeObject)}var x,O;if(c){if(x=c._findTargetCorner(this.getPointer(a,!0),S.util.isTouchEvent(a)),c.selectable&&c!==this._activeObject&&"up"===c.activeOn)this.setActiveObject(c,a),y=!0;else{var F=c.controls[x],L=F&&F.getMouseUpHandler(a,c,F);L&&L(a,_,(O=this.getPointer(a)).x,O.y)}c.isMoving=!1}if(_&&(_.target!==c||_.corner!==x)){var N=_.target&&_.target.controls[_.corner],j=N&&N.getMouseUpHandler(a,c,F);O=O||this.getPointer(a),j&&j(a,_,O.x,O.y)}this._setCursorFromEvent(a,c),this._handleEvent(a,"up",1,w),this._groupSelector=null,this._currentTransform=null,c&&(c.__corner=0),y?this.requestRenderAll():w||this.renderTop()}}},_simpleEventHandler:function(a,c){var _=this.findTarget(c),I=this.targets,y={e:c,target:_,subTargets:I};if(this.fire(a,y),_&&_.fire(a,y),!I)return _;for(var w=0;w<I.length;w++)I[w].fire(a,y);return _},_handleEvent:function(a,c,_,I){var y=this._target,w=this.targets||[],b={e:a,target:y,subTargets:w,button:_||1,isClick:I||!1,pointer:this._pointer,absolutePointer:this._absolutePointer,transform:this._currentTransform};"up"===c&&(b.currentTarget=this.findTarget(a),b.currentSubTargets=this.targets),this.fire("mouse:"+c,b),y&&y.fire("mouse"+c,b);for(var x=0;x<w.length;x++)w[x].fire("mouse"+c,b)},_finalizeCurrentTransform:function(a){var c=this._currentTransform,_=c.target,I={e:a,target:_,transform:c,action:c.action};_._scaling&&(_._scaling=!1),_.setCoords(),(c.actionPerformed||this.stateful&&_.hasStateChanged())&&this._fire("modified",I)},_onMouseDownInDrawingMode:function(a){this._isCurrentlyDrawing=!0,this.getActiveObject()&&this.discardActiveObject(a).requestRenderAll();var c=this.getPointer(a);this.freeDrawingBrush.onMouseDown(c,{e:a,pointer:c}),this._handleEvent(a,"down")},_onMouseMoveInDrawingMode:function(a){if(this._isCurrentlyDrawing){var c=this.getPointer(a);this.freeDrawingBrush.onMouseMove(c,{e:a,pointer:c})}this.setCursor(this.freeDrawingCursor),this._handleEvent(a,"move")},_onMouseUpInDrawingMode:function(a){var c=this.getPointer(a);this._isCurrentlyDrawing=this.freeDrawingBrush.onMouseUp({e:a,pointer:c}),this._handleEvent(a,"up")},__onMouseDown:function(a){this._cacheTransformEventData(a),this._handleEvent(a,"down:before");var c=this._target;if(v(a,3))this.fireRightClick&&this._handleEvent(a,"down",3);else if(v(a,2))this.fireMiddleClick&&this._handleEvent(a,"down",2);else if(this.isDrawingMode)this._onMouseDownInDrawingMode(a);else if(this._isMainEvent(a)&&!this._currentTransform){var _=this._pointer;this._previousPointer=_;var I=this._shouldRender(c),y=this._shouldGroup(a,c);if(this._shouldClearSelection(a,c)?this.discardActiveObject(a):y&&(this._handleGrouping(a,c),c=this._activeObject),!this.selection||c&&(c.selectable||c.isEditing||c===this._activeObject)||(this._groupSelector={ex:this._absolutePointer.x,ey:this._absolutePointer.y,top:0,left:0}),c){var w=c===this._activeObject;c.selectable&&"down"===c.activeOn&&this.setActiveObject(c,a);var b=c._findTargetCorner(this.getPointer(a,!0),S.util.isTouchEvent(a));if(c.__corner=b,c===this._activeObject&&(b||!y)){this._setupCurrentTransform(a,c,w);var x=c.controls[b],O=(_=this.getPointer(a),x&&x.getMouseDownHandler(a,c,x));O&&O(a,this._currentTransform,_.x,_.y)}}this._handleEvent(a,"down"),(I||y)&&this.requestRenderAll()}},_resetTransformEventData:function(){this._target=null,this._pointer=null,this._absolutePointer=null},_cacheTransformEventData:function(a){this._resetTransformEventData(),this._pointer=this.getPointer(a,!0),this._absolutePointer=this.restorePointerVpt(this._pointer),this._target=this._currentTransform?this._currentTransform.target:this.findTarget(a)||null},_beforeTransform:function(a){var c=this._currentTransform;this.stateful&&c.target.saveState(),this.fire("before:transform",{e:a,transform:c})},__onMouseMove:function(a){var c,_;if(this._handleEvent(a,"move:before"),this._cacheTransformEventData(a),this.isDrawingMode)this._onMouseMoveInDrawingMode(a);else if(this._isMainEvent(a)){var I=this._groupSelector;I?(I.left=(_=this._absolutePointer).x-I.ex,I.top=_.y-I.ey,this.renderTop()):this._currentTransform?this._transformObject(a):(c=this.findTarget(a)||null,this._setCursorFromEvent(a,c),this._fireOverOutEvents(c,a)),this._handleEvent(a,"move"),this._resetTransformEventData()}},_fireOverOutEvents:function(a,c){var _=this._hoveredTarget,I=this._hoveredTargets,y=this.targets,w=Math.max(I.length,y.length);this.fireSyntheticInOutEvents(a,c,{oldTarget:_,evtOut:"mouseout",canvasEvtOut:"mouse:out",evtIn:"mouseover",canvasEvtIn:"mouse:over"});for(var b=0;b<w;b++)this.fireSyntheticInOutEvents(y[b],c,{oldTarget:I[b],evtOut:"mouseout",evtIn:"mouseover"});this._hoveredTarget=a,this._hoveredTargets=this.targets.concat()},_fireEnterLeaveEvents:function(a,c){var _=this._draggedoverTarget,I=this._hoveredTargets,y=this.targets,w=Math.max(I.length,y.length);this.fireSyntheticInOutEvents(a,c,{oldTarget:_,evtOut:"dragleave",evtIn:"dragenter"});for(var b=0;b<w;b++)this.fireSyntheticInOutEvents(y[b],c,{oldTarget:I[b],evtOut:"dragleave",evtIn:"dragenter"});this._draggedoverTarget=a},fireSyntheticInOutEvents:function(a,c,_){var I,y,w,b=_.oldTarget,x=b!==a,O=_.canvasEvtIn,F=_.canvasEvtOut;x&&(I={e:c,target:a,previousTarget:b},y={e:c,target:b,nextTarget:a}),w=a&&x,b&&x&&(F&&this.fire(F,y),b.fire(_.evtOut,y)),w&&(O&&this.fire(O,I),a.fire(_.evtIn,I))},__onMouseWheel:function(a){this._cacheTransformEventData(a),this._handleEvent(a,"wheel"),this._resetTransformEventData()},_transformObject:function(a){var c=this.getPointer(a),_=this._currentTransform;_.reset=!1,_.shiftKey=a.shiftKey,_.altKey=a[this.centeredKey],this._performTransformAction(a,_,c),_.actionPerformed&&this.requestRenderAll()},_performTransformAction:function(a,c,_){var w=c.action,b=!1,x=c.actionHandler;x&&(b=x(a,c,_.x,_.y)),"drag"===w&&b&&(c.target.isMoving=!0,this.setCursor(c.target.moveCursor||this.moveCursor)),c.actionPerformed=c.actionPerformed||b},_fire:S.controlsUtils.fireEvent,_setCursorFromEvent:function(a,c){if(!c)return this.setCursor(this.defaultCursor),!1;var _=c.hoverCursor||this.hoverCursor,I=this._activeObject&&"activeSelection"===this._activeObject.type?this._activeObject:null,y=(!I||!I.contains(c))&&c._findTargetCorner(this.getPointer(a,!0));y?this.setCursor(this.getCornerCursor(y,c,a)):(c.subTargetCheck&&this.targets.concat().reverse().map(function(w){_=w.hoverCursor||_}),this.setCursor(_))},getCornerCursor:function(a,c,_){var I=c.controls[a];return I.cursorStyleHandler(_,I,c)}})}(),V=Math.min,q=Math.max,S.util.object.extend(S.Canvas.prototype,{_shouldGroup:function(m,f){var g=this._activeObject;return g&&this._isSelectionKeyPressed(m)&&f&&f.selectable&&this.selection&&(g!==f||"activeSelection"===g.type)&&!f.onSelect({e:m})},_handleGrouping:function(m,f){var g=this._activeObject;g.__corner||(f!==g||(f=this.findTarget(m,!0))&&f.selectable)&&(g&&"activeSelection"===g.type?this._updateActiveSelection(f,m):this._createActiveSelection(f,m))},_updateActiveSelection:function(m,f){var g=this._activeObject,v=g._objects.slice(0);g.contains(m)?(g.removeWithUpdate(m),this._hoveredTarget=m,this._hoveredTargets=this.targets.concat(),1===g.size()&&this._setActiveObject(g.item(0),f)):(g.addWithUpdate(m),this._hoveredTarget=g,this._hoveredTargets=this.targets.concat()),this._fireSelectionEvents(v,f)},_createActiveSelection:function(m,f){var g=this.getActiveObjects(),v=this._createGroup(m);this._hoveredTarget=v,this._setActiveObject(v,f),this._fireSelectionEvents(g,f)},_createGroup:function(m){var f=this._objects,g=f.indexOf(this._activeObject)<f.indexOf(m)?[this._activeObject,m]:[m,this._activeObject];return this._activeObject.isEditing&&this._activeObject.exitEditing(),new S.ActiveSelection(g,{canvas:this})},_groupSelectedObjects:function(m){var f,g=this._collectObjects(m);1===g.length?this.setActiveObject(g[0],m):g.length>1&&(f=new S.ActiveSelection(g.reverse(),{canvas:this}),this.setActiveObject(f,m))},_collectObjects:function(m){for(var f,g=[],v=this._groupSelector.ex,a=this._groupSelector.ey,c=v+this._groupSelector.left,_=a+this._groupSelector.top,I=new S.Point(V(v,c),V(a,_)),y=new S.Point(q(v,c),q(a,_)),w=!this.selectionFullyContained,b=v===c&&a===_,x=this._objects.length;x--&&!((f=this._objects[x])&&f.selectable&&f.visible&&(w&&f.intersectsWithRect(I,y,!0)||f.isContainedWithinRect(I,y,!0)||w&&f.containsPoint(I,null,!0)||w&&f.containsPoint(y,null,!0))&&(g.push(f),b)););return g.length>1&&(g=g.filter(function(O){return!O.onSelect({e:m})})),g},_maybeGroupObjects:function(m){this.selection&&this._groupSelector&&this._groupSelectedObjects(m),this.setCursor(this.defaultCursor),this._groupSelector=null}}),S.util.object.extend(S.StaticCanvas.prototype,{toDataURL:function(m){m||(m={});var f=m.format||"png",g=m.quality||1,v=(m.multiplier||1)*(m.enableRetinaScaling?this.getRetinaScaling():1),a=this.toCanvasElement(v,m);return S.util.toDataURL(a,f,g)},toCanvasElement:function(m,f){var g=((f=f||{}).width||this.width)*(m=m||1),v=(f.height||this.height)*m,a=this.getZoom(),c=this.width,_=this.height,I=a*m,y=this.viewportTransform,x=this.interactive,O=[I,0,0,I,(y[4]-(f.left||0))*m,(y[5]-(f.top||0))*m],F=this.enableRetinaScaling,L=S.util.createCanvasElement(),N=this.contextTop;return L.width=g,L.height=v,this.contextTop=null,this.enableRetinaScaling=!1,this.interactive=!1,this.viewportTransform=O,this.width=g,this.height=v,this.calcViewportBoundaries(),this.renderCanvas(L.getContext("2d"),this._objects),this.viewportTransform=y,this.width=c,this.height=_,this.calcViewportBoundaries(),this.interactive=x,this.enableRetinaScaling=F,this.contextTop=N,L}}),S.util.object.extend(S.StaticCanvas.prototype,{loadFromJSON:function(m,f,g){if(m){var v="string"==typeof m?JSON.parse(m):S.util.object.clone(m),a=this,c=v.clipPath,_=this.renderOnAddRemove;return this.renderOnAddRemove=!1,delete v.clipPath,this._enlivenObjects(v.objects,function(I){a.clear(),a._setBgOverlay(v,function(){c?a._enlivenObjects([c],function(y){a.clipPath=y[0],a.__setupCanvas.call(a,v,I,_,f)}):a.__setupCanvas.call(a,v,I,_,f)})},g),this}},__setupCanvas:function(m,f,g,v){var a=this;f.forEach(function(c,_){a.insertAt(c,_)}),this.renderOnAddRemove=g,delete m.objects,delete m.backgroundImage,delete m.overlayImage,delete m.background,delete m.overlay,this._setOptions(m),this.renderAll(),v&&v()},_setBgOverlay:function(m,f){var g={backgroundColor:!1,overlayColor:!1,backgroundImage:!1,overlayImage:!1};if(m.backgroundImage||m.overlayImage||m.background||m.overlay){var v=function(){g.backgroundImage&&g.overlayImage&&g.backgroundColor&&g.overlayColor&&f&&f()};this.__setBgOverlay("backgroundImage",m.backgroundImage,g,v),this.__setBgOverlay("overlayImage",m.overlayImage,g,v),this.__setBgOverlay("backgroundColor",m.background,g,v),this.__setBgOverlay("overlayColor",m.overlay,g,v)}else f&&f()},__setBgOverlay:function(m,f,g,v){var a=this;if(!f)return g[m]=!0,void(v&&v());"backgroundImage"===m||"overlayImage"===m?S.util.enlivenObjects([f],function(c){a[m]=c[0],g[m]=!0,v&&v()}):this["set"+S.util.string.capitalize(m,!0)](f,function(){g[m]=!0,v&&v()})},_enlivenObjects:function(m,f,g){m&&0!==m.length?S.util.enlivenObjects(m,function(v){f&&f(v)},null,g):f&&f([])},_toDataURL:function(m,f){this.clone(function(g){f(g.toDataURL(m))})},_toDataURLWithMultiplier:function(m,f,g){this.clone(function(v){g(v.toDataURLWithMultiplier(m,f))})},clone:function(m,f){var g=JSON.stringify(this.toJSON(f));this.cloneWithoutData(function(v){v.loadFromJSON(g,function(){m&&m(v)})})},cloneWithoutData:function(m){var f=S.util.createCanvasElement();f.width=this.width,f.height=this.height;var g=new S.Canvas(f);this.backgroundImage?(g.setBackgroundImage(this.backgroundImage.src,function(){g.renderAll(),m&&m(g)}),g.backgroundImageOpacity=this.backgroundImageOpacity,g.backgroundImageStretch=this.backgroundImageStretch):m&&m(g)}}),function(m){var f=m.fabric||(m.fabric={}),g=f.util.object.extend,v=f.util.object.clone,a=f.util.toFixed,c=f.util.string.capitalize,_=f.util.degreesToRadians;f.Object||(f.Object=f.util.createClass(f.CommonMethods,{type:"object",originX:"left",originY:"top",top:0,left:0,width:0,height:0,scaleX:1,scaleY:1,flipX:!1,flipY:!1,opacity:1,angle:0,skewX:0,skewY:0,cornerSize:13,touchCornerSize:24,transparentCorners:!0,hoverCursor:null,moveCursor:null,padding:0,borderColor:"rgb(178,204,255)",borderDashArray:null,cornerColor:"rgb(178,204,255)",cornerStrokeColor:null,cornerStyle:"rect",cornerDashArray:null,centeredScaling:!1,centeredRotation:!0,fill:"rgb(0,0,0)",fillRule:"nonzero",globalCompositeOperation:"source-over",backgroundColor:"",selectionBackgroundColor:"",stroke:null,strokeWidth:1,strokeDashArray:null,strokeDashOffset:0,strokeLineCap:"butt",strokeLineJoin:"miter",strokeMiterLimit:4,shadow:null,borderOpacityWhenMoving:.4,borderScaleFactor:1,minScaleLimit:0,selectable:!0,evented:!0,visible:!0,hasControls:!0,hasBorders:!0,perPixelTargetFind:!1,includeDefaultValues:!0,lockMovementX:!1,lockMovementY:!1,lockRotation:!1,lockScalingX:!1,lockScalingY:!1,lockSkewingX:!1,lockSkewingY:!1,lockScalingFlip:!1,excludeFromExport:!1,objectCaching:!f.isLikelyNode,statefullCache:!1,noScaleCache:!0,strokeUniform:!1,dirty:!0,__corner:0,paintFirst:"fill",activeOn:"down",stateProperties:"top left width height scaleX scaleY flipX flipY originX originY transformMatrix stroke strokeWidth strokeDashArray strokeLineCap strokeDashOffset strokeLineJoin strokeMiterLimit angle opacity fill globalCompositeOperation shadow visible backgroundColor skewX skewY fillRule paintFirst clipPath strokeUniform".split(" "),cacheProperties:"fill stroke strokeWidth strokeDashArray width height paintFirst strokeUniform strokeLineCap strokeDashOffset strokeLineJoin strokeMiterLimit backgroundColor clipPath".split(" "),colorProperties:"fill stroke backgroundColor".split(" "),clipPath:void 0,inverted:!1,absolutePositioned:!1,initialize:function(y){y&&this.setOptions(y)},_createCacheCanvas:function(){this._cacheProperties={},this._cacheCanvas=f.util.createCanvasElement(),this._cacheContext=this._cacheCanvas.getContext("2d"),this._updateCacheCanvas(),this.dirty=!0},_limitCacheSize:function(y){var w=f.perfLimitSizeTotal,b=y.width,x=y.height,O=f.maxCacheSideLimit,F=f.minCacheSideLimit;if(b<=O&&x<=O&&b*x<=w)return b<F&&(y.width=F),x<F&&(y.height=F),y;var N=f.util.limitDimsByArea(b/x,w),j=f.util.capValue,$=j(F,N.x,O),X=j(F,N.y,O);return b>$&&(y.zoomX/=b/$,y.width=$,y.capped=!0),x>X&&(y.zoomY/=x/X,y.height=X,y.capped=!0),y},_getCacheCanvasDimensions:function(){var y=this.getTotalObjectScaling(),w=this._getTransformedDimensions(0,0),b=w.x*y.scaleX/this.scaleX,x=w.y*y.scaleY/this.scaleY;return{width:b+2,height:x+2,zoomX:y.scaleX,zoomY:y.scaleY,x:b,y:x}},_updateCacheCanvas:function(){var y=this.canvas;if(this.noScaleCache&&y&&y._currentTransform){var b=y._currentTransform.action;if(this===y._currentTransform.target&&b.slice&&"scale"===b.slice(0,5))return!1}var x,O,F=this._cacheCanvas,L=this._limitCacheSize(this._getCacheCanvasDimensions()),N=f.minCacheSideLimit,j=L.width,$=L.height,X=L.zoomX,ie=L.zoomY,ee=j!==this.cacheWidth||$!==this.cacheHeight,W=ee||this.zoomX!==X||this.zoomY!==ie,H=0,Z=0,ne=!1;if(ee){var re=this._cacheCanvas.width,z=this._cacheCanvas.height,Y=j>re||$>z;ne=Y||(j<.9*re||$<.9*z)&&re>N&&z>N,Y&&!L.capped&&(j>N||$>N)&&(H=.1*j,Z=.1*$)}return this instanceof f.Text&&this.path&&(W=!0,ne=!0,H+=this.getHeightOfLine(0)*this.zoomX,Z+=this.getHeightOfLine(0)*this.zoomY),!!W&&(ne?(F.width=Math.ceil(j+H),F.height=Math.ceil($+Z)):(this._cacheContext.setTransform(1,0,0,1,0,0),this._cacheContext.clearRect(0,0,F.width,F.height)),x=L.x/2,O=L.y/2,this.cacheTranslationX=Math.round(F.width/2-x)+x,this.cacheTranslationY=Math.round(F.height/2-O)+O,this.cacheWidth=j,this.cacheHeight=$,this._cacheContext.translate(this.cacheTranslationX,this.cacheTranslationY),this._cacheContext.scale(X,ie),this.zoomX=X,this.zoomY=ie,!0)},setOptions:function(y){this._setOptions(y),this._initGradient(y.fill,"fill"),this._initGradient(y.stroke,"stroke"),this._initPattern(y.fill,"fill"),this._initPattern(y.stroke,"stroke")},transform:function(y){var b=this.calcTransformMatrix(!(this.group&&!this.group._transformDone||this.group&&this.canvas&&y===this.canvas.contextTop));y.transform(b[0],b[1],b[2],b[3],b[4],b[5])},toObject:function(y){var w=f.Object.NUM_FRACTION_DIGITS,b={type:this.type,version:f.version,originX:this.originX,originY:this.originY,left:a(this.left,w),top:a(this.top,w),width:a(this.width,w),height:a(this.height,w),fill:this.fill&&this.fill.toObject?this.fill.toObject():this.fill,stroke:this.stroke&&this.stroke.toObject?this.stroke.toObject():this.stroke,strokeWidth:a(this.strokeWidth,w),strokeDashArray:this.strokeDashArray?this.strokeDashArray.concat():this.strokeDashArray,strokeLineCap:this.strokeLineCap,strokeDashOffset:this.strokeDashOffset,strokeLineJoin:this.strokeLineJoin,strokeUniform:this.strokeUniform,strokeMiterLimit:a(this.strokeMiterLimit,w),scaleX:a(this.scaleX,w),scaleY:a(this.scaleY,w),angle:a(this.angle,w),flipX:this.flipX,flipY:this.flipY,opacity:a(this.opacity,w),shadow:this.shadow&&this.shadow.toObject?this.shadow.toObject():this.shadow,visible:this.visible,backgroundColor:this.backgroundColor,fillRule:this.fillRule,paintFirst:this.paintFirst,globalCompositeOperation:this.globalCompositeOperation,skewX:a(this.skewX,w),skewY:a(this.skewY,w)};return this.clipPath&&!this.clipPath.excludeFromExport&&(b.clipPath=this.clipPath.toObject(y),b.clipPath.inverted=this.clipPath.inverted,b.clipPath.absolutePositioned=this.clipPath.absolutePositioned),f.util.populateWithProperties(this,b,y),this.includeDefaultValues||(b=this._removeDefaultValues(b)),b},toDatalessObject:function(y){return this.toObject(y)},_removeDefaultValues:function(y){var w=f.util.getKlass(y.type).prototype;return w.stateProperties.forEach(function(b){"left"!==b&&"top"!==b&&(y[b]===w[b]&&delete y[b],Array.isArray(y[b])&&Array.isArray(w[b])&&0===y[b].length&&0===w[b].length&&delete y[b])}),y},toString:function(){return"#<fabric."+c(this.type)+">"},getObjectScaling:function(){if(!this.group)return{scaleX:this.scaleX,scaleY:this.scaleY};var y=f.util.qrDecompose(this.calcTransformMatrix());return{scaleX:Math.abs(y.scaleX),scaleY:Math.abs(y.scaleY)}},getTotalObjectScaling:function(){var y=this.getObjectScaling(),w=y.scaleX,b=y.scaleY;if(this.canvas){var x=this.canvas.getZoom(),O=this.canvas.getRetinaScaling();w*=x*O,b*=x*O}return{scaleX:w,scaleY:b}},getObjectOpacity:function(){var y=this.opacity;return this.group&&(y*=this.group.getObjectOpacity()),y},_set:function(y,w){var x=this[y]!==w,O=!1;return("scaleX"===y||"scaleY"===y)&&(w=this._constrainScale(w)),"scaleX"===y&&w<0?(this.flipX=!this.flipX,w*=-1):"scaleY"===y&&w<0?(this.flipY=!this.flipY,w*=-1):"shadow"!==y||!w||w instanceof f.Shadow?"dirty"===y&&this.group&&this.group.set("dirty",w):w=new f.Shadow(w),this[y]=w,x&&(O=this.group&&this.group.isOnACache(),this.cacheProperties.indexOf(y)>-1?(this.dirty=!0,O&&this.group.set("dirty",!0)):O&&this.stateProperties.indexOf(y)>-1&&this.group.set("dirty",!0)),this},setOnGroup:function(){},getViewportTransform:function(){return this.canvas&&this.canvas.viewportTransform?this.canvas.viewportTransform:f.iMatrix.concat()},isNotVisible:function(){return 0===this.opacity||!this.width&&!this.height&&0===this.strokeWidth||!this.visible},render:function(y){this.isNotVisible()||this.canvas&&this.canvas.skipOffscreen&&!this.group&&!this.isOnScreen()||(y.save(),this._setupCompositeOperation(y),this.drawSelectionBackground(y),this.transform(y),this._setOpacity(y),this._setShadow(y,this),this.shouldCache()?(this.renderCache(),this.drawCacheOnCanvas(y)):(this._removeCacheCanvas(),this.dirty=!1,this.drawObject(y),this.objectCaching&&this.statefullCache&&this.saveState({propertySet:"cacheProperties"})),y.restore())},renderCache:function(y){y=y||{},this._cacheCanvas&&this._cacheContext||this._createCacheCanvas(),this.isCacheDirty()&&(this.statefullCache&&this.saveState({propertySet:"cacheProperties"}),this.drawObject(this._cacheContext,y.forClipping),this.dirty=!1)},_removeCacheCanvas:function(){this._cacheCanvas=null,this._cacheContext=null,this.cacheWidth=0,this.cacheHeight=0},hasStroke:function(){return this.stroke&&"transparent"!==this.stroke&&0!==this.strokeWidth},hasFill:function(){return this.fill&&"transparent"!==this.fill},needsItsOwnCache:function(){return!("stroke"!==this.paintFirst||!this.hasFill()||!this.hasStroke()||"object"!=typeof this.shadow)||!!this.clipPath},shouldCache:function(){return this.ownCaching=this.needsItsOwnCache()||this.objectCaching&&(!this.group||!this.group.isOnACache()),this.ownCaching},willDrawShadow:function(){return!!this.shadow&&(0!==this.shadow.offsetX||0!==this.shadow.offsetY)},drawClipPathOnCache:function(y,w){if(y.save(),y.globalCompositeOperation=w.inverted?"destination-out":"destination-in",w.absolutePositioned){var b=f.util.invertTransform(this.calcTransformMatrix());y.transform(b[0],b[1],b[2],b[3],b[4],b[5])}w.transform(y),y.scale(1/w.zoomX,1/w.zoomY),y.drawImage(w._cacheCanvas,-w.cacheTranslationX,-w.cacheTranslationY),y.restore()},drawObject:function(y,w){var b=this.fill,x=this.stroke;w?(this.fill="black",this.stroke="",this._setClippingProperties(y)):this._renderBackground(y),this._render(y),this._drawClipPath(y,this.clipPath),this.fill=b,this.stroke=x},_drawClipPath:function(y,w){w&&(w.canvas=this.canvas,w.shouldCache(),w._transformDone=!0,w.renderCache({forClipping:!0}),this.drawClipPathOnCache(y,w))},drawCacheOnCanvas:function(y){y.scale(1/this.zoomX,1/this.zoomY),y.drawImage(this._cacheCanvas,-this.cacheTranslationX,-this.cacheTranslationY)},isCacheDirty:function(y){if(this.isNotVisible())return!1;if(this._cacheCanvas&&this._cacheContext&&!y&&this._updateCacheCanvas())return!0;if(this.dirty||this.clipPath&&this.clipPath.absolutePositioned||this.statefullCache&&this.hasStateChanged("cacheProperties")){if(this._cacheCanvas&&this._cacheContext&&!y){var w=this.cacheWidth/this.zoomX,b=this.cacheHeight/this.zoomY;this._cacheContext.clearRect(-w/2,-b/2,w,b)}return!0}return!1},_renderBackground:function(y){if(this.backgroundColor){var w=this._getNonTransformedDimensions();y.fillStyle=this.backgroundColor,y.fillRect(-w.x/2,-w.y/2,w.x,w.y),this._removeShadow(y)}},_setOpacity:function(y){this.group&&!this.group._transformDone?y.globalAlpha=this.getObjectOpacity():y.globalAlpha*=this.opacity},_setStrokeStyles:function(y,w){var b=w.stroke;b&&(y.lineWidth=w.strokeWidth,y.lineCap=w.strokeLineCap,y.lineDashOffset=w.strokeDashOffset,y.lineJoin=w.strokeLineJoin,y.miterLimit=w.strokeMiterLimit,b.toLive?"percentage"===b.gradientUnits||b.gradientTransform||b.patternTransform?this._applyPatternForTransformedGradient(y,b):(y.strokeStyle=b.toLive(y,this),this._applyPatternGradientTransform(y,b)):y.strokeStyle=w.stroke)},_setFillStyles:function(y,w){var b=w.fill;b&&(b.toLive?(y.fillStyle=b.toLive(y,this),this._applyPatternGradientTransform(y,w.fill)):y.fillStyle=b)},_setClippingProperties:function(y){y.globalAlpha=1,y.strokeStyle="transparent",y.fillStyle="#000000"},_setLineDash:function(y,w){w&&0!==w.length&&(1&w.length&&w.push.apply(w,w),y.setLineDash(w))},_renderControls:function(y,w){var b,x,O,F=this.getViewportTransform(),L=this.calcTransformMatrix();x=void 0!==(w=w||{}).hasBorders?w.hasBorders:this.hasBorders,O=void 0!==w.hasControls?w.hasControls:this.hasControls,L=f.util.multiplyTransformMatrices(F,L),b=f.util.qrDecompose(L),y.save(),y.translate(b.translateX,b.translateY),y.lineWidth=1*this.borderScaleFactor,this.group||(y.globalAlpha=this.isMoving?this.borderOpacityWhenMoving:1),this.flipX&&(b.angle-=180),y.rotate(_(this.group?b.angle:this.angle)),w.forActiveSelection||this.group?x&&this.drawBordersInGroup(y,b,w):x&&this.drawBorders(y,w),O&&this.drawControls(y,w),y.restore()},_setShadow:function(y){if(this.shadow){var w,b=this.shadow,x=this.canvas,O=x&&x.viewportTransform[0]||1,F=x&&x.viewportTransform[3]||1;w=b.nonScaling?{scaleX:1,scaleY:1}:this.getObjectScaling(),x&&x._isRetinaScaling()&&(O*=f.devicePixelRatio,F*=f.devicePixelRatio),y.shadowColor=b.color,y.shadowBlur=b.blur*f.browserShadowBlurConstant*(O+F)*(w.scaleX+w.scaleY)/4,y.shadowOffsetX=b.offsetX*O*w.scaleX,y.shadowOffsetY=b.offsetY*F*w.scaleY}},_removeShadow:function(y){this.shadow&&(y.shadowColor="",y.shadowBlur=y.shadowOffsetX=y.shadowOffsetY=0)},_applyPatternGradientTransform:function(y,w){if(!w||!w.toLive)return{offsetX:0,offsetY:0};var b=w.gradientTransform||w.patternTransform,x=-this.width/2+w.offsetX||0,O=-this.height/2+w.offsetY||0;return"percentage"===w.gradientUnits?y.transform(this.width,0,0,this.height,x,O):y.transform(1,0,0,1,x,O),b&&y.transform(b[0],b[1],b[2],b[3],b[4],b[5]),{offsetX:x,offsetY:O}},_renderPaintInOrder:function(y){"stroke"===this.paintFirst?(this._renderStroke(y),this._renderFill(y)):(this._renderFill(y),this._renderStroke(y))},_render:function(){},_renderFill:function(y){this.fill&&(y.save(),this._setFillStyles(y,this),"evenodd"===this.fillRule?y.fill("evenodd"):y.fill(),y.restore())},_renderStroke:function(y){if(this.stroke&&0!==this.strokeWidth){if(this.shadow&&!this.shadow.affectStroke&&this._removeShadow(y),y.save(),this.strokeUniform&&this.group){var w=this.getObjectScaling();y.scale(1/w.scaleX,1/w.scaleY)}else this.strokeUniform&&y.scale(1/this.scaleX,1/this.scaleY);this._setLineDash(y,this.strokeDashArray),this._setStrokeStyles(y,this),y.stroke(),y.restore()}},_applyPatternForTransformedGradient:function(y,w){var b,x=this._limitCacheSize(this._getCacheCanvasDimensions()),O=f.util.createCanvasElement(),F=this.canvas.getRetinaScaling(),L=x.x/this.scaleX/F,N=x.y/this.scaleY/F;O.width=L,O.height=N,(b=O.getContext("2d")).beginPath(),b.moveTo(0,0),b.lineTo(L,0),b.lineTo(L,N),b.lineTo(0,N),b.closePath(),b.translate(L/2,N/2),b.scale(x.zoomX/this.scaleX/F,x.zoomY/this.scaleY/F),this._applyPatternGradientTransform(b,w),b.fillStyle=w.toLive(y),b.fill(),y.translate(-this.width/2-this.strokeWidth/2,-this.height/2-this.strokeWidth/2),y.scale(F*this.scaleX/x.zoomX,F*this.scaleY/x.zoomY),y.strokeStyle=b.createPattern(O,"no-repeat")},_findCenterFromElement:function(){return{x:this.left+this.width/2,y:this.top+this.height/2}},_assignTransformMatrixProps:function(){if(this.transformMatrix){var y=f.util.qrDecompose(this.transformMatrix);this.flipX=!1,this.flipY=!1,this.set("scaleX",y.scaleX),this.set("scaleY",y.scaleY),this.angle=y.angle,this.skewX=y.skewX,this.skewY=0}},_removeTransformMatrix:function(y){var w=this._findCenterFromElement();this.transformMatrix&&(this._assignTransformMatrixProps(),w=f.util.transformPoint(w,this.transformMatrix)),this.transformMatrix=null,y&&(this.scaleX*=y.scaleX,this.scaleY*=y.scaleY,this.cropX=y.cropX,this.cropY=y.cropY,w.x+=y.offsetLeft,w.y+=y.offsetTop,this.width=y.width,this.height=y.height),this.setPositionByOrigin(w,"center","center")},clone:function(y,w){var b=this.toObject(w);this.constructor.fromObject?this.constructor.fromObject(b,y):f.Object._fromObject("Object",b,y)},cloneAsImage:function(y,w){var b=this.toCanvasElement(w);return y&&y(new f.Image(b)),this},toCanvasElement:function(y){y||(y={});var w=f.util,b=w.saveObjectTransform(this),x=this.group,O=this.shadow,F=Math.abs,L=(y.multiplier||1)*(y.enableRetinaScaling?f.devicePixelRatio:1);delete this.group,y.withoutTransform&&w.resetObjectTransform(this),y.withoutShadow&&(this.shadow=null);var N,j,X,ie=f.util.createCanvasElement(),ee=this.getBoundingRect(!0,!0),Q=this.shadow,W={x:0,y:0};Q&&(j=Q.blur,N=Q.nonScaling?{scaleX:1,scaleY:1}:this.getObjectScaling(),W.x=2*Math.round(F(Q.offsetX)+j)*F(N.scaleX),W.y=2*Math.round(F(Q.offsetY)+j)*F(N.scaleY)),X=ee.height+W.y,ie.width=Math.ceil(ee.width+W.x),ie.height=Math.ceil(X);var H=new f.StaticCanvas(ie,{enableRetinaScaling:!1,renderOnAddRemove:!1,skipOffscreen:!1});"jpeg"===y.format&&(H.backgroundColor="#fff"),this.setPositionByOrigin(new f.Point(H.width/2,H.height/2),"center","center");var Z=this.canvas;H.add(this);var ne=H.toCanvasElement(L||1,y);return this.shadow=O,this.set("canvas",Z),x&&(this.group=x),this.set(b).setCoords(),H._objects=[],H.dispose(),H=null,ne},toDataURL:function(y){return y||(y={}),f.util.toDataURL(this.toCanvasElement(y),y.format||"png",y.quality||1)},isType:function(y){return arguments.length>1?Array.from(arguments).includes(this.type):this.type===y},complexity:function(){return 1},toJSON:function(y){return this.toObject(y)},rotate:function(y){var w=("center"!==this.originX||"center"!==this.originY)&&this.centeredRotation;return w&&this._setOriginToCenter(),this.set("angle",y),w&&this._resetOrigin(),this},centerH:function(){return this.canvas&&this.canvas.centerObjectH(this),this},viewportCenterH:function(){return this.canvas&&this.canvas.viewportCenterObjectH(this),this},centerV:function(){return this.canvas&&this.canvas.centerObjectV(this),this},viewportCenterV:function(){return this.canvas&&this.canvas.viewportCenterObjectV(this),this},center:function(){return this.canvas&&this.canvas.centerObject(this),this},viewportCenter:function(){return this.canvas&&this.canvas.viewportCenterObject(this),this},getLocalPointer:function(y,w){w=w||this.canvas.getPointer(y);var b=new f.Point(w.x,w.y),x=this._getLeftTopCoords();return this.angle&&(b=f.util.rotatePoint(b,x,_(-this.angle))),{x:b.x-x.x,y:b.y-x.y}},_setupCompositeOperation:function(y){this.globalCompositeOperation&&(y.globalCompositeOperation=this.globalCompositeOperation)},dispose:function(){f.runningAnimations&&f.runningAnimations.cancelByTarget(this)}}),f.util.createAccessors&&f.util.createAccessors(f.Object),g(f.Object.prototype,f.Observable),f.Object.NUM_FRACTION_DIGITS=2,f.Object.ENLIVEN_PROPS=["clipPath"],f.Object._fromObject=function(y,w,b,x){var O=f[y];w=v(w,!0),f.util.enlivenPatterns([w.fill,w.stroke],function(F){void 0!==F[0]&&(w.fill=F[0]),void 0!==F[1]&&(w.stroke=F[1]),f.util.enlivenObjectEnlivables(w,w,function(){var L=x?new O(w[x],w):new O(w);b&&b(L)})})},f.Object.__uid=0)}(n),ce=S.util.degreesToRadians,ge={left:-.5,center:0,right:.5},ve={top:-.5,center:0,bottom:.5},S.util.object.extend(S.Object.prototype,{translateToGivenOrigin:function(m,f,g,v,a){var c,_,I,y=m.x,w=m.y;return"string"==typeof f?f=ge[f]:f-=.5,"string"==typeof v?v=ge[v]:v-=.5,"string"==typeof g?g=ve[g]:g-=.5,"string"==typeof a?a=ve[a]:a-=.5,_=a-g,((c=v-f)||_)&&(I=this._getTransformedDimensions(),y=m.x+c*I.x,w=m.y+_*I.y),new S.Point(y,w)},translateToCenterPoint:function(m,f,g){var v=this.translateToGivenOrigin(m,f,g,"center","center");return this.angle?S.util.rotatePoint(v,m,ce(this.angle)):v},translateToOriginPoint:function(m,f,g){var v=this.translateToGivenOrigin(m,"center","center",f,g);return this.angle?S.util.rotatePoint(v,m,ce(this.angle)):v},getCenterPoint:function(){var m=new S.Point(this.left,this.top);return this.translateToCenterPoint(m,this.originX,this.originY)},getPointByOrigin:function(m,f){var g=this.getCenterPoint();return this.translateToOriginPoint(g,m,f)},toLocalPoint:function(m,f,g){var v,a,c=this.getCenterPoint();return v=void 0!==f&&void 0!==g?this.translateToGivenOrigin(c,"center","center",f,g):new S.Point(this.left,this.top),a=new S.Point(m.x,m.y),this.angle&&(a=S.util.rotatePoint(a,c,-ce(this.angle))),a.subtractEquals(v)},setPositionByOrigin:function(m,f,g){var v=this.translateToCenterPoint(m,f,g),a=this.translateToOriginPoint(v,this.originX,this.originY);this.set("left",a.x),this.set("top",a.y)},adjustPosition:function(m){var f,g,v=ce(this.angle),a=this.getScaledWidth(),c=S.util.cos(v)*a,_=S.util.sin(v)*a;this.left+=c*((g="string"==typeof m?ge[m]:m-.5)-(f="string"==typeof this.originX?ge[this.originX]:this.originX-.5)),this.top+=_*(g-f),this.setCoords(),this.originX=m},_setOriginToCenter:function(){this._originalOriginX=this.originX,this._originalOriginY=this.originY;var m=this.getCenterPoint();this.originX="center",this.originY="center",this.left=m.x,this.top=m.y},_resetOrigin:function(){var m=this.translateToOriginPoint(this.getCenterPoint(),this._originalOriginX,this._originalOriginY);this.originX=this._originalOriginX,this.originY=this._originalOriginY,this.left=m.x,this.top=m.y,this._originalOriginX=null,this._originalOriginY=null},_getLeftTopCoords:function(){return this.translateToOriginPoint(this.getCenterPoint(),"left","top")}}),function(){var m=S.util,f=m.degreesToRadians,g=m.multiplyTransformMatrices,v=m.transformPoint;m.object.extend(S.Object.prototype,{oCoords:null,aCoords:null,lineCoords:null,ownMatrixCache:null,matrixCache:null,controls:{},_getCoords:function(a,c){return c?a?this.calcACoords():this.calcLineCoords():(this.aCoords&&this.lineCoords||this.setCoords(!0),a?this.aCoords:this.lineCoords)},getCoords:function(a,c){return _=this._getCoords(a,c),[new S.Point(_.tl.x,_.tl.y),new S.Point(_.tr.x,_.tr.y),new S.Point(_.br.x,_.br.y),new S.Point(_.bl.x,_.bl.y)];var _},intersectsWithRect:function(a,c,_,I){var y=this.getCoords(_,I);return"Intersection"===S.Intersection.intersectPolygonRectangle(y,a,c).status},intersectsWithObject:function(a,c,_){return"Intersection"===S.Intersection.intersectPolygonPolygon(this.getCoords(c,_),a.getCoords(c,_)).status||a.isContainedWithinObject(this,c,_)||this.isContainedWithinObject(a,c,_)},isContainedWithinObject:function(a,c,_){for(var I=this.getCoords(c,_),w=0,b=a._getImageLines(c?a.aCoords:a.lineCoords);w<4;w++)if(!a.containsPoint(I[w],b))return!1;return!0},isContainedWithinRect:function(a,c,_,I){var y=this.getBoundingRect(_,I);return y.left>=a.x&&y.left+y.width<=c.x&&y.top>=a.y&&y.top+y.height<=c.y},containsPoint:function(a,c,_,I){var y=this._getCoords(_,I),w=(c=c||this._getImageLines(y),this._findCrossPoints(a,c));return 0!==w&&w%2==1},isOnScreen:function(a){if(!this.canvas)return!1;var c=this.canvas.vptCoords.tl,_=this.canvas.vptCoords.br;return!!this.getCoords(!0,a).some(function(I){return I.x<=_.x&&I.x>=c.x&&I.y<=_.y&&I.y>=c.y})||!!this.intersectsWithRect(c,_,!0,a)||this._containsCenterOfCanvas(c,_,a)},_containsCenterOfCanvas:function(a,c,_){return!!this.containsPoint({x:(a.x+c.x)/2,y:(a.y+c.y)/2},null,!0,_)},isPartiallyOnScreen:function(a){if(!this.canvas)return!1;var c=this.canvas.vptCoords.tl,_=this.canvas.vptCoords.br;return!!this.intersectsWithRect(c,_,!0,a)||this.getCoords(!0,a).every(function(I){return(I.x>=_.x||I.x<=c.x)&&(I.y>=_.y||I.y<=c.y)})&&this._containsCenterOfCanvas(c,_,a)},_getImageLines:function(a){return{topline:{o:a.tl,d:a.tr},rightline:{o:a.tr,d:a.br},bottomline:{o:a.br,d:a.bl},leftline:{o:a.bl,d:a.tl}}},_findCrossPoints:function(a,c){var _,I,y,w=0;for(var b in c)if(!((y=c[b]).o.y<a.y&&y.d.y<a.y||y.o.y>=a.y&&y.d.y>=a.y||(y.o.x===y.d.x&&y.o.x>=a.x?I=y.o.x:(_=(y.d.y-y.o.y)/(y.d.x-y.o.x),I=-(a.y-0*a.x-(y.o.y-_*y.o.x))/(0-_)),I>=a.x&&(w+=1),2!==w)))break;return w},getBoundingRect:function(a,c){var _=this.getCoords(a,c);return m.makeBoundingBoxFromPoints(_)},getScaledWidth:function(){return this._getTransformedDimensions().x},getScaledHeight:function(){return this._getTransformedDimensions().y},_constrainScale:function(a){return Math.abs(a)<this.minScaleLimit?a<0?-this.minScaleLimit:this.minScaleLimit:0===a?1e-4:a},scale:function(a){return this._set("scaleX",a),this._set("scaleY",a),this.setCoords()},scaleToWidth:function(a,c){var _=this.getBoundingRect(c).width/this.getScaledWidth();return this.scale(a/this.width/_)},scaleToHeight:function(a,c){var _=this.getBoundingRect(c).height/this.getScaledHeight();return this.scale(a/this.height/_)},calcLineCoords:function(){var a=this.getViewportTransform(),c=this.padding,_=f(this.angle),I=m.cos(_)*c,y=m.sin(_)*c,w=I+y,b=I-y,x=this.calcACoords(),O={tl:v(x.tl,a),tr:v(x.tr,a),bl:v(x.bl,a),br:v(x.br,a)};return c&&(O.tl.x-=b,O.tl.y-=w,O.tr.x+=w,O.tr.y-=b,O.bl.x-=w,O.bl.y+=b,O.br.x+=b,O.br.y+=w),O},calcOCoords:function(){var a=this._calcRotateMatrix(),c=this._calcTranslateMatrix(),_=this.getViewportTransform(),I=g(_,c),y=g(I,a),w=(y=g(y,[1/_[0],0,0,1/_[3],0,0]),this._calculateCurrentDimensions()),b={};return this.forEachControl(function(x,O,F){b[O]=x.positionHandler(w,y,F)}),b},calcACoords:function(){var a=this._calcRotateMatrix(),c=this._calcTranslateMatrix(),_=g(c,a),I=this._getTransformedDimensions(),y=I.x/2,w=I.y/2;return{tl:v({x:-y,y:-w},_),tr:v({x:y,y:-w},_),bl:v({x:-y,y:w},_),br:v({x:y,y:w},_)}},setCoords:function(a){return this.aCoords=this.calcACoords(),this.lineCoords=this.group?this.aCoords:this.calcLineCoords(),a||(this.oCoords=this.calcOCoords(),this._setCornerCoords&&this._setCornerCoords()),this},_calcRotateMatrix:function(){return m.calcRotateMatrix(this)},_calcTranslateMatrix:function(){var a=this.getCenterPoint();return[1,0,0,1,a.x,a.y]},transformMatrixKey:function(a){var c="_",_="";return!a&&this.group&&(_=this.group.transformMatrixKey(a)+c),_+this.top+c+this.left+c+this.scaleX+c+this.scaleY+c+this.skewX+c+this.skewY+c+this.angle+c+this.originX+c+this.originY+c+this.width+c+this.height+c+this.strokeWidth+this.flipX+this.flipY},calcTransformMatrix:function(a){var c=this.calcOwnMatrix();if(a||!this.group)return c;var _=this.transformMatrixKey(a),I=this.matrixCache||(this.matrixCache={});return I.key===_?I.value:(this.group&&(c=g(this.group.calcTransformMatrix(!1),c)),I.key=_,I.value=c,c)},calcOwnMatrix:function(){var a=this.transformMatrixKey(!0),c=this.ownMatrixCache||(this.ownMatrixCache={});if(c.key===a)return c.value;var _=this._calcTranslateMatrix(),I={angle:this.angle,translateX:_[4],translateY:_[5],scaleX:this.scaleX,scaleY:this.scaleY,skewX:this.skewX,skewY:this.skewY,flipX:this.flipX,flipY:this.flipY};return c.key=a,c.value=m.composeMatrix(I),c.value},_getNonTransformedDimensions:function(){var a=this.strokeWidth;return{x:this.width+a,y:this.height+a}},_getTransformedDimensions:function(a,c){void 0===a&&(a=this.skewX),void 0===c&&(c=this.skewY);var _,I,y,w=0===a&&0===c;if(this.strokeUniform?(I=this.width,y=this.height):(I=(_=this._getNonTransformedDimensions()).x,y=_.y),w)return this._finalizeDimensions(I*this.scaleX,y*this.scaleY);var b=m.sizeAfterTransform(I,y,{scaleX:this.scaleX,scaleY:this.scaleY,skewX:a,skewY:c});return this._finalizeDimensions(b.x,b.y)},_finalizeDimensions:function(a,c){return this.strokeUniform?{x:a+this.strokeWidth,y:c+this.strokeWidth}:{x:a,y:c}},_calculateCurrentDimensions:function(){var a=this.getViewportTransform(),c=this._getTransformedDimensions();return v(c,a,!0).scalarAdd(2*this.padding)}})}(),S.util.object.extend(S.Object.prototype,{sendToBack:function(){return this.group?S.StaticCanvas.prototype.sendToBack.call(this.group,this):this.canvas&&this.canvas.sendToBack(this),this},bringToFront:function(){return this.group?S.StaticCanvas.prototype.bringToFront.call(this.group,this):this.canvas&&this.canvas.bringToFront(this),this},sendBackwards:function(m){return this.group?S.StaticCanvas.prototype.sendBackwards.call(this.group,this,m):this.canvas&&this.canvas.sendBackwards(this,m),this},bringForward:function(m){return this.group?S.StaticCanvas.prototype.bringForward.call(this.group,this,m):this.canvas&&this.canvas.bringForward(this,m),this},moveTo:function(m){return this.group&&"activeSelection"!==this.group.type?S.StaticCanvas.prototype.moveTo.call(this.group,this,m):this.canvas&&this.canvas.moveTo(this,m),this}}),function(){function m(g,v){if(v){if(v.toLive)return g+": url(#SVGID_"+v.id+"); ";var a=new S.Color(v),c=g+": "+a.toRgb()+"; ",_=a.getAlpha();return 1!==_&&(c+=g+"-opacity: "+_.toString()+"; "),c}return g+": none; "}var f=S.util.toFixed;S.util.object.extend(S.Object.prototype,{getSvgStyles:function(g){var v=this.fillRule?this.fillRule:"nonzero",a=this.strokeWidth?this.strokeWidth:"0",c=this.strokeDashArray?this.strokeDashArray.join(" "):"none",_=this.strokeDashOffset?this.strokeDashOffset:"0",I=this.strokeLineCap?this.strokeLineCap:"butt",y=this.strokeLineJoin?this.strokeLineJoin:"miter",w=this.strokeMiterLimit?this.strokeMiterLimit:"4",b=void 0!==this.opacity?this.opacity:"1",x=this.visible?"":" visibility: hidden;",O=g?"":this.getSvgFilter(),F=m("fill",this.fill);return[m("stroke",this.stroke),"stroke-width: ",a,"; ","stroke-dasharray: ",c,"; ","stroke-linecap: ",I,"; ","stroke-dashoffset: ",_,"; ","stroke-linejoin: ",y,"; ","stroke-miterlimit: ",w,"; ",F,"fill-rule: ",v,"; ","opacity: ",b,";",O,x].join("")},getSvgSpanStyles:function(g,v){var a="; ",c=g.fontFamily?"font-family: "+(-1===g.fontFamily.indexOf("'")&&-1===g.fontFamily.indexOf('"')?"'"+g.fontFamily+"'":g.fontFamily)+a:"",_=g.strokeWidth?"stroke-width: "+g.strokeWidth+a:"",I=g.fontSize?"font-size: "+g.fontSize+"px"+a:"",y=g.fontStyle?"font-style: "+g.fontStyle+a:"",w=g.fontWeight?"font-weight: "+g.fontWeight+a:"",b=g.fill?m("fill",g.fill):"",x=g.stroke?m("stroke",g.stroke):"",O=this.getSvgTextDecoration(g);return O&&(O="text-decoration: "+O+a),[x,_,c,I,y,w,O,b,g.deltaY?"baseline-shift: "+-g.deltaY+"; ":"",v?"white-space: pre; ":""].join("")},getSvgTextDecoration:function(g){return["overline","underline","line-through"].filter(function(v){return g[v.replace("-","")]}).join(" ")},getSvgFilter:function(){return this.shadow?"filter: url(#SVGID_"+this.shadow.id+");":""},getSvgCommons:function(){return[this.id?'id="'+this.id+'" ':"",this.clipPath?'clip-path="url(#'+this.clipPath.clipPathId+')" ':""].join("")},getSvgTransform:function(g,v){var a=g?this.calcTransformMatrix():this.calcOwnMatrix();return'transform="'+S.util.matrixToSVG(a)+(v||"")+'" '},_setSVGBg:function(g){if(this.backgroundColor){var v=S.Object.NUM_FRACTION_DIGITS;g.push("\t\t<rect ",this._getFillAttributes(this.backgroundColor),' x="',f(-this.width/2,v),'" y="',f(-this.height/2,v),'" width="',f(this.width,v),'" height="',f(this.height,v),'"></rect>\n')}},toSVG:function(g){return this._createBaseSVGMarkup(this._toSVG(g),{reviver:g})},toClipPathSVG:function(g){return"\t"+this._createBaseClipPathSVGMarkup(this._toSVG(g),{reviver:g})},_createBaseClipPathSVGMarkup:function(g,v){var a=(v=v||{}).reviver,_=[this.getSvgTransform(!0,v.additionalTransform||""),this.getSvgCommons()].join(""),I=g.indexOf("COMMON_PARTS");return g[I]=_,a?a(g.join("")):g.join("")},_createBaseSVGMarkup:function(g,v){var a,c,_=(v=v||{}).noStyle,I=v.reviver,y=_?"":'style="'+this.getSvgStyles()+'" ',w=v.withShadow?'style="'+this.getSvgFilter()+'" ':"",b=this.clipPath,x=this.strokeUniform?'vector-effect="non-scaling-stroke" ':"",O=b&&b.absolutePositioned,F=this.stroke,L=this.fill,N=this.shadow,j=[],$=g.indexOf("COMMON_PARTS"),X=v.additionalTransform;return b&&(b.clipPathId="CLIPPATH_"+S.Object.__uid++,c='<clipPath id="'+b.clipPathId+'" >\n'+b.toClipPathSVG(I)+"</clipPath>\n"),O&&j.push("<g ",w,this.getSvgCommons()," >\n"),j.push("<g ",this.getSvgTransform(!1),O?"":w+this.getSvgCommons()," >\n"),a=[y,x,_?"":this.addPaintOrder()," ",X?'transform="'+X+'" ':""].join(""),g[$]=a,L&&L.toLive&&j.push(L.toSVG(this)),F&&F.toLive&&j.push(F.toSVG(this)),N&&j.push(N.toSVG(this)),b&&j.push(c),j.push(g.join("")),j.push("</g>\n"),O&&j.push("</g>\n"),I?I(j.join("")):j.join("")},addPaintOrder:function(){return"fill"!==this.paintFirst?' paint-order="'+this.paintFirst+'" ':""}})}(),function(){var m=S.util.object.extend,f="stateProperties";function g(a,c,_){var I={};_.forEach(function(y){I[y]=a[y]}),m(a[c],I,!0)}function v(a,c,_){if(a===c)return!0;if(Array.isArray(a)){if(!Array.isArray(c)||a.length!==c.length)return!1;for(var I=0,y=a.length;I<y;I++)if(!v(a[I],c[I]))return!1;return!0}if(a&&"object"==typeof a){var w,b=Object.keys(a);if(!c||"object"!=typeof c||!_&&b.length!==Object.keys(c).length)return!1;for(I=0,y=b.length;I<y;I++)if("canvas"!==(w=b[I])&&"group"!==w&&!v(a[w],c[w]))return!1;return!0}}S.util.object.extend(S.Object.prototype,{hasStateChanged:function(a){var c="_"+(a=a||f);return Object.keys(this[c]).length<this[a].length||!v(this[c],this,!0)},saveState:function(a){var c=a&&a.propertySet||f,_="_"+c;return this[_]?(g(this,_,this[c]),a&&a.stateProperties&&g(this,_,a.stateProperties),this):this.setupState(a)},setupState:function(a){var c=(a=a||{}).propertySet||f;return a.propertySet=c,this["_"+c]={},this.saveState(a),this}})}(),function(){var m=S.util.degreesToRadians;S.util.object.extend(S.Object.prototype,{_findTargetCorner:function(f,g){if(!this.hasControls||this.group||!this.canvas||this.canvas._activeObject!==this)return!1;var v,a,c,_=f.x,I=f.y,y=Object.keys(this.oCoords),w=y.length-1;for(this.__corner=0;w>=0;w--)if(this.isControlVisible(c=y[w])&&(a=this._getImageLines(g?this.oCoords[c].touchCorner:this.oCoords[c].corner),0!==(v=this._findCrossPoints({x:_,y:I},a))&&v%2==1))return this.__corner=c,c;return!1},forEachControl:function(f){for(var g in this.controls)f(this.controls[g],g,this)},_setCornerCoords:function(){var f=this.oCoords;for(var g in f){var v=this.controls[g];f[g].corner=v.calcCornerCoords(this.angle,this.cornerSize,f[g].x,f[g].y,!1),f[g].touchCorner=v.calcCornerCoords(this.angle,this.touchCornerSize,f[g].x,f[g].y,!0)}},drawSelectionBackground:function(f){if(!this.selectionBackgroundColor||this.canvas&&!this.canvas.interactive||this.canvas&&this.canvas._activeObject!==this)return this;f.save();var g=this.getCenterPoint(),v=this._calculateCurrentDimensions(),a=this.canvas.viewportTransform;return f.translate(g.x,g.y),f.scale(1/a[0],1/a[3]),f.rotate(m(this.angle)),f.fillStyle=this.selectionBackgroundColor,f.fillRect(-v.x/2,-v.y/2,v.x,v.y),f.restore(),this},drawBorders:function(f,g){g=g||{};var v=this._calculateCurrentDimensions(),a=this.borderScaleFactor,c=v.x+a,_=v.y+a,I=void 0!==g.hasControls?g.hasControls:this.hasControls,y=!1;return f.save(),f.strokeStyle=g.borderColor||this.borderColor,this._setLineDash(f,g.borderDashArray||this.borderDashArray),f.strokeRect(-c/2,-_/2,c,_),I&&(f.beginPath(),this.forEachControl(function(w,b,x){w.withConnection&&w.getVisibility(x,b)&&(y=!0,f.moveTo(w.x*c,w.y*_),f.lineTo(w.x*c+w.offsetX,w.y*_+w.offsetY))}),y&&f.stroke()),f.restore(),this},drawBordersInGroup:function(f,g,v){v=v||{};var a=S.util.sizeAfterTransform(this.width,this.height,g),c=this.strokeWidth,_=this.strokeUniform,I=this.borderScaleFactor,y=a.x+c*(_?this.canvas.getZoom():g.scaleX)+I,w=a.y+c*(_?this.canvas.getZoom():g.scaleY)+I;return f.save(),this._setLineDash(f,v.borderDashArray||this.borderDashArray),f.strokeStyle=v.borderColor||this.borderColor,f.strokeRect(-y/2,-w/2,y,w),f.restore(),this},drawControls:function(f,g){g=g||{},f.save();var v,a,c=this.canvas.getRetinaScaling();return f.setTransform(c,0,0,c,0,0),f.strokeStyle=f.fillStyle=g.cornerColor||this.cornerColor,this.transparentCorners||(f.strokeStyle=g.cornerStrokeColor||this.cornerStrokeColor),this._setLineDash(f,g.cornerDashArray||this.cornerDashArray),this.setCoords(),this.group&&(v=this.group.calcTransformMatrix()),this.forEachControl(function(_,I,y){a=y.oCoords[I],_.getVisibility(y,I)&&(v&&(a=S.util.transformPoint(a,v)),_.render(f,a.x,a.y,g,y))}),f.restore(),this},isControlVisible:function(f){return this.controls[f]&&this.controls[f].getVisibility(this,f)},setControlVisible:function(f,g){return this._controlsVisibility||(this._controlsVisibility={}),this._controlsVisibility[f]=g,this},setControlsVisibility:function(f){for(var g in f||(f={}),f)this.setControlVisible(g,f[g]);return this},onDeselect:function(){},onSelect:function(){}})}(),S.util.object.extend(S.StaticCanvas.prototype,{FX_DURATION:500,fxCenterObjectH:function(m,f){var g=function(){},v=(f=f||{}).onComplete||g,a=f.onChange||g,c=this;return S.util.animate({target:this,startValue:m.left,endValue:this.getCenterPoint().x,duration:this.FX_DURATION,onChange:function(_){m.set("left",_),c.requestRenderAll(),a()},onComplete:function(){m.setCoords(),v()}})},fxCenterObjectV:function(m,f){var g=function(){},v=(f=f||{}).onComplete||g,a=f.onChange||g,c=this;return S.util.animate({target:this,startValue:m.top,endValue:this.getCenterPoint().y,duration:this.FX_DURATION,onChange:function(_){m.set("top",_),c.requestRenderAll(),a()},onComplete:function(){m.setCoords(),v()}})},fxRemove:function(m,f){var g=function(){},v=(f=f||{}).onComplete||g,a=f.onChange||g,c=this;return S.util.animate({target:this,startValue:m.opacity,endValue:0,duration:this.FX_DURATION,onChange:function(_){m.set("opacity",_),c.requestRenderAll(),a()},onComplete:function(){c.remove(m),v()}})}}),S.util.object.extend(S.Object.prototype,{animate:function(){if(arguments[0]&&"object"==typeof arguments[0]){var m,g=[],v=[];for(m in arguments[0])g.push(m);for(var a=0,c=g.length;a<c;a++)v.push(this._animate(m=g[a],arguments[0][m],arguments[1],a!==c-1));return v}return this._animate.apply(this,arguments)},_animate:function(m,f,g,v){var a,c=this;f=f.toString(),g=g?S.util.object.clone(g):{},~m.indexOf(".")&&(a=m.split("."));var _=c.colorProperties.indexOf(m)>-1||a&&c.colorProperties.indexOf(a[1])>-1,I=a?this.get(a[0])[a[1]]:this.get(m);"from"in g||(g.from=I),_||(f=~f.indexOf("=")?I+parseFloat(f.replace("=","")):parseFloat(f));var y={target:this,startValue:g.from,endValue:f,byValue:g.by,easing:g.easing,duration:g.duration,abort:g.abort&&function(w,b,x){return g.abort.call(c,w,b,x)},onChange:function(w,b,x){a?c[a[0]][a[1]]=w:c.set(m,w),v||g.onChange&&g.onChange(w,b,x)},onComplete:function(w,b,x){v||(c.setCoords(),g.onComplete&&g.onComplete(w,b,x))}};return _?S.util.animateColor(y.startValue,y.endValue,y.duration,y):S.util.animate(y)}}),function(m){var f=m.fabric||(m.fabric={}),g=f.util.object.extend,v=f.util.object.clone,a={x1:1,x2:1,y1:1,y2:1};function c(_,I){var y=_.origin,w=_.axis1,b=_.axis2,x=_.dimension,O=I.nearest,F=I.center,L=I.farthest;return function(){switch(this.get(y)){case O:return Math.min(this.get(w),this.get(b));case F:return Math.min(this.get(w),this.get(b))+.5*this.get(x);case L:return Math.max(this.get(w),this.get(b))}}}f.Line?f.warn("fabric.Line is already defined"):(f.Line=f.util.createClass(f.Object,{type:"line",x1:0,y1:0,x2:0,y2:0,cacheProperties:f.Object.prototype.cacheProperties.concat("x1","x2","y1","y2"),initialize:function(_,I){_||(_=[0,0,0,0]),this.callSuper("initialize",I),this.set("x1",_[0]),this.set("y1",_[1]),this.set("x2",_[2]),this.set("y2",_[3]),this._setWidthHeight(I)},_setWidthHeight:function(_){_||(_={}),this.width=Math.abs(this.x2-this.x1),this.height=Math.abs(this.y2-this.y1),this.left="left"in _?_.left:this._getLeftToOriginX(),this.top="top"in _?_.top:this._getTopToOriginY()},_set:function(_,I){return this.callSuper("_set",_,I),void 0!==a[_]&&this._setWidthHeight(),this},_getLeftToOriginX:c({origin:"originX",axis1:"x1",axis2:"x2",dimension:"width"},{nearest:"left",center:"center",farthest:"right"}),_getTopToOriginY:c({origin:"originY",axis1:"y1",axis2:"y2",dimension:"height"},{nearest:"top",center:"center",farthest:"bottom"}),_render:function(_){_.beginPath();var I=this.calcLinePoints();_.moveTo(I.x1,I.y1),_.lineTo(I.x2,I.y2),_.lineWidth=this.strokeWidth;var y=_.strokeStyle;_.strokeStyle=this.stroke||_.fillStyle,this.stroke&&this._renderStroke(_),_.strokeStyle=y},_findCenterFromElement:function(){return{x:(this.x1+this.x2)/2,y:(this.y1+this.y2)/2}},toObject:function(_){return g(this.callSuper("toObject",_),this.calcLinePoints())},_getNonTransformedDimensions:function(){var _=this.callSuper("_getNonTransformedDimensions");return"butt"===this.strokeLineCap&&(0===this.width&&(_.y-=this.strokeWidth),0===this.height&&(_.x-=this.strokeWidth)),_},calcLinePoints:function(){var _=this.x1<=this.x2?-1:1,I=this.y1<=this.y2?-1:1;return{x1:_*this.width*.5,x2:_*this.width*-.5,y1:I*this.height*.5,y2:I*this.height*-.5}},_toSVG:function(){var _=this.calcLinePoints();return["<line ","COMMON_PARTS",'x1="',_.x1,'" y1="',_.y1,'" x2="',_.x2,'" y2="',_.y2,'" />\n']}}),f.Line.ATTRIBUTE_NAMES=f.SHARED_ATTRIBUTES.concat("x1 y1 x2 y2".split(" ")),f.Line.fromElement=function(_,I,y){y=y||{};var w=f.parseAttributes(_,f.Line.ATTRIBUTE_NAMES);I(new f.Line([w.x1||0,w.y1||0,w.x2||0,w.y2||0],g(w,y)))},f.Line.fromObject=function(_,I){var y=v(_,!0);y.points=[_.x1,_.y1,_.x2,_.y2],f.Object._fromObject("Line",y,function(w){delete w.points,I&&I(w)},"points")})}(n),function(m){var f=m.fabric||(m.fabric={}),g=f.util.degreesToRadians;f.Circle?f.warn("fabric.Circle is already defined."):(f.Circle=f.util.createClass(f.Object,{type:"circle",radius:0,startAngle:0,endAngle:360,cacheProperties:f.Object.prototype.cacheProperties.concat("radius","startAngle","endAngle"),_set:function(v,a){return this.callSuper("_set",v,a),"radius"===v&&this.setRadius(a),this},toObject:function(v){return this.callSuper("toObject",["radius","startAngle","endAngle"].concat(v))},_toSVG:function(){var v,a=(this.endAngle-this.startAngle)%360;if(0===a)v=["<circle ","COMMON_PARTS",'cx="0" cy="0" ','r="',this.radius,'" />\n'];else{var c=g(this.startAngle),_=g(this.endAngle),I=this.radius;v=['<path d="M '+f.util.cos(c)*I+" "+f.util.sin(c)*I," A "+I+" "+I," 0 ",+(a>180?"1":"0")+" 1"," "+f.util.cos(_)*I+" "+f.util.sin(_)*I,'" ',"COMMON_PARTS"," />\n"]}return v},_render:function(v){v.beginPath(),v.arc(0,0,this.radius,g(this.startAngle),g(this.endAngle),!1),this._renderPaintInOrder(v)},getRadiusX:function(){return this.get("radius")*this.get("scaleX")},getRadiusY:function(){return this.get("radius")*this.get("scaleY")},setRadius:function(v){return this.radius=v,this.set("width",2*v).set("height",2*v)}}),f.Circle.ATTRIBUTE_NAMES=f.SHARED_ATTRIBUTES.concat("cx cy r".split(" ")),f.Circle.fromElement=function(v,a){var c,_=f.parseAttributes(v,f.Circle.ATTRIBUTE_NAMES);if(!("radius"in(c=_)&&c.radius>=0))throw new Error("value of `r` attribute is required and can not be negative");_.left=(_.left||0)-_.radius,_.top=(_.top||0)-_.radius,a(new f.Circle(_))},f.Circle.fromObject=function(v,a){f.Object._fromObject("Circle",v,a)})}(n),function(m){var f=m.fabric||(m.fabric={});f.Triangle?f.warn("fabric.Triangle is already defined"):(f.Triangle=f.util.createClass(f.Object,{type:"triangle",width:100,height:100,_render:function(g){var v=this.width/2,a=this.height/2;g.beginPath(),g.moveTo(-v,a),g.lineTo(0,-a),g.lineTo(v,a),g.closePath(),this._renderPaintInOrder(g)},_toSVG:function(){var g=this.width/2,v=this.height/2;return["<polygon ","COMMON_PARTS",'points="',[-g+" "+v,"0 "+-v,g+" "+v].join(","),'" />']}}),f.Triangle.fromObject=function(g,v){return f.Object._fromObject("Triangle",g,v)})}(n),function(m){var f=m.fabric||(m.fabric={}),g=2*Math.PI;f.Ellipse?f.warn("fabric.Ellipse is already defined."):(f.Ellipse=f.util.createClass(f.Object,{type:"ellipse",rx:0,ry:0,cacheProperties:f.Object.prototype.cacheProperties.concat("rx","ry"),initialize:function(v){this.callSuper("initialize",v),this.set("rx",v&&v.rx||0),this.set("ry",v&&v.ry||0)},_set:function(v,a){switch(this.callSuper("_set",v,a),v){case"rx":this.rx=a,this.set("width",2*a);break;case"ry":this.ry=a,this.set("height",2*a)}return this},getRx:function(){return this.get("rx")*this.get("scaleX")},getRy:function(){return this.get("ry")*this.get("scaleY")},toObject:function(v){return this.callSuper("toObject",["rx","ry"].concat(v))},_toSVG:function(){return["<ellipse ","COMMON_PARTS",'cx="0" cy="0" ','rx="',this.rx,'" ry="',this.ry,'" />\n']},_render:function(v){v.beginPath(),v.save(),v.transform(1,0,0,this.ry/this.rx,0,0),v.arc(0,0,this.rx,0,g,!1),v.restore(),this._renderPaintInOrder(v)}}),f.Ellipse.ATTRIBUTE_NAMES=f.SHARED_ATTRIBUTES.concat("cx cy rx ry".split(" ")),f.Ellipse.fromElement=function(v,a){var c=f.parseAttributes(v,f.Ellipse.ATTRIBUTE_NAMES);c.left=(c.left||0)-c.rx,c.top=(c.top||0)-c.ry,a(new f.Ellipse(c))},f.Ellipse.fromObject=function(v,a){f.Object._fromObject("Ellipse",v,a)})}(n),function(m){var f=m.fabric||(m.fabric={}),g=f.util.object.extend;f.Rect?f.warn("fabric.Rect is already defined"):(f.Rect=f.util.createClass(f.Object,{stateProperties:f.Object.prototype.stateProperties.concat("rx","ry"),type:"rect",rx:0,ry:0,cacheProperties:f.Object.prototype.cacheProperties.concat("rx","ry"),initialize:function(v){this.callSuper("initialize",v),this._initRxRy()},_initRxRy:function(){this.rx&&!this.ry?this.ry=this.rx:this.ry&&!this.rx&&(this.rx=this.ry)},_render:function(v){var a=this.rx?Math.min(this.rx,this.width/2):0,c=this.ry?Math.min(this.ry,this.height/2):0,_=this.width,I=this.height,y=-this.width/2,w=-this.height/2,b=0!==a||0!==c,x=.4477152502;v.beginPath(),v.moveTo(y+a,w),v.lineTo(y+_-a,w),b&&v.bezierCurveTo(y+_-x*a,w,y+_,w+x*c,y+_,w+c),v.lineTo(y+_,w+I-c),b&&v.bezierCurveTo(y+_,w+I-x*c,y+_-x*a,w+I,y+_-a,w+I),v.lineTo(y+a,w+I),b&&v.bezierCurveTo(y+x*a,w+I,y,w+I-x*c,y,w+I-c),v.lineTo(y,w+c),b&&v.bezierCurveTo(y,w+x*c,y+x*a,w,y+a,w),v.closePath(),this._renderPaintInOrder(v)},toObject:function(v){return this.callSuper("toObject",["rx","ry"].concat(v))},_toSVG:function(){return["<rect ","COMMON_PARTS",'x="',-this.width/2,'" y="',-this.height/2,'" rx="',this.rx,'" ry="',this.ry,'" width="',this.width,'" height="',this.height,'" />\n']}}),f.Rect.ATTRIBUTE_NAMES=f.SHARED_ATTRIBUTES.concat("x y rx ry width height".split(" ")),f.Rect.fromElement=function(v,a,c){if(!v)return a(null);c=c||{};var _=f.parseAttributes(v,f.Rect.ATTRIBUTE_NAMES);_.left=_.left||0,_.top=_.top||0,_.height=_.height||0,_.width=_.width||0;var I=new f.Rect(g(c?f.util.object.clone(c):{},_));I.visible=I.visible&&I.width>0&&I.height>0,a(I)},f.Rect.fromObject=function(v,a){return f.Object._fromObject("Rect",v,a)})}(n),function(m){var f=m.fabric||(m.fabric={}),g=f.util.object.extend,v=f.util.array.min,a=f.util.array.max,c=f.util.toFixed,_=f.util.projectStrokeOnPoints;f.Polyline?f.warn("fabric.Polyline is already defined"):(f.Polyline=f.util.createClass(f.Object,{type:"polyline",points:null,exactBoundingBox:!1,cacheProperties:f.Object.prototype.cacheProperties.concat("points"),initialize:function(I,y){y=y||{},this.points=I||[],this.callSuper("initialize",y),this._setPositionDimensions(y)},_projectStrokeOnPoints:function(){return _(this.points,this,!0)},_setPositionDimensions:function(I){var y,w=this._calcDimensions(I),b=this.exactBoundingBox?this.strokeWidth:0;this.width=w.width-b,this.height=w.height-b,I.fromSVG||(y=this.translateToGivenOrigin({x:w.left-this.strokeWidth/2+b/2,y:w.top-this.strokeWidth/2+b/2},"left","top",this.originX,this.originY)),void 0===I.left&&(this.left=I.fromSVG?w.left:y.x),void 0===I.top&&(this.top=I.fromSVG?w.top:y.y),this.pathOffset={x:w.left+this.width/2+b/2,y:w.top+this.height/2+b/2}},_calcDimensions:function(){var I=this.exactBoundingBox?this._projectStrokeOnPoints():this.points,y=v(I,"x")||0,w=v(I,"y")||0;return{left:y,top:w,width:(a(I,"x")||0)-y,height:(a(I,"y")||0)-w}},toObject:function(I){return g(this.callSuper("toObject",I),{points:this.points.concat()})},_toSVG:function(){for(var I=[],y=this.pathOffset.x,w=this.pathOffset.y,b=f.Object.NUM_FRACTION_DIGITS,x=0,O=this.points.length;x<O;x++)I.push(c(this.points[x].x-y,b),",",c(this.points[x].y-w,b)," ");return["<"+this.type+" ","COMMON_PARTS",'points="',I.join(""),'" />\n']},commonRender:function(I){var y,w=this.points.length,b=this.pathOffset.x,x=this.pathOffset.y;if(!w||isNaN(this.points[w-1].y))return!1;I.beginPath(),I.moveTo(this.points[0].x-b,this.points[0].y-x);for(var O=0;O<w;O++)I.lineTo((y=this.points[O]).x-b,y.y-x);return!0},_render:function(I){this.commonRender(I)&&this._renderPaintInOrder(I)},complexity:function(){return this.get("points").length}}),f.Polyline.ATTRIBUTE_NAMES=f.SHARED_ATTRIBUTES.concat(),f.Polyline.fromElementGenerator=function(I){return function(y,w,b){if(!y)return w(null);b||(b={});var x=f.parsePointsAttribute(y.getAttribute("points")),O=f.parseAttributes(y,f[I].ATTRIBUTE_NAMES);O.fromSVG=!0,w(new f[I](x,g(O,b)))}},f.Polyline.fromElement=f.Polyline.fromElementGenerator("Polyline"),f.Polyline.fromObject=function(I,y){return f.Object._fromObject("Polyline",I,y,"points")})}(n),function(m){var f=m.fabric||(m.fabric={}),g=f.util.projectStrokeOnPoints;f.Polygon?f.warn("fabric.Polygon is already defined"):(f.Polygon=f.util.createClass(f.Polyline,{type:"polygon",_projectStrokeOnPoints:function(){return g(this.points,this)},_render:function(v){this.commonRender(v)&&(v.closePath(),this._renderPaintInOrder(v))}}),f.Polygon.ATTRIBUTE_NAMES=f.SHARED_ATTRIBUTES.concat(),f.Polygon.fromElement=f.Polyline.fromElementGenerator("Polygon"),f.Polygon.fromObject=function(v,a){f.Object._fromObject("Polygon",v,a,"points")})}(n),function(m){var f=m.fabric||(m.fabric={}),g=f.util.array.min,v=f.util.array.max,a=f.util.object.extend,c=f.util.object.clone,_=f.util.toFixed;f.Path?f.warn("fabric.Path is already defined"):(f.Path=f.util.createClass(f.Object,{type:"path",path:null,cacheProperties:f.Object.prototype.cacheProperties.concat("path","fillRule"),stateProperties:f.Object.prototype.stateProperties.concat("path"),initialize:function(I,y){delete(y=c(y||{})).path,this.callSuper("initialize",y),this._setPath(I||[],y)},_setPath:function(I,y){this.path=f.util.makePathSimpler(Array.isArray(I)?I:f.util.parsePath(I)),f.Polyline.prototype._setPositionDimensions.call(this,y||{})},_renderPathCommands:function(I){var y,w=0,b=0,x=0,O=0,N=-this.pathOffset.x,j=-this.pathOffset.y;I.beginPath();for(var $=0,X=this.path.length;$<X;++$)switch((y=this.path[$])[0]){case"L":I.lineTo((x=y[1])+N,(O=y[2])+j);break;case"M":w=x=y[1],b=O=y[2],I.moveTo(x+N,O+j);break;case"C":I.bezierCurveTo(y[1]+N,y[2]+j,y[3]+N,y[4]+j,(x=y[5])+N,(O=y[6])+j);break;case"Q":I.quadraticCurveTo(y[1]+N,y[2]+j,y[3]+N,y[4]+j),x=y[3],O=y[4];break;case"z":case"Z":x=w,O=b,I.closePath()}},_render:function(I){this._renderPathCommands(I),this._renderPaintInOrder(I)},toString:function(){return"#<fabric.Path ("+this.complexity()+'): { "top": '+this.top+', "left": '+this.left+" }>"},toObject:function(I){return a(this.callSuper("toObject",I),{path:this.path.map(function(y){return y.slice()})})},toDatalessObject:function(I){var y=this.toObject(["sourcePath"].concat(I));return y.sourcePath&&delete y.path,y},_toSVG:function(){return["<path ","COMMON_PARTS",'d="',f.util.joinPath(this.path),'" stroke-linecap="round" ',"/>\n"]},_getOffsetTransform:function(){var I=f.Object.NUM_FRACTION_DIGITS;return" translate("+_(-this.pathOffset.x,I)+", "+_(-this.pathOffset.y,I)+")"},toClipPathSVG:function(I){var y=this._getOffsetTransform();return"\t"+this._createBaseClipPathSVGMarkup(this._toSVG(),{reviver:I,additionalTransform:y})},toSVG:function(I){var y=this._getOffsetTransform();return this._createBaseSVGMarkup(this._toSVG(),{reviver:I,additionalTransform:y})},complexity:function(){return this.path.length},_calcDimensions:function(){for(var I,y,w=[],b=[],x=0,O=0,F=0,L=0,N=0,j=this.path.length;N<j;++N){switch((I=this.path[N])[0]){case"L":F=I[1],L=I[2],y=[];break;case"M":x=F=I[1],O=L=I[2],y=[];break;case"C":y=f.util.getBoundsOfCurve(F,L,I[1],I[2],I[3],I[4],I[5],I[6]),F=I[5],L=I[6];break;case"Q":y=f.util.getBoundsOfCurve(F,L,I[1],I[2],I[1],I[2],I[3],I[4]),F=I[3],L=I[4];break;case"z":case"Z":F=x,L=O}y.forEach(function(ie){w.push(ie.x),b.push(ie.y)}),w.push(F),b.push(L)}var $=g(w)||0,X=g(b)||0;return{left:$,top:X,width:(v(w)||0)-$,height:(v(b)||0)-X}}}),f.Path.fromObject=function(I,y){"string"==typeof I.sourcePath?f.loadSVGFromURL(I.sourcePath,function(b){var x=b[0];x.setOptions(I),y&&y(x)}):f.Object._fromObject("Path",I,y,"path")},f.Path.ATTRIBUTE_NAMES=f.SHARED_ATTRIBUTES.concat(["d"]),f.Path.fromElement=function(I,y,w){var b=f.parseAttributes(I,f.Path.ATTRIBUTE_NAMES);b.fromSVG=!0,y(new f.Path(b.d,a(b,w)))})}(n),function(m){var f=m.fabric||(m.fabric={}),g=f.util.array.min,v=f.util.array.max;f.Group||(f.Group=f.util.createClass(f.Object,f.Collection,{type:"group",strokeWidth:0,subTargetCheck:!1,cacheProperties:[],useSetOnGroup:!1,initialize:function(a,c,_){c=c||{},this._objects=[],_&&this.callSuper("initialize",c),this._objects=a||[];for(var I=this._objects.length;I--;)this._objects[I].group=this;if(_)this._updateObjectsACoords();else{var y=c&&c.centerPoint;void 0!==c.originX&&(this.originX=c.originX),void 0!==c.originY&&(this.originY=c.originY),y||this._calcBounds(),this._updateObjectsCoords(y),delete c.centerPoint,this.callSuper("initialize",c)}this.setCoords()},_updateObjectsACoords:function(){for(var a=this._objects.length;a--;)this._objects[a].setCoords(!0)},_updateObjectsCoords:function(a){a=a||this.getCenterPoint();for(var c=this._objects.length;c--;)this._updateObjectCoords(this._objects[c],a)},_updateObjectCoords:function(a,c){a.set({left:a.left-c.x,top:a.top-c.y}),a.group=this,a.setCoords(!0)},toString:function(){return"#<fabric.Group: ("+this.complexity()+")>"},addWithUpdate:function(a){var c=!!this.group;return this._restoreObjectsState(),f.util.resetObjectTransform(this),a&&(c&&f.util.removeTransformFromObject(a,this.group.calcTransformMatrix()),this._objects.push(a),a.group=this,a._set("canvas",this.canvas)),this._calcBounds(),this._updateObjectsCoords(),this.dirty=!0,c?this.group.addWithUpdate():this.setCoords(),this},removeWithUpdate:function(a){return this._restoreObjectsState(),f.util.resetObjectTransform(this),this.remove(a),this._calcBounds(),this._updateObjectsCoords(),this.setCoords(),this.dirty=!0,this},_onObjectAdded:function(a){this.dirty=!0,a.group=this,a._set("canvas",this.canvas)},_onObjectRemoved:function(a){this.dirty=!0,delete a.group},_set:function(a,c){var _=this._objects.length;if(this.useSetOnGroup)for(;_--;)this._objects[_].setOnGroup(a,c);if("canvas"===a)for(;_--;)this._objects[_]._set(a,c);f.Object.prototype._set.call(this,a,c)},toObject:function(a){var c=this.includeDefaultValues,_=this._objects.filter(function(y){return!y.excludeFromExport}).map(function(y){var w=y.includeDefaultValues;y.includeDefaultValues=c;var b=y.toObject(a);return y.includeDefaultValues=w,b}),I=f.Object.prototype.toObject.call(this,a);return I.objects=_,I},toDatalessObject:function(a){var c,_=this.sourcePath;if(_)c=_;else{var I=this.includeDefaultValues;c=this._objects.map(function(w){var b=w.includeDefaultValues;w.includeDefaultValues=I;var x=w.toDatalessObject(a);return w.includeDefaultValues=b,x})}var y=f.Object.prototype.toDatalessObject.call(this,a);return y.objects=c,y},render:function(a){this._transformDone=!0,this.callSuper("render",a),this._transformDone=!1},shouldCache:function(){var a=f.Object.prototype.shouldCache.call(this);if(a)for(var c=0,_=this._objects.length;c<_;c++)if(this._objects[c].willDrawShadow())return this.ownCaching=!1,!1;return a},willDrawShadow:function(){if(f.Object.prototype.willDrawShadow.call(this))return!0;for(var a=0,c=this._objects.length;a<c;a++)if(this._objects[a].willDrawShadow())return!0;return!1},isOnACache:function(){return this.ownCaching||this.group&&this.group.isOnACache()},drawObject:function(a){for(var c=0,_=this._objects.length;c<_;c++)this._objects[c].render(a);this._drawClipPath(a,this.clipPath)},isCacheDirty:function(a){if(this.callSuper("isCacheDirty",a))return!0;if(!this.statefullCache)return!1;for(var c=0,_=this._objects.length;c<_;c++)if(this._objects[c].isCacheDirty(!0)){if(this._cacheCanvas){var I=this.cacheWidth/this.zoomX,y=this.cacheHeight/this.zoomY;this._cacheContext.clearRect(-I/2,-y/2,I,y)}return!0}return!1},_restoreObjectsState:function(){var a=this.calcOwnMatrix();return this._objects.forEach(function(c){f.util.addTransformToObject(c,a),delete c.group,c.setCoords()}),this},destroy:function(){return this._objects.forEach(function(a){a.set("dirty",!0)}),this._restoreObjectsState()},dispose:function(){this.callSuper("dispose"),this.forEachObject(function(a){a.dispose&&a.dispose()}),this._objects=[]},toActiveSelection:function(){if(this.canvas){var a=this._objects,c=this.canvas;this._objects=[];var _=this.toObject();delete _.objects;var I=new f.ActiveSelection([]);return I.set(_),I.type="activeSelection",c.remove(this),a.forEach(function(y){y.group=I,y.dirty=!0,c.add(y)}),I.canvas=c,I._objects=a,c._activeObject=I,I.setCoords(),I}},ungroupOnCanvas:function(){return this._restoreObjectsState()},setObjectsCoords:function(){return this.forEachObject(function(a){a.setCoords(!0)}),this},_calcBounds:function(a){for(var c,_,I,y,w=[],b=[],x=["tr","br","bl","tl"],O=0,F=this._objects.length,L=x.length;O<F;++O){for(I=(c=this._objects[O]).calcACoords(),y=0;y<L;y++)w.push(I[_=x[y]].x),b.push(I[_].y);c.aCoords=I}this._getBounds(w,b,a)},_getBounds:function(a,c,_){var I=new f.Point(g(a),g(c)),y=new f.Point(v(a),v(c)),w=I.y||0,b=I.x||0,O=y.y-I.y||0;this.width=y.x-I.x||0,this.height=O,_||this.setPositionByOrigin({x:b,y:w},"left","top")},_toSVG:function(a){for(var c=["<g ","COMMON_PARTS"," >\n"],_=0,I=this._objects.length;_<I;_++)c.push("\t\t",this._objects[_].toSVG(a));return c.push("</g>\n"),c},getSvgStyles:function(){var c=this.visible?"":" visibility: hidden;";return[void 0!==this.opacity&&1!==this.opacity?"opacity: "+this.opacity+";":"",this.getSvgFilter(),c].join("")},toClipPathSVG:function(a){for(var c=[],_=0,I=this._objects.length;_<I;_++)c.push("\t",this._objects[_].toClipPathSVG(a));return this._createBaseClipPathSVGMarkup(c,{reviver:a})}}),f.Group.fromObject=function(a,c){var _=a.objects,I=f.util.object.clone(a,!0);delete I.objects,"string"!=typeof _?f.util.enlivenObjects(_,function(y){var w=f.util.object.clone(a,!0);delete w.objects,f.util.enlivenObjectEnlivables(a,w,function(){c&&c(new f.Group(y,w,!0))})}):f.loadSVGFromURL(_,function(y){var w=f.util.groupSVGElements(y,a,_);w.set(I),c&&c(w)})})}(n),function(m){var f=m.fabric||(m.fabric={});f.ActiveSelection||(f.ActiveSelection=f.util.createClass(f.Group,{type:"activeSelection",initialize:function(g,v){v=v||{},this._objects=g||[];for(var a=this._objects.length;a--;)this._objects[a].group=this;v.originX&&(this.originX=v.originX),v.originY&&(this.originY=v.originY),this._calcBounds(),this._updateObjectsCoords(),f.Object.prototype.initialize.call(this,v),this.setCoords()},toGroup:function(){var g=this._objects.concat();this._objects=[];var v=f.Object.prototype.toObject.call(this),a=new f.Group([]);if(delete v.type,a.set(v),g.forEach(function(_){_.canvas.remove(_),_.group=a}),a._objects=g,!this.canvas)return a;var c=this.canvas;return c.add(a),c._activeObject=a,a.setCoords(),a},onDeselect:function(){return this.destroy(),!1},toString:function(){return"#<fabric.ActiveSelection: ("+this.complexity()+")>"},shouldCache:function(){return!1},isOnACache:function(){return!1},_renderControls:function(g,v,a){g.save(),g.globalAlpha=this.isMoving?this.borderOpacityWhenMoving:1,this.callSuper("_renderControls",g,v),void 0===(a=a||{}).hasControls&&(a.hasControls=!1),a.forActiveSelection=!0;for(var c=0,_=this._objects.length;c<_;c++)this._objects[c]._renderControls(g,a);g.restore()}}),f.ActiveSelection.fromObject=function(g,v){f.util.enlivenObjects(g.objects,function(a){delete g.objects,v&&v(new f.ActiveSelection(a,g,!0))})})}(n),function(m){var f=S.util.object.extend;m.fabric||(m.fabric={}),m.fabric.Image?S.warn("fabric.Image is already defined."):(S.Image=S.util.createClass(S.Object,{type:"image",strokeWidth:0,srcFromAttribute:!1,_lastScaleX:1,_lastScaleY:1,_filterScalingX:1,_filterScalingY:1,minimumScaleTrigger:.5,stateProperties:S.Object.prototype.stateProperties.concat("cropX","cropY"),cacheProperties:S.Object.prototype.cacheProperties.concat("cropX","cropY"),cacheKey:"",cropX:0,cropY:0,imageSmoothing:!0,initialize:function(g,v){v||(v={}),this.filters=[],this.cacheKey="texture"+S.Object.__uid++,this.callSuper("initialize",v),this._initElement(g,v)},getElement:function(){return this._element||{}},setElement:function(g,v){return this.removeTexture(this.cacheKey),this.removeTexture(this.cacheKey+"_filtered"),this._element=g,this._originalElement=g,this._initConfig(v),0!==this.filters.length&&this.applyFilters(),this.resizeFilter&&this.applyResizeFilters(),this},removeTexture:function(g){var v=S.filterBackend;v&&v.evictCachesForKey&&v.evictCachesForKey(g)},dispose:function(){this.callSuper("dispose"),this.removeTexture(this.cacheKey),this.removeTexture(this.cacheKey+"_filtered"),this._cacheContext=void 0,["_originalElement","_element","_filteredEl","_cacheCanvas"].forEach(function(g){S.util.cleanUpJsdomNode(this[g]),this[g]=void 0}.bind(this))},getCrossOrigin:function(){return this._originalElement&&(this._originalElement.crossOrigin||null)},getOriginalSize:function(){var g=this.getElement();return{width:g.naturalWidth||g.width,height:g.naturalHeight||g.height}},_stroke:function(g){if(this.stroke&&0!==this.strokeWidth){var v=this.width/2,a=this.height/2;g.beginPath(),g.moveTo(-v,-a),g.lineTo(v,-a),g.lineTo(v,a),g.lineTo(-v,a),g.lineTo(-v,-a),g.closePath()}},toObject:function(g){var v=[];this.filters.forEach(function(c){c&&v.push(c.toObject())});var a=f(this.callSuper("toObject",["cropX","cropY"].concat(g)),{src:this.getSrc(),crossOrigin:this.getCrossOrigin(),filters:v});return this.resizeFilter&&(a.resizeFilter=this.resizeFilter.toObject()),a},hasCrop:function(){return this.cropX||this.cropY||this.width<this._element.width||this.height<this._element.height},_toSVG:function(){var g,v=[],a=[],c=this._element,_=-this.width/2,I=-this.height/2,y="",w="";if(!c)return[];if(this.hasCrop()){var b=S.Object.__uid++;v.push('<clipPath id="imageCrop_'+b+'">\n','\t<rect x="'+_+'" y="'+I+'" width="'+this.width+'" height="'+this.height+'" />\n',"</clipPath>\n"),y=' clip-path="url(#imageCrop_'+b+')" '}if(this.imageSmoothing||(w='" image-rendering="optimizeSpeed'),a.push("\t<image ","COMMON_PARTS",'xlink:href="',this.getSvgSrc(!0),'" x="',_-this.cropX,'" y="',I-this.cropY,'" width="',c.width||c.naturalWidth,'" height="',c.height||c.height,w,'"',y,"></image>\n"),this.stroke||this.strokeDashArray){var x=this.fill;this.fill=null,g=["\t<rect ",'x="',_,'" y="',I,'" width="',this.width,'" height="',this.height,'" style="',this.getSvgStyles(),'"/>\n'],this.fill=x}return"fill"!==this.paintFirst?v.concat(g,a):v.concat(a,g)},getSrc:function(g){var v=g?this._element:this._originalElement;return v?v.toDataURL?v.toDataURL():this.srcFromAttribute?v.getAttribute("src"):v.src:this.src||""},setSrc:function(g,v,a){return S.util.loadImage(g,function(c,_){this.setElement(c,a),this._setWidthHeight(),v&&v(this,_)},this,a&&a.crossOrigin),this},toString:function(){return'#<fabric.Image: { src: "'+this.getSrc()+'" }>'},applyResizeFilters:function(){var g=this.resizeFilter,v=this.minimumScaleTrigger,a=this.getTotalObjectScaling(),c=a.scaleX,_=a.scaleY,I=this._filteredEl||this._originalElement;if(this.group&&this.set("dirty",!0),!g||c>v&&_>v)return this._element=I,this._filterScalingX=1,this._filterScalingY=1,this._lastScaleX=c,void(this._lastScaleY=_);S.filterBackend||(S.filterBackend=S.initFilterBackend());var y=S.util.createCanvasElement(),w=this._filteredEl?this.cacheKey+"_filtered":this.cacheKey,b=I.width,x=I.height;y.width=b,y.height=x,this._element=y,this._lastScaleX=g.scaleX=c,this._lastScaleY=g.scaleY=_,S.filterBackend.applyFilters([g],I,b,x,this._element,w),this._filterScalingX=y.width/this._originalElement.width,this._filterScalingY=y.height/this._originalElement.height},applyFilters:function(g){if(g=(g=g||this.filters||[]).filter(function(I){return I&&!I.isNeutralState()}),this.set("dirty",!0),this.removeTexture(this.cacheKey+"_filtered"),0===g.length)return this._element=this._originalElement,this._filteredEl=null,this._filterScalingX=1,this._filterScalingY=1,this;var v=this._originalElement,a=v.naturalWidth||v.width,c=v.naturalHeight||v.height;if(this._element===this._originalElement){var _=S.util.createCanvasElement();_.width=a,_.height=c,this._element=_,this._filteredEl=_}else this._element=this._filteredEl,this._filteredEl.getContext("2d").clearRect(0,0,a,c),this._lastScaleX=1,this._lastScaleY=1;return S.filterBackend||(S.filterBackend=S.initFilterBackend()),S.filterBackend.applyFilters(g,this._originalElement,a,c,this._element,this.cacheKey),this._originalElement.width===this._element.width&&this._originalElement.height===this._element.height||(this._filterScalingX=this._element.width/this._originalElement.width,this._filterScalingY=this._element.height/this._originalElement.height),this},_render:function(g){S.util.setImageSmoothing(g,this.imageSmoothing),!0!==this.isMoving&&this.resizeFilter&&this._needsResize()&&this.applyResizeFilters(),this._stroke(g),this._renderPaintInOrder(g)},drawCacheOnCanvas:function(g){S.util.setImageSmoothing(g,this.imageSmoothing),S.Object.prototype.drawCacheOnCanvas.call(this,g)},shouldCache:function(){return this.needsItsOwnCache()},_renderFill:function(g){var v=this._element;if(v){var a=this._filterScalingX,c=this._filterScalingY,_=this.width,I=this.height,y=Math.min,w=Math.max,b=w(this.cropX,0),x=w(this.cropY,0),O=v.naturalWidth||v.width,F=v.naturalHeight||v.height,L=b*a,N=x*c,j=y(_*a,O-L),$=y(I*c,F-N),X=-_/2,ie=-I/2,ee=y(_,O/a-b),Q=y(I,F/c-x);v&&g.drawImage(v,L,N,j,$,X,ie,ee,Q)}},_needsResize:function(){var g=this.getTotalObjectScaling();return g.scaleX!==this._lastScaleX||g.scaleY!==this._lastScaleY},_resetWidthHeight:function(){this.set(this.getOriginalSize())},_initElement:function(g,v){this.setElement(S.util.getById(g),v),S.util.addClass(this.getElement(),S.Image.CSS_CANVAS)},_initConfig:function(g){g||(g={}),this.setOptions(g),this._setWidthHeight(g)},_initFilters:function(g,v){g&&g.length?S.util.enlivenObjects(g,function(a){v&&v(a)},"fabric.Image.filters"):v&&v()},_setWidthHeight:function(g){g||(g={});var v=this.getElement();this.width=g.width||v.naturalWidth||v.width||0,this.height=g.height||v.naturalHeight||v.height||0},parsePreserveAspectRatioAttribute:function(){var g,v=S.util.parsePreserveAspectRatioAttribute(this.preserveAspectRatio||""),a=this._element.width,c=this._element.height,_=1,I=1,y=0,w=0,b=0,x=0,O=this.width,F=this.height,L={width:O,height:F};return!v||"none"===v.alignX&&"none"===v.alignY?(_=O/a,I=F/c):("meet"===v.meetOrSlice&&(g=(O-a*(_=I=S.util.findScaleToFit(this._element,L)))/2,"Min"===v.alignX&&(y=-g),"Max"===v.alignX&&(y=g),g=(F-c*I)/2,"Min"===v.alignY&&(w=-g),"Max"===v.alignY&&(w=g)),"slice"===v.meetOrSlice&&(g=a-O/(_=I=S.util.findScaleToCover(this._element,L)),"Mid"===v.alignX&&(b=g/2),"Max"===v.alignX&&(b=g),g=c-F/I,"Mid"===v.alignY&&(x=g/2),"Max"===v.alignY&&(x=g),a=O/_,c=F/I)),{width:a,height:c,scaleX:_,scaleY:I,offsetLeft:y,offsetTop:w,cropX:b,cropY:x}}}),S.Image.CSS_CANVAS="canvas-img",S.Image.prototype.getSvgSrc=S.Image.prototype.getSrc,S.Image.fromObject=function(g,v){var a=S.util.object.clone(g);S.util.loadImage(a.src,function(c,_){_?v&&v(null,!0):S.Image.prototype._initFilters.call(a,a.filters,function(I){a.filters=I||[],S.Image.prototype._initFilters.call(a,[a.resizeFilter],function(y){a.resizeFilter=y[0],S.util.enlivenObjectEnlivables(a,a,function(){var w=new S.Image(c,a);v(w,!1)})})})},null,a.crossOrigin)},S.Image.fromURL=function(g,v,a){S.util.loadImage(g,function(c,_){v&&v(new S.Image(c,a),_)},null,a&&a.crossOrigin)},S.Image.ATTRIBUTE_NAMES=S.SHARED_ATTRIBUTES.concat("x y width height preserveAspectRatio xlink:href crossOrigin image-rendering".split(" ")),S.Image.fromElement=function(g,v,a){var c=S.parseAttributes(g,S.Image.ATTRIBUTE_NAMES);S.Image.fromURL(c["xlink:href"],v,f(a?S.util.object.clone(a):{},c))})}(n),S.util.object.extend(S.Object.prototype,{_getAngleValueForStraighten:function(){var m=this.angle%360;return m>0?90*Math.round((m-1)/90):90*Math.round(m/90)},straighten:function(){return this.rotate(this._getAngleValueForStraighten())},fxStraighten:function(m){var f=function(){},g=(m=m||{}).onComplete||f,v=m.onChange||f,a=this;return S.util.animate({target:this,startValue:this.get("angle"),endValue:this._getAngleValueForStraighten(),duration:this.FX_DURATION,onChange:function(c){a.rotate(c),v()},onComplete:function(){a.setCoords(),g()}})}}),S.util.object.extend(S.StaticCanvas.prototype,{straightenObject:function(m){return m.straighten(),this.requestRenderAll(),this},fxStraightenObject:function(m){return m.fxStraighten({onChange:this.requestRenderAllBound})}}),function(){function m(g,v){var a="precision "+v+" float;\nvoid main(){}",c=g.createShader(g.FRAGMENT_SHADER);return g.shaderSource(c,a),g.compileShader(c),!!g.getShaderParameter(c,g.COMPILE_STATUS)}function f(g){g&&g.tileSize&&(this.tileSize=g.tileSize),this.setupGLContext(this.tileSize,this.tileSize),this.captureGPUInfo()}S.isWebglSupported=function(g){if(S.isLikelyNode)return!1;g=g||S.WebglFilterBackend.prototype.tileSize;var v=document.createElement("canvas"),a=v.getContext("webgl")||v.getContext("experimental-webgl"),c=!1;if(a){S.maxTextureSize=a.getParameter(a.MAX_TEXTURE_SIZE),c=S.maxTextureSize>=g;for(var _=["highp","mediump","lowp"],I=0;I<3;I++)if(m(a,_[I])){S.webGlPrecision=_[I];break}}return this.isSupported=c,c},S.WebglFilterBackend=f,f.prototype={tileSize:2048,resources:{},setupGLContext:function(g,v){this.dispose(),this.createWebGLCanvas(g,v),this.aPosition=new Float32Array([0,0,0,1,1,0,1,1]),this.chooseFastestCopyGLTo2DMethod(g,v)},chooseFastestCopyGLTo2DMethod:function(g,v){var a,c=void 0!==window.performance;try{new ImageData(1,1),a=!0}catch{a=!1}var _=typeof ArrayBuffer<"u",I=typeof Uint8ClampedArray<"u";if(c&&a&&_&&I){var y=S.util.createCanvasElement(),w=new ArrayBuffer(g*v*4);if(S.forceGLPutImageData)return this.imageBuffer=w,void(this.copyGLTo2D=nt);var b,x,O={imageBuffer:w,destinationWidth:g,destinationHeight:v,targetCanvas:y};y.width=g,y.height=v,b=window.performance.now(),Me.call(O,this.gl,O),x=window.performance.now()-b,b=window.performance.now(),nt.call(O,this.gl,O),x>window.performance.now()-b?(this.imageBuffer=w,this.copyGLTo2D=nt):this.copyGLTo2D=Me}},createWebGLCanvas:function(g,v){var a=S.util.createCanvasElement();a.width=g,a.height=v;var c={alpha:!0,premultipliedAlpha:!1,depth:!1,stencil:!1,antialias:!1},_=a.getContext("webgl",c);_||(_=a.getContext("experimental-webgl",c)),_&&(_.clearColor(0,0,0,0),this.canvas=a,this.gl=_)},applyFilters:function(g,v,a,c,_,I){var y,w=this.gl;I&&(y=this.getCachedTexture(I,v));var O,F,j,$,b={originalWidth:v.width||v.originalWidth,originalHeight:v.height||v.originalHeight,sourceWidth:a,sourceHeight:c,destinationWidth:a,destinationHeight:c,context:w,sourceTexture:this.createTexture(w,a,c,!y&&v),targetTexture:this.createTexture(w,a,c),originalTexture:y||this.createTexture(w,a,c,!y&&v),passes:g.length,webgl:!0,aPosition:this.aPosition,programCache:this.programCache,pass:0,filterBackend:this,targetCanvas:_},x=w.createFramebuffer();return w.bindFramebuffer(w.FRAMEBUFFER,x),g.forEach(function(O){O&&O.applyTo(b)}),$=(O=b).destinationHeight,(F=O.targetCanvas).width===(j=O.destinationWidth)&&F.height===$||(F.width=j,F.height=$),this.copyGLTo2D(w,b),w.bindTexture(w.TEXTURE_2D,null),w.deleteTexture(b.sourceTexture),w.deleteTexture(b.targetTexture),w.deleteFramebuffer(x),_.getContext("2d").setTransform(1,0,0,1,0,0),b},dispose:function(){this.canvas&&(this.canvas=null,this.gl=null),this.clearWebGLCaches()},clearWebGLCaches:function(){this.programCache={},this.textureCache={}},createTexture:function(g,v,a,c){var _=g.createTexture();return g.bindTexture(g.TEXTURE_2D,_),g.texParameteri(g.TEXTURE_2D,g.TEXTURE_MAG_FILTER,g.NEAREST),g.texParameteri(g.TEXTURE_2D,g.TEXTURE_MIN_FILTER,g.NEAREST),g.texParameteri(g.TEXTURE_2D,g.TEXTURE_WRAP_S,g.CLAMP_TO_EDGE),g.texParameteri(g.TEXTURE_2D,g.TEXTURE_WRAP_T,g.CLAMP_TO_EDGE),c?g.texImage2D(g.TEXTURE_2D,0,g.RGBA,g.RGBA,g.UNSIGNED_BYTE,c):g.texImage2D(g.TEXTURE_2D,0,g.RGBA,v,a,0,g.RGBA,g.UNSIGNED_BYTE,null),_},getCachedTexture:function(g,v){if(this.textureCache[g])return this.textureCache[g];var a=this.createTexture(this.gl,v.width,v.height,v);return this.textureCache[g]=a,a},evictCachesForKey:function(g){this.textureCache[g]&&(this.gl.deleteTexture(this.textureCache[g]),delete this.textureCache[g])},copyGLTo2D:Me,captureGPUInfo:function(){if(this.gpuInfo)return this.gpuInfo;var g=this.gl,v={renderer:"",vendor:""};if(!g)return v;var a=g.getExtension("WEBGL_debug_renderer_info");if(a){var c=g.getParameter(a.UNMASKED_RENDERER_WEBGL),_=g.getParameter(a.UNMASKED_VENDOR_WEBGL);c&&(v.renderer=c.toLowerCase()),_&&(v.vendor=_.toLowerCase())}return this.gpuInfo=v,v}}}(),function(){var m=function(){};function f(){}S.Canvas2dFilterBackend=f,f.prototype={evictCachesForKey:m,dispose:m,clearWebGLCaches:m,resources:{},applyFilters:function(g,v,a,c,_){var I=_.getContext("2d");I.drawImage(v,0,0,a,c);var y={sourceWidth:a,sourceHeight:c,imageData:I.getImageData(0,0,a,c),originalEl:v,originalImageData:I.getImageData(0,0,a,c),canvasEl:_,ctx:I,filterBackend:this};return g.forEach(function(w){w.applyTo(y)}),y.imageData.width===a&&y.imageData.height===c||(_.width=y.imageData.width,_.height=y.imageData.height),I.putImageData(y.imageData,0,0),y}}}(),S.Image=S.Image||{},S.Image.filters=S.Image.filters||{},S.Image.filters.BaseFilter=S.util.createClass({type:"BaseFilter",vertexSource:"attribute vec2 aPosition;\nvarying vec2 vTexCoord;\nvoid main() {\nvTexCoord = aPosition;\ngl_Position = vec4(aPosition * 2.0 - 1.0, 0.0, 1.0);\n}",fragmentSource:"precision highp float;\nvarying vec2 vTexCoord;\nuniform sampler2D uTexture;\nvoid main() {\ngl_FragColor = texture2D(uTexture, vTexCoord);\n}",initialize:function(m){m&&this.setOptions(m)},setOptions:function(m){for(var f in m)this[f]=m[f]},createProgram:function(m,f,g){f=f||this.fragmentSource,g=g||this.vertexSource,"highp"!==S.webGlPrecision&&(f=f.replace(/precision highp float/g,"precision "+S.webGlPrecision+" float"));var v=m.createShader(m.VERTEX_SHADER);if(m.shaderSource(v,g),m.compileShader(v),!m.getShaderParameter(v,m.COMPILE_STATUS))throw new Error("Vertex shader compile error for "+this.type+": "+m.getShaderInfoLog(v));var a=m.createShader(m.FRAGMENT_SHADER);if(m.shaderSource(a,f),m.compileShader(a),!m.getShaderParameter(a,m.COMPILE_STATUS))throw new Error("Fragment shader compile error for "+this.type+": "+m.getShaderInfoLog(a));var c=m.createProgram();if(m.attachShader(c,v),m.attachShader(c,a),m.linkProgram(c),!m.getProgramParameter(c,m.LINK_STATUS))throw new Error('Shader link error for "${this.type}" '+m.getProgramInfoLog(c));var _=this.getAttributeLocations(m,c),I=this.getUniformLocations(m,c)||{};return I.uStepW=m.getUniformLocation(c,"uStepW"),I.uStepH=m.getUniformLocation(c,"uStepH"),{program:c,attributeLocations:_,uniformLocations:I}},getAttributeLocations:function(m,f){return{aPosition:m.getAttribLocation(f,"aPosition")}},getUniformLocations:function(){return{}},sendAttributeData:function(m,f,g){var v=f.aPosition,a=m.createBuffer();m.bindBuffer(m.ARRAY_BUFFER,a),m.enableVertexAttribArray(v),m.vertexAttribPointer(v,2,m.FLOAT,!1,0,0),m.bufferData(m.ARRAY_BUFFER,g,m.STATIC_DRAW)},_setupFrameBuffer:function(m){var f,g,v=m.context;m.passes>1?(g=m.destinationHeight,m.sourceWidth===(f=m.destinationWidth)&&m.sourceHeight===g||(v.deleteTexture(m.targetTexture),m.targetTexture=m.filterBackend.createTexture(v,f,g)),v.framebufferTexture2D(v.FRAMEBUFFER,v.COLOR_ATTACHMENT0,v.TEXTURE_2D,m.targetTexture,0)):(v.bindFramebuffer(v.FRAMEBUFFER,null),v.finish())},_swapTextures:function(m){m.passes--,m.pass++;var f=m.targetTexture;m.targetTexture=m.sourceTexture,m.sourceTexture=f},isNeutralState:function(){var m=this.mainParameter,f=S.Image.filters[this.type].prototype;if(m){if(Array.isArray(f[m])){for(var g=f[m].length;g--;)if(this[m][g]!==f[m][g])return!1;return!0}return f[m]===this[m]}return!1},applyTo:function(m){m.webgl?(this._setupFrameBuffer(m),this.applyToWebGL(m),this._swapTextures(m)):this.applyTo2d(m)},retrieveShader:function(m){return m.programCache.hasOwnProperty(this.type)||(m.programCache[this.type]=this.createProgram(m.context)),m.programCache[this.type]},applyToWebGL:function(m){var f=m.context,g=this.retrieveShader(m);f.bindTexture(f.TEXTURE_2D,0===m.pass&&m.originalTexture?m.originalTexture:m.sourceTexture),f.useProgram(g.program),this.sendAttributeData(f,g.attributeLocations,m.aPosition),f.uniform1f(g.uniformLocations.uStepW,1/m.sourceWidth),f.uniform1f(g.uniformLocations.uStepH,1/m.sourceHeight),this.sendUniformData(f,g.uniformLocations),f.viewport(0,0,m.destinationWidth,m.destinationHeight),f.drawArrays(f.TRIANGLE_STRIP,0,4)},bindAdditionalTexture:function(m,f,g){m.activeTexture(g),m.bindTexture(m.TEXTURE_2D,f),m.activeTexture(m.TEXTURE0)},unbindAdditionalTexture:function(m,f){m.activeTexture(f),m.bindTexture(m.TEXTURE_2D,null),m.activeTexture(m.TEXTURE0)},getMainParameter:function(){return this[this.mainParameter]},setMainParameter:function(m){this[this.mainParameter]=m},sendUniformData:function(){},createHelpLayer:function(m){if(!m.helpLayer){var f=document.createElement("canvas");f.width=m.sourceWidth,f.height=m.sourceHeight,m.helpLayer=f}},toObject:function(){var m={type:this.type},f=this.mainParameter;return f&&(m[f]=this[f]),m},toJSON:function(){return this.toObject()}}),S.Image.filters.BaseFilter.fromObject=function(m,f){var g=new S.Image.filters[m.type](m);return f&&f(g),g},function(m){var f=m.fabric||(m.fabric={}),g=f.Image.filters;g.ColorMatrix=(0,f.util.createClass)(g.BaseFilter,{type:"ColorMatrix",fragmentSource:"precision highp float;\nuniform sampler2D uTexture;\nvarying vec2 vTexCoord;\nuniform mat4 uColorMatrix;\nuniform vec4 uConstants;\nvoid main() {\nvec4 color = texture2D(uTexture, vTexCoord);\ncolor *= uColorMatrix;\ncolor += uConstants;\ngl_FragColor = color;\n}",matrix:[1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0],mainParameter:"matrix",colorsOnly:!0,initialize:function(a){this.callSuper("initialize",a),this.matrix=this.matrix.slice(0)},applyTo2d:function(a){var c,_,I,y,w,b=a.imageData.data,x=b.length,O=this.matrix,F=this.colorsOnly;for(w=0;w<x;w+=4)c=b[w],_=b[w+1],I=b[w+2],F?(b[w]=c*O[0]+_*O[1]+I*O[2]+255*O[4],b[w+1]=c*O[5]+_*O[6]+I*O[7]+255*O[9],b[w+2]=c*O[10]+_*O[11]+I*O[12]+255*O[14]):(b[w]=c*O[0]+_*O[1]+I*O[2]+(y=b[w+3])*O[3]+255*O[4],b[w+1]=c*O[5]+_*O[6]+I*O[7]+y*O[8]+255*O[9],b[w+2]=c*O[10]+_*O[11]+I*O[12]+y*O[13]+255*O[14],b[w+3]=c*O[15]+_*O[16]+I*O[17]+y*O[18]+255*O[19])},getUniformLocations:function(a,c){return{uColorMatrix:a.getUniformLocation(c,"uColorMatrix"),uConstants:a.getUniformLocation(c,"uConstants")}},sendUniformData:function(a,c){var _=this.matrix,y=[_[4],_[9],_[14],_[19]];a.uniformMatrix4fv(c.uColorMatrix,!1,[_[0],_[1],_[2],_[3],_[5],_[6],_[7],_[8],_[10],_[11],_[12],_[13],_[15],_[16],_[17],_[18]]),a.uniform4fv(c.uConstants,y)}}),f.Image.filters.ColorMatrix.fromObject=f.Image.filters.BaseFilter.fromObject}(n),function(m){var f=m.fabric||(m.fabric={}),g=f.Image.filters;g.Brightness=(0,f.util.createClass)(g.BaseFilter,{type:"Brightness",fragmentSource:"precision highp float;\nuniform sampler2D uTexture;\nuniform float uBrightness;\nvarying vec2 vTexCoord;\nvoid main() {\nvec4 color = texture2D(uTexture, vTexCoord);\ncolor.rgb += uBrightness;\ngl_FragColor = color;\n}",brightness:0,mainParameter:"brightness",applyTo2d:function(a){if(0!==this.brightness){var c,_=a.imageData.data,I=_.length,y=Math.round(255*this.brightness);for(c=0;c<I;c+=4)_[c]=_[c]+y,_[c+1]=_[c+1]+y,_[c+2]=_[c+2]+y}},getUniformLocations:function(a,c){return{uBrightness:a.getUniformLocation(c,"uBrightness")}},sendUniformData:function(a,c){a.uniform1f(c.uBrightness,this.brightness)}}),f.Image.filters.Brightness.fromObject=f.Image.filters.BaseFilter.fromObject}(n),function(m){var f=m.fabric||(m.fabric={}),g=f.util.object.extend,v=f.Image.filters;v.Convolute=(0,f.util.createClass)(v.BaseFilter,{type:"Convolute",opaque:!1,matrix:[0,0,0,0,1,0,0,0,0],fragmentSource:{Convolute_3_1:"precision highp float;\nuniform sampler2D uTexture;\nuniform float uMatrix[9];\nuniform float uStepW;\nuniform float uStepH;\nvarying vec2 vTexCoord;\nvoid main() {\nvec4 color = vec4(0, 0, 0, 0);\nfor (float h = 0.0; h < 3.0; h+=1.0) {\nfor (float w = 0.0; w < 3.0; w+=1.0) {\nvec2 matrixPos = vec2(uStepW * (w - 1), uStepH * (h - 1));\ncolor += texture2D(uTexture, vTexCoord + matrixPos) * uMatrix[int(h * 3.0 + w)];\n}\n}\ngl_FragColor = color;\n}",Convolute_3_0:"precision highp float;\nuniform sampler2D uTexture;\nuniform float uMatrix[9];\nuniform float uStepW;\nuniform float uStepH;\nvarying vec2 vTexCoord;\nvoid main() {\nvec4 color = vec4(0, 0, 0, 1);\nfor (float h = 0.0; h < 3.0; h+=1.0) {\nfor (float w = 0.0; w < 3.0; w+=1.0) {\nvec2 matrixPos = vec2(uStepW * (w - 1.0), uStepH * (h - 1.0));\ncolor.rgb += texture2D(uTexture, vTexCoord + matrixPos).rgb * uMatrix[int(h * 3.0 + w)];\n}\n}\nfloat alpha = texture2D(uTexture, vTexCoord).a;\ngl_FragColor = color;\ngl_FragColor.a = alpha;\n}",Convolute_5_1:"precision highp float;\nuniform sampler2D uTexture;\nuniform float uMatrix[25];\nuniform float uStepW;\nuniform float uStepH;\nvarying vec2 vTexCoord;\nvoid main() {\nvec4 color = vec4(0, 0, 0, 0);\nfor (float h = 0.0; h < 5.0; h+=1.0) {\nfor (float w = 0.0; w < 5.0; w+=1.0) {\nvec2 matrixPos = vec2(uStepW * (w - 2.0), uStepH * (h - 2.0));\ncolor += texture2D(uTexture, vTexCoord + matrixPos) * uMatrix[int(h * 5.0 + w)];\n}\n}\ngl_FragColor = color;\n}",Convolute_5_0:"precision highp float;\nuniform sampler2D uTexture;\nuniform float uMatrix[25];\nuniform float uStepW;\nuniform float uStepH;\nvarying vec2 vTexCoord;\nvoid main() {\nvec4 color = vec4(0, 0, 0, 1);\nfor (float h = 0.0; h < 5.0; h+=1.0) {\nfor (float w = 0.0; w < 5.0; w+=1.0) {\nvec2 matrixPos = vec2(uStepW * (w - 2.0), uStepH * (h - 2.0));\ncolor.rgb += texture2D(uTexture, vTexCoord + matrixPos).rgb * uMatrix[int(h * 5.0 + w)];\n}\n}\nfloat alpha = texture2D(uTexture, vTexCoord).a;\ngl_FragColor = color;\ngl_FragColor.a = alpha;\n}",Convolute_7_1:"precision highp float;\nuniform sampler2D uTexture;\nuniform float uMatrix[49];\nuniform float uStepW;\nuniform float uStepH;\nvarying vec2 vTexCoord;\nvoid main() {\nvec4 color = vec4(0, 0, 0, 0);\nfor (float h = 0.0; h < 7.0; h+=1.0) {\nfor (float w = 0.0; w < 7.0; w+=1.0) {\nvec2 matrixPos = vec2(uStepW * (w - 3.0), uStepH * (h - 3.0));\ncolor += texture2D(uTexture, vTexCoord + matrixPos) * uMatrix[int(h * 7.0 + w)];\n}\n}\ngl_FragColor = color;\n}",Convolute_7_0:"precision highp float;\nuniform sampler2D uTexture;\nuniform float uMatrix[49];\nuniform float uStepW;\nuniform float uStepH;\nvarying vec2 vTexCoord;\nvoid main() {\nvec4 color = vec4(0, 0, 0, 1);\nfor (float h = 0.0; h < 7.0; h+=1.0) {\nfor (float w = 0.0; w < 7.0; w+=1.0) {\nvec2 matrixPos = vec2(uStepW * (w - 3.0), uStepH * (h - 3.0));\ncolor.rgb += texture2D(uTexture, vTexCoord + matrixPos).rgb * uMatrix[int(h * 7.0 + w)];\n}\n}\nfloat alpha = texture2D(uTexture, vTexCoord).a;\ngl_FragColor = color;\ngl_FragColor.a = alpha;\n}",Convolute_9_1:"precision highp float;\nuniform sampler2D uTexture;\nuniform float uMatrix[81];\nuniform float uStepW;\nuniform float uStepH;\nvarying vec2 vTexCoord;\nvoid main() {\nvec4 color = vec4(0, 0, 0, 0);\nfor (float h = 0.0; h < 9.0; h+=1.0) {\nfor (float w = 0.0; w < 9.0; w+=1.0) {\nvec2 matrixPos = vec2(uStepW * (w - 4.0), uStepH * (h - 4.0));\ncolor += texture2D(uTexture, vTexCoord + matrixPos) * uMatrix[int(h * 9.0 + w)];\n}\n}\ngl_FragColor = color;\n}",Convolute_9_0:"precision highp float;\nuniform sampler2D uTexture;\nuniform float uMatrix[81];\nuniform float uStepW;\nuniform float uStepH;\nvarying vec2 vTexCoord;\nvoid main() {\nvec4 color = vec4(0, 0, 0, 1);\nfor (float h = 0.0; h < 9.0; h+=1.0) {\nfor (float w = 0.0; w < 9.0; w+=1.0) {\nvec2 matrixPos = vec2(uStepW * (w - 4.0), uStepH * (h - 4.0));\ncolor.rgb += texture2D(uTexture, vTexCoord + matrixPos).rgb * uMatrix[int(h * 9.0 + w)];\n}\n}\nfloat alpha = texture2D(uTexture, vTexCoord).a;\ngl_FragColor = color;\ngl_FragColor.a = alpha;\n}"},retrieveShader:function(c){var _=Math.sqrt(this.matrix.length),I=this.type+"_"+_+"_"+(this.opaque?1:0),y=this.fragmentSource[I];return c.programCache.hasOwnProperty(I)||(c.programCache[I]=this.createProgram(c.context,y)),c.programCache[I]},applyTo2d:function(c){var _,I,y,w,b,x,O,F,L,N,j,$,X,ie=c.imageData,ee=ie.data,Q=this.matrix,W=Math.round(Math.sqrt(Q.length)),H=Math.floor(W/2),Z=ie.width,ne=ie.height,re=c.ctx.createImageData(Z,ne),z=re.data,Y=this.opaque?1:0;for(j=0;j<ne;j++)for(N=0;N<Z;N++){for(b=4*(j*Z+N),_=0,I=0,y=0,w=0,X=0;X<W;X++)for($=0;$<W;$++)x=N+$-H,(O=j+X-H)<0||O>=ne||x<0||x>=Z||(_+=ee[F=4*(O*Z+x)]*(L=Q[X*W+$]),I+=ee[F+1]*L,y+=ee[F+2]*L,Y||(w+=ee[F+3]*L));z[b]=_,z[b+1]=I,z[b+2]=y,z[b+3]=Y?ee[b+3]:w}c.imageData=re},getUniformLocations:function(c,_){return{uMatrix:c.getUniformLocation(_,"uMatrix"),uOpaque:c.getUniformLocation(_,"uOpaque"),uHalfSize:c.getUniformLocation(_,"uHalfSize"),uSize:c.getUniformLocation(_,"uSize")}},sendUniformData:function(c,_){c.uniform1fv(_.uMatrix,this.matrix)},toObject:function(){return g(this.callSuper("toObject"),{opaque:this.opaque,matrix:this.matrix})}}),f.Image.filters.Convolute.fromObject=f.Image.filters.BaseFilter.fromObject}(n),function(m){var f=m.fabric||(m.fabric={}),g=f.Image.filters;g.Grayscale=(0,f.util.createClass)(g.BaseFilter,{type:"Grayscale",fragmentSource:{average:"precision highp float;\nuniform sampler2D uTexture;\nvarying vec2 vTexCoord;\nvoid main() {\nvec4 color = texture2D(uTexture, vTexCoord);\nfloat average = (color.r + color.b + color.g) / 3.0;\ngl_FragColor = vec4(average, average, average, color.a);\n}",lightness:"precision highp float;\nuniform sampler2D uTexture;\nuniform int uMode;\nvarying vec2 vTexCoord;\nvoid main() {\nvec4 col = texture2D(uTexture, vTexCoord);\nfloat average = (max(max(col.r, col.g),col.b) + min(min(col.r, col.g),col.b)) / 2.0;\ngl_FragColor = vec4(average, average, average, col.a);\n}",luminosity:"precision highp float;\nuniform sampler2D uTexture;\nuniform int uMode;\nvarying vec2 vTexCoord;\nvoid main() {\nvec4 col = texture2D(uTexture, vTexCoord);\nfloat average = 0.21 * col.r + 0.72 * col.g + 0.07 * col.b;\ngl_FragColor = vec4(average, average, average, col.a);\n}"},mode:"average",mainParameter:"mode",applyTo2d:function(a){var c,_,I=a.imageData.data,y=I.length,w=this.mode;for(c=0;c<y;c+=4)"average"===w?_=(I[c]+I[c+1]+I[c+2])/3:"lightness"===w?_=(Math.min(I[c],I[c+1],I[c+2])+Math.max(I[c],I[c+1],I[c+2]))/2:"luminosity"===w&&(_=.21*I[c]+.72*I[c+1]+.07*I[c+2]),I[c]=_,I[c+1]=_,I[c+2]=_},retrieveShader:function(a){var c=this.type+"_"+this.mode;return a.programCache.hasOwnProperty(c)||(a.programCache[c]=this.createProgram(a.context,this.fragmentSource[this.mode])),a.programCache[c]},getUniformLocations:function(a,c){return{uMode:a.getUniformLocation(c,"uMode")}},sendUniformData:function(a,c){a.uniform1i(c.uMode,1)},isNeutralState:function(){return!1}}),f.Image.filters.Grayscale.fromObject=f.Image.filters.BaseFilter.fromObject}(n),function(m){var f=m.fabric||(m.fabric={}),g=f.Image.filters;g.Invert=(0,f.util.createClass)(g.BaseFilter,{type:"Invert",fragmentSource:"precision highp float;\nuniform sampler2D uTexture;\nuniform int uInvert;\nvarying vec2 vTexCoord;\nvoid main() {\nvec4 color = texture2D(uTexture, vTexCoord);\nif (uInvert == 1) {\ngl_FragColor = vec4(1.0 - color.r,1.0 -color.g,1.0 -color.b,color.a);\n} else {\ngl_FragColor = color;\n}\n}",invert:!0,mainParameter:"invert",applyTo2d:function(a){var c,_=a.imageData.data,I=_.length;for(c=0;c<I;c+=4)_[c]=255-_[c],_[c+1]=255-_[c+1],_[c+2]=255-_[c+2]},isNeutralState:function(){return!this.invert},getUniformLocations:function(a,c){return{uInvert:a.getUniformLocation(c,"uInvert")}},sendUniformData:function(a,c){a.uniform1i(c.uInvert,this.invert)}}),f.Image.filters.Invert.fromObject=f.Image.filters.BaseFilter.fromObject}(n),function(m){var f=m.fabric||(m.fabric={}),g=f.util.object.extend,v=f.Image.filters;v.Noise=(0,f.util.createClass)(v.BaseFilter,{type:"Noise",fragmentSource:"precision highp float;\nuniform sampler2D uTexture;\nuniform float uStepH;\nuniform float uNoise;\nuniform float uSeed;\nvarying vec2 vTexCoord;\nfloat rand(vec2 co, float seed, float vScale) {\nreturn fract(sin(dot(co.xy * vScale ,vec2(12.9898 , 78.233))) * 43758.5453 * (seed + 0.01) / 2.0);\n}\nvoid main() {\nvec4 color = texture2D(uTexture, vTexCoord);\ncolor.rgb += (0.5 - rand(vTexCoord, uSeed, 0.1 / uStepH)) * uNoise;\ngl_FragColor = color;\n}",mainParameter:"noise",noise:0,applyTo2d:function(c){if(0!==this.noise){var _,I,w,y=c.imageData.data,b=this.noise;for(_=0,w=y.length;_<w;_+=4)I=(.5-Math.random())*b,y[_]+=I,y[_+1]+=I,y[_+2]+=I}},getUniformLocations:function(c,_){return{uNoise:c.getUniformLocation(_,"uNoise"),uSeed:c.getUniformLocation(_,"uSeed")}},sendUniformData:function(c,_){c.uniform1f(_.uNoise,this.noise/255),c.uniform1f(_.uSeed,Math.random())},toObject:function(){return g(this.callSuper("toObject"),{noise:this.noise})}}),f.Image.filters.Noise.fromObject=f.Image.filters.BaseFilter.fromObject}(n),function(m){var f=m.fabric||(m.fabric={}),g=f.Image.filters;g.Pixelate=(0,f.util.createClass)(g.BaseFilter,{type:"Pixelate",blocksize:4,mainParameter:"blocksize",fragmentSource:"precision highp float;\nuniform sampler2D uTexture;\nuniform float uBlocksize;\nuniform float uStepW;\nuniform float uStepH;\nvarying vec2 vTexCoord;\nvoid main() {\nfloat blockW = uBlocksize * uStepW;\nfloat blockH = uBlocksize * uStepW;\nint posX = int(vTexCoord.x / blockW);\nint posY = int(vTexCoord.y / blockH);\nfloat fposX = float(posX);\nfloat fposY = float(posY);\nvec2 squareCoords = vec2(fposX * blockW, fposY * blockH);\nvec4 color = texture2D(uTexture, squareCoords);\ngl_FragColor = color;\n}",applyTo2d:function(a){var c,_,I,y,w,b,x,O,F,L,N,j=a.imageData,$=j.data,X=j.height,ie=j.width;for(_=0;_<X;_+=this.blocksize)for(I=0;I<ie;I+=this.blocksize)for(y=$[c=4*_*ie+4*I],w=$[c+1],b=$[c+2],x=$[c+3],L=Math.min(_+this.blocksize,X),N=Math.min(I+this.blocksize,ie),O=_;O<L;O++)for(F=I;F<N;F++)$[c=4*O*ie+4*F]=y,$[c+1]=w,$[c+2]=b,$[c+3]=x},isNeutralState:function(){return 1===this.blocksize},getUniformLocations:function(a,c){return{uBlocksize:a.getUniformLocation(c,"uBlocksize"),uStepW:a.getUniformLocation(c,"uStepW"),uStepH:a.getUniformLocation(c,"uStepH")}},sendUniformData:function(a,c){a.uniform1f(c.uBlocksize,this.blocksize)}}),f.Image.filters.Pixelate.fromObject=f.Image.filters.BaseFilter.fromObject}(n),function(m){var f=m.fabric||(m.fabric={}),g=f.util.object.extend,v=f.Image.filters;v.RemoveColor=(0,f.util.createClass)(v.BaseFilter,{type:"RemoveColor",color:"#FFFFFF",fragmentSource:"precision highp float;\nuniform sampler2D uTexture;\nuniform vec4 uLow;\nuniform vec4 uHigh;\nvarying vec2 vTexCoord;\nvoid main() {\ngl_FragColor = texture2D(uTexture, vTexCoord);\nif(all(greaterThan(gl_FragColor.rgb,uLow.rgb)) && all(greaterThan(uHigh.rgb,gl_FragColor.rgb))) {\ngl_FragColor.a = 0.0;\n}\n}",distance:.02,useAlpha:!1,applyTo2d:function(c){var _,I,y,w,b=c.imageData.data,x=255*this.distance,O=new f.Color(this.color).getSource(),F=[O[0]-x,O[1]-x,O[2]-x],L=[O[0]+x,O[1]+x,O[2]+x];for(_=0;_<b.length;_+=4)y=b[_+1],w=b[_+2],(I=b[_])>F[0]&&y>F[1]&&w>F[2]&&I<L[0]&&y<L[1]&&w<L[2]&&(b[_+3]=0)},getUniformLocations:function(c,_){return{uLow:c.getUniformLocation(_,"uLow"),uHigh:c.getUniformLocation(_,"uHigh")}},sendUniformData:function(c,_){var I=new f.Color(this.color).getSource(),y=parseFloat(this.distance),b=[I[0]/255+y,I[1]/255+y,I[2]/255+y,1];c.uniform4fv(_.uLow,[0+I[0]/255-y,0+I[1]/255-y,0+I[2]/255-y,1]),c.uniform4fv(_.uHigh,b)},toObject:function(){return g(this.callSuper("toObject"),{color:this.color,distance:this.distance})}}),f.Image.filters.RemoveColor.fromObject=f.Image.filters.BaseFilter.fromObject}(n),function(m){var f=m.fabric||(m.fabric={}),g=f.Image.filters,v=f.util.createClass,a={Brownie:[.5997,.34553,-.27082,0,.186,-.0377,.86095,.15059,0,-.1449,.24113,-.07441,.44972,0,-.02965,0,0,0,1,0],Vintage:[.62793,.32021,-.03965,0,.03784,.02578,.64411,.03259,0,.02926,.0466,-.08512,.52416,0,.02023,0,0,0,1,0],Kodachrome:[1.12855,-.39673,-.03992,0,.24991,-.16404,1.08352,-.05498,0,.09698,-.16786,-.56034,1.60148,0,.13972,0,0,0,1,0],Technicolor:[1.91252,-.85453,-.09155,0,.04624,-.30878,1.76589,-.10601,0,-.27589,-.2311,-.75018,1.84759,0,.12137,0,0,0,1,0],Polaroid:[1.438,-.062,-.062,0,0,-.122,1.378,-.122,0,0,-.016,-.016,1.483,0,0,0,0,0,1,0],Sepia:[.393,.769,.189,0,0,.349,.686,.168,0,0,.272,.534,.131,0,0,0,0,0,1,0],BlackWhite:[1.5,1.5,1.5,0,-1,1.5,1.5,1.5,0,-1,1.5,1.5,1.5,0,-1,0,0,0,1,0]};for(var c in a)g[c]=v(g.ColorMatrix,{type:c,matrix:a[c],mainParameter:!1,colorsOnly:!0}),f.Image.filters[c].fromObject=f.Image.filters.BaseFilter.fromObject}(n),function(m){var f=m.fabric,g=f.Image.filters;g.BlendColor=(0,f.util.createClass)(g.BaseFilter,{type:"BlendColor",color:"#F95C63",mode:"multiply",alpha:1,fragmentSource:{multiply:"gl_FragColor.rgb *= uColor.rgb;\n",screen:"gl_FragColor.rgb = 1.0 - (1.0 - gl_FragColor.rgb) * (1.0 - uColor.rgb);\n",add:"gl_FragColor.rgb += uColor.rgb;\n",diff:"gl_FragColor.rgb = abs(gl_FragColor.rgb - uColor.rgb);\n",subtract:"gl_FragColor.rgb -= uColor.rgb;\n",lighten:"gl_FragColor.rgb = max(gl_FragColor.rgb, uColor.rgb);\n",darken:"gl_FragColor.rgb = min(gl_FragColor.rgb, uColor.rgb);\n",exclusion:"gl_FragColor.rgb += uColor.rgb - 2.0 * (uColor.rgb * gl_FragColor.rgb);\n",overlay:"if (uColor.r < 0.5) {\ngl_FragColor.r *= 2.0 * uColor.r;\n} else {\ngl_FragColor.r = 1.0 - 2.0 * (1.0 - gl_FragColor.r) * (1.0 - uColor.r);\n}\nif (uColor.g < 0.5) {\ngl_FragColor.g *= 2.0 * uColor.g;\n} else {\ngl_FragColor.g = 1.0 - 2.0 * (1.0 - gl_FragColor.g) * (1.0 - uColor.g);\n}\nif (uColor.b < 0.5) {\ngl_FragColor.b *= 2.0 * uColor.b;\n} else {\ngl_FragColor.b = 1.0 - 2.0 * (1.0 - gl_FragColor.b) * (1.0 - uColor.b);\n}\n",tint:"gl_FragColor.rgb *= (1.0 - uColor.a);\ngl_FragColor.rgb += uColor.rgb;\n"},buildSource:function(a){return"precision highp float;\nuniform sampler2D uTexture;\nuniform vec4 uColor;\nvarying vec2 vTexCoord;\nvoid main() {\nvec4 color = texture2D(uTexture, vTexCoord);\ngl_FragColor = color;\nif (color.a > 0.0) {\n"+this.fragmentSource[a]+"}\n}"},retrieveShader:function(a){var c,_=this.type+"_"+this.mode;return a.programCache.hasOwnProperty(_)||(c=this.buildSource(this.mode),a.programCache[_]=this.createProgram(a.context,c)),a.programCache[_]},applyTo2d:function(a){var c,_,I,y,w,b,x,O=a.imageData.data,F=O.length,L=1-this.alpha;c=(x=new f.Color(this.color).getSource())[0]*this.alpha,_=x[1]*this.alpha,I=x[2]*this.alpha;for(var N=0;N<F;N+=4)switch(y=O[N],w=O[N+1],b=O[N+2],this.mode){case"multiply":O[N]=y*c/255,O[N+1]=w*_/255,O[N+2]=b*I/255;break;case"screen":O[N]=255-(255-y)*(255-c)/255,O[N+1]=255-(255-w)*(255-_)/255,O[N+2]=255-(255-b)*(255-I)/255;break;case"add":O[N]=y+c,O[N+1]=w+_,O[N+2]=b+I;break;case"diff":case"difference":O[N]=Math.abs(y-c),O[N+1]=Math.abs(w-_),O[N+2]=Math.abs(b-I);break;case"subtract":O[N]=y-c,O[N+1]=w-_,O[N+2]=b-I;break;case"darken":O[N]=Math.min(y,c),O[N+1]=Math.min(w,_),O[N+2]=Math.min(b,I);break;case"lighten":O[N]=Math.max(y,c),O[N+1]=Math.max(w,_),O[N+2]=Math.max(b,I);break;case"overlay":O[N]=c<128?2*y*c/255:255-2*(255-y)*(255-c)/255,O[N+1]=_<128?2*w*_/255:255-2*(255-w)*(255-_)/255,O[N+2]=I<128?2*b*I/255:255-2*(255-b)*(255-I)/255;break;case"exclusion":O[N]=c+y-2*c*y/255,O[N+1]=_+w-2*_*w/255,O[N+2]=I+b-2*I*b/255;break;case"tint":O[N]=c+y*L,O[N+1]=_+w*L,O[N+2]=I+b*L}},getUniformLocations:function(a,c){return{uColor:a.getUniformLocation(c,"uColor")}},sendUniformData:function(a,c){var _=new f.Color(this.color).getSource();_[0]=this.alpha*_[0]/255,_[1]=this.alpha*_[1]/255,_[2]=this.alpha*_[2]/255,_[3]=this.alpha,a.uniform4fv(c.uColor,_)},toObject:function(){return{type:this.type,color:this.color,mode:this.mode,alpha:this.alpha}}}),f.Image.filters.BlendColor.fromObject=f.Image.filters.BaseFilter.fromObject}(n),function(m){var f=m.fabric,g=f.Image.filters;g.BlendImage=(0,f.util.createClass)(g.BaseFilter,{type:"BlendImage",image:null,mode:"multiply",alpha:1,vertexSource:"attribute vec2 aPosition;\nvarying vec2 vTexCoord;\nvarying vec2 vTexCoord2;\nuniform mat3 uTransformMatrix;\nvoid main() {\nvTexCoord = aPosition;\nvTexCoord2 = (uTransformMatrix * vec3(aPosition, 1.0)).xy;\ngl_Position = vec4(aPosition * 2.0 - 1.0, 0.0, 1.0);\n}",fragmentSource:{multiply:"precision highp float;\nuniform sampler2D uTexture;\nuniform sampler2D uImage;\nuniform vec4 uColor;\nvarying vec2 vTexCoord;\nvarying vec2 vTexCoord2;\nvoid main() {\nvec4 color = texture2D(uTexture, vTexCoord);\nvec4 color2 = texture2D(uImage, vTexCoord2);\ncolor.rgba *= color2.rgba;\ngl_FragColor = color;\n}",mask:"precision highp float;\nuniform sampler2D uTexture;\nuniform sampler2D uImage;\nuniform vec4 uColor;\nvarying vec2 vTexCoord;\nvarying vec2 vTexCoord2;\nvoid main() {\nvec4 color = texture2D(uTexture, vTexCoord);\nvec4 color2 = texture2D(uImage, vTexCoord2);\ncolor.a = color2.a;\ngl_FragColor = color;\n}"},retrieveShader:function(a){var c=this.type+"_"+this.mode,_=this.fragmentSource[this.mode];return a.programCache.hasOwnProperty(c)||(a.programCache[c]=this.createProgram(a.context,_)),a.programCache[c]},applyToWebGL:function(a){var c=a.context,_=this.createTexture(a.filterBackend,this.image);this.bindAdditionalTexture(c,_,c.TEXTURE1),this.callSuper("applyToWebGL",a),this.unbindAdditionalTexture(c,c.TEXTURE1)},createTexture:function(a,c){return a.getCachedTexture(c.cacheKey,c._element)},calculateMatrix:function(){var a=this.image;return[1/a.scaleX,0,0,0,1/a.scaleY,0,-a.left/a._element.width,-a.top/a._element.height,1]},applyTo2d:function(a){var c,_,I,y,w,b,x,O,F,L,N,j=a.imageData,$=a.filterBackend.resources,X=j.data,ie=X.length,ee=j.width,Q=j.height,W=this.image;$.blendImage||($.blendImage=f.util.createCanvasElement()),L=(F=$.blendImage).getContext("2d"),F.width!==ee||F.height!==Q?(F.width=ee,F.height=Q):L.clearRect(0,0,ee,Q),L.setTransform(W.scaleX,0,0,W.scaleY,W.left,W.top),L.drawImage(W._element,0,0,ee,Q),N=L.getImageData(0,0,ee,Q).data;for(var H=0;H<ie;H+=4)switch(w=X[H],b=X[H+1],x=X[H+2],O=X[H+3],c=N[H],_=N[H+1],I=N[H+2],y=N[H+3],this.mode){case"multiply":X[H]=w*c/255,X[H+1]=b*_/255,X[H+2]=x*I/255,X[H+3]=O*y/255;break;case"mask":X[H+3]=y}},getUniformLocations:function(a,c){return{uTransformMatrix:a.getUniformLocation(c,"uTransformMatrix"),uImage:a.getUniformLocation(c,"uImage")}},sendUniformData:function(a,c){var _=this.calculateMatrix();a.uniform1i(c.uImage,1),a.uniformMatrix3fv(c.uTransformMatrix,!1,_)},toObject:function(){return{type:this.type,image:this.image&&this.image.toObject(),mode:this.mode,alpha:this.alpha}}}),f.Image.filters.BlendImage.fromObject=function(a,c){f.Image.fromObject(a.image,function(_){var I=f.util.object.clone(a);I.image=_,c(new f.Image.filters.BlendImage(I))})}}(n),function(m){var f=m.fabric||(m.fabric={}),g=Math.pow,v=Math.floor,a=Math.sqrt,c=Math.abs,_=Math.round,I=Math.sin,y=Math.ceil,w=f.Image.filters;w.Resize=(0,f.util.createClass)(w.BaseFilter,{type:"Resize",resizeType:"hermite",scaleX:1,scaleY:1,lanczosLobes:3,getUniformLocations:function(x,O){return{uDelta:x.getUniformLocation(O,"uDelta"),uTaps:x.getUniformLocation(O,"uTaps")}},sendUniformData:function(x,O){x.uniform2fv(O.uDelta,this.horizontal?[1/this.width,0]:[0,1/this.height]),x.uniform1fv(O.uTaps,this.taps)},retrieveShader:function(x){var O=this.getFilterWindow(),F=this.type+"_"+O;if(!x.programCache.hasOwnProperty(F)){var L=this.generateShader(O);x.programCache[F]=this.createProgram(x.context,L)}return x.programCache[F]},getFilterWindow:function(){return Math.ceil(this.lanczosLobes/this.tempScale)},getTaps:function(){for(var x=this.lanczosCreate(this.lanczosLobes),O=this.tempScale,F=this.getFilterWindow(),L=new Array(F),N=1;N<=F;N++)L[N-1]=x(N*O);return L},generateShader:function(x){for(var O=new Array(x),F=this.fragmentSourceTOP,L=1;L<=x;L++)O[L-1]=L+".0 * uDelta";return F+="uniform float uTaps["+x+"];\n",F+="void main() {\n",F+="  vec4 color = texture2D(uTexture, vTexCoord);\n",F+="  float sum = 1.0;\n",O.forEach(function(N,j){F+="  color += texture2D(uTexture, vTexCoord + "+N+") * uTaps["+j+"];\n",F+="  color += texture2D(uTexture, vTexCoord - "+N+") * uTaps["+j+"];\n",F+="  sum += 2.0 * uTaps["+j+"];\n"}),F+="  gl_FragColor = color / sum;\n",F+="}"},fragmentSourceTOP:"precision highp float;\nuniform sampler2D uTexture;\nuniform vec2 uDelta;\nvarying vec2 vTexCoord;\n",applyTo:function(x){x.webgl?(x.passes++,this.width=x.sourceWidth,this.horizontal=!0,this.dW=Math.round(this.width*this.scaleX),this.dH=x.sourceHeight,this.tempScale=this.dW/this.width,this.taps=this.getTaps(),x.destinationWidth=this.dW,this._setupFrameBuffer(x),this.applyToWebGL(x),this._swapTextures(x),x.sourceWidth=x.destinationWidth,this.height=x.sourceHeight,this.horizontal=!1,this.dH=Math.round(this.height*this.scaleY),this.tempScale=this.dH/this.height,this.taps=this.getTaps(),x.destinationHeight=this.dH,this._setupFrameBuffer(x),this.applyToWebGL(x),this._swapTextures(x),x.sourceHeight=x.destinationHeight):this.applyTo2d(x)},isNeutralState:function(){return 1===this.scaleX&&1===this.scaleY},lanczosCreate:function(x){return function(O){if(O>=x||O<=-x)return 0;if(O<1.1920929e-7&&O>-1.1920929e-7)return 1;var F=(O*=Math.PI)/x;return I(O)/O*I(F)/F}},applyTo2d:function(x){var O=x.imageData,F=this.scaleX,L=this.scaleY;this.rcpScaleX=1/F,this.rcpScaleY=1/L;var N,j=O.width,$=O.height,X=_(j*F),ie=_($*L);"sliceHack"===this.resizeType?N=this.sliceByTwo(x,j,$,X,ie):"hermite"===this.resizeType?N=this.hermiteFastResize(x,j,$,X,ie):"bilinear"===this.resizeType?N=this.bilinearFiltering(x,j,$,X,ie):"lanczos"===this.resizeType&&(N=this.lanczosResize(x,j,$,X,ie)),x.imageData=N},sliceByTwo:function(x,O,F,L,N){var j,$,X=x.imageData,ee=!1,Q=!1,W=.5*O,H=.5*F,Z=f.filterBackend.resources,ne=0,re=0,z=O,Y=0;for(Z.sliceByTwo||(Z.sliceByTwo=document.createElement("canvas")),((j=Z.sliceByTwo).width<1.5*O||j.height<F)&&(j.width=1.5*O,j.height=F),($=j.getContext("2d")).clearRect(0,0,1.5*O,F),$.putImageData(X,0,0),L=v(L),N=v(N);!ee||!Q;)O=W,F=H,L<v(.5*W)?W=v(.5*W):(W=L,ee=!0),N<v(.5*H)?H=v(.5*H):(H=N,Q=!0),$.drawImage(j,ne,re,O,F,z,Y,W,H),ne=z,re=Y,Y+=H;return $.getImageData(ne,re,L,N)},lanczosResize:function(x,O,F,L,N){var j=x.imageData.data,$=x.ctx.createImageData(L,N),X=$.data,ie=this.lanczosCreate(this.lanczosLobes),ee=this.rcpScaleX,Q=this.rcpScaleY,W=2/this.rcpScaleX,H=2/this.rcpScaleY,Z=y(ee*this.lanczosLobes/2),ne=y(Q*this.lanczosLobes/2),re={},z={},Y={};return function K(oe){var te,ae,_e,he,ue,pe,fe,Ce,Ae,Ie,Ye;for(z.x=(oe+.5)*ee,Y.x=v(z.x),te=0;te<N;te++){for(z.y=(te+.5)*Q,Y.y=v(z.y),ue=0,pe=0,fe=0,Ce=0,Ae=0,ae=Y.x-Z;ae<=Y.x+Z;ae++)if(!(ae<0||ae>=O)){Ie=v(1e3*c(ae-z.x)),re[Ie]||(re[Ie]={});for(var ft=Y.y-ne;ft<=Y.y+ne;ft++)ft<0||ft>=F||(Ye=v(1e3*c(ft-z.y)),re[Ie][Ye]||(re[Ie][Ye]=ie(a(g(Ie*W,2)+g(Ye*H,2))/1e3)),(_e=re[Ie][Ye])>0&&(ue+=_e,pe+=_e*j[he=4*(ft*O+ae)],fe+=_e*j[he+1],Ce+=_e*j[he+2],Ae+=_e*j[he+3]))}X[he=4*(te*L+oe)]=pe/ue,X[he+1]=fe/ue,X[he+2]=Ce/ue,X[he+3]=Ae/ue}return++oe<L?K(oe):$}(0)},bilinearFiltering:function(x,O,F,L,N){var j,$,X,ie,ee,Q,W,Z,ne=0,re=this.rcpScaleX,z=this.rcpScaleY,Y=4*(O-1),K=x.imageData.data,oe=x.ctx.createImageData(L,N),te=oe.data;for(X=0;X<N;X++)for(ie=0;ie<L;ie++)for(ee=re*ie-(j=v(re*ie)),Q=z*X-($=v(z*X)),Z=4*($*O+j),W=0;W<4;W++)te[ne++]=K[Z+W]*(1-ee)*(1-Q)+K[Z+4+W]*ee*(1-Q)+K[Z+Y+W]*Q*(1-ee)+K[Z+Y+4+W]*ee*Q;return oe},hermiteFastResize:function(x,O,F,L,N){for(var j=this.rcpScaleX,$=this.rcpScaleY,X=y(j/2),ie=y($/2),ee=x.imageData.data,Q=x.ctx.createImageData(L,N),W=Q.data,H=0;H<N;H++)for(var Z=0;Z<L;Z++){for(var ne=4*(Z+H*L),re=0,z=0,Y=0,K=0,oe=0,te=0,ae=0,_e=(H+.5)*$,he=v(H*$);he<(H+1)*$;he++)for(var ue=c(_e-(he+.5))/ie,pe=(Z+.5)*j,fe=ue*ue,Ce=v(Z*j);Ce<(Z+1)*j;Ce++){var Ae=c(pe-(Ce+.5))/X,Ie=a(fe+Ae*Ae);Ie>1&&Ie<-1||(re=2*Ie*Ie*Ie-3*Ie*Ie+1)>0&&(ae+=re*ee[3+(Ae=4*(Ce+he*O))],Y+=re,ee[Ae+3]<255&&(re=re*ee[Ae+3]/250),K+=re*ee[Ae],oe+=re*ee[Ae+1],te+=re*ee[Ae+2],z+=re)}W[ne]=K/z,W[ne+1]=oe/z,W[ne+2]=te/z,W[ne+3]=ae/Y}return Q},toObject:function(){return{type:this.type,scaleX:this.scaleX,scaleY:this.scaleY,resizeType:this.resizeType,lanczosLobes:this.lanczosLobes}}}),f.Image.filters.Resize.fromObject=f.Image.filters.BaseFilter.fromObject}(n),function(m){var f=m.fabric||(m.fabric={}),g=f.Image.filters;g.Contrast=(0,f.util.createClass)(g.BaseFilter,{type:"Contrast",fragmentSource:"precision highp float;\nuniform sampler2D uTexture;\nuniform float uContrast;\nvarying vec2 vTexCoord;\nvoid main() {\nvec4 color = texture2D(uTexture, vTexCoord);\nfloat contrastF = 1.015 * (uContrast + 1.0) / (1.0 * (1.015 - uContrast));\ncolor.rgb = contrastF * (color.rgb - 0.5) + 0.5;\ngl_FragColor = color;\n}",contrast:0,mainParameter:"contrast",applyTo2d:function(a){if(0!==this.contrast){var c,_=a.imageData.data,I=_.length,y=Math.floor(255*this.contrast),w=259*(y+255)/(255*(259-y));for(c=0;c<I;c+=4)_[c]=w*(_[c]-128)+128,_[c+1]=w*(_[c+1]-128)+128,_[c+2]=w*(_[c+2]-128)+128}},getUniformLocations:function(a,c){return{uContrast:a.getUniformLocation(c,"uContrast")}},sendUniformData:function(a,c){a.uniform1f(c.uContrast,this.contrast)}}),f.Image.filters.Contrast.fromObject=f.Image.filters.BaseFilter.fromObject}(n),function(m){var f=m.fabric||(m.fabric={}),g=f.Image.filters;g.Saturation=(0,f.util.createClass)(g.BaseFilter,{type:"Saturation",fragmentSource:"precision highp float;\nuniform sampler2D uTexture;\nuniform float uSaturation;\nvarying vec2 vTexCoord;\nvoid main() {\nvec4 color = texture2D(uTexture, vTexCoord);\nfloat rgMax = max(color.r, color.g);\nfloat rgbMax = max(rgMax, color.b);\ncolor.r += rgbMax != color.r ? (rgbMax - color.r) * uSaturation : 0.00;\ncolor.g += rgbMax != color.g ? (rgbMax - color.g) * uSaturation : 0.00;\ncolor.b += rgbMax != color.b ? (rgbMax - color.b) * uSaturation : 0.00;\ngl_FragColor = color;\n}",saturation:0,mainParameter:"saturation",applyTo2d:function(a){if(0!==this.saturation){var c,_,I=a.imageData.data,y=I.length,w=-this.saturation;for(c=0;c<y;c+=4)_=Math.max(I[c],I[c+1],I[c+2]),I[c]+=_!==I[c]?(_-I[c])*w:0,I[c+1]+=_!==I[c+1]?(_-I[c+1])*w:0,I[c+2]+=_!==I[c+2]?(_-I[c+2])*w:0}},getUniformLocations:function(a,c){return{uSaturation:a.getUniformLocation(c,"uSaturation")}},sendUniformData:function(a,c){a.uniform1f(c.uSaturation,-this.saturation)}}),f.Image.filters.Saturation.fromObject=f.Image.filters.BaseFilter.fromObject}(n),function(m){var f=m.fabric||(m.fabric={}),g=f.Image.filters;g.Vibrance=(0,f.util.createClass)(g.BaseFilter,{type:"Vibrance",fragmentSource:"precision highp float;\nuniform sampler2D uTexture;\nuniform float uVibrance;\nvarying vec2 vTexCoord;\nvoid main() {\nvec4 color = texture2D(uTexture, vTexCoord);\nfloat max = max(color.r, max(color.g, color.b));\nfloat avg = (color.r + color.g + color.b) / 3.0;\nfloat amt = (abs(max - avg) * 2.0) * uVibrance;\ncolor.r += max != color.r ? (max - color.r) * amt : 0.00;\ncolor.g += max != color.g ? (max - color.g) * amt : 0.00;\ncolor.b += max != color.b ? (max - color.b) * amt : 0.00;\ngl_FragColor = color;\n}",vibrance:0,mainParameter:"vibrance",applyTo2d:function(a){if(0!==this.vibrance){var c,_,y,w=a.imageData.data,b=w.length,x=-this.vibrance;for(c=0;c<b;c+=4)_=Math.max(w[c],w[c+1],w[c+2]),y=2*Math.abs(_-(w[c]+w[c+1]+w[c+2])/3)/255*x,w[c]+=_!==w[c]?(_-w[c])*y:0,w[c+1]+=_!==w[c+1]?(_-w[c+1])*y:0,w[c+2]+=_!==w[c+2]?(_-w[c+2])*y:0}},getUniformLocations:function(a,c){return{uVibrance:a.getUniformLocation(c,"uVibrance")}},sendUniformData:function(a,c){a.uniform1f(c.uVibrance,-this.vibrance)}}),f.Image.filters.Vibrance.fromObject=f.Image.filters.BaseFilter.fromObject}(n),function(m){var f=m.fabric||(m.fabric={}),g=f.Image.filters;g.Blur=(0,f.util.createClass)(g.BaseFilter,{type:"Blur",fragmentSource:"precision highp float;\nuniform sampler2D uTexture;\nuniform vec2 uDelta;\nvarying vec2 vTexCoord;\nconst float nSamples = 15.0;\nvec3 v3offset = vec3(12.9898, 78.233, 151.7182);\nfloat random(vec3 scale) {\nreturn fract(sin(dot(gl_FragCoord.xyz, scale)) * 43758.5453);\n}\nvoid main() {\nvec4 color = vec4(0.0);\nfloat total = 0.0;\nfloat offset = random(v3offset);\nfor (float t = -nSamples; t <= nSamples; t++) {\nfloat percent = (t + offset - 0.5) / nSamples;\nfloat weight = 1.0 - abs(percent);\ncolor += texture2D(uTexture, vTexCoord + uDelta * percent) * weight;\ntotal += weight;\n}\ngl_FragColor = color / total;\n}",blur:0,mainParameter:"blur",applyTo:function(a){a.webgl?(this.aspectRatio=a.sourceWidth/a.sourceHeight,a.passes++,this._setupFrameBuffer(a),this.horizontal=!0,this.applyToWebGL(a),this._swapTextures(a),this._setupFrameBuffer(a),this.horizontal=!1,this.applyToWebGL(a),this._swapTextures(a)):this.applyTo2d(a)},applyTo2d:function(a){a.imageData=this.simpleBlur(a)},simpleBlur:function(a){var c,_,I=a.filterBackend.resources,y=a.imageData.width,w=a.imageData.height;I.blurLayer1||(I.blurLayer1=f.util.createCanvasElement(),I.blurLayer2=f.util.createCanvasElement()),_=I.blurLayer2,(c=I.blurLayer1).width===y&&c.height===w||(_.width=c.width=y,_.height=c.height=w);var b,x,O,F,L=c.getContext("2d"),N=_.getContext("2d"),j=.06*this.blur*.5;for(L.putImageData(a.imageData,0,0),N.clearRect(0,0,y,w),F=-15;F<=15;F++)O=j*(x=F/15)*y+(b=(Math.random()-.5)/4),N.globalAlpha=1-Math.abs(x),N.drawImage(c,O,b),L.drawImage(_,0,0),N.globalAlpha=1,N.clearRect(0,0,_.width,_.height);for(F=-15;F<=15;F++)O=j*(x=F/15)*w+(b=(Math.random()-.5)/4),N.globalAlpha=1-Math.abs(x),N.drawImage(c,b,O),L.drawImage(_,0,0),N.globalAlpha=1,N.clearRect(0,0,_.width,_.height);a.ctx.drawImage(c,0,0);var $=a.ctx.getImageData(0,0,c.width,c.height);return L.globalAlpha=1,L.clearRect(0,0,c.width,c.height),$},getUniformLocations:function(a,c){return{delta:a.getUniformLocation(c,"uDelta")}},sendUniformData:function(a,c){var _=this.chooseRightDelta();a.uniform2fv(c.delta,_)},chooseRightDelta:function(){var a,c=1,_=[0,0];return this.horizontal?this.aspectRatio>1&&(c=1/this.aspectRatio):this.aspectRatio<1&&(c=this.aspectRatio),a=c*this.blur*.12,this.horizontal?_[0]=a:_[1]=a,_}}),g.Blur.fromObject=f.Image.filters.BaseFilter.fromObject}(n),function(m){var f=m.fabric||(m.fabric={}),g=f.Image.filters;g.Gamma=(0,f.util.createClass)(g.BaseFilter,{type:"Gamma",fragmentSource:"precision highp float;\nuniform sampler2D uTexture;\nuniform vec3 uGamma;\nvarying vec2 vTexCoord;\nvoid main() {\nvec4 color = texture2D(uTexture, vTexCoord);\nvec3 correction = (1.0 / uGamma);\ncolor.r = pow(color.r, correction.r);\ncolor.g = pow(color.g, correction.g);\ncolor.b = pow(color.b, correction.b);\ngl_FragColor = color;\ngl_FragColor.rgb *= color.a;\n}",gamma:[1,1,1],mainParameter:"gamma",initialize:function(a){this.gamma=[1,1,1],g.BaseFilter.prototype.initialize.call(this,a)},applyTo2d:function(a){var c,_=a.imageData.data,I=this.gamma,y=_.length,w=1/I[0],b=1/I[1],x=1/I[2];for(this.rVals||(this.rVals=new Uint8Array(256),this.gVals=new Uint8Array(256),this.bVals=new Uint8Array(256)),c=0,y=256;c<y;c++)this.rVals[c]=255*Math.pow(c/255,w),this.gVals[c]=255*Math.pow(c/255,b),this.bVals[c]=255*Math.pow(c/255,x);for(c=0,y=_.length;c<y;c+=4)_[c]=this.rVals[_[c]],_[c+1]=this.gVals[_[c+1]],_[c+2]=this.bVals[_[c+2]]},getUniformLocations:function(a,c){return{uGamma:a.getUniformLocation(c,"uGamma")}},sendUniformData:function(a,c){a.uniform3fv(c.uGamma,this.gamma)}}),f.Image.filters.Gamma.fromObject=f.Image.filters.BaseFilter.fromObject}(n),function(m){var f=m.fabric||(m.fabric={}),g=f.Image.filters;g.Composed=(0,f.util.createClass)(g.BaseFilter,{type:"Composed",subFilters:[],initialize:function(a){this.callSuper("initialize",a),this.subFilters=this.subFilters.slice(0)},applyTo:function(a){a.passes+=this.subFilters.length-1,this.subFilters.forEach(function(c){c.applyTo(a)})},toObject:function(){return f.util.object.extend(this.callSuper("toObject"),{subFilters:this.subFilters.map(function(a){return a.toObject()})})},isNeutralState:function(){return!this.subFilters.some(function(a){return!a.isNeutralState()})}}),f.Image.filters.Composed.fromObject=function(a,c){var _=(a.subFilters||[]).map(function(y){return new f.Image.filters[y.type](y)}),I=new f.Image.filters.Composed({subFilters:_});return c&&c(I),I}}(n),function(m){var f=m.fabric||(m.fabric={}),g=f.Image.filters;g.HueRotation=(0,f.util.createClass)(g.ColorMatrix,{type:"HueRotation",rotation:0,mainParameter:"rotation",calculateMatrix:function(){var a=this.rotation*Math.PI,c=f.util.cos(a),_=f.util.sin(a),I=1/3,y=Math.sqrt(I)*_,w=1-c;this.matrix=[1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0],this.matrix[0]=c+w/3,this.matrix[1]=I*w-y,this.matrix[2]=I*w+y,this.matrix[5]=I*w+y,this.matrix[6]=c+I*w,this.matrix[7]=I*w-y,this.matrix[10]=I*w-y,this.matrix[11]=I*w+y,this.matrix[12]=c+I*w},isNeutralState:function(a){return this.calculateMatrix(),g.BaseFilter.prototype.isNeutralState.call(this,a)},applyTo:function(a){this.calculateMatrix(),g.BaseFilter.prototype.applyTo.call(this,a)}}),f.Image.filters.HueRotation.fromObject=f.Image.filters.BaseFilter.fromObject}(n),function(m){var f=m.fabric||(m.fabric={}),g=f.util.object.clone;if(f.Text)f.warn("fabric.Text is already defined");else{var v="fontFamily fontWeight fontSize text underline overline linethrough textAlign fontStyle lineHeight textBackgroundColor charSpacing styles direction path pathStartOffset pathSide pathAlign".split(" ");f.Text=f.util.createClass(f.Object,{_dimensionAffectingProps:["fontSize","fontWeight","fontFamily","fontStyle","lineHeight","text","charSpacing","textAlign","styles","path","pathStartOffset","pathSide","pathAlign"],_reNewline:/\r?\n/,_reSpacesAndTabs:/[ \t\r]/g,_reSpaceAndTab:/[ \t\r]/,_reWords:/\S+/g,type:"text",fontSize:40,fontWeight:"normal",fontFamily:"Times New Roman",underline:!1,overline:!1,linethrough:!1,textAlign:"left",fontStyle:"normal",lineHeight:1.16,superscript:{size:.6,baseline:-.35},subscript:{size:.6,baseline:.11},textBackgroundColor:"",stateProperties:f.Object.prototype.stateProperties.concat(v),cacheProperties:f.Object.prototype.cacheProperties.concat(v),stroke:null,shadow:null,path:null,pathStartOffset:0,pathSide:"left",pathAlign:"baseline",_fontSizeFraction:.222,offsets:{underline:.1,linethrough:-.315,overline:-.88},_fontSizeMult:1.13,charSpacing:0,styles:null,_measuringContext:null,deltaY:0,direction:"ltr",_styleProperties:["stroke","strokeWidth","fill","fontFamily","fontSize","fontWeight","fontStyle","underline","overline","linethrough","deltaY","textBackgroundColor"],__charBounds:[],CACHE_FONT_SIZE:400,MIN_TEXT_WIDTH:2,initialize:function(a,c){this.styles=c&&c.styles||{},this.text=a,this.__skipDimension=!0,this.callSuper("initialize",c),this.path&&this.setPathInfo(),this.__skipDimension=!1,this.initDimensions(),this.setCoords(),this.setupState({propertySet:"_dimensionAffectingProps"})},setPathInfo:function(){var a=this.path;a&&(a.segmentsInfo=f.util.getPathSegmentsInfo(a.path))},getMeasuringContext:function(){return f._measuringContext||(f._measuringContext=this.canvas&&this.canvas.contextCache||f.util.createCanvasElement().getContext("2d")),f._measuringContext},_splitText:function(){var a=this._splitTextIntoLines(this.text);return this.textLines=a.lines,this._textLines=a.graphemeLines,this._unwrappedTextLines=a._unwrappedLines,this._text=a.graphemeText,a},initDimensions:function(){this.__skipDimension||(this._splitText(),this._clearCache(),this.path?(this.width=this.path.width,this.height=this.path.height):(this.width=this.calcTextWidth()||this.cursorWidth||this.MIN_TEXT_WIDTH,this.height=this.calcTextHeight()),-1!==this.textAlign.indexOf("justify")&&this.enlargeSpaces(),this.saveState({propertySet:"_dimensionAffectingProps"}))},enlargeSpaces:function(){for(var a,c,I,y,w,b,x=0,O=this._textLines.length;x<O;x++)if(("justify"===this.textAlign||x!==O-1&&!this.isEndOfWrapping(x))&&(I=0,y=this._textLines[x],(c=this.getLineWidth(x))<this.width&&(b=this.textLines[x].match(this._reSpacesAndTabs)))){a=(this.width-c)/b.length;for(var F=0,L=y.length;F<=L;F++)w=this.__charBounds[x][F],this._reSpaceAndTab.test(y[F])?(w.width+=a,w.kernedWidth+=a,w.left+=I,I+=a):w.left+=I}},isEndOfWrapping:function(a){return a===this._textLines.length-1},missingNewlineOffset:function(){return 1},toString:function(){return"#<fabric.Text ("+this.complexity()+'): { "text": "'+this.text+'", "fontFamily": "'+this.fontFamily+'" }>'},_getCacheCanvasDimensions:function(){var a=this.callSuper("_getCacheCanvasDimensions"),c=this.fontSize;return a.width+=c*a.zoomX,a.height+=c*a.zoomY,a},_render:function(a){var c=this.path;c&&!c.isNotVisible()&&c._render(a),this._setTextStyles(a),this._renderTextLinesBackground(a),this._renderTextDecoration(a,"underline"),this._renderText(a),this._renderTextDecoration(a,"overline"),this._renderTextDecoration(a,"linethrough")},_renderText:function(a){"stroke"===this.paintFirst?(this._renderTextStroke(a),this._renderTextFill(a)):(this._renderTextFill(a),this._renderTextStroke(a))},_setTextStyles:function(a,c,_){if(a.textBaseline="alphabetical",this.path)switch(this.pathAlign){case"center":a.textBaseline="middle";break;case"ascender":a.textBaseline="top";break;case"descender":a.textBaseline="bottom"}a.font=this._getFontDeclaration(c,_)},calcTextWidth:function(){for(var a=this.getLineWidth(0),c=1,_=this._textLines.length;c<_;c++){var I=this.getLineWidth(c);I>a&&(a=I)}return a},_renderTextLine:function(a,c,_,I,y,w){this._renderChars(a,c,_,I,y,w)},_renderTextLinesBackground:function(a){if(this.textBackgroundColor||this.styleHas("textBackgroundColor")){for(var c,_,I,y,w,b,x,O=a.fillStyle,F=this._getLeftOffset(),L=this._getTopOffset(),N=0,j=0,$=this.path,X=0,ie=this._textLines.length;X<ie;X++)if(c=this.getHeightOfLine(X),this.textBackgroundColor||this.styleHas("textBackgroundColor",X)){I=this._textLines[X],_=this._getLineLeftOffset(X),j=0,N=0,y=this.getValueOfPropertyAt(X,0,"textBackgroundColor");for(var ee=0,Q=I.length;ee<Q;ee++)w=this.__charBounds[X][ee],b=this.getValueOfPropertyAt(X,ee,"textBackgroundColor"),$?(a.save(),a.translate(w.renderLeft,w.renderTop),a.rotate(w.angle),a.fillStyle=b,b&&a.fillRect(-w.width/2,-c/this.lineHeight*(1-this._fontSizeFraction),w.width,c/this.lineHeight),a.restore()):b!==y?(x=F+_+N,"rtl"===this.direction&&(x=this.width-x-j),a.fillStyle=y,y&&a.fillRect(x,L,j,c/this.lineHeight),N=w.left,j=w.width,y=b):j+=w.kernedWidth;b&&!$&&(x=F+_+N,"rtl"===this.direction&&(x=this.width-x-j),a.fillStyle=b,a.fillRect(x,L,j,c/this.lineHeight)),L+=c}else L+=c;a.fillStyle=O,this._removeShadow(a)}},getFontCache:function(a){var c=a.fontFamily.toLowerCase();f.charWidthsCache[c]||(f.charWidthsCache[c]={});var _=f.charWidthsCache[c],I=a.fontStyle.toLowerCase()+"_"+(a.fontWeight+"").toLowerCase();return _[I]||(_[I]={}),_[I]},_measureChar:function(a,c,_,I){var y,w,b,x,O=this.getFontCache(c),F=_+a,L=this._getFontDeclaration(c)===this._getFontDeclaration(I),N=c.fontSize/this.CACHE_FONT_SIZE;if(_&&void 0!==O[_]&&(b=O[_]),void 0!==O[a]&&(x=y=O[a]),L&&void 0!==O[F]&&(x=(w=O[F])-b),void 0===y||void 0===b||void 0===w){var j=this.getMeasuringContext();this._setTextStyles(j,c,!0)}return void 0===y&&(x=y=j.measureText(a).width,O[a]=y),void 0===b&&L&&_&&(b=j.measureText(_).width,O[_]=b),L&&void 0===w&&(w=j.measureText(F).width,O[F]=w,x=w-b),{width:y*N,kernedWidth:x*N}},getHeightOfChar:function(a,c){return this.getValueOfPropertyAt(a,c,"fontSize")},measureLine:function(a){var c=this._measureLine(a);return 0!==this.charSpacing&&(c.width-=this._getWidthOfCharSpacing()),c.width<0&&(c.width=0),c},_measureLine:function(a){var c,_,I,y,w,b,x=0,O=this._textLines[a],F=new Array(O.length),L=0,N=this.path,j="right"===this.pathSide;for(this.__charBounds[a]=F,c=0;c<O.length;c++)y=this._getGraphemeBox(_=O[c],a,c,I),F[c]=y,x+=y.kernedWidth,I=_;if(F[c]={left:y?y.left+y.width:0,width:0,kernedWidth:0,height:this.fontSize},N){switch(b=N.segmentsInfo[N.segmentsInfo.length-1].length,(w=f.util.getPointOnPath(N.path,0,N.segmentsInfo)).x+=N.pathOffset.x,w.y+=N.pathOffset.y,this.textAlign){case"left":L=j?b-x:0;break;case"center":L=(b-x)/2;break;case"right":L=j?0:b-x}for(L+=this.pathStartOffset*(j?-1:1),c=j?O.length-1:0;j?c>=0:c<O.length;j?c--:c++)L>b?L%=b:L<0&&(L+=b),this._setGraphemeOnPath(L,y=F[c],w),L+=y.kernedWidth}return{width:x,numOfSpaces:0}},_setGraphemeOnPath:function(a,c,_){var y=this.path,w=f.util.getPointOnPath(y.path,a+c.kernedWidth/2,y.segmentsInfo);c.renderLeft=w.x-_.x,c.renderTop=w.y-_.y,c.angle=w.angle+("right"===this.pathSide?Math.PI:0)},_getGraphemeBox:function(a,c,_,I,y){var w,b=this.getCompleteStyleDeclaration(c,_),x=I?this.getCompleteStyleDeclaration(c,_-1):{},O=this._measureChar(a,b,I,x),F=O.kernedWidth,L=O.width;0!==this.charSpacing&&(L+=w=this._getWidthOfCharSpacing(),F+=w);var N={width:L,left:0,height:b.fontSize,kernedWidth:F,deltaY:b.deltaY};if(_>0&&!y){var j=this.__charBounds[c][_-1];N.left=j.left+j.width+O.kernedWidth-O.width}return N},getHeightOfLine:function(a){if(this.__lineHeights[a])return this.__lineHeights[a];for(var c=this._textLines[a],_=this.getHeightOfChar(a,0),I=1,y=c.length;I<y;I++)_=Math.max(this.getHeightOfChar(a,I),_);return this.__lineHeights[a]=_*this.lineHeight*this._fontSizeMult},calcTextHeight:function(){for(var a,c=0,_=0,I=this._textLines.length;_<I;_++)a=this.getHeightOfLine(_),c+=_===I-1?a/this.lineHeight:a;return c},_getLeftOffset:function(){return"ltr"===this.direction?-this.width/2:this.width/2},_getTopOffset:function(){return-this.height/2},_renderTextCommon:function(a,c){a.save();for(var _=0,I=this._getLeftOffset(),y=this._getTopOffset(),w=0,b=this._textLines.length;w<b;w++){var x=this.getHeightOfLine(w),O=x/this.lineHeight,F=this._getLineLeftOffset(w);this._renderTextLine(c,a,this._textLines[w],I+F,y+_+O,w),_+=x}a.restore()},_renderTextFill:function(a){(this.fill||this.styleHas("fill"))&&this._renderTextCommon(a,"fillText")},_renderTextStroke:function(a){(this.stroke&&0!==this.strokeWidth||!this.isEmptyStyles())&&(this.shadow&&!this.shadow.affectStroke&&this._removeShadow(a),a.save(),this._setLineDash(a,this.strokeDashArray),a.beginPath(),this._renderTextCommon(a,"strokeText"),a.closePath(),a.restore())},_renderChars:function(a,c,_,I,y,w){var b,x,O,F,N=this.getHeightOfLine(w),j=-1!==this.textAlign.indexOf("justify"),$="",X=0,ie=this.path,ee=!j&&0===this.charSpacing&&this.isEmptyStyles(w)&&!ie,Q="ltr"===this.direction,W="ltr"===this.direction?1:-1,H=c.canvas.getAttribute("dir");if(c.save(),H!==this.direction&&(c.canvas.setAttribute("dir",Q?"ltr":"rtl"),c.direction=Q?"ltr":"rtl",c.textAlign=Q?"left":"right"),y-=N*this._fontSizeFraction/this.lineHeight,ee)return this._renderChar(a,c,w,0,_.join(""),I,y,N),void c.restore();for(var Z=0,ne=_.length-1;Z<=ne;Z++)F=Z===ne||this.charSpacing||ie,$+=_[Z],O=this.__charBounds[w][Z],0===X?(I+=W*(O.kernedWidth-O.width),X+=O.width):X+=O.kernedWidth,j&&!F&&this._reSpaceAndTab.test(_[Z])&&(F=!0),F||(b=b||this.getCompleteStyleDeclaration(w,Z),x=this.getCompleteStyleDeclaration(w,Z+1),F=this._hasStyleChanged(b,x)),F&&(ie?(c.save(),c.translate(O.renderLeft,O.renderTop),c.rotate(O.angle),this._renderChar(a,c,w,Z,$,-X/2,0,N),c.restore()):this._renderChar(a,c,w,Z,$,I,y,N),$="",b=x,I+=W*X,X=0);c.restore()},_applyPatternGradientTransformText:function(a){var c,_=f.util.createCanvasElement(),I=this.width+this.strokeWidth,y=this.height+this.strokeWidth;return _.width=I,_.height=y,(c=_.getContext("2d")).beginPath(),c.moveTo(0,0),c.lineTo(I,0),c.lineTo(I,y),c.lineTo(0,y),c.closePath(),c.translate(I/2,y/2),c.fillStyle=a.toLive(c),this._applyPatternGradientTransform(c,a),c.fill(),c.createPattern(_,"no-repeat")},handleFiller:function(a,c,_){var I,y;return _.toLive?"percentage"===_.gradientUnits||_.gradientTransform||_.patternTransform?(a.translate(I=-this.width/2,y=-this.height/2),a[c]=this._applyPatternGradientTransformText(_),{offsetX:I,offsetY:y}):(a[c]=_.toLive(a,this),this._applyPatternGradientTransform(a,_)):(a[c]=_,{offsetX:0,offsetY:0})},_setStrokeStyles:function(a,c){return a.lineWidth=c.strokeWidth,a.lineCap=this.strokeLineCap,a.lineDashOffset=this.strokeDashOffset,a.lineJoin=this.strokeLineJoin,a.miterLimit=this.strokeMiterLimit,this.handleFiller(a,"strokeStyle",c.stroke)},_setFillStyles:function(a,c){return this.handleFiller(a,"fillStyle",c.fill)},_renderChar:function(a,c,_,I,y,w,b){var x,O,F=this._getStyleDeclaration(_,I),L=this.getCompleteStyleDeclaration(_,I),N="fillText"===a&&L.fill,j="strokeText"===a&&L.stroke&&L.strokeWidth;(j||N)&&(c.save(),N&&(x=this._setFillStyles(c,L)),j&&(O=this._setStrokeStyles(c,L)),c.font=this._getFontDeclaration(L),F&&F.textBackgroundColor&&this._removeShadow(c),F&&F.deltaY&&(b+=F.deltaY),N&&c.fillText(y,w-x.offsetX,b-x.offsetY),j&&c.strokeText(y,w-O.offsetX,b-O.offsetY),c.restore())},setSuperscript:function(a,c){return this._setScript(a,c,this.superscript)},setSubscript:function(a,c){return this._setScript(a,c,this.subscript)},_setScript:function(a,c,_){var I=this.get2DCursorLocation(a,!0),y=this.getValueOfPropertyAt(I.lineIndex,I.charIndex,"fontSize"),w=this.getValueOfPropertyAt(I.lineIndex,I.charIndex,"deltaY");return this.setSelectionStyles({fontSize:y*_.size,deltaY:w+y*_.baseline},a,c),this},_hasStyleChanged:function(a,c){return a.fill!==c.fill||a.stroke!==c.stroke||a.strokeWidth!==c.strokeWidth||a.fontSize!==c.fontSize||a.fontFamily!==c.fontFamily||a.fontWeight!==c.fontWeight||a.fontStyle!==c.fontStyle||a.deltaY!==c.deltaY},_hasStyleChangedForSvg:function(a,c){return this._hasStyleChanged(a,c)||a.overline!==c.overline||a.underline!==c.underline||a.linethrough!==c.linethrough},_getLineLeftOffset:function(a){var c=this.getLineWidth(a),_=this.width-c,I=this.textAlign,y=this.direction,w=0,b=this.isEndOfWrapping(a);return"justify"===I||"justify-center"===I&&!b||"justify-right"===I&&!b||"justify-left"===I&&!b?0:("center"===I&&(w=_/2),"right"===I&&(w=_),"justify-center"===I&&(w=_/2),"justify-right"===I&&(w=_),"rtl"===y&&(w-=_),w)},_clearCache:function(){this.__lineWidths=[],this.__lineHeights=[],this.__charBounds=[]},_shouldClearDimensionCache:function(){var a=this._forceClearCache;return a||(a=this.hasStateChanged("_dimensionAffectingProps")),a&&(this.dirty=!0,this._forceClearCache=!1),a},getLineWidth:function(a){if(void 0!==this.__lineWidths[a])return this.__lineWidths[a];var c=this.measureLine(a).width;return this.__lineWidths[a]=c,c},_getWidthOfCharSpacing:function(){return 0!==this.charSpacing?this.fontSize*this.charSpacing/1e3:0},getValueOfPropertyAt:function(a,c,_){var I=this._getStyleDeclaration(a,c);return I&&void 0!==I[_]?I[_]:this[_]},_renderTextDecoration:function(a,c){if(this[c]||this.styleHas(c)){for(var _,I,y,w,b,x,O,F,L,N,j,$,X,ie,ee,Q,W=this._getLeftOffset(),H=this._getTopOffset(),Z=this.path,ne=this._getWidthOfCharSpacing(),re=this.offsets[c],z=0,Y=this._textLines.length;z<Y;z++)if(_=this.getHeightOfLine(z),this[c]||this.styleHas(c,z)){O=this._textLines[z],ie=_/this.lineHeight,w=this._getLineLeftOffset(z),N=0,j=0,F=this.getValueOfPropertyAt(z,0,c),Q=this.getValueOfPropertyAt(z,0,"fill"),L=H+ie*(1-this._fontSizeFraction),I=this.getHeightOfChar(z,0),b=this.getValueOfPropertyAt(z,0,"deltaY");for(var K=0,oe=O.length;K<oe;K++)if($=this.__charBounds[z][K],X=this.getValueOfPropertyAt(z,K,c),ee=this.getValueOfPropertyAt(z,K,"fill"),y=this.getHeightOfChar(z,K),x=this.getValueOfPropertyAt(z,K,"deltaY"),Z&&X&&ee)a.save(),a.fillStyle=Q,a.translate($.renderLeft,$.renderTop),a.rotate($.angle),a.fillRect(-$.kernedWidth/2,re*y+x,$.kernedWidth,this.fontSize/15),a.restore();else if((X!==F||ee!==Q||y!==I||x!==b)&&j>0){var te=W+w+N;"rtl"===this.direction&&(te=this.width-te-j),F&&Q&&(a.fillStyle=Q,a.fillRect(te,L+re*I+b,j,this.fontSize/15)),N=$.left,j=$.width,F=X,Q=ee,I=y,b=x}else j+=$.kernedWidth;te=W+w+N,"rtl"===this.direction&&(te=this.width-te-j),a.fillStyle=ee,X&&ee&&a.fillRect(te,L+re*I+b,j-ne,this.fontSize/15),H+=_}else H+=_;this._removeShadow(a)}},_getFontDeclaration:function(a,c){var _=a||this,I=this.fontFamily,y=f.Text.genericFonts.indexOf(I.toLowerCase())>-1,w=void 0===I||I.indexOf("'")>-1||I.indexOf(",")>-1||I.indexOf('"')>-1||y?_.fontFamily:'"'+_.fontFamily+'"';return[f.isLikelyNode?_.fontWeight:_.fontStyle,f.isLikelyNode?_.fontStyle:_.fontWeight,c?this.CACHE_FONT_SIZE+"px":_.fontSize+"px",w].join(" ")},render:function(a){this.visible&&(this.canvas&&this.canvas.skipOffscreen&&!this.group&&!this.isOnScreen()||(this._shouldClearDimensionCache()&&this.initDimensions(),this.callSuper("render",a)))},_splitTextIntoLines:function(a){for(var c=a.split(this._reNewline),_=new Array(c.length),I=["\n"],y=[],w=0;w<c.length;w++)_[w]=f.util.string.graphemeSplit(c[w]),y=y.concat(_[w],I);return y.pop(),{_unwrappedLines:_,lines:c,graphemeText:y,graphemeLines:_}},toObject:function(a){var c=v.concat(a),_=this.callSuper("toObject",c);return _.styles=g(this.styles,!0),_.path&&(_.path=this.path.toObject()),_},set:function(a,c){this.callSuper("set",a,c);var _=!1,I=!1;if("object"==typeof a)for(var y in a)"path"===y&&this.setPathInfo(),_=_||-1!==this._dimensionAffectingProps.indexOf(y),I=I||"path"===y;else _=-1!==this._dimensionAffectingProps.indexOf(a),I="path"===a;return I&&this.setPathInfo(),_&&(this.initDimensions(),this.setCoords()),this},complexity:function(){return 1}}),f.Text.ATTRIBUTE_NAMES=f.SHARED_ATTRIBUTES.concat("x y dx dy font-family font-style font-weight font-size letter-spacing text-decoration text-anchor".split(" ")),f.Text.DEFAULT_SVG_FONT_SIZE=16,f.Text.fromElement=function(a,c,_){if(!a)return c(null);var I=f.parseAttributes(a,f.Text.ATTRIBUTE_NAMES),y=I.textAnchor||"left";if((_=f.util.object.extend(_?g(_):{},I)).top=_.top||0,_.left=_.left||0,I.textDecoration){var w=I.textDecoration;-1!==w.indexOf("underline")&&(_.underline=!0),-1!==w.indexOf("overline")&&(_.overline=!0),-1!==w.indexOf("line-through")&&(_.linethrough=!0),delete _.textDecoration}"dx"in I&&(_.left+=I.dx),"dy"in I&&(_.top+=I.dy),"fontSize"in _||(_.fontSize=f.Text.DEFAULT_SVG_FONT_SIZE);var b="";"textContent"in a?b=a.textContent:"firstChild"in a&&null!==a.firstChild&&"data"in a.firstChild&&null!==a.firstChild.data&&(b=a.firstChild.data),b=b.replace(/^\s+|\s+$|\n+/g,"").replace(/\s+/g," ");var x=_.strokeWidth;_.strokeWidth=0;var O=new f.Text(b,_),F=O.getScaledHeight()/O.height,L=((O.height+O.strokeWidth)*O.lineHeight-O.height)*F,N=O.getScaledHeight()+L,j=0;"center"===y&&(j=O.getScaledWidth()/2),"right"===y&&(j=O.getScaledWidth()),O.set({left:O.left-j,top:O.top-(N-O.fontSize*(.07+O._fontSizeFraction))/O.lineHeight,strokeWidth:void 0!==x?x:1}),c(O)},f.Text.fromObject=function(a,c){var _=g(a),I=a.path;return delete _.path,f.Object._fromObject("Text",_,function(y){I?f.Object._fromObject("Path",I,function(w){y.set("path",w),c(y)},"path"):c(y)},"text")},f.Text.genericFonts=["sans-serif","serif","cursive","fantasy","monospace"],f.util.createAccessors&&f.util.createAccessors(f.Text)}}(n),S.util.object.extend(S.Text.prototype,{isEmptyStyles:function(m){if(!this.styles||void 0!==m&&!this.styles[m])return!0;var f=void 0===m?this.styles:{line:this.styles[m]};for(var g in f)for(var v in f[g])for(var a in f[g][v])return!1;return!0},styleHas:function(m,f){if(!this.styles||!m||""===m||void 0!==f&&!this.styles[f])return!1;var g=void 0===f?this.styles:{0:this.styles[f]};for(var v in g)for(var a in g[v])if(void 0!==g[v][a][m])return!0;return!1},cleanStyle:function(m){if(!this.styles||!m||""===m)return!1;var f,g,v=this.styles,a=0,c=!0,_=0;for(var I in v){for(var y in f=0,v[I]){var w;a++,(w=v[I][y]).hasOwnProperty(m)?(g?w[m]!==g&&(c=!1):g=w[m],w[m]===this[m]&&delete w[m]):c=!1,0!==Object.keys(w).length?f++:delete v[I][y]}0===f&&delete v[I]}for(var b=0;b<this._textLines.length;b++)_+=this._textLines[b].length;c&&a===_&&(this[m]=g,this.removeStyle(m))},removeStyle:function(m){if(this.styles&&m&&""!==m){var f,g,v,a=this.styles;for(g in a){for(v in f=a[g])delete f[v][m],0===Object.keys(f[v]).length&&delete f[v];0===Object.keys(f).length&&delete a[g]}}},_extendStyles:function(m,f){var g=this.get2DCursorLocation(m);this._getLineStyle(g.lineIndex)||this._setLineStyle(g.lineIndex),this._getStyleDeclaration(g.lineIndex,g.charIndex)||this._setStyleDeclaration(g.lineIndex,g.charIndex,{}),S.util.object.extend(this._getStyleDeclaration(g.lineIndex,g.charIndex),f)},get2DCursorLocation:function(m,f){void 0===m&&(m=this.selectionStart);for(var g=f?this._unwrappedTextLines:this._textLines,v=g.length,a=0;a<v;a++){if(m<=g[a].length)return{lineIndex:a,charIndex:m};m-=g[a].length+this.missingNewlineOffset(a)}return{lineIndex:a-1,charIndex:g[a-1].length<m?g[a-1].length:m}},getSelectionStyles:function(m,f,g){void 0===m&&(m=this.selectionStart||0),void 0===f&&(f=this.selectionEnd||m);for(var v=[],a=m;a<f;a++)v.push(this.getStyleAtPosition(a,g));return v},getStyleAtPosition:function(m,f){var g=this.get2DCursorLocation(m);return(f?this.getCompleteStyleDeclaration(g.lineIndex,g.charIndex):this._getStyleDeclaration(g.lineIndex,g.charIndex))||{}},setSelectionStyles:function(m,f,g){void 0===f&&(f=this.selectionStart||0),void 0===g&&(g=this.selectionEnd||f);for(var v=f;v<g;v++)this._extendStyles(v,m);return this._forceClearCache=!0,this},_getStyleDeclaration:function(m,f){var g=this.styles&&this.styles[m];return g?g[f]:null},getCompleteStyleDeclaration:function(m,f){for(var g,v=this._getStyleDeclaration(m,f)||{},a={},c=0;c<this._styleProperties.length;c++)a[g=this._styleProperties[c]]=void 0===v[g]?this[g]:v[g];return a},_setStyleDeclaration:function(m,f,g){this.styles[m][f]=g},_deleteStyleDeclaration:function(m,f){delete this.styles[m][f]},_getLineStyle:function(m){return!!this.styles[m]},_setLineStyle:function(m){this.styles[m]={}},_deleteLineStyle:function(m){delete this.styles[m]}}),function(){function m(f){f.textDecoration&&(f.textDecoration.indexOf("underline")>-1&&(f.underline=!0),f.textDecoration.indexOf("line-through")>-1&&(f.linethrough=!0),f.textDecoration.indexOf("overline")>-1&&(f.overline=!0),delete f.textDecoration)}S.IText=S.util.createClass(S.Text,S.Observable,{type:"i-text",selectionStart:0,selectionEnd:0,selectionColor:"rgba(17,119,255,0.3)",isEditing:!1,editable:!0,editingBorderColor:"rgba(102,153,255,0.25)",cursorWidth:2,cursorColor:"",cursorDelay:1e3,cursorDuration:600,caching:!0,hiddenTextareaContainer:null,_reSpace:/\s|\n/,_currentCursorOpacity:0,_selectionDirection:null,_abortCursorAnimation:!1,__widthOfSpace:[],inCompositionMode:!1,initialize:function(f,g){this.callSuper("initialize",f,g),this.initBehavior()},setSelectionStart:function(f){f=Math.max(f,0),this._updateAndFire("selectionStart",f)},setSelectionEnd:function(f){f=Math.min(f,this.text.length),this._updateAndFire("selectionEnd",f)},_updateAndFire:function(f,g){this[f]!==g&&(this._fireSelectionChanged(),this[f]=g),this._updateTextarea()},_fireSelectionChanged:function(){this.fire("selection:changed"),this.canvas&&this.canvas.fire("text:selection:changed",{target:this})},initDimensions:function(){this.isEditing&&this.initDelayedCursor(),this.clearContextTop(),this.callSuper("initDimensions")},render:function(f){this.clearContextTop(),this.callSuper("render",f),this.cursorOffsetCache={},this.renderCursorOrSelection()},_render:function(f){this.callSuper("_render",f)},clearContextTop:function(f){if(this.isEditing&&this.canvas&&this.canvas.contextTop){var g=this.canvas.contextTop,v=this.canvas.viewportTransform;g.save(),g.transform(v[0],v[1],v[2],v[3],v[4],v[5]),this.transform(g),this._clearTextArea(g),f||g.restore()}},renderCursorOrSelection:function(){if(this.isEditing&&this.canvas&&this.canvas.contextTop){var f=this._getCursorBoundaries(),g=this.canvas.contextTop;this.clearContextTop(!0),this.selectionStart===this.selectionEnd?this.renderCursor(f,g):this.renderSelection(f,g),g.restore()}},_clearTextArea:function(f){var g=this.width+4,v=this.height+4;f.clearRect(-g/2,-v/2,g,v)},_getCursorBoundaries:function(f){void 0===f&&(f=this.selectionStart);var g=this._getLeftOffset(),v=this._getTopOffset(),a=this._getCursorBoundariesOffsets(f);return{left:g,top:v,leftOffset:a.left,topOffset:a.top}},_getCursorBoundariesOffsets:function(f){if(this.cursorOffsetCache&&"top"in this.cursorOffsetCache)return this.cursorOffsetCache;var g,v,a,c,_=0,I=0,y=this.get2DCursorLocation(f);a=y.charIndex,v=y.lineIndex;for(var w=0;w<v;w++)_+=this.getHeightOfLine(w);g=this._getLineLeftOffset(v);var b=this.__charBounds[v][a];return b&&(I=b.left),0!==this.charSpacing&&a===this._textLines[v].length&&(I-=this._getWidthOfCharSpacing()),c={top:_,left:g+(I>0?I:0)},"rtl"===this.direction&&(c.left*=-1),this.cursorOffsetCache=c,this.cursorOffsetCache},renderCursor:function(f,g){var v=this.get2DCursorLocation(),a=v.lineIndex,c=v.charIndex>0?v.charIndex-1:0,_=this.getValueOfPropertyAt(a,c,"fontSize"),I=this.scaleX*this.canvas.getZoom(),y=this.cursorWidth/I,w=f.topOffset,b=this.getValueOfPropertyAt(a,c,"deltaY");w+=(1-this._fontSizeFraction)*this.getHeightOfLine(a)/this.lineHeight-_*(1-this._fontSizeFraction),this.inCompositionMode&&this.renderSelection(f,g),g.fillStyle=this.cursorColor||this.getValueOfPropertyAt(a,c,"fill"),g.globalAlpha=this.__isMousedown?1:this._currentCursorOpacity,g.fillRect(f.left+f.leftOffset-y/2,w+f.top+b,y,_)},renderSelection:function(f,g){for(var v=this.inCompositionMode?this.hiddenTextarea.selectionStart:this.selectionStart,a=this.inCompositionMode?this.hiddenTextarea.selectionEnd:this.selectionEnd,c=-1!==this.textAlign.indexOf("justify"),_=this.get2DCursorLocation(v),I=this.get2DCursorLocation(a),y=_.lineIndex,w=I.lineIndex,b=_.charIndex<0?0:_.charIndex,x=I.charIndex<0?0:I.charIndex,O=y;O<=w;O++){var F,L=this._getLineLeftOffset(O)||0,N=this.getHeightOfLine(O),j=0,$=0;if(O===y&&(j=this.__charBounds[y][b].left),O>=y&&O<w)$=c&&!this.isEndOfWrapping(O)?this.width:this.getLineWidth(O)||5;else if(O===w)if(0===x)$=this.__charBounds[w][x].left;else{var X=this._getWidthOfCharSpacing();$=this.__charBounds[w][x-1].left+this.__charBounds[w][x-1].width-X}F=N,(this.lineHeight<1||O===w&&this.lineHeight>1)&&(N/=this.lineHeight);var ie=f.left+L+j,ee=$-j,Q=N,W=0;this.inCompositionMode?(g.fillStyle=this.compositionColor||"black",Q=1,W=N):g.fillStyle=this.selectionColor,"rtl"===this.direction&&(ie=this.width-ie-ee),g.fillRect(ie,f.top+f.topOffset+W,ee,Q),f.topOffset+=F}},getCurrentCharFontSize:function(){var f=this._getCurrentCharIndex();return this.getValueOfPropertyAt(f.l,f.c,"fontSize")},getCurrentCharColor:function(){var f=this._getCurrentCharIndex();return this.getValueOfPropertyAt(f.l,f.c,"fill")},_getCurrentCharIndex:function(){var f=this.get2DCursorLocation(this.selectionStart,!0);return{l:f.lineIndex,c:f.charIndex>0?f.charIndex-1:0}}}),S.IText.fromObject=function(f,g){if(m(f),f.styles)for(var v in f.styles)for(var a in f.styles[v])m(f.styles[v][a]);S.Object._fromObject("IText",f,g,"text")}}(),me=S.util.object.clone,S.util.object.extend(S.IText.prototype,{initBehavior:function(){this.initAddedHandler(),this.initRemovedHandler(),this.initCursorSelectionHandlers(),this.initDoubleClickSimulation(),this.mouseMoveHandler=this.mouseMoveHandler.bind(this)},onDeselect:function(){this.isEditing&&this.exitEditing(),this.selected=!1},initAddedHandler:function(){var m=this;this.on("added",function(){var f=m.canvas;f&&(f._hasITextHandlers||(f._hasITextHandlers=!0,m._initCanvasHandlers(f)),f._iTextInstances=f._iTextInstances||[],f._iTextInstances.push(m))})},initRemovedHandler:function(){var m=this;this.on("removed",function(){var f=m.canvas;f&&(f._iTextInstances=f._iTextInstances||[],S.util.removeFromArray(f._iTextInstances,m),0===f._iTextInstances.length&&(f._hasITextHandlers=!1,m._removeCanvasHandlers(f)))})},_initCanvasHandlers:function(m){m._mouseUpITextHandler=function(){m._iTextInstances&&m._iTextInstances.forEach(function(f){f.__isMousedown=!1})},m.on("mouse:up",m._mouseUpITextHandler)},_removeCanvasHandlers:function(m){m.off("mouse:up",m._mouseUpITextHandler)},_tick:function(){this._currentTickState=this._animateCursor(this,1,this.cursorDuration,"_onTickComplete")},_animateCursor:function(m,f,g,v){var a;return a={isAborted:!1,abort:function(){this.isAborted=!0}},m.animate("_currentCursorOpacity",f,{duration:g,onComplete:function(){a.isAborted||m[v]()},onChange:function(){m.canvas&&m.selectionStart===m.selectionEnd&&m.renderCursorOrSelection()},abort:function(){return a.isAborted}}),a},_onTickComplete:function(){var m=this;this._cursorTimeout1&&clearTimeout(this._cursorTimeout1),this._cursorTimeout1=setTimeout(function(){m._currentTickCompleteState=m._animateCursor(m,0,this.cursorDuration/2,"_tick")},100)},initDelayedCursor:function(m){var f=this,g=m?0:this.cursorDelay;this.abortCursorAnimation(),this._currentCursorOpacity=1,this._cursorTimeout2=setTimeout(function(){f._tick()},g)},abortCursorAnimation:function(){var m=this._currentTickState||this._currentTickCompleteState,f=this.canvas;this._currentTickState&&this._currentTickState.abort(),this._currentTickCompleteState&&this._currentTickCompleteState.abort(),clearTimeout(this._cursorTimeout1),clearTimeout(this._cursorTimeout2),this._currentCursorOpacity=0,m&&f&&f.clearContext(f.contextTop||f.contextContainer)},selectAll:function(){return this.selectionStart=0,this.selectionEnd=this._text.length,this._fireSelectionChanged(),this._updateTextarea(),this},getSelectedText:function(){return this._text.slice(this.selectionStart,this.selectionEnd).join("")},findWordBoundaryLeft:function(m){var f=0,g=m-1;if(this._reSpace.test(this._text[g]))for(;this._reSpace.test(this._text[g]);)f++,g--;for(;/\S/.test(this._text[g])&&g>-1;)f++,g--;return m-f},findWordBoundaryRight:function(m){var f=0,g=m;if(this._reSpace.test(this._text[g]))for(;this._reSpace.test(this._text[g]);)f++,g++;for(;/\S/.test(this._text[g])&&g<this._text.length;)f++,g++;return m+f},findLineBoundaryLeft:function(m){for(var f=0,g=m-1;!/\n/.test(this._text[g])&&g>-1;)f++,g--;return m-f},findLineBoundaryRight:function(m){for(var f=0,g=m;!/\n/.test(this._text[g])&&g<this._text.length;)f++,g++;return m+f},searchWordBoundary:function(m,f){for(var g=this._text,v=this._reSpace.test(g[m])?m-1:m,a=g[v],c=S.reNonWord;!c.test(a)&&v>0&&v<g.length;)a=g[v+=f];return c.test(a)&&(v+=1===f?0:1),v},selectWord:function(m){var f=this.searchWordBoundary(m=m||this.selectionStart,-1),g=this.searchWordBoundary(m,1);this.selectionStart=f,this.selectionEnd=g,this._fireSelectionChanged(),this._updateTextarea(),this.renderCursorOrSelection()},selectLine:function(m){var f=this.findLineBoundaryLeft(m=m||this.selectionStart),g=this.findLineBoundaryRight(m);return this.selectionStart=f,this.selectionEnd=g,this._fireSelectionChanged(),this._updateTextarea(),this},enterEditing:function(m){if(!this.isEditing&&this.editable)return this.canvas&&(this.canvas.calcOffset(),this.exitEditingOnOthers(this.canvas)),this.isEditing=!0,this.initHiddenTextarea(m),this.hiddenTextarea.focus(),this.hiddenTextarea.value=this.text,this._updateTextarea(),this._saveEditingProps(),this._setEditingProps(),this._textBeforeEdit=this.text,this._tick(),this.fire("editing:entered"),this._fireSelectionChanged(),this.canvas?(this.canvas.fire("text:editing:entered",{target:this}),this.initMouseMoveHandler(),this.canvas.requestRenderAll(),this):this},exitEditingOnOthers:function(m){m._iTextInstances&&m._iTextInstances.forEach(function(f){f.selected=!1,f.isEditing&&f.exitEditing()})},initMouseMoveHandler:function(){this.canvas.on("mouse:move",this.mouseMoveHandler)},mouseMoveHandler:function(m){if(this.__isMousedown&&this.isEditing){var f=this.getSelectionStartFromPointer(m.e),g=this.selectionStart,v=this.selectionEnd;(f===this.__selectionStartOnMouseDown&&g!==v||g!==f&&v!==f)&&(f>this.__selectionStartOnMouseDown?(this.selectionStart=this.__selectionStartOnMouseDown,this.selectionEnd=f):(this.selectionStart=f,this.selectionEnd=this.__selectionStartOnMouseDown),this.selectionStart===g&&this.selectionEnd===v||(this.restartCursorIfNeeded(),this._fireSelectionChanged(),this._updateTextarea(),this.renderCursorOrSelection()))}},_setEditingProps:function(){this.hoverCursor="text",this.canvas&&(this.canvas.defaultCursor=this.canvas.moveCursor="text"),this.borderColor=this.editingBorderColor,this.hasControls=this.selectable=!1,this.lockMovementX=this.lockMovementY=!0},fromStringToGraphemeSelection:function(m,f,g){var v=g.slice(0,m),a=S.util.string.graphemeSplit(v).length;if(m===f)return{selectionStart:a,selectionEnd:a};var c=g.slice(m,f);return{selectionStart:a,selectionEnd:a+S.util.string.graphemeSplit(c).length}},fromGraphemeToStringSelection:function(m,f,g){var v=g.slice(0,m).join("").length;return m===f?{selectionStart:v,selectionEnd:v}:{selectionStart:v,selectionEnd:v+g.slice(m,f).join("").length}},_updateTextarea:function(){if(this.cursorOffsetCache={},this.hiddenTextarea){if(!this.inCompositionMode){var m=this.fromGraphemeToStringSelection(this.selectionStart,this.selectionEnd,this._text);this.hiddenTextarea.selectionStart=m.selectionStart,this.hiddenTextarea.selectionEnd=m.selectionEnd}this.updateTextareaPosition()}},updateFromTextArea:function(){if(this.hiddenTextarea){this.cursorOffsetCache={},this.text=this.hiddenTextarea.value,this._shouldClearDimensionCache()&&(this.initDimensions(),this.setCoords());var m=this.fromStringToGraphemeSelection(this.hiddenTextarea.selectionStart,this.hiddenTextarea.selectionEnd,this.hiddenTextarea.value);this.selectionEnd=this.selectionStart=m.selectionEnd,this.inCompositionMode||(this.selectionStart=m.selectionStart),this.updateTextareaPosition()}},updateTextareaPosition:function(){if(this.selectionStart===this.selectionEnd){var m=this._calcTextareaPosition();this.hiddenTextarea.style.left=m.left,this.hiddenTextarea.style.top=m.top}},_calcTextareaPosition:function(){if(!this.canvas)return{x:1,y:1};var m=this.inCompositionMode?this.compositionStart:this.selectionStart,f=this._getCursorBoundaries(m),g=this.get2DCursorLocation(m),c=this.getValueOfPropertyAt(g.lineIndex,g.charIndex,"fontSize")*this.lineHeight,_=f.leftOffset,I=this.calcTransformMatrix(),y={x:f.left+_,y:f.top+f.topOffset+c},w=this.canvas.getRetinaScaling(),b=this.canvas.upperCanvasEl,x=b.width/w,O=b.height/w,F=x-c,L=O-c,N=b.clientWidth/x,j=b.clientHeight/O;return y=S.util.transformPoint(y,I),(y=S.util.transformPoint(y,this.canvas.viewportTransform)).x*=N,y.y*=j,y.x<0&&(y.x=0),y.x>F&&(y.x=F),y.y<0&&(y.y=0),y.y>L&&(y.y=L),y.x+=this.canvas._offset.left,y.y+=this.canvas._offset.top,{left:y.x+"px",top:y.y+"px",fontSize:c+"px",charHeight:c}},_saveEditingProps:function(){this._savedProps={hasControls:this.hasControls,borderColor:this.borderColor,lockMovementX:this.lockMovementX,lockMovementY:this.lockMovementY,hoverCursor:this.hoverCursor,selectable:this.selectable,defaultCursor:this.canvas&&this.canvas.defaultCursor,moveCursor:this.canvas&&this.canvas.moveCursor}},_restoreEditingProps:function(){this._savedProps&&(this.hoverCursor=this._savedProps.hoverCursor,this.hasControls=this._savedProps.hasControls,this.borderColor=this._savedProps.borderColor,this.selectable=this._savedProps.selectable,this.lockMovementX=this._savedProps.lockMovementX,this.lockMovementY=this._savedProps.lockMovementY,this.canvas&&(this.canvas.defaultCursor=this._savedProps.defaultCursor,this.canvas.moveCursor=this._savedProps.moveCursor))},exitEditing:function(){var m=this._textBeforeEdit!==this.text,f=this.hiddenTextarea;return this.selected=!1,this.isEditing=!1,this.selectionEnd=this.selectionStart,f&&(f.blur&&f.blur(),f.parentNode&&f.parentNode.removeChild(f)),this.hiddenTextarea=null,this.abortCursorAnimation(),this._restoreEditingProps(),this._currentCursorOpacity=0,this._shouldClearDimensionCache()&&(this.initDimensions(),this.setCoords()),this.fire("editing:exited"),m&&this.fire("modified"),this.canvas&&(this.canvas.off("mouse:move",this.mouseMoveHandler),this.canvas.fire("text:editing:exited",{target:this}),m&&this.canvas.fire("object:modified",{target:this})),this},_removeExtraneousStyles:function(){for(var m in this.styles)this._textLines[m]||delete this.styles[m]},removeStyleFromTo:function(m,f){var g,v,a=this.get2DCursorLocation(m,!0),c=this.get2DCursorLocation(f,!0),_=a.lineIndex,I=a.charIndex,y=c.lineIndex,w=c.charIndex;if(_!==y){if(this.styles[_])for(g=I;g<this._unwrappedTextLines[_].length;g++)delete this.styles[_][g];if(this.styles[y])for(g=w;g<this._unwrappedTextLines[y].length;g++)(v=this.styles[y][g])&&(this.styles[_]||(this.styles[_]={}),this.styles[_][I+g-w]=v);for(g=_+1;g<=y;g++)delete this.styles[g];this.shiftLineStyles(y,_-y)}else if(this.styles[_]){v=this.styles[_];var b,x,O=w-I;for(g=I;g<w;g++)delete v[g];for(x in this.styles[_])(b=parseInt(x,10))>=w&&(v[b-O]=v[x],delete v[x])}},shiftLineStyles:function(m,f){var g=me(this.styles);for(var v in this.styles){var a=parseInt(v,10);a>m&&(this.styles[a+f]=g[a],g[a-f]||delete this.styles[a])}},restartCursorIfNeeded:function(){this._currentTickState&&!this._currentTickState.isAborted&&this._currentTickCompleteState&&!this._currentTickCompleteState.isAborted||this.initDelayedCursor()},insertNewlineStyleObject:function(m,f,g,v){var a,c={},_=!1,I=this._unwrappedTextLines[m].length===f;for(var y in g||(g=1),this.shiftLineStyles(m,g),this.styles[m]&&(a=this.styles[m][0===f?f:f-1]),this.styles[m]){var w=parseInt(y,10);w>=f&&(_=!0,c[w-f]=this.styles[m][y],I&&0===f||delete this.styles[m][y])}var b=!1;for(_&&!I&&(this.styles[m+g]=c,b=!0),b&&g--;g>0;)v&&v[g-1]?this.styles[m+g]={0:me(v[g-1])}:a?this.styles[m+g]={0:me(a)}:delete this.styles[m+g],g--;this._forceClearCache=!0},insertCharStyleObject:function(m,f,g,v){this.styles||(this.styles={});var a=this.styles[m],c=a?me(a):{};for(var _ in g||(g=1),c){var I=parseInt(_,10);I>=f&&(a[I+g]=c[I],c[I-g]||delete a[I])}if(this._forceClearCache=!0,v)for(;g--;)Object.keys(v[g]).length&&(this.styles[m]||(this.styles[m]={}),this.styles[m][f+g]=me(v[g]));else if(a)for(var y=a[f?f-1:1];y&&g--;)this.styles[m][f+g]=me(y)},insertNewStyleBlock:function(m,f,g){for(var v=this.get2DCursorLocation(f,!0),a=[0],c=0,_=0;_<m.length;_++)"\n"===m[_]?a[++c]=0:a[c]++;for(a[0]>0&&(this.insertCharStyleObject(v.lineIndex,v.charIndex,a[0],g),g=g&&g.slice(a[0]+1)),c&&this.insertNewlineStyleObject(v.lineIndex,v.charIndex+a[0],c),_=1;_<c;_++)a[_]>0?this.insertCharStyleObject(v.lineIndex+_,0,a[_],g):g&&this.styles[v.lineIndex+_]&&g[0]&&(this.styles[v.lineIndex+_][0]=g[0]),g=g&&g.slice(a[_]+1);a[_]>0&&this.insertCharStyleObject(v.lineIndex+_,0,a[_],g)},setSelectionStartEndWithShift:function(m,f,g){g<=m?(f===m?this._selectionDirection="left":"right"===this._selectionDirection&&(this._selectionDirection="left",this.selectionEnd=m),this.selectionStart=g):g>m&&g<f?"right"===this._selectionDirection?this.selectionEnd=g:this.selectionStart=g:(f===m?this._selectionDirection="right":"left"===this._selectionDirection&&(this._selectionDirection="right",this.selectionStart=f),this.selectionEnd=g)},setSelectionInBoundaries:function(){var m=this.text.length;this.selectionStart>m?this.selectionStart=m:this.selectionStart<0&&(this.selectionStart=0),this.selectionEnd>m?this.selectionEnd=m:this.selectionEnd<0&&(this.selectionEnd=0)}}),S.util.object.extend(S.IText.prototype,{initDoubleClickSimulation:function(){this.__lastClickTime=+new Date,this.__lastLastClickTime=+new Date,this.__lastPointer={},this.on("mousedown",this.onMouseDown)},onMouseDown:function(m){if(this.canvas){this.__newClickTime=+new Date;var f=m.pointer;this.isTripleClick(f)&&(this.fire("tripleclick",m),this._stopEvent(m.e)),this.__lastLastClickTime=this.__lastClickTime,this.__lastClickTime=this.__newClickTime,this.__lastPointer=f,this.__lastIsEditing=this.isEditing,this.__lastSelected=this.selected}},isTripleClick:function(m){return this.__newClickTime-this.__lastClickTime<500&&this.__lastClickTime-this.__lastLastClickTime<500&&this.__lastPointer.x===m.x&&this.__lastPointer.y===m.y},_stopEvent:function(m){m.preventDefault&&m.preventDefault(),m.stopPropagation&&m.stopPropagation()},initCursorSelectionHandlers:function(){this.initMousedownHandler(),this.initMouseupHandler(),this.initClicks()},doubleClickHandler:function(m){this.isEditing&&this.selectWord(this.getSelectionStartFromPointer(m.e))},tripleClickHandler:function(m){this.isEditing&&this.selectLine(this.getSelectionStartFromPointer(m.e))},initClicks:function(){this.on("mousedblclick",this.doubleClickHandler),this.on("tripleclick",this.tripleClickHandler)},_mouseDownHandler:function(m){!this.canvas||!this.editable||m.e.button&&1!==m.e.button||(this.__isMousedown=!0,this.selected&&(this.inCompositionMode=!1,this.setCursorByClick(m.e)),this.isEditing&&(this.__selectionStartOnMouseDown=this.selectionStart,this.selectionStart===this.selectionEnd&&this.abortCursorAnimation(),this.renderCursorOrSelection()))},_mouseDownHandlerBefore:function(m){!this.canvas||!this.editable||m.e.button&&1!==m.e.button||(this.selected=this===this.canvas._activeObject)},initMousedownHandler:function(){this.on("mousedown",this._mouseDownHandler),this.on("mousedown:before",this._mouseDownHandlerBefore)},initMouseupHandler:function(){this.on("mouseup",this.mouseUpHandler)},mouseUpHandler:function(m){if(this.__isMousedown=!1,!(!this.editable||this.group||m.transform&&m.transform.actionPerformed||m.e.button&&1!==m.e.button)){if(this.canvas){var f=this.canvas._activeObject;if(f&&f!==this)return}this.__lastSelected&&!this.__corner?(this.selected=!1,this.__lastSelected=!1,this.enterEditing(m.e),this.selectionStart===this.selectionEnd?this.initDelayedCursor(!0):this.renderCursorOrSelection()):this.selected=!0}},setCursorByClick:function(m){var f=this.getSelectionStartFromPointer(m);m.shiftKey?this.setSelectionStartEndWithShift(this.selectionStart,this.selectionEnd,f):(this.selectionStart=f,this.selectionEnd=f),this.isEditing&&(this._fireSelectionChanged(),this._updateTextarea())},getSelectionStartFromPointer:function(m){for(var f,g=this.getLocalPointer(m),v=0,a=0,c=0,_=0,I=0,y=0,w=this._textLines.length;y<w&&c<=g.y;y++)c+=this.getHeightOfLine(y)*this.scaleY,I=y,y>0&&(_+=this._textLines[y-1].length+this.missingNewlineOffset(y-1));a=this._getLineLeftOffset(I)*this.scaleX,f=this._textLines[I],"rtl"===this.direction&&(g.x=this.width*this.scaleX-g.x+a);for(var b=0,x=f.length;b<x&&(v=a,(a+=this.__charBounds[I][b].kernedWidth*this.scaleX)<=g.x);b++)_++;return this._getNewSelectionStartFromOffset(g,v,a,_,x)},_getNewSelectionStartFromOffset:function(m,f,g,v,a){var _=g-m.x,I=v+(_>m.x-f||_<0?0:1);return this.flipX&&(I=a-I),I>this._text.length&&(I=this._text.length),I}}),S.util.object.extend(S.IText.prototype,{initHiddenTextarea:function(){this.hiddenTextarea=S.document.createElement("textarea"),this.hiddenTextarea.setAttribute("autocapitalize","off"),this.hiddenTextarea.setAttribute("autocorrect","off"),this.hiddenTextarea.setAttribute("autocomplete","off"),this.hiddenTextarea.setAttribute("spellcheck","false"),this.hiddenTextarea.setAttribute("data-fabric-hiddentextarea",""),this.hiddenTextarea.setAttribute("wrap","off");var m=this._calcTextareaPosition();this.hiddenTextarea.style.cssText="position: absolute; top: "+m.top+"; left: "+m.left+"; z-index: -999; opacity: 0; width: 1px; height: 1px; font-size: 1px; padding\uff70top: "+m.fontSize+";",this.hiddenTextareaContainer?this.hiddenTextareaContainer.appendChild(this.hiddenTextarea):S.document.body.appendChild(this.hiddenTextarea),S.util.addListener(this.hiddenTextarea,"keydown",this.onKeyDown.bind(this)),S.util.addListener(this.hiddenTextarea,"keyup",this.onKeyUp.bind(this)),S.util.addListener(this.hiddenTextarea,"input",this.onInput.bind(this)),S.util.addListener(this.hiddenTextarea,"copy",this.copy.bind(this)),S.util.addListener(this.hiddenTextarea,"cut",this.copy.bind(this)),S.util.addListener(this.hiddenTextarea,"paste",this.paste.bind(this)),S.util.addListener(this.hiddenTextarea,"compositionstart",this.onCompositionStart.bind(this)),S.util.addListener(this.hiddenTextarea,"compositionupdate",this.onCompositionUpdate.bind(this)),S.util.addListener(this.hiddenTextarea,"compositionend",this.onCompositionEnd.bind(this)),!this._clickHandlerInitialized&&this.canvas&&(S.util.addListener(this.canvas.upperCanvasEl,"click",this.onClick.bind(this)),this._clickHandlerInitialized=!0)},keysMap:{9:"exitEditing",27:"exitEditing",33:"moveCursorUp",34:"moveCursorDown",35:"moveCursorRight",36:"moveCursorLeft",37:"moveCursorLeft",38:"moveCursorUp",39:"moveCursorRight",40:"moveCursorDown"},keysMapRtl:{9:"exitEditing",27:"exitEditing",33:"moveCursorUp",34:"moveCursorDown",35:"moveCursorLeft",36:"moveCursorRight",37:"moveCursorRight",38:"moveCursorUp",39:"moveCursorLeft",40:"moveCursorDown"},ctrlKeysMapUp:{67:"copy",88:"cut"},ctrlKeysMapDown:{65:"selectAll"},onClick:function(){this.hiddenTextarea&&this.hiddenTextarea.focus()},onKeyDown:function(m){if(this.isEditing){var f="rtl"===this.direction?this.keysMapRtl:this.keysMap;if(m.keyCode in f)this[f[m.keyCode]](m);else{if(!(m.keyCode in this.ctrlKeysMapDown)||!m.ctrlKey&&!m.metaKey)return;this[this.ctrlKeysMapDown[m.keyCode]](m)}m.stopImmediatePropagation(),m.preventDefault(),m.keyCode>=33&&m.keyCode<=40?(this.inCompositionMode=!1,this.clearContextTop(),this.renderCursorOrSelection()):this.canvas&&this.canvas.requestRenderAll()}},onKeyUp:function(m){!this.isEditing||this._copyDone||this.inCompositionMode?this._copyDone=!1:m.keyCode in this.ctrlKeysMapUp&&(m.ctrlKey||m.metaKey)&&(this[this.ctrlKeysMapUp[m.keyCode]](m),m.stopImmediatePropagation(),m.preventDefault(),this.canvas&&this.canvas.requestRenderAll())},onInput:function(m){var f=this.fromPaste;if(this.fromPaste=!1,m&&m.stopPropagation(),this.isEditing){var g,v,a,c,_,I=this._splitTextIntoLines(this.hiddenTextarea.value).graphemeText,y=this._text.length,w=I.length,b=w-y,x=this.selectionStart,O=this.selectionEnd,F=x!==O;if(""===this.hiddenTextarea.value)return this.styles={},this.updateFromTextArea(),this.fire("changed"),void(this.canvas&&(this.canvas.fire("text:changed",{target:this}),this.canvas.requestRenderAll()));var L=this.fromStringToGraphemeSelection(this.hiddenTextarea.selectionStart,this.hiddenTextarea.selectionEnd,this.hiddenTextarea.value),N=x>L.selectionStart;F?(g=this._text.slice(x,O),b+=O-x):w<y&&(g=N?this._text.slice(O+b,O):this._text.slice(x,x-b)),v=I.slice(L.selectionEnd-b,L.selectionEnd),g&&g.length&&(v.length&&(a=this.getSelectionStyles(x,x+1,!1),a=v.map(function(){return a[0]})),F?(c=x,_=O):N?(c=O-g.length,_=O):(c=O,_=O+g.length),this.removeStyleFromTo(c,_)),v.length&&(f&&v.join("")===S.copiedText&&!S.disableStyleCopyPaste&&(a=S.copiedTextStyle),this.insertNewStyleBlock(v,x,a)),this.updateFromTextArea(),this.fire("changed"),this.canvas&&(this.canvas.fire("text:changed",{target:this}),this.canvas.requestRenderAll())}},onCompositionStart:function(){this.inCompositionMode=!0},onCompositionEnd:function(){this.inCompositionMode=!1},onCompositionUpdate:function(m){this.compositionStart=m.target.selectionStart,this.compositionEnd=m.target.selectionEnd,this.updateTextareaPosition()},copy:function(){this.selectionStart!==this.selectionEnd&&(S.copiedText=this.getSelectedText(),S.copiedTextStyle=S.disableStyleCopyPaste?null:this.getSelectionStyles(this.selectionStart,this.selectionEnd,!0),this._copyDone=!0)},paste:function(){this.fromPaste=!0},_getClipboardData:function(m){return m&&m.clipboardData||S.window.clipboardData},_getWidthBeforeCursor:function(m,f){var g,v=this._getLineLeftOffset(m);return f>0&&(v+=(g=this.__charBounds[m][f-1]).left+g.width),v},getDownCursorOffset:function(m,f){var g=this._getSelectionForOffset(m,f),v=this.get2DCursorLocation(g),a=v.lineIndex;if(a===this._textLines.length-1||m.metaKey||34===m.keyCode)return this._text.length-g;var c=v.charIndex,_=this._getWidthBeforeCursor(a,c),I=this._getIndexOnLine(a+1,_);return this._textLines[a].slice(c).length+I+1+this.missingNewlineOffset(a)},_getSelectionForOffset:function(m,f){return m.shiftKey&&this.selectionStart!==this.selectionEnd&&f?this.selectionEnd:this.selectionStart},getUpCursorOffset:function(m,f){var g=this._getSelectionForOffset(m,f),v=this.get2DCursorLocation(g),a=v.lineIndex;if(0===a||m.metaKey||33===m.keyCode)return-g;var c=v.charIndex,_=this._getWidthBeforeCursor(a,c),I=this._getIndexOnLine(a-1,_),y=this._textLines[a].slice(0,c),w=this.missingNewlineOffset(a-1);return-this._textLines[a-1].length+I-y.length+(1-w)},_getIndexOnLine:function(m,f){for(var g,v,a=this._textLines[m],c=this._getLineLeftOffset(m),_=0,I=0,y=a.length;I<y;I++)if((c+=g=this.__charBounds[m][I].width)>f){v=!0;var b=c,x=Math.abs(c-g-f);_=Math.abs(b-f)<x?I:I-1;break}return v||(_=a.length-1),_},moveCursorDown:function(m){this.selectionStart>=this._text.length&&this.selectionEnd>=this._text.length||this._moveCursorUpOrDown("Down",m)},moveCursorUp:function(m){0===this.selectionStart&&0===this.selectionEnd||this._moveCursorUpOrDown("Up",m)},_moveCursorUpOrDown:function(m,f){var g=this["get"+m+"CursorOffset"](f,"right"===this._selectionDirection);f.shiftKey?this.moveCursorWithShift(g):this.moveCursorWithoutShift(g),0!==g&&(this.setSelectionInBoundaries(),this.abortCursorAnimation(),this._currentCursorOpacity=1,this.initDelayedCursor(),this._fireSelectionChanged(),this._updateTextarea())},moveCursorWithShift:function(m){return this.setSelectionStartEndWithShift(this.selectionStart,this.selectionEnd,"left"===this._selectionDirection?this.selectionStart+m:this.selectionEnd+m),0!==m},moveCursorWithoutShift:function(m){return m<0?(this.selectionStart+=m,this.selectionEnd=this.selectionStart):(this.selectionEnd+=m,this.selectionStart=this.selectionEnd),0!==m},moveCursorLeft:function(m){0===this.selectionStart&&0===this.selectionEnd||this._moveCursorLeftOrRight("Left",m)},_move:function(m,f,g){var v;if(m.altKey)v=this["findWordBoundary"+g](this[f]);else{if(!m.metaKey&&35!==m.keyCode&&36!==m.keyCode)return this[f]+="Left"===g?-1:1,!0;v=this["findLineBoundary"+g](this[f])}if(void 0!==typeof v&&this[f]!==v)return this[f]=v,!0},_moveLeft:function(m,f){return this._move(m,f,"Left")},_moveRight:function(m,f){return this._move(m,f,"Right")},moveCursorLeftWithoutShift:function(m){var f=!0;return this._selectionDirection="left",this.selectionEnd===this.selectionStart&&0!==this.selectionStart&&(f=this._moveLeft(m,"selectionStart")),this.selectionEnd=this.selectionStart,f},moveCursorLeftWithShift:function(m){return"right"===this._selectionDirection&&this.selectionStart!==this.selectionEnd?this._moveLeft(m,"selectionEnd"):0!==this.selectionStart?(this._selectionDirection="left",this._moveLeft(m,"selectionStart")):void 0},moveCursorRight:function(m){this.selectionStart>=this._text.length&&this.selectionEnd>=this._text.length||this._moveCursorLeftOrRight("Right",m)},_moveCursorLeftOrRight:function(m,f){var g="moveCursor"+m+"With";this._currentCursorOpacity=1,this[g+=f.shiftKey?"Shift":"outShift"](f)&&(this.abortCursorAnimation(),this.initDelayedCursor(),this._fireSelectionChanged(),this._updateTextarea())},moveCursorRightWithShift:function(m){return"left"===this._selectionDirection&&this.selectionStart!==this.selectionEnd?this._moveRight(m,"selectionStart"):this.selectionEnd!==this._text.length?(this._selectionDirection="right",this._moveRight(m,"selectionEnd")):void 0},moveCursorRightWithoutShift:function(m){var f=!0;return this._selectionDirection="right",this.selectionStart===this.selectionEnd?(f=this._moveRight(m,"selectionStart"),this.selectionEnd=this.selectionStart):this.selectionStart=this.selectionEnd,f},removeChars:function(m,f){void 0===f&&(f=m+1),this.removeStyleFromTo(m,f),this._text.splice(m,f-m),this.text=this._text.join(""),this.set("dirty",!0),this._shouldClearDimensionCache()&&(this.initDimensions(),this.setCoords()),this._removeExtraneousStyles()},insertChars:function(m,f,g,v){void 0===v&&(v=g),v>g&&this.removeStyleFromTo(g,v);var a=S.util.string.graphemeSplit(m);this.insertNewStyleBlock(a,g,f),this._text=[].concat(this._text.slice(0,g),a,this._text.slice(v)),this.text=this._text.join(""),this.set("dirty",!0),this._shouldClearDimensionCache()&&(this.initDimensions(),this.setCoords()),this._removeExtraneousStyles()}}),function(){var m=S.util.toFixed,f=/  +/g;S.util.object.extend(S.Text.prototype,{_toSVG:function(){var g=this._getSVGLeftTopOffsets(),v=this._getSVGTextAndBg(g.textTop,g.textLeft);return this._wrapSVGTextAndBg(v)},toSVG:function(g){return this._createBaseSVGMarkup(this._toSVG(),{reviver:g,noStyle:!0,withShadow:!0})},_getSVGLeftTopOffsets:function(){return{textLeft:-this.width/2,textTop:-this.height/2,lineTop:this.getHeightOfLine(0)}},_wrapSVGTextAndBg:function(g){var v=this.getSvgTextDecoration(this);return[g.textBgRects.join(""),'\t\t<text xml:space="preserve" ',this.fontFamily?'font-family="'+this.fontFamily.replace(/"/g,"'")+'" ':"",this.fontSize?'font-size="'+this.fontSize+'" ':"",this.fontStyle?'font-style="'+this.fontStyle+'" ':"",this.fontWeight?'font-weight="'+this.fontWeight+'" ':"",v?'text-decoration="'+v+'" ':"",'style="',this.getSvgStyles(!0),'"',this.addPaintOrder()," >",g.textSpans.join(""),"</text>\n"]},_getSVGTextAndBg:function(g,v){var a,c=[],_=[],I=g;this._setSVGBg(_);for(var y=0,w=this._textLines.length;y<w;y++)a=this._getLineLeftOffset(y),(this.textBackgroundColor||this.styleHas("textBackgroundColor",y))&&this._setSVGTextLineBg(_,y,v+a,I),this._setSVGTextLineText(c,y,v+a,I),I+=this.getHeightOfLine(y);return{textSpans:c,textBgRects:_}},_createTextCharSpan:function(g,v,a,c){var _=g!==g.trim()||g.match(f),I=this.getSvgSpanStyles(v,_),y=I?'style="'+I+'"':"",w=v.deltaY,b="",x=S.Object.NUM_FRACTION_DIGITS;return w&&(b=' dy="'+m(w,x)+'" '),['<tspan x="',m(a,x),'" y="',m(c,x),'" ',b,y,">",S.util.string.escapeXml(g),"</tspan>"].join("")},_setSVGTextLineText:function(g,v,a,c){var _,I,y,w,b,x=this.getHeightOfLine(v),O=-1!==this.textAlign.indexOf("justify"),F="",L=0,N=this._textLines[v];c+=x*(1-this._fontSizeFraction)/this.lineHeight;for(var j=0,$=N.length-1;j<=$;j++)b=j===$||this.charSpacing,F+=N[j],y=this.__charBounds[v][j],0===L?(a+=y.kernedWidth-y.width,L+=y.width):L+=y.kernedWidth,O&&!b&&this._reSpaceAndTab.test(N[j])&&(b=!0),b||(_=_||this.getCompleteStyleDeclaration(v,j),I=this.getCompleteStyleDeclaration(v,j+1),b=this._hasStyleChangedForSvg(_,I)),b&&(w=this._getStyleDeclaration(v,j)||{},g.push(this._createTextCharSpan(F,w,a,c)),F="",_=I,a+=L,L=0)},_pushTextBgRect:function(g,v,a,c,_,I){var y=S.Object.NUM_FRACTION_DIGITS;g.push("\t\t<rect ",this._getFillAttributes(v),' x="',m(a,y),'" y="',m(c,y),'" width="',m(_,y),'" height="',m(I,y),'"></rect>\n')},_setSVGTextLineBg:function(g,v,a,c){for(var _,I,y=this._textLines[v],w=this.getHeightOfLine(v)/this.lineHeight,b=0,x=0,O=this.getValueOfPropertyAt(v,0,"textBackgroundColor"),F=0,L=y.length;F<L;F++)_=this.__charBounds[v][F],(I=this.getValueOfPropertyAt(v,F,"textBackgroundColor"))!==O?(O&&this._pushTextBgRect(g,O,a+x,c,b,w),x=_.left,b=_.width,O=I):b+=_.kernedWidth;I&&this._pushTextBgRect(g,I,a+x,c,b,w)},_getFillAttributes:function(g){var v=g&&"string"==typeof g?new S.Color(g):"";return v&&v.getSource()&&1!==v.getAlpha()?'opacity="'+v.getAlpha()+'" fill="'+v.setAlpha(1).toRgb()+'"':'fill="'+g+'"'},_getSVGLineTopOffset:function(g){for(var v,a=0,c=0;c<g;c++)a+=this.getHeightOfLine(c);return v=this.getHeightOfLine(c),{lineTop:a,offset:(this._fontSizeMult-this._fontSizeFraction)*v/(this.lineHeight*this._fontSizeMult)}},getSvgStyles:function(g){return S.Object.prototype.getSvgStyles.call(this,g)+" white-space: pre;"}})}(),function(m){var f=m.fabric||(m.fabric={});f.Textbox=f.util.createClass(f.IText,f.Observable,{type:"textbox",minWidth:20,dynamicMinWidth:2,__cachedLines:null,lockScalingFlip:!0,noScaleCache:!1,_dimensionAffectingProps:f.Text.prototype._dimensionAffectingProps.concat("width"),_wordJoiners:/[ \t\r]/,splitByGrapheme:!1,initDimensions:function(){this.__skipDimension||(this.isEditing&&this.initDelayedCursor(),this.clearContextTop(),this._clearCache(),this.dynamicMinWidth=0,this._styleMap=this._generateStyleMap(this._splitText()),this.dynamicMinWidth>this.width&&this._set("width",this.dynamicMinWidth),-1!==this.textAlign.indexOf("justify")&&this.enlargeSpaces(),this.height=this.calcTextHeight(),this.saveState({propertySet:"_dimensionAffectingProps"}))},_generateStyleMap:function(g){for(var v=0,a=0,c=0,_={},I=0;I<g.graphemeLines.length;I++)"\n"===g.graphemeText[c]&&I>0?(a=0,c++,v++):!this.splitByGrapheme&&this._reSpaceAndTab.test(g.graphemeText[c])&&I>0&&(a++,c++),_[I]={line:v,offset:a},c+=g.graphemeLines[I].length,a+=g.graphemeLines[I].length;return _},styleHas:function(g,v){if(this._styleMap&&!this.isWrapping){var a=this._styleMap[v];a&&(v=a.line)}return f.Text.prototype.styleHas.call(this,g,v)},isEmptyStyles:function(g){if(!this.styles)return!0;var v,a,c=0,_=!1,I=this._styleMap[g],y=this._styleMap[g+1];for(var w in I&&(g=I.line,c=I.offset),y&&(_=y.line===g,v=y.offset),a=void 0===g?this.styles:{line:this.styles[g]})for(var b in a[w])if(b>=c&&(!_||b<v))for(var x in a[w][b])return!1;return!0},_getStyleDeclaration:function(g,v){if(this._styleMap&&!this.isWrapping){var a=this._styleMap[g];if(!a)return null;g=a.line,v=a.offset+v}return this.callSuper("_getStyleDeclaration",g,v)},_setStyleDeclaration:function(g,v,a){var c=this._styleMap[g];this.styles[g=c.line][v=c.offset+v]=a},_deleteStyleDeclaration:function(g,v){var a=this._styleMap[g];delete this.styles[g=a.line][v=a.offset+v]},_getLineStyle:function(g){return!!this.styles[this._styleMap[g].line]},_setLineStyle:function(g){this.styles[this._styleMap[g].line]={}},_wrapText:function(g,v){var a,c=[];for(this.isWrapping=!0,a=0;a<g.length;a++)c=c.concat(this._wrapLine(g[a],a,v));return this.isWrapping=!1,c},_measureWord:function(g,v,a){var c,_=0;a=a||0;for(var I=0,y=g.length;I<y;I++)_+=this._getGraphemeBox(g[I],v,I+a,c,!0).kernedWidth,c=g[I];return _},_wrapLine:function(g,v,a,c){var _=0,I=this.splitByGrapheme,y=[],w=[],b=I?f.util.string.graphemeSplit(g):g.split(this._wordJoiners),x="",O=0,F=I?"":" ",L=0,N=0,j=0,$=!0,X=this._getWidthOfCharSpacing();c=c||0,0===b.length&&b.push([]),a-=c;for(var ie=0;ie<b.length;ie++)x=I?b[ie]:f.util.string.graphemeSplit(b[ie]),L=this._measureWord(x,v,O),O+=x.length,(_+=N+L-X)>a&&!$?(y.push(w),w=[],_=L,$=!0):_+=X,$||I||w.push(F),w=w.concat(x),N=I?0:this._measureWord([F],v,O),O++,$=!1,L>j&&(j=L);return ie&&y.push(w),j+c>this.dynamicMinWidth&&(this.dynamicMinWidth=j-X+c),y},isEndOfWrapping:function(g){return!this._styleMap[g+1]||this._styleMap[g+1].line!==this._styleMap[g].line},missingNewlineOffset:function(g){return this.splitByGrapheme?this.isEndOfWrapping(g)?1:0:1},_splitTextIntoLines:function(g){for(var v=f.Text.prototype._splitTextIntoLines.call(this,g),a=this._wrapText(v.lines,this.width),c=new Array(a.length),_=0;_<a.length;_++)c[_]=a[_].join("");return v.lines=c,v.graphemeLines=a,v},getMinWidth:function(){return Math.max(this.minWidth,this.dynamicMinWidth)},_removeExtraneousStyles:function(){var g={};for(var v in this._styleMap)this._textLines[v]&&(g[this._styleMap[v].line]=1);for(var v in this.styles)g[v]||delete this.styles[v]},toObject:function(g){return this.callSuper("toObject",["minWidth","splitByGrapheme"].concat(g))}}),f.Textbox.fromObject=function(g,v){return f.Object._fromObject("Textbox",g,v,"text")}}(n),function(){var m=S.controlsUtils,f=m.scaleSkewCursorStyleHandler,g=m.scaleCursorStyleHandler,v=m.scalingEqually,a=m.scalingYOrSkewingX,c=m.scalingXOrSkewingY,_=m.scaleOrSkewActionName,I=S.Object.prototype.controls;if(I.ml=new S.Control({x:-.5,y:0,cursorStyleHandler:f,actionHandler:c,getActionName:_}),I.mr=new S.Control({x:.5,y:0,cursorStyleHandler:f,actionHandler:c,getActionName:_}),I.mb=new S.Control({x:0,y:.5,cursorStyleHandler:f,actionHandler:a,getActionName:_}),I.mt=new S.Control({x:0,y:-.5,cursorStyleHandler:f,actionHandler:a,getActionName:_}),I.tl=new S.Control({x:-.5,y:-.5,cursorStyleHandler:g,actionHandler:v}),I.tr=new S.Control({x:.5,y:-.5,cursorStyleHandler:g,actionHandler:v}),I.bl=new S.Control({x:-.5,y:.5,cursorStyleHandler:g,actionHandler:v}),I.br=new S.Control({x:.5,y:.5,cursorStyleHandler:g,actionHandler:v}),I.mtr=new S.Control({x:0,y:-.5,actionHandler:m.rotationWithSnapping,cursorStyleHandler:m.rotationStyleHandler,offsetY:-40,withConnection:!0,actionName:"rotate"}),S.Textbox){var y=S.Textbox.prototype.controls={};y.mtr=I.mtr,y.tr=I.tr,y.br=I.br,y.tl=I.tl,y.bl=I.bl,y.mt=I.mt,y.mb=I.mb,y.mr=new S.Control({x:.5,y:0,actionHandler:m.changeWidth,cursorStyleHandler:f,actionName:"resizing"}),y.ml=new S.Control({x:-.5,y:0,actionHandler:m.changeWidth,cursorStyleHandler:f,actionName:"resizing"})}}()},192:()=>{},898:()=>{},245:()=>{}},LI={};function ro(t){var n=LI[t];if(void 0!==n)return n.exports;var i=LI[t]={exports:{}};return yk[t](i,i.exports,ro),i.exports}ro.d=(t,n)=>{for(var i in n)ro.o(n,i)&&!ro.o(t,i)&&Object.defineProperty(t,i,{enumerable:!0,get:n[i]})},ro.o=(t,n)=>Object.prototype.hasOwnProperty.call(t,n);var FI={};(()=>{let t;ro.d(FI,{R:()=>t}),t=typeof document<"u"&&typeof window<"u"?ro(653).fabric:{version:"5.2.1"}})();var Xe=FI.R,hp=function(){this.init()};hp.prototype={init:function(){var t=this||le;return t._counter=1e3,t._html5AudioPool=[],t.html5PoolSize=10,t._codecs={},t._howls=[],t._muted=!1,t._volume=1,t._canPlayEvent="canplaythrough",t._navigator=typeof window<"u"&&window.navigator?window.navigator:null,t.masterGain=null,t.noAudio=!1,t.usingWebAudio=!0,t.autoSuspend=!0,t.ctx=null,t.autoUnlock=!0,t._setup(),t},volume:function(t){var n=this||le;if(t=parseFloat(t),n.ctx||Au(),typeof t<"u"&&t>=0&&t<=1){if(n._volume=t,n._muted)return n;n.usingWebAudio&&n.masterGain.gain.setValueAtTime(t,le.ctx.currentTime);for(var i=0;i<n._howls.length;i++)if(!n._howls[i]._webAudio)for(var r=n._howls[i]._getSoundIds(),o=0;o<r.length;o++){var s=n._howls[i]._soundById(r[o]);s&&s._node&&(s._node.volume=s._volume*t)}return n}return n._volume},mute:function(t){var n=this||le;n.ctx||Au(),n._muted=t,n.usingWebAudio&&n.masterGain.gain.setValueAtTime(t?0:n._volume,le.ctx.currentTime);for(var i=0;i<n._howls.length;i++)if(!n._howls[i]._webAudio)for(var r=n._howls[i]._getSoundIds(),o=0;o<r.length;o++){var s=n._howls[i]._soundById(r[o]);s&&s._node&&(s._node.muted=!!t||s._muted)}return n},stop:function(){for(var t=this||le,n=0;n<t._howls.length;n++)t._howls[n].stop();return t},unload:function(){for(var t=this||le,n=t._howls.length-1;n>=0;n--)t._howls[n].unload();return t.usingWebAudio&&t.ctx&&typeof t.ctx.close<"u"&&(t.ctx.close(),t.ctx=null,Au()),t},codecs:function(t){return(this||le)._codecs[t.replace(/^x-/,"")]},_setup:function(){var t=this||le;if(t.state=t.ctx&&t.ctx.state||"suspended",t._autoSuspend(),!t.usingWebAudio)if(typeof Audio<"u")try{typeof(new Audio).oncanplaythrough>"u"&&(t._canPlayEvent="canplay")}catch{t.noAudio=!0}else t.noAudio=!0;try{(new Audio).muted&&(t.noAudio=!0)}catch{}return t.noAudio||t._setupCodecs(),t},_setupCodecs:function(){var t=this||le,n=null;try{n=typeof Audio<"u"?new Audio:null}catch{return t}if(!n||"function"!=typeof n.canPlayType)return t;var i=n.canPlayType("audio/mpeg;").replace(/^no$/,""),r=t._navigator?t._navigator.userAgent:"",o=r.match(/OPR\/([0-6].)/g),s=o&&parseInt(o[0].split("/")[1],10)<33,l=-1!==r.indexOf("Safari")&&-1===r.indexOf("Chrome"),h=r.match(/Version\/(.*?) /),p=l&&h&&parseInt(h[1],10)<15;return t._codecs={mp3:!(s||!i&&!n.canPlayType("audio/mp3;").replace(/^no$/,"")),mpeg:!!i,opus:!!n.canPlayType('audio/ogg; codecs="opus"').replace(/^no$/,""),ogg:!!n.canPlayType('audio/ogg; codecs="vorbis"').replace(/^no$/,""),oga:!!n.canPlayType('audio/ogg; codecs="vorbis"').replace(/^no$/,""),wav:!!(n.canPlayType('audio/wav; codecs="1"')||n.canPlayType("audio/wav")).replace(/^no$/,""),aac:!!n.canPlayType("audio/aac;").replace(/^no$/,""),caf:!!n.canPlayType("audio/x-caf;").replace(/^no$/,""),m4a:!!(n.canPlayType("audio/x-m4a;")||n.canPlayType("audio/m4a;")||n.canPlayType("audio/aac;")).replace(/^no$/,""),m4b:!!(n.canPlayType("audio/x-m4b;")||n.canPlayType("audio/m4b;")||n.canPlayType("audio/aac;")).replace(/^no$/,""),mp4:!!(n.canPlayType("audio/x-mp4;")||n.canPlayType("audio/mp4;")||n.canPlayType("audio/aac;")).replace(/^no$/,""),weba:!(p||!n.canPlayType('audio/webm; codecs="vorbis"').replace(/^no$/,"")),webm:!(p||!n.canPlayType('audio/webm; codecs="vorbis"').replace(/^no$/,"")),dolby:!!n.canPlayType('audio/mp4; codecs="ec-3"').replace(/^no$/,""),flac:!!(n.canPlayType("audio/x-flac;")||n.canPlayType("audio/flac;")).replace(/^no$/,"")},t},_unlockAudio:function(){var t=this||le;if(!t._audioUnlocked&&t.ctx){t._audioUnlocked=!1,t.autoUnlock=!1,!t._mobileUnloaded&&44100!==t.ctx.sampleRate&&(t._mobileUnloaded=!0,t.unload()),t._scratchBuffer=t.ctx.createBuffer(1,1,22050);var n=function(i){for(;t._html5AudioPool.length<t.html5PoolSize;)try{var r=new Audio;r._unlocked=!0,t._releaseHtml5Audio(r)}catch{t.noAudio=!0;break}for(var o=0;o<t._howls.length;o++)if(!t._howls[o]._webAudio)for(var s=t._howls[o]._getSoundIds(),l=0;l<s.length;l++){var h=t._howls[o]._soundById(s[l]);h&&h._node&&!h._node._unlocked&&(h._node._unlocked=!0,h._node.load())}t._autoResume();var p=t.ctx.createBufferSource();p.buffer=t._scratchBuffer,p.connect(t.ctx.destination),typeof p.start>"u"?p.noteOn(0):p.start(0),"function"==typeof t.ctx.resume&&t.ctx.resume(),p.onended=function(){p.disconnect(0),t._audioUnlocked=!0,document.removeEventListener("touchstart",n,!0),document.removeEventListener("touchend",n,!0),document.removeEventListener("click",n,!0),document.removeEventListener("keydown",n,!0);for(var C=0;C<t._howls.length;C++)t._howls[C]._emit("unlock")}};return document.addEventListener("touchstart",n,!0),document.addEventListener("touchend",n,!0),document.addEventListener("click",n,!0),document.addEventListener("keydown",n,!0),t}},_obtainHtml5Audio:function(){var t=this||le;if(t._html5AudioPool.length)return t._html5AudioPool.pop();var n=(new Audio).play();return n&&typeof Promise<"u"&&(n instanceof Promise||"function"==typeof n.then)&&n.catch(function(){console.warn("HTML5 Audio pool exhausted, returning potentially locked audio object.")}),new Audio},_releaseHtml5Audio:function(t){var n=this||le;return t._unlocked&&n._html5AudioPool.push(t),n},_autoSuspend:function(){var t=this;if(t.autoSuspend&&t.ctx&&!(typeof t.ctx.suspend>"u")&&le.usingWebAudio){for(var n=0;n<t._howls.length;n++)if(t._howls[n]._webAudio)for(var i=0;i<t._howls[n]._sounds.length;i++)if(!t._howls[n]._sounds[i]._paused)return t;return t._suspendTimer&&clearTimeout(t._suspendTimer),t._suspendTimer=setTimeout(function(){if(t.autoSuspend){t._suspendTimer=null,t.state="suspending";var r=function(){t.state="suspended",t._resumeAfterSuspend&&(delete t._resumeAfterSuspend,t._autoResume())};t.ctx.suspend().then(r,r)}},3e4),t}},_autoResume:function(){var t=this;if(t.ctx&&!(typeof t.ctx.resume>"u")&&le.usingWebAudio)return"running"===t.state&&"interrupted"!==t.ctx.state&&t._suspendTimer?(clearTimeout(t._suspendTimer),t._suspendTimer=null):"suspended"===t.state||"running"===t.state&&"interrupted"===t.ctx.state?(t.ctx.resume().then(function(){t.state="running";for(var n=0;n<t._howls.length;n++)t._howls[n]._emit("resume")}),t._suspendTimer&&(clearTimeout(t._suspendTimer),t._suspendTimer=null)):"suspending"===t.state&&(t._resumeAfterSuspend=!0),t}};var le=new hp,Tu=function(t){t.src&&0!==t.src.length?this.init(t):console.error("An array of source files must be passed with any new Howl.")};Tu.prototype={init:function(t){var n=this;return le.ctx||Au(),n._autoplay=t.autoplay||!1,n._format="string"!=typeof t.format?t.format:[t.format],n._html5=t.html5||!1,n._muted=t.mute||!1,n._loop=t.loop||!1,n._pool=t.pool||5,n._preload="boolean"!=typeof t.preload&&"metadata"!==t.preload||t.preload,n._rate=t.rate||1,n._sprite=t.sprite||{},n._src="string"!=typeof t.src?t.src:[t.src],n._volume=void 0!==t.volume?t.volume:1,n._xhr={method:t.xhr&&t.xhr.method?t.xhr.method:"GET",headers:t.xhr&&t.xhr.headers?t.xhr.headers:null,withCredentials:!(!t.xhr||!t.xhr.withCredentials)&&t.xhr.withCredentials},n._duration=0,n._state="unloaded",n._sounds=[],n._endTimers={},n._queue=[],n._playLock=!1,n._onend=t.onend?[{fn:t.onend}]:[],n._onfade=t.onfade?[{fn:t.onfade}]:[],n._onload=t.onload?[{fn:t.onload}]:[],n._onloaderror=t.onloaderror?[{fn:t.onloaderror}]:[],n._onplayerror=t.onplayerror?[{fn:t.onplayerror}]:[],n._onpause=t.onpause?[{fn:t.onpause}]:[],n._onplay=t.onplay?[{fn:t.onplay}]:[],n._onstop=t.onstop?[{fn:t.onstop}]:[],n._onmute=t.onmute?[{fn:t.onmute}]:[],n._onvolume=t.onvolume?[{fn:t.onvolume}]:[],n._onrate=t.onrate?[{fn:t.onrate}]:[],n._onseek=t.onseek?[{fn:t.onseek}]:[],n._onunlock=t.onunlock?[{fn:t.onunlock}]:[],n._onresume=[],n._webAudio=le.usingWebAudio&&!n._html5,typeof le.ctx<"u"&&le.ctx&&le.autoUnlock&&le._unlockAudio(),le._howls.push(n),n._autoplay&&n._queue.push({event:"play",action:function(){n.play()}}),n._preload&&"none"!==n._preload&&n.load(),n},load:function(){var t=this,n=null;if(le.noAudio)t._emit("loaderror",null,"No audio support.");else{"string"==typeof t._src&&(t._src=[t._src]);for(var i=0;i<t._src.length;i++){var r,o;if(t._format&&t._format[i])r=t._format[i];else{if("string"!=typeof(o=t._src[i])){t._emit("loaderror",null,"Non-string found in selected audio sources - ignoring.");continue}(r=/^data:audio\/([^;,]+);/i.exec(o))||(r=/\.([^.]+)$/.exec(o.split("?",1)[0])),r&&(r=r[1].toLowerCase())}if(r||console.warn('No file extension was found. Consider using the "format" property or specify an extension.'),r&&le.codecs(r)){n=t._src[i];break}}if(n)return t._src=n,t._state="loading","https:"===window.location.protocol&&"http:"===n.slice(0,5)&&(t._html5=!0,t._webAudio=!1),new xu(t),t._webAudio&&Ck(t),t;t._emit("loaderror",null,"No codec support for selected audio sources.")}},play:function(t,n){var i=this,r=null;if("number"==typeof t)r=t,t=null;else{if("string"==typeof t&&"loaded"===i._state&&!i._sprite[t])return null;if(typeof t>"u"&&(t="__default",!i._playLock)){for(var o=0,s=0;s<i._sounds.length;s++)i._sounds[s]._paused&&!i._sounds[s]._ended&&(o++,r=i._sounds[s]._id);1===o?t=null:r=null}}var l=r?i._soundById(r):i._inactiveSound();if(!l)return null;if(r&&!t&&(t=l._sprite||"__default"),"loaded"!==i._state){l._sprite=t,l._ended=!1;var h=l._id;return i._queue.push({event:"play",action:function(){i.play(h)}}),h}if(r&&!l._paused)return n||i._loadQueue("play"),l._id;i._webAudio&&le._autoResume();var p=Math.max(0,l._seek>0?l._seek:i._sprite[t][0]/1e3),C=Math.max(0,(i._sprite[t][0]+i._sprite[t][1])/1e3-p),D=1e3*C/Math.abs(l._rate),T=i._sprite[t][0]/1e3,A=(i._sprite[t][0]+i._sprite[t][1])/1e3;l._sprite=t,l._ended=!1;var M=function(){l._paused=!1,l._seek=p,l._start=T,l._stop=A,l._loop=!(!l._loop&&!i._sprite[t][2])};if(!(p>=A)){var P=l._node;if(i._webAudio){var B=function(){i._playLock=!1,M(),i._refreshBuffer(l),P.gain.setValueAtTime(l._muted||i._muted?0:l._volume,le.ctx.currentTime),l._playStart=le.ctx.currentTime,typeof P.bufferSource.start>"u"?P.bufferSource.noteGrainOn(0,p,l._loop?86400:C):P.bufferSource.start(0,p,l._loop?86400:C),D!==1/0&&(i._endTimers[l._id]=setTimeout(i._ended.bind(i,l),D)),n||setTimeout(function(){i._emit("play",l._id),i._loadQueue()},0)};"running"===le.state&&"interrupted"!==le.ctx.state?B():(i._playLock=!0,i.once("resume",B),i._clearTimer(l._id))}else{var k=function(){P.currentTime=p,P.muted=l._muted||i._muted||le._muted||P.muted,P.volume=l._volume*le.volume(),P.playbackRate=l._rate;try{var q=P.play();if(q&&typeof Promise<"u"&&(q instanceof Promise||"function"==typeof q.then)?(i._playLock=!0,M(),q.then(function(){i._playLock=!1,P._unlocked=!0,n?i._loadQueue():i._emit("play",l._id)}).catch(function(){i._playLock=!1,i._emit("playerror",l._id,"Playback was unable to start. This is most commonly an issue on mobile devices and Chrome where playback was not within a user interaction."),l._ended=!0,l._paused=!0})):n||(i._playLock=!1,M(),i._emit("play",l._id)),P.playbackRate=l._rate,P.paused)return void i._emit("playerror",l._id,"Playback was unable to start. This is most commonly an issue on mobile devices and Chrome where playback was not within a user interaction.");"__default"!==t||l._loop?i._endTimers[l._id]=setTimeout(i._ended.bind(i,l),D):(i._endTimers[l._id]=function(){i._ended(l),P.removeEventListener("ended",i._endTimers[l._id],!1)},P.addEventListener("ended",i._endTimers[l._id],!1))}catch(ce){i._emit("playerror",l._id,ce)}};"data:audio/wav;base64,UklGRigAAABXQVZFZm10IBIAAAABAAEARKwAAIhYAQACABAAAABkYXRhAgAAAAEA"===P.src&&(P.src=i._src,P.load());var U=window&&window.ejecta||!P.readyState&&le._navigator.isCocoonJS;if(P.readyState>=3||U)k();else{i._playLock=!0,i._state="loading";var V=function(){i._state="loaded",k(),P.removeEventListener(le._canPlayEvent,V,!1)};P.addEventListener(le._canPlayEvent,V,!1),i._clearTimer(l._id)}}return l._id}i._ended(l)},pause:function(t){var n=this;if("loaded"!==n._state||n._playLock)return n._queue.push({event:"pause",action:function(){n.pause(t)}}),n;for(var i=n._getSoundIds(t),r=0;r<i.length;r++){n._clearTimer(i[r]);var o=n._soundById(i[r]);if(o&&!o._paused&&(o._seek=n.seek(i[r]),o._rateSeek=0,o._paused=!0,n._stopFade(i[r]),o._node))if(n._webAudio){if(!o._node.bufferSource)continue;typeof o._node.bufferSource.stop>"u"?o._node.bufferSource.noteOff(0):o._node.bufferSource.stop(0),n._cleanBuffer(o._node)}else(!isNaN(o._node.duration)||o._node.duration===1/0)&&o._node.pause();arguments[1]||n._emit("pause",o?o._id:null)}return n},stop:function(t,n){var i=this;if("loaded"!==i._state||i._playLock)return i._queue.push({event:"stop",action:function(){i.stop(t)}}),i;for(var r=i._getSoundIds(t),o=0;o<r.length;o++){i._clearTimer(r[o]);var s=i._soundById(r[o]);s&&(s._seek=s._start||0,s._rateSeek=0,s._paused=!0,s._ended=!0,i._stopFade(r[o]),s._node&&(i._webAudio?s._node.bufferSource&&(typeof s._node.bufferSource.stop>"u"?s._node.bufferSource.noteOff(0):s._node.bufferSource.stop(0),i._cleanBuffer(s._node)):(!isNaN(s._node.duration)||s._node.duration===1/0)&&(s._node.currentTime=s._start||0,s._node.pause(),s._node.duration===1/0&&i._clearSound(s._node))),n||i._emit("stop",s._id))}return i},mute:function(t,n){var i=this;if("loaded"!==i._state||i._playLock)return i._queue.push({event:"mute",action:function(){i.mute(t,n)}}),i;if(typeof n>"u"){if("boolean"!=typeof t)return i._muted;i._muted=t}for(var r=i._getSoundIds(n),o=0;o<r.length;o++){var s=i._soundById(r[o]);s&&(s._muted=t,s._interval&&i._stopFade(s._id),i._webAudio&&s._node?s._node.gain.setValueAtTime(t?0:s._volume,le.ctx.currentTime):s._node&&(s._node.muted=!!le._muted||t),i._emit("mute",s._id))}return i},volume:function(){var i,r,l,t=this,n=arguments;if(0===n.length)return t._volume;if(1===n.length||2===n.length&&typeof n[1]>"u"?t._getSoundIds().indexOf(n[0])>=0?r=parseInt(n[0],10):i=parseFloat(n[0]):n.length>=2&&(i=parseFloat(n[0]),r=parseInt(n[1],10)),!(typeof i<"u"&&i>=0&&i<=1))return(l=r?t._soundById(r):t._sounds[0])?l._volume:0;if("loaded"!==t._state||t._playLock)return t._queue.push({event:"volume",action:function(){t.volume.apply(t,n)}}),t;typeof r>"u"&&(t._volume=i),r=t._getSoundIds(r);for(var h=0;h<r.length;h++)(l=t._soundById(r[h]))&&(l._volume=i,n[2]||t._stopFade(r[h]),t._webAudio&&l._node&&!l._muted?l._node.gain.setValueAtTime(i,le.ctx.currentTime):l._node&&!l._muted&&(l._node.volume=i*le.volume()),t._emit("volume",l._id));return t},fade:function(t,n,i,r){var o=this;if("loaded"!==o._state||o._playLock)return o._queue.push({event:"fade",action:function(){o.fade(t,n,i,r)}}),o;t=Math.min(Math.max(0,parseFloat(t)),1),n=Math.min(Math.max(0,parseFloat(n)),1),i=parseFloat(i),o.volume(t,r);for(var s=o._getSoundIds(r),l=0;l<s.length;l++){var h=o._soundById(s[l]);if(h){if(r||o._stopFade(s[l]),o._webAudio&&!h._muted){var p=le.ctx.currentTime,C=p+i/1e3;h._volume=t,h._node.gain.setValueAtTime(t,p),h._node.gain.linearRampToValueAtTime(n,C)}o._startFadeInterval(h,t,n,i,s[l],typeof r>"u")}}return o},_startFadeInterval:function(t,n,i,r,o,s){var l=this,h=n,p=i-n,C=Math.abs(p/.01),D=Math.max(4,C>0?r/C:r),T=Date.now();t._fadeTo=i,t._interval=setInterval(function(){var A=(Date.now()-T)/r;T=Date.now(),h+=p*A,h=Math.round(100*h)/100,h=p<0?Math.max(i,h):Math.min(i,h),l._webAudio?t._volume=h:l.volume(h,t._id,!0),s&&(l._volume=h),(i<n&&h<=i||i>n&&h>=i)&&(clearInterval(t._interval),t._interval=null,t._fadeTo=null,l.volume(i,t._id),l._emit("fade",t._id))},D)},_stopFade:function(t){var n=this,i=n._soundById(t);return i&&i._interval&&(n._webAudio&&i._node.gain.cancelScheduledValues(le.ctx.currentTime),clearInterval(i._interval),i._interval=null,n.volume(i._fadeTo,t),i._fadeTo=null,n._emit("fade",t)),n},loop:function(){var i,r,o,t=this,n=arguments;if(0===n.length)return t._loop;if(1===n.length){if("boolean"!=typeof n[0])return!!(o=t._soundById(parseInt(n[0],10)))&&o._loop;t._loop=i=n[0]}else 2===n.length&&(i=n[0],r=parseInt(n[1],10));for(var s=t._getSoundIds(r),l=0;l<s.length;l++)(o=t._soundById(s[l]))&&(o._loop=i,t._webAudio&&o._node&&o._node.bufferSource&&(o._node.bufferSource.loop=i,i&&(o._node.bufferSource.loopStart=o._start||0,o._node.bufferSource.loopEnd=o._stop,t.playing(s[l])&&(t.pause(s[l],!0),t.play(s[l],!0)))));return t},rate:function(){var i,r,l,t=this,n=arguments;if(0===n.length?r=t._sounds[0]._id:1===n.length?t._getSoundIds().indexOf(n[0])>=0?r=parseInt(n[0],10):i=parseFloat(n[0]):2===n.length&&(i=parseFloat(n[0]),r=parseInt(n[1],10)),"number"!=typeof i)return(l=t._soundById(r))?l._rate:t._rate;if("loaded"!==t._state||t._playLock)return t._queue.push({event:"rate",action:function(){t.rate.apply(t,n)}}),t;typeof r>"u"&&(t._rate=i),r=t._getSoundIds(r);for(var h=0;h<r.length;h++)if(l=t._soundById(r[h])){t.playing(r[h])&&(l._rateSeek=t.seek(r[h]),l._playStart=t._webAudio?le.ctx.currentTime:l._playStart),l._rate=i,t._webAudio&&l._node&&l._node.bufferSource?l._node.bufferSource.playbackRate.setValueAtTime(i,le.ctx.currentTime):l._node&&(l._node.playbackRate=i);var p=t.seek(r[h]),D=1e3*((t._sprite[l._sprite][0]+t._sprite[l._sprite][1])/1e3-p)/Math.abs(l._rate);(t._endTimers[r[h]]||!l._paused)&&(t._clearTimer(r[h]),t._endTimers[r[h]]=setTimeout(t._ended.bind(t,l),D)),t._emit("rate",l._id)}return t},seek:function(){var i,r,t=this,n=arguments;if(0===n.length?t._sounds.length&&(r=t._sounds[0]._id):1===n.length?t._getSoundIds().indexOf(n[0])>=0?r=parseInt(n[0],10):t._sounds.length&&(r=t._sounds[0]._id,i=parseFloat(n[0])):2===n.length&&(i=parseFloat(n[0]),r=parseInt(n[1],10)),typeof r>"u")return 0;if("number"==typeof i&&("loaded"!==t._state||t._playLock))return t._queue.push({event:"seek",action:function(){t.seek.apply(t,n)}}),t;var l=t._soundById(r);if(l){if(!("number"==typeof i&&i>=0)){if(t._webAudio){var D=t.playing(r)?le.ctx.currentTime-l._playStart:0;return l._seek+((l._rateSeek?l._rateSeek-l._seek:0)+D*Math.abs(l._rate))}return l._node.currentTime}var h=t.playing(r);h&&t.pause(r,!0),l._seek=i,l._ended=!1,t._clearTimer(r),!t._webAudio&&l._node&&!isNaN(l._node.duration)&&(l._node.currentTime=i);var p=function(){h&&t.play(r,!0),t._emit("seek",r)};if(h&&!t._webAudio){var C=function(){t._playLock?setTimeout(C,0):p()};setTimeout(C,0)}else p()}return t},playing:function(t){var n=this;if("number"==typeof t){var i=n._soundById(t);return!!i&&!i._paused}for(var r=0;r<n._sounds.length;r++)if(!n._sounds[r]._paused)return!0;return!1},duration:function(t){var n=this,i=n._duration,r=n._soundById(t);return r&&(i=n._sprite[r._sprite][1]/1e3),i},state:function(){return this._state},unload:function(){for(var t=this,n=t._sounds,i=0;i<n.length;i++)n[i]._paused||t.stop(n[i]._id),t._webAudio||(t._clearSound(n[i]._node),n[i]._node.removeEventListener("error",n[i]._errorFn,!1),n[i]._node.removeEventListener(le._canPlayEvent,n[i]._loadFn,!1),n[i]._node.removeEventListener("ended",n[i]._endFn,!1),le._releaseHtml5Audio(n[i]._node)),delete n[i]._node,t._clearTimer(n[i]._id);var r=le._howls.indexOf(t);r>=0&&le._howls.splice(r,1);var o=!0;for(i=0;i<le._howls.length;i++)if(le._howls[i]._src===t._src||t._src.indexOf(le._howls[i]._src)>=0){o=!1;break}return oo&&o&&delete oo[t._src],le.noAudio=!1,t._state="unloaded",t._sounds=[],t=null,null},on:function(t,n,i,r){return"function"==typeof n&&this["_on"+t].push(r?{id:i,fn:n,once:r}:{id:i,fn:n}),this},off:function(t,n,i){var r=this,o=r["_on"+t],s=0;if("number"==typeof n&&(i=n,n=null),n||i)for(s=0;s<o.length;s++){var l=i===o[s].id;if(n===o[s].fn&&l||!n&&l){o.splice(s,1);break}}else if(t)r["_on"+t]=[];else{var h=Object.keys(r);for(s=0;s<h.length;s++)0===h[s].indexOf("_on")&&Array.isArray(r[h[s]])&&(r[h[s]]=[])}return r},once:function(t,n,i){return this.on(t,n,i,1),this},_emit:function(t,n,i){for(var r=this,o=r["_on"+t],s=o.length-1;s>=0;s--)(!o[s].id||o[s].id===n||"load"===t)&&(setTimeout(function(l){l.call(this,n,i)}.bind(r,o[s].fn),0),o[s].once&&r.off(t,o[s].fn,o[s].id));return r._loadQueue(t),r},_loadQueue:function(t){var n=this;if(n._queue.length>0){var i=n._queue[0];i.event===t&&(n._queue.shift(),n._loadQueue()),t||i.action()}return n},_ended:function(t){var n=this,i=t._sprite;if(!n._webAudio&&t._node&&!t._node.paused&&!t._node.ended&&t._node.currentTime<t._stop)return setTimeout(n._ended.bind(n,t),100),n;var r=!(!t._loop&&!n._sprite[i][2]);if(n._emit("end",t._id),!n._webAudio&&r&&n.stop(t._id,!0).play(t._id),n._webAudio&&r){n._emit("play",t._id),t._seek=t._start||0,t._rateSeek=0,t._playStart=le.ctx.currentTime;var o=1e3*(t._stop-t._start)/Math.abs(t._rate);n._endTimers[t._id]=setTimeout(n._ended.bind(n,t),o)}return n._webAudio&&!r&&(t._paused=!0,t._ended=!0,t._seek=t._start||0,t._rateSeek=0,n._clearTimer(t._id),n._cleanBuffer(t._node),le._autoSuspend()),!n._webAudio&&!r&&n.stop(t._id,!0),n},_clearTimer:function(t){var n=this;if(n._endTimers[t]){if("function"!=typeof n._endTimers[t])clearTimeout(n._endTimers[t]);else{var i=n._soundById(t);i&&i._node&&i._node.removeEventListener("ended",n._endTimers[t],!1)}delete n._endTimers[t]}return n},_soundById:function(t){for(var n=this,i=0;i<n._sounds.length;i++)if(t===n._sounds[i]._id)return n._sounds[i];return null},_inactiveSound:function(){var t=this;t._drain();for(var n=0;n<t._sounds.length;n++)if(t._sounds[n]._ended)return t._sounds[n].reset();return new xu(t)},_drain:function(){var t=this,n=t._pool,i=0,r=0;if(!(t._sounds.length<n)){for(r=0;r<t._sounds.length;r++)t._sounds[r]._ended&&i++;for(r=t._sounds.length-1;r>=0;r--){if(i<=n)return;t._sounds[r]._ended&&(t._webAudio&&t._sounds[r]._node&&t._sounds[r]._node.disconnect(0),t._sounds.splice(r,1),i--)}}},_getSoundIds:function(t){if(typeof t>"u"){for(var i=[],r=0;r<this._sounds.length;r++)i.push(this._sounds[r]._id);return i}return[t]},_refreshBuffer:function(t){return t._node.bufferSource=le.ctx.createBufferSource(),t._node.bufferSource.buffer=oo[this._src],t._node.bufferSource.connect(t._panner?t._panner:t._node),t._node.bufferSource.loop=t._loop,t._loop&&(t._node.bufferSource.loopStart=t._start||0,t._node.bufferSource.loopEnd=t._stop||0),t._node.bufferSource.playbackRate.setValueAtTime(t._rate,le.ctx.currentTime),this},_cleanBuffer:function(t){var i=le._navigator&&le._navigator.vendor.indexOf("Apple")>=0;if(!t.bufferSource)return this;if(le._scratchBuffer&&t.bufferSource&&(t.bufferSource.onended=null,t.bufferSource.disconnect(0),i))try{t.bufferSource.buffer=le._scratchBuffer}catch{}return t.bufferSource=null,this},_clearSound:function(t){/MSIE |Trident\//.test(le._navigator&&le._navigator.userAgent)||(t.src="data:audio/wav;base64,UklGRigAAABXQVZFZm10IBIAAAABAAEARKwAAIhYAQACABAAAABkYXRhAgAAAAEA")}};var xu=function(t){this._parent=t,this.init()};xu.prototype={init:function(){var t=this,n=t._parent;return t._muted=n._muted,t._loop=n._loop,t._volume=n._volume,t._rate=n._rate,t._seek=0,t._paused=!0,t._ended=!0,t._sprite="__default",t._id=++le._counter,n._sounds.push(t),t.create(),t},create:function(){var t=this,n=t._parent,i=le._muted||t._muted||t._parent._muted?0:t._volume;return n._webAudio?(t._node=typeof le.ctx.createGain>"u"?le.ctx.createGainNode():le.ctx.createGain(),t._node.gain.setValueAtTime(i,le.ctx.currentTime),t._node.paused=!0,t._node.connect(le.masterGain)):le.noAudio||(t._node=le._obtainHtml5Audio(),t._errorFn=t._errorListener.bind(t),t._node.addEventListener("error",t._errorFn,!1),t._loadFn=t._loadListener.bind(t),t._node.addEventListener(le._canPlayEvent,t._loadFn,!1),t._endFn=t._endListener.bind(t),t._node.addEventListener("ended",t._endFn,!1),t._node.src=n._src,t._node.preload=!0===n._preload?"auto":n._preload,t._node.volume=i*le.volume(),t._node.load()),t},reset:function(){var t=this,n=t._parent;return t._muted=n._muted,t._loop=n._loop,t._volume=n._volume,t._rate=n._rate,t._seek=0,t._rateSeek=0,t._paused=!0,t._ended=!0,t._sprite="__default",t._id=++le._counter,t},_errorListener:function(){var t=this;t._parent._emit("loaderror",t._id,t._node.error?t._node.error.code:0),t._node.removeEventListener("error",t._errorFn,!1)},_loadListener:function(){var t=this,n=t._parent;n._duration=Math.ceil(10*t._node.duration)/10,0===Object.keys(n._sprite).length&&(n._sprite={__default:[0,1e3*n._duration]}),"loaded"!==n._state&&(n._state="loaded",n._emit("load"),n._loadQueue()),t._node.removeEventListener(le._canPlayEvent,t._loadFn,!1)},_endListener:function(){var t=this,n=t._parent;n._duration===1/0&&(n._duration=Math.ceil(10*t._node.duration)/10,n._sprite.__default[1]===1/0&&(n._sprite.__default[1]=1e3*n._duration),n._ended(t)),t._node.removeEventListener("ended",t._endFn,!1)}};var oo={},Ck=function(t){var n=t._src;if(oo[n])return t._duration=oo[n].duration,void NI(t);if(/^data:[^;]+;base64,/.test(n)){for(var i=atob(n.split(",")[1]),r=new Uint8Array(i.length),o=0;o<i.length;++o)r[o]=i.charCodeAt(o);PI(r.buffer,t)}else{var s=new XMLHttpRequest;s.open(t._xhr.method,n,!0),s.withCredentials=t._xhr.withCredentials,s.responseType="arraybuffer",t._xhr.headers&&Object.keys(t._xhr.headers).forEach(function(l){s.setRequestHeader(l,t._xhr.headers[l])}),s.onload=function(){var l=(s.status+"")[0];"0"===l||"2"===l||"3"===l?PI(s.response,t):t._emit("loaderror",null,"Failed loading audio file with status: "+s.status+".")},s.onerror=function(){t._webAudio&&(t._html5=!0,t._webAudio=!1,t._sounds=[],delete oo[n],t.load())},Ek(s)}},Ek=function(t){try{t.send()}catch{t.onerror()}},PI=function(t,n){var i=function(){n._emit("loaderror",null,"Decoding audio data failed.")},r=function(o){o&&n._sounds.length>0?(oo[n._src]=o,NI(n,o)):i()};typeof Promise<"u"&&1===le.ctx.decodeAudioData.length?le.ctx.decodeAudioData(t).then(r).catch(i):le.ctx.decodeAudioData(t,r,i)},NI=function(t,n){n&&!t._duration&&(t._duration=n.duration),0===Object.keys(t._sprite).length&&(t._sprite={__default:[0,1e3*t._duration]}),"loaded"!==t._state&&(t._state="loaded",t._emit("load"),t._loadQueue())},Au=function(){if(le.usingWebAudio){try{typeof AudioContext<"u"?le.ctx=new AudioContext:typeof webkitAudioContext<"u"?le.ctx=new webkitAudioContext:le.usingWebAudio=!1}catch{le.usingWebAudio=!1}le.ctx||(le.usingWebAudio=!1);var t=/iP(hone|od|ad)/.test(le._navigator&&le._navigator.platform),n=le._navigator&&le._navigator.appVersion.match(/OS (\d+)_(\d+)_?(\d+)?/),i=n?parseInt(n[1],10):null;if(t&&i&&i<9){var r=/safari/.test(le._navigator&&le._navigator.userAgent.toLowerCase());le._navigator&&!r&&(le.usingWebAudio=!1)}le.usingWebAudio&&(le.masterGain=typeof le.ctx.createGain>"u"?le.ctx.createGainNode():le.ctx.createGain(),le.masterGain.gain.setValueAtTime(le._muted?0:le._volume,le.ctx.currentTime),le.masterGain.connect(le.ctx.destination)),le._setup()}};!function wk(t,n,i,r){var s;t.prototype._pos=[0,0,0],t.prototype._orientation=[0,0,-1,0,1,0],t.prototype.stereo=function(s){var l=this;if(!l.ctx||!l.ctx.listener)return l;for(var h=l._howls.length-1;h>=0;h--)l._howls[h].stereo(s);return l},t.prototype.pos=function(s,l,h){var p=this;return p.ctx&&p.ctx.listener?"number"!=typeof s?p._pos:(p._pos=[s,l="number"!=typeof l?p._pos[1]:l,h="number"!=typeof h?p._pos[2]:h],typeof p.ctx.listener.positionX<"u"?(p.ctx.listener.positionX.setTargetAtTime(p._pos[0],n.ctx.currentTime,.1),p.ctx.listener.positionY.setTargetAtTime(p._pos[1],n.ctx.currentTime,.1),p.ctx.listener.positionZ.setTargetAtTime(p._pos[2],n.ctx.currentTime,.1)):p.ctx.listener.setPosition(p._pos[0],p._pos[1],p._pos[2]),p):p},t.prototype.orientation=function(s,l,h,p,C,D){var T=this;if(!T.ctx||!T.ctx.listener)return T;var A=T._orientation;return"number"!=typeof s?A:(T._orientation=[s,l="number"!=typeof l?A[1]:l,h="number"!=typeof h?A[2]:h,p="number"!=typeof p?A[3]:p,C="number"!=typeof C?A[4]:C,D="number"!=typeof D?A[5]:D],typeof T.ctx.listener.forwardX<"u"?(T.ctx.listener.forwardX.setTargetAtTime(s,n.ctx.currentTime,.1),T.ctx.listener.forwardY.setTargetAtTime(l,n.ctx.currentTime,.1),T.ctx.listener.forwardZ.setTargetAtTime(h,n.ctx.currentTime,.1),T.ctx.listener.upX.setTargetAtTime(p,n.ctx.currentTime,.1),T.ctx.listener.upY.setTargetAtTime(C,n.ctx.currentTime,.1),T.ctx.listener.upZ.setTargetAtTime(D,n.ctx.currentTime,.1)):T.ctx.listener.setOrientation(s,l,h,p,C,D),T)},i.prototype.init=(s=i.prototype.init,function(l){var h=this;return h._orientation=l.orientation||[1,0,0],h._stereo=l.stereo||null,h._pos=l.pos||null,h._pannerAttr={coneInnerAngle:typeof l.coneInnerAngle<"u"?l.coneInnerAngle:360,coneOuterAngle:typeof l.coneOuterAngle<"u"?l.coneOuterAngle:360,coneOuterGain:typeof l.coneOuterGain<"u"?l.coneOuterGain:0,distanceModel:typeof l.distanceModel<"u"?l.distanceModel:"inverse",maxDistance:typeof l.maxDistance<"u"?l.maxDistance:1e4,panningModel:typeof l.panningModel<"u"?l.panningModel:"HRTF",refDistance:typeof l.refDistance<"u"?l.refDistance:1,rolloffFactor:typeof l.rolloffFactor<"u"?l.rolloffFactor:1},h._onstereo=l.onstereo?[{fn:l.onstereo}]:[],h._onpos=l.onpos?[{fn:l.onpos}]:[],h._onorientation=l.onorientation?[{fn:l.onorientation}]:[],s.call(this,l)}),i.prototype.stereo=function(s,l){var h=this;if(!h._webAudio)return h;if("loaded"!==h._state)return h._queue.push({event:"stereo",action:function(){h.stereo(s,l)}}),h;var p=typeof n.ctx.createStereoPanner>"u"?"spatial":"stereo";if(typeof l>"u"){if("number"!=typeof s)return h._stereo;h._stereo=s,h._pos=[s,0,0]}for(var C=h._getSoundIds(l),D=0;D<C.length;D++){var T=h._soundById(C[D]);if(T){if("number"!=typeof s)return T._stereo;T._stereo=s,T._pos=[s,0,0],T._node&&(T._pannerAttr.panningModel="equalpower",(!T._panner||!T._panner.pan)&&o(T,p),"spatial"===p?typeof T._panner.positionX<"u"?(T._panner.positionX.setValueAtTime(s,n.ctx.currentTime),T._panner.positionY.setValueAtTime(0,n.ctx.currentTime),T._panner.positionZ.setValueAtTime(0,n.ctx.currentTime)):T._panner.setPosition(s,0,0):T._panner.pan.setValueAtTime(s,n.ctx.currentTime)),h._emit("stereo",T._id)}}return h},i.prototype.pos=function(s,l,h,p){var C=this;if(!C._webAudio)return C;if("loaded"!==C._state)return C._queue.push({event:"pos",action:function(){C.pos(s,l,h,p)}}),C;if(l="number"!=typeof l?0:l,h="number"!=typeof h?-.5:h,typeof p>"u"){if("number"!=typeof s)return C._pos;C._pos=[s,l,h]}for(var D=C._getSoundIds(p),T=0;T<D.length;T++){var A=C._soundById(D[T]);if(A){if("number"!=typeof s)return A._pos;A._pos=[s,l,h],A._node&&((!A._panner||A._panner.pan)&&o(A,"spatial"),typeof A._panner.positionX<"u"?(A._panner.positionX.setValueAtTime(s,n.ctx.currentTime),A._panner.positionY.setValueAtTime(l,n.ctx.currentTime),A._panner.positionZ.setValueAtTime(h,n.ctx.currentTime)):A._panner.setPosition(s,l,h)),C._emit("pos",A._id)}}return C},i.prototype.orientation=function(s,l,h,p){var C=this;if(!C._webAudio)return C;if("loaded"!==C._state)return C._queue.push({event:"orientation",action:function(){C.orientation(s,l,h,p)}}),C;if(l="number"!=typeof l?C._orientation[1]:l,h="number"!=typeof h?C._orientation[2]:h,typeof p>"u"){if("number"!=typeof s)return C._orientation;C._orientation=[s,l,h]}for(var D=C._getSoundIds(p),T=0;T<D.length;T++){var A=C._soundById(D[T]);if(A){if("number"!=typeof s)return A._orientation;A._orientation=[s,l,h],A._node&&(A._panner||(A._pos||(A._pos=C._pos||[0,0,-.5]),o(A,"spatial")),typeof A._panner.orientationX<"u"?(A._panner.orientationX.setValueAtTime(s,n.ctx.currentTime),A._panner.orientationY.setValueAtTime(l,n.ctx.currentTime),A._panner.orientationZ.setValueAtTime(h,n.ctx.currentTime)):A._panner.setOrientation(s,l,h)),C._emit("orientation",A._id)}}return C},i.prototype.pannerAttr=function(){var h,p,C,s=this,l=arguments;if(!s._webAudio)return s;if(0===l.length)return s._pannerAttr;if(1===l.length){if("object"!=typeof l[0])return(C=s._soundById(parseInt(l[0],10)))?C._pannerAttr:s._pannerAttr;h=l[0],typeof p>"u"&&(h.pannerAttr||(h.pannerAttr={coneInnerAngle:h.coneInnerAngle,coneOuterAngle:h.coneOuterAngle,coneOuterGain:h.coneOuterGain,distanceModel:h.distanceModel,maxDistance:h.maxDistance,refDistance:h.refDistance,rolloffFactor:h.rolloffFactor,panningModel:h.panningModel}),s._pannerAttr={coneInnerAngle:typeof h.pannerAttr.coneInnerAngle<"u"?h.pannerAttr.coneInnerAngle:s._coneInnerAngle,coneOuterAngle:typeof h.pannerAttr.coneOuterAngle<"u"?h.pannerAttr.coneOuterAngle:s._coneOuterAngle,coneOuterGain:typeof h.pannerAttr.coneOuterGain<"u"?h.pannerAttr.coneOuterGain:s._coneOuterGain,distanceModel:typeof h.pannerAttr.distanceModel<"u"?h.pannerAttr.distanceModel:s._distanceModel,maxDistance:typeof h.pannerAttr.maxDistance<"u"?h.pannerAttr.maxDistance:s._maxDistance,refDistance:typeof h.pannerAttr.refDistance<"u"?h.pannerAttr.refDistance:s._refDistance,rolloffFactor:typeof h.pannerAttr.rolloffFactor<"u"?h.pannerAttr.rolloffFactor:s._rolloffFactor,panningModel:typeof h.pannerAttr.panningModel<"u"?h.pannerAttr.panningModel:s._panningModel})}else 2===l.length&&(h=l[0],p=parseInt(l[1],10));for(var D=s._getSoundIds(p),T=0;T<D.length;T++)if(C=s._soundById(D[T])){var A=C._pannerAttr;A={coneInnerAngle:typeof h.coneInnerAngle<"u"?h.coneInnerAngle:A.coneInnerAngle,coneOuterAngle:typeof h.coneOuterAngle<"u"?h.coneOuterAngle:A.coneOuterAngle,coneOuterGain:typeof h.coneOuterGain<"u"?h.coneOuterGain:A.coneOuterGain,distanceModel:typeof h.distanceModel<"u"?h.distanceModel:A.distanceModel,maxDistance:typeof h.maxDistance<"u"?h.maxDistance:A.maxDistance,refDistance:typeof h.refDistance<"u"?h.refDistance:A.refDistance,rolloffFactor:typeof h.rolloffFactor<"u"?h.rolloffFactor:A.rolloffFactor,panningModel:typeof h.panningModel<"u"?h.panningModel:A.panningModel};var M=C._panner;M||(C._pos||(C._pos=s._pos||[0,0,-.5]),o(C,"spatial"),M=C._panner),M.coneInnerAngle=A.coneInnerAngle,M.coneOuterAngle=A.coneOuterAngle,M.coneOuterGain=A.coneOuterGain,M.distanceModel=A.distanceModel,M.maxDistance=A.maxDistance,M.refDistance=A.refDistance,M.rolloffFactor=A.rolloffFactor,M.panningModel=A.panningModel}return s},r.prototype.init=function(s){return function(){var l=this,h=l._parent;l._orientation=h._orientation,l._stereo=h._stereo,l._pos=h._pos,l._pannerAttr=h._pannerAttr,s.call(this),l._stereo?h.stereo(l._stereo):l._pos&&h.pos(l._pos[0],l._pos[1],l._pos[2],l._id)}}(r.prototype.init),r.prototype.reset=function(s){return function(){var l=this,h=l._parent;return l._orientation=h._orientation,l._stereo=h._stereo,l._pos=h._pos,l._pannerAttr=h._pannerAttr,l._stereo?h.stereo(l._stereo):l._pos?h.pos(l._pos[0],l._pos[1],l._pos[2],l._id):l._panner&&(l._panner.disconnect(0),l._panner=void 0,h._refreshBuffer(l)),s.call(this)}}(r.prototype.reset);var o=function(s,l){"spatial"===(l=l||"spatial")?(s._panner=n.ctx.createPanner(),s._panner.coneInnerAngle=s._pannerAttr.coneInnerAngle,s._panner.coneOuterAngle=s._pannerAttr.coneOuterAngle,s._panner.coneOuterGain=s._pannerAttr.coneOuterGain,s._panner.distanceModel=s._pannerAttr.distanceModel,s._panner.maxDistance=s._pannerAttr.maxDistance,s._panner.refDistance=s._pannerAttr.refDistance,s._panner.rolloffFactor=s._pannerAttr.rolloffFactor,s._panner.panningModel=s._pannerAttr.panningModel,typeof s._panner.positionX<"u"?(s._panner.positionX.setValueAtTime(s._pos[0],n.ctx.currentTime),s._panner.positionY.setValueAtTime(s._pos[1],n.ctx.currentTime),s._panner.positionZ.setValueAtTime(s._pos[2],n.ctx.currentTime)):s._panner.setPosition(s._pos[0],s._pos[1],s._pos[2]),typeof s._panner.orientationX<"u"?(s._panner.orientationX.setValueAtTime(s._orientation[0],n.ctx.currentTime),s._panner.orientationY.setValueAtTime(s._orientation[1],n.ctx.currentTime),s._panner.orientationZ.setValueAtTime(s._orientation[2],n.ctx.currentTime)):s._panner.setOrientation(s._orientation[0],s._orientation[1],s._orientation[2])):(s._panner=n.ctx.createStereoPanner(),s._panner.pan.setValueAtTime(s._stereo,n.ctx.currentTime)),s._panner.connect(s._node),s._paused||s._parent.pause(s._id,!0).play(s._id,!0)}}(hp,le,Tu,xu);const fp=typeof self>"u",Ik=(()=>{if(!fp&&document.currentScript){let t=document.currentScript.src,n=t.indexOf("?");if(-1!=n)t=t.substring(0,n);else{let i=t.indexOf("#");-1!=i&&(t=t.substring(0,i))}return t.substring(0,t.lastIndexOf("/")+1)}return"./"})();function R(t,n,i,r){if("a"===i&&!r)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof n?t!==n||!r:!n.has(t))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===i?r:"a"===i?r.call(t):r?r.value:n.get(t)}function Te(t,n,i,r,o){if("m"===r)throw new TypeError("Private method is not writable");if("a"===r&&!o)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof n?t!==n||!o:!n.has(t))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===r?o.call(t,i):o?o.value=i:n.set(t,i),i}let tl,Xi,Ou,Mu,on;null==at.dce&&(at.dce=Ik),ps.dce={wasm:!1,js:!1},bn.dce={},"function"==typeof SuppressedError&&SuppressedError,typeof navigator<"u"&&(tl=navigator,Xi=tl.userAgent,Ou=tl.platform,Mu=tl.mediaDevices),function(){if(!fp){const t={Edge:{search:"Edg",verSearch:"Edg"},OPR:null,Chrome:null,Safari:{str:tl.vendor,search:"Apple",verSearch:["Version","iPhone OS","CPU OS"]},Firefox:null,Explorer:{search:"MSIE",verSearch:"MSIE"}},n={HarmonyOS:null,Android:null,iPhone:null,iPad:null,Windows:{str:Ou,search:"Win"},Mac:{str:Ou},Linux:{str:Ou}};let i="unknownBrowser",r=0,o="unknownOS";for(let s in t){const l=t[s]||{};let C=l.verStr||Xi,D=l.verSearch||s;if(D instanceof Array||(D=[D]),-1!=(l.str||Xi).indexOf(l.search||s)){i=s;for(let T of D){let A=C.indexOf(T);if(-1!=A){r=parseFloat(C.substring(A+T.length+1));break}}break}}for(let s in n){const l=n[s]||{};if(-1!=(l.str||Xi).indexOf(l.search||s)){o=s;break}}"Linux"==o&&-1!=Xi.indexOf("Windows NT")&&(o="HarmonyOS"),on={browser:i,version:r,OS:o}}fp&&(on={browser:"ssr",version:0,OS:"ssr"})}();const Dk=typeof WebAssembly<"u"&&Xi&&!(/Safari/.test(Xi)&&!/Chrome/.test(Xi)&&/\(.+\s11_2_([2-6]).*\)/.test(Xi)),bk=!(typeof Worker>"u"),kI=!(!Mu||!Mu.getUserMedia),Sk=function(){var t=J(function*(){let n=!1;if(kI)try{(yield Mu.getUserMedia({video:!0})).getTracks().forEach(i=>{i.stop()}),n=!0}catch{}return n});return function(){return t.apply(this,arguments)}}();var Jt,Ln,Sr,BI;(function(t){t[t.DIMT_RECTANGLE=1]="DIMT_RECTANGLE",t[t.DIMT_QUADRILATERAL=2]="DIMT_QUADRILATERAL",t[t.DIMT_TEXT=4]="DIMT_TEXT",t[t.DIMT_ARC=8]="DIMT_ARC",t[t.DIMT_IMAGE=16]="DIMT_IMAGE",t[t.DIMT_POLYGON=32]="DIMT_POLYGON",t[t.DIMT_LINE=64]="DIMT_LINE",t[t.DIMT_GROUP=128]="DIMT_GROUP"})(Jt||(Jt={})),function(t){t[t.DIS_DEFAULT=1]="DIS_DEFAULT",t[t.DIS_SELECTED=2]="DIS_SELECTED"}(Ln||(Ln={})),function(t){t[t.EF_ENHANCED_FOCUS=4]="EF_ENHANCED_FOCUS",t[t.EF_AUTO_ZOOM=16]="EF_AUTO_ZOOM",t[t.EF_TAP_TO_FOCUS=64]="EF_TAP_TO_FOCUS"}(Sr||(Sr={})),function(t){t.GREY="grey",t.GREY32="grey32",t.RGBA="rgba",t.RBGA="rbga",t.GRBA="grba",t.GBRA="gbra",t.BRGA="brga",t.BGRA="bgra"}(BI||(BI={}));const ys=t=>"number"==typeof t&&!Number.isNaN(t),gp=t=>"string"==typeof t;var Ru,nl,ws,pp,bi,Lu;(function(t){t.ARC="arc",t.IMAGE="image",t.LINE="line",t.POLYGON="polygon",t.QUAD="quad",t.RECT="rect",t.TEXT="text",t.GROUP="group"})(bi||(bi={})),function(t){t.DEFAULT="default",t.SELECTED="selected"}(Lu||(Lu={}));class gn{get mediaType(){return new Map([["rect",Jt.DIMT_RECTANGLE],["quad",Jt.DIMT_QUADRILATERAL],["text",Jt.DIMT_TEXT],["arc",Jt.DIMT_ARC],["image",Jt.DIMT_IMAGE],["polygon",Jt.DIMT_POLYGON],["line",Jt.DIMT_LINE],["group",Jt.DIMT_GROUP]]).get(this._mediaType)}get styleSelector(){switch(R(this,nl,"f")){case Ln.DIS_DEFAULT:return"default";case Ln.DIS_SELECTED:return"selected"}}set drawingStyleId(n){this.styleId=n}get drawingStyleId(){return this.styleId}set coordinateBase(n){if(!["view","image"].includes(n))throw new Error("Invalid 'coordinateBase'.");this._drawingLayer&&("image"===R(this,ws,"f")&&"view"===n?this.updateCoordinateBaseFromImageToView():"view"===R(this,ws,"f")&&"image"===n&&this.updateCoordinateBaseFromViewToImage()),Te(this,ws,n,"f")}get coordinateBase(){return R(this,ws,"f")}get drawingLayerId(){return this._drawingLayerId}constructor(n,i){if(Ru.add(this),nl.set(this,void 0),ws.set(this,"image"),this._zIndex=null,this._drawingLayer=null,this._drawingLayerId=null,this._mapStyle=new Map,this._mapState_StyleId=new Map,this.mapEvent_Callbacks=new Map([["selected",new Map],["deselected",new Map],["mousedown",new Map],["mouseup",new Map],["dblclick",new Map],["mouseover",new Map],["mouseout",new Map]]),this.mapNoteName_Content=new Map([]),this.isDrawingItem=!0,null!=i&&!ys(i))throw new TypeError("Invalid 'drawingStyleId'.");n&&this._setFabricObject(n),this.setState(Ln.DIS_DEFAULT),this.styleId=i}_setFabricObject(n){this._fabricObject=n,this._fabricObject.on("selected",()=>{this.setState(Ln.DIS_SELECTED)}),this._fabricObject.on("deselected",()=>{this._fabricObject.canvas&&this._fabricObject.canvas.getActiveObjects().includes(this._fabricObject)?this.setState(Ln.DIS_SELECTED):this.setState(Ln.DIS_DEFAULT),"textbox"===this._fabricObject.type&&(this._fabricObject.isEditing&&this._fabricObject.exitEditing(),this._fabricObject.selected=!1)}),n.getDrawingItem=()=>this}_getFabricObject(){return this._fabricObject}setState(n){Te(this,nl,n,"f")}getState(){return R(this,nl,"f")}_on(n,i){if(!i)return;const r=n.toLowerCase(),o=this.mapEvent_Callbacks.get(r);if(!o)throw new Error(`Event '${n}' does not exist.`);let s=o.get(i);s||(s=l=>{const h=l.e;if(!h)return void(i&&i.apply(this,[{targetItem:this,itemClientX:null,itemClientY:null,itemPageX:null,itemPageY:null}]));const p={targetItem:this,itemClientX:null,itemClientY:null,itemPageX:null,itemPageY:null};if(this._drawingLayer){let C,D,T,A;const M=h.target.getBoundingClientRect();C=M.left,D=M.top,T=C+window.scrollX,A=D+window.scrollY;const{width:P,height:B}=this._drawingLayer.fabricCanvas.lowerCanvasEl.getBoundingClientRect(),k=this._drawingLayer.width,U=this._drawingLayer.height,V=P/B,q=k/U,ce=this._drawingLayer._getObjectFit();let ge,ve,me,S,we=1;if("contain"===ce)V<q?(we=P/k,ge=C+this.get("x")*we,ve=D+this.get("y")*we+(B-U*we)/2,me=T+this.get("x")*we,S=A+this.get("y")*we+(B-U*we)/2):(we=B/U,ge=C+this.get("x")*we+(P-k*we)/2,ve=D+this.get("y")*we,me=T+this.get("x")*we+(P-k*we)/2,S=A+this.get("y")*we);else if("cover"===ce)if(V<q){we=B/U;let Me=this.get("x")*we-(k*we-P)/2;Me=Math.max(Me,0),Me=Math.min(Me,P),ge=C+Me,ve=D+this.get("y")*we,me=T+Me,S=A+this.get("y")*we}else{we=P/k;let Me=this.get("y")*we-(U*we-B)/2;Me=Math.max(Me,0),Me=Math.min(Me,B),ge=C+this.get("x")*we,ve=D+Me,me=T+this.get("x")*we,S=A+Me}p.itemClientX=Math.round(ge),p.itemClientY=Math.round(ve),p.itemPageX=Math.round(me),p.itemPageY=Math.round(S)}for(let C of Object.getOwnPropertyNames(p))Object.defineProperty(h,C,{value:p[C],writable:!0});i&&i.apply(this,[h])},o.set(i,s),this._fabricObject.on("dblclick"===r?"mousedblclick":r,s))}on(n,i){this._on(n,i)}_off(n,i){const r=n.toLowerCase(),o=this.mapEvent_Callbacks.get(r);if(!o)throw new Error(`Event '${n}' does not exist.`);let s=o.get(i);s&&(o.delete(i),this._fabricObject.off("dblclick"===r?"mousedblclick":r,s))}off(n,i){this._off(n,i)}_setEditable(n){const i=this._fabricObject;n?(i.selectable=!0,i.hasControls=!0,i.hoverCursor=null):(i.selectable=!1,i.hasControls=!1,i.hoverCursor="default")}hasNote(n){return this.mapNoteName_Content.has(n)}addNote(n,i){if(this.hasNote(n.name)&&!i)throw new Error("A note with the same name already exists, please use a different name.");const r=n.content?JSON.parse(JSON.stringify(n.content)):n.content;this.mapNoteName_Content.set(n.name,[r])}getNote(n){const i=this.mapNoteName_Content.get(n);return i?1===i.length?{name:n,content:i[0]?JSON.parse(JSON.stringify(i[0])):i[0]}:{name:n,content:JSON.parse(JSON.stringify(i))}:null}getNotes(){const n=[];for(let i of this.mapNoteName_Content){let r=1===i[1].length?i[1][0]:i[1];r=r&&JSON.parse(JSON.stringify(r)),n.push({name:i[0],content:r})}return n}updateNote(n,i,r){const o=this.mapNoteName_Content.get(n);if(!o)throw new Error("The note name does not exist.");r||(o.length=0),i=i&&JSON.parse(JSON.stringify(i)),o.push(i)}deleteNote(n){this.mapNoteName_Content.delete(n)}clearNotes(){this.mapNoteName_Content.clear()}set(n,i){if(!this.extendSet(n,i))if("x"===n){const r=this._fabricObject.group;r?(this._fabricObject.set("left",i-r.left-r.width/2),r.addWithUpdate()):this._fabricObject.set("left",i)}else if("y"===n){const r=this._fabricObject.group;r?(this._fabricObject.set("top",i-r.top-r.height/2),r.addWithUpdate()):this._fabricObject.set("top",i)}else"styleId"===n?this.styleId=i:this._fabricObject.set(n,i);["vertices","startPoint","endPoint","x","y","left","top","width","height","scaleX","scaleY","skewX","skewY","padding","angle","strokeWidth"].includes(n)&&this._fabricObject.setCoords()}get(n){let i=this.extendGet(n);if(void 0===i)if("x"===n){const r=this._fabricObject.group;i=r?this._fabricObject.get("left")+r.left+r.width/2:this._fabricObject.get("left")}else if("y"===n){const r=this._fabricObject.group;i=r?this._fabricObject.get("top")+r.top+r.height/2:this._fabricObject.get("top")}else i="scaledWidth"===n?this._fabricObject.getScaledWidth():"scaledHeight"===n?this._fabricObject.getScaledHeight():["type","mediaType"].includes(n)?this.mediaType:"state"===n?this.getState():"styleId"===n?this.styleId:"drawingLayerId"===n?this.drawingLayerId:this._fabricObject.get(n);return i}remove(){this._drawingLayer&&this._drawingLayer.removeDrawingItem(this)}convertPropFromImageToView(n){if("number"!=typeof n)throw new TypeError("Invalid value.");return n*R(this,Ru,"m",pp).call(this)}convertPropFromViewToImage(n){if("number"!=typeof n)throw new TypeError("Invalid value.");return n/R(this,Ru,"m",pp).call(this)}_setLineWidth(n){if(this._drawingLayer)if("view"===this.coordinateBase)this.set("strokeWidth",this.convertPropFromViewToImage(n));else{if("image"!==this.coordinateBase)throw new Error("Invalid 'coordinateBase'.");this.set("strokeWidth",n)}}_getLineWidth(){if(this._drawingLayer){if("view"===this.coordinateBase)return this.convertPropFromImageToView(this.get("strokeWidth"));if("image"===this.coordinateBase)return this.get("strokeWidth");throw new Error("Invalid 'coordinateBase'.")}}_setFontSize(n){if(this._drawingLayer)if("view"===this.coordinateBase)this.set("fontSize",this.convertPropFromViewToImage(n));else{if("image"!==this.coordinateBase)throw new Error("Invalid 'coordinateBase'.");this.set("fontSize",n)}}_getFontSize(){if(this._drawingLayer){if("view"===this.coordinateBase)return this.convertPropFromImageToView(this.get("fontSize"));if("image"===this.coordinateBase)return this.get("fontSize");throw new Error("Invalid 'coordinateBase'.")}}}nl=new WeakMap,ws=new WeakMap,Ru=new WeakSet,pp=function(){const t=this._drawingLayer;if(!t)return 1;const n=t.width,i=t.height,{width:r,height:o}=t.fabricCanvas.wrapperEl.getBoundingClientRect();if(r<=0||o<=0)throw new Error("Unable to get drawing layer dimensions. Layer may not be rendered on the page.");const s=r/n,l=o/i,h=t._getObjectFit();let p=1;return"contain"===h?p=s<l?r/n:o/i:"cover"===h&&(p=s<l?o/i:r/n),p},gn.arrMediaTypes=["rect","arc","polygon","image","text","line","quad"],gn.mapItemType=new Map([[bi.ARC,"arc"],[bi.IMAGE,"image"],[bi.LINE,"line"],[bi.POLYGON,"polygon"],[bi.QUAD,"quad"],[bi.RECT,"rect"],[bi.TEXT,"text"],[bi.GROUP,"group"]]),gn.arrStyleSelectors=["default","selected"],gn.mapItemState=new Map([[Lu.DEFAULT,"default"],[Lu.SELECTED,"selected"]]);const jI=t=>null!==t&&"object"==typeof t&&!Array.isArray(t),mp=t=>!!gp(t)&&""!==t,vp=t=>!(!si(t)||!kt(t.left)||t.left<0||!kt(t.top)||t.top<0||!kt(t.right)||t.right<0||!kt(t.bottom)||t.bottom<0||t.left>=t.right||t.top>=t.bottom||!$g(t.isMeasuredInPercentage)),UI=t=>!!si(t)&&!!zg(t.points)&&0!=t.points.length&&!t.points.some(n=>!fs(n)),Tk=fs,GI=t=>!!si(t)&&!!zg(t.points)&&0!=t.points.length&&4==t.points.length&&!t.points.some(n=>!fs(n)),qi=t=>!(!si(t)||!kt(t.x)||!kt(t.y)||!kt(t.width)||t.width<0||!kt(t.height)||t.height<0||"isMeasuredInPercentage"in t&&!$g(t.isMeasuredInPercentage)),HI=t=>!(!jI(t)||"id"in t&&!ys(t.id)||"lineWidth"in t&&!ys(t.lineWidth)||"fillStyle"in t&&!mp(t.fillStyle)||"strokeStyle"in t&&!mp(t.strokeStyle)||"paintMode"in t&&!["fill","stroke","strokeAndFill"].includes(t.paintMode)||"fontFamily"in t&&!mp(t.fontFamily)||"fontSize"in t&&!ys(t.fontSize));class Fu{static convert(n,i,r){const o={x:0,y:0,width:i,height:r};if(!n)return o;if(qi(n))n.isMeasuredInPercentage?(o.x=n.x/100*i,o.y=n.y/100*r,o.width=n.width/100*i,o.height=n.height/100*r):(o.x=n.x,o.y=n.y,o.width=n.width,o.height=n.height);else{if(!vp(n))throw TypeError("Invalid region.");n.isMeasuredInPercentage?(o.x=n.left/100*i,o.y=n.top/100*r,o.width=(n.right-n.left)/100*i,o.height=(n.bottom-n.top)/100*r):(o.x=n.left,o.y=n.top,o.width=n.right-n.left,o.height=n.bottom-n.top)}return o.x=Math.round(o.x),o.y=Math.round(o.y),o.width=Math.round(o.width),o.height=Math.round(o.height),o}}var so,Pu;class WI{constructor(){so.set(this,new Map),Pu.set(this,!1)}get disposed(){return R(this,Pu,"f")}on(n,i){n=n.toLowerCase();const r=R(this,so,"f").get(n);if(r){if(r.includes(i))return;r.push(i)}else R(this,so,"f").set(n,[i])}off(n,i){n=n.toLowerCase();const r=R(this,so,"f").get(n);if(!r)return;const o=r.indexOf(i);-1!==o&&r.splice(o,1)}offAll(n){n=n.toLowerCase();const i=R(this,so,"f").get(n);i&&(i.length=0)}fire(n,i=[],r={async:!1,copy:!0}){var o=this;return J(function*(){i||(i=[]),n=n.toLowerCase();const s=R(o,so,"f").get(n);if(s&&s.length){r=Object.assign({async:!1,copy:!0},r);for(let l of s){if(!l)continue;let h=[];if(r.copy)for(let C of i){try{C=JSON.parse(JSON.stringify(C))}catch{}h.push(C)}else h=i;let p=!1;if(r.async)setTimeout(()=>{o.disposed||l.apply(r.target,h)},0);else try{p=yield l.apply(r.target,h)}catch{}if(!0===p)break}}})()}dispose(){Te(this,Pu,!0,"f")}}function xk(t,n,i){return(i.x-t.x)*(n.y-t.y)==(n.x-t.x)*(i.y-t.y)&&Math.min(t.x,n.x)<=i.x&&i.x<=Math.max(t.x,n.x)&&Math.min(t.y,n.y)<=i.y&&i.y<=Math.max(t.y,n.y)}function yp(t){return Math.abs(t)<1e-6?0:t<0?-1:1}function Nu(t,n,i,r){let o=t[0]*(i[1]-n[1])+n[0]*(t[1]-i[1])+i[0]*(n[1]-t[1]),s=t[0]*(r[1]-n[1])+n[0]*(t[1]-r[1])+r[0]*(n[1]-t[1]);return!((o^s)>=0&&0!==o&&0!==s||(o=i[0]*(t[1]-r[1])+r[0]*(i[1]-t[1])+t[0]*(r[1]-i[1]),s=i[0]*(n[1]-r[1])+r[0]*(i[1]-n[1])+n[0]*(r[1]-i[1]),(o^s)>=0&&0!==o&&0!==s))}so=new WeakMap,Pu=new WeakMap;const wp=function(){var t=J(function*(n){if("string"!=typeof n)throw new TypeError("Invalid url.");const i=yield fetch(n);if(!i.ok)throw Error("Network Error: "+i.statusText);const r=yield i.text();if(!r.trim().startsWith("<"))throw Error("Unable to get valid HTMLElement.");const o=document.createElement("div");o.insertAdjacentHTML("beforeend",r);for(let s=0;s<o.childElementCount;++s){let l=o.children[s];l instanceof HTMLStyleElement&&document.head.append(l)}return 1==o.childElementCount?o.children[0]:o});return function(i){return t.apply(this,arguments)}}();var Tr,xr,Or;class ao extends gn{constructor(n,i){if(super(null,i),Tr.set(this,void 0),!qi(n))throw new TypeError("Invalid 'rect'.");this._setFabricObject(new Xe.Rect({left:n.x,top:n.y,width:n.width,height:n.height})),Te(this,Tr,JSON.parse(JSON.stringify(n)),"f"),this._mediaType="rect"}extendSet(n,i){return!1}extendGet(n){}updateCoordinateBaseFromImageToView(){this.set("left",this.convertPropFromViewToImage(this.get("left"))),this.set("top",this.convertPropFromViewToImage(this.get("top"))),this.set("width",this.convertPropFromViewToImage(this.get("scaledWidth"))),this.set("height",this.convertPropFromViewToImage(this.get("scaledHeight")))}updateCoordinateBaseFromViewToImage(){this.set("left",this.convertPropFromImageToView(this.get("left"))),this.set("top",this.convertPropFromImageToView(this.get("top"))),this.set("width",this.convertPropFromImageToView(this.get("scaledWidth"))),this.set("height",this.convertPropFromImageToView(this.get("scaledHeight")))}setPosition(n){this.setRect(n)}getPosition(){return this.getRect()}updatePosition(){R(this,Tr,"f")&&this.setRect(R(this,Tr,"f"))}setRect(n){if(!qi(n))throw new TypeError("Invalid 'rect'.");if(this._drawingLayer){if("view"===this.coordinateBase)this.set("left",this.convertPropFromViewToImage(n.x)),this.set("top",this.convertPropFromViewToImage(n.y)),this.set("width",this.convertPropFromViewToImage(n.width)),this.set("height",this.convertPropFromViewToImage(n.height));else{if("image"!==this.coordinateBase)throw new Error("Invalid 'coordinateBase'.");this.set("left",n.x),this.set("top",n.y),this.set("width",n.width),this.set("height",n.height)}this._drawingLayer.renderAll()}else Te(this,Tr,JSON.parse(JSON.stringify(n)),"f")}getRect(){if(this._drawingLayer){if("view"===this.coordinateBase)return{x:this.convertPropFromImageToView(this.get("left")),y:this.convertPropFromImageToView(this.get("top")),width:this.convertPropFromImageToView(this.get("scaledWidth")),height:this.convertPropFromImageToView(this.get("scaledHeight"))};if("image"===this.coordinateBase)return{x:this.get("left"),y:this.get("top"),width:this.get("scaledWidth"),height:this.get("scaledHeight")};throw new Error("Invalid 'coordinateBase'.")}return R(this,Tr,"f")?JSON.parse(JSON.stringify(R(this,Tr,"f"))):null}}function Cp(t,n,i){return Xe.util.transformPoint({x:i.points[this.pointIndex].x-i.pathOffset.x,y:i.points[this.pointIndex].y-i.pathOffset.y},i.calcTransformMatrix())}function YI(t){let n=new Xe.Point(t.strokeUniform?1/t.scaleX:1,t.strokeUniform?1/t.scaleY:1).multiply(t.strokeWidth);return new Xe.Point(t.width+n.x,t.height+n.y)}function Ep(t,n,i,r){let o=n.target,s=o.controls[o.__corner],l=o.toLocalPoint(new Xe.Point(i,r),"center","center"),h=YI(o),p=o._getTransformedDimensions(0,0);return o.points[s.pointIndex]={x:l.x*h.x/p.x+o.pathOffset.x,y:l.y*h.y/p.y+o.pathOffset.y},!0}function Ip(t,n){return function(i,r,o,s){let l=r.target,h=Xe.util.transformPoint({x:l.points[t].x-l.pathOffset.x,y:l.points[t].y-l.pathOffset.y},l.calcTransformMatrix()),p=n(i,r,o,s);l._setPositionDimensions({});let C=YI(l);return l.setPositionByOrigin(h,(l.points[t].x-l.pathOffset.x)/C.x+.5,(l.points[t].y-l.pathOffset.y)/C.y+.5),p}}Tr=new WeakMap;class ku extends gn{constructor(n,i){if(super(null,i),xr.set(this,void 0),!UI(n))throw new TypeError("Invalid 'polygon'.");this._setFabricObject(new Xe.Polygon(n.points,{objectCaching:!1}));const r=this._fabricObject;let o=r.points.length-1;r.controls=r.points.reduce(function(s,l,h){return s["p"+h]=new Xe.Control({positionHandler:Cp,actionHandler:Ip(h>0?h-1:o,Ep),actionName:"modifyPolygon",pointIndex:h}),s},{}),Te(this,xr,JSON.parse(JSON.stringify(n)),"f"),this._mediaType="polygon"}extendSet(n,i){if("vertices"===n){const r=this._fabricObject;if(r.group){const s=r.group;r.points=i.map(l=>({x:l.x-s.left-s.width/2,y:l.y-s.top-s.height/2})),s.addWithUpdate()}else r.points=i;const o=r.points.length-1;return r.controls=r.points.reduce(function(s,l,h){return s["p"+h]=new Xe.Control({positionHandler:Cp,actionHandler:Ip(h>0?h-1:o,Ep),actionName:"modifyPolygon",pointIndex:h}),s},{}),r._setPositionDimensions({}),!0}}extendGet(n){if("vertices"===n){const i=[],r=this._fabricObject;if(r.selectable&&!r.group)for(let o in r.oCoords)i.push({x:r.oCoords[o].x,y:r.oCoords[o].y});else for(let o of r.points){const h=Xe.util.transformPoint({x:o.x-r.pathOffset.x,y:o.y-r.pathOffset.y},r.calcTransformMatrix());i.push({x:h.x,y:h.y})}return i}}updateCoordinateBaseFromImageToView(){const n=this.get("vertices").map(i=>({x:this.convertPropFromViewToImage(i.x),y:this.convertPropFromViewToImage(i.y)}));this.set("vertices",n)}updateCoordinateBaseFromViewToImage(){const n=this.get("vertices").map(i=>({x:this.convertPropFromImageToView(i.x),y:this.convertPropFromImageToView(i.y)}));this.set("vertices",n)}setPosition(n){this.setPolygon(n)}getPosition(){return this.getPolygon()}updatePosition(){R(this,xr,"f")&&this.setPolygon(R(this,xr,"f"))}setPolygon(n){if(!UI(n))throw new TypeError("Invalid 'polygon'.");if(this._drawingLayer){if("view"===this.coordinateBase){const i=n.points.map(r=>({x:this.convertPropFromViewToImage(r.x),y:this.convertPropFromViewToImage(r.y)}));this.set("vertices",i)}else{if("image"!==this.coordinateBase)throw new Error("Invalid 'coordinateBase'.");this.set("vertices",n.points)}this._drawingLayer.renderAll()}else Te(this,xr,JSON.parse(JSON.stringify(n)),"f")}getPolygon(){if(this._drawingLayer){if("view"===this.coordinateBase)return{points:this.get("vertices").map(n=>({x:this.convertPropFromImageToView(n.x),y:this.convertPropFromImageToView(n.y)}))};if("image"===this.coordinateBase)return{points:this.get("vertices")};throw new Error("Invalid 'coordinateBase'.")}return R(this,xr,"f")?JSON.parse(JSON.stringify(R(this,xr,"f"))):null}}xr=new WeakMap;const zI=t=>{let n=t.split("\n").map(r=>r.split("\t"));return(i=>{for(let r=0;;r++){let o=-1;for(let s=0;s<i.length;s++){let l=i[s][r];void 0!==l&&l.length>o&&(o=l.length)}if(-1===o)break;for(let s=0;s<i.length;s++){if(r>=i[s].length-1)continue;let l=" ".repeat(o+2-i[s][r].length);i[s][r]=i[s][r].concat(l)}}})(n),(i=>{let r="";for(let o=0;o<i.length;o++)r=r.concat(...i[o],o===i.length-1?"":"\n");return r})(n)};class $I extends gn{constructor(n,i,r){if(super(null,r),Or.set(this,void 0),!gp(n))throw new TypeError("Invalid 'text'.");if(!qi(i))throw new TypeError("Invalid 'rect'.");this._setFabricObject(new Xe.Textbox(zI(n),{left:i.x,top:i.y,width:i.width})),this._text=n,Te(this,Or,JSON.parse(JSON.stringify(i)),"f"),this._mediaType="text"}extendSet(n,i){if("text"===n)return this._text=i,this._fabricObject.set("text",zI(i)),!0}extendGet(n){if("text"===n)return this._text}updateCoordinateBaseFromImageToView(){this.set("left",this.convertPropFromViewToImage(this.get("left"))),this.set("top",this.convertPropFromViewToImage(this.get("top"))),this.set("width",this.convertPropFromViewToImage(this.get("scaledWidth")))}updateCoordinateBaseFromViewToImage(){this.set("left",this.convertPropFromImageToView(this.get("left"))),this.set("top",this.convertPropFromImageToView(this.get("top"))),this.set("width",this.convertPropFromImageToView(this.get("scaledWidth")))}setPosition(n){this.setTextRect(n)}getPosition(){return this.getTextRect()}updatePosition(){R(this,Or,"f")&&this.setTextRect(R(this,Or,"f"))}setText(n){if(!gp(n))throw new TypeError("Invalid 'text'.");this.set("text",n)}getText(){return this.get("text")}setTextRect(n){if(!qi(n))throw new TypeError("Invalid 'rect'.");if(this._drawingLayer){if("view"===this.coordinateBase)this.set("left",this.convertPropFromViewToImage(n.x)),this.set("top",this.convertPropFromViewToImage(n.y)),this.set("width",this.convertPropFromViewToImage(n.width));else{if("image"!==this.coordinateBase)throw new Error("Invalid 'coordinateBase'.");this.set("left",n.x),this.set("top",n.y),this.set("width",n.width)}this._drawingLayer.renderAll()}else Te(this,Or,JSON.parse(JSON.stringify(n)),"f")}getTextRect(){if(this._drawingLayer){if("view"===this.coordinateBase)return{x:this.convertPropFromImageToView(this.get("left")),y:this.convertPropFromImageToView(this.get("top")),width:this.convertPropFromImageToView(this.get("scaledWidth")),height:this.convertPropFromImageToView(this.get("scaledHeight"))};if("image"===this.coordinateBase)return{x:this.get("left"),y:this.get("top"),width:this.get("scaledWidth"),height:this.get("scaledHeight")};throw new Error("Invalid 'coordinateBase'.")}return R(this,Or,"f")?JSON.parse(JSON.stringify(R(this,Or,"f"))):null}}var Rr,Lr,Cs,Dp,Es,il,Is,Fn,rl,ol,sl,XI,qI,ZI,KI,Bu,wt,al,ll,cl,en,ju,Vu,Uu,Fr,ul,dl,bp,li,Gu,QI,Sp,Tp,hl,Hu;Or=new WeakMap;class JI extends ku{constructor(n,i){if(super({points:n?.points},i),Rr.set(this,void 0),!GI(n))throw new TypeError("Invalid 'quad'.");Te(this,Rr,JSON.parse(JSON.stringify(n)),"f"),this._mediaType="quad"}setPosition(n){this.setQuad(n)}getPosition(){return this.getQuad()}updatePosition(){R(this,Rr,"f")&&this.setQuad(R(this,Rr,"f"))}setPolygon(){}getPolygon(){return null}setQuad(n){if(!GI(n))throw new TypeError("Invalid 'quad'.");if(this._drawingLayer){if("view"===this.coordinateBase){const i=n.points.map(r=>({x:this.convertPropFromViewToImage(r.x),y:this.convertPropFromViewToImage(r.y)}));this.set("vertices",i)}else{if("image"!==this.coordinateBase)throw new Error("Invalid 'coordinateBase'.");this.set("vertices",n.points)}this._drawingLayer.renderAll()}else Te(this,Rr,JSON.parse(JSON.stringify(n)),"f")}getQuad(){if(this._drawingLayer){if("view"===this.coordinateBase)return{points:this.get("vertices").map(n=>({x:this.convertPropFromImageToView(n.x),y:this.convertPropFromImageToView(n.y)}))};if("image"===this.coordinateBase)return{points:this.get("vertices")};throw new Error("Invalid 'coordinateBase'.")}return R(this,Rr,"f")?JSON.parse(JSON.stringify(R(this,Rr,"f"))):null}}Rr=new WeakMap;class Ak extends gn{constructor(n){super(new Xe.Group(n.map(i=>i._getFabricObject()))),this._fabricObject.on("selected",()=>{this.setState(Ln.DIS_SELECTED);const i=this._fabricObject._objects;for(let r of i)setTimeout(()=>{r&&r.fire("selected")},0);setTimeout(()=>{this._fabricObject&&this._fabricObject.canvas&&(this._fabricObject.dirty=!0,this._fabricObject.canvas.renderAll())},0)}),this._fabricObject.on("deselected",()=>{this.setState(Ln.DIS_DEFAULT);const i=this._fabricObject._objects;for(let r of i)setTimeout(()=>{r&&r.fire("deselected")},0);setTimeout(()=>{this._fabricObject&&this._fabricObject.canvas&&(this._fabricObject.dirty=!0,this._fabricObject.canvas.renderAll())},0)}),this._mediaType="group"}extendSet(n,i){return!1}extendGet(n){}updateCoordinateBaseFromImageToView(){}updateCoordinateBaseFromViewToImage(){}setPosition(){}getPosition(){}updatePosition(){}getChildDrawingItems(){return this._fabricObject._objects.map(n=>n.getDrawingItem())}setChildDrawingItems(n){if(!n||!n.isDrawingItem)throw TypeError("Illegal drawing item.");this._drawingLayer?this._drawingLayer._updateGroupItem(this,n,"add"):this._fabricObject.addWithUpdate(n._getFabricObject())}removeChildItem(n){n&&n.isDrawingItem&&(this._drawingLayer?this._drawingLayer._updateGroupItem(this,n,"remove"):this._fabricObject.removeWithUpdate(n._getFabricObject()))}}class de{static createDrawingStyle(n){if(!HI(n))throw new Error("Invalid style definition.");let i,r=de.USER_START_STYLE_ID;for(;R(de,Lr,"f",Cs).has(r);)r++;i=r;const o=JSON.parse(JSON.stringify(n));o.id=i;for(let s in R(de,Lr,"f",Dp))o.hasOwnProperty(s)||(o[s]=R(de,Lr,"f",Dp)[s]);return R(de,Lr,"f",Cs).set(i,o),o.id}static _getDrawingStyle(n,i){if("number"!=typeof n)throw new Error("Invalid style id.");const r=R(de,Lr,"f",Cs).get(n);return r?i?JSON.parse(JSON.stringify(r)):r:null}static getDrawingStyle(n){return this._getDrawingStyle(n,!0)}static getDrawingStyles(){return JSON.parse(JSON.stringify(Array.from(R(de,Lr,"f",Cs).values())))}static _updateDrawingStyle(n,i){if(!HI(i))throw new Error("Invalid style definition.");const r=R(de,Lr,"f",Cs).get(n);if(r)for(let o in i)r.hasOwnProperty(o)&&(r[o]=i[o])}static updateDrawingStyle(n,i){this._updateDrawingStyle(n,i)}}Lr=de,de.STYLE_BLUE_STROKE=1,de.STYLE_GREEN_STROKE=2,de.STYLE_ORANGE_STROKE=3,de.STYLE_YELLOW_STROKE=4,de.STYLE_BLUE_STROKE_FILL=5,de.STYLE_GREEN_STROKE_FILL=6,de.STYLE_ORANGE_STROKE_FILL=7,de.STYLE_YELLOW_STROKE_FILL=8,de.STYLE_BLUE_STROKE_TRANSPARENT=9,de.STYLE_GREEN_STROKE_TRANSPARENT=10,de.STYLE_ORANGE_STROKE_TRANSPARENT=11,de.USER_START_STYLE_ID=1024,Cs={value:new Map([[de.STYLE_BLUE_STROKE,{id:de.STYLE_BLUE_STROKE,lineWidth:4,fillStyle:"rgba(73, 173, 245, 0.3)",strokeStyle:"rgba(73, 173, 245, 1)",paintMode:"stroke",fontFamily:"consolas",fontSize:40}],[de.STYLE_GREEN_STROKE,{id:de.STYLE_GREEN_STROKE,lineWidth:2,fillStyle:"rgba(73, 245, 73, 0.3)",strokeStyle:"rgba(73, 245, 73, 0.9)",paintMode:"strokeAndFill",fontFamily:"consolas",fontSize:40}],[de.STYLE_ORANGE_STROKE,{id:de.STYLE_ORANGE_STROKE,lineWidth:2,fillStyle:"rgba(254, 180, 32, 0.3)",strokeStyle:"rgba(254, 180, 32, 0.9)",paintMode:"strokeAndFill",fontFamily:"consolas",fontSize:40}],[de.STYLE_YELLOW_STROKE,{id:de.STYLE_YELLOW_STROKE,lineWidth:2,fillStyle:"rgba(245, 236, 73, 0.3)",strokeStyle:"rgba(245, 236, 73, 1)",paintMode:"stroke",fontFamily:"consolas",fontSize:40}],[de.STYLE_BLUE_STROKE_FILL,{id:de.STYLE_BLUE_STROKE_FILL,lineWidth:4,fillStyle:"rgba(73, 173, 245, 0.3)",strokeStyle:"rgba(73, 173, 245, 1)",paintMode:"strokeAndFill",fontFamily:"consolas",fontSize:40}],[de.STYLE_GREEN_STROKE_FILL,{id:de.STYLE_GREEN_STROKE_FILL,lineWidth:2,fillStyle:"rgba(73, 245, 73, 0.3)",strokeStyle:"rgba(73, 245, 73, 0.9)",paintMode:"strokeAndFill",fontFamily:"consolas",fontSize:40}],[de.STYLE_ORANGE_STROKE_FILL,{id:de.STYLE_ORANGE_STROKE_FILL,lineWidth:2,fillStyle:"rgba(254, 180, 32, 0.3)",strokeStyle:"rgba(254, 180, 32, 1)",paintMode:"strokeAndFill",fontFamily:"consolas",fontSize:40}],[de.STYLE_YELLOW_STROKE_FILL,{id:de.STYLE_YELLOW_STROKE_FILL,lineWidth:2,fillStyle:"rgba(245, 236, 73, 0.3)",strokeStyle:"rgba(245, 236, 73, 1)",paintMode:"strokeAndFill",fontFamily:"consolas",fontSize:40}],[de.STYLE_BLUE_STROKE_TRANSPARENT,{id:de.STYLE_BLUE_STROKE_TRANSPARENT,lineWidth:4,fillStyle:"rgba(73, 245, 73, 0.2)",strokeStyle:"transparent",paintMode:"strokeAndFill",fontFamily:"consolas",fontSize:40}],[de.STYLE_GREEN_STROKE_TRANSPARENT,{id:de.STYLE_GREEN_STROKE_TRANSPARENT,lineWidth:2,fillStyle:"rgba(73, 245, 73, 0.2)",strokeStyle:"transparent",paintMode:"strokeAndFill",fontFamily:"consolas",fontSize:40}],[de.STYLE_ORANGE_STROKE_TRANSPARENT,{id:de.STYLE_ORANGE_STROKE_TRANSPARENT,lineWidth:2,fillStyle:"rgba(254, 180, 32, 0.2)",strokeStyle:"transparent",paintMode:"strokeAndFill",fontFamily:"consolas",fontSize:40}]])},Dp={value:{lineWidth:2,fillStyle:"rgba(245, 236, 73, 0.3)",strokeStyle:"rgba(245, 236, 73, 1)",paintMode:"stroke",fontFamily:"consolas",fontSize:40}},typeof document<"u"&&typeof window<"u"&&(Xe.StaticCanvas.prototype.dispose=function(){return this.isRendering&&(Xe.util.cancelAnimFrame(this.isRendering),this.isRendering=0),this.forEachObject(function(t){t.dispose&&t.dispose()}),this._objects=[],this.backgroundImage&&this.backgroundImage.dispose&&this.backgroundImage.dispose(),this.backgroundImage=null,this.overlayImage&&this.overlayImage.dispose&&this.overlayImage.dispose(),this.overlayImage=null,this._iTextInstances=null,this.contextContainer=null,this.lowerCanvasEl.classList.remove("lower-canvas"),delete this._originalCanvasStyle,this.lowerCanvasEl.setAttribute("width",this.width),this.lowerCanvasEl.setAttribute("height",this.height),Xe.util.cleanUpJsdomNode(this.lowerCanvasEl),this.lowerCanvasEl=void 0,this},Xe.Object.prototype.transparentCorners=!1,Xe.Object.prototype.cornerSize=20,Xe.Object.prototype.touchCornerSize=100,Xe.Object.prototype.cornerColor="rgb(254,142,20)",Xe.Object.prototype.cornerStyle="circle",Xe.Object.prototype.strokeUniform=!0,Xe.Object.prototype.hasBorders=!1,Xe.Canvas.prototype.containerClass="",Xe.Canvas.prototype.getPointer=function(t,n){if(this._absolutePointer&&!n)return this._absolutePointer;if(this._pointer&&n)return this._pointer;var i,r=this.upperCanvasEl,o=Xe.util.getPointer(t,r),s=r.getBoundingClientRect(),l=s.width||0,h=s.height||0;l&&h||("top"in s&&"bottom"in s&&(h=Math.abs(s.top-s.bottom)),"right"in s&&"left"in s&&(l=Math.abs(s.right-s.left))),this.calcOffset(),o.x=o.x-this._offset.left,o.y=o.y-this._offset.top,n||(o=this.restorePointerVpt(o));var p=this.getRetinaScaling();if(1!==p&&(o.x/=p,o.y/=p),0!==l&&0!==h){var C=window.getComputedStyle(r).objectFit,D=r.width,T=r.height;i={width:D/l,height:T/h};var k=D/T,U=l/h;return"contain"===C?k>U?{x:o.x*i.width,y:(o.y-(h-l/k)/2)*i.width}:{x:(o.x-(l-h*k)/2)*i.height,y:o.y*i.height}:"cover"===C?k>U?{x:(D-i.height*l)/2+o.x*i.height,y:o.y*i.height}:{x:o.x*i.width,y:(T-i.width*h)/2+o.y*i.width}:{x:o.x*i.width,y:o.y*i.height}}return{x:o.x*(i={width:1,height:1}).width,y:o.y*i.height}},Xe.Canvas.prototype._onTouchStart=function(t){var n=this.findTarget(t);!this.allowTouchScrolling&&t.cancelable&&t.preventDefault&&t.preventDefault(),n&&t.cancelable&&t.preventDefault&&t.preventDefault(),null===this.mainTouchId&&(this.mainTouchId=this.getPointerId(t)),this.__onMouseDown(t),this._resetTransformEventData();var i=this.upperCanvasEl,r=this._getEventPrefix();Xe.util.addListener(Xe.document,"touchend",this._onTouchEnd,{passive:!1}),Xe.util.addListener(Xe.document,"touchmove",this._onMouseMove,{passive:!1}),Xe.util.removeListener(i,r+"down",this._onMouseDown)},Xe.Textbox.prototype._wrapLine=function(t,n,i,r){const o=t.match(/[\u3040-\u30ff\u3400-\u4dbf\u4e00-\u9fff\uf900-\ufaff\uff66-\uff9f]/g);var l=0,h=this.splitByGrapheme||!(!o||!o.length),p=[],C=[],D=h?Xe.util.string.graphemeSplit(t):t.split(this._wordJoiners),T="",A=0,M=h?"":" ",P=0,B=0,k=0,U=!0,V=this._getWidthOfCharSpacing();r=r||0,0===D.length&&D.push([]),i-=r;for(var q=0;q<D.length;q++)T=h?D[q]:Xe.util.string.graphemeSplit(D[q]),P=this._measureWord(T,n,A),A+=T.length,(l+=B+P-V)>i&&!U?(p.push(C),C=[],l=P,U=!0):l+=V,U||h||C.push(M),C=C.concat(T),B=h?0:this._measureWord([M],n,A),A++,U=!1,P>k&&(k=P);return q&&p.push(C),k+r>this.dynamicMinWidth&&(this.dynamicMinWidth=k-V+r),p});class Tt{get width(){return this.fabricCanvas.width}get height(){return this.fabricCanvas.height}set _allowMultiSelect(n){this.fabricCanvas.selection=n,this.fabricCanvas.renderAll()}get _allowMultiSelect(){return this.fabricCanvas.selection}constructor(n,i,r){let o,s;switch(this.mapMediaType_Style=new Map,this.mapType_StateAndStyleId=new Map,this.mode="viewer",this.onSelectionChanged=null,this._arrDrwaingItem=[],this._arrFabricObject=[],this._visible=!0,n.hasOwnProperty("getFabricCanvas")?this.fabricCanvas=n.getFabricCanvas():(this.fabricCanvas=new Xe.Canvas(n,Object.assign(r,{allowTouchScrolling:!0,selection:!1})),this.fabricCanvas.setDimensions({width:"100%",height:"100%"},{cssOnly:!0}),this.fabricCanvas.lowerCanvasEl.className="",this.fabricCanvas.upperCanvasEl.className="",this.fabricCanvas.on("selection:created",function(l){const h=l.selected,p=[];for(let C of h){const D=C.getDrawingItem()._drawingLayer;D&&!p.includes(D)&&p.push(D)}for(let C of p){const D=[];for(let T of h){const A=T.getDrawingItem();A._drawingLayer===C&&D.push(A)}setTimeout(()=>{C.onSelectionChanged&&C.onSelectionChanged(D,[])},0)}}),this.fabricCanvas.on("before:selection:cleared",function(l){const h=this.getActiveObjects(),p=[];for(let C of h){const D=C.getDrawingItem()._drawingLayer;D&&!p.includes(D)&&p.push(D)}for(let C of p){const D=[];for(let T of h){const A=T.getDrawingItem();A._drawingLayer===C&&D.push(A)}setTimeout(()=>{const T=[];for(let A of D)C.hasDrawingItem(A)&&T.push(A);T.length>0&&C.onSelectionChanged&&C.onSelectionChanged([],T)},0)}}),this.fabricCanvas.on("selection:updated",function(l){const h=l.selected,p=l.deselected,C=[];for(let D of h){const T=D.getDrawingItem()._drawingLayer;T&&!C.includes(T)&&C.push(T)}for(let D of p){const T=D.getDrawingItem()._drawingLayer;T&&!C.includes(T)&&C.push(T)}for(let D of C){const T=[],A=[];for(let M of h){const P=M.getDrawingItem();P._drawingLayer===D&&T.push(P)}for(let M of p){const P=M.getDrawingItem();P._drawingLayer===D&&A.push(P)}setTimeout(()=>{D.onSelectionChanged&&D.onSelectionChanged(T,A)},0)}}),this.fabricCanvas.wrapperEl.style.position="absolute",n.getFabricCanvas=()=>this.fabricCanvas),this.id=i,i){case Tt.DDN_LAYER_ID:o=de.getDrawingStyle(de.STYLE_BLUE_STROKE),s=de.getDrawingStyle(de.STYLE_BLUE_STROKE_FILL);break;case Tt.DBR_LAYER_ID:o=de.getDrawingStyle(de.STYLE_ORANGE_STROKE),s=de.getDrawingStyle(de.STYLE_ORANGE_STROKE_FILL);break;case Tt.DLR_LAYER_ID:o=de.getDrawingStyle(de.STYLE_GREEN_STROKE),s=de.getDrawingStyle(de.STYLE_GREEN_STROKE_FILL);break;default:o=de.getDrawingStyle(de.STYLE_YELLOW_STROKE),s=de.getDrawingStyle(de.STYLE_YELLOW_STROKE_FILL)}for(let l of gn.arrMediaTypes)this.mapType_StateAndStyleId.set(l,{default:o.id,selected:s.id})}getId(){return this.id}setVisible(n){if(n){for(let i of this._arrFabricObject)i.visible=!0,i.hasControls=!0;this._visible=!0}else{for(let i of this._arrFabricObject)i.visible=!1,i.hasControls=!1;this._visible=!1}this.fabricCanvas.renderAll()}isVisible(){return this._visible}_getItemCurrentStyleId(n){return n.styleId?n.styleId:this.mapType_StateAndStyleId.get(n._mediaType)[n.styleSelector]}_getItemCurrentStyle(n){return n.styleId?de.getDrawingStyle(n.styleId):de.getDrawingStyle(n._mapState_StyleId.get(n.styleSelector))||null}_changeMediaTypeCurStyleInStyleSelector(n,i,r,o){const s=this.getDrawingItems(l=>l._mediaType===n);for(let l of s)l.styleSelector===i&&this._changeItemStyle(l,r,!0);o||this.fabricCanvas.renderAll()}_changeItemStyle(n,i,r){if(!n||!i)return;const o=n._getFabricObject();"number"==typeof n.styleId&&(i=de.getDrawingStyle(n.styleId)),o.strokeWidth=i.lineWidth,"fill"===i.paintMode?(o.fill=i.fillStyle,o.stroke=i.fillStyle):"stroke"===i.paintMode?(o.fill="transparent",o.stroke=i.strokeStyle):"strokeAndFill"===i.paintMode&&(o.fill=i.fillStyle,o.stroke=i.strokeStyle),o.fontFamily&&(o.fontFamily=i.fontFamily),o.fontSize&&(o.fontSize=i.fontSize),o.group||(o.dirty=!0),r||this.fabricCanvas.renderAll()}_updateGroupItem(n,i,r){if(!n||!i)return;const o=n.getChildDrawingItems();if("add"===r){if(o.includes(i))return;const s=i._getFabricObject();if(this.fabricCanvas.getObjects().includes(s)){if(!this._arrFabricObject.includes(s))throw new Error("Existed in other drawing layers.");i._zIndex=null}else{let l;if(i.styleId)l=de.getDrawingStyle(i.styleId);else{const h=this.mapType_StateAndStyleId.get(i._mediaType);l=de.getDrawingStyle(h[n.styleSelector]);const p=()=>{this._changeItemStyle(i,de.getDrawingStyle(this.mapType_StateAndStyleId.get(i._mediaType).selected),!0)},C=()=>{this._changeItemStyle(i,de.getDrawingStyle(this.mapType_StateAndStyleId.get(i._mediaType).default),!0)};i._on("selected",p),i._on("deselected",C),i._funcChangeStyleToSelected=p,i._funcChangeStyleToDefault=C}i._drawingLayer=this,i._drawingLayerId=this.id,this._changeItemStyle(i,l,!0)}n._fabricObject.addWithUpdate(i._getFabricObject())}else{if("remove"!==r||!o.includes(i))return;i._zIndex=null,i._drawingLayer=null,i._drawingLayerId=null,i._off("selected",i._funcChangeStyleToSelected),i._off("deselected",i._funcChangeStyleToDefault),i._funcChangeStyleToSelected=null,i._funcChangeStyleToDefault=null,n._fabricObject.removeWithUpdate(i._getFabricObject())}this.fabricCanvas.renderAll()}_addDrawingItem(n,i){if(!(n instanceof gn))throw new TypeError("Invalid 'drawingItem'.");if(n._drawingLayer){if(n._drawingLayer==this)return;throw new Error("This drawing item has existed in other layer.")}let r=n._getFabricObject();const o=this.fabricCanvas.getObjects();let s,l;if(o.includes(r)){if(this._arrFabricObject.includes(r))return;throw new Error("Existed in other drawing layers.")}if("group"===n._mediaType){s=n.getChildDrawingItems();for(let C of s)if(C._drawingLayer&&C._drawingLayer!==this)throw new Error("The childItems of DT_Group have existed in other drawing layers.")}if(i&&"object"==typeof i&&!Array.isArray(i))for(let C in i)r.set(C,i[C]);if(s){for(let C of s){const D=this.mapType_StateAndStyleId.get(C._mediaType);for(let T of gn.arrStyleSelectors)C._mapState_StyleId.set(T,D[T]);if(C.styleId)l=de.getDrawingStyle(C.styleId);else{l=de.getDrawingStyle(D.default);const T=()=>{this._changeItemStyle(C,de.getDrawingStyle(this.mapType_StateAndStyleId.get(C._mediaType).selected),!0)},A=()=>{this._changeItemStyle(C,de.getDrawingStyle(this.mapType_StateAndStyleId.get(C._mediaType).default),!0)};C._on("selected",T),C._on("deselected",A),C._funcChangeStyleToSelected=T,C._funcChangeStyleToDefault=A}C._drawingLayer=this,C._drawingLayerId=this.id,this._changeItemStyle(C,l,!0)}r.dirty=!0,this.fabricCanvas.renderAll()}else{const C=this.mapType_StateAndStyleId.get(n._mediaType);for(let D of gn.arrStyleSelectors)n._mapState_StyleId.set(D,C[D]);if(n.styleId)l=de.getDrawingStyle(n.styleId);else{l=de.getDrawingStyle(C.default);const D=()=>{this._changeItemStyle(n,de.getDrawingStyle(this.mapType_StateAndStyleId.get(n._mediaType).selected))},T=()=>{this._changeItemStyle(n,de.getDrawingStyle(this.mapType_StateAndStyleId.get(n._mediaType).default))};n._on("selected",D),n._on("deselected",T),n._funcChangeStyleToSelected=D,n._funcChangeStyleToDefault=T}this._changeItemStyle(n,l)}n._zIndex=this.id,n._drawingLayer=this,n._drawingLayerId=this.id;const h=this._arrFabricObject.length;let p=o.length;if(h)p=o.indexOf(this._arrFabricObject[h-1])+1;else for(let C=0;C<o.length;C++)if(n._zIndex<o[C].getDrawingItem()._zIndex){p=C;break}this._arrDrwaingItem.push(n),this._arrFabricObject.push(r),r.visible=!!this._visible,this.fabricCanvas.insertAt(r,p,!1)}addDrawingItem(n){if(!n||!n.isDrawingItem)throw TypeError("Illegal drawing item.");if("viewer"===this.mode)n._setEditable(!1);else{if("editor"!==this.mode)throw new Error("Illegal 'mode'.");n._setEditable(!0)}this._addDrawingItem(n),n.updatePosition()}addDrawingItems(n){for(let i of n)this.addDrawingItem(i)}removeDrawingItem(n){if(!n||!n.isDrawingItem)throw TypeError("Illegal drawing item.");if(!this.hasDrawingItem(n))return;if(n._zIndex=null,n._drawingLayer=null,n._drawingLayerId=null,"group"===n._mediaType){const r=n.getChildDrawingItems();for(let o of r)o._zIndex=null,o._drawingLayer=null,o._drawingLayerId=null,o._off("selected",o._funcChangeStyleToSelected),o._off("deselected",o._funcChangeStyleToDefault),o._funcChangeStyleToSelected=null,o._funcChangeStyleToDefault=null,o._mapState_StyleId.clear()}else n._off("selected",n._funcChangeStyleToSelected),n._off("deselected",n._funcChangeStyleToDefault),n._funcChangeStyleToSelected=null,n._funcChangeStyleToDefault=null,n._mapState_StyleId.clear();const i=n._getFabricObject();"selected"===n.styleSelector&&(i.group?i.group.removeWithUpdate(i):this.fabricCanvas._activeObject=null,n.setState(Ln.DIS_DEFAULT)),this.fabricCanvas.remove(i),this._arrDrwaingItem.splice(this._arrDrwaingItem.indexOf(n),1),this._arrFabricObject.splice(this._arrFabricObject.indexOf(i),1)}removeDrawingItems(n){for(let i of n)this.removeDrawingItem(i)}setDrawingItems(n){this.clearDrawingItems(),this.addDrawingItems(n)}getDrawingItems(n){return n&&"function"==typeof n?this._arrDrwaingItem.filter(n):Array.from(this._arrDrwaingItem)}getSelectedDrawingItems(){const n=this.fabricCanvas.getActiveObjects(),i=[];for(let r of n)this._arrFabricObject.includes(r)&&i.push(r.getDrawingItem());return i}hasDrawingItem(n){if(!n||!n.isDrawingItem)throw TypeError("Illegal drawing item.");return this._arrDrwaingItem.includes(n)}clearDrawingItems(){this.removeDrawingItems(Array.from(this._arrDrwaingItem))}_setDefaultStyle(n,i,r){i?i.forEach(l=>l.toLowerCase()):i=gn.arrMediaTypes,r?r.forEach(l=>l.toLowerCase()):r=gn.arrStyleSelectors;const o=de.getDrawingStyle(n);if(!o)throw new Error(`The 'drawingStyle' with id '${n}' doesn't exist.`);let s;for(let l of i)if(s=this.mapType_StateAndStyleId.get(l),s)for(let h of r){this._changeMediaTypeCurStyleInStyleSelector(l,h,o,!0),s[h]=n;for(let p of this._arrDrwaingItem)p._mediaType===l&&p._mapState_StyleId.set(h,n)}this.fabricCanvas.renderAll()}setDefaultStyle(n,i,r){const o=[];r&Jt.DIMT_RECTANGLE&&o.push("rect"),r&Jt.DIMT_QUADRILATERAL&&o.push("quad"),r&Jt.DIMT_TEXT&&o.push("text"),r&Jt.DIMT_ARC&&o.push("arc"),r&Jt.DIMT_IMAGE&&o.push("image"),r&Jt.DIMT_POLYGON&&o.push("polygon"),r&Jt.DIMT_LINE&&o.push("line");const s=[];i&Ln.DIS_DEFAULT&&s.push("default"),i&Ln.DIS_SELECTED&&s.push("selected"),this._setDefaultStyle(n,o.length?o:null,s.length?s:null)}setMode(n){if("viewer"===(n=n.toLowerCase())){for(let i of this._arrDrwaingItem)i._setEditable(!1);this.fabricCanvas.discardActiveObject(),this.fabricCanvas.renderAll(),this.mode="viewer"}else{if("editor"!==n)throw new RangeError("Invalid value.");for(let i of this._arrDrwaingItem)i._setEditable(!0);this.mode="editor"}this._manager._switchPointerEvent()}getMode(){return this.mode}_setDimensions(n,i){this.fabricCanvas.setDimensions(n,i)}_setObjectFit(n){if(n=n.toLowerCase(),!["contain","cover"].includes(n))throw new Error(`Unsupported value '${n}'.`);this.fabricCanvas.lowerCanvasEl.style.objectFit=n,this.fabricCanvas.upperCanvasEl.style.objectFit=n}_getObjectFit(){return this.fabricCanvas.lowerCanvasEl.style.objectFit}renderAll(){for(let n of this._arrDrwaingItem){const i=this._getItemCurrentStyle(n);this._changeItemStyle(n,i,!0)}this.fabricCanvas.renderAll()}dispose(){this.clearDrawingItems(),1===this._manager._arrDrawingLayer.length&&(this.fabricCanvas.wrapperEl.style.pointerEvents="none",this.fabricCanvas.dispose(),this._arrDrwaingItem.length=0,this._arrFabricObject.length=0)}}Tt.DDN_LAYER_ID=1,Tt.DBR_LAYER_ID=2,Tt.DLR_LAYER_ID=3,Tt.USER_DEFINED_LAYER_BASE_ID=100,Tt.TIP_LAYER_ID=999;class Ok{constructor(){this._arrDrawingLayer=[]}createDrawingLayer(n,i){if(this.getDrawingLayer(i))throw new Error("Existed drawing layer id.");const r=new Tt(n,i,{enableRetinaScaling:!1});return r._manager=this,this._arrDrawingLayer.push(r),this._switchPointerEvent(),r}deleteDrawingLayer(n){const i=this.getDrawingLayer(n);if(!i)return;const r=this._arrDrawingLayer;i.dispose(),r.splice(r.indexOf(i),1),this._switchPointerEvent()}clearDrawingLayers(){for(let n of this._arrDrawingLayer)n.dispose();this._arrDrawingLayer.length=0}getDrawingLayer(n){for(let i of this._arrDrawingLayer)if(i.getId()===n)return i;return null}getAllDrawingLayers(){return Array.from(this._arrDrawingLayer)}getSelectedDrawingItems(){if(!this._arrDrawingLayer.length)return;const n=this._arrDrawingLayer[0].fabricCanvas.getActiveObjects(),i=[];for(let r of n)i.push(r.getDrawingItem());return i}setDimensions(n,i){this._arrDrawingLayer.length&&this._arrDrawingLayer[0]._setDimensions(n,i)}setObjectFit(n){for(let i of this._arrDrawingLayer)i&&i._setObjectFit(n)}getObjectFit(){return this._arrDrawingLayer.length?this._arrDrawingLayer[0]._getObjectFit():null}setVisible(n){this._arrDrawingLayer.length&&(this._arrDrawingLayer[0].fabricCanvas.wrapperEl.style.display=n?"block":"none")}_switchPointerEvent(){if(this._arrDrawingLayer.length)for(let n of this._arrDrawingLayer)n.getMode()}}class Mk extends $I{constructor(n,i,r,o,s){super(n,{x:i,y:r,width:o,height:0},s),Es.set(this,void 0),il.set(this,void 0),this._fabricObject.paddingTop=15,this._fabricObject.calcTextHeight=function(){for(var l=0,h=0,p=this._textLines.length;h<p;h++)l+=this.getHeightOfLine(h);return l+2*this.paddingTop},this._fabricObject._getTopOffset=function(){return-this.height/2+this.getHeightOfLine(0)*(1-1/this.lineHeight)/2+this.paddingTop},this.set("backgroundColor","rgba(50, 50, 52, .8)"),this.set("lineHeight",1.3),this.set("textAlign","center")}setDuration(n){Te(this,Es,n,"f"),R(this,il,"f")&&clearTimeout(R(this,il,"f")),R(this,Es,"f")>=0&&Te(this,il,setTimeout(()=>{this.set("visible",!1),this._drawingLayer&&this._drawingLayer.renderAll()},R(this,Es,"f")),"f")}getDuration(){return R(this,Es,"f")}}Es=new WeakMap,il=new WeakMap;class Rk{constructor(){Is.add(this),Fn.set(this,void 0),rl.set(this,void 0),ol.set(this,void 0),sl.set(this,!0),this._drawingLayersManager=new Ok}createDrawingLayerBaseCvs(n,i,r="contain"){if("number"!=typeof n||n<=1)throw new Error("Invalid 'width'.");if("number"!=typeof i||i<=1)throw new Error("Invalid 'height'.");if(!["contain","cover"].includes(r))throw new Error("Unsupported 'objectFit'.");const o=document.createElement("canvas");return o.width==n&&o.height==i||(o.width=n,o.height=i),o.style.objectFit=r,o}_createDrawingLayer(n,i,r,o){if(!this._layerBaseCvs){let h;try{h=this.getContentDimensions()}catch(p){if("Invalid content dimensions."!==(p.message||p))throw p}i||(i=h?.width||1280),r||(r=h?.height||720),o||(o=h?.objectFit||"contain"),this._layerBaseCvs=this.createDrawingLayerBaseCvs(i,r,o)}const s=this._layerBaseCvs,l=this._drawingLayersManager.createDrawingLayer(s,n);return this._innerComponent.getElement("drawing-layer")||this._innerComponent.setElement("drawing-layer",s.parentElement),l}createDrawingLayer(){let n;for(let i=Tt.USER_DEFINED_LAYER_BASE_ID;;i++)if(!this._drawingLayersManager.getDrawingLayer(i)&&i!==Tt.TIP_LAYER_ID){n=i;break}return this._createDrawingLayer(n)}deleteDrawingLayer(n){var i;this._drawingLayersManager.deleteDrawingLayer(n),this._drawingLayersManager.getAllDrawingLayers().length||(null===(i=this._innerComponent)||void 0===i||i.removeElement("drawing-layer"),this._layerBaseCvs=null)}deleteUserDefinedDrawingLayer(n){if("number"!=typeof n)throw new TypeError("Invalid id.");if(n<Tt.USER_DEFINED_LAYER_BASE_ID)throw new Error(`The drawing layer with id ${n} is not defined by users.`);this.deleteDrawingLayer(n)}_clearDrawingLayers(){const n=this.getAllDrawingLayers();for(let i of n)this.deleteDrawingLayer(i.getId())}clearUserDefinedDrawingLayers(){const n=this.getAllDrawingLayers();for(let i of n){const r=i.getId();r<Tt.USER_DEFINED_LAYER_BASE_ID||this.deleteUserDefinedDrawingLayer(r)}}getDrawingLayer(n){return n==Tt.TIP_LAYER_ID?null:this._drawingLayersManager.getDrawingLayer(n)||([Tt.DDN_LAYER_ID,Tt.DBR_LAYER_ID,Tt.DLR_LAYER_ID].includes(n)?this._createDrawingLayer(n):null)}getAllDrawingLayers(){return this._drawingLayersManager.getAllDrawingLayers().filter(n=>n.getId()>=0&&n.getId()!==Tt.TIP_LAYER_ID)}updateDrawingLayers(n){((i,r,o)=>{if(!(i<=1||r<=1)){if(!["contain","cover"].includes(o))throw new Error("Unsupported 'objectFit'.");this._drawingLayersManager.setDimensions({width:i,height:r},{backstoreOnly:!0}),this._drawingLayersManager.setObjectFit(o)}})(n.width,n.height,n.objectFit)}getSelectedDrawingItems(){return this._drawingLayersManager.getSelectedDrawingItems()}setTipConfig(n){if(!(jI(i=n)&&Tk(i.topLeftPoint)&&ys(i.width))||i.width<=0||!ys(i.duration)||"coordinateBase"in i&&!["view","image"].includes(i.coordinateBase))throw new Error("Invalid tip config.");var i;Te(this,Fn,JSON.parse(JSON.stringify(n)),"f"),R(this,Fn,"f").coordinateBase||(R(this,Fn,"f").coordinateBase="view"),Te(this,ol,n.duration,"f"),R(this,Is,"m",KI).call(this)}getTipConfig(){return R(this,Fn,"f")?R(this,Fn,"f"):null}setTipVisible(n){if("boolean"!=typeof n)throw new TypeError("Invalid value.");this._tip&&(this._tip.set("visible",n),this._drawingLayerOfTip&&this._drawingLayerOfTip.renderAll()),Te(this,sl,n,"f")}isTipVisible(){return R(this,sl,"f")}updateTipMessage(n){if(!R(this,Fn,"f"))throw new Error("Tip config is not set.");this._tipStyleId||(this._tipStyleId=de.createDrawingStyle({fillStyle:"#FFFFFF",paintMode:"fill",fontFamily:"Open Sans",fontSize:40})),this._drawingLayerOfTip||(this._drawingLayerOfTip=this._drawingLayersManager.getDrawingLayer(Tt.TIP_LAYER_ID)||this._createDrawingLayer(Tt.TIP_LAYER_ID)),this._tip?this._tip.set("text",n):this._tip=R(this,Is,"m",XI).call(this,n,R(this,Fn,"f").topLeftPoint.x,R(this,Fn,"f").topLeftPoint.y,R(this,Fn,"f").width,R(this,Fn,"f").coordinateBase,this._tipStyleId),R(this,Is,"m",qI).call(this,this._tip,this._drawingLayerOfTip),this._tip.set("visible",R(this,sl,"f")),this._drawingLayerOfTip&&this._drawingLayerOfTip.renderAll(),R(this,rl,"f")&&clearTimeout(R(this,rl,"f")),R(this,ol,"f")>=0&&Te(this,rl,setTimeout(()=>{R(this,Is,"m",ZI).call(this)},R(this,ol,"f")),"f")}}Fn=new WeakMap,rl=new WeakMap,ol=new WeakMap,sl=new WeakMap,Is=new WeakSet,XI=function(t,n,i,r,o,s){const l=new Mk(t,n,i,r,s);return l.coordinateBase=o,l},qI=function(t,n){n.hasDrawingItem(t)||n.addDrawingItems([t])},ZI=function(){this._tip&&this._drawingLayerOfTip.removeDrawingItems([this._tip])},KI=function(){if(!this._tip)return;const t=R(this,Fn,"f");this._tip.coordinateBase=t.coordinateBase,this._tip.setTextRect({x:t.topLeftPoint.x,y:t.topLeftPoint.y,width:t.width,height:0}),this._tip.set("width",this._tip.get("width")),this._tip._drawingLayer&&this._tip._drawingLayer.renderAll()};class Op extends HTMLElement{constructor(){super(),Bu.set(this,void 0);const n=document.createElement("template").content,i=document.createElement("div");i.setAttribute("class","wrapper"),n.appendChild(i),Te(this,Bu,i,"f");const r=document.createElement("slot");r.setAttribute("name","single-frame-input-container"),i.append(r);const o=document.createElement("slot");o.setAttribute("name","content"),i.append(o);const s=document.createElement("slot");s.setAttribute("name","drawing-layer"),i.append(s);const l=document.createElement("style");l.textContent='\n.wrapper {\n  position: relative;\n  width: 100%;\n  height: 100%;\n}\n::slotted(canvas[slot="content"]) {\n  object-fit: contain;\n  pointer-events: none;\n}\n::slotted(div[slot="single-frame-input-container"]) {\n  width: 1px;\n  height: 1px;\n  overflow: hidden;\n  pointer-events: none;\n}\n::slotted(*) {\n  position: absolute;\n  left: 0;\n  top: 0;\n  width: 100%;\n  height: 100%;\n}\n    ',n.appendChild(l),this.attachShadow({mode:"open"}).appendChild(n.cloneNode(!0))}getWrapper(){return R(this,Bu,"f")}setElement(n,i){if(!(i instanceof HTMLElement))throw new TypeError("Invalid 'el'.");if(!["content","single-frame-input-container","drawing-layer"].includes(n))throw new TypeError("Invalid 'slot'.");this.removeElement(n),i.setAttribute("slot",n),this.appendChild(i)}getElement(n){if(!["content","single-frame-input-container","drawing-layer"].includes(n))throw new TypeError("Invalid 'slot'.");return this.querySelector(`[slot="${n}"]`)}removeElement(n){var i;if(!["content","single-frame-input-container","drawing-layer"].includes(n))throw new TypeError("Invalid 'slot'.");null===(i=this.querySelectorAll(`[slot="${n}"]`))||void 0===i||i.forEach(r=>r.remove())}}Bu=new WeakMap,customElements.get("dce-component")||customElements.define("dce-component",Op);class bs extends HTMLElement{constructor(){super();const n=window._dce_default_template.content;this.attachShadow({mode:"open"}).appendChild(n.cloneNode(!0))}showScanLaser(){const n=this.shadowRoot.querySelector(".dce-scanlight");n&&(n.style.display="")}hideScanLaser(){const n=this.shadowRoot.querySelector(".dce-scanlight");n&&(n.style.display="none")}getElement(n){return this.shadowRoot.querySelector(n)}getVideoContainer(){return this.shadowRoot.querySelector(".dce-video-container")}getScanAreaEl(){return this.shadowRoot.querySelector(".dce-scanarea")}getScanLightEl(){return this.shadowRoot.querySelector(".dce-scanlight")}getLoadingBackgroundEl(){return this.shadowRoot.querySelector(".dce-bg-loading")}getCameraBackgroundEl(){return this.shadowRoot.querySelector(".dce-bg-camera")}getCameraSelectEl(){return this.shadowRoot.querySelector(".dce-sel-camera")}getResolutionSelectEl(){return this.shadowRoot.querySelector(".dce-sel-resolution")}getResolutionOptionEl(){return this.shadowRoot.querySelector(".dce-opt-gotResolution")}getCloseBtnEl(){return this.shadowRoot.querySelector(".dce-btn-close")}getDLRSelectEl(){return this.shadowRoot.querySelector(".dlr-sel-minletter")}getDLROptionEl(){return this.shadowRoot.querySelector(".dlr-opt-gotMinLtr")}}class Ut extends Rk{static get engineResourcePath(){return Xt.engineResourcePaths.dce}static set defaultUIElementURL(n){Ut._defaultUIElementURL=n}static get defaultUIElementURL(){var n;return null===(n=Ut._defaultUIElementURL)||void 0===n?void 0:n.replace("@engineResourcePath/",Ut.engineResourcePath)}static createInstance(n){return J(function*(){customElements.get(Ut.uiComponentName)||customElements.define(Ut.uiComponentName,bs);const i=new Ut;return yield i.setUIElement(n||Ut.defaultUIElementURL),i})()}static _transformCoordinates(n,i,r,o,s,l,h){const C=h/s;n.x=Math.round(n.x/(l/o)+i),n.y=Math.round(n.y/C+r)}set _singleFrameMode(n){if(!["disabled","image","camera"].includes(n))throw new Error("Invalid value.");n!==R(this,ul,"f")&&(this._unbindUI(),Te(this,ul,n,"f"),this._bindUI())}get _singleFrameMode(){return R(this,ul,"f")}get disposed(){return R(this,bp,"f")}constructor(){var n;super(),n=this,wt.add(this),al.set(this,void 0),ll.set(this,void 0),cl.set(this,void 0),this.containerClassName="dce-video-container",en.set(this,void 0),this.videoFit="contain",this._hideDefaultSelection=!1,this._divScanArea=null,this._divScanLight=null,this._bgLoading=null,this._selCam=null,this._bgCamera=null,this._selRsl=null,this._optGotRsl=null,this._btnClose=null,this._selMinLtr=null,this._optGotMinLtr=null,ju.set(this,null),this.regionMaskFillStyle="rgba(0,0,0,0.5)",this.regionMaskStrokeStyle="rgb(254,142,20)",this.regionMaskLineWidth=6,Vu.set(this,!1),Uu.set(this,!1),Fr.set(this,{width:0,height:0}),this._updateLayersTimeout=500,this._videoResizeListener=()=>{R(this,wt,"m",hl).call(this),this._updateLayersTimeoutId&&clearTimeout(this._updateLayersTimeoutId),this._updateLayersTimeoutId=setTimeout(()=>{this.disposed||(this.eventHandler.fire("videoEl:resized",null,{async:!1}),this.eventHandler.fire("content:updated",null,{async:!1}),this.isScanLaserVisible()&&R(this,wt,"m",Tp).call(this))},this._updateLayersTimeout)},this._windowResizeListener=()=>{Ut._onLog&&Ut._onLog("window resize event triggered."),R(this,Fr,"f").width===document.documentElement.clientWidth&&R(this,Fr,"f").height===document.documentElement.clientHeight||(R(this,Fr,"f").width=document.documentElement.clientWidth,R(this,Fr,"f").height=document.documentElement.clientHeight,this._videoResizeListener())},ul.set(this,"disabled"),this._clickIptSingleFrameMode=()=>{if(!R(this,wt,"m",li).call(this))return;let i;if(this._singleFrameInputContainer)i=this._singleFrameInputContainer.firstElementChild;else{i=document.createElement("input"),i.setAttribute("type","file"),"camera"===this._singleFrameMode?(i.setAttribute("capture",""),i.setAttribute("accept","image/*")):"image"===this._singleFrameMode&&(i.removeAttribute("capture"),i.setAttribute("accept",".jpg,.jpeg,.icon,.gif,.svg,.webp,.png,.bmp")),i.addEventListener("change",J(function*(){const o=i.files[0];i.value="";{const s=function(){var M=J(function*(P){let B=null,k=null;if(typeof createImageBitmap<"u")try{if(B=yield createImageBitmap(P),B)return B}catch{}var U;return B||(k=yield(U=P,new Promise((V,q)=>{let ce=URL.createObjectURL(U),ge=new Image;ge.src=ce,ge.onload=()=>{URL.revokeObjectURL(ge.src),V(ge)},ge.onerror=ve=>{q(new Error("Can't convert blob to image : "+(ve instanceof Event?ve.type:ve)))}}))),k});return function(B){return M.apply(this,arguments)}}(),l=(M,P,B,k)=>{M.width==B&&M.height==k||(M.width=B,M.height=k);const U=M.getContext("2d");U.clearRect(0,0,M.width,M.height),U.drawImage(P,0,0)},h=yield s(o),p=h instanceof HTMLImageElement?h.naturalWidth:h.width,C=h instanceof HTMLImageElement?h.naturalHeight:h.height;let D=n._cvsSingleFrameMode;const T=D?.width,A=D?.height;D||(D=document.createElement("canvas"),n._cvsSingleFrameMode=D),l(D,h,p,C),n._innerComponent.setElement("content",D),T===D.width&&A===D.height||n.eventHandler.fire("content:updated",null,{async:!1})}n._onSingleFrameAcquired&&setTimeout(()=>{n._onSingleFrameAcquired(n._cvsSingleFrameMode)},0)})),i.style.position="absolute",i.style.top="-9999px",i.style.backgroundColor="transparent",i.style.color="transparent";const r=document.createElement("div");r.append(i),this._innerComponent.setElement("single-frame-input-container",r),this._singleFrameInputContainer=r}i?.click()},this.extraBindings=[],dl.set(this,[]),this._capturedResultReceiver={onCapturedResultReceived:(i,r)=>{var o,s,l,h;if(this.disposed||(this.clearAllInnerDrawingItems(),!i))return;const p=i.originalImageTag;if(!p)return;const C=i.items;if(!C?.length)return;const D=(null===(o=p.cropRegion)||void 0===o?void 0:o.left)||0,T=(null===(s=p.cropRegion)||void 0===s?void 0:s.top)||0,A=null!==(l=p.cropRegion)&&void 0!==l&&l.right?p.cropRegion.right-D:p.originalWidth,M=null!==(h=p.cropRegion)&&void 0!==h&&h.bottom?p.cropRegion.bottom-T:p.originalHeight,P=p.currentWidth,B=p.currentHeight,k=(q,ce,ge,ve,me,S,we,Me,nt=[],m)=>{ce.forEach(g=>Ut._transformCoordinates(g,ge,ve,me,S,we,Me));const f=new JI({points:[{x:ce[0].x,y:ce[0].y},{x:ce[1].x,y:ce[1].y},{x:ce[2].x,y:ce[2].y},{x:ce[3].x,y:ce[3].y}]},m);for(let g of nt)f.addNote(g);q.addDrawingItems([f]),R(this,dl,"f").push(f)};let U,V;for(let q of C)switch(q.type){case Re.CRIT_ORIGINAL_IMAGE:break;case Re.CRIT_BARCODE:U=this.getDrawingLayer(Tt.DBR_LAYER_ID),V=[{name:"format",content:q.formatString},{name:"text",content:q.text}],r?.isBarcodeVerifyOpen?q.verified?k(U,q.location.points,D,T,A,M,P,B,V):k(U,q.location.points,D,T,A,M,P,B,V,de.STYLE_ORANGE_STROKE_TRANSPARENT):k(U,q.location.points,D,T,A,M,P,B,V);break;case Re.CRIT_TEXT_LINE:U=this.getDrawingLayer(Tt.DLR_LAYER_ID),V=[{name:"text",content:q.text}],r.isLabelVerifyOpen?q.verified?k(U,q.location.points,D,T,A,M,P,B,V):k(U,q.location.points,D,T,A,M,P,B,V,de.STYLE_GREEN_STROKE_TRANSPARENT):k(U,q.location.points,D,T,A,M,P,B,V);break;case Re.CRIT_DETECTED_QUAD:U=this.getDrawingLayer(Tt.DDN_LAYER_ID),r?.isDetectVerifyOpen?q.verified?k(U,q.location.points,D,T,A,M,P,B,[]):k(U,q.location.points,D,T,A,M,P,B,[],de.STYLE_BLUE_STROKE_TRANSPARENT):k(U,q.location.points,D,T,A,M,P,B,[]);break;case Re.CRIT_NORMALIZED_IMAGE:U=this.getDrawingLayer(Tt.DDN_LAYER_ID),r?.isNormalizeVerifyOpen?q.verified?k(U,q.location.points,D,T,A,M,P,B,[]):k(U,q.location.points,D,T,A,M,P,B,[],de.STYLE_BLUE_STROKE_TRANSPARENT):k(U,q.location.points,D,T,A,M,P,B,[]);break;case Re.CRIT_PARSED_RESULT:break;default:throw new Error("Illegal item type.")}}},bp.set(this,!1),this.eventHandler=new WI,this.eventHandler.on("content:updated",()=>{R(this,al,"f")&&clearTimeout(R(this,al,"f")),Te(this,al,setTimeout(()=>{if(this.disposed)return;let i;this._updateVideoContainer();try{i=this.getContentDimensions()}catch(r){if("Invalid content dimensions."===(r.message||r))return;throw r}this.updateDrawingLayers(i),this.updateConvertedRegion(i)},0),"f")}),this.eventHandler.on("videoEl:resized",()=>{R(this,ll,"f")&&clearTimeout(R(this,ll,"f")),Te(this,ll,setTimeout(()=>{this.disposed||this._updateVideoContainer()},0),"f")})}_setUIElement(n){n instanceof HTMLTemplateElement?(window._dce_default_template=n,this.UIElement=new bs):this.UIElement=n,this._unbindUI(),this._bindUI()}setUIElement(n){var i=this;return J(function*(){let r;if(r="string"==typeof n?yield wp(n):n,r instanceof HTMLDivElement&&0==r.childElementCount){const o=yield wp(Ut.defaultUIElementURL);o instanceof HTMLTemplateElement?(window._dce_default_template=o,r.append(new bs)):r.append(o),i._setUIElement(r)}else i._setUIElement(r)})()}getUIElement(){return this.UIElement}_bindUI(){var n;if(!this.UIElement)throw new Error("Need to set 'UIElement'.");if(this._innerComponent)return;let i,r=this.UIElement;if(r instanceof bs?i=r.getElement(`.${this.containerClassName}`):r instanceof HTMLDivElement&&1===r.childElementCount&&r.firstElementChild instanceof bs?(i=r.firstElementChild.getElement(`.${this.containerClassName}`),r=r.firstElementChild):i=r.classList.contains(this.containerClassName)?r:r.querySelector(`.${this.containerClassName}`),!i)throw Error(`Can not find the element with class '${this.containerClassName}'.`);if(this._innerComponent=new Op,i.appendChild(this._innerComponent),!R(this,wt,"m",li).call(this)){const o=document.createElement("video");o.style.position="absolute",o.style.left="0",o.style.top="0",o.style.width="100%",o.style.height="100%",o.style.objectFit=this.getVideoFit(),o.setAttribute("autoplay","true"),o.setAttribute("playsinline","true"),o.setAttribute("muted","true"),["iPhone","iPad","Mac"].includes(on.OS)&&o.setAttribute("poster","data:image/gif;base64,R0lGODlhAQABAIEAAAAAAAAAAAAAAAAAACH5BAEAAAAALAAAAAABAAEAAAgEAAEEBAA7"),Te(this,en,o,"f");const s=document.createElement("div");s.append(o),s.style.overflow="hidden",this._videoContainer=s,this._innerComponent.setElement("content",s)}if(r instanceof bs?(this._selRsl=r.getElement(".dce-sel-resolution"),this._selMinLtr=r.getElement(".dlr-sel-minletter"),this._divScanArea=r.getElement(".dce-scanarea"),this._divScanLight=r.getElement(".dce-scanlight"),this._bgLoading=r.getElement(".dce-bg-loading"),this._bgCamera=r.getElement(".dce-bg-camera"),this._selCam=r.getElement(".dce-sel-camera"),this._optGotRsl=r.getElement(".dce-opt-gotResolution"),this._btnClose=r.getElement(".dce-btn-close"),this._optGotMinLtr=r.getElement(".dlr-opt-gotMinLtr")):(this._selRsl=r.querySelector(".dce-sel-resolution"),this._selMinLtr=r.querySelector(".dlr-sel-minletter"),this._divScanArea=r.querySelector(".dce-scanarea"),this._divScanLight=r.querySelector(".dce-scanlight"),this._bgLoading=r.querySelector(".dce-bg-loading"),this._bgCamera=r.querySelector(".dce-bg-camera"),this._selCam=r.querySelector(".dce-sel-camera"),this._optGotRsl=r.querySelector(".dce-opt-gotResolution"),this._btnClose=r.querySelector(".dce-btn-close"),this._optGotMinLtr=r.querySelector(".dlr-opt-gotMinLtr")),this._selRsl&&(this._hideDefaultSelection||R(this,wt,"m",li).call(this)||this._selRsl.options.length||(this._selRsl.innerHTML=['<option class="dce-opt-gotResolution" value="got"></option>','<option data-width="1920" data-height="1080">ask 1920x1080</option>','<option data-width="1280" data-height="720">ask 1280x720</option>','<option data-width="640" data-height="480">ask 640x480</option>'].join(""),this._optGotRsl=this._selRsl.options[0])),this._selMinLtr&&(this._hideDefaultSelection||R(this,wt,"m",li).call(this)||this._selMinLtr.options.length||(this._selMinLtr.innerHTML=['<option class="dlr-opt-gotMinLtr" value="got"></option>','<option value="0" selected>any letter</option>','<option value="3">3+ letters</option>','<option value="5">5+ letters</option>','<option value="8">8+ letters</option>','<option value="12">12+ letters</option>','<option value="17">17+ letters</option>','<option value="30">30+ letters</option>','<option value="50">50+ letters</option>','<option value="80">80+ letters</option>','<option value="120">120+ letters</option>'].join(""),this._optGotMinLtr=this._selMinLtr.options[0])),this.isScanLaserVisible()||R(this,wt,"m",hl).call(this),R(this,wt,"m",li).call(this)||this._hideDefaultSelection?(R(this,wt,"m",li).call(this)&&(this._innerComponent&&(this._innerComponent.addEventListener("click",this._clickIptSingleFrameMode),this._innerComponent.setAttribute("title","Take a photo")),this._bgCamera&&(this._bgCamera.style.display="block")),this._selCam&&(this._selCam.style.display="none"),this._selRsl&&(this._selRsl.style.display="none"),this._selMinLtr&&(this._selMinLtr.style.display="none")):(this._selCam&&(this._selCam.style.display="block"),this._selRsl&&(this._selRsl.style.display="block"),this._selMinLtr&&(this._selMinLtr.style.display="block"),this._stopLoading()),window.ResizeObserver){this._resizeObserver||(this._resizeObserver=new ResizeObserver(s=>{var l;Ut._onLog&&Ut._onLog("resize observer triggered.");for(let h of s)h.target===(null===(l=this._innerComponent)||void 0===l?void 0:l.getWrapper())&&this._videoResizeListener()}));const o=null===(n=this._innerComponent)||void 0===n?void 0:n.getWrapper();o&&this._resizeObserver.observe(o)}R(this,Fr,"f").width=document.documentElement.clientWidth,R(this,Fr,"f").height=document.documentElement.clientHeight,window.addEventListener("resize",this._windowResizeListener)}_unbindUI(){var n,i,r,o;R(this,wt,"m",li).call(this)?(this._innerComponent&&(this._innerComponent.removeEventListener("click",this._clickIptSingleFrameMode),this._innerComponent.removeAttribute("title")),this._bgCamera&&(this._bgCamera.style.display="none")):this._stopLoading(),R(this,wt,"m",hl).call(this),null===(n=this._drawingLayersManager)||void 0===n||n.clearDrawingLayers(),null===(i=this._innerComponent)||void 0===i||i.removeElement("drawing-layer"),this._layerBaseCvs=null,this._drawingLayerOfMask=null,this._drawingLayerOfTip=null,null===(r=this._innerComponent)||void 0===r||r.remove(),this._innerComponent=null,Te(this,en,null,"f"),null===(o=this._videoContainer)||void 0===o||o.remove(),this._videoContainer=null,this._selCam=null,this._selRsl=null,this._optGotRsl=null,this._btnClose=null,this._selMinLtr=null,this._optGotMinLtr=null,this._divScanArea=null,this._divScanLight=null,this._singleFrameInputContainer&&(this._singleFrameInputContainer.remove(),this._singleFrameInputContainer=null),window.ResizeObserver&&this._resizeObserver&&this._resizeObserver.disconnect(),window.removeEventListener("resize",this._windowResizeListener)}_startLoading(){this._bgLoading&&(this._bgLoading.style.display="",this._bgLoading.style.animationPlayState="")}_stopLoading(){this._bgLoading&&(this._bgLoading.style.display="none",this._bgLoading.style.animationPlayState="paused")}_renderCamerasInfo(n,i){if(!this._selCam)return;let r;this._selCam.textContent="";for(let o of i){const s=document.createElement("option");s.value=o.deviceId,s.innerText=o.label,this._selCam.append(s),o.deviceId&&n&&n.deviceId==o.deviceId&&(r=s)}this._selCam.value=r?r.value:""}_renderResolutionInfo(n){this._optGotRsl&&(this._optGotRsl.setAttribute("data-width",n.width),this._optGotRsl.setAttribute("data-height",n.height),this._optGotRsl.innerText="got "+n.width+"x"+n.height,this._selRsl&&this._optGotRsl.parentNode==this._selRsl&&(this._selRsl.value="got"))}getVideoElement(){return R(this,en,"f")}isVideoLoaded(){return!!R(this,en,"f")&&4==R(this,en,"f").readyState}setVideoFit(n){if(n=n.toLowerCase(),!["contain","cover"].includes(n))throw new Error(`Unsupported value '${n}'.`);if(this.videoFit=n,!R(this,en,"f")||(R(this,en,"f").style.objectFit=n,R(this,wt,"m",li).call(this)))return;let i;this._updateVideoContainer();try{i=this.getContentDimensions()}catch(r){if("Invalid content dimensions."===(r.message||r))return;throw r}R(this,wt,"m",Hu).call(this,i,this.getConvertedRegion()),this.updateDrawingLayers(i)}getVideoFit(){return this.videoFit}getContentDimensions(){var n,i,r,o;let s,l,h;if(R(this,wt,"m",li).call(this)?(s=null===(r=this._cvsSingleFrameMode)||void 0===r?void 0:r.width,l=null===(o=this._cvsSingleFrameMode)||void 0===o?void 0:o.height,h="contain"):(s=null===(n=R(this,en,"f"))||void 0===n?void 0:n.videoWidth,l=null===(i=R(this,en,"f"))||void 0===i?void 0:i.videoHeight,h=this.getVideoFit()),!s||!l)throw new Error("Invalid content dimensions.");return{width:s,height:l,objectFit:h}}updateConvertedRegion(n){const i=Fu.convert(this.scanRegion,n.width,n.height);Te(this,ju,i,"f"),R(this,cl,"f")&&clearTimeout(R(this,cl,"f")),Te(this,cl,setTimeout(()=>{let r;try{r=this.getContentDimensions()}catch(o){if("Invalid content dimensions."===(o.message||o))return;throw o}R(this,wt,"m",Gu).call(this,r,i),R(this,wt,"m",Hu).call(this,r,i)},0),"f")}getConvertedRegion(){return R(this,ju,"f")}setScanRegion(n){if(null!=n&&!vp(n)&&!qi(n))throw TypeError("Invalid 'region'.");let i;this.scanRegion=n?JSON.parse(JSON.stringify(n)):null;try{i=this.getContentDimensions()}catch(r){if("Invalid content dimensions."===(r.message||r))return;throw r}this.updateConvertedRegion(i)}getScanRegion(){return JSON.parse(JSON.stringify(this.scanRegion))}getVisibleRegionOfVideo(n){if(!this.isVideoLoaded())throw new Error("The video is not loaded.");const i=R(this,en,"f").videoWidth,r=R(this,en,"f").videoHeight,o=this.getVideoFit(),{width:s,height:l}=this._innerComponent.getBoundingClientRect();if(s<=0||l<=0)throw new Error("Unable to get video dimensions. Video may not be rendered on the page.");let h;const p={x:0,y:0,width:i,height:r,isMeasuredInPercentage:!1};if("cover"===o&&(s/l<i/r?(h=l/r,p.x=Math.floor((i-s/h)/2),p.y=0,p.width=Math.ceil(s/h),p.height=r):(h=s/i,p.x=0,p.y=Math.floor((r-l/h)/2),p.width=i,p.height=Math.ceil(l/h))),n?.inPixels)return p;const C=p;return C.x=Math.ceil(C.x/r*100),C.y=Math.ceil(C.y/i*100),C.width=Math.floor(C.width/i*100),C.height=Math.floor(C.height/r*100),C.isMeasuredInPercentage=!0,p}setScanRegionMask(n,i,r,o){this._drawingLayerOfMask||(this._drawingLayerOfMask=this._createDrawingLayer(-2),this.isScanRegionMaskVisible()||R(this,wt,"m",Sp).call(this)),this.clearScanRegionMask(),this._maskBackRectStyleId||(this._maskBackRectStyleId=de.createDrawingStyle({paintMode:"fill",fillStyle:this.regionMaskFillStyle,lineWidth:0})),this._maskCenterRectStyleId||(this._maskCenterRectStyleId=de.createDrawingStyle({paintMode:"stroke",strokeStyle:this.regionMaskStrokeStyle,lineWidth:this.regionMaskLineWidth}));const s=this._drawingLayerOfMask.width,l=this._drawingLayerOfMask.height,h=new ao({x:0,y:0,width:s,height:l},this._maskBackRectStyleId),p=new ao({x:-s/2,y:-l/2+i,width:n,height:o}),C=new ao({x:-s/2+n+r,y:-l/2+i,width:s-n-r<0?0:s-n-r,height:o}),D=new ao({x:-s/2,y:-l/2,width:s,height:i}),T=new ao({x:-s/2,y:-l/2+i+o,width:s,height:l-i-o<0?0:l-i-o});p.set("strokeWidth",0),C.set("strokeWidth",0),D.set("strokeWidth",0),T.set("strokeWidth",0);const A=new Ak([p,C,D,T])._getFabricObject();h.set("clipPath",A);const M=new ao({x:n,y:i,width:r,height:o},this._maskCenterRectStyleId);this._drawingLayerOfMask.addDrawingItems([h,M])}clearScanRegionMask(){this._drawingLayerOfMask&&this._drawingLayerOfMask.clearDrawingItems()}deleteScanRegionMask(){this._drawingLayerOfMask&&this.deleteDrawingLayer(this._drawingLayerOfMask.getId())}_setScanRegionMaskVisible(n){Te(this,Vu,n,"f"),n?R(this,wt,"m",QI).call(this):R(this,wt,"m",Sp).call(this)}setScanRegionMaskVisible(n){this._setScanRegionMaskVisible(n),this._userSetMaskVisible=n}isScanRegionMaskVisible(){return R(this,Vu,"f")}setScanRegionMaskStyle(n){if(!n)return;let i;n.fillStyle&&(this.regionMaskFillStyle=n.fillStyle),n.strokeStyle&&(this.regionMaskStrokeStyle=n.strokeStyle),n.lineWidth&&(this.regionMaskLineWidth=n.lineWidth),this._maskBackRectStyleId&&de.updateDrawingStyle(this._maskBackRectStyleId,{fillStyle:this.regionMaskFillStyle}),this._maskCenterRectStyleId&&de.updateDrawingStyle(this._maskCenterRectStyleId,{strokeStyle:this.regionMaskStrokeStyle,lineWidth:this.regionMaskLineWidth});try{i=this.getContentDimensions()}catch(r){if("Invalid content dimensions."===(r.message||r))return;throw r}R(this,wt,"m",Gu).call(this,i,this.getConvertedRegion())}getScanRegionMaskStyle(){return{fillStyle:this.regionMaskFillStyle,strokeStyle:this.regionMaskStrokeStyle,lineWidth:this.regionMaskLineWidth}}_setScanLaserVisible(n){Te(this,Uu,n,"f"),n?R(this,wt,"m",Tp).call(this):R(this,wt,"m",hl).call(this)}setScanLaserVisible(n){this._setScanLaserVisible(n),this._userSetLaserVisible=n}isScanLaserVisible(){return R(this,Uu,"f")}_updateVideoContainer(){if(!R(this,en,"f")||R(this,wt,"m",li).call(this))return;let n=1;const i=R(this,en,"f").style.transform.match(/scale\((.+)\)/);i&&(n=parseFloat(i[1]));const r=this._videoContainer;if("contain"===this.videoFit&&n>1){const o=R(this,en,"f").videoWidth,s=R(this,en,"f").videoHeight,{width:l,height:h}=this._innerComponent.getBoundingClientRect(),p=o/s;if(l/h<p){let C=l/p;r.style.left="0",r.style.top=(h-C)/2/h*100+"%",r.style.width="100%",r.style.height=C/h*100+"%"}else{let C=h*p;r.style.left=(l-C)/2/l*100+"%",r.style.top="0",r.style.width=C/l*100+"%",r.style.height="100%"}}else r.style.left="0",r.style.top="0",r.style.width="100%",r.style.height="100%"}updateLayers(){let n;this._updateVideoContainer();try{n=this.getContentDimensions()}catch(r){if("Invalid content dimensions."===(r.message||r))return;throw r}const i=this.getConvertedRegion();R(this,wt,"m",Hu).call(this,n,i),this.updateDrawingLayers(n),R(this,wt,"m",Gu).call(this,n,i)}clearAllInnerDrawingItems(){R(this,dl,"f").forEach(n=>n.remove()),R(this,dl,"f").length=0}dispose(){this._unbindUI(),delete window._dce_default_template,this.__proto__=null;for(let n in this)delete this[n];Object.defineProperty(this,"disposed",{value:!0})}}function G(t,n,i,r){if("a"===i&&!r)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof n?t!==n||!r:!n.has(t))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===i?r:"a"===i?r.call(t):r?r.value:n.get(t)}function qe(t,n,i,r,o){if("m"===r)throw new TypeError("Private method is not writable");if("a"===r&&!o)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof n?t!==n||!o:!n.has(t))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===r?o.call(t,i):o?o.value=i:n.set(t,i),i}al=new WeakMap,ll=new WeakMap,cl=new WeakMap,en=new WeakMap,ju=new WeakMap,Vu=new WeakMap,Uu=new WeakMap,Fr=new WeakMap,ul=new WeakMap,dl=new WeakMap,bp=new WeakMap,wt=new WeakSet,li=function(){return"disabled"!==this._singleFrameMode},Gu=function(t,n){!n||0===n.x&&0===n.y&&n.width===t.width&&n.height===t.height?this.clearScanRegionMask():this.setScanRegionMask(n.x,n.y,n.width,n.height)},QI=function(){this._drawingLayerOfMask&&this._drawingLayerOfMask.setVisible(!0)},Sp=function(){this._drawingLayerOfMask&&this._drawingLayerOfMask.setVisible(!1)},Tp=function(){this._divScanLight&&"none"==this._divScanLight.style.display&&(this._divScanLight.style.display="block")},hl=function(){this._divScanLight&&(this._divScanLight.style.display="none")},Hu=function(t,n){if(!this._divScanArea||!this._innerComponent.getElement("content"))return;const{width:i,height:r,objectFit:o}=t;n||(n={x:0,y:0,width:i,height:r});const{width:s,height:l}=this._innerComponent.getBoundingClientRect();if(s<=0||l<=0)return;const h=s/l,p=i/r;let C,D,T,A,M=1;if("contain"===o)h<p?(M=s/i,C=0,D=(l-r*M)/2):(M=l/r,C=(s-i*M)/2,D=0),C+=n.x*M,D+=n.y*M,T=n.width*M,A=n.height*M;else if("cover"===o)if(h<p){M=l/r,C=n.x*M-(i*M-s)/2,C=Math.max(C,0),C=Math.min(C,s),D=n.y*M;let P=(n.x+n.width)*M-(i*M-s)/2;P=Math.max(P,0),P=Math.min(P,s),T=P-C,A=n.height*M}else{M=s/i,C=n.x*M,D=n.y*M-(r*M-l)/2,D=Math.max(D,0),D=Math.min(D,l);let P=(n.y+n.height)*M-(r*M-l)/2;P=Math.max(P,0),P=Math.min(P,l),T=n.width*M,A=P-D}else C=0,D=0,T=0,A=0;this._divScanArea.style.left=C+"px",this._divScanArea.style.top=D+"px",this._divScanArea.style.width=T+"px",this._divScanArea.style.height=A+"px"},Ut.uiComponentName="default-camera-view",Ut._defaultUIElementURL="@engineResourcePath/dce.ui.html","function"==typeof SuppressedError&&SuppressedError;const tD=typeof self>"u";let fl,Ki,Yu,Mp,Rt;function pn(t,n,i,r){if("a"===i&&!r)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof n?t!==n||!r:!n.has(t))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===i?r:"a"===i?r.call(t):r?r.value:n.get(t)}function ci(t,n,i,r,o){if("m"===r)throw new TypeError("Private method is not writable");if("a"===r&&!o)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof n?t!==n||!o:!n.has(t))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===r?o.call(t,i):o?o.value=i:n.set(t,i),i}typeof navigator<"u"&&(fl=navigator,Ki=fl.userAgent,Yu=fl.platform,Mp=fl.mediaDevices),function(){if(!tD){const t={Edge:{search:"Edg",verSearch:"Edg"},OPR:null,Chrome:null,Safari:{str:fl.vendor,search:"Apple",verSearch:["Version","iPhone OS","CPU OS"]},Firefox:null,Explorer:{search:"MSIE",verSearch:"MSIE"}},n={HarmonyOS:null,Android:null,iPhone:null,iPad:null,Windows:{str:Yu,search:"Win"},Mac:{str:Yu},Linux:{str:Yu}};let i="unknownBrowser",r=0,o="unknownOS";for(let s in t){const l=t[s]||{};let C=l.verStr||Ki,D=l.verSearch||s;if(D instanceof Array||(D=[D]),-1!=(l.str||Ki).indexOf(l.search||s)){i=s;for(let T of D){let A=C.indexOf(T);if(-1!=A){r=parseFloat(C.substring(A+T.length+1));break}}break}}for(let s in n){const l=n[s]||{};if(-1!=(l.str||Ki).indexOf(l.search||s)){o=s;break}}"Linux"==o&&-1!=Ki.indexOf("Windows NT")&&(o="HarmonyOS"),Rt={browser:i,version:r,OS:o}}tD&&(Rt={browser:"ssr",version:0,OS:"ssr"})}(),typeof WebAssembly<"u"&&Ki&&(!/Safari/.test(Ki)||/Chrome/.test(Ki)||/\(.+\s11_2_([2-6]).*\)/.test(Ki)),"function"==typeof SuppressedError&&SuppressedError;class Pn{static multiply(n,i){const r=[];for(let o=0;o<3;o++){const s=i.slice(3*o,3*o+3);for(let l=0;l<3;l++){const h=[n[l],n[l+3],n[l+6]].reduce((p,C,D)=>p+C*s[D],0);r.push(h)}}return r}static identity(){return[1,0,0,0,1,0,0,0,1]}static translate(n,i,r){return Pn.multiply(n,[1,0,0,0,1,0,i,r,1])}static rotate(n,i){var r=Math.cos(i),o=Math.sin(i);return Pn.multiply(n,[r,-o,0,o,r,0,0,0,1])}static scale(n,i,r){return Pn.multiply(n,[i,0,0,0,r,0,0,0,1])}}var Ke,Qi,Ji,zu,Ss,gl,pl,Ts,$u,lo,Xu,Rp,Se,He,Qe,qu,Zu,pt,qn,er,xs,Ku,Si,tr,Nn,As,Os,ml,Qu,Ms,co,nr,ir,Lp,Wt,Fp,uo,Rs,Ju,ed,nD,ui,Pp,Np,Ls,_l,td,kn,Fs,kp,Bp,iD;!function(t){t.GREY="grey",t.GREY32="grey32",t.RGBA="rgba",t.RBGA="rbga",t.GRBA="grba",t.GBRA="gbra",t.BRGA="brga",t.BGRA="bgra"}(Ke||(Ke={}));class je{static get version(){return"1.1.1-0"}static checkWebGLSupport(){return null===document.createElement("canvas").getContext("webgl")?(ci(je,Qi,!1,"f",Ji),!1):(ci(je,Qi,!0,"f",Ji),!0)}get disposed(){return pn(this,$u,"f")}constructor(){zu.set(this,Ke.RGBA),Ss.set(this,null),gl.set(this,null),pl.set(this,null),this.useWebGLByDefault=!0,this._reusedCvs=null,this._reusedWebGLCvs=null,Ts.set(this,null),$u.set(this,!1)}drawImage(n,i,r,o,s,l){if(this.disposed)throw Error("The 'ImageDataGetter' instance has been disposed.");if(!r||!o)throw new Error("Invalid 'sourceWidth' or 'sourceHeight'.");if(null==pn(je,Qi,"f",Ji)&&je.checkWebGLSupport(),l?.bUseWebGL&&!pn(je,Qi,"f",Ji))throw new Error("Your browser or machine may not support WebGL.");if(i instanceof HTMLVideoElement&&4!==i.readyState||i instanceof HTMLImageElement&&!i.complete)throw new Error("The source is not loaded.");let h;je._onLog&&(h=Date.now(),je._onLog("drawImage(), START: "+h));let p=0,C=0,D=r,T=o,A=0,M=0,P=r,B=o;s&&(s.sx&&(p=Math.round(s.sx)),s.sy&&(C=Math.round(s.sy)),s.sWidth&&(D=Math.round(s.sWidth)),s.sHeight&&(T=Math.round(s.sHeight)),s.dx&&(A=Math.round(s.dx)),s.dy&&(M=Math.round(s.dy)),s.dWidth&&(P=Math.round(s.dWidth)),s.dHeight&&(B=Math.round(s.dHeight)));let k,U=Ke.RGBA;if(l?.pixelFormat&&(U=l.pixelFormat),l?.bufferContainer&&(k=l.bufferContainer,k.length<4*P*B))throw new Error("Unexpected size of the 'bufferContainer'.");const V=n;if(!pn(je,Qi,"f",Ji)||!(this.useWebGLByDefault&&null==l?.bUseWebGL||l?.bUseWebGL)){je._onLog&&je._onLog("drawImage() in context2d."),V.ctx2d||(V.ctx2d=V.getContext("2d",{willReadFrequently:!0}));const q=V.ctx2d;if(!q)throw new Error("Unable to get 'CanvasRenderingContext2D' from canvas.");return(V.width<A+P||V.height<M+B)&&(V.width=A+P,V.height=M+B),q.drawImage(i,p,C,D,T,A,M,P,B),je._onLog&&je._onLog("drawImage() in context2d end. Costs: "+(Date.now()-h)),{context:q,pixelFormat:Ke.RGBA,bUseWebGL:!1}}je._onLog&&je._onLog("drawImage() in WebGL.");try{(V.width<A+P||V.height<M+B)&&(V.width=A+P,V.height=M+B,V.ctxWebGL&&V.ctxWebGL.viewport(0,0,A+P,M+B));const q=V.ctxWebGL||V.getContext("webgl",{antialias:!1})||V.getContext("experimental-webgl",{antialias:!1});if(!q){je._onLog&&je._onLog("Browser or machine may not support WebGL, or the canvas has already been set to a different context mode.");const S=new Error("Unable to get 'WebGLRenderingContext'. Your browser or machine may not support WebGL, or the canvas has already been set to a different context mode.");throw S.name="WebGLError",S}if(!V.ctxWebGL||U!==pn(this,zu,"f")){V.ctxWebGL=q;const S=a=>{const c=a.createBuffer();a.bindBuffer(a.ARRAY_BUFFER,c),a.bufferData(a.ARRAY_BUFFER,new Float32Array([0,0,0,1,1,0,1,0,0,1,1,1]),a.STATIC_DRAW);const _=a.createBuffer();return a.bindBuffer(a.ARRAY_BUFFER,_),a.bufferData(a.ARRAY_BUFFER,new Float32Array([0,0,0,1,1,0,1,0,0,1,1,1]),a.STATIC_DRAW),{positions:c,texCoords:_}},we=a=>{const c=a.createTexture();return a.bindTexture(a.TEXTURE_2D,c),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MAG_FILTER,a.LINEAR),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MIN_FILTER,a.LINEAR),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_WRAP_S,a.CLAMP_TO_EDGE),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_WRAP_T,a.CLAMP_TO_EDGE),c},Me=(a,c)=>{const _=a.createProgram();if(c.forEach(I=>a.attachShader(_,I)),a.linkProgram(_),!a.getProgramParameter(_,a.LINK_STATUS)){const I=new Error(`An error occured linking the program: ${a.getProgramInfoLog(_)}.`);throw I.name="WebGLError",I}return a.useProgram(_),_},nt=(a,c,_)=>{const I=a.createShader(c);if(a.shaderSource(I,_),a.compileShader(I),!a.getShaderParameter(I,a.COMPILE_STATUS)){const y=new Error(`An error occured compiling the shader: ${a.getShaderInfoLog(I)}.`);throw y.name="WebGLError",y}return I},m="\n                  attribute vec2 a_position;\n                  attribute vec2 a_texCoord;\n  \n                  uniform mat3 u_matrix;\n                  uniform mat3 u_textureMatrix;\n  \n                  varying vec2 v_texCoord;\n                  void main(void) {\n                  gl_Position = vec4((u_matrix * vec3(a_position, 1)).xy, 0, 1.0);\n                  v_texCoord = vec4((u_textureMatrix * vec3(a_texCoord, 1)).xy, 0, 1.0).xy;\n                  }\n              ";let f="rgb";["rgba","rbga","grba","gbra","brga","bgra"].includes(U)&&(f=U.slice(0,3));const g=`\n                  precision mediump float;\n                  varying vec2 v_texCoord;\n                  uniform sampler2D u_image;\n                  uniform float uColorFactor;\n  \n                  void main() {\n                      vec4 sample = texture2D(u_image, v_texCoord);\n                      float grey = 0.21 * sample.r + 0.71 * sample.g + 0.07 * sample.b;\n                      gl_FragColor = vec4(sample.${f} * (1.0 - uColorFactor) + (grey * uColorFactor), sample.a);\n                  }\n              `,v=Me(q,[nt(q,q.VERTEX_SHADER,m),nt(q,q.FRAGMENT_SHADER,g)]);ci(this,gl,{program:v,attribLocations:{vertexPosition:q.getAttribLocation(v,"a_position"),texPosition:q.getAttribLocation(v,"a_texCoord")},uniformLocations:{uSampler:q.getUniformLocation(v,"u_image"),uColorFactor:q.getUniformLocation(v,"uColorFactor"),uMatrix:q.getUniformLocation(v,"u_matrix"),uTextureMatrix:q.getUniformLocation(v,"u_textureMatrix")}},"f"),ci(this,pl,S(q),"f"),ci(this,Ss,we(q),"f"),ci(this,zu,U,"f")}const ce=(S,we,Me)=>{S.bindBuffer(S.ARRAY_BUFFER,we),S.enableVertexAttribArray(Me),S.vertexAttribPointer(Me,2,S.FLOAT,!1,0,0)},ve=(S,we,Me,nt)=>{S.clearColor(0,0,0,1),S.clearDepth(1),S.enable(S.DEPTH_TEST),S.depthFunc(S.LEQUAL),S.clear(S.COLOR_BUFFER_BIT|S.DEPTH_BUFFER_BIT),ce(S,Me.positions,we.attribLocations.vertexPosition),ce(S,Me.texCoords,we.attribLocations.texPosition),S.activeTexture(S.TEXTURE0),S.bindTexture(S.TEXTURE_2D,nt),S.uniform1i(we.uniformLocations.uSampler,0),S.uniform1f(we.uniformLocations.uColorFactor,[Ke.GREY,Ke.GREY32].includes(U)?1:0);let m,f,g=Pn.translate(Pn.identity(),-1,-1);g=Pn.scale(g,2,2),g=Pn.scale(g,1/S.canvas.width,1/S.canvas.height),m=Pn.translate(g,A,M),m=Pn.scale(m,P,B),S.uniformMatrix3fv(we.uniformLocations.uMatrix,!1,m),f=Pn.translate(Pn.identity(),p/r,C/o),f=Pn.scale(f,D/r,T/o),S.uniformMatrix3fv(we.uniformLocations.uTextureMatrix,!1,f),S.drawArrays(S.TRIANGLES,0,6)};((S,we,Me)=>{const nt=S.RGBA,m=S.RGBA,f=S.UNSIGNED_BYTE;S.bindTexture(S.TEXTURE_2D,we),S.texImage2D(S.TEXTURE_2D,0,nt,m,f,Me)})(q,pn(this,Ss,"f"),i),ve(q,pn(this,gl,"f"),pn(this,pl,"f"),pn(this,Ss,"f"));const me=k||new Uint8Array(4*P*B);if(q.readPixels(A,M,P,B,q.RGBA,q.UNSIGNED_BYTE,me),255!==me[3]){je._onLog&&je._onLog("Incorrect WebGL drawing .");const S=new Error("WebGL error: incorrect drawing.");throw S.name="WebGLError",S}return je._onLog&&je._onLog("drawImage() in WebGL end. Costs: "+(Date.now()-h)),{context:q,pixelFormat:U===Ke.GREY?Ke.GREY32:U,bUseWebGL:!0}}catch(q){if(this.forceLoseContext(),console.log(q),null==l?.bUseWebGL)return je._onLog&&je._onLog("'drawImage()' in WebGL failed, try again in context2d."),this.useWebGLByDefault=!1,this.drawImage(n,i,r,o,s,Object.assign({},l,{bUseWebGL:!1}));throw q.name="WebGLError",q}}readCvsData(n,i,r){if(!(n instanceof CanvasRenderingContext2D||n instanceof WebGLRenderingContext))throw new Error("Invalid 'context'.");let o,s=0,l=0,h=n.canvas.width,p=n.canvas.height;if(i&&(i.x&&(s=i.x),i.y&&(l=i.y),i.width&&(h=i.width),i.height&&(p=i.height)),r?.length<4*h*p)throw new Error("Unexpected size of the 'bufferContainer'.");if(n instanceof WebGLRenderingContext){const C=n;r?(C.readPixels(s,l,h,p,C.RGBA,C.UNSIGNED_BYTE,r),o=new Uint8Array(r.buffer,0,4*h*p)):(o=new Uint8Array(4*h*p),C.readPixels(s,l,h,p,C.RGBA,C.UNSIGNED_BYTE,o))}else if(n instanceof CanvasRenderingContext2D){let C;C=n.getImageData(s,l,h,p),o=new Uint8Array(C.data.buffer),r?.set(o)}return o}transformPixelFormat(n,i,r,o){let s,l;if(je._onLog&&(s=Date.now(),je._onLog("transformPixelFormat(), START: "+s)),i===r)return je._onLog&&je._onLog("transformPixelFormat() end. Costs: "+(Date.now()-s)),o?new Uint8Array(n):n;const h=[Ke.RGBA,Ke.RBGA,Ke.GRBA,Ke.GBRA,Ke.BRGA,Ke.BGRA];if(h.includes(i))if(r===Ke.GREY){l=new Uint8Array(n.length/4);for(let p=0;p<n.length;p+=4)l[p/4]=.21*n[p]+.71*n[p+1]+.07*n[p+2]}else if(r===Ke.GREY32){l=o?new Uint8Array(n):n;for(let p=0;p<n.length;p+=4){const C=.21*n[p]+.71*n[p+1]+.07*n[p+2];l[p]=C,l[p+1]=C,l[p+2]=C}}else{if(!h.includes(r))throw new Error("Unable to transform.");if(o){l=new Uint8Array(n);const p=i.indexOf("r"),C=i.indexOf("g"),D=i.indexOf("b"),T=r.indexOf("r"),A=r.indexOf("g"),M=r.indexOf("b");for(let P=0;P<n.length;P+=4)l[P+T]=n[P+p],l[P+A]=n[P+C],l[P+M]=n[P+D]}else{l=n;const p=i.indexOf("r"),C=i.indexOf("g"),D=i.indexOf("b"),T=r.indexOf("r"),A=r.indexOf("g"),M=r.indexOf("b");for(let P=0;P<n.length;P+=4){let B=[n[P],n[P+1],n[P+2]];l[P+T]=B[p],l[P+A]=B[C],l[P+M]=B[D]}}}else if(i===Ke.GREY){if(r!==Ke.GREY32)throw new Error("Unable to transform.");l=new Uint8Array(4*n.length);for(let p=0;p<n.length;p++)l[4*p]=n[p],l[4*p+1]=n[p],l[4*p+2]=n[p],l[4*p+3]=255}else{if(i!==Ke.GREY32)throw new Error("Unable to transform.");if(r!==Ke.GREY)throw new Error("Unable to transform.");l=new Uint8Array(n.length/4);for(let p=0;p<n.length;p+=4)l[p/4]=n[p]}return je._onLog&&je._onLog("transformPixelFormat() end. Costs: "+(Date.now()-s)),l}getImageData(n,i,r,o,s){if(this.disposed)throw Error("The 'ImageDataGetter' instance has been disposed.");if(!i||!r)throw new Error("Invalid 'sourceWidth' or 'sourceHeight'.");if(null==pn(je,Qi,"f",Ji)&&je.checkWebGLSupport(),s?.bUseWebGL&&!pn(je,Qi,"f",Ji))throw new Error("Your browser or machine may not support WebGL.");if(o.sx>i||o.sy>r||o.sx+o.sWidth>i||o.sy+o.sHeight>r)throw new Error("Invalid position.");if(n instanceof HTMLVideoElement&&4!==n.readyState||n instanceof HTMLImageElement&&!n.complete)throw new Error("The source is not loaded.");let l;je._onLog&&(l=Date.now(),je._onLog("getImageData(), START: "+l));const h=Math.round(o.sx),p=Math.round(o.sy),C=Math.round(o.sWidth),D=Math.round(o.sHeight),T=Math.round(o.dWidth),A=Math.round(o.dHeight);let M=Ke.RGBA;s?.pixelFormat&&(M=s.pixelFormat);let P,B,k,U=null;if(s?.bufferContainer&&(U=s.bufferContainer),pn(je,Qi,"f",Ji)&&(this.useWebGLByDefault&&null==s?.bUseWebGL||s?.bUseWebGL)){je._onLog&&je._onLog("getImageData() in WebGL."),this._reusedWebGLCvs||(this._reusedWebGLCvs=document.createElement("canvas")),P=this._reusedWebGLCvs;try{if(U)if(M===Ke.GREY){if(k=new Uint8Array(4*T*A),B=this.drawImage(P,n,i,r,{sx:h,sy:p,sWidth:C,sHeight:D,dWidth:T,dHeight:A},{pixelFormat:M,bUseWebGL:!0,bufferContainer:k}),k=this.transformPixelFormat(k,B.pixelFormat,M),U){if(U.length<k.length)throw new Error("Unexpected size of the 'bufferContainer'.");U.set(k)}}else B=this.drawImage(P,n,i,r,{sx:h,sy:p,sWidth:C,sHeight:D,dWidth:T,dHeight:A},{pixelFormat:M,bUseWebGL:!0,bufferContainer:U}),k=new Uint8Array(U.buffer,0,4*T*A),k=this.transformPixelFormat(k,B.pixelFormat,M);else M===Ke.GREY?((!pn(this,Ts,"f")||pn(this,Ts,"f").length<4*T*A)&&ci(this,Ts,new Uint8Array(4*T*A),"f"),k=new Uint8Array(pn(this,Ts,"f").buffer,0,4*T*A)):k=new Uint8Array(4*T*A),B=this.drawImage(P,n,i,r,{sx:h,sy:p,sWidth:C,sHeight:D,dWidth:T,dHeight:A},{pixelFormat:M,bUseWebGL:!0,bufferContainer:k}),k=this.transformPixelFormat(k,B.pixelFormat,M)}catch(V){if("WebGLError"===V.name&&(this.forceLoseContext(),null==s?.bUseWebGL))return je._onLog&&je._onLog("getImageData() in WebGL failed, try again in context2d."),this.useWebGLByDefault=!1,this.getImageData(n,i,r,{sx:h,sy:p,sWidth:C,sHeight:D,dWidth:T,dHeight:A},Object.assign({},s,{bUseWebGL:!1}));throw V}}else if(je._onLog&&je._onLog("getImageData() in context2d."),this._reusedCvs||(this._reusedCvs=document.createElement("canvas")),P=this._reusedCvs,B=this.drawImage(P,n,i,r,{sx:h,sy:p,sWidth:C,sHeight:D,dWidth:T,dHeight:A},{pixelFormat:Ke.RGBA,bUseWebGL:!1}),k=this.readCvsData(B.context,{width:T,height:A},null),k=this.transformPixelFormat(k,B.pixelFormat,M),U){if(U.length<k.length)throw new Error("Unexpected size of the 'bufferContainer'.");U.set(k)}return je._onLog&&je._onLog("getImageData() end. Costs: "+(Date.now()-l)),{data:k,pixelFormat:M,width:T,height:A,bUseWebGL:B.bUseWebGL}}convertDataToCvs(n,i,r,o){if(!(n instanceof Uint8Array||n instanceof Uint8ClampedArray))throw new TypeError("Invalid 'data'.");if("number"!=typeof i||i<=0)throw new Error("Invalid 'width'.");if("number"!=typeof r||r<=0)throw new Error("Invalid 'height'.");const s=document.createElement("canvas");let l;if(s.width=i,s.height=r,o===Ke.GREY){l=new Uint8ClampedArray(4*i*r);for(let p=0;p<l.length;p+=4)l[p]=n[p/4],l[p+1]=n[p/4],l[p+2]=n[p/4],l[p+3]=255}else l=new Uint8ClampedArray(n.buffer);const h=new ImageData(l,i,r);return s.getContext("2d").putImageData(h,0,0),s}forceLoseContext(){if(!this._reusedWebGLCvs)return;const n=this._reusedWebGLCvs.ctxWebGL;n&&!n.isContextLost()&&n.getExtension("WEBGL_lose_context")&&n.getExtension("WEBGL_lose_context").loseContext(),ci(this,Ss,null,"f"),ci(this,gl,null,"f"),ci(this,pl,null,"f"),this._reusedWebGLCvs=null}dispose(){this.forceLoseContext(),ci(this,$u,!0,"f")}}Qi=je,zu=new WeakMap,Ss=new WeakMap,gl=new WeakMap,pl=new WeakMap,Ts=new WeakMap,$u=new WeakMap,Ji={value:void 0};class Lk{constructor(){lo.set(this,new Map),Xu.set(this,!1)}get disposed(){return G(this,Xu,"f")}on(n,i){n=n.toLowerCase();const r=G(this,lo,"f").get(n);if(r){if(r.includes(i))return;r.push(i)}else G(this,lo,"f").set(n,[i])}off(n,i){n=n.toLowerCase();const r=G(this,lo,"f").get(n);if(!r)return;const o=r.indexOf(i);-1!==o&&r.splice(o,1)}offAll(n){n=n.toLowerCase();const i=G(this,lo,"f").get(n);i&&(i.length=0)}fire(n,i=[],r={async:!1,copy:!0}){var o=this;return J(function*(){i||(i=[]),n=n.toLowerCase();const s=G(o,lo,"f").get(n);if(s&&s.length){r=Object.assign({async:!1,copy:!0},r);for(let l of s){if(!l)continue;let h=[];if(r.copy)for(let C of i){try{C=JSON.parse(JSON.stringify(C))}catch{}h.push(C)}else h=i;let p=!1;if(r.async)setTimeout(()=>{o.disposed||l.apply(r.target,h)},0);else try{p=yield l.apply(r.target,h)}catch{}if(!0===p)break}}})()}dispose(){qe(this,Xu,!0,"f")}}lo=new WeakMap,Xu=new WeakMap;const Sn=(t,n,i,r)=>{if(!i)return t;let o=n+Math.round((t-n)/i)*i;return r&&(o=Math.min(o,r)),o};class Ve{static get version(){return"2.0.0"}static isStorageAvailable(n){let i;try{i=window[n];const r="__storage_test__";return i.setItem(r,r),i.removeItem(r),!0}catch(r){return r instanceof DOMException&&(22===r.code||1014===r.code||"QuotaExceededError"===r.name||"NS_ERROR_DOM_QUOTA_REACHED"===r.name)&&i&&0!==i.length}}static findBestRearCameraInIOS(n,i){if(!n||!n.length)return null;let r=!1;if(i?.getMainCamera&&(r=!0),r){const o=["\ud6c4\uba74 \uce74\uba54\ub77c","\u80cc\u9762\u30ab\u30e1\u30e9","\u5f8c\u7f6e\u93e1\u982d","\u540e\u7f6e\u76f8\u673a","\u0e01\u0e25\u0e49\u0e2d\u0e07\u0e14\u0e49\u0e32\u0e19\u0e2b\u0e25\u0e31\u0e07","\u092c\u0948\u0915 \u0915\u0948\u092e\u0930\u093e","\u0627\u0644\u0643\u0627\u0645\u064a\u0631\u0627 \u0627\u0644\u062e\u0644\u0641\u064a\u0629","\u05de\u05e6\u05dc\u05de\u05d4 \u05d0\u05d7\u05d5\u05e8\u05d9\u05ea","\u043a\u0430\u043c\u0435\u0440\u0430 \u043d\u0430 \u0437\u0430\u0434\u043d\u0435\u0439 \u043f\u0430\u043d\u0435\u043b\u0438","\u0437\u0430\u0434\u043d\u044f \u043a\u0430\u043c\u0435\u0440\u0430","\u0437\u0430\u0434\u043d\u0430 \u043a\u0430\u043c\u0435\u0440\u0430","\u0430\u0440\u0442\u049b\u044b \u043a\u0430\u043c\u0435\u0440\u0430","\u03c0\u03af\u03c3\u03c9 \u03ba\u03ac\u03bc\u03b5\u03c1\u03b1","zadn\xed fotoapar\xe1t","zadn\xe1 kamera","tylny aparat","takakamera","stra\u017enja kamera","r\xfcckkamera","kamera p\xe5 baksidan","kamera belakang","kamera bak","h\xe1ts\xf3 kamera","fotocamera (posteriore)","c\xe2mera traseira","c\xe2mara traseira","c\xe1mara trasera","c\xe0mera posterior","cam\xe9ra arri\xe8re","camer\u0103 spate","camera m\u1eb7t sau","camera aan achterzijde","bagsidekamera","back camera","arka kamera"],s=n.find(l=>o.includes(l.label.toLowerCase()));return s?.deviceId}{const o=["\ud6c4\uba74","\u80cc\u9762","\u5f8c\u7f6e","\u540e\u7f6e","\u0e32\u0e19\u0e2b\u0e25\u0e31\u0e07","\u092c\u0948\u0915","\u062e\u0644\u0641\u064a\u0629","\u05d0\u05d7\u05d5\u05e8\u05d9\u05ea","\u0437\u0430\u0434\u043d\u044f\u044f","\u0437\u0430\u0434\u043d\u0435\u0439","\u0437\u0430\u0434\u043d\u0430","\u03c0\u03af\u03c3\u03c9","zadn\xed","zadn\xe1","tylny","trasera","traseira","taka","stra\u017enja","spate","sau","r\xfcck","posteriore","posterior","h\xe1ts\xf3","belakang","baksidan","bakre","bak","bagside","back","a\u0440\u0442\u049b\u044b","arri\xe8re","arka","achterzijde"],s=["\ud2b8\ub9ac\ud50c","\u4e09\u955c\u5934","\u4e09\u93e1\u982d","\u30c8\u30ea\u30d7\u30eb","\u0e2a\u0e32\u0e21","\u091f\u094d\u0930\u093f\u092a\u0932","\u062b\u0644\u0627\u062b\u064a\u0629","\u05de\u05e9\u05d5\u05dc\u05e9\u05ea","\u04af\u0448\u0442\u0456\u043a","\u0442\u0440\u043e\u0439\u043d\u0430\u044f","\u0442\u0440\u043e\u0439\u043d\u0430","\u043f\u043e\u0442\u0440\u043e\u0454\u043d\u0430","\u03c4\u03c1\u03b9\u03c0\u03bb\u03ae","\xfc\xe7l\xfc","tr\xf3jobiektywowy","trostruka","trojn\xfd","trojit\xe1","trippelt","trippel","tripl\u0103","triple","tripla","tiga","kolmois","ba camera"],l=["\ub4c0\uc5bc \uc640\uc774\ub4dc","\u96d9\u5ee3\u89d2","\u53cc\u5e7f\u89d2","\u30c7\u30e5\u30a2\u30eb\u5e83\u89d2","\u0e04\u0e39\u0e48\u0e14\u0e49\u0e32\u0e19\u0e2b\u0e25\u0e31\u0e07\u0e21\u0e38\u0e21\u0e01\u0e27\u0e49\u0e32\u0e07","\u0921\u094d\u092f\u0941\u0905\u0932 \u0935\u093e\u0907\u0921","\u0645\u0632\u062f\u0648\u062c\u0629 \u0639\u0631\u064a\u0636\u0629","\u05db\u05e4\u05d5\u05dc\u05d4 \u05e8\u05d7\u05d1\u05d4","\u049b\u043e\u0441 \u043a\u0435\u04a3 \u0431\u04b1\u0440\u044b\u0448\u0442\u044b","\u0437\u0434\u0432\u043e\u0454\u043d\u0430 \u0448\u0438\u0440\u043e\u043a\u043e\u043a\u0443\u0442\u043d\u0430","\u0434\u0432\u043e\u0439\u043d\u0430\u044f \u0448\u0438\u0440\u043e\u043a\u043e\u0443\u0433\u043e\u043b\u044c\u043d\u0430\u044f","\u0434\u0432\u043e\u0439\u043d\u0430 \u0448\u0438\u0440\u043e\u043a\u043e\u044a\u0433\u044a\u043b\u043d\u0430","\u03b4\u03b9\u03c0\u03bb\u03ae \u03b5\u03c5\u03c1\u03b5\u03af\u03b1","\xe7ift geni\u015f","laajakulmainen kaksois","k\xe9p r\u1ed9ng m\u1eb7t sau","kett\u0151s, sz\xe9les l\xe1t\xf3sz\xf6g\u0171","grande angular dupla","ganda","dwuobiektywowy","dwikamera","dvostruka \u0161iroka","du\xe1ln\xed \u0161iroko\xfahl\xfd","du\xe1lna \u0161irokouhl\xe1","dupla grande-angular","dubl\u0103","dubbel vidvinkel","dual-weitwinkel","dual wide","dual con gran angular","dual","double","doppia con grandangolo","doble","dobbelt vidvinkelkamera"],h=n.filter(D=>{const T=D.label.toLowerCase();return o.some(A=>T.includes(A))});if(!h.length)return null;const p=h.find(D=>{const T=D.label.toLowerCase();return s.some(A=>T.includes(A))});if(p)return p.deviceId;const C=h.find(D=>{const T=D.label.toLowerCase();return l.some(A=>T.includes(A))});return C?C.deviceId:h[0].deviceId}}static findBestRearCamera(n,i){if(!n||!n.length)return null;if(["iPhone","iPad","Mac"].includes(Rt.OS))return Ve.findBestRearCameraInIOS(n,{getMainCamera:i?.getMainCameraInIOS});const r=["\ud6c4","\u80cc\u9762","\u80cc\u7f6e","\u5f8c\u9762","\u5f8c\u7f6e","\u540e\u9762","\u540e\u7f6e","\u0e32\u0e19\u0e2b\u0e25\u0e31\u0e07","\u0e2b\u0e25\u0e31\u0e07","\u092c\u0948\u0915","\u062e\u0644\u0641\u064a\u0629","\u05d0\u05d7\u05d5\u05e8\u05d9\u05ea","\u0437\u0430\u0434\u043d\u044f\u044f","\u0437\u0430\u0434\u043d\u044f","\u0437\u0430\u0434\u043d\u0435\u0439","\u0437\u0430\u0434\u043d\u0430","\u03c0\u03af\u03c3\u03c9","zadn\xed","zadn\xe1","tylny","tr\xe1s","trasera","traseira","taka","stra\u017enja","spate","sau","r\xfcck","rear","posteriore","posterior","h\xe1ts\xf3","darrere","belakang","baksidan","bakre","bak","bagside","back","a\u0440\u0442\u049b\u044b","arri\xe8re","arka","achterzijde"];for(let o of n){const s=o.label.toLowerCase();if(s&&r.some(l=>s.includes(l))&&/\b0(\b)?/.test(s))return o.deviceId}return["Android","HarmonyOS"].includes(Rt.OS)?n[n.length-1].deviceId:null}static findBestCamera(n,i,r){return n&&n.length?"environment"===i?this.findBestRearCamera(n,r):"user"===i?null:i?void 0:null:null}static playVideo(n,i,r){return J(function*(){if(!n)throw new Error("Invalid 'videoEl'.");if(!i)throw new Error("Invalid 'source'.");return"string"==typeof i||i instanceof String?n.src=i:n.srcObject=i,new Promise((o,s)=>{let l;const h=()=>{n.removeEventListener("loadstart",D),n.removeEventListener("abort",T),n.removeEventListener("play",A),n.removeEventListener("error",M)},p=()=>{l&&clearTimeout(l),h(),o(n)},C=P=>{l&&clearTimeout(l),h(),s(P)},D=()=>{n.addEventListener("abort",T,{once:!0})},T=()=>{const P=new Error("Video playing was interrupted.");P.name="AbortError",C(P)},A=()=>{p()},M=()=>{C(new Error(`Video error ${n.error.code}: ${n.error.message}.`))};n.addEventListener("loadstart",D,{once:!0}),n.autoplay&&["iPhone","iPad","Mac"].includes(Rt.OS)&&Rt.version>=17?(n.addEventListener("play",A,{once:!0}),n.addEventListener("error",M,{once:!0})):(n.load(),n.play().then(()=>{p()}).catch(P=>{C(P)})),r&&(l=setTimeout(()=>{h(),s(new Error("Failed to play video. Timeout."))},r))})})()}static testCameraAccess(n){return J(function*(){var i,r;if(null===(r=null===(i=window?.navigator)||void 0===i?void 0:i.mediaDevices)||void 0===r||!r.getUserMedia)return{ok:!1,errorName:"InsecureContext",errorMessage:"Insecure context."};let o;try{o=n?yield navigator.mediaDevices.getUserMedia(n):yield navigator.mediaDevices.getUserMedia({video:!0})}catch(s){return{ok:!1,errorName:s.name,errorMessage:s.message}}finally{o?.getTracks().forEach(s=>{s.stop()})}return{ok:!0}})()}get state(){if(!G(this,Nn,"f"))return"closed";if("pending"===G(this,Nn,"f"))return"opening";if("fulfilled"===G(this,Nn,"f"))return"opened";throw new Error("Unknown state.")}set ifSaveLastUsedCamera(n){n?Ve.isStorageAvailable("localStorage")?qe(this,xs,!0,"f"):(qe(this,xs,!1,"f"),console.warn("Local storage is unavailable")):qe(this,xs,!1,"f")}get ifSaveLastUsedCamera(){return G(this,xs,"f")}get isVideoPlaying(){return!(!G(this,He,"f")||G(this,He,"f").paused)&&"opened"===this.state}set tapFocusEventBoundEl(n){var i,r,o;if(!(n instanceof HTMLElement)&&null!=n)throw new TypeError("Invalid 'element'.");null===(i=G(this,co,"f"))||void 0===i||i.removeEventListener("click",G(this,Ms,"f")),null===(r=G(this,co,"f"))||void 0===r||r.removeEventListener("touchend",G(this,Ms,"f")),null===(o=G(this,co,"f"))||void 0===o||o.removeEventListener("touchmove",G(this,Qu,"f")),qe(this,co,n,"f"),n&&(window.TouchEvent&&["Android","HarmonyOS","iPhone","iPad"].includes(Rt.OS)?(n.addEventListener("touchend",G(this,Ms,"f")),n.addEventListener("touchmove",G(this,Qu,"f"))):n.addEventListener("click",G(this,Ms,"f")))}get tapFocusEventBoundEl(){return G(this,co,"f")}get disposed(){return G(this,ed,"f")}constructor(n){var r,o,i=this;Se.add(this),He.set(this,null),Qe.set(this,void 0),qu.set(this,()=>{"opened"===this.state&&G(this,Wt,"f").fire("resumed",null,{target:this,async:!0})}),Zu.set(this,()=>{G(this,Wt,"f").fire("paused",null,{target:this,async:!1})}),pt.set(this,void 0),qn.set(this,void 0),this.cameraOpenTimeout=4e3,this._arrCameras=[],er.set(this,void 0),xs.set(this,!1),this.ifSkipCameraInspection=!1,this.selectIOSRearMainCameraAsDefault=!1,Ku.set(this,void 0),Si.set(this,!0),tr.set(this,void 0),Nn.set(this,void 0),As.set(this,!1),this._focusParameters={maxTimeout:400,minTimeout:300,kTimeout:void 0,oldDistance:null,fds:null,isDoingFocus:0,taskBackToContinous:null,curFocusTaskId:0,focusCancelableTime:1500,defaultFocusAreaSizeRatio:6,focusBackToContinousTime:5e3,tapFocusMinDistance:null,tapFocusMaxDistance:null,focusArea:null,tempBufferContainer:null,defaultTempBufferContainerLenRatio:1/4},Os.set(this,!1),this._focusSupported=!0,this.calculateCoordInVideo=(s,l)=>{let h,p;const C=window.getComputedStyle(G(this,He,"f")).objectFit,D=this.getResolution(),T=G(this,He,"f").getBoundingClientRect(),A=T.left,M=T.top,{width:P,height:B}=G(this,He,"f").getBoundingClientRect();if(P<=0||B<=0)throw new Error("Unable to get video dimensions. Video may not be rendered on the page.");const k=P/B,U=D.width/D.height;let V=1;if("contain"===C)U>k?(V=P/D.width,h=(s-A)/V,p=(l-M-(B-P/U)/2)/V):(V=B/D.height,p=(l-M)/V,h=(s-A-(P-B*U)/2)/V);else{if("cover"!==C)throw new Error("Unsupported object-fit.");U>k?(V=B/D.height,p=(l-M)/V,h=(s-A+(B*U-P)/2)/V):(V=P/D.width,h=(s-A)/V,p=(l-M+(P/U-B)/2)/V)}return{x:h,y:p}},ml.set(this,!1),Qu.set(this,()=>{qe(this,ml,!0,"f")}),Ms.set(this,function(){var s=J(function*(l){var h;if(G(i,ml,"f"))return void qe(i,ml,!1,"f");if(!(G(i,Os,"f")&&i.isVideoPlaying&&G(i,Qe,"f")&&i._focusSupported))return;if(!i._focusParameters.fds&&(i._focusParameters.fds=null===(h=i.getCameraCapabilities())||void 0===h?void 0:h.focusDistance,!i._focusParameters.fds))return void(i._focusSupported=!1);if(null==i._focusParameters.kTimeout&&(i._focusParameters.kTimeout=(i._focusParameters.maxTimeout-i._focusParameters.minTimeout)/(1/i._focusParameters.fds.min-1/i._focusParameters.fds.max)),1==i._focusParameters.isDoingFocus)return;let p,C;if(i._focusParameters.taskBackToContinous&&(clearTimeout(i._focusParameters.taskBackToContinous),i._focusParameters.taskBackToContinous=null),l instanceof MouseEvent)p=l.clientX,C=l.clientY;else{if(!(l instanceof TouchEvent))throw new Error("Unknown event type.");if(!l.changedTouches.length)return;p=l.changedTouches[0].clientX,C=l.changedTouches[0].clientY}const D=i.getResolution(),T=2*Math.round(Math.min(D.width,D.height)/i._focusParameters.defaultFocusAreaSizeRatio/2);let A;try{A=i.calculateCoordInVideo(p,C)}catch{}if(A.x<0||A.x>D.width||A.y<0||A.y>D.height)return;const M={x:A.x+"px",y:A.y+"px"},P=T+"px",B=P;let k;Ve._onLog&&(k=Date.now());try{yield G(i,Se,"m",kp).call(i,M,P,B,i._focusParameters.tapFocusMinDistance,i._focusParameters.tapFocusMaxDistance)}catch(U){if(Ve._onLog)throw Ve._onLog(U),U}Ve._onLog&&Ve._onLog(`Tap focus costs: ${Date.now()-k} ms`),i._focusParameters.taskBackToContinous=setTimeout(()=>{var U;Ve._onLog&&Ve._onLog("Back to continuous focus."),null===(U=G(i,Qe,"f"))||void 0===U||U.applyConstraints({advanced:[{focusMode:"continuous"}]}).catch(()=>{})},i._focusParameters.focusBackToContinousTime),G(i,Wt,"f").fire("tapfocus",null,{target:i,async:!0})});return function(l){return s.apply(this,arguments)}}()),co.set(this,null),nr.set(this,1),ir.set(this,{x:0,y:0}),this.updateVideoElWhenSoftwareScaled=()=>{if(!G(this,He,"f"))return;const s=G(this,nr,"f");if(s<1)throw new RangeError("Invalid scale value.");if(1===s)G(this,He,"f").style.transform="";else{const l=window.getComputedStyle(G(this,He,"f")).objectFit,h=G(this,He,"f").videoWidth,p=G(this,He,"f").videoHeight,{width:C,height:D}=G(this,He,"f").getBoundingClientRect();if(C<=0||D<=0)throw new Error("Unable to get video dimensions. Video may not be rendered on the page.");const T=C/D,A=h/p;let M=1;"contain"===l?M=T<A?C/(h/s):D/(p/s):"cover"===l&&(M=A>T?D/(h/s):C/(p/s));const P=M*(1-1/s)*(h/2-G(this,ir,"f").x),B=M*(1-1/s)*(p/2-G(this,ir,"f").y);G(this,He,"f").style.transform=`translate(${P}px, ${B}px) scale(${s})`}},Lp.set(this,function(){if(!(this.data instanceof Uint8Array||this.data instanceof Uint8ClampedArray))throw new TypeError("Invalid data.");if("number"!=typeof this.width||this.width<=0)throw new Error("Invalid width.");if("number"!=typeof this.height||this.height<=0)throw new Error("Invalid height.");const s=document.createElement("canvas");let l;if(s.width=this.width,s.height=this.height,this.pixelFormat===Ke.GREY){l=new Uint8ClampedArray(this.width*this.height*4);for(let p=0;p<l.length;p+=4)l[p]=this.data[p/4],l[p+1]=this.data[p/4],l[p+2]=this.data[p/4],l[p+3]=255}else l=new Uint8ClampedArray(this.data.buffer);const h=new ImageData(l,this.width,this.height);return s.getContext("2d").putImageData(h,0,0),s}),Wt.set(this,void 0),Fp.set(this,["before:open","opened","before:close","closed","before:camera:change","camera:changed","before:resolution:change","resolution:changed","played","paused","resumed","tapfocus"]),this.detectedResolutions=[{width:160,height:120},{width:320,height:240},{width:480,height:360},{width:640,height:480},{width:800,height:600},{width:960,height:720},{width:1280,height:720},{width:1920,height:1080},{width:2560,height:1440},{width:3840,height:2160}],uo.set(this,new Map),Rs.set(this,!1),Ju.set(this,J(function*(){var s,l;if("visible"===document.visibilityState){if(Ve._onLog&&Ve._onLog("document visible. video paused: "+(null===(s=G(i,He,"f"))||void 0===s?void 0:s.paused)),G(i,Rs,"f")&&G(i,He,"f")&&i.videoSrc&&"opened"===i.state)return void i.resume().catch(()=>{});if(!i._mediaStream)return;if(i._mediaStream.active&&G(i,Qe,"f"))if(G(i,Qe,"f").muted&&["iPhone","iPad","Mac"].includes(Rt.OS)){if(Rt.version>=17)return;yield G(i,Se,"m",Ls).call(i)}else G(i,Rs,"f")&&i.resume().catch(()=>{});else yield G(i,Se,"m",Ls).call(i)}else if("hidden"===document.visibilityState&&(Ve._onLog&&Ve._onLog("document hidden. video paused: "+(null===(l=G(i,He,"f"))||void 0===l?void 0:l.paused)),["iPhone","iPad","Mac"].includes(Rt.OS)?qe(i,Rs,!0,"f"):qe(i,Rs,i.isVideoPlaying,"f"),i.isVideoLoaded()&&"opened"==i.state)){if(["iPhone","iPad","Mac"].includes(Rt.OS)&&Rt.version>=17)return;i.pause()}})),ed.set(this,!1),!(null===(o=null===(r=window?.navigator)||void 0===r?void 0:r.mediaDevices)||void 0===o)&&o.getUserMedia||setTimeout(()=>{Ve.onWarning&&Ve.onWarning("The browser is too old or the page is loaded from an insecure origin.")},0),this.defaultConstraints={video:{facingMode:{ideal:"environment"}}},this.resetMediaStreamConstraints(),n instanceof HTMLVideoElement&&this.setVideoEl(n),qe(this,Wt,new Lk,"f"),this.imageDataGetter=new je,document.addEventListener("visibilitychange",G(this,Ju,"f"))}setVideoEl(n){if(!(n&&n instanceof HTMLVideoElement))throw new Error("Invalid 'videoEl'.");n.addEventListener("play",G(this,qu,"f")),n.addEventListener("pause",G(this,Zu,"f")),qe(this,He,n,"f")}getVideoEl(){return G(this,He,"f")}releaseVideoEl(){var n,i;null===(n=G(this,He,"f"))||void 0===n||n.removeEventListener("play",G(this,qu,"f")),null===(i=G(this,He,"f"))||void 0===i||i.removeEventListener("pause",G(this,Zu,"f")),qe(this,He,null,"f")}isVideoLoaded(){return!!G(this,He,"f")&&4==G(this,He,"f").readyState}open(){var n=this;return J(function*(){if(G(n,tr,"f")&&!G(n,Si,"f")){if("pending"===G(n,Nn,"f"))return G(n,tr,"f");if("fulfilled"===G(n,Nn,"f"))return}G(n,Wt,"f").fire("before:open",null,{target:n}),yield G(n,Se,"m",Ls).call(n),G(n,Wt,"f").fire("opened",null,{target:n,async:!0}),G(n,Wt,"f").fire("played",null,{target:n,async:!0})})()}close(){var n=this;return J(function*(){if("closed"===n.state)return;G(n,Wt,"f").fire("before:close",null,{target:n});const i=G(n,tr,"f");if(G(n,Se,"m",td).call(n),i&&"pending"===G(n,Nn,"f")){try{yield i}catch{}if(!1===G(n,Si,"f")){const r=new Error("'close()' was interrupted.");throw r.name="AbortError",r}}qe(n,tr,null,"f"),qe(n,Nn,null,"f"),G(n,Wt,"f").fire("closed",null,{target:n,async:!0})})()}pause(){if(!this.isVideoLoaded())throw new Error("Video is not loaded.");if("opened"!==this.state)throw new Error("Camera or video is not open.");G(this,He,"f").pause()}resume(){var n=this;return J(function*(){if(!n.isVideoLoaded())throw new Error("Video is not loaded.");if("opened"!==n.state)throw new Error("Camera or video is not open.");yield G(n,He,"f").play()})()}setCamera(n){var i=this;return J(function*(){if("string"!=typeof n)throw new TypeError("Invalid 'deviceId'.");if("object"!=typeof G(i,pt,"f").video&&(G(i,pt,"f").video={}),delete G(i,pt,"f").video.facingMode,G(i,pt,"f").video.deviceId={exact:n},!("closed"===i.state||i.videoSrc||"opening"===i.state&&G(i,Si,"f"))){G(i,Wt,"f").fire("before:camera:change",[],{target:i,async:!1}),yield G(i,Se,"m",_l).call(i);try{i.resetSoftwareScale()}catch{}return G(i,qn,"f")}})()}switchToFrontCamera(n){var i=this;return J(function*(){if("object"!=typeof G(i,pt,"f").video&&(G(i,pt,"f").video={}),n?.resolution&&(G(i,pt,"f").video.width={ideal:n.resolution.width},G(i,pt,"f").video.height={ideal:n.resolution.height}),delete G(i,pt,"f").video.deviceId,G(i,pt,"f").video.facingMode={exact:"user"},qe(i,er,null,"f"),!("closed"===i.state||i.videoSrc||"opening"===i.state&&G(i,Si,"f"))){G(i,Wt,"f").fire("before:camera:change",[],{target:i,async:!1}),G(i,Se,"m",_l).call(i);try{i.resetSoftwareScale()}catch{}return G(i,qn,"f")}})()}getCamera(){var n;if(G(this,qn,"f"))return G(this,qn,"f");{let i=(null===(n=G(this,pt,"f").video)||void 0===n?void 0:n.deviceId)||"";if(i){i=i.exact||i.ideal||i;for(let r of this._arrCameras)if(r.deviceId===i)return JSON.parse(JSON.stringify(r))}return{deviceId:"",label:"",_checked:!1}}}_getCameras(n){var i=this;return J(function*(){var r,o;if(null===(o=null===(r=window?.navigator)||void 0===r?void 0:r.mediaDevices)||void 0===o||!o.getUserMedia)throw new Error("Failed to access the camera because the browser is too old or the page is loaded from an insecure origin.");let s;if(n){let p=yield navigator.mediaDevices.getUserMedia({video:!0});s=(yield navigator.mediaDevices.enumerateDevices()).filter(C=>"videoinput"===C.kind),p.getTracks().forEach(C=>{C.stop()})}else s=(yield navigator.mediaDevices.enumerateDevices()).filter(p=>"videoinput"===p.kind);const l=[],h=[];if(i._arrCameras)for(let p of i._arrCameras)p._checked&&h.push(p);for(let p=0;p<s.length;p++){let C,D=s[p];for(let T of h)if(D.deviceId==T.deviceId){C=T;break}C||(C={deviceId:D.deviceId,label:D.label?D.label:"camera "+p,_checked:!1}),C.deviceId&&l.push(C)}return i._arrCameras=l,Ve._onLog&&Ve._onLog(JSON.stringify(i._arrCameras)),l})()}getCameras(){var n=this;return J(function*(){var i,r;if(null===(r=null===(i=window?.navigator)||void 0===i?void 0:i.mediaDevices)||void 0===r||!r.enumerateDevices)throw new Error("Failed to access the camera because the browser is too old or the page is loaded from an insecure origin.");const o=(yield navigator.mediaDevices.enumerateDevices()).filter(s=>"videoinput"===s.kind);return n._getCameras(!(!o||!o.length||o[0].deviceId))})()}getAllCameras(){var n=this;return J(function*(){return n.getCameras()})()}setResolution(n,i,r){var o=this;return J(function*(){if("number"!=typeof n||n<=0)throw new TypeError("Invalid 'width'.");if("number"!=typeof i||i<=0)throw new TypeError("Invalid 'height'.");if("object"!=typeof G(o,pt,"f").video&&(G(o,pt,"f").video={}),r?(G(o,pt,"f").video.width={exact:n},G(o,pt,"f").video.height={exact:i}):(G(o,pt,"f").video.width={ideal:n},G(o,pt,"f").video.height={ideal:i}),"closed"===o.state||o.videoSrc||"opening"===o.state&&G(o,Si,"f"))return null;G(o,Wt,"f").fire("before:resolution:change",[],{target:o,async:!1}),yield G(o,Se,"m",_l).call(o);try{o.resetSoftwareScale()}catch{}const s=o.getResolution();return{width:s.width,height:s.height}})()}getResolution(){if("opened"===this.state&&this.videoSrc&&G(this,He,"f"))return{width:G(this,He,"f").videoWidth,height:G(this,He,"f").videoHeight};if(G(this,Qe,"f")){const n=G(this,Qe,"f").getSettings();return{width:n.width,height:n.height}}if(this.isVideoLoaded())return{width:G(this,He,"f").videoWidth,height:G(this,He,"f").videoHeight};{const n={width:0,height:0};let i=G(this,pt,"f").video.width||0,r=G(this,pt,"f").video.height||0;return i&&(n.width=i.exact||i.ideal||i),r&&(n.height=r.exact||r.ideal||r),n}}getResolutions(n){var i=this;return J(function*(){var r,o,s,l,h,p,C,D,T,A,M;if(null===(o=null===(r=window?.navigator)||void 0===r?void 0:r.mediaDevices)||void 0===o||!o.getUserMedia)throw new Error("Failed to access the camera because the browser is too old or the page is loaded from an insecure origin.");let P="";const B=(k,U)=>{const V=G(i,uo,"f").get(k);if(!V||!V.length)return!1;for(let q of V)if(q.width===U.width&&q.height===U.height)return!0;return!1};if(i._mediaStream){P=null===(M=G(i,qn,"f"))||void 0===M?void 0:M.deviceId;let k=G(i,uo,"f").get(P);if(k&&!n)return JSON.parse(JSON.stringify(k));k=[],G(i,uo,"f").set(P,k),qe(i,As,!0,"f");try{for(let U of i.detectedResolutions){yield G(i,Qe,"f").applyConstraints({width:{ideal:U.width},height:{ideal:U.height}}),G(i,Se,"m",ui).call(i);const V=G(i,Qe,"f").getSettings(),q={width:V.width,height:V.height};B(P,q)||k.push({width:q.width,height:q.height})}}catch(U){throw G(i,Se,"m",td).call(i),qe(i,As,!1,"f"),U}try{yield G(i,Se,"m",Ls).call(i)}catch(U){if("AbortError"===U.name)return k;throw U}finally{qe(i,As,!1,"f")}return k}{const k=function(){var q=J(function*(ce,ge,ve){const me={video:{deviceId:{exact:ce},width:{ideal:ge},height:{ideal:ve}}};let S=null;try{S=yield navigator.mediaDevices.getUserMedia(me)}catch{return null}if(!S)return null;const we=S.getVideoTracks();let Me=null;try{const nt=we[0].getSettings();Me={width:nt.width,height:nt.height}}catch{const m=document.createElement("video");m.srcObject=S,Me={width:m.videoWidth,height:m.videoHeight},m.srcObject=null}return we.forEach(nt=>{nt.stop()}),Me});return function(ge,ve,me){return q.apply(this,arguments)}}();let U=(null===(h=null===(l=null===(s=G(i,pt,"f"))||void 0===s?void 0:s.video)||void 0===l?void 0:l.deviceId)||void 0===h?void 0:h.exact)||(null===(D=null===(C=null===(p=G(i,pt,"f"))||void 0===p?void 0:p.video)||void 0===C?void 0:C.deviceId)||void 0===D?void 0:D.ideal)||(null===(A=null===(T=G(i,pt,"f"))||void 0===T?void 0:T.video)||void 0===A?void 0:A.deviceId);if(!U)return[];let V=G(i,uo,"f").get(U);if(V&&!n)return JSON.parse(JSON.stringify(V));V=[],G(i,uo,"f").set(U,V);for(let q of i.detectedResolutions){const ce=yield k(U,q.width,q.height);ce&&!B(U,ce)&&V.push({width:ce.width,height:ce.height})}return V}})()}setMediaStreamConstraints(n,i){var r=this;return J(function*(){if(null===(o=n)||"[object Object]"!==Object.prototype.toString.call(o))throw new TypeError("Invalid 'mediaStreamConstraints'.");var o;qe(r,pt,JSON.parse(JSON.stringify(n)),"f"),qe(r,er,null,"f"),i&&G(r,Se,"m",_l).call(r)})()}getMediaStreamConstraints(){return JSON.parse(JSON.stringify(G(this,pt,"f")))}resetMediaStreamConstraints(){qe(this,pt,this.defaultConstraints?JSON.parse(JSON.stringify(this.defaultConstraints)):null,"f")}getCameraCapabilities(){if(!G(this,Qe,"f")||"opened"!==this.state)throw new Error("Camera is not open.");return G(this,Qe,"f").getCapabilities?G(this,Qe,"f").getCapabilities():{}}getCameraSettings(){if(!G(this,Qe,"f")||"opened"!==this.state)throw new Error("Camera is not open.");return G(this,Qe,"f").getSettings()}turnOnTorch(){var n=this;return J(function*(){if(!G(n,Qe,"f")||"opened"!==n.state)throw new Error("Camera is not open.");const i=n.getCameraCapabilities();if(!i?.torch)throw Error("Not supported.");yield G(n,Qe,"f").applyConstraints({advanced:[{torch:!0}]})})()}turnOffTorch(){var n=this;return J(function*(){if(!G(n,Qe,"f")||"opened"!==n.state)throw new Error("Camera is not open.");const i=n.getCameraCapabilities();if(!i?.torch)throw Error("Not supported.");yield G(n,Qe,"f").applyConstraints({advanced:[{torch:!1}]})})()}setColorTemperature(n,i){var r=this;return J(function*(){var o;if("number"!=typeof n)throw new TypeError("Invalid 'value'.");if(!G(r,Qe,"f")||"opened"!==r.state)throw new Error("Camera is not open.");const s=null===(o=r.getCameraCapabilities())||void 0===o?void 0:o.colorTemperature;if(!s)throw Error("Not supported.");return i&&(n<s.min?n=s.min:n>s.max&&(n=s.max),n=Sn(n,s.min,s.step,s.max)),yield G(r,Qe,"f").applyConstraints({advanced:[{colorTemperature:n,whiteBalanceMode:"manual"}]}),n})()}getColorTemperature(){return this.getCameraSettings().colorTemperature||0}setExposureCompensation(n,i){var r=this;return J(function*(){var o;if("number"!=typeof n)throw new TypeError("Invalid 'value'.");if(!G(r,Qe,"f")||"opened"!==r.state)throw new Error("Camera is not open.");const s=null===(o=r.getCameraCapabilities())||void 0===o?void 0:o.exposureCompensation;if(!s)throw Error("Not supported.");return i&&(n<s.min?n=s.min:n>s.max&&(n=s.max),n=Sn(n,s.min,s.step,s.max)),yield G(r,Qe,"f").applyConstraints({advanced:[{exposureCompensation:n}]}),n})()}getExposureCompensation(){return this.getCameraSettings().exposureCompensation||0}setFrameRate(n,i){var r=this;return J(function*(){var o;if("number"!=typeof n)throw new TypeError("Invalid 'value'.");if(!G(r,Qe,"f")||"opened"!==r.state)throw new Error("Camera is not open.");let s=null===(o=r.getCameraCapabilities())||void 0===o?void 0:o.frameRate;if(!s)throw Error("Not supported.");i&&(n<s.min?n=s.min:n>s.max&&(n=s.max));const l=r.getResolution();return yield G(r,Qe,"f").applyConstraints({width:{ideal:Math.max(l.width,l.height)},frameRate:n}),n})()}getFrameRate(){return this.getCameraSettings().frameRate}setFocus(n,i){var r=this;return J(function*(){if("object"!=typeof n||Array.isArray(n)||null==n)throw new TypeError("Invalid 'settings'.");if(!G(r,Qe,"f")||"opened"!==r.state)throw new Error("Camera is not open.");const o=r.getCameraCapabilities(),s=o?.focusMode,l=o?.focusDistance;if(!s)throw Error("Not supported.");if("string"!=typeof n.mode)throw TypeError("Invalid 'mode'.");const h=n.mode.toLowerCase();if(!s.includes(h))throw Error("Unsupported focus mode.");if("manual"===h){if(!l)throw Error("Manual focus unsupported.");if(n.hasOwnProperty("distance")){let p=n.distance;i&&(p<l.min?p=l.min:p>l.max&&(p=l.max),p=Sn(p,l.min,l.step,l.max)),r._focusParameters.focusArea=null,yield G(r,Qe,"f").applyConstraints({advanced:[{focusMode:h,focusDistance:p}]})}else{if(!n.area)throw new Error("'distance' or 'area' should be specified in 'manual' mode.");{const p=n.area.centerPoint;let C=n.area.width,D=n.area.height;if(!C||!D){const T=r.getResolution();C||(C=2*Math.round(Math.min(T.width,T.height)/r._focusParameters.defaultFocusAreaSizeRatio/2)+"px"),D||(D=2*Math.round(Math.min(T.width,T.height)/r._focusParameters.defaultFocusAreaSizeRatio/2)+"px")}r._focusParameters.focusArea={centerPoint:{x:p.x,y:p.y},width:C,height:D},yield G(r,Se,"m",kp).call(r,p,C,D)}}}else r._focusParameters.focusArea=null,yield G(r,Qe,"f").applyConstraints({advanced:[{focusMode:h}]})})()}getFocus(){const n=this.getCameraSettings(),i=n.focusMode;return i?"manual"===i?this._focusParameters.focusArea?{mode:"manual",area:JSON.parse(JSON.stringify(this._focusParameters.focusArea))}:{mode:"manual",distance:n.focusDistance}:{mode:i}:null}enableTapToFocus(){var n=this;return J(function*(){qe(n,Os,!0,"f")})()}disableTapToFocus(){qe(this,Os,!1,"f")}isTapToFocusEnabled(){return G(this,Os,"f")}setZoom(n){var i=this;return J(function*(){if("object"!=typeof n||Array.isArray(n)||null==n)throw new TypeError("Invalid 'settings'.");if("number"!=typeof n.factor)throw new TypeError("Illegal type of 'factor'.");if(n.factor<1)throw new RangeError("Invalid 'factor'.");if("opened"!==i.state)throw new Error("Video is not playing.");n.centerPoint?G(i,Se,"m",Bp).call(i,n.centerPoint):i.resetScaleCenter();try{if(G(i,Se,"m",iD).call(i,G(i,ir,"f"))){const r=yield i.setHardwareScale(n.factor,!0);let o=i.getHardwareScale();1==o&&1!=r&&(o=r),i.setSoftwareScale(n.factor>o?n.factor/o:1)}else yield i.setHardwareScale(1),i.setSoftwareScale(n.factor)}catch(r){const o=r.message||r;if("Not supported."!==o&&"Camera is not open."!==o)throw r;i.setSoftwareScale(n.factor)}})()}getZoom(){if("opened"!==this.state)throw new Error("Video is not playing.");let n=1;try{n=this.getHardwareScale()}catch(i){if("Camera is not open."!==(i.message||i))throw i}return{factor:n*G(this,nr,"f")}}resetZoom(){var n=this;return J(function*(){yield n.setZoom({factor:1})})()}setHardwareScale(n,i){var r=this;return J(function*(){var o;if("number"!=typeof n)throw new TypeError("Invalid 'value'.");if(n<1)throw new RangeError("Invalid 'value'.");if(!G(r,Qe,"f")||"opened"!==r.state)throw new Error("Camera is not open.");const s=null===(o=r.getCameraCapabilities())||void 0===o?void 0:o.zoom;if(!s)throw Error("Not supported.");return i&&(n<s.min?n=s.min:n>s.max&&(n=s.max),n=Sn(n,s.min,s.step,s.max)),yield G(r,Qe,"f").applyConstraints({advanced:[{zoom:n}]}),n})()}getHardwareScale(){return this.getCameraSettings().zoom||1}setSoftwareScale(n,i){if("number"!=typeof n)throw new TypeError("Invalid 'value'.");if(n<1)throw new RangeError("Invalid 'value'.");if("opened"!==this.state)throw new Error("Video is not playing.");i&&G(this,Se,"m",Bp).call(this,i),qe(this,nr,n,"f"),this.updateVideoElWhenSoftwareScaled()}getSoftwareScale(){return G(this,nr,"f")}resetScaleCenter(){if("opened"!==this.state)throw new Error("Video is not playing.");const n=this.getResolution();qe(this,ir,{x:n.width/2,y:n.height/2},"f")}resetSoftwareScale(){this.setSoftwareScale(1),this.resetScaleCenter()}getFrameData(n){if(this.disposed)throw Error("The 'Camera' instance has been disposed.");if(!this.isVideoLoaded()||G(this,As,"f"))return null;const i=Date.now();Ve._onLog&&Ve._onLog("getFrameData() START: "+i);const r=G(this,He,"f").videoWidth,o=G(this,He,"f").videoHeight;let s={sx:0,sy:0,sWidth:r,sHeight:o,dWidth:r,dHeight:o};n?.position&&(s=JSON.parse(JSON.stringify(n.position)));let l=Ke.RGBA;n?.pixelFormat&&(l=n.pixelFormat);let h=G(this,nr,"f");n?.scale&&(h=n.scale);let p=G(this,ir,"f");if(n?.scaleCenter){if("string"!=typeof n.scaleCenter.x||"string"!=typeof n.scaleCenter.y)throw new Error("Invalid scale center.");let A=0,M=0;if(n.scaleCenter.x.endsWith("px"))A=parseFloat(n.scaleCenter.x);else{if(!n.scaleCenter.x.endsWith("%"))throw new Error("Invalid scale center.");A=parseFloat(n.scaleCenter.x)/100*r}if(n.scaleCenter.y.endsWith("px"))M=parseFloat(n.scaleCenter.y);else{if(!n.scaleCenter.y.endsWith("%"))throw new Error("Invalid scale center.");M=parseFloat(n.scaleCenter.y)/100*o}if(isNaN(A)||isNaN(M))throw new Error("Invalid scale center.");p.x=Math.round(A),p.y=Math.round(M)}let C=null;if(n?.bufferContainer&&(C=n.bufferContainer),0==r||0==o)return null;1!==h&&(s.sWidth=Math.round(s.sWidth/h),s.sHeight=Math.round(s.sHeight/h),s.sx=Math.round((1-1/h)*p.x+s.sx/h),s.sy=Math.round((1-1/h)*p.y+s.sy/h));const D=this.imageDataGetter.getImageData(G(this,He,"f"),r,o,s,{pixelFormat:l,bufferContainer:C});if(!D)return null;const T=Date.now();return Ve._onLog&&Ve._onLog("getFrameData() END: "+T),{data:D.data,width:D.width,height:D.height,pixelFormat:D.pixelFormat,timeSpent:T-i,timeStamp:T,toCanvas:G(this,Lp,"f")}}on(n,i){if(!G(this,Fp,"f").includes(n.toLowerCase()))throw new Error(`Event '${n}' does not exist.`);G(this,Wt,"f").on(n,i)}off(n,i){G(this,Wt,"f").off(n,i)}dispose(){var n=this;return J(function*(){n.tapFocusEventBoundEl=null,yield n.close(),n.releaseVideoEl(),G(n,Wt,"f").dispose(),n.imageDataGetter.dispose(),document.removeEventListener("visibilitychange",G(n,Ju,"f")),qe(n,ed,!0,"f")})()}}var vl,nd,Ps,ho,id,Ns,rD,oD,Je,jp,Vp,be,xe,yl,rr,fo,rd,od,sd,wl,go,ad,or,Bn,mt,ye,Ti,Up,_t,sD,aD,Gp,Hp;He=new WeakMap,Qe=new WeakMap,qu=new WeakMap,Zu=new WeakMap,pt=new WeakMap,qn=new WeakMap,er=new WeakMap,xs=new WeakMap,Ku=new WeakMap,Si=new WeakMap,tr=new WeakMap,Nn=new WeakMap,As=new WeakMap,Os=new WeakMap,ml=new WeakMap,Qu=new WeakMap,Ms=new WeakMap,co=new WeakMap,nr=new WeakMap,ir=new WeakMap,Lp=new WeakMap,Wt=new WeakMap,Fp=new WeakMap,uo=new WeakMap,Rs=new WeakMap,Ju=new WeakMap,ed=new WeakMap,Se=new WeakSet,nD=function(){var t=J(function*(){var n=this;const i=this.getMediaStreamConstraints();if("boolean"==typeof i.video&&(i.video={}),!i.video.deviceId)if(G(this,er,"f"))delete i.video.facingMode,i.video.deviceId={exact:G(this,er,"f")};else if(this.ifSaveLastUsedCamera&&Ve.isStorageAvailable&&window.localStorage.getItem("dce_last_camera_id")){delete i.video.facingMode,i.video.deviceId={ideal:window.localStorage.getItem("dce_last_camera_id")};const r=JSON.parse(window.localStorage.getItem("dce_last_apply_width")),o=JSON.parse(window.localStorage.getItem("dce_last_apply_height"));r&&o&&(i.video.width=r,i.video.height=o)}else if(!this.ifSkipCameraInspection){const r=function(){var l=J(function*(h){let p=null;return"environment"===h&&["Android","HarmonyOS","iPhone","iPad"].includes(Rt.OS)?(yield n._getCameras(!1),G(n,Se,"m",ui).call(n),p=Ve.findBestCamera(n._arrCameras,"environment",{getMainCameraInIOS:n.selectIOSRearMainCameraAsDefault})):h||["Android","HarmonyOS","iPhone","iPad"].includes(Rt.OS)||(yield n._getCameras(!1),G(n,Se,"m",ui).call(n),p=Ve.findBestCamera(n._arrCameras,null,{getMainCameraInIOS:n.selectIOSRearMainCameraAsDefault})),p});return function(p){return l.apply(this,arguments)}}();let o=i.video.facingMode;o instanceof Array&&o.length&&(o=o[0]),"object"==typeof o&&(o=o.exact||o.ideal);const s=yield r(o);s&&(delete i.video.facingMode,i.video.deviceId={exact:s})}return i});return function(){return t.apply(this,arguments)}}(),ui=function(){if(G(this,Si,"f")){const t=new Error("The operation was interrupted.");throw t.name="AbortError",t}},Pp=function(){var t=J(function*(n){var r,o,i=this;if(null===(o=null===(r=window?.navigator)||void 0===r?void 0:r.mediaDevices)||void 0===o||!o.getUserMedia)throw new Error("Failed to access the camera because the browser is too old or the page is loaded from an insecure origin.");let s;try{Ve._onLog&&Ve._onLog("======try getUserMedia========");let l=[0,500],h=null;const p=function(){var C=J(function*(D){for(let T of l){T&&(yield new Promise(A=>setTimeout(A,T)),G(i,Se,"m",ui).call(i));try{Ve._onLog&&Ve._onLog("ask "+JSON.stringify(D)),s=yield navigator.mediaDevices.getUserMedia(D),G(i,Se,"m",ui).call(i);break}catch(A){if("NotFoundError"===A.name||"NotAllowedError"===A.name||"AbortError"===A.name||"OverconstrainedError"===A.name)throw A;h=A,Ve._onLog&&Ve._onLog(A.message||A)}}});return function(T){return C.apply(this,arguments)}}();if(yield p(n),s||(Ve._onLog&&Ve._onLog("======try getUserMedia again========"),Ve._onLog&&Ve._onLog(n),yield p(n)),s||(l=[1e3,2e3],yield p(n)),s||(yield p(n)),!s)throw h;return s}catch(l){throw s?.getTracks().forEach(h=>{h.stop()}),"NotFoundError"===l.name&&(DOMException?l=new DOMException("No camera available, please use a device with an accessible camera.",l.name):(l=new Error("No camera available, please use a device with an accessible camera.")).name="NotFoundError"),l}});return function(i){return t.apply(this,arguments)}}(),Np=function(){this._mediaStream&&(this._mediaStream.getTracks().forEach(t=>{t.stop()}),this._mediaStream=null),qe(this,Qe,null,"f")},Ls=function(){var t=J(function*(){var n=this;qe(this,Si,!1,"f");const i=qe(this,Ku,Symbol(),"f");if(G(this,tr,"f")&&"pending"===G(this,Nn,"f")){try{yield G(this,tr,"f")}catch{}G(this,Se,"m",ui).call(this)}return i!==G(this,Ku,"f")?void 0:qe(this,tr,J(function*(){qe(n,Nn,"pending","f");try{if(n.videoSrc){if(!G(n,He,"f"))throw new Error("'videoEl' should be set.");yield Ve.playVideo(G(n,He,"f"),n.videoSrc,n.cameraOpenTimeout),G(n,Se,"m",ui).call(n)}else{let o=yield G(n,Se,"m",nD).call(n);G(n,Se,"m",Np).call(n);let s=yield G(n,Se,"m",Pp).call(n,o);yield n._getCameras(!1),G(n,Se,"m",ui).call(n);const l=()=>{const D=s.getVideoTracks();let T,A;if(D.length&&(T=D[0]),T){const M=T.getSettings();if(M)for(let P of n._arrCameras)if(M.deviceId===P.deviceId){P._checked=!0,P.label=T.label,A=P;break}}return A},h=G(n,pt,"f");if("object"==typeof h.video){let D=h.video.facingMode;if(D instanceof Array&&D.length&&(D=D[0]),"object"==typeof D&&(D=D.exact||D.ideal),!(G(n,er,"f")||n.ifSaveLastUsedCamera&&Ve.isStorageAvailable&&window.localStorage.getItem("dce_last_camera_id")||n.ifSkipCameraInspection||h.video.deviceId)){const T=l(),A=Ve.findBestCamera(n._arrCameras,D,{getMainCameraInIOS:n.selectIOSRearMainCameraAsDefault});A&&A!=T?.deviceId&&(s.getTracks().forEach(M=>{M.stop()}),o.video.deviceId={exact:A},s=yield G(n,Se,"m",Pp).call(n,o),G(n,Se,"m",ui).call(n))}}const p=l();p?.deviceId&&(qe(n,er,p&&p.deviceId,"f"),n.ifSaveLastUsedCamera&&Ve.isStorageAvailable&&(window.localStorage.setItem("dce_last_camera_id",G(n,er,"f")),"object"==typeof o.video&&o.video.width&&o.video.height&&(window.localStorage.setItem("dce_last_apply_width",JSON.stringify(o.video.width)),window.localStorage.setItem("dce_last_apply_height",JSON.stringify(o.video.height))))),G(n,He,"f")&&(yield Ve.playVideo(G(n,He,"f"),s,n.cameraOpenTimeout),G(n,Se,"m",ui).call(n)),n._mediaStream=s;const C=s.getVideoTracks();C?.length&&qe(n,Qe,C[0],"f"),qe(n,qn,p,"f")}}catch(o){throw G(n,Se,"m",td).call(n),qe(n,Nn,null,"f"),o}qe(n,Nn,"fulfilled","f")})(),"f")});return function(){return t.apply(this,arguments)}}(),_l=function(){var t=J(function*(){var n;if("closed"===this.state||this.videoSrc)return;const i=null===(n=G(this,qn,"f"))||void 0===n?void 0:n.deviceId,r=this.getResolution();yield G(this,Se,"m",Ls).call(this);const o=this.getResolution();i&&i!==G(this,qn,"f").deviceId&&G(this,Wt,"f").fire("camera:changed",[G(this,qn,"f").deviceId,i],{target:this,async:!0}),r.width==o.width&&r.height==o.height||G(this,Wt,"f").fire("resolution:changed",[{width:o.width,height:o.height},{width:r.width,height:r.height}],{target:this,async:!0}),G(this,Wt,"f").fire("played",null,{target:this,async:!0})});return function(){return t.apply(this,arguments)}}(),td=function(){G(this,Se,"m",Np).call(this),qe(this,qn,null,"f"),G(this,He,"f")&&(G(this,He,"f").srcObject=null,this.videoSrc&&(G(this,He,"f").pause(),G(this,He,"f").currentTime=0)),qe(this,Si,!0,"f");try{this.resetSoftwareScale()}catch{}},kn=function(){var t=J(function*(i,r){const o=k=>{if(!G(this,Qe,"f")||!this.isVideoPlaying||k.focusTaskId!=this._focusParameters.curFocusTaskId){G(this,Qe,"f")&&this.isVideoPlaying||(this._focusParameters.isDoingFocus=0);const U=new Error(`Focus task ${k.focusTaskId} canceled.`);throw U.name="DeprecatedTaskError",U}1===this._focusParameters.isDoingFocus&&Date.now()-k.timeStart>this._focusParameters.focusCancelableTime&&(this._focusParameters.isDoingFocus=-1)};let s;r=Sn(r,this._focusParameters.fds.min,this._focusParameters.fds.step,this._focusParameters.fds.max),yield G(this,Qe,"f").applyConstraints({advanced:[{focusMode:"manual",focusDistance:r}]}),o(i),s=null==this._focusParameters.oldDistance?this._focusParameters.kTimeout*Math.max(Math.abs(1/this._focusParameters.fds.min-1/r),Math.abs(1/this._focusParameters.fds.max-1/r))+this._focusParameters.minTimeout:this._focusParameters.kTimeout*Math.abs(1/this._focusParameters.oldDistance-1/r)+this._focusParameters.minTimeout,this._focusParameters.oldDistance=r,yield new Promise(k=>{setTimeout(k,s)}),o(i);let l=i.focusL-i.focusW/2,h=i.focusT-i.focusH/2,p=i.focusW,C=i.focusH;const D=this.getResolution();if(l>=D.width||h>=D.height)throw new Error("Invalid area.");l+p>D.width&&(p=D.width-l),h+C>D.height&&(C=D.height-h),l=Math.round(l),h=Math.round(h),p=Math.round(p),C=Math.round(C);const T=4*D.width*D.height*this._focusParameters.defaultTempBufferContainerLenRatio,A=4*p*C;let M=this._focusParameters.tempBufferContainer;if(M){const k=M.length;T>k&&T>=A?M=new Uint8Array(T):A>k&&A>=T&&(M=new Uint8Array(A))}else M=this._focusParameters.tempBufferContainer=new Uint8Array(Math.max(T,A));if(!this.imageDataGetter.getImageData(G(this,He,"f"),D.width,D.height,{sx:l,sy:h,sWidth:p,sHeight:C,dWidth:p,dHeight:C},{pixelFormat:Ke.RGBA,bufferContainer:M}))return G(this,Se,"m",n).call(this,i,r);const P=M;let B=0;for(let k=0,U=A-8;k<U;++k){let V=P[k]-P[k+8];++k;let q=P[k]-P[k+8];++k;let ce=P[k]-P[k+8];++k,B+=V*V+q*q+ce*ce}return-B});function n(i,r){return t.apply(this,arguments)}return n}(),Fs=function(){var t=J(function*(i,r,o,s,l,h,p){let C;if(r=Sn(r,this._focusParameters.fds.min,this._focusParameters.fds.step,this._focusParameters.fds.max),s=Sn(s,this._focusParameters.fds.min,this._focusParameters.fds.step,this._focusParameters.fds.max),h?h=Sn(h,this._focusParameters.fds.min,this._focusParameters.fds.step,this._focusParameters.fds.max):(h=Sn(Math.sqrt((r||this._focusParameters.fds.step)*(s||this._focusParameters.fds.step)),this._focusParameters.fds.min,this._focusParameters.fds.step,this._focusParameters.fds.max),p=yield G(this,Se,"m",kn).call(this,i,h)),p<=o&&p<=l?C=3:o<l&&o<p?C=1:l<o&&l<p&&(C=2),(s-r)/2<=this._focusParameters.fds.step)return 3===C||(1===C?yield G(this,Qe,"f").applyConstraints({advanced:[{focusMode:"manual",focusDistance:r}]}):2===C&&(yield G(this,Qe,"f").applyConstraints({advanced:[{focusMode:"manual",focusDistance:s}]}))),!0;if(1===C)return yield G(this,Se,"m",n).call(this,i,r,o,h,p);if(2===C)return yield G(this,Se,"m",n).call(this,i,h,p,s,l);if(3!==C)return o=yield G(this,Se,"m",kn).call(this,i,r),l=yield G(this,Se,"m",kn).call(this,i,s),yield G(this,Se,"m",n).call(this,i,r,o,s,l);let D=Sn(Math.sqrt((r||this._focusParameters.fds.step)*(h||this._focusParameters.fds.step)),this._focusParameters.fds.min,this._focusParameters.fds.step,this._focusParameters.fds.max),T=Sn(Math.sqrt((s||this._focusParameters.fds.step)*(h||this._focusParameters.fds.step)),this._focusParameters.fds.min,this._focusParameters.fds.step,this._focusParameters.fds.max);if(Math.abs(1/this._focusParameters.oldDistance-1/D)<=Math.abs(1/this._focusParameters.oldDistance-1/T)){let A=yield G(this,Se,"m",kn).call(this,i,D);if(A<p)return yield G(this,Se,"m",n).call(this,i,r,o,h,p,D,A);if(A==p)return yield G(this,Se,"m",n).call(this,i,D,A,h,p);let M=yield G(this,Se,"m",kn).call(this,i,T);if(A>p&&p<M)return yield G(this,Se,"m",n).call(this,i,D,A,T,M,h,p);if(p==M)return yield G(this,Se,"m",n).call(this,i,h,p,T,M);if(p>M)return yield G(this,Se,"m",n).call(this,i,h,p,s,l,T,M)}else{let A=yield G(this,Se,"m",kn).call(this,i,T);if(p>A)return yield G(this,Se,"m",n).call(this,i,h,p,s,l,T,A);if(p==A)return yield G(this,Se,"m",n).call(this,i,h,p,T,A);let M=yield G(this,Se,"m",kn).call(this,i,D);if(M>p&&p<A)return yield G(this,Se,"m",n).call(this,i,D,M,T,A,h,p);if(M==p)return yield G(this,Se,"m",n).call(this,i,D,M,h,p);if(M<p)return yield G(this,Se,"m",n).call(this,i,r,o,h,p,D,M)}return!1});function n(i,r,o,s,l,h,p){return t.apply(this,arguments)}return n}(),kp=function(){var t=J(function*(n,i,r,o,s){var h,l=this;if(1==this._focusParameters.isDoingFocus)return!1;if(!n||"string"!=typeof n.x||"string"!=typeof n.y)throw new Error("Invalid 'centerPoint'.");if(!i||"string"!=typeof i)throw new Error("Invalid 'width'.");if(!r||"string"!=typeof r)throw new Error("Invalid 'height'.");const p=this.getResolution();let C=0,D=0;if(n.x.endsWith("px"))C=parseFloat(n.x);else{if(!n.x.endsWith("%"))throw new Error("Invalid 'centerPoint'.");C=parseFloat(n.x)/100*p.width}if(n.y.endsWith("px"))D=parseFloat(n.y);else{if(!n.y.endsWith("%"))throw new Error("Invalid 'centerPoint'.");D=parseFloat(n.y)/100*p.height}if(isNaN(C)||isNaN(D)||C<0||C>p.width||D<0||D>p.height)throw new Error("Invalid 'centerPoint'.");let T=0;if(i.endsWith("px"))T=parseFloat(i);else{if(!i.endsWith("%"))throw new Error("Invalid 'width'.");T=parseFloat(i)/100*p.width}if(isNaN(T)||T<0)throw new Error("Invalid 'width'.");let A=0;if(r.endsWith("px"))A=parseFloat(r);else{if(!r.endsWith("%"))throw new Error("Invalid 'height'.");A=parseFloat(r)/100*p.height}if(isNaN(A)||A<0)throw new Error("Invalid 'height'.");if(1!==G(this,nr,"f")){const B=G(this,nr,"f"),k=G(this,ir,"f");T/=B,A/=B,C=(1-1/B)*k.x+C/B,D=(1-1/B)*k.y+D/B}if(!this._focusSupported)throw new Error("Manual focus unsupported.");if(!this._focusParameters.fds&&(this._focusParameters.fds=null===(h=this.getCameraCapabilities())||void 0===h?void 0:h.focusDistance,!this._focusParameters.fds))throw this._focusSupported=!1,new Error("Manual focus unsupported.");null==this._focusParameters.kTimeout&&(this._focusParameters.kTimeout=(this._focusParameters.maxTimeout-this._focusParameters.minTimeout)/(1/this._focusParameters.fds.min-1/this._focusParameters.fds.max)),this._focusParameters.isDoingFocus=1;const M={focusL:C,focusT:D,focusW:T,focusH:A,focusTaskId:++this._focusParameters.curFocusTaskId,timeStart:Date.now()},P=function(){var B=J(function*(k,U,V){try{(null==U||U<l._focusParameters.fds.min)&&(U=l._focusParameters.fds.min),(null==V||V>l._focusParameters.fds.max)&&(V=l._focusParameters.fds.max),l._focusParameters.oldDistance=null;let q=Sn(Math.sqrt(V*(U||l._focusParameters.fds.step)),l._focusParameters.fds.min,l._focusParameters.fds.step,l._focusParameters.fds.max),ce=Sn(Math.sqrt((U||l._focusParameters.fds.step)*q),l._focusParameters.fds.min,l._focusParameters.fds.step,l._focusParameters.fds.max),ge=Sn(Math.sqrt(q*V),l._focusParameters.fds.min,l._focusParameters.fds.step,l._focusParameters.fds.max),ve=yield G(l,Se,"m",kn).call(l,k,ge),me=yield G(l,Se,"m",kn).call(l,k,ce),S=yield G(l,Se,"m",kn).call(l,k,q);if(me>S&&S<ve){const we=yield G(l,Se,"m",Fs).call(l,k,ce,me,ge,ve,q,S);return l._focusParameters.isDoingFocus=0,we}if(me<S&&me<ve){let we=yield G(l,Se,"m",kn).call(l,k,U);const Me=yield G(l,Se,"m",Fs).call(l,k,U,we,q,S,ce,me);return l._focusParameters.isDoingFocus=0,Me}if(S>ve&&me>ve){let we=yield G(l,Se,"m",kn).call(l,k,V);const Me=yield G(l,Se,"m",Fs).call(l,k,q,S,V,we,ge,ve);return l._focusParameters.isDoingFocus=0,Me}if(me==S&&S<ve){const we=yield G(l,Se,"m",Fs).call(l,k,ce,me,q,S);return l._focusParameters.isDoingFocus=0,we}if(S==ve&&me>S){const we=yield G(l,Se,"m",Fs).call(l,k,q,S,ge,ve);return l._focusParameters.isDoingFocus=0,we}return P(k,U,V)}catch(q){if("DeprecatedTaskError"!==q.name)throw q}});return function(U,V,q){return B.apply(this,arguments)}}();return P(M,o,s)});return function(i,r,o,s,l){return t.apply(this,arguments)}}(),Bp=function(t){if("opened"!==this.state)throw new Error("Video is not playing.");if(!t||"string"!=typeof t.x||"string"!=typeof t.y)throw new Error("Invalid 'center'.");const n=this.getResolution();let i=0,r=0;if(t.x.endsWith("px"))i=parseFloat(t.x);else{if(!t.x.endsWith("%"))throw new Error("Invalid scale center.");i=parseFloat(t.x)/100*n.width}if(t.y.endsWith("px"))r=parseFloat(t.y);else{if(!t.y.endsWith("%"))throw new Error("Invalid scale center.");r=parseFloat(t.y)/100*n.height}if(isNaN(i)||isNaN(r))throw new Error("Invalid scale center.");qe(this,ir,{x:i,y:r},"f")},iD=function(t){if("opened"!==this.state)throw new Error("Video is not playing.");const n=this.getResolution();return t&&t.x==n.width/2&&t.y==n.height/2},Ve.browserInfo=Rt,Ve.onWarning=null===(Rp=window?.console)||void 0===Rp?void 0:Rp.warn;class sr{constructor(n){vl.add(this),nd.set(this,void 0),Ps.set(this,0),ho.set(this,void 0),id.set(this,0),Ns.set(this,!1),Te(this,nd,n,"f")}startCharging(){R(this,Ns,"f")||(sr._onLog&&sr._onLog("start charging."),R(this,vl,"m",oD).call(this),Te(this,Ns,!0,"f"))}stopCharging(){R(this,ho,"f")&&clearTimeout(R(this,ho,"f")),R(this,Ns,"f")&&(sr._onLog&&sr._onLog("stop charging."),Te(this,Ps,Date.now()-R(this,id,"f"),"f"),Te(this,Ns,!1,"f"))}}nd=new WeakMap,Ps=new WeakMap,ho=new WeakMap,id=new WeakMap,Ns=new WeakMap,vl=new WeakSet,rD=function(){Xt.cfd(1),sr._onLog&&sr._onLog("charge 1.")},oD=function t(){0==R(this,Ps,"f")&&R(this,vl,"m",rD).call(this),Te(this,id,Date.now(),"f"),R(this,ho,"f")&&clearTimeout(R(this,ho,"f")),Te(this,ho,setTimeout(()=>{Te(this,Ps,0,"f"),R(this,vl,"m",t).call(this)},R(this,nd,"f")-R(this,Ps,"f")),"f")};const lD=new Map([[Oe.IPF_GRAYSCALED,Ke.GREY],[Oe.IPF_ABGR_8888,Ke.RGBA],[Oe.IPF_ARGB_8888,Ke.BGRA]]),cD=new Map([[Ke.GREY,Oe.IPF_GRAYSCALED],[Ke.RGBA,Oe.IPF_ABGR_8888],[Ke.BGRA,Oe.IPF_ARGB_8888]]),Wp="function"==typeof BigInt?{BF_NULL:BigInt(0),BF_ALL:BigInt(0x10000000000000000),BF_DEFAULT:BigInt(4265345023),BF_ONED:BigInt(3147775),BF_GS1_DATABAR:BigInt(260096),BF_CODE_39:BigInt(1),BF_CODE_128:BigInt(2),BF_CODE_93:BigInt(4),BF_CODABAR:BigInt(8),BF_ITF:BigInt(16),BF_EAN_13:BigInt(32),BF_EAN_8:BigInt(64),BF_UPC_A:BigInt(128),BF_UPC_E:BigInt(256),BF_INDUSTRIAL_25:BigInt(512),BF_CODE_39_EXTENDED:BigInt(1024),BF_GS1_DATABAR_OMNIDIRECTIONAL:BigInt(2048),BF_GS1_DATABAR_TRUNCATED:BigInt(4096),BF_GS1_DATABAR_STACKED:BigInt(8192),BF_GS1_DATABAR_STACKED_OMNIDIRECTIONAL:BigInt(16384),BF_GS1_DATABAR_EXPANDED:BigInt(32768),BF_GS1_DATABAR_EXPANDED_STACKED:BigInt(65536),BF_GS1_DATABAR_LIMITED:BigInt(131072),BF_PATCHCODE:BigInt(262144),BF_CODE_32:BigInt(16777216),BF_PDF417:BigInt(33554432),BF_QR_CODE:BigInt(67108864),BF_DATAMATRIX:BigInt(134217728),BF_AZTEC:BigInt(268435456),BF_MAXICODE:BigInt(536870912),BF_MICRO_QR:BigInt(1073741824),BF_MICRO_PDF417:BigInt(524288),BF_GS1_COMPOSITE:BigInt(2147483648),BF_MSI_CODE:BigInt(1048576),BF_CODE_11:BigInt(2097152),BF_TWO_DIGIT_ADD_ON:BigInt(4194304),BF_FIVE_DIGIT_ADD_ON:BigInt(8388608),BF_MATRIX_25:BigInt(68719476736),BF_POSTALCODE:BigInt(0x3f0000000000000),BF_NONSTANDARD_BARCODE:BigInt(4294967296),BF_USPSINTELLIGENTMAIL:BigInt(4503599627370496),BF_POSTNET:BigInt(9007199254740992),BF_PLANET:BigInt(0x40000000000000),BF_AUSTRALIANPOST:BigInt(0x80000000000000),BF_RM4SCC:BigInt(72057594037927940),BF_KIX:BigInt(0x200000000000000),BF_DOTCODE:BigInt(8589934592),BF_PHARMACODE_ONE_TRACK:BigInt(17179869184),BF_PHARMACODE_TWO_TRACK:BigInt(34359738368),BF_PHARMACODE:BigInt(51539607552)}:{BF_NULL:"0x00",BF_ALL:"0xFFFFFFFFFFFFFFFF",BF_DEFAULT:"0xFE3BFFFF",BF_ONED:"0x003007FF",BF_GS1_DATABAR:"0x0003F800",BF_CODE_39:"0x1",BF_CODE_128:"0x2",BF_CODE_93:"0x4",BF_CODABAR:"0x8",BF_ITF:"0x10",BF_EAN_13:"0x20",BF_EAN_8:"0x40",BF_UPC_A:"0x80",BF_UPC_E:"0x100",BF_INDUSTRIAL_25:"0x200",BF_CODE_39_EXTENDED:"0x400",BF_GS1_DATABAR_OMNIDIRECTIONAL:"0x800",BF_GS1_DATABAR_TRUNCATED:"0x1000",BF_GS1_DATABAR_STACKED:"0x2000",BF_GS1_DATABAR_STACKED_OMNIDIRECTIONAL:"0x4000",BF_GS1_DATABAR_EXPANDED:"0x8000",BF_GS1_DATABAR_EXPANDED_STACKED:"0x10000",BF_GS1_DATABAR_LIMITED:"0x20000",BF_PATCHCODE:"0x00040000",BF_CODE_32:"0x01000000",BF_PDF417:"0x02000000",BF_QR_CODE:"0x04000000",BF_DATAMATRIX:"0x08000000",BF_AZTEC:"0x10000000",BF_MAXICODE:"0x20000000",BF_MICRO_QR:"0x40000000",BF_MICRO_PDF417:"0x00080000",BF_GS1_COMPOSITE:"0x80000000",BF_MSI_CODE:"0x100000",BF_CODE_11:"0x200000",BF_TWO_DIGIT_ADD_ON:"0x400000",BF_FIVE_DIGIT_ADD_ON:"0x800000",BF_MATRIX_25:"0x1000000000",BF_POSTALCODE:"0x3F0000000000000",BF_NONSTANDARD_BARCODE:"0x100000000",BF_USPSINTELLIGENTMAIL:"0x10000000000000",BF_POSTNET:"0x20000000000000",BF_PLANET:"0x40000000000000",BF_AUSTRALIANPOST:"0x80000000000000",BF_RM4SCC:"0x100000000000000",BF_KIX:"0x200000000000000",BF_DOTCODE:"0x200000000",BF_PHARMACODE_ONE_TRACK:"0x400000000",BF_PHARMACODE_TWO_TRACK:"0x800000000",BF_PHARMACODE:"0xC00000000"};class We extends Xn{static set _onLog(n){Te(We,jp,n,"f",Vp),Ve._onLog=n,sr._onLog=n}static get _onLog(){return R(We,jp,"f",Vp)}static detectEnvironment(){return J(function*(){return yield J(function*(){return{wasm:Dk,worker:bk,getUserMedia:kI,camera:yield Sk(),browser:on.browser,version:on.version,OS:on.OS}})()})()}static testCameraAccess(){return J(function*(){const n=yield Ve.testCameraAccess();return n.ok?{ok:!0,message:"Successfully accessed the camera."}:"InsecureContext"===n.errorName?{ok:!1,message:"Insecure context."}:"OverconstrainedError"===n.errorName||"NotFoundError"===n.errorName?{ok:!1,message:"No camera detected."}:"NotAllowedError"===n.errorName?{ok:!1,message:"No permission to access camera."}:"AbortError"===n.errorName?{ok:!1,message:"Some problem occurred which prevented the device from being used."}:"NotReadableError"===n.errorName?{ok:!1,message:"A hardware error occurred."}:"SecurityError"===n.errorName?{ok:!1,message:"User media support is disabled."}:{ok:!1,message:n.errorMessage}})()}static createInstance(n){return J(function*(){var i,r;if(n&&!(n instanceof Ut))throw new TypeError("Invalid view.");if(null!==(i=bn.license)&&void 0!==i&&i.LicenseManager){if(null===(r=bn.license)||void 0===r||!r.LicenseManager.bCallInitLicense)throw new Error("License is not set.");yield Xt.loadWasm(["license"]),yield bn.license.dynamsoft()}const o=new We(n);return We.onWarning&&(location&&"file:"===location.protocol?setTimeout(()=>{We.onWarning&&We.onWarning({id:1,message:"The page is opened over file:// and Dynamsoft Camera Enhancer may not work properly. Please open the page via https://."})},0):!1!==window.isSecureContext&&navigator&&navigator.mediaDevices&&navigator.mediaDevices.getUserMedia||setTimeout(()=>{We.onWarning&&We.onWarning({id:2,message:"Dynamsoft Camera Enhancer may not work properly in a non-secure context. Please open the page via https://."})},0)),o})()}get video(){return R(this,be,"f").getVideoEl()}set videoSrc(n){if(!R(this,be,"f"))throw new Error("Camera manager is null.");R(this,xe,"f")&&(R(this,xe,"f")._hideDefaultSelection=!0),R(this,be,"f").videoSrc=n}get videoSrc(){var n;return null===(n=R(this,be,"f"))||void 0===n?void 0:n.videoSrc}set ifSaveLastUsedCamera(n){if(!R(this,be,"f"))throw new Error("Camera manager is null.");R(this,be,"f").ifSaveLastUsedCamera=n}get ifSaveLastUsedCamera(){var n;return null===(n=R(this,be,"f"))||void 0===n?void 0:n.ifSaveLastUsedCamera}set ifSkipCameraInspection(n){if(!R(this,be,"f"))throw new Error("Camera manager is null.");R(this,be,"f").ifSkipCameraInspection=n}get ifSkipCameraInspection(){var n;return null===(n=R(this,be,"f"))||void 0===n?void 0:n.ifSkipCameraInspection}set cameraOpenTimeout(n){if(!R(this,be,"f"))throw new Error("Camera manager is null.");R(this,be,"f").cameraOpenTimeout=n}get cameraOpenTimeout(){var n;return null===(n=R(this,be,"f"))||void 0===n?void 0:n.cameraOpenTimeout}set singleFrameMode(n){if(!["disabled","image","camera"].includes(n))throw new Error("Invalid value.");if(this.isOpen())throw new Error("It is not allowed to change `singleFrameMode` when the camera is open.");Te(this,rd,n,"f")}get singleFrameMode(){return R(this,rd,"f")}get _isFetchingStarted(){return R(this,or,"f")}get disposed(){return R(this,Up,"f")}constructor(n){var i;if(super(),i=this,Je.add(this),be.set(this,void 0),xe.set(this,void 0),yl.set(this,"closed"),rr.set(this,void 0),fo.set(this,!1),rd.set(this,void 0),this._onCameraSelChange=J(function*(){i.isOpen()&&R(i,xe,"f")&&!R(i,xe,"f").disposed&&(yield i.selectCamera(R(i,xe,"f")._selCam.value))}),this._onResolutionSelChange=J(function*(){if(!i.isOpen()||!R(i,xe,"f")||R(i,xe,"f").disposed)return;let r,o;if(R(i,xe,"f")._selRsl&&-1!=R(i,xe,"f")._selRsl.selectedIndex){let s=R(i,xe,"f")._selRsl.options[R(i,xe,"f")._selRsl.selectedIndex];r=parseInt(s.getAttribute("data-width")),o=parseInt(s.getAttribute("data-height"))}yield i.setResolution({width:r,height:o})}),this._onCloseBtnClick=J(function*(){i.isOpen()&&R(i,xe,"f")&&!R(i,xe,"f").disposed&&i.close()}),od.set(this,(r,o,s,l)=>{const h=Date.now(),p={sx:l.x,sy:l.y,sWidth:l.width,sHeight:l.height,dWidth:l.width,dHeight:l.height},C=Math.max(p.dWidth,p.dHeight);if(this.canvasSizeLimit&&C>this.canvasSizeLimit){const A=this.canvasSizeLimit/C;p.dWidth>p.dHeight?(p.dWidth=this.canvasSizeLimit,p.dHeight=Math.round(p.dHeight*A)):(p.dWidth=Math.round(p.dWidth*A),p.dHeight=this.canvasSizeLimit)}const D=R(this,be,"f").imageDataGetter.getImageData(r,o,s,p,{pixelFormat:lD.get(this.getPixelFormat())});let T=null;if(D){const A=Date.now();let M;M=D.pixelFormat===Ke.GREY?D.width:4*D.width;let P=!0;0===p.sx&&0===p.sy&&p.sWidth===o&&p.sHeight===s&&(P=!1),T={bytes:D.data,width:D.width,height:D.height,stride:M,format:cD.get(D.pixelFormat),tag:{imageId:this._imageId==Number.MAX_VALUE?this._imageId=0:++this._imageId,type:Iu.ITT_FILE_IMAGE,isCropped:P,cropRegion:{left:l.x,top:l.y,right:l.x+l.width,bottom:l.y+l.height,isMeasuredInPercentage:!1},originalWidth:o,originalHeight:s,currentWidth:D.width,currentHeight:D.height,timeSpent:A-h,timeStamp:A},toCanvas:R(this,sd,"f"),isDCEFrame:!0}}return T}),this._onSingleFrameAcquired=r=>{let o;o=R(this,xe,"f")?R(this,xe,"f").getConvertedRegion():Fu.convert(R(this,go,"f"),r.width,r.height),o||(o={x:0,y:0,width:r.width,height:r.height});const s=R(this,od,"f").call(this,r,r.width,r.height,o);R(this,rr,"f").fire("singleFrameAcquired",[s],{async:!1,copy:!1})},sd.set(this,function(){if(!(this.bytes instanceof Uint8Array||this.bytes instanceof Uint8ClampedArray))throw new TypeError("Invalid bytes.");if("number"!=typeof this.width||this.width<=0)throw new Error("Invalid width.");if("number"!=typeof this.height||this.height<=0)throw new Error("Invalid height.");const r=document.createElement("canvas");let o;if(r.width=this.width,r.height=this.height,this.format===Oe.IPF_GRAYSCALED){o=new Uint8ClampedArray(this.width*this.height*4);for(let s=0;s<o.length;s+=4)o[s]=this.bytes[s/4],o[s+1]=this.bytes[s/4],o[s+2]=this.bytes[s/4],o[s+3]=255}else o=new Uint8ClampedArray(this.bytes.buffer);return r.getContext("2d").putImageData(new ImageData(o,this.width,this.height),0,0),r}),wl.set(this,void 0),go.set(this,void 0),ad.set(this,Oe.IPF_ABGR_8888),or.set(this,!1),this._imageId=-1,Bn.set(this,void 0),this.fetchInterval=0,mt.set(this,{enhancedFocus:!1,autoZoom:!1,tapToFocus:!1}),ye.set(this,{minValue:1,maxValue:999,autoFocusFrameArray:[],autoFocusFrameLimit:[5,3],autoZoomDetectionArea:.5,autoZoomTargetBorder:.9,autoZoomIdealArea:[0,.05],autoZoomInFrameArray:[],autoZoomInFrameLimit:[5,3],autoZoomInMaxTimes:5,autoZoomInMinStep:Math.pow(10,.2),autoZoomInIdealModuleSize:6,autoZoomOutFrameCount:0,autoZoomOutFrameLimit:3,autoZoomOutStepRate:1/3,autoZoomOutStepRate_2:.05,autoZoomOutMinStep:2,frameArrayInIdealZoom:[],frameLimitInIdealZoom:[5,3],nextActionInIdealZoom:"focus",noIntermediateResultsCount:[],enableZoomOutInIdealZoom:!1}),Ti.set(this,void 0),Up.set(this,!1),this.isCameraEnhancer=!0,n&&!(n instanceof Ut))throw new TypeError("Invalid view.");Te(this,rr,new WI,"f"),Te(this,be,new Ve,"f"),this._imageDataGetter=R(this,be,"f").imageDataGetter,R(this,be,"f").updateVideoElWhenSoftwareScaled=()=>{if(!this.video)return;const r=R(this,be,"f").getSoftwareScale();if(r<1)throw new RangeError("Invalid scale value.");R(this,xe,"f")&&!R(this,xe,"f").disposed?(this.video.style.transform=1===r?"":`scale(${r})`,R(this,xe,"f")._updateVideoContainer()):this.video.style.transform=1===r?"":`scale(${r})`},["iPhone","iPad","Android","HarmonyOS"].includes(on.OS)?R(this,be,"f").setResolution(1280,720):R(this,be,"f").setResolution(1920,1080),this.singleFrameMode=navigator&&navigator.mediaDevices&&navigator.mediaDevices.getUserMedia?"disabled":"image",n&&this.setCameraView(n),this._on("before:camera:change",()=>{R(this,Ti,"f").stopCharging();const r=R(this,xe,"f");r&&!r.disposed&&(r._startLoading(),r.clearAllInnerDrawingItems())}),this._on("camera:changed",()=>{this.clearBuffer()}),this._on("before:resolution:change",()=>{const r=R(this,xe,"f");r&&!r.disposed&&(r._startLoading(),r.clearAllInnerDrawingItems())}),this._on("resolution:changed",()=>{this.clearBuffer(),n.eventHandler.fire("content:updated",null,{async:!1})}),this._on("paused",()=>{R(this,Ti,"f").stopCharging(),R(this,xe,"f")}),this._on("resumed",()=>{R(this,xe,"f")}),this._on("tapfocus",()=>{R(this,mt,"f").tapToFocus&&R(this,Ti,"f").startCharging()}),this._intermediateResultReceiver={},this._intermediateResultReceiver.onTaskResultsReceived=function(){var r=J(function*(o,s){var l,h,p,C;if(R(i,Je,"m",_t).call(i)||!i.isOpen()||i.isPaused())return;const D=o.intermediateResultUnits;We._onLog&&(We._onLog("intermediateResultUnits:"),We._onLog(D));let T=!1,A=!1;for(let M of D){if(M.unitType===ms.IRUT_DECODED_BARCODES&&M.decodedBarcodes.length){T=!0;break}M.unitType===ms.IRUT_LOCALIZED_BARCODES&&M.localizedBarcodes.length&&(A=!0)}if(We._onLog&&(We._onLog("hasLocalizedBarcodes:"),We._onLog(A)),R(i,mt,"f").autoZoom||R(i,mt,"f").enhancedFocus)if(T)R(i,ye,"f").autoZoomInFrameArray.length=0,R(i,ye,"f").autoZoomOutFrameCount=0,R(i,ye,"f").frameArrayInIdealZoom.length=0,R(i,mt,"f").autoZoom&&R(i,mt,"f").enhancedFocus&&(R(i,ye,"f").nextActionInIdealZoom="focus"),R(i,ye,"f").autoFocusFrameArray.length=0,R(i,ye,"f").noIntermediateResultsCount=0;else{const M=function(){var B=J(function*(k){yield i.setZoom(k),R(i,mt,"f").autoZoom&&R(i,Ti,"f").startCharging()});return function(U){return B.apply(this,arguments)}}(),P=function(){var B=J(function*(k){yield i.setFocus(k),R(i,mt,"f").enhancedFocus&&R(i,Ti,"f").startCharging()});return function(U){return B.apply(this,arguments)}}();if(A){const B=D[0].originalImageTag,k=(null===(l=B.cropRegion)||void 0===l?void 0:l.left)||0,U=(null===(h=B.cropRegion)||void 0===h?void 0:h.top)||0,V=null!==(p=B.cropRegion)&&void 0!==p&&p.right?B.cropRegion.right-k:B.originalWidth,q=null!==(C=B.cropRegion)&&void 0!==C&&C.bottom?B.cropRegion.bottom-U:B.originalHeight,ce=B.currentWidth,ge=B.currentHeight;let ve;{let me,S,we,Me,nt;{const g=i.video.videoWidth*(1-R(i,ye,"f").autoZoomDetectionArea)/2,v=i.video.videoWidth*(1+R(i,ye,"f").autoZoomDetectionArea)/2,a=v,c=g,_=i.video.videoHeight*(1-R(i,ye,"f").autoZoomDetectionArea)/2,I=_,y=i.video.videoHeight*(1+R(i,ye,"f").autoZoomDetectionArea)/2;nt=[{x:g,y:_},{x:v,y:I},{x:a,y},{x:c,y}]}We._onLog&&(We._onLog("detectionArea:"),We._onLog(nt));const m=[];{const g=(v,a)=>{const c=(I,y)=>{if(!I&&!y)throw new Error("Invalid arguments.");return function(w,b,x){let O=!1;const F=w.length;if(F<=2)return!1;for(let L=0;L<F;L++){const N=w[L],j=w[(L+1)%F];if(xk(N,j,{x:b,y:x}))return!0;yp(N.y-x)>0!=yp(j.y-x)>0&&yp(b-(x-N.y)*(N.x-j.x)/(N.y-j.y)-N.x)<0&&(O=!O)}return O}(y,I.x,I.y)},_=(I,y)=>!!(Nu([I[0],I[1]],[I[2],I[3]],[y[0].x,y[0].y],[y[1].x,y[1].y])||Nu([I[0],I[1]],[I[2],I[3]],[y[1].x,y[1].y],[y[2].x,y[2].y])||Nu([I[0],I[1]],[I[2],I[3]],[y[2].x,y[2].y],[y[3].x,y[3].y])||Nu([I[0],I[1]],[I[2],I[3]],[y[3].x,y[3].y],[y[0].x,y[0].y]));return!!(c({x:v[0].x,y:v[0].y},a)||c({x:v[1].x,y:v[1].y},a)||c({x:v[2].x,y:v[2].y},a)||c({x:v[3].x,y:v[3].y},a))||!!(c({x:a[0].x,y:a[0].y},v)||c({x:a[1].x,y:a[1].y},v)||c({x:a[2].x,y:a[2].y},v)||c({x:a[3].x,y:a[3].y},v))||!!(_([a[0].x,a[0].y,a[1].x,a[1].y],v)||_([a[1].x,a[1].y,a[2].x,a[2].y],v)||_([a[2].x,a[2].y,a[3].x,a[3].y],v)||_([a[3].x,a[3].y,a[0].x,a[0].y],v))};for(let v of D)if(v.unitType===ms.IRUT_LOCALIZED_BARCODES)for(let a of v.localizedBarcodes){if(!a)continue;const c=a.location.points;c.forEach(_=>{Ut._transformCoordinates(_,k,U,V,q,ce,ge)}),g(nt,c)&&m.push(a)}if(We._debug&&R(i,xe,"f")){const v=i.__layer||(i.__layer=R(i,xe,"f")._createDrawingLayer(99));v.clearDrawingItems();const a=i.__styleId2||(i.__styleId2=de.createDrawingStyle({strokeStyle:"red"}));for(let c of D)if(c.unitType===ms.IRUT_LOCALIZED_BARCODES)for(let _ of c.localizedBarcodes){if(!_)continue;const y=new ku({points:_.location.points},a);v.addDrawingItems([y])}}}if(We._onLog&&(We._onLog("intersectedResults:"),We._onLog(m)),!m.length)return;let f;if(m.length){let g=m.filter(v=>v.possibleFormats==Wp.BF_QR_CODE||v.possibleFormats==Wp.BF_DATAMATRIX);if(g.length||(g=m.filter(v=>v.possibleFormats==Wp.BF_ONED),g.length||(g=m)),g.length){const v=c=>{const _=c.location.points,I=(_[0].x+_[1].x+_[2].x+_[3].x)/4,y=(_[0].y+_[1].y+_[2].y+_[3].y)/4;return(I-ce/2)*(I-ce/2)+(y-ge/2)*(y-ge/2)};f=g[0];let a=v(f);if(1!=g.length)for(let c=1;c<g.length;c++){const _=v(g[c]);(g[c].confidence>1.1*f.confidence||g[c].confidence>.9*f.confidence&&_<a)&&(f=g[c],a=_)}}}if(We._onLog&&(We._onLog("highPriorityResult:"),We._onLog(f)),f){const g=f.location.points;me=Math.min(g[0].x,g[1].x,g[2].x,g[3].x),S=Math.max(g[0].x,g[1].x,g[2].x,g[3].x),we=Math.min(g[0].y,g[1].y,g[2].y,g[3].y),Me=Math.max(g[0].y,g[1].y,g[2].y,g[3].y),ve={points:[{x:me,y:we},{x:S,y:we},{x:S,y:Me},{x:me,y:Me}],result:f}}}if(We._onLog&&(We._onLog("boundingRect:"),We._onLog(ve)),!ve)return;if(We._debug&&R(i,xe,"f")&&ve?.points){const me=i.__layer||(i.__layer=R(i,xe,"f")._createDrawingLayer(99)),S=i.__styleId1||(i.__styleId1=de.createDrawingStyle({strokeStyle:"blue"})),we=new ku({points:ve.points},S);me.addDrawingItems([we])}if(R(i,ye,"f").autoZoomOutFrameCount=0,R(i,ye,"f").noIntermediateResultsCount=0,R(i,mt,"f").autoZoom){const me=R(i,ye,"f").autoZoomIdealArea[1];let S=(1-R(i,ye,"f").autoZoomTargetBorder)/2;const we=ve.points[0].x/V,Me=(V-ve.points[2].x)/V,nt=ve.points[0].y/q,m=(q-ve.points[2].y)/q;if(we>me&&Me>me&&nt>me&&m>me&&ve.result.moduleSize<R(i,ye,"f").autoZoomInIdealModuleSize){if(R(i,ye,"f").autoZoomInFrameArray.push(!0),R(i,ye,"f").autoZoomInFrameArray.splice(0,R(i,ye,"f").autoZoomInFrameArray.length-R(i,ye,"f").autoZoomInFrameLimit[0]),R(i,ye,"f").frameArrayInIdealZoom.length=0,R(i,mt,"f").enhancedFocus&&(R(i,ye,"f").nextActionInIdealZoom="focus",P({mode:"continuous"}).catch(()=>{})),R(i,ye,"f").autoZoomInFrameArray.filter(f=>!0===f).length>=R(i,ye,"f").autoZoomInFrameLimit[1]){R(i,ye,"f").autoZoomInFrameArray.length=0;const f=[(.5-S)/(.5-we),(.5-S)/(.5-Me),(.5-S)/(.5-nt),(.5-S)/(.5-m)].filter(_=>_>0),g=Math.min(...f,R(i,ye,"f").autoZoomInIdealModuleSize/ve.result.moduleSize),v=i.getZoomSettings().factor;let a=Math.max(Math.pow(v*g,1/R(i,ye,"f").autoZoomInMaxTimes),R(i,ye,"f").autoZoomInMinStep);a=Math.min(a,g);let c=v*a;c=Math.max(R(i,ye,"f").minValue,c),c=Math.min(R(i,ye,"f").maxValue,c);try{yield M({factor:c})}catch(_){console.warn(_.message||_)}i.clearBuffer()}}else if(R(i,ye,"f").autoZoomInFrameArray.length=0,R(i,ye,"f").frameArrayInIdealZoom.push(!0),R(i,ye,"f").frameArrayInIdealZoom.splice(0,R(i,ye,"f").frameArrayInIdealZoom.length-R(i,ye,"f").frameLimitInIdealZoom[0]),R(i,ye,"f").frameArrayInIdealZoom.filter(f=>!0===f).length>=R(i,ye,"f").frameLimitInIdealZoom[1])if(R(i,ye,"f").frameArrayInIdealZoom.length=0,"focus"===R(i,ye,"f").nextActionInIdealZoom&&R(i,mt,"f").enhancedFocus){const f=ve.points;try{yield P({mode:"manual",area:{centerPoint:{x:(f[0].x+f[2].x)/2+"px",y:(f[0].y+f[2].y)/2+"px"},width:f[2].x-f[0].x+"px",height:f[2].y-f[0].y+"px"}})}catch(g){console.warn(g.message||g)}i.clearBuffer()}else{if("zoomOut"!==R(i,ye,"f").nextActionInIdealZoom&&R(i,mt,"f").enhancedFocus)throw new Error("Invalid action.");if(R(i,ye,"f").enableZoomOutInIdealZoom){S=R(i,ye,"f").autoZoomIdealArea[1]+R(i,ye,"f").autoZoomOutStepRate_2;const f=[(.5-S)/(.5-we),(.5-S)/(.5-Me),(.5-S)/(.5-nt),(.5-S)/(.5-m)].filter(v=>v>0);let g=Math.min(...f)*i.getZoomSettings().factor;g=Math.max(R(i,ye,"f").minValue,g),g=Math.min(R(i,ye,"f").maxValue,g);try{yield M({factor:g})}catch(v){console.warn(v.message||v)}i.clearBuffer(),R(i,mt,"f").enhancedFocus&&(R(i,ye,"f").nextActionInIdealZoom="focus",P({mode:"continuous"}).catch(()=>{}))}}}if(!R(i,mt,"f").autoZoom&&R(i,mt,"f").enhancedFocus&&(R(i,ye,"f").autoFocusFrameArray.push(!0),R(i,ye,"f").autoFocusFrameArray.splice(0,R(i,ye,"f").autoFocusFrameArray.length-R(i,ye,"f").autoFocusFrameLimit[0]),R(i,ye,"f").autoFocusFrameArray.filter(me=>!0===me).length>=R(i,ye,"f").autoFocusFrameLimit[1])){R(i,ye,"f").autoFocusFrameArray.length=0;try{const me=ve.points;yield P({mode:"manual",area:{centerPoint:{x:(me[0].x+me[2].x)/2+"px",y:(me[0].y+me[2].y)/2+"px"},width:me[2].x-me[0].x+"px",height:me[2].y-me[0].y+"px"}})}catch(me){console.warn(me.message||me)}i.clearBuffer()}}else{if(R(i,ye,"f").noIntermediateResultsCount++,R(i,mt,"f").autoZoom){if(R(i,ye,"f").autoZoomInFrameArray.push(!1),R(i,ye,"f").autoZoomInFrameArray.splice(0,R(i,ye,"f").autoZoomInFrameArray.length-R(i,ye,"f").autoZoomInFrameLimit[0]),R(i,ye,"f").autoZoomOutFrameCount++,R(i,ye,"f").frameArrayInIdealZoom.push(!1),R(i,ye,"f").frameArrayInIdealZoom.splice(0,R(i,ye,"f").frameArrayInIdealZoom.length-R(i,ye,"f").frameLimitInIdealZoom[0]),R(i,ye,"f").autoZoomOutFrameCount>=R(i,ye,"f").autoZoomOutFrameLimit){R(i,ye,"f").autoZoomOutFrameCount=0;const B=i.getZoomSettings().factor;let k=B-Math.max((B-1)*R(i,ye,"f").autoZoomOutStepRate,R(i,ye,"f").autoZoomOutMinStep);k=Math.max(R(i,ye,"f").minValue,k),k=Math.min(R(i,ye,"f").maxValue,k);try{yield M({factor:k})}catch(U){console.warn(U.message||U)}i.clearBuffer()}R(i,mt,"f").enhancedFocus&&(R(i,ye,"f").nextActionInIdealZoom="focus",P({mode:"continuous"}).catch(()=>{}))}!R(i,mt,"f").autoZoom&&R(i,mt,"f").enhancedFocus&&(R(i,ye,"f").autoFocusFrameArray.length=0,P({mode:"continuous"}).catch(()=>{}))}}});return function(o,s){return r.apply(this,arguments)}}(),Te(this,Ti,new sr(1e4),"f")}setCameraView(n){if(!(n instanceof Ut))throw new TypeError("Invalid view.");if(n.disposed)throw new Error("The camera view has been disposed.");if(this.isOpen())throw new Error("It is not allowed to change camera view when the camera is open.");this.releaseCameraView(),n._singleFrameMode=this.singleFrameMode,n._onSingleFrameAcquired=this._onSingleFrameAcquired,this.videoSrc&&(R(this,xe,"f")._hideDefaultSelection=!0),R(this,Je,"m",_t).call(this)||R(this,be,"f").setVideoEl(n.getVideoElement()),Te(this,xe,n,"f"),this.addListenerToView()}getCameraView(){return R(this,xe,"f")}releaseCameraView(){R(this,xe,"f")&&(this.removeListenerFromView(),R(this,xe,"f").disposed||(R(this,xe,"f")._singleFrameMode="disabled",R(this,xe,"f")._onSingleFrameAcquired=null,R(this,xe,"f")._hideDefaultSelection=!1),R(this,be,"f").releaseVideoEl(),Te(this,xe,null,"f"))}addListenerToView(){if(!R(this,xe,"f"))return;if(R(this,xe,"f").disposed)throw new Error("'cameraView' has been disposed.");const n=R(this,xe,"f");R(this,Je,"m",_t).call(this)||this.videoSrc||(n._innerComponent&&(R(this,be,"f").tapFocusEventBoundEl=n._innerComponent),n._selCam&&n._selCam.addEventListener("change",this._onCameraSelChange),n._selRsl&&n._selRsl.addEventListener("change",this._onResolutionSelChange)),n._btnClose&&n._btnClose.addEventListener("click",this._onCloseBtnClick)}removeListenerFromView(){if(!R(this,xe,"f")||R(this,xe,"f").disposed)return;const n=R(this,xe,"f");R(this,be,"f").tapFocusEventBoundEl=null,n._selCam&&n._selCam.removeEventListener("change",this._onCameraSelChange),n._selRsl&&n._selRsl.removeEventListener("change",this._onResolutionSelChange),n._btnClose&&n._btnClose.removeEventListener("click",this._onCloseBtnClick)}getCameraState(){return R(this,Je,"m",_t).call(this)?R(this,yl,"f"):new Map([["closed","closed"],["opening","opening"],["opened","open"]]).get(R(this,be,"f").state)}isOpen(){return"open"===this.getCameraState()}getVideoEl(){return this.video}open(){var n=this;return J(function*(){const i=R(n,xe,"f");if(i?.disposed)throw new Error("'cameraView' has been disposed.");i&&(i._singleFrameMode=n.singleFrameMode,R(n,Je,"m",_t).call(n)?i._clickIptSingleFrameMode():(R(n,be,"f").setVideoEl(i.getVideoElement()),i._startLoading()));let r={width:0,height:0,deviceId:""};if(!R(n,Je,"m",_t).call(n)){try{yield R(n,be,"f").open()}catch(s){throw i&&i._stopLoading(),s}R(n,fo,"f")&&n.turnOnTorch().catch(()=>{});const o=n.getResolution();r.width=o.width,r.height=o.height,r.deviceId=n.getSelectedCamera().deviceId}return Te(n,yl,"open","f"),i&&(i._innerComponent.style.display="",R(n,Je,"m",_t).call(n)||(i._stopLoading(),i._renderCamerasInfo(n.getSelectedCamera(),R(n,be,"f")._arrCameras),i._renderResolutionInfo({width:r.width,height:r.height}),i.eventHandler.fire("content:updated",null,{async:!0}),i.eventHandler.fire("videoEl:resized",null,{async:!0}))),R(n,rr,"f").fire("opened",null,{target:n,async:!0}),r})()}close(){const n=R(this,xe,"f");if(n?.disposed)throw new Error("'cameraView' has been disposed.");this.stopFetching(),this.clearBuffer(),R(this,Je,"m",_t).call(this)||R(this,be,"f").close(),Te(this,yl,"closed","f"),R(this,Ti,"f").stopCharging(),n&&(n._innerComponent.style.display="none",R(this,Je,"m",_t).call(this)&&n._innerComponent.removeElement("content"),n._stopLoading()),R(this,rr,"f").fire("closed",null,{target:this,async:!0})}pause(){if(R(this,Je,"m",_t).call(this))throw new Error("'pause()' is invalid in 'singleFrameMode'.");R(this,be,"f").pause()}isPaused(){var n;return!R(this,Je,"m",_t).call(this)&&!0===(null===(n=this.video)||void 0===n?void 0:n.paused)}resume(){var n=this;return J(function*(){if(R(n,Je,"m",_t).call(n))throw new Error("'resume()' is invalid in 'singleFrameMode'.");yield R(n,be,"f").resume()})()}selectCamera(n){var i=this;return J(function*(){if(!n)throw new Error("Invalid value.");let r;r="string"==typeof n?n:n.deviceId,yield R(i,be,"f").setCamera(r),Te(i,fo,!1,"f");const o=i.getResolution(),s=R(i,xe,"f");return s&&!s.disposed&&(s._stopLoading(),s._renderCamerasInfo(i.getSelectedCamera(),R(i,be,"f")._arrCameras),s._renderResolutionInfo({width:o.width,height:o.height})),{width:o.width,height:o.height,deviceId:i.getSelectedCamera().deviceId}})()}getSelectedCamera(){return R(this,be,"f").getCamera()}getAllCameras(){var n=this;return J(function*(){return R(n,be,"f").getCameras()})()}setResolution(n){var i=this;return J(function*(){yield R(i,be,"f").setResolution(n.width,n.height),R(i,fo,"f")&&i.turnOnTorch().catch(()=>{});const r=i.getResolution(),o=R(i,xe,"f");return o&&!o.disposed&&(o._stopLoading(),o._renderResolutionInfo({width:r.width,height:r.height})),{width:r.width,height:r.height,deviceId:i.getSelectedCamera().deviceId}})()}getResolution(){return R(this,be,"f").getResolution()}getAvailableResolutions(){var n;return null===(n=R(this,be,"f"))||void 0===n?void 0:n.getResolutions()}_on(n,i){["opened","closed","singleframeacquired","frameaddedtobuffer"].includes(n.toLowerCase())?R(this,rr,"f").on(n,i):R(this,be,"f").on(n,i)}_off(n,i){["opened","closed","singleframeacquired","frameaddedtobuffer"].includes(n.toLowerCase())?R(this,rr,"f").off(n,i):R(this,be,"f").off(n,i)}on(n,i){const r=n.toLowerCase(),o=new Map([["cameraopen","opened"],["cameraclose","closed"],["camerachange","camera:changed"],["resolutionchange","resolution:changed"],["played","played"],["singleframeacquired","singleFrameAcquired"],["frameaddedtobuffer","frameAddedToBuffer"]]).get(r);if(!o)throw new Error("Invalid event.");this._on(o,i)}off(n,i){const r=n.toLowerCase(),o=new Map([["cameraopen","opened"],["cameraclose","closed"],["camerachange","camera:changed"],["resolutionchange","resolution:changed"],["played","played"],["singleframeacquired","singleFrameAcquired"],["frameaddedtobuffer","frameAddedToBuffer"]]).get(r);if(!o)throw new Error("Invalid event.");this._off(o,i)}getVideoSettings(){var n;return null===(n=R(this,be,"f"))||void 0===n?void 0:n.getMediaStreamConstraints()}updateVideoSettings(n){var i=this;return J(function*(){var r;yield null===(r=R(i,be,"f"))||void 0===r?void 0:r.setMediaStreamConstraints(n,!0)})()}getCapabilities(){var n;return null===(n=R(this,be,"f"))||void 0===n?void 0:n.getCameraCapabilities()}getCameraSettings(){return R(this,be,"f").getCameraSettings()}turnOnTorch(){var n=this;return J(function*(){var i;if(R(n,Je,"m",_t).call(n))throw new Error("'turnOnTorch()' is invalid in 'singleFrameMode'.");yield null===(i=R(n,be,"f"))||void 0===i?void 0:i.turnOnTorch(),Te(n,fo,!0,"f")})()}turnOffTorch(){var n=this;return J(function*(){var i;if(R(n,Je,"m",_t).call(n))throw new Error("'turnOffTorch()' is invalid in 'singleFrameMode'.");yield null===(i=R(n,be,"f"))||void 0===i?void 0:i.turnOffTorch(),Te(n,fo,!1,"f")})()}setColorTemperature(n){var i=this;return J(function*(){if(R(i,Je,"m",_t).call(i))throw new Error("'setColorTemperature()' is invalid in 'singleFrameMode'.");yield R(i,be,"f").setColorTemperature(n,!0)})()}getColorTemperature(){return R(this,be,"f").getColorTemperature()}setExposureCompensation(n){var i=this;return J(function*(){var r;if(R(i,Je,"m",_t).call(i))throw new Error("'setExposureCompensation()' is invalid in 'singleFrameMode'.");yield null===(r=R(i,be,"f"))||void 0===r?void 0:r.setExposureCompensation(n,!0)})()}getExposureCompensation(){var n;return null===(n=R(this,be,"f"))||void 0===n?void 0:n.getExposureCompensation()}_setZoom(n){var i=this;return J(function*(){var r;if(R(i,Je,"m",_t).call(i))throw new Error("'setZoom()' is invalid in 'singleFrameMode'.");yield null===(r=R(i,be,"f"))||void 0===r?void 0:r.setZoom(n)})()}setZoom(n){var i=this;return J(function*(){yield i._setZoom(n)})()}getZoomSettings(){var n;return null===(n=R(this,be,"f"))||void 0===n?void 0:n.getZoom()}resetZoom(){var n=this;return J(function*(){var i;if(R(n,Je,"m",_t).call(n))throw new Error("'resetZoom()' is invalid in 'singleFrameMode'.");yield null===(i=R(n,be,"f"))||void 0===i?void 0:i.resetZoom()})()}setFrameRate(n){var i=this;return J(function*(){var r;if(R(i,Je,"m",_t).call(i))throw new Error("'setFrameRate()' is invalid in 'singleFrameMode'.");yield null===(r=R(i,be,"f"))||void 0===r?void 0:r.setFrameRate(n,!0)})()}getFrameRate(){var n;return null===(n=R(this,be,"f"))||void 0===n?void 0:n.getFrameRate()}setFocus(n){var i=this;return J(function*(){var r;if(R(i,Je,"m",_t).call(i))throw new Error("'setFocus()' is invalid in 'singleFrameMode'.");yield null===(r=R(i,be,"f"))||void 0===r?void 0:r.setFocus(n,!0)})()}getFocusSettings(){var n;return null===(n=R(this,be,"f"))||void 0===n?void 0:n.getFocus()}setAutoZoomRange(n){R(this,ye,"f").minValue=n.min,R(this,ye,"f").maxValue=n.max}getAutoZoomRange(){return{min:R(this,ye,"f").minValue,max:R(this,ye,"f").maxValue}}enableEnhancedFeatures(n){var i=this;return J(function*(){var r,o;if(null===(o=null===(r=bn.license)||void 0===r?void 0:r.LicenseManager)||void 0===o||!o.bPassValidation)throw new Error("License is not verified, or license is invalid.");if(0!==Xt.bSupportDce4Module)throw new Error("Please set a license containing the DCE module.");n&Sr.EF_ENHANCED_FOCUS&&(R(i,mt,"f").enhancedFocus=!0),n&Sr.EF_AUTO_ZOOM&&(R(i,mt,"f").autoZoom=!0),n&Sr.EF_TAP_TO_FOCUS&&(R(i,mt,"f").tapToFocus=!0,R(i,be,"f").enableTapToFocus())})()}disableEnhancedFeatures(n){n&Sr.EF_ENHANCED_FOCUS&&(R(this,mt,"f").enhancedFocus=!1,this.setFocus({mode:"continuous"}).catch(()=>{})),n&Sr.EF_AUTO_ZOOM&&(R(this,mt,"f").autoZoom=!1,this.resetZoom().catch(()=>{})),n&Sr.EF_TAP_TO_FOCUS&&(R(this,mt,"f").tapToFocus=!1,R(this,be,"f").disableTapToFocus()),R(this,Je,"m",aD).call(this)&&R(this,Je,"m",sD).call(this)||R(this,Ti,"f").stopCharging()}_setScanRegion(n){if(null!=n&&!vp(n)&&!qi(n))throw TypeError("Invalid 'region'.");Te(this,go,n?JSON.parse(JSON.stringify(n)):null,"f"),R(this,xe,"f")&&!R(this,xe,"f").disposed&&R(this,xe,"f").setScanRegion(n)}setScanRegion(n){this._setScanRegion(n),R(this,xe,"f")&&!R(this,xe,"f").disposed&&(null===n?R(this,xe,"f").setScanRegionMaskVisible(!1):R(this,xe,"f").setScanRegionMaskVisible(!0))}getScanRegion(){return JSON.parse(JSON.stringify(R(this,go,"f")))}setErrorListener(n){if(!n)throw new TypeError("Invalid 'listener'");Te(this,wl,n,"f")}hasNextImageToFetch(){return!("open"!==this.getCameraState()||!R(this,be,"f").isVideoLoaded()||R(this,Je,"m",_t).call(this))}startFetching(){if(R(this,Je,"m",_t).call(this))throw Error("'startFetching()' is unavailable in 'singleFrameMode'.");R(this,or,"f")||(Te(this,or,!0,"f"),R(this,Je,"m",Gp).call(this))}stopFetching(){R(this,or,"f")&&(We._onLog&&We._onLog("DCE: stop fetching loop: "+Date.now()),R(this,Bn,"f")&&clearTimeout(R(this,Bn,"f")),Te(this,or,!1,"f"))}fetchImage(){if(R(this,Je,"m",_t).call(this))throw new Error("'fetchImage()' is unavailable in 'singleFrameMode'.");if(!this.video)throw new Error("The video element does not exist.");if(4!==this.video.readyState)throw new Error("The video is not loaded.");const n=this.getResolution();if(!n?.width||!n?.height)throw new Error("The video is not loaded.");let i;if(i=Fu.convert(R(this,go,"f"),n.width,n.height),i||(i={x:0,y:0,width:n.width,height:n.height}),i.x>n.width||i.y>n.height)throw new Error("Invalid scan region.");i.x+i.width>n.width&&(i.width=n.width-i.x),i.y+i.height>n.height&&(i.height=n.height-i.y);const r={sx:i.x,sy:i.y,sWidth:i.width,sHeight:i.height,dWidth:i.width,dHeight:i.height},o=Math.max(r.dWidth,r.dHeight);if(this.canvasSizeLimit&&o>this.canvasSizeLimit){const p=this.canvasSizeLimit/o;r.dWidth>r.dHeight?(r.dWidth=this.canvasSizeLimit,r.dHeight=Math.round(r.dHeight*p)):(r.dWidth=Math.round(r.dWidth*p),r.dHeight=this.canvasSizeLimit)}const s=R(this,be,"f").getFrameData({position:r,pixelFormat:lD.get(this.getPixelFormat())});if(!s)return null;let l;l=s.pixelFormat===Ke.GREY?s.width:4*s.width;let h=!0;return 0===r.sx&&0===r.sy&&r.sWidth===n.width&&r.sHeight===n.height&&(h=!1),{bytes:s.data,width:s.width,height:s.height,stride:l,format:cD.get(s.pixelFormat),tag:{imageId:this._imageId==Number.MAX_VALUE?this._imageId=0:++this._imageId,type:Iu.ITT_VIDEO_FRAME,isCropped:h,cropRegion:{left:i.x,top:i.y,right:i.x+i.width,bottom:i.y+i.height,isMeasuredInPercentage:!1},originalWidth:n.width,originalHeight:n.height,currentWidth:s.width,currentHeight:s.height,timeSpent:s.timeSpent,timeStamp:s.timeStamp},toCanvas:R(this,sd,"f"),isDCEFrame:!0}}setImageFetchInterval(n){this.fetchInterval=n,R(this,or,"f")&&(R(this,Bn,"f")&&clearTimeout(R(this,Bn,"f")),Te(this,Bn,setTimeout(()=>{this.disposed||R(this,Je,"m",Gp).call(this)},n),"f"))}getImageFetchInterval(){return this.fetchInterval}setPixelFormat(n){Te(this,ad,n,"f")}getPixelFormat(){return R(this,ad,"f")}takePhoto(n){var i=this;if(!this.isOpen())throw new Error("Not open.");if(R(this,Je,"m",_t).call(this))throw new Error("'takePhoto()' is unavailable in 'singleFrameMode'.");const r=document.createElement("input");r.setAttribute("type","file"),r.setAttribute("accept",".jpg,.jpeg,.icon,.gif,.svg,.webp,.png,.bmp"),r.setAttribute("capture",""),r.style.position="fixed",r.style.left="-1px",r.style.top="-1px",r.style.width="1px",r.style.height="1px",r.style.backgroundColor="transparent",r.style.color="transparent",r.addEventListener("click",()=>{const o=this.isOpen();this.close(),window.addEventListener("focus",()=>{o&&this.open(),r.remove()},{once:!0})}),r.addEventListener("change",J(function*(){const o=r.files[0],s=yield(D=J(function*(T){let A=null,M=null;if(typeof createImageBitmap<"u")try{if(A=yield createImageBitmap(T),A)return A}catch{}var P;return A||(M=yield(P=T,new Promise((B,k)=>{let U=URL.createObjectURL(P),V=new Image;V.src=U,V.onload=()=>{URL.revokeObjectURL(V.src),B(V)},V.onerror=q=>{k(new Error("Can't convert blob to image : "+(q instanceof Event?q.type:q)))}}))),M}),function(T){return D.apply(this,arguments)})(o),l=s instanceof HTMLImageElement?s.naturalWidth:s.width,h=s instanceof HTMLImageElement?s.naturalHeight:s.height;var D;let p=Fu.convert(R(i,go,"f"),l,h);p||(p={x:0,y:0,width:l,height:h});const C=R(i,od,"f").call(i,s,l,h,p);n&&n(C)})),document.body.appendChild(r),r.click()}convertToPageCoordinates(n){const i=R(this,Je,"m",Hp).call(this,n);return{x:i.pageX,y:i.pageY}}convertToClientCoordinates(n){const i=R(this,Je,"m",Hp).call(this,n);return{x:i.clientX,y:i.clientY}}dispose(){this.close(),R(this,be,"f").dispose(),this.releaseCameraView(),this.__proto__=null;for(let n in this)delete this[n];Object.defineProperty(this,"isCameraEnhancer",{value:!0}),Object.defineProperty(this,"disposed",{value:!0})}}var xi,uD,Cl,ld;jp=We,be=new WeakMap,xe=new WeakMap,yl=new WeakMap,rr=new WeakMap,fo=new WeakMap,rd=new WeakMap,od=new WeakMap,sd=new WeakMap,wl=new WeakMap,go=new WeakMap,ad=new WeakMap,or=new WeakMap,Bn=new WeakMap,mt=new WeakMap,ye=new WeakMap,Ti=new WeakMap,Up=new WeakMap,Je=new WeakSet,_t=function(){return"disabled"!==this.singleFrameMode},sD=function(){return!this.videoSrc&&"opened"===R(this,be,"f").state},aD=function(){for(let t in R(this,mt,"f"))if(1==R(this,mt,"f")[t])return!0;return!1},Gp=function t(){if(this.disposed)return;if("open"!==this.getCameraState()||!R(this,or,"f"))return R(this,Bn,"f")&&clearTimeout(R(this,Bn,"f")),void Te(this,Bn,setTimeout(()=>{this.disposed||R(this,Je,"m",t).call(this)},this.fetchInterval),"f");const n=()=>{var i;let r;We._onLog&&We._onLog("DCE: start fetching a frame into buffer: "+Date.now());try{r=this.fetchImage()}catch(o){const s=o.message||o;if("The video is not loaded."===s)return;if(null!==(i=R(this,wl,"f"))&&void 0!==i&&i.onErrorReceived)return void setTimeout(()=>{var l;null===(l=R(this,wl,"f"))||void 0===l||l.onErrorReceived(Qg.EC_IMAGE_READ_FAILED,s)},0);throw o}r?(this.addImageToBuffer(r),We._onLog&&We._onLog("DCE: finish fetching a frame into buffer: "+Date.now()),R(this,rr,"f").fire("frameAddedToBuffer",null,{async:!0})):We._onLog&&We._onLog("DCE: get a invalid frame, abandon it: "+Date.now())};if(this.getImageCount()>=this.getMaxImageCount())switch(this.getBufferOverflowProtectionMode()){case eo.BOPM_BLOCK:break;case eo.BOPM_UPDATE:n()}else n();R(this,Bn,"f")&&clearTimeout(R(this,Bn,"f")),Te(this,Bn,setTimeout(()=>{this.disposed||R(this,Je,"m",t).call(this)},this.fetchInterval),"f")},Hp=function(t){if(!R(this,xe,"f"))throw new Error("Camera view is not set.");if(R(this,xe,"f").disposed)throw new Error("'cameraView' has been disposed.");if(!this.isOpen())throw new Error("Not open.");if(!R(this,Je,"m",_t).call(this)&&!R(this,be,"f").isVideoLoaded())throw new Error("Video is not loaded.");if(R(this,Je,"m",_t).call(this)&&!R(this,xe,"f")._cvsSingleFrameMode)throw new Error("No image is selected.");const n=R(this,xe,"f")._innerComponent.getBoundingClientRect(),i=n.left,r=n.top,o=i+window.scrollX,s=r+window.scrollY,{width:l,height:h}=R(this,xe,"f")._innerComponent.getBoundingClientRect();if(l<=0||h<=0)throw new Error("Unable to get content dimensions. Camera view may not be rendered on the page.");let p,C,D;if(R(this,Je,"m",_t).call(this)){const V=R(this,xe,"f")._innerComponent.getElement("content");p=V.width,C=V.height,D="contain"}else{const V=this.getVideoEl();p=V.videoWidth,C=V.videoHeight,D=R(this,xe,"f").getVideoFit()}const T=l/h,A=p/C;let M,P,B,k,U=1;if("contain"===D)T<A?(U=l/p,M=i+t.x*U,P=r+t.y*U+(h-C*U)/2,B=o+t.x*U,k=s+t.y*U+(h-C*U)/2):(U=h/C,M=i+t.x*U+(l-p*U)/2,P=r+t.y*U,B=o+t.x*U+(l-p*U)/2,k=s+t.y*U);else if("cover"===D)if(T<A){U=h/C;let V=t.x*U-(p*U-l)/2;V=Math.max(V,0),V=Math.min(V,l),M=i+V,P=r+t.y*U,B=o+V,k=s+t.y*U}else{U=l/p;let V=t.y*U-(C*U-h)/2;V=Math.max(V,0),V=Math.min(V,h),M=i+t.x*U,P=r+V,B=o+t.x*U,k=s+V}return{clientX:M,clientY:P,pageX:B,pageY:k}},We._debug=!1,Vp={value:void 0},We.browserInfo=on;class jn{static get beepSoundSource(){return R(jn,xi,"f",ld)}static set beepSoundSource(n){Te(jn,xi,n,"f",ld),Te(jn,xi,new Tu({src:[R(jn,xi,"f",ld)],onplayerror:(i,r)=>{console.warn(`Sound '${i}' playback failure: ${r}`)}}),"f",Cl)}static vibrate(){if(!navigator||!navigator.vibrate)throw new Error("Not supported.");navigator.vibrate(jn.vibrateDuration)}static beep(){R(jn,xi,"f",Cl)&&(R(jn,xi,"f",Cl).stop(),R(jn,xi,"f",Cl).play())}}xi=jn,jn.vibrateDuration=300,Cl={value:new Tu({src:[R(jn,xi,"f",uD={value:"data:audio/mpeg;base64,SUQzBAAAAAAAI1RTU0UAAAAPAAADTGF2ZjU4LjI5LjEwMAAAAAAAAAAAAAAA/+M4wAAAAAAAAAAAAEluZm8AAAAPAAAABQAAAkAAgICAgICAgICAgICAgICAgICAgKCgoKCgoKCgoKCgoKCgoKCgoKCgwMDAwMDAwMDAwMDAwMDAwMDAwMDg4ODg4ODg4ODg4ODg4ODg4ODg4P//////////////////////////AAAAAExhdmM1OC41NAAAAAAAAAAAAAAAACQEUQAAAAAAAAJAk0uXRQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA/+MYxAANQAbGeUEQAAHZYZ3fASqD4P5TKBgocg+Bw/8+CAYBA4XB9/4EBAEP4nB9+UOf/6gfUCAIKyjgQ/Kf//wfswAAAwQA/+MYxAYOqrbdkZGQAMA7DJLCsQxNOij///////////+tv///3RWiZGBEhsf/FO/+LoCSFs1dFVS/g8f/4Mhv0nhqAieHleLy/+MYxAYOOrbMAY2gABf/////////////////usPJ66R0wI4boY9/8jQYg//g2SPx1M0N3Z0kVJLIs///Uw4aMyvHJJYmPBYG/+MYxAgPMALBucAQAoGgaBoFQVBUFQWDv6gZBUFQVBUGgaBr5YSgqCoKhIGg7+IQVBUFQVBoGga//SsFSoKnf/iVTEFNRTMu/+MYxAYAAANIAAAAADEwMFVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVV"})],onplayerror:(t,n)=>{console.warn(`Sound '${t}' playback failure: ${n}`)}})},ld={value:R(jn,xi,"f",uD)};class Nk{constructor(){this.verificationEnabled={[Re.CRIT_BARCODE]:!1,[Re.CRIT_TEXT_LINE]:!0,[Re.CRIT_DETECTED_QUAD]:!0,[Re.CRIT_NORMALIZED_IMAGE]:!1},this.duplicateFilterEnabled={[Re.CRIT_BARCODE]:!1,[Re.CRIT_TEXT_LINE]:!1,[Re.CRIT_DETECTED_QUAD]:!1,[Re.CRIT_NORMALIZED_IMAGE]:!1},this.duplicateForgetTime={[Re.CRIT_BARCODE]:3e3,[Re.CRIT_TEXT_LINE]:3e3,[Re.CRIT_DETECTED_QUAD]:3e3,[Re.CRIT_NORMALIZED_IMAGE]:3e3},this._allowType=[2,4,8,16]}enableResultCrossVerification(n,i){this._allowType.includes(n)&&(this.verificationEnabled[n]=i)}isResultCrossVerificationEnabled(n){return this.verificationEnabled[n]}enableResultDeduplication(n,i){this._allowType.includes(n)&&(this.duplicateFilterEnabled[n]=i)}isResultDeduplicationEnabled(n){return this.duplicateFilterEnabled[n]}setDuplicateForgetTime(n,i){i>18e4&&(i=18e4),i<0&&(i=0),this.duplicateForgetTime[n]=i}getDuplicateForgetTime(n){return this.duplicateForgetTime[n]}getFilteredResultItemTypes(){let n=0;const i=[Re.CRIT_BARCODE,Re.CRIT_TEXT_LINE,Re.CRIT_DETECTED_QUAD];for(let r=0;r<i.length;r++)(this.verificationEnabled[i[r]]||this.duplicateFilterEnabled[i[r]])&&(n|=i[r]);return n}onDecodedBarcodesReceived(n){if(this.isResultCrossVerificationEnabled(Re.CRIT_BARCODE))for(let i=0;i<n.length;i++)n[i]&&n[i].type===Re.CRIT_BARCODE&&!n[i].verified&&(n[i].isFilter=!0);if(this.isResultDeduplicationEnabled(Re.CRIT_BARCODE))for(let i=0;i<n.length;i++)n[i]&&n[i].type===Re.CRIT_BARCODE&&n[i].duplicate&&(n[i].isFilter=!0)}onRecognizedTextLinesReceived(n){if(this.isResultCrossVerificationEnabled(Re.CRIT_TEXT_LINE))for(let i=0;i<n.length;i++)n[i]&&n[i].type===Re.CRIT_TEXT_LINE&&!n[i].verified&&(n[i].isFilter=!0);if(this.isResultDeduplicationEnabled(Re.CRIT_TEXT_LINE))for(let i=0;i<n.length;i++)n[i]&&n[i].type===Re.CRIT_TEXT_LINE&&n[i].duplicate&&(n[i].isFilter=!0)}onDetectedQuadsReceived(n){if(this.isResultCrossVerificationEnabled(Re.CRIT_DETECTED_QUAD))for(let i=0;i<n.length;i++)n[i]&&n[i].type===Re.CRIT_DETECTED_QUAD&&!n[i].verified&&(n[i].isFilter=!0);if(this.isResultDeduplicationEnabled(Re.CRIT_DETECTED_QUAD))for(let i=0;i<n.length;i++)n[i]&&n[i].type===Re.CRIT_DETECTED_QUAD&&n[i].duplicate&&(n[i].isFilter=!0)}onNormalizedImagesReceived(n){if(this.isResultCrossVerificationEnabled(Re.CRIT_NORMALIZED_IMAGE))for(let i=0;i<n.length;i++)n[i]&&n[i].type===Re.CRIT_NORMALIZED_IMAGE&&!n[i].verified&&(n[i].isFilter=!0);if(this.isResultDeduplicationEnabled(Re.CRIT_NORMALIZED_IMAGE))for(let i=0;i<n.length;i++)n[i]&&n[i].type===Re.CRIT_NORMALIZED_IMAGE&&n[i].duplicate&&(n[i].isFilter=!0)}}const kk=["uiContainer"],Bk=["resultsContainer"];let jk=(()=>{class t{constructor(){this.pInit=null,this.uiContainer=null,this.resultsContainer=null}init(){var i=this;return J(function*(){try{const r=yield Ut.createInstance(),o=yield We.createInstance(r);i.uiContainer.nativeElement.append(r.getUIElement());const s=yield st.createInstance();s.setInput(o);const l=new _k;l.onDecodedBarcodesReceived=p=>{if(p.barcodeResultItems.length){i.resultsContainer.nativeElement.textContent="",console.log(p);for(let C of p.barcodeResultItems)i.resultsContainer.nativeElement.append(`${C.formatString}: ${C.text}`,document.createElement("br"),document.createElement("hr"))}},s.addResultReceiver(l);const h=new Nk;return h.enableResultCrossVerification(Re.CRIT_BARCODE,!0),h.enableResultDeduplication(Re.CRIT_BARCODE,!0),h.setDuplicateForgetTime(Re.CRIT_BARCODE,3e3),yield s.addResultFilter(h),yield o.open(),yield s.startCapturing("ReadSingleBarcode"),{cameraView:r,cameraEnhancer:o,router:s}}catch(r){let o=r.message||r;throw console.error(o),alert(o),r}})()}ngOnInit(){var i=this;return J(function*(){i.pInit=i.init()})()}ngOnDestroy(){var i=this;return J(function*(){if(i.pInit){const{cameraView:r,cameraEnhancer:o,router:s}=yield i.pInit;s.dispose(),o.dispose(),r.dispose()}i.uiContainer.nativeElement.innerText="",console.log("VideoCapture Component Unmount")})()}static#e=this.\u0275fac=function(r){return new(r||t)};static#t=this.\u0275cmp=zs({type:t,selectors:[["app-video-capture"]],viewQuery:function(r,o){if(1&r&&(tg(kk,5),tg(Bk,5)),2&r){let s;eg(s=ng())&&(o.uiContainer=s.first),eg(s=ng())&&(o.resultsContainer=s.first)}},decls:6,vars:0,consts:[[1,"div-ui-container"],["uiContainer",""],[1,"div-results-container"],["resultsContainer",""]],template:function(r,o){1&r&&($r(0,"div",0,1),Ra(2,"\nResults:\n"),$r(3,"br")(4,"div",2,3))},styles:[".div-ui-container[_ngcontent-%COMP%]{width:100%;height:70vh}.div-results-container[_ngcontent-%COMP%]{width:100%;height:10vh;overflow:auto}"]})}return t})();function Vk(t,n){1&t&&$r(0,"app-video-capture")}function Uk(t,n){1&t&&$r(0,"app-image-capture")}const Gk=function(t){return{"margin-right":"10px","background-color":t}},Hk=function(t){return{"background-color":t}};let Wk=(()=>{class t{constructor(){this.bShowVideoCapture=!0,this.bShowImageCapture=!1}showVideoCapture(){this.bShowVideoCapture=!0,this.bShowImageCapture=!1}showImageCapture(){this.bShowVideoCapture=!1,this.bShowImageCapture=!0}static#e=this.\u0275fac=function(r){return new(r||t)};static#t=this.\u0275cmp=zs({type:t,selectors:[["app-hello-world"]],decls:11,vars:8,consts:[[1,"div-hello-world"],[3,"ngStyle","click"],[1,"container"],[4,"ngIf"]],template:function(r,o){1&r&&(vr(0,"div",0)(1,"h1"),Ra(2,"Hello World for Angular"),yr(),vr(3,"div")(4,"button",1),Oa("click",function(){return o.showVideoCapture()}),Ra(5,"Decode Video"),yr(),vr(6,"button",1),Oa("click",function(){return o.showImageCapture()}),Ra(7,"Decode Image"),yr()(),vr(8,"div",2),Sf(9,Vk,1,0,"app-video-capture",3),Sf(10,Uk,1,0,"app-image-capture",3),yr()()),2&r&&(Ca(4),ss("ngStyle",zf(4,Gk,o.bShowVideoCapture?"rgb(255,174,55)":"white")),Ca(2),ss("ngStyle",zf(6,Hk,o.bShowVideoCapture?"white":"rgb(255,174,55)")),Ca(3),ss("ngIf",o.bShowVideoCapture),Ca(1),ss("ngIf",o.bShowImageCapture))},dependencies:[DE,TE,vk,jk],styles:[".div-hello-world[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;justify-content:center;width:100%;height:100%;color:#455a64}button[_ngcontent-%COMP%]{font-size:1.5rem;margin:1.5vh 0;border:1px solid black;background-color:#fff;color:#000}.container[_ngcontent-%COMP%]{margin:2vmin auto;height:70vh;width:80vw}h1[_ngcontent-%COMP%]{font-size:1.5em}"]})}return t})(),Yk=(()=>{class t{constructor(){this.title="angular"}static#e=this.\u0275fac=function(r){return new(r||t)};static#t=this.\u0275cmp=zs({type:t,selectors:[["app-root"]],decls:1,vars:0,template:function(r,o){1&r&&$r(0,"app-hello-world")},dependencies:[Wk]})}return t})(),zk=(()=>{class t{static#e=this.\u0275fac=function(r){return new(r||t)};static#t=this.\u0275mod=$s({type:t,bootstrap:[Yk]});static#n=this.\u0275inj=mo({imports:[$N]})}return t})();YN().bootstrapModule(zk).catch(t=>console.error(t))}},Lt=>{Lt(Lt.s=12)}]);