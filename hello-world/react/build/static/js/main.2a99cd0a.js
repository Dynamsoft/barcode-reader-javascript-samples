/*! For license information please see main.2a99cd0a.js.LICENSE.txt */
(()=>{"use strict";var e={463:(e,t,i)=>{var n=i(791),r=i(296);function s(e){for(var t="https://reactjs.org/docs/error-decoder.html?invariant="+e,i=1;i<arguments.length;i++)t+="&args[]="+encodeURIComponent(arguments[i]);return"Minified React error #"+e+"; visit "+t+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var o=new Set,a={};function l(e,t){c(e,t),c(e+"Capture",t)}function c(e,t){for(a[e]=t,e=0;e<t.length;e++)o.add(t[e])}var h=!("undefined"===typeof window||"undefined"===typeof window.document||"undefined"===typeof window.document.createElement),u=Object.prototype.hasOwnProperty,d=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,f={},g={};function p(e,t,i,n,r,s,o){this.acceptsBooleans=2===t||3===t||4===t,this.attributeName=n,this.attributeNamespace=r,this.mustUseProperty=i,this.propertyName=e,this.type=t,this.sanitizeURL=s,this.removeEmptyString=o}var m={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach((function(e){m[e]=new p(e,0,!1,e,null,!1,!1)})),[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach((function(e){var t=e[0];m[t]=new p(t,1,!1,e[1],null,!1,!1)})),["contentEditable","draggable","spellCheck","value"].forEach((function(e){m[e]=new p(e,2,!1,e.toLowerCase(),null,!1,!1)})),["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach((function(e){m[e]=new p(e,2,!1,e,null,!1,!1)})),"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach((function(e){m[e]=new p(e,3,!1,e.toLowerCase(),null,!1,!1)})),["checked","multiple","muted","selected"].forEach((function(e){m[e]=new p(e,3,!0,e,null,!1,!1)})),["capture","download"].forEach((function(e){m[e]=new p(e,4,!1,e,null,!1,!1)})),["cols","rows","size","span"].forEach((function(e){m[e]=new p(e,6,!1,e,null,!1,!1)})),["rowSpan","start"].forEach((function(e){m[e]=new p(e,5,!1,e.toLowerCase(),null,!1,!1)}));var _=/[\-:]([a-z])/g;function v(e){return e[1].toUpperCase()}function y(e,t,i,n){var r=m.hasOwnProperty(t)?m[t]:null;(null!==r?0!==r.type:n||!(2<t.length)||"o"!==t[0]&&"O"!==t[0]||"n"!==t[1]&&"N"!==t[1])&&(function(e,t,i,n){if(null===t||"undefined"===typeof t||function(e,t,i,n){if(null!==i&&0===i.type)return!1;switch(typeof t){case"function":case"symbol":return!0;case"boolean":return!n&&(null!==i?!i.acceptsBooleans:"data-"!==(e=e.toLowerCase().slice(0,5))&&"aria-"!==e);default:return!1}}(e,t,i,n))return!0;if(n)return!1;if(null!==i)switch(i.type){case 3:return!t;case 4:return!1===t;case 5:return isNaN(t);case 6:return isNaN(t)||1>t}return!1}(t,i,r,n)&&(i=null),n||null===r?function(e){return!!u.call(g,e)||!u.call(f,e)&&(d.test(e)?g[e]=!0:(f[e]=!0,!1))}(t)&&(null===i?e.removeAttribute(t):e.setAttribute(t,""+i)):r.mustUseProperty?e[r.propertyName]=null===i?3!==r.type&&"":i:(t=r.attributeName,n=r.attributeNamespace,null===i?e.removeAttribute(t):(i=3===(r=r.type)||4===r&&!0===i?"":""+i,n?e.setAttributeNS(n,t,i):e.setAttribute(t,i))))}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach((function(e){var t=e.replace(_,v);m[t]=new p(t,1,!1,e,null,!1,!1)})),"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach((function(e){var t=e.replace(_,v);m[t]=new p(t,1,!1,e,"http://www.w3.org/1999/xlink",!1,!1)})),["xml:base","xml:lang","xml:space"].forEach((function(e){var t=e.replace(_,v);m[t]=new p(t,1,!1,e,"http://www.w3.org/XML/1998/namespace",!1,!1)})),["tabIndex","crossOrigin"].forEach((function(e){m[e]=new p(e,1,!1,e.toLowerCase(),null,!1,!1)})),m.xlinkHref=new p("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1),["src","href","action","formAction"].forEach((function(e){m[e]=new p(e,1,!1,e.toLowerCase(),null,!0,!0)}));var w=n.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,b=Symbol.for("react.element"),C=Symbol.for("react.portal"),S=Symbol.for("react.fragment"),E=Symbol.for("react.strict_mode"),T=Symbol.for("react.profiler"),x=Symbol.for("react.provider"),I=Symbol.for("react.context"),A=Symbol.for("react.forward_ref"),O=Symbol.for("react.suspense"),R=Symbol.for("react.suspense_list"),D=Symbol.for("react.memo"),L=Symbol.for("react.lazy");Symbol.for("react.scope"),Symbol.for("react.debug_trace_mode");var k=Symbol.for("react.offscreen");Symbol.for("react.legacy_hidden"),Symbol.for("react.cache"),Symbol.for("react.tracing_marker");var M=Symbol.iterator;function P(e){return null===e||"object"!==typeof e?null:"function"===typeof(e=M&&e[M]||e["@@iterator"])?e:null}var F,N=Object.assign;function B(e){if(void 0===F)try{throw Error()}catch(i){var t=i.stack.trim().match(/\n( *(at )?)/);F=t&&t[1]||""}return"\n"+F+e}var j=!1;function U(e,t){if(!e||j)return"";j=!0;var i=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(t)if(t=function(){throw Error()},Object.defineProperty(t.prototype,"props",{set:function(){throw Error()}}),"object"===typeof Reflect&&Reflect.construct){try{Reflect.construct(t,[])}catch(c){var n=c}Reflect.construct(e,[],t)}else{try{t.call()}catch(c){n=c}e.call(t.prototype)}else{try{throw Error()}catch(c){n=c}e()}}catch(c){if(c&&n&&"string"===typeof c.stack){for(var r=c.stack.split("\n"),s=n.stack.split("\n"),o=r.length-1,a=s.length-1;1<=o&&0<=a&&r[o]!==s[a];)a--;for(;1<=o&&0<=a;o--,a--)if(r[o]!==s[a]){if(1!==o||1!==a)do{if(o--,0>--a||r[o]!==s[a]){var l="\n"+r[o].replace(" at new "," at ");return e.displayName&&l.includes("<anonymous>")&&(l=l.replace("<anonymous>",e.displayName)),l}}while(1<=o&&0<=a);break}}}finally{j=!1,Error.prepareStackTrace=i}return(e=e?e.displayName||e.name:"")?B(e):""}function V(e){switch(e.tag){case 5:return B(e.type);case 16:return B("Lazy");case 13:return B("Suspense");case 19:return B("SuspenseList");case 0:case 2:case 15:return e=U(e.type,!1);case 11:return e=U(e.type.render,!1);case 1:return e=U(e.type,!0);default:return""}}function G(e){if(null==e)return null;if("function"===typeof e)return e.displayName||e.name||null;if("string"===typeof e)return e;switch(e){case S:return"Fragment";case C:return"Portal";case T:return"Profiler";case E:return"StrictMode";case O:return"Suspense";case R:return"SuspenseList"}if("object"===typeof e)switch(e.$$typeof){case I:return(e.displayName||"Context")+".Consumer";case x:return(e._context.displayName||"Context")+".Provider";case A:var t=e.render;return(e=e.displayName)||(e=""!==(e=t.displayName||t.name||"")?"ForwardRef("+e+")":"ForwardRef"),e;case D:return null!==(t=e.displayName||null)?t:G(e.type)||"Memo";case L:t=e._payload,e=e._init;try{return G(e(t))}catch(i){}}return null}function W(e){var t=e.type;switch(e.tag){case 24:return"Cache";case 9:return(t.displayName||"Context")+".Consumer";case 10:return(t._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return e=(e=t.render).displayName||e.name||"",t.displayName||(""!==e?"ForwardRef("+e+")":"ForwardRef");case 7:return"Fragment";case 5:return t;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return G(t);case 8:return t===E?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if("function"===typeof t)return t.displayName||t.name||null;if("string"===typeof t)return t}return null}function z(e){switch(typeof e){case"boolean":case"number":case"string":case"undefined":case"object":return e;default:return""}}function H(e){var t=e.type;return(e=e.nodeName)&&"input"===e.toLowerCase()&&("checkbox"===t||"radio"===t)}function Y(e){e._valueTracker||(e._valueTracker=function(e){var t=H(e)?"checked":"value",i=Object.getOwnPropertyDescriptor(e.constructor.prototype,t),n=""+e[t];if(!e.hasOwnProperty(t)&&"undefined"!==typeof i&&"function"===typeof i.get&&"function"===typeof i.set){var r=i.get,s=i.set;return Object.defineProperty(e,t,{configurable:!0,get:function(){return r.call(this)},set:function(e){n=""+e,s.call(this,e)}}),Object.defineProperty(e,t,{enumerable:i.enumerable}),{getValue:function(){return n},setValue:function(e){n=""+e},stopTracking:function(){e._valueTracker=null,delete e[t]}}}}(e))}function X(e){if(!e)return!1;var t=e._valueTracker;if(!t)return!0;var i=t.getValue(),n="";return e&&(n=H(e)?e.checked?"true":"false":e.value),(e=n)!==i&&(t.setValue(e),!0)}function q(e){if("undefined"===typeof(e=e||("undefined"!==typeof document?document:void 0)))return null;try{return e.activeElement||e.body}catch(t){return e.body}}function Z(e,t){var i=t.checked;return N({},t,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:null!=i?i:e._wrapperState.initialChecked})}function K(e,t){var i=null==t.defaultValue?"":t.defaultValue,n=null!=t.checked?t.checked:t.defaultChecked;i=z(null!=t.value?t.value:i),e._wrapperState={initialChecked:n,initialValue:i,controlled:"checkbox"===t.type||"radio"===t.type?null!=t.checked:null!=t.value}}function Q(e,t){null!=(t=t.checked)&&y(e,"checked",t,!1)}function J(e,t){Q(e,t);var i=z(t.value),n=t.type;if(null!=i)"number"===n?(0===i&&""===e.value||e.value!=i)&&(e.value=""+i):e.value!==""+i&&(e.value=""+i);else if("submit"===n||"reset"===n)return void e.removeAttribute("value");t.hasOwnProperty("value")?ee(e,t.type,i):t.hasOwnProperty("defaultValue")&&ee(e,t.type,z(t.defaultValue)),null==t.checked&&null!=t.defaultChecked&&(e.defaultChecked=!!t.defaultChecked)}function $(e,t,i){if(t.hasOwnProperty("value")||t.hasOwnProperty("defaultValue")){var n=t.type;if(!("submit"!==n&&"reset"!==n||void 0!==t.value&&null!==t.value))return;t=""+e._wrapperState.initialValue,i||t===e.value||(e.value=t),e.defaultValue=t}""!==(i=e.name)&&(e.name=""),e.defaultChecked=!!e._wrapperState.initialChecked,""!==i&&(e.name=i)}function ee(e,t,i){"number"===t&&q(e.ownerDocument)===e||(null==i?e.defaultValue=""+e._wrapperState.initialValue:e.defaultValue!==""+i&&(e.defaultValue=""+i))}var te=Array.isArray;function ie(e,t,i,n){if(e=e.options,t){t={};for(var r=0;r<i.length;r++)t["$"+i[r]]=!0;for(i=0;i<e.length;i++)r=t.hasOwnProperty("$"+e[i].value),e[i].selected!==r&&(e[i].selected=r),r&&n&&(e[i].defaultSelected=!0)}else{for(i=""+z(i),t=null,r=0;r<e.length;r++){if(e[r].value===i)return e[r].selected=!0,void(n&&(e[r].defaultSelected=!0));null!==t||e[r].disabled||(t=e[r])}null!==t&&(t.selected=!0)}}function ne(e,t){if(null!=t.dangerouslySetInnerHTML)throw Error(s(91));return N({},t,{value:void 0,defaultValue:void 0,children:""+e._wrapperState.initialValue})}function re(e,t){var i=t.value;if(null==i){if(i=t.children,t=t.defaultValue,null!=i){if(null!=t)throw Error(s(92));if(te(i)){if(1<i.length)throw Error(s(93));i=i[0]}t=i}null==t&&(t=""),i=t}e._wrapperState={initialValue:z(i)}}function se(e,t){var i=z(t.value),n=z(t.defaultValue);null!=i&&((i=""+i)!==e.value&&(e.value=i),null==t.defaultValue&&e.defaultValue!==i&&(e.defaultValue=i)),null!=n&&(e.defaultValue=""+n)}function oe(e){var t=e.textContent;t===e._wrapperState.initialValue&&""!==t&&null!==t&&(e.value=t)}function ae(e){switch(e){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function le(e,t){return null==e||"http://www.w3.org/1999/xhtml"===e?ae(t):"http://www.w3.org/2000/svg"===e&&"foreignObject"===t?"http://www.w3.org/1999/xhtml":e}var ce,he,ue=(he=function(e,t){if("http://www.w3.org/2000/svg"!==e.namespaceURI||"innerHTML"in e)e.innerHTML=t;else{for((ce=ce||document.createElement("div")).innerHTML="<svg>"+t.valueOf().toString()+"</svg>",t=ce.firstChild;e.firstChild;)e.removeChild(e.firstChild);for(;t.firstChild;)e.appendChild(t.firstChild)}},"undefined"!==typeof MSApp&&MSApp.execUnsafeLocalFunction?function(e,t,i,n){MSApp.execUnsafeLocalFunction((function(){return he(e,t)}))}:he);function de(e,t){if(t){var i=e.firstChild;if(i&&i===e.lastChild&&3===i.nodeType)return void(i.nodeValue=t)}e.textContent=t}var fe={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},ge=["Webkit","ms","Moz","O"];function pe(e,t,i){return null==t||"boolean"===typeof t||""===t?"":i||"number"!==typeof t||0===t||fe.hasOwnProperty(e)&&fe[e]?(""+t).trim():t+"px"}function me(e,t){for(var i in e=e.style,t)if(t.hasOwnProperty(i)){var n=0===i.indexOf("--"),r=pe(i,t[i],n);"float"===i&&(i="cssFloat"),n?e.setProperty(i,r):e[i]=r}}Object.keys(fe).forEach((function(e){ge.forEach((function(t){t=t+e.charAt(0).toUpperCase()+e.substring(1),fe[t]=fe[e]}))}));var _e=N({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function ve(e,t){if(t){if(_e[e]&&(null!=t.children||null!=t.dangerouslySetInnerHTML))throw Error(s(137,e));if(null!=t.dangerouslySetInnerHTML){if(null!=t.children)throw Error(s(60));if("object"!==typeof t.dangerouslySetInnerHTML||!("__html"in t.dangerouslySetInnerHTML))throw Error(s(61))}if(null!=t.style&&"object"!==typeof t.style)throw Error(s(62))}}function ye(e,t){if(-1===e.indexOf("-"))return"string"===typeof t.is;switch(e){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var we=null;function be(e){return(e=e.target||e.srcElement||window).correspondingUseElement&&(e=e.correspondingUseElement),3===e.nodeType?e.parentNode:e}var Ce=null,Se=null,Ee=null;function Te(e){if(e=yr(e)){if("function"!==typeof Ce)throw Error(s(280));var t=e.stateNode;t&&(t=br(t),Ce(e.stateNode,e.type,t))}}function xe(e){Se?Ee?Ee.push(e):Ee=[e]:Se=e}function Ie(){if(Se){var e=Se,t=Ee;if(Ee=Se=null,Te(e),t)for(e=0;e<t.length;e++)Te(t[e])}}function Ae(e,t){return e(t)}function Oe(){}var Re=!1;function De(e,t,i){if(Re)return e(t,i);Re=!0;try{return Ae(e,t,i)}finally{Re=!1,(null!==Se||null!==Ee)&&(Oe(),Ie())}}function Le(e,t){var i=e.stateNode;if(null===i)return null;var n=br(i);if(null===n)return null;i=n[t];e:switch(t){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(n=!n.disabled)||(n=!("button"===(e=e.type)||"input"===e||"select"===e||"textarea"===e)),e=!n;break e;default:e=!1}if(e)return null;if(i&&"function"!==typeof i)throw Error(s(231,t,typeof i));return i}var ke=!1;if(h)try{var Me={};Object.defineProperty(Me,"passive",{get:function(){ke=!0}}),window.addEventListener("test",Me,Me),window.removeEventListener("test",Me,Me)}catch(he){ke=!1}function Pe(e,t,i,n,r,s,o,a,l){var c=Array.prototype.slice.call(arguments,3);try{t.apply(i,c)}catch(h){this.onError(h)}}var Fe=!1,Ne=null,Be=!1,je=null,Ue={onError:function(e){Fe=!0,Ne=e}};function Ve(e,t,i,n,r,s,o,a,l){Fe=!1,Ne=null,Pe.apply(Ue,arguments)}function Ge(e){var t=e,i=e;if(e.alternate)for(;t.return;)t=t.return;else{e=t;do{0!==(4098&(t=e).flags)&&(i=t.return),e=t.return}while(e)}return 3===t.tag?i:null}function We(e){if(13===e.tag){var t=e.memoizedState;if(null===t&&(null!==(e=e.alternate)&&(t=e.memoizedState)),null!==t)return t.dehydrated}return null}function ze(e){if(Ge(e)!==e)throw Error(s(188))}function He(e){return null!==(e=function(e){var t=e.alternate;if(!t){if(null===(t=Ge(e)))throw Error(s(188));return t!==e?null:e}for(var i=e,n=t;;){var r=i.return;if(null===r)break;var o=r.alternate;if(null===o){if(null!==(n=r.return)){i=n;continue}break}if(r.child===o.child){for(o=r.child;o;){if(o===i)return ze(r),e;if(o===n)return ze(r),t;o=o.sibling}throw Error(s(188))}if(i.return!==n.return)i=r,n=o;else{for(var a=!1,l=r.child;l;){if(l===i){a=!0,i=r,n=o;break}if(l===n){a=!0,n=r,i=o;break}l=l.sibling}if(!a){for(l=o.child;l;){if(l===i){a=!0,i=o,n=r;break}if(l===n){a=!0,n=o,i=r;break}l=l.sibling}if(!a)throw Error(s(189))}}if(i.alternate!==n)throw Error(s(190))}if(3!==i.tag)throw Error(s(188));return i.stateNode.current===i?e:t}(e))?Ye(e):null}function Ye(e){if(5===e.tag||6===e.tag)return e;for(e=e.child;null!==e;){var t=Ye(e);if(null!==t)return t;e=e.sibling}return null}var Xe=r.unstable_scheduleCallback,qe=r.unstable_cancelCallback,Ze=r.unstable_shouldYield,Ke=r.unstable_requestPaint,Qe=r.unstable_now,Je=r.unstable_getCurrentPriorityLevel,$e=r.unstable_ImmediatePriority,et=r.unstable_UserBlockingPriority,tt=r.unstable_NormalPriority,it=r.unstable_LowPriority,nt=r.unstable_IdlePriority,rt=null,st=null;var ot=Math.clz32?Math.clz32:function(e){return e>>>=0,0===e?32:31-(at(e)/lt|0)|0},at=Math.log,lt=Math.LN2;var ct=64,ht=4194304;function ut(e){switch(e&-e){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return 4194240&e;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return 130023424&e;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return e}}function dt(e,t){var i=e.pendingLanes;if(0===i)return 0;var n=0,r=e.suspendedLanes,s=e.pingedLanes,o=268435455&i;if(0!==o){var a=o&~r;0!==a?n=ut(a):0!==(s&=o)&&(n=ut(s))}else 0!==(o=i&~r)?n=ut(o):0!==s&&(n=ut(s));if(0===n)return 0;if(0!==t&&t!==n&&0===(t&r)&&((r=n&-n)>=(s=t&-t)||16===r&&0!==(4194240&s)))return t;if(0!==(4&n)&&(n|=16&i),0!==(t=e.entangledLanes))for(e=e.entanglements,t&=n;0<t;)r=1<<(i=31-ot(t)),n|=e[i],t&=~r;return n}function ft(e,t){switch(e){case 1:case 2:case 4:return t+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return t+5e3;default:return-1}}function gt(e){return 0!==(e=-1073741825&e.pendingLanes)?e:1073741824&e?1073741824:0}function pt(){var e=ct;return 0===(4194240&(ct<<=1))&&(ct=64),e}function mt(e){for(var t=[],i=0;31>i;i++)t.push(e);return t}function _t(e,t,i){e.pendingLanes|=t,536870912!==t&&(e.suspendedLanes=0,e.pingedLanes=0),(e=e.eventTimes)[t=31-ot(t)]=i}function vt(e,t){var i=e.entangledLanes|=t;for(e=e.entanglements;i;){var n=31-ot(i),r=1<<n;r&t|e[n]&t&&(e[n]|=t),i&=~r}}var yt=0;function wt(e){return 1<(e&=-e)?4<e?0!==(268435455&e)?16:536870912:4:1}var bt,Ct,St,Et,Tt,xt=!1,It=[],At=null,Ot=null,Rt=null,Dt=new Map,Lt=new Map,kt=[],Mt="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function Pt(e,t){switch(e){case"focusin":case"focusout":At=null;break;case"dragenter":case"dragleave":Ot=null;break;case"mouseover":case"mouseout":Rt=null;break;case"pointerover":case"pointerout":Dt.delete(t.pointerId);break;case"gotpointercapture":case"lostpointercapture":Lt.delete(t.pointerId)}}function Ft(e,t,i,n,r,s){return null===e||e.nativeEvent!==s?(e={blockedOn:t,domEventName:i,eventSystemFlags:n,nativeEvent:s,targetContainers:[r]},null!==t&&(null!==(t=yr(t))&&Ct(t)),e):(e.eventSystemFlags|=n,t=e.targetContainers,null!==r&&-1===t.indexOf(r)&&t.push(r),e)}function Nt(e){var t=vr(e.target);if(null!==t){var i=Ge(t);if(null!==i)if(13===(t=i.tag)){if(null!==(t=We(i)))return e.blockedOn=t,void Tt(e.priority,(function(){St(i)}))}else if(3===t&&i.stateNode.current.memoizedState.isDehydrated)return void(e.blockedOn=3===i.tag?i.stateNode.containerInfo:null)}e.blockedOn=null}function Bt(e){if(null!==e.blockedOn)return!1;for(var t=e.targetContainers;0<t.length;){var i=Zt(e.domEventName,e.eventSystemFlags,t[0],e.nativeEvent);if(null!==i)return null!==(t=yr(i))&&Ct(t),e.blockedOn=i,!1;var n=new(i=e.nativeEvent).constructor(i.type,i);we=n,i.target.dispatchEvent(n),we=null,t.shift()}return!0}function jt(e,t,i){Bt(e)&&i.delete(t)}function Ut(){xt=!1,null!==At&&Bt(At)&&(At=null),null!==Ot&&Bt(Ot)&&(Ot=null),null!==Rt&&Bt(Rt)&&(Rt=null),Dt.forEach(jt),Lt.forEach(jt)}function Vt(e,t){e.blockedOn===t&&(e.blockedOn=null,xt||(xt=!0,r.unstable_scheduleCallback(r.unstable_NormalPriority,Ut)))}function Gt(e){function t(t){return Vt(t,e)}if(0<It.length){Vt(It[0],e);for(var i=1;i<It.length;i++){var n=It[i];n.blockedOn===e&&(n.blockedOn=null)}}for(null!==At&&Vt(At,e),null!==Ot&&Vt(Ot,e),null!==Rt&&Vt(Rt,e),Dt.forEach(t),Lt.forEach(t),i=0;i<kt.length;i++)(n=kt[i]).blockedOn===e&&(n.blockedOn=null);for(;0<kt.length&&null===(i=kt[0]).blockedOn;)Nt(i),null===i.blockedOn&&kt.shift()}var Wt=w.ReactCurrentBatchConfig,zt=!0;function Ht(e,t,i,n){var r=yt,s=Wt.transition;Wt.transition=null;try{yt=1,Xt(e,t,i,n)}finally{yt=r,Wt.transition=s}}function Yt(e,t,i,n){var r=yt,s=Wt.transition;Wt.transition=null;try{yt=4,Xt(e,t,i,n)}finally{yt=r,Wt.transition=s}}function Xt(e,t,i,n){if(zt){var r=Zt(e,t,i,n);if(null===r)zn(e,t,n,qt,i),Pt(e,n);else if(function(e,t,i,n,r){switch(t){case"focusin":return At=Ft(At,e,t,i,n,r),!0;case"dragenter":return Ot=Ft(Ot,e,t,i,n,r),!0;case"mouseover":return Rt=Ft(Rt,e,t,i,n,r),!0;case"pointerover":var s=r.pointerId;return Dt.set(s,Ft(Dt.get(s)||null,e,t,i,n,r)),!0;case"gotpointercapture":return s=r.pointerId,Lt.set(s,Ft(Lt.get(s)||null,e,t,i,n,r)),!0}return!1}(r,e,t,i,n))n.stopPropagation();else if(Pt(e,n),4&t&&-1<Mt.indexOf(e)){for(;null!==r;){var s=yr(r);if(null!==s&&bt(s),null===(s=Zt(e,t,i,n))&&zn(e,t,n,qt,i),s===r)break;r=s}null!==r&&n.stopPropagation()}else zn(e,t,n,null,i)}}var qt=null;function Zt(e,t,i,n){if(qt=null,null!==(e=vr(e=be(n))))if(null===(t=Ge(e)))e=null;else if(13===(i=t.tag)){if(null!==(e=We(t)))return e;e=null}else if(3===i){if(t.stateNode.current.memoizedState.isDehydrated)return 3===t.tag?t.stateNode.containerInfo:null;e=null}else t!==e&&(e=null);return qt=e,null}function Kt(e){switch(e){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(Je()){case $e:return 1;case et:return 4;case tt:case it:return 16;case nt:return 536870912;default:return 16}default:return 16}}var Qt=null,Jt=null,$t=null;function ei(){if($t)return $t;var e,t,i=Jt,n=i.length,r="value"in Qt?Qt.value:Qt.textContent,s=r.length;for(e=0;e<n&&i[e]===r[e];e++);var o=n-e;for(t=1;t<=o&&i[n-t]===r[s-t];t++);return $t=r.slice(e,1<t?1-t:void 0)}function ti(e){var t=e.keyCode;return"charCode"in e?0===(e=e.charCode)&&13===t&&(e=13):e=t,10===e&&(e=13),32<=e||13===e?e:0}function ii(){return!0}function ni(){return!1}function ri(e){function t(t,i,n,r,s){for(var o in this._reactName=t,this._targetInst=n,this.type=i,this.nativeEvent=r,this.target=s,this.currentTarget=null,e)e.hasOwnProperty(o)&&(t=e[o],this[o]=t?t(r):r[o]);return this.isDefaultPrevented=(null!=r.defaultPrevented?r.defaultPrevented:!1===r.returnValue)?ii:ni,this.isPropagationStopped=ni,this}return N(t.prototype,{preventDefault:function(){this.defaultPrevented=!0;var e=this.nativeEvent;e&&(e.preventDefault?e.preventDefault():"unknown"!==typeof e.returnValue&&(e.returnValue=!1),this.isDefaultPrevented=ii)},stopPropagation:function(){var e=this.nativeEvent;e&&(e.stopPropagation?e.stopPropagation():"unknown"!==typeof e.cancelBubble&&(e.cancelBubble=!0),this.isPropagationStopped=ii)},persist:function(){},isPersistent:ii}),t}var si,oi,ai,li={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(e){return e.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},ci=ri(li),hi=N({},li,{view:0,detail:0}),ui=ri(hi),di=N({},hi,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:Ei,button:0,buttons:0,relatedTarget:function(e){return void 0===e.relatedTarget?e.fromElement===e.srcElement?e.toElement:e.fromElement:e.relatedTarget},movementX:function(e){return"movementX"in e?e.movementX:(e!==ai&&(ai&&"mousemove"===e.type?(si=e.screenX-ai.screenX,oi=e.screenY-ai.screenY):oi=si=0,ai=e),si)},movementY:function(e){return"movementY"in e?e.movementY:oi}}),fi=ri(di),gi=ri(N({},di,{dataTransfer:0})),pi=ri(N({},hi,{relatedTarget:0})),mi=ri(N({},li,{animationName:0,elapsedTime:0,pseudoElement:0})),_i=N({},li,{clipboardData:function(e){return"clipboardData"in e?e.clipboardData:window.clipboardData}}),vi=ri(_i),yi=ri(N({},li,{data:0})),wi={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},bi={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},Ci={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function Si(e){var t=this.nativeEvent;return t.getModifierState?t.getModifierState(e):!!(e=Ci[e])&&!!t[e]}function Ei(){return Si}var Ti=N({},hi,{key:function(e){if(e.key){var t=wi[e.key]||e.key;if("Unidentified"!==t)return t}return"keypress"===e.type?13===(e=ti(e))?"Enter":String.fromCharCode(e):"keydown"===e.type||"keyup"===e.type?bi[e.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:Ei,charCode:function(e){return"keypress"===e.type?ti(e):0},keyCode:function(e){return"keydown"===e.type||"keyup"===e.type?e.keyCode:0},which:function(e){return"keypress"===e.type?ti(e):"keydown"===e.type||"keyup"===e.type?e.keyCode:0}}),xi=ri(Ti),Ii=ri(N({},di,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0})),Ai=ri(N({},hi,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:Ei})),Oi=ri(N({},li,{propertyName:0,elapsedTime:0,pseudoElement:0})),Ri=N({},di,{deltaX:function(e){return"deltaX"in e?e.deltaX:"wheelDeltaX"in e?-e.wheelDeltaX:0},deltaY:function(e){return"deltaY"in e?e.deltaY:"wheelDeltaY"in e?-e.wheelDeltaY:"wheelDelta"in e?-e.wheelDelta:0},deltaZ:0,deltaMode:0}),Di=ri(Ri),Li=[9,13,27,32],ki=h&&"CompositionEvent"in window,Mi=null;h&&"documentMode"in document&&(Mi=document.documentMode);var Pi=h&&"TextEvent"in window&&!Mi,Fi=h&&(!ki||Mi&&8<Mi&&11>=Mi),Ni=String.fromCharCode(32),Bi=!1;function ji(e,t){switch(e){case"keyup":return-1!==Li.indexOf(t.keyCode);case"keydown":return 229!==t.keyCode;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function Ui(e){return"object"===typeof(e=e.detail)&&"data"in e?e.data:null}var Vi=!1;var Gi={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function Wi(e){var t=e&&e.nodeName&&e.nodeName.toLowerCase();return"input"===t?!!Gi[e.type]:"textarea"===t}function zi(e,t,i,n){xe(n),0<(t=Yn(t,"onChange")).length&&(i=new ci("onChange","change",null,i,n),e.push({event:i,listeners:t}))}var Hi=null,Yi=null;function Xi(e){Bn(e,0)}function qi(e){if(X(wr(e)))return e}function Zi(e,t){if("change"===e)return t}var Ki=!1;if(h){var Qi;if(h){var Ji="oninput"in document;if(!Ji){var $i=document.createElement("div");$i.setAttribute("oninput","return;"),Ji="function"===typeof $i.oninput}Qi=Ji}else Qi=!1;Ki=Qi&&(!document.documentMode||9<document.documentMode)}function en(){Hi&&(Hi.detachEvent("onpropertychange",tn),Yi=Hi=null)}function tn(e){if("value"===e.propertyName&&qi(Yi)){var t=[];zi(t,Yi,e,be(e)),De(Xi,t)}}function nn(e,t,i){"focusin"===e?(en(),Yi=i,(Hi=t).attachEvent("onpropertychange",tn)):"focusout"===e&&en()}function rn(e){if("selectionchange"===e||"keyup"===e||"keydown"===e)return qi(Yi)}function sn(e,t){if("click"===e)return qi(t)}function on(e,t){if("input"===e||"change"===e)return qi(t)}var an="function"===typeof Object.is?Object.is:function(e,t){return e===t&&(0!==e||1/e===1/t)||e!==e&&t!==t};function ln(e,t){if(an(e,t))return!0;if("object"!==typeof e||null===e||"object"!==typeof t||null===t)return!1;var i=Object.keys(e),n=Object.keys(t);if(i.length!==n.length)return!1;for(n=0;n<i.length;n++){var r=i[n];if(!u.call(t,r)||!an(e[r],t[r]))return!1}return!0}function cn(e){for(;e&&e.firstChild;)e=e.firstChild;return e}function hn(e,t){var i,n=cn(e);for(e=0;n;){if(3===n.nodeType){if(i=e+n.textContent.length,e<=t&&i>=t)return{node:n,offset:t-e};e=i}e:{for(;n;){if(n.nextSibling){n=n.nextSibling;break e}n=n.parentNode}n=void 0}n=cn(n)}}function un(e,t){return!(!e||!t)&&(e===t||(!e||3!==e.nodeType)&&(t&&3===t.nodeType?un(e,t.parentNode):"contains"in e?e.contains(t):!!e.compareDocumentPosition&&!!(16&e.compareDocumentPosition(t))))}function dn(){for(var e=window,t=q();t instanceof e.HTMLIFrameElement;){try{var i="string"===typeof t.contentWindow.location.href}catch(n){i=!1}if(!i)break;t=q((e=t.contentWindow).document)}return t}function fn(e){var t=e&&e.nodeName&&e.nodeName.toLowerCase();return t&&("input"===t&&("text"===e.type||"search"===e.type||"tel"===e.type||"url"===e.type||"password"===e.type)||"textarea"===t||"true"===e.contentEditable)}function gn(e){var t=dn(),i=e.focusedElem,n=e.selectionRange;if(t!==i&&i&&i.ownerDocument&&un(i.ownerDocument.documentElement,i)){if(null!==n&&fn(i))if(t=n.start,void 0===(e=n.end)&&(e=t),"selectionStart"in i)i.selectionStart=t,i.selectionEnd=Math.min(e,i.value.length);else if((e=(t=i.ownerDocument||document)&&t.defaultView||window).getSelection){e=e.getSelection();var r=i.textContent.length,s=Math.min(n.start,r);n=void 0===n.end?s:Math.min(n.end,r),!e.extend&&s>n&&(r=n,n=s,s=r),r=hn(i,s);var o=hn(i,n);r&&o&&(1!==e.rangeCount||e.anchorNode!==r.node||e.anchorOffset!==r.offset||e.focusNode!==o.node||e.focusOffset!==o.offset)&&((t=t.createRange()).setStart(r.node,r.offset),e.removeAllRanges(),s>n?(e.addRange(t),e.extend(o.node,o.offset)):(t.setEnd(o.node,o.offset),e.addRange(t)))}for(t=[],e=i;e=e.parentNode;)1===e.nodeType&&t.push({element:e,left:e.scrollLeft,top:e.scrollTop});for("function"===typeof i.focus&&i.focus(),i=0;i<t.length;i++)(e=t[i]).element.scrollLeft=e.left,e.element.scrollTop=e.top}}var pn=h&&"documentMode"in document&&11>=document.documentMode,mn=null,_n=null,vn=null,yn=!1;function wn(e,t,i){var n=i.window===i?i.document:9===i.nodeType?i:i.ownerDocument;yn||null==mn||mn!==q(n)||("selectionStart"in(n=mn)&&fn(n)?n={start:n.selectionStart,end:n.selectionEnd}:n={anchorNode:(n=(n.ownerDocument&&n.ownerDocument.defaultView||window).getSelection()).anchorNode,anchorOffset:n.anchorOffset,focusNode:n.focusNode,focusOffset:n.focusOffset},vn&&ln(vn,n)||(vn=n,0<(n=Yn(_n,"onSelect")).length&&(t=new ci("onSelect","select",null,t,i),e.push({event:t,listeners:n}),t.target=mn)))}function bn(e,t){var i={};return i[e.toLowerCase()]=t.toLowerCase(),i["Webkit"+e]="webkit"+t,i["Moz"+e]="moz"+t,i}var Cn={animationend:bn("Animation","AnimationEnd"),animationiteration:bn("Animation","AnimationIteration"),animationstart:bn("Animation","AnimationStart"),transitionend:bn("Transition","TransitionEnd")},Sn={},En={};function Tn(e){if(Sn[e])return Sn[e];if(!Cn[e])return e;var t,i=Cn[e];for(t in i)if(i.hasOwnProperty(t)&&t in En)return Sn[e]=i[t];return e}h&&(En=document.createElement("div").style,"AnimationEvent"in window||(delete Cn.animationend.animation,delete Cn.animationiteration.animation,delete Cn.animationstart.animation),"TransitionEvent"in window||delete Cn.transitionend.transition);var xn=Tn("animationend"),In=Tn("animationiteration"),An=Tn("animationstart"),On=Tn("transitionend"),Rn=new Map,Dn="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function Ln(e,t){Rn.set(e,t),l(t,[e])}for(var kn=0;kn<Dn.length;kn++){var Mn=Dn[kn];Ln(Mn.toLowerCase(),"on"+(Mn[0].toUpperCase()+Mn.slice(1)))}Ln(xn,"onAnimationEnd"),Ln(In,"onAnimationIteration"),Ln(An,"onAnimationStart"),Ln("dblclick","onDoubleClick"),Ln("focusin","onFocus"),Ln("focusout","onBlur"),Ln(On,"onTransitionEnd"),c("onMouseEnter",["mouseout","mouseover"]),c("onMouseLeave",["mouseout","mouseover"]),c("onPointerEnter",["pointerout","pointerover"]),c("onPointerLeave",["pointerout","pointerover"]),l("onChange","change click focusin focusout input keydown keyup selectionchange".split(" ")),l("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" ")),l("onBeforeInput",["compositionend","keypress","textInput","paste"]),l("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" ")),l("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" ")),l("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var Pn="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),Fn=new Set("cancel close invalid load scroll toggle".split(" ").concat(Pn));function Nn(e,t,i){var n=e.type||"unknown-event";e.currentTarget=i,function(e,t,i,n,r,o,a,l,c){if(Ve.apply(this,arguments),Fe){if(!Fe)throw Error(s(198));var h=Ne;Fe=!1,Ne=null,Be||(Be=!0,je=h)}}(n,t,void 0,e),e.currentTarget=null}function Bn(e,t){t=0!==(4&t);for(var i=0;i<e.length;i++){var n=e[i],r=n.event;n=n.listeners;e:{var s=void 0;if(t)for(var o=n.length-1;0<=o;o--){var a=n[o],l=a.instance,c=a.currentTarget;if(a=a.listener,l!==s&&r.isPropagationStopped())break e;Nn(r,a,c),s=l}else for(o=0;o<n.length;o++){if(l=(a=n[o]).instance,c=a.currentTarget,a=a.listener,l!==s&&r.isPropagationStopped())break e;Nn(r,a,c),s=l}}}if(Be)throw e=je,Be=!1,je=null,e}function jn(e,t){var i=t[pr];void 0===i&&(i=t[pr]=new Set);var n=e+"__bubble";i.has(n)||(Wn(t,e,2,!1),i.add(n))}function Un(e,t,i){var n=0;t&&(n|=4),Wn(i,e,n,t)}var Vn="_reactListening"+Math.random().toString(36).slice(2);function Gn(e){if(!e[Vn]){e[Vn]=!0,o.forEach((function(t){"selectionchange"!==t&&(Fn.has(t)||Un(t,!1,e),Un(t,!0,e))}));var t=9===e.nodeType?e:e.ownerDocument;null===t||t[Vn]||(t[Vn]=!0,Un("selectionchange",!1,t))}}function Wn(e,t,i,n){switch(Kt(t)){case 1:var r=Ht;break;case 4:r=Yt;break;default:r=Xt}i=r.bind(null,t,i,e),r=void 0,!ke||"touchstart"!==t&&"touchmove"!==t&&"wheel"!==t||(r=!0),n?void 0!==r?e.addEventListener(t,i,{capture:!0,passive:r}):e.addEventListener(t,i,!0):void 0!==r?e.addEventListener(t,i,{passive:r}):e.addEventListener(t,i,!1)}function zn(e,t,i,n,r){var s=n;if(0===(1&t)&&0===(2&t)&&null!==n)e:for(;;){if(null===n)return;var o=n.tag;if(3===o||4===o){var a=n.stateNode.containerInfo;if(a===r||8===a.nodeType&&a.parentNode===r)break;if(4===o)for(o=n.return;null!==o;){var l=o.tag;if((3===l||4===l)&&((l=o.stateNode.containerInfo)===r||8===l.nodeType&&l.parentNode===r))return;o=o.return}for(;null!==a;){if(null===(o=vr(a)))return;if(5===(l=o.tag)||6===l){n=s=o;continue e}a=a.parentNode}}n=n.return}De((function(){var n=s,r=be(i),o=[];e:{var a=Rn.get(e);if(void 0!==a){var l=ci,c=e;switch(e){case"keypress":if(0===ti(i))break e;case"keydown":case"keyup":l=xi;break;case"focusin":c="focus",l=pi;break;case"focusout":c="blur",l=pi;break;case"beforeblur":case"afterblur":l=pi;break;case"click":if(2===i.button)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":l=fi;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":l=gi;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":l=Ai;break;case xn:case In:case An:l=mi;break;case On:l=Oi;break;case"scroll":l=ui;break;case"wheel":l=Di;break;case"copy":case"cut":case"paste":l=vi;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":l=Ii}var h=0!==(4&t),u=!h&&"scroll"===e,d=h?null!==a?a+"Capture":null:a;h=[];for(var f,g=n;null!==g;){var p=(f=g).stateNode;if(5===f.tag&&null!==p&&(f=p,null!==d&&(null!=(p=Le(g,d))&&h.push(Hn(g,p,f)))),u)break;g=g.return}0<h.length&&(a=new l(a,c,null,i,r),o.push({event:a,listeners:h}))}}if(0===(7&t)){if(l="mouseout"===e||"pointerout"===e,(!(a="mouseover"===e||"pointerover"===e)||i===we||!(c=i.relatedTarget||i.fromElement)||!vr(c)&&!c[gr])&&(l||a)&&(a=r.window===r?r:(a=r.ownerDocument)?a.defaultView||a.parentWindow:window,l?(l=n,null!==(c=(c=i.relatedTarget||i.toElement)?vr(c):null)&&(c!==(u=Ge(c))||5!==c.tag&&6!==c.tag)&&(c=null)):(l=null,c=n),l!==c)){if(h=fi,p="onMouseLeave",d="onMouseEnter",g="mouse","pointerout"!==e&&"pointerover"!==e||(h=Ii,p="onPointerLeave",d="onPointerEnter",g="pointer"),u=null==l?a:wr(l),f=null==c?a:wr(c),(a=new h(p,g+"leave",l,i,r)).target=u,a.relatedTarget=f,p=null,vr(r)===n&&((h=new h(d,g+"enter",c,i,r)).target=f,h.relatedTarget=u,p=h),u=p,l&&c)e:{for(d=c,g=0,f=h=l;f;f=Xn(f))g++;for(f=0,p=d;p;p=Xn(p))f++;for(;0<g-f;)h=Xn(h),g--;for(;0<f-g;)d=Xn(d),f--;for(;g--;){if(h===d||null!==d&&h===d.alternate)break e;h=Xn(h),d=Xn(d)}h=null}else h=null;null!==l&&qn(o,a,l,h,!1),null!==c&&null!==u&&qn(o,u,c,h,!0)}if("select"===(l=(a=n?wr(n):window).nodeName&&a.nodeName.toLowerCase())||"input"===l&&"file"===a.type)var m=Zi;else if(Wi(a))if(Ki)m=on;else{m=rn;var _=nn}else(l=a.nodeName)&&"input"===l.toLowerCase()&&("checkbox"===a.type||"radio"===a.type)&&(m=sn);switch(m&&(m=m(e,n))?zi(o,m,i,r):(_&&_(e,a,n),"focusout"===e&&(_=a._wrapperState)&&_.controlled&&"number"===a.type&&ee(a,"number",a.value)),_=n?wr(n):window,e){case"focusin":(Wi(_)||"true"===_.contentEditable)&&(mn=_,_n=n,vn=null);break;case"focusout":vn=_n=mn=null;break;case"mousedown":yn=!0;break;case"contextmenu":case"mouseup":case"dragend":yn=!1,wn(o,i,r);break;case"selectionchange":if(pn)break;case"keydown":case"keyup":wn(o,i,r)}var v;if(ki)e:{switch(e){case"compositionstart":var y="onCompositionStart";break e;case"compositionend":y="onCompositionEnd";break e;case"compositionupdate":y="onCompositionUpdate";break e}y=void 0}else Vi?ji(e,i)&&(y="onCompositionEnd"):"keydown"===e&&229===i.keyCode&&(y="onCompositionStart");y&&(Fi&&"ko"!==i.locale&&(Vi||"onCompositionStart"!==y?"onCompositionEnd"===y&&Vi&&(v=ei()):(Jt="value"in(Qt=r)?Qt.value:Qt.textContent,Vi=!0)),0<(_=Yn(n,y)).length&&(y=new yi(y,e,null,i,r),o.push({event:y,listeners:_}),v?y.data=v:null!==(v=Ui(i))&&(y.data=v))),(v=Pi?function(e,t){switch(e){case"compositionend":return Ui(t);case"keypress":return 32!==t.which?null:(Bi=!0,Ni);case"textInput":return(e=t.data)===Ni&&Bi?null:e;default:return null}}(e,i):function(e,t){if(Vi)return"compositionend"===e||!ki&&ji(e,t)?(e=ei(),$t=Jt=Qt=null,Vi=!1,e):null;switch(e){case"paste":default:return null;case"keypress":if(!(t.ctrlKey||t.altKey||t.metaKey)||t.ctrlKey&&t.altKey){if(t.char&&1<t.char.length)return t.char;if(t.which)return String.fromCharCode(t.which)}return null;case"compositionend":return Fi&&"ko"!==t.locale?null:t.data}}(e,i))&&(0<(n=Yn(n,"onBeforeInput")).length&&(r=new yi("onBeforeInput","beforeinput",null,i,r),o.push({event:r,listeners:n}),r.data=v))}Bn(o,t)}))}function Hn(e,t,i){return{instance:e,listener:t,currentTarget:i}}function Yn(e,t){for(var i=t+"Capture",n=[];null!==e;){var r=e,s=r.stateNode;5===r.tag&&null!==s&&(r=s,null!=(s=Le(e,i))&&n.unshift(Hn(e,s,r)),null!=(s=Le(e,t))&&n.push(Hn(e,s,r))),e=e.return}return n}function Xn(e){if(null===e)return null;do{e=e.return}while(e&&5!==e.tag);return e||null}function qn(e,t,i,n,r){for(var s=t._reactName,o=[];null!==i&&i!==n;){var a=i,l=a.alternate,c=a.stateNode;if(null!==l&&l===n)break;5===a.tag&&null!==c&&(a=c,r?null!=(l=Le(i,s))&&o.unshift(Hn(i,l,a)):r||null!=(l=Le(i,s))&&o.push(Hn(i,l,a))),i=i.return}0!==o.length&&e.push({event:t,listeners:o})}var Zn=/\r\n?/g,Kn=/\u0000|\uFFFD/g;function Qn(e){return("string"===typeof e?e:""+e).replace(Zn,"\n").replace(Kn,"")}function Jn(e,t,i){if(t=Qn(t),Qn(e)!==t&&i)throw Error(s(425))}function $n(){}var er=null,tr=null;function ir(e,t){return"textarea"===e||"noscript"===e||"string"===typeof t.children||"number"===typeof t.children||"object"===typeof t.dangerouslySetInnerHTML&&null!==t.dangerouslySetInnerHTML&&null!=t.dangerouslySetInnerHTML.__html}var nr="function"===typeof setTimeout?setTimeout:void 0,rr="function"===typeof clearTimeout?clearTimeout:void 0,sr="function"===typeof Promise?Promise:void 0,or="function"===typeof queueMicrotask?queueMicrotask:"undefined"!==typeof sr?function(e){return sr.resolve(null).then(e).catch(ar)}:nr;function ar(e){setTimeout((function(){throw e}))}function lr(e,t){var i=t,n=0;do{var r=i.nextSibling;if(e.removeChild(i),r&&8===r.nodeType)if("/$"===(i=r.data)){if(0===n)return e.removeChild(r),void Gt(t);n--}else"$"!==i&&"$?"!==i&&"$!"!==i||n++;i=r}while(i);Gt(t)}function cr(e){for(;null!=e;e=e.nextSibling){var t=e.nodeType;if(1===t||3===t)break;if(8===t){if("$"===(t=e.data)||"$!"===t||"$?"===t)break;if("/$"===t)return null}}return e}function hr(e){e=e.previousSibling;for(var t=0;e;){if(8===e.nodeType){var i=e.data;if("$"===i||"$!"===i||"$?"===i){if(0===t)return e;t--}else"/$"===i&&t++}e=e.previousSibling}return null}var ur=Math.random().toString(36).slice(2),dr="__reactFiber$"+ur,fr="__reactProps$"+ur,gr="__reactContainer$"+ur,pr="__reactEvents$"+ur,mr="__reactListeners$"+ur,_r="__reactHandles$"+ur;function vr(e){var t=e[dr];if(t)return t;for(var i=e.parentNode;i;){if(t=i[gr]||i[dr]){if(i=t.alternate,null!==t.child||null!==i&&null!==i.child)for(e=hr(e);null!==e;){if(i=e[dr])return i;e=hr(e)}return t}i=(e=i).parentNode}return null}function yr(e){return!(e=e[dr]||e[gr])||5!==e.tag&&6!==e.tag&&13!==e.tag&&3!==e.tag?null:e}function wr(e){if(5===e.tag||6===e.tag)return e.stateNode;throw Error(s(33))}function br(e){return e[fr]||null}var Cr=[],Sr=-1;function Er(e){return{current:e}}function Tr(e){0>Sr||(e.current=Cr[Sr],Cr[Sr]=null,Sr--)}function xr(e,t){Sr++,Cr[Sr]=e.current,e.current=t}var Ir={},Ar=Er(Ir),Or=Er(!1),Rr=Ir;function Dr(e,t){var i=e.type.contextTypes;if(!i)return Ir;var n=e.stateNode;if(n&&n.__reactInternalMemoizedUnmaskedChildContext===t)return n.__reactInternalMemoizedMaskedChildContext;var r,s={};for(r in i)s[r]=t[r];return n&&((e=e.stateNode).__reactInternalMemoizedUnmaskedChildContext=t,e.__reactInternalMemoizedMaskedChildContext=s),s}function Lr(e){return null!==(e=e.childContextTypes)&&void 0!==e}function kr(){Tr(Or),Tr(Ar)}function Mr(e,t,i){if(Ar.current!==Ir)throw Error(s(168));xr(Ar,t),xr(Or,i)}function Pr(e,t,i){var n=e.stateNode;if(t=t.childContextTypes,"function"!==typeof n.getChildContext)return i;for(var r in n=n.getChildContext())if(!(r in t))throw Error(s(108,W(e)||"Unknown",r));return N({},i,n)}function Fr(e){return e=(e=e.stateNode)&&e.__reactInternalMemoizedMergedChildContext||Ir,Rr=Ar.current,xr(Ar,e),xr(Or,Or.current),!0}function Nr(e,t,i){var n=e.stateNode;if(!n)throw Error(s(169));i?(e=Pr(e,t,Rr),n.__reactInternalMemoizedMergedChildContext=e,Tr(Or),Tr(Ar),xr(Ar,e)):Tr(Or),xr(Or,i)}var Br=null,jr=!1,Ur=!1;function Vr(e){null===Br?Br=[e]:Br.push(e)}function Gr(){if(!Ur&&null!==Br){Ur=!0;var e=0,t=yt;try{var i=Br;for(yt=1;e<i.length;e++){var n=i[e];do{n=n(!0)}while(null!==n)}Br=null,jr=!1}catch(r){throw null!==Br&&(Br=Br.slice(e+1)),Xe($e,Gr),r}finally{yt=t,Ur=!1}}return null}var Wr=[],zr=0,Hr=null,Yr=0,Xr=[],qr=0,Zr=null,Kr=1,Qr="";function Jr(e,t){Wr[zr++]=Yr,Wr[zr++]=Hr,Hr=e,Yr=t}function $r(e,t,i){Xr[qr++]=Kr,Xr[qr++]=Qr,Xr[qr++]=Zr,Zr=e;var n=Kr;e=Qr;var r=32-ot(n)-1;n&=~(1<<r),i+=1;var s=32-ot(t)+r;if(30<s){var o=r-r%5;s=(n&(1<<o)-1).toString(32),n>>=o,r-=o,Kr=1<<32-ot(t)+r|i<<r|n,Qr=s+e}else Kr=1<<s|i<<r|n,Qr=e}function es(e){null!==e.return&&(Jr(e,1),$r(e,1,0))}function ts(e){for(;e===Hr;)Hr=Wr[--zr],Wr[zr]=null,Yr=Wr[--zr],Wr[zr]=null;for(;e===Zr;)Zr=Xr[--qr],Xr[qr]=null,Qr=Xr[--qr],Xr[qr]=null,Kr=Xr[--qr],Xr[qr]=null}var is=null,ns=null,rs=!1,ss=null;function os(e,t){var i=Lc(5,null,null,0);i.elementType="DELETED",i.stateNode=t,i.return=e,null===(t=e.deletions)?(e.deletions=[i],e.flags|=16):t.push(i)}function as(e,t){switch(e.tag){case 5:var i=e.type;return null!==(t=1!==t.nodeType||i.toLowerCase()!==t.nodeName.toLowerCase()?null:t)&&(e.stateNode=t,is=e,ns=cr(t.firstChild),!0);case 6:return null!==(t=""===e.pendingProps||3!==t.nodeType?null:t)&&(e.stateNode=t,is=e,ns=null,!0);case 13:return null!==(t=8!==t.nodeType?null:t)&&(i=null!==Zr?{id:Kr,overflow:Qr}:null,e.memoizedState={dehydrated:t,treeContext:i,retryLane:1073741824},(i=Lc(18,null,null,0)).stateNode=t,i.return=e,e.child=i,is=e,ns=null,!0);default:return!1}}function ls(e){return 0!==(1&e.mode)&&0===(128&e.flags)}function cs(e){if(rs){var t=ns;if(t){var i=t;if(!as(e,t)){if(ls(e))throw Error(s(418));t=cr(i.nextSibling);var n=is;t&&as(e,t)?os(n,i):(e.flags=-4097&e.flags|2,rs=!1,is=e)}}else{if(ls(e))throw Error(s(418));e.flags=-4097&e.flags|2,rs=!1,is=e}}}function hs(e){for(e=e.return;null!==e&&5!==e.tag&&3!==e.tag&&13!==e.tag;)e=e.return;is=e}function us(e){if(e!==is)return!1;if(!rs)return hs(e),rs=!0,!1;var t;if((t=3!==e.tag)&&!(t=5!==e.tag)&&(t="head"!==(t=e.type)&&"body"!==t&&!ir(e.type,e.memoizedProps)),t&&(t=ns)){if(ls(e))throw ds(),Error(s(418));for(;t;)os(e,t),t=cr(t.nextSibling)}if(hs(e),13===e.tag){if(!(e=null!==(e=e.memoizedState)?e.dehydrated:null))throw Error(s(317));e:{for(e=e.nextSibling,t=0;e;){if(8===e.nodeType){var i=e.data;if("/$"===i){if(0===t){ns=cr(e.nextSibling);break e}t--}else"$"!==i&&"$!"!==i&&"$?"!==i||t++}e=e.nextSibling}ns=null}}else ns=is?cr(e.stateNode.nextSibling):null;return!0}function ds(){for(var e=ns;e;)e=cr(e.nextSibling)}function fs(){ns=is=null,rs=!1}function gs(e){null===ss?ss=[e]:ss.push(e)}var ps=w.ReactCurrentBatchConfig;function ms(e,t){if(e&&e.defaultProps){for(var i in t=N({},t),e=e.defaultProps)void 0===t[i]&&(t[i]=e[i]);return t}return t}var _s=Er(null),vs=null,ys=null,ws=null;function bs(){ws=ys=vs=null}function Cs(e){var t=_s.current;Tr(_s),e._currentValue=t}function Ss(e,t,i){for(;null!==e;){var n=e.alternate;if((e.childLanes&t)!==t?(e.childLanes|=t,null!==n&&(n.childLanes|=t)):null!==n&&(n.childLanes&t)!==t&&(n.childLanes|=t),e===i)break;e=e.return}}function Es(e,t){vs=e,ws=ys=null,null!==(e=e.dependencies)&&null!==e.firstContext&&(0!==(e.lanes&t)&&(wa=!0),e.firstContext=null)}function Ts(e){var t=e._currentValue;if(ws!==e)if(e={context:e,memoizedValue:t,next:null},null===ys){if(null===vs)throw Error(s(308));ys=e,vs.dependencies={lanes:0,firstContext:e}}else ys=ys.next=e;return t}var xs=null;function Is(e){null===xs?xs=[e]:xs.push(e)}function As(e,t,i,n){var r=t.interleaved;return null===r?(i.next=i,Is(t)):(i.next=r.next,r.next=i),t.interleaved=i,Os(e,n)}function Os(e,t){e.lanes|=t;var i=e.alternate;for(null!==i&&(i.lanes|=t),i=e,e=e.return;null!==e;)e.childLanes|=t,null!==(i=e.alternate)&&(i.childLanes|=t),i=e,e=e.return;return 3===i.tag?i.stateNode:null}var Rs=!1;function Ds(e){e.updateQueue={baseState:e.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function Ls(e,t){e=e.updateQueue,t.updateQueue===e&&(t.updateQueue={baseState:e.baseState,firstBaseUpdate:e.firstBaseUpdate,lastBaseUpdate:e.lastBaseUpdate,shared:e.shared,effects:e.effects})}function ks(e,t){return{eventTime:e,lane:t,tag:0,payload:null,callback:null,next:null}}function Ms(e,t,i){var n=e.updateQueue;if(null===n)return null;if(n=n.shared,0!==(2&Ol)){var r=n.pending;return null===r?t.next=t:(t.next=r.next,r.next=t),n.pending=t,Os(e,i)}return null===(r=n.interleaved)?(t.next=t,Is(n)):(t.next=r.next,r.next=t),n.interleaved=t,Os(e,i)}function Ps(e,t,i){if(null!==(t=t.updateQueue)&&(t=t.shared,0!==(4194240&i))){var n=t.lanes;i|=n&=e.pendingLanes,t.lanes=i,vt(e,i)}}function Fs(e,t){var i=e.updateQueue,n=e.alternate;if(null!==n&&i===(n=n.updateQueue)){var r=null,s=null;if(null!==(i=i.firstBaseUpdate)){do{var o={eventTime:i.eventTime,lane:i.lane,tag:i.tag,payload:i.payload,callback:i.callback,next:null};null===s?r=s=o:s=s.next=o,i=i.next}while(null!==i);null===s?r=s=t:s=s.next=t}else r=s=t;return i={baseState:n.baseState,firstBaseUpdate:r,lastBaseUpdate:s,shared:n.shared,effects:n.effects},void(e.updateQueue=i)}null===(e=i.lastBaseUpdate)?i.firstBaseUpdate=t:e.next=t,i.lastBaseUpdate=t}function Ns(e,t,i,n){var r=e.updateQueue;Rs=!1;var s=r.firstBaseUpdate,o=r.lastBaseUpdate,a=r.shared.pending;if(null!==a){r.shared.pending=null;var l=a,c=l.next;l.next=null,null===o?s=c:o.next=c,o=l;var h=e.alternate;null!==h&&((a=(h=h.updateQueue).lastBaseUpdate)!==o&&(null===a?h.firstBaseUpdate=c:a.next=c,h.lastBaseUpdate=l))}if(null!==s){var u=r.baseState;for(o=0,h=c=l=null,a=s;;){var d=a.lane,f=a.eventTime;if((n&d)===d){null!==h&&(h=h.next={eventTime:f,lane:0,tag:a.tag,payload:a.payload,callback:a.callback,next:null});e:{var g=e,p=a;switch(d=t,f=i,p.tag){case 1:if("function"===typeof(g=p.payload)){u=g.call(f,u,d);break e}u=g;break e;case 3:g.flags=-65537&g.flags|128;case 0:if(null===(d="function"===typeof(g=p.payload)?g.call(f,u,d):g)||void 0===d)break e;u=N({},u,d);break e;case 2:Rs=!0}}null!==a.callback&&0!==a.lane&&(e.flags|=64,null===(d=r.effects)?r.effects=[a]:d.push(a))}else f={eventTime:f,lane:d,tag:a.tag,payload:a.payload,callback:a.callback,next:null},null===h?(c=h=f,l=u):h=h.next=f,o|=d;if(null===(a=a.next)){if(null===(a=r.shared.pending))break;a=(d=a).next,d.next=null,r.lastBaseUpdate=d,r.shared.pending=null}}if(null===h&&(l=u),r.baseState=l,r.firstBaseUpdate=c,r.lastBaseUpdate=h,null!==(t=r.shared.interleaved)){r=t;do{o|=r.lane,r=r.next}while(r!==t)}else null===s&&(r.shared.lanes=0);Nl|=o,e.lanes=o,e.memoizedState=u}}function Bs(e,t,i){if(e=t.effects,t.effects=null,null!==e)for(t=0;t<e.length;t++){var n=e[t],r=n.callback;if(null!==r){if(n.callback=null,n=i,"function"!==typeof r)throw Error(s(191,r));r.call(n)}}}var js=(new n.Component).refs;function Us(e,t,i,n){i=null===(i=i(n,t=e.memoizedState))||void 0===i?t:N({},t,i),e.memoizedState=i,0===e.lanes&&(e.updateQueue.baseState=i)}var Vs={isMounted:function(e){return!!(e=e._reactInternals)&&Ge(e)===e},enqueueSetState:function(e,t,i){e=e._reactInternals;var n=tc(),r=ic(e),s=ks(n,r);s.payload=t,void 0!==i&&null!==i&&(s.callback=i),null!==(t=Ms(e,s,r))&&(nc(t,e,r,n),Ps(t,e,r))},enqueueReplaceState:function(e,t,i){e=e._reactInternals;var n=tc(),r=ic(e),s=ks(n,r);s.tag=1,s.payload=t,void 0!==i&&null!==i&&(s.callback=i),null!==(t=Ms(e,s,r))&&(nc(t,e,r,n),Ps(t,e,r))},enqueueForceUpdate:function(e,t){e=e._reactInternals;var i=tc(),n=ic(e),r=ks(i,n);r.tag=2,void 0!==t&&null!==t&&(r.callback=t),null!==(t=Ms(e,r,n))&&(nc(t,e,n,i),Ps(t,e,n))}};function Gs(e,t,i,n,r,s,o){return"function"===typeof(e=e.stateNode).shouldComponentUpdate?e.shouldComponentUpdate(n,s,o):!t.prototype||!t.prototype.isPureReactComponent||(!ln(i,n)||!ln(r,s))}function Ws(e,t,i){var n=!1,r=Ir,s=t.contextType;return"object"===typeof s&&null!==s?s=Ts(s):(r=Lr(t)?Rr:Ar.current,s=(n=null!==(n=t.contextTypes)&&void 0!==n)?Dr(e,r):Ir),t=new t(i,s),e.memoizedState=null!==t.state&&void 0!==t.state?t.state:null,t.updater=Vs,e.stateNode=t,t._reactInternals=e,n&&((e=e.stateNode).__reactInternalMemoizedUnmaskedChildContext=r,e.__reactInternalMemoizedMaskedChildContext=s),t}function zs(e,t,i,n){e=t.state,"function"===typeof t.componentWillReceiveProps&&t.componentWillReceiveProps(i,n),"function"===typeof t.UNSAFE_componentWillReceiveProps&&t.UNSAFE_componentWillReceiveProps(i,n),t.state!==e&&Vs.enqueueReplaceState(t,t.state,null)}function Hs(e,t,i,n){var r=e.stateNode;r.props=i,r.state=e.memoizedState,r.refs=js,Ds(e);var s=t.contextType;"object"===typeof s&&null!==s?r.context=Ts(s):(s=Lr(t)?Rr:Ar.current,r.context=Dr(e,s)),r.state=e.memoizedState,"function"===typeof(s=t.getDerivedStateFromProps)&&(Us(e,t,s,i),r.state=e.memoizedState),"function"===typeof t.getDerivedStateFromProps||"function"===typeof r.getSnapshotBeforeUpdate||"function"!==typeof r.UNSAFE_componentWillMount&&"function"!==typeof r.componentWillMount||(t=r.state,"function"===typeof r.componentWillMount&&r.componentWillMount(),"function"===typeof r.UNSAFE_componentWillMount&&r.UNSAFE_componentWillMount(),t!==r.state&&Vs.enqueueReplaceState(r,r.state,null),Ns(e,i,r,n),r.state=e.memoizedState),"function"===typeof r.componentDidMount&&(e.flags|=4194308)}function Ys(e,t,i){if(null!==(e=i.ref)&&"function"!==typeof e&&"object"!==typeof e){if(i._owner){if(i=i._owner){if(1!==i.tag)throw Error(s(309));var n=i.stateNode}if(!n)throw Error(s(147,e));var r=n,o=""+e;return null!==t&&null!==t.ref&&"function"===typeof t.ref&&t.ref._stringRef===o?t.ref:(t=function(e){var t=r.refs;t===js&&(t=r.refs={}),null===e?delete t[o]:t[o]=e},t._stringRef=o,t)}if("string"!==typeof e)throw Error(s(284));if(!i._owner)throw Error(s(290,e))}return e}function Xs(e,t){throw e=Object.prototype.toString.call(t),Error(s(31,"[object Object]"===e?"object with keys {"+Object.keys(t).join(", ")+"}":e))}function qs(e){return(0,e._init)(e._payload)}function Zs(e){function t(t,i){if(e){var n=t.deletions;null===n?(t.deletions=[i],t.flags|=16):n.push(i)}}function i(i,n){if(!e)return null;for(;null!==n;)t(i,n),n=n.sibling;return null}function n(e,t){for(e=new Map;null!==t;)null!==t.key?e.set(t.key,t):e.set(t.index,t),t=t.sibling;return e}function r(e,t){return(e=Mc(e,t)).index=0,e.sibling=null,e}function o(t,i,n){return t.index=n,e?null!==(n=t.alternate)?(n=n.index)<i?(t.flags|=2,i):n:(t.flags|=2,i):(t.flags|=1048576,i)}function a(t){return e&&null===t.alternate&&(t.flags|=2),t}function l(e,t,i,n){return null===t||6!==t.tag?((t=Bc(i,e.mode,n)).return=e,t):((t=r(t,i)).return=e,t)}function c(e,t,i,n){var s=i.type;return s===S?u(e,t,i.props.children,n,i.key):null!==t&&(t.elementType===s||"object"===typeof s&&null!==s&&s.$$typeof===L&&qs(s)===t.type)?((n=r(t,i.props)).ref=Ys(e,t,i),n.return=e,n):((n=Pc(i.type,i.key,i.props,null,e.mode,n)).ref=Ys(e,t,i),n.return=e,n)}function h(e,t,i,n){return null===t||4!==t.tag||t.stateNode.containerInfo!==i.containerInfo||t.stateNode.implementation!==i.implementation?((t=jc(i,e.mode,n)).return=e,t):((t=r(t,i.children||[])).return=e,t)}function u(e,t,i,n,s){return null===t||7!==t.tag?((t=Fc(i,e.mode,n,s)).return=e,t):((t=r(t,i)).return=e,t)}function d(e,t,i){if("string"===typeof t&&""!==t||"number"===typeof t)return(t=Bc(""+t,e.mode,i)).return=e,t;if("object"===typeof t&&null!==t){switch(t.$$typeof){case b:return(i=Pc(t.type,t.key,t.props,null,e.mode,i)).ref=Ys(e,null,t),i.return=e,i;case C:return(t=jc(t,e.mode,i)).return=e,t;case L:return d(e,(0,t._init)(t._payload),i)}if(te(t)||P(t))return(t=Fc(t,e.mode,i,null)).return=e,t;Xs(e,t)}return null}function f(e,t,i,n){var r=null!==t?t.key:null;if("string"===typeof i&&""!==i||"number"===typeof i)return null!==r?null:l(e,t,""+i,n);if("object"===typeof i&&null!==i){switch(i.$$typeof){case b:return i.key===r?c(e,t,i,n):null;case C:return i.key===r?h(e,t,i,n):null;case L:return f(e,t,(r=i._init)(i._payload),n)}if(te(i)||P(i))return null!==r?null:u(e,t,i,n,null);Xs(e,i)}return null}function g(e,t,i,n,r){if("string"===typeof n&&""!==n||"number"===typeof n)return l(t,e=e.get(i)||null,""+n,r);if("object"===typeof n&&null!==n){switch(n.$$typeof){case b:return c(t,e=e.get(null===n.key?i:n.key)||null,n,r);case C:return h(t,e=e.get(null===n.key?i:n.key)||null,n,r);case L:return g(e,t,i,(0,n._init)(n._payload),r)}if(te(n)||P(n))return u(t,e=e.get(i)||null,n,r,null);Xs(t,n)}return null}function p(r,s,a,l){for(var c=null,h=null,u=s,p=s=0,m=null;null!==u&&p<a.length;p++){u.index>p?(m=u,u=null):m=u.sibling;var _=f(r,u,a[p],l);if(null===_){null===u&&(u=m);break}e&&u&&null===_.alternate&&t(r,u),s=o(_,s,p),null===h?c=_:h.sibling=_,h=_,u=m}if(p===a.length)return i(r,u),rs&&Jr(r,p),c;if(null===u){for(;p<a.length;p++)null!==(u=d(r,a[p],l))&&(s=o(u,s,p),null===h?c=u:h.sibling=u,h=u);return rs&&Jr(r,p),c}for(u=n(r,u);p<a.length;p++)null!==(m=g(u,r,p,a[p],l))&&(e&&null!==m.alternate&&u.delete(null===m.key?p:m.key),s=o(m,s,p),null===h?c=m:h.sibling=m,h=m);return e&&u.forEach((function(e){return t(r,e)})),rs&&Jr(r,p),c}function m(r,a,l,c){var h=P(l);if("function"!==typeof h)throw Error(s(150));if(null==(l=h.call(l)))throw Error(s(151));for(var u=h=null,p=a,m=a=0,_=null,v=l.next();null!==p&&!v.done;m++,v=l.next()){p.index>m?(_=p,p=null):_=p.sibling;var y=f(r,p,v.value,c);if(null===y){null===p&&(p=_);break}e&&p&&null===y.alternate&&t(r,p),a=o(y,a,m),null===u?h=y:u.sibling=y,u=y,p=_}if(v.done)return i(r,p),rs&&Jr(r,m),h;if(null===p){for(;!v.done;m++,v=l.next())null!==(v=d(r,v.value,c))&&(a=o(v,a,m),null===u?h=v:u.sibling=v,u=v);return rs&&Jr(r,m),h}for(p=n(r,p);!v.done;m++,v=l.next())null!==(v=g(p,r,m,v.value,c))&&(e&&null!==v.alternate&&p.delete(null===v.key?m:v.key),a=o(v,a,m),null===u?h=v:u.sibling=v,u=v);return e&&p.forEach((function(e){return t(r,e)})),rs&&Jr(r,m),h}return function e(n,s,o,l){if("object"===typeof o&&null!==o&&o.type===S&&null===o.key&&(o=o.props.children),"object"===typeof o&&null!==o){switch(o.$$typeof){case b:e:{for(var c=o.key,h=s;null!==h;){if(h.key===c){if((c=o.type)===S){if(7===h.tag){i(n,h.sibling),(s=r(h,o.props.children)).return=n,n=s;break e}}else if(h.elementType===c||"object"===typeof c&&null!==c&&c.$$typeof===L&&qs(c)===h.type){i(n,h.sibling),(s=r(h,o.props)).ref=Ys(n,h,o),s.return=n,n=s;break e}i(n,h);break}t(n,h),h=h.sibling}o.type===S?((s=Fc(o.props.children,n.mode,l,o.key)).return=n,n=s):((l=Pc(o.type,o.key,o.props,null,n.mode,l)).ref=Ys(n,s,o),l.return=n,n=l)}return a(n);case C:e:{for(h=o.key;null!==s;){if(s.key===h){if(4===s.tag&&s.stateNode.containerInfo===o.containerInfo&&s.stateNode.implementation===o.implementation){i(n,s.sibling),(s=r(s,o.children||[])).return=n,n=s;break e}i(n,s);break}t(n,s),s=s.sibling}(s=jc(o,n.mode,l)).return=n,n=s}return a(n);case L:return e(n,s,(h=o._init)(o._payload),l)}if(te(o))return p(n,s,o,l);if(P(o))return m(n,s,o,l);Xs(n,o)}return"string"===typeof o&&""!==o||"number"===typeof o?(o=""+o,null!==s&&6===s.tag?(i(n,s.sibling),(s=r(s,o)).return=n,n=s):(i(n,s),(s=Bc(o,n.mode,l)).return=n,n=s),a(n)):i(n,s)}}var Ks=Zs(!0),Qs=Zs(!1),Js={},$s=Er(Js),eo=Er(Js),to=Er(Js);function io(e){if(e===Js)throw Error(s(174));return e}function no(e,t){switch(xr(to,t),xr(eo,e),xr($s,Js),e=t.nodeType){case 9:case 11:t=(t=t.documentElement)?t.namespaceURI:le(null,"");break;default:t=le(t=(e=8===e?t.parentNode:t).namespaceURI||null,e=e.tagName)}Tr($s),xr($s,t)}function ro(){Tr($s),Tr(eo),Tr(to)}function so(e){io(to.current);var t=io($s.current),i=le(t,e.type);t!==i&&(xr(eo,e),xr($s,i))}function oo(e){eo.current===e&&(Tr($s),Tr(eo))}var ao=Er(0);function lo(e){for(var t=e;null!==t;){if(13===t.tag){var i=t.memoizedState;if(null!==i&&(null===(i=i.dehydrated)||"$?"===i.data||"$!"===i.data))return t}else if(19===t.tag&&void 0!==t.memoizedProps.revealOrder){if(0!==(128&t.flags))return t}else if(null!==t.child){t.child.return=t,t=t.child;continue}if(t===e)break;for(;null===t.sibling;){if(null===t.return||t.return===e)return null;t=t.return}t.sibling.return=t.return,t=t.sibling}return null}var co=[];function ho(){for(var e=0;e<co.length;e++)co[e]._workInProgressVersionPrimary=null;co.length=0}var uo=w.ReactCurrentDispatcher,fo=w.ReactCurrentBatchConfig,go=0,po=null,mo=null,_o=null,vo=!1,yo=!1,wo=0,bo=0;function Co(){throw Error(s(321))}function So(e,t){if(null===t)return!1;for(var i=0;i<t.length&&i<e.length;i++)if(!an(e[i],t[i]))return!1;return!0}function Eo(e,t,i,n,r,o){if(go=o,po=t,t.memoizedState=null,t.updateQueue=null,t.lanes=0,uo.current=null===e||null===e.memoizedState?aa:la,e=i(n,r),yo){o=0;do{if(yo=!1,wo=0,25<=o)throw Error(s(301));o+=1,_o=mo=null,t.updateQueue=null,uo.current=ca,e=i(n,r)}while(yo)}if(uo.current=oa,t=null!==mo&&null!==mo.next,go=0,_o=mo=po=null,vo=!1,t)throw Error(s(300));return e}function To(){var e=0!==wo;return wo=0,e}function xo(){var e={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return null===_o?po.memoizedState=_o=e:_o=_o.next=e,_o}function Io(){if(null===mo){var e=po.alternate;e=null!==e?e.memoizedState:null}else e=mo.next;var t=null===_o?po.memoizedState:_o.next;if(null!==t)_o=t,mo=e;else{if(null===e)throw Error(s(310));e={memoizedState:(mo=e).memoizedState,baseState:mo.baseState,baseQueue:mo.baseQueue,queue:mo.queue,next:null},null===_o?po.memoizedState=_o=e:_o=_o.next=e}return _o}function Ao(e,t){return"function"===typeof t?t(e):t}function Oo(e){var t=Io(),i=t.queue;if(null===i)throw Error(s(311));i.lastRenderedReducer=e;var n=mo,r=n.baseQueue,o=i.pending;if(null!==o){if(null!==r){var a=r.next;r.next=o.next,o.next=a}n.baseQueue=r=o,i.pending=null}if(null!==r){o=r.next,n=n.baseState;var l=a=null,c=null,h=o;do{var u=h.lane;if((go&u)===u)null!==c&&(c=c.next={lane:0,action:h.action,hasEagerState:h.hasEagerState,eagerState:h.eagerState,next:null}),n=h.hasEagerState?h.eagerState:e(n,h.action);else{var d={lane:u,action:h.action,hasEagerState:h.hasEagerState,eagerState:h.eagerState,next:null};null===c?(l=c=d,a=n):c=c.next=d,po.lanes|=u,Nl|=u}h=h.next}while(null!==h&&h!==o);null===c?a=n:c.next=l,an(n,t.memoizedState)||(wa=!0),t.memoizedState=n,t.baseState=a,t.baseQueue=c,i.lastRenderedState=n}if(null!==(e=i.interleaved)){r=e;do{o=r.lane,po.lanes|=o,Nl|=o,r=r.next}while(r!==e)}else null===r&&(i.lanes=0);return[t.memoizedState,i.dispatch]}function Ro(e){var t=Io(),i=t.queue;if(null===i)throw Error(s(311));i.lastRenderedReducer=e;var n=i.dispatch,r=i.pending,o=t.memoizedState;if(null!==r){i.pending=null;var a=r=r.next;do{o=e(o,a.action),a=a.next}while(a!==r);an(o,t.memoizedState)||(wa=!0),t.memoizedState=o,null===t.baseQueue&&(t.baseState=o),i.lastRenderedState=o}return[o,n]}function Do(){}function Lo(e,t){var i=po,n=Io(),r=t(),o=!an(n.memoizedState,r);if(o&&(n.memoizedState=r,wa=!0),n=n.queue,zo(Po.bind(null,i,n,e),[e]),n.getSnapshot!==t||o||null!==_o&&1&_o.memoizedState.tag){if(i.flags|=2048,jo(9,Mo.bind(null,i,n,r,t),void 0,null),null===Rl)throw Error(s(349));0!==(30&go)||ko(i,t,r)}return r}function ko(e,t,i){e.flags|=16384,e={getSnapshot:t,value:i},null===(t=po.updateQueue)?(t={lastEffect:null,stores:null},po.updateQueue=t,t.stores=[e]):null===(i=t.stores)?t.stores=[e]:i.push(e)}function Mo(e,t,i,n){t.value=i,t.getSnapshot=n,Fo(t)&&No(e)}function Po(e,t,i){return i((function(){Fo(t)&&No(e)}))}function Fo(e){var t=e.getSnapshot;e=e.value;try{var i=t();return!an(e,i)}catch(n){return!0}}function No(e){var t=Os(e,1);null!==t&&nc(t,e,1,-1)}function Bo(e){var t=xo();return"function"===typeof e&&(e=e()),t.memoizedState=t.baseState=e,e={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:Ao,lastRenderedState:e},t.queue=e,e=e.dispatch=ia.bind(null,po,e),[t.memoizedState,e]}function jo(e,t,i,n){return e={tag:e,create:t,destroy:i,deps:n,next:null},null===(t=po.updateQueue)?(t={lastEffect:null,stores:null},po.updateQueue=t,t.lastEffect=e.next=e):null===(i=t.lastEffect)?t.lastEffect=e.next=e:(n=i.next,i.next=e,e.next=n,t.lastEffect=e),e}function Uo(){return Io().memoizedState}function Vo(e,t,i,n){var r=xo();po.flags|=e,r.memoizedState=jo(1|t,i,void 0,void 0===n?null:n)}function Go(e,t,i,n){var r=Io();n=void 0===n?null:n;var s=void 0;if(null!==mo){var o=mo.memoizedState;if(s=o.destroy,null!==n&&So(n,o.deps))return void(r.memoizedState=jo(t,i,s,n))}po.flags|=e,r.memoizedState=jo(1|t,i,s,n)}function Wo(e,t){return Vo(8390656,8,e,t)}function zo(e,t){return Go(2048,8,e,t)}function Ho(e,t){return Go(4,2,e,t)}function Yo(e,t){return Go(4,4,e,t)}function Xo(e,t){return"function"===typeof t?(e=e(),t(e),function(){t(null)}):null!==t&&void 0!==t?(e=e(),t.current=e,function(){t.current=null}):void 0}function qo(e,t,i){return i=null!==i&&void 0!==i?i.concat([e]):null,Go(4,4,Xo.bind(null,t,e),i)}function Zo(){}function Ko(e,t){var i=Io();t=void 0===t?null:t;var n=i.memoizedState;return null!==n&&null!==t&&So(t,n[1])?n[0]:(i.memoizedState=[e,t],e)}function Qo(e,t){var i=Io();t=void 0===t?null:t;var n=i.memoizedState;return null!==n&&null!==t&&So(t,n[1])?n[0]:(e=e(),i.memoizedState=[e,t],e)}function Jo(e,t,i){return 0===(21&go)?(e.baseState&&(e.baseState=!1,wa=!0),e.memoizedState=i):(an(i,t)||(i=pt(),po.lanes|=i,Nl|=i,e.baseState=!0),t)}function $o(e,t){var i=yt;yt=0!==i&&4>i?i:4,e(!0);var n=fo.transition;fo.transition={};try{e(!1),t()}finally{yt=i,fo.transition=n}}function ea(){return Io().memoizedState}function ta(e,t,i){var n=ic(e);if(i={lane:n,action:i,hasEagerState:!1,eagerState:null,next:null},na(e))ra(t,i);else if(null!==(i=As(e,t,i,n))){nc(i,e,n,tc()),sa(i,t,n)}}function ia(e,t,i){var n=ic(e),r={lane:n,action:i,hasEagerState:!1,eagerState:null,next:null};if(na(e))ra(t,r);else{var s=e.alternate;if(0===e.lanes&&(null===s||0===s.lanes)&&null!==(s=t.lastRenderedReducer))try{var o=t.lastRenderedState,a=s(o,i);if(r.hasEagerState=!0,r.eagerState=a,an(a,o)){var l=t.interleaved;return null===l?(r.next=r,Is(t)):(r.next=l.next,l.next=r),void(t.interleaved=r)}}catch(c){}null!==(i=As(e,t,r,n))&&(nc(i,e,n,r=tc()),sa(i,t,n))}}function na(e){var t=e.alternate;return e===po||null!==t&&t===po}function ra(e,t){yo=vo=!0;var i=e.pending;null===i?t.next=t:(t.next=i.next,i.next=t),e.pending=t}function sa(e,t,i){if(0!==(4194240&i)){var n=t.lanes;i|=n&=e.pendingLanes,t.lanes=i,vt(e,i)}}var oa={readContext:Ts,useCallback:Co,useContext:Co,useEffect:Co,useImperativeHandle:Co,useInsertionEffect:Co,useLayoutEffect:Co,useMemo:Co,useReducer:Co,useRef:Co,useState:Co,useDebugValue:Co,useDeferredValue:Co,useTransition:Co,useMutableSource:Co,useSyncExternalStore:Co,useId:Co,unstable_isNewReconciler:!1},aa={readContext:Ts,useCallback:function(e,t){return xo().memoizedState=[e,void 0===t?null:t],e},useContext:Ts,useEffect:Wo,useImperativeHandle:function(e,t,i){return i=null!==i&&void 0!==i?i.concat([e]):null,Vo(4194308,4,Xo.bind(null,t,e),i)},useLayoutEffect:function(e,t){return Vo(4194308,4,e,t)},useInsertionEffect:function(e,t){return Vo(4,2,e,t)},useMemo:function(e,t){var i=xo();return t=void 0===t?null:t,e=e(),i.memoizedState=[e,t],e},useReducer:function(e,t,i){var n=xo();return t=void 0!==i?i(t):t,n.memoizedState=n.baseState=t,e={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:e,lastRenderedState:t},n.queue=e,e=e.dispatch=ta.bind(null,po,e),[n.memoizedState,e]},useRef:function(e){return e={current:e},xo().memoizedState=e},useState:Bo,useDebugValue:Zo,useDeferredValue:function(e){return xo().memoizedState=e},useTransition:function(){var e=Bo(!1),t=e[0];return e=$o.bind(null,e[1]),xo().memoizedState=e,[t,e]},useMutableSource:function(){},useSyncExternalStore:function(e,t,i){var n=po,r=xo();if(rs){if(void 0===i)throw Error(s(407));i=i()}else{if(i=t(),null===Rl)throw Error(s(349));0!==(30&go)||ko(n,t,i)}r.memoizedState=i;var o={value:i,getSnapshot:t};return r.queue=o,Wo(Po.bind(null,n,o,e),[e]),n.flags|=2048,jo(9,Mo.bind(null,n,o,i,t),void 0,null),i},useId:function(){var e=xo(),t=Rl.identifierPrefix;if(rs){var i=Qr;t=":"+t+"R"+(i=(Kr&~(1<<32-ot(Kr)-1)).toString(32)+i),0<(i=wo++)&&(t+="H"+i.toString(32)),t+=":"}else t=":"+t+"r"+(i=bo++).toString(32)+":";return e.memoizedState=t},unstable_isNewReconciler:!1},la={readContext:Ts,useCallback:Ko,useContext:Ts,useEffect:zo,useImperativeHandle:qo,useInsertionEffect:Ho,useLayoutEffect:Yo,useMemo:Qo,useReducer:Oo,useRef:Uo,useState:function(){return Oo(Ao)},useDebugValue:Zo,useDeferredValue:function(e){return Jo(Io(),mo.memoizedState,e)},useTransition:function(){return[Oo(Ao)[0],Io().memoizedState]},useMutableSource:Do,useSyncExternalStore:Lo,useId:ea,unstable_isNewReconciler:!1},ca={readContext:Ts,useCallback:Ko,useContext:Ts,useEffect:zo,useImperativeHandle:qo,useInsertionEffect:Ho,useLayoutEffect:Yo,useMemo:Qo,useReducer:Ro,useRef:Uo,useState:function(){return Ro(Ao)},useDebugValue:Zo,useDeferredValue:function(e){var t=Io();return null===mo?t.memoizedState=e:Jo(t,mo.memoizedState,e)},useTransition:function(){return[Ro(Ao)[0],Io().memoizedState]},useMutableSource:Do,useSyncExternalStore:Lo,useId:ea,unstable_isNewReconciler:!1};function ha(e,t){try{var i="",n=t;do{i+=V(n),n=n.return}while(n);var r=i}catch(s){r="\nError generating stack: "+s.message+"\n"+s.stack}return{value:e,source:t,stack:r,digest:null}}function ua(e,t,i){return{value:e,source:null,stack:null!=i?i:null,digest:null!=t?t:null}}function da(e,t){try{console.error(t.value)}catch(i){setTimeout((function(){throw i}))}}var fa="function"===typeof WeakMap?WeakMap:Map;function ga(e,t,i){(i=ks(-1,i)).tag=3,i.payload={element:null};var n=t.value;return i.callback=function(){Hl||(Hl=!0,Yl=n),da(0,t)},i}function pa(e,t,i){(i=ks(-1,i)).tag=3;var n=e.type.getDerivedStateFromError;if("function"===typeof n){var r=t.value;i.payload=function(){return n(r)},i.callback=function(){da(0,t)}}var s=e.stateNode;return null!==s&&"function"===typeof s.componentDidCatch&&(i.callback=function(){da(0,t),"function"!==typeof n&&(null===Xl?Xl=new Set([this]):Xl.add(this));var e=t.stack;this.componentDidCatch(t.value,{componentStack:null!==e?e:""})}),i}function ma(e,t,i){var n=e.pingCache;if(null===n){n=e.pingCache=new fa;var r=new Set;n.set(t,r)}else void 0===(r=n.get(t))&&(r=new Set,n.set(t,r));r.has(i)||(r.add(i),e=xc.bind(null,e,t,i),t.then(e,e))}function _a(e){do{var t;if((t=13===e.tag)&&(t=null===(t=e.memoizedState)||null!==t.dehydrated),t)return e;e=e.return}while(null!==e);return null}function va(e,t,i,n,r){return 0===(1&e.mode)?(e===t?e.flags|=65536:(e.flags|=128,i.flags|=131072,i.flags&=-52805,1===i.tag&&(null===i.alternate?i.tag=17:((t=ks(-1,1)).tag=2,Ms(i,t,1))),i.lanes|=1),e):(e.flags|=65536,e.lanes=r,e)}var ya=w.ReactCurrentOwner,wa=!1;function ba(e,t,i,n){t.child=null===e?Qs(t,null,i,n):Ks(t,e.child,i,n)}function Ca(e,t,i,n,r){i=i.render;var s=t.ref;return Es(t,r),n=Eo(e,t,i,n,s,r),i=To(),null===e||wa?(rs&&i&&es(t),t.flags|=1,ba(e,t,n,r),t.child):(t.updateQueue=e.updateQueue,t.flags&=-2053,e.lanes&=~r,Ha(e,t,r))}function Sa(e,t,i,n,r){if(null===e){var s=i.type;return"function"!==typeof s||kc(s)||void 0!==s.defaultProps||null!==i.compare||void 0!==i.defaultProps?((e=Pc(i.type,null,n,t,t.mode,r)).ref=t.ref,e.return=t,t.child=e):(t.tag=15,t.type=s,Ea(e,t,s,n,r))}if(s=e.child,0===(e.lanes&r)){var o=s.memoizedProps;if((i=null!==(i=i.compare)?i:ln)(o,n)&&e.ref===t.ref)return Ha(e,t,r)}return t.flags|=1,(e=Mc(s,n)).ref=t.ref,e.return=t,t.child=e}function Ea(e,t,i,n,r){if(null!==e){var s=e.memoizedProps;if(ln(s,n)&&e.ref===t.ref){if(wa=!1,t.pendingProps=n=s,0===(e.lanes&r))return t.lanes=e.lanes,Ha(e,t,r);0!==(131072&e.flags)&&(wa=!0)}}return Ia(e,t,i,n,r)}function Ta(e,t,i){var n=t.pendingProps,r=n.children,s=null!==e?e.memoizedState:null;if("hidden"===n.mode)if(0===(1&t.mode))t.memoizedState={baseLanes:0,cachePool:null,transitions:null},xr(Ml,kl),kl|=i;else{if(0===(1073741824&i))return e=null!==s?s.baseLanes|i:i,t.lanes=t.childLanes=1073741824,t.memoizedState={baseLanes:e,cachePool:null,transitions:null},t.updateQueue=null,xr(Ml,kl),kl|=e,null;t.memoizedState={baseLanes:0,cachePool:null,transitions:null},n=null!==s?s.baseLanes:i,xr(Ml,kl),kl|=n}else null!==s?(n=s.baseLanes|i,t.memoizedState=null):n=i,xr(Ml,kl),kl|=n;return ba(e,t,r,i),t.child}function xa(e,t){var i=t.ref;(null===e&&null!==i||null!==e&&e.ref!==i)&&(t.flags|=512,t.flags|=2097152)}function Ia(e,t,i,n,r){var s=Lr(i)?Rr:Ar.current;return s=Dr(t,s),Es(t,r),i=Eo(e,t,i,n,s,r),n=To(),null===e||wa?(rs&&n&&es(t),t.flags|=1,ba(e,t,i,r),t.child):(t.updateQueue=e.updateQueue,t.flags&=-2053,e.lanes&=~r,Ha(e,t,r))}function Aa(e,t,i,n,r){if(Lr(i)){var s=!0;Fr(t)}else s=!1;if(Es(t,r),null===t.stateNode)za(e,t),Ws(t,i,n),Hs(t,i,n,r),n=!0;else if(null===e){var o=t.stateNode,a=t.memoizedProps;o.props=a;var l=o.context,c=i.contextType;"object"===typeof c&&null!==c?c=Ts(c):c=Dr(t,c=Lr(i)?Rr:Ar.current);var h=i.getDerivedStateFromProps,u="function"===typeof h||"function"===typeof o.getSnapshotBeforeUpdate;u||"function"!==typeof o.UNSAFE_componentWillReceiveProps&&"function"!==typeof o.componentWillReceiveProps||(a!==n||l!==c)&&zs(t,o,n,c),Rs=!1;var d=t.memoizedState;o.state=d,Ns(t,n,o,r),l=t.memoizedState,a!==n||d!==l||Or.current||Rs?("function"===typeof h&&(Us(t,i,h,n),l=t.memoizedState),(a=Rs||Gs(t,i,a,n,d,l,c))?(u||"function"!==typeof o.UNSAFE_componentWillMount&&"function"!==typeof o.componentWillMount||("function"===typeof o.componentWillMount&&o.componentWillMount(),"function"===typeof o.UNSAFE_componentWillMount&&o.UNSAFE_componentWillMount()),"function"===typeof o.componentDidMount&&(t.flags|=4194308)):("function"===typeof o.componentDidMount&&(t.flags|=4194308),t.memoizedProps=n,t.memoizedState=l),o.props=n,o.state=l,o.context=c,n=a):("function"===typeof o.componentDidMount&&(t.flags|=4194308),n=!1)}else{o=t.stateNode,Ls(e,t),a=t.memoizedProps,c=t.type===t.elementType?a:ms(t.type,a),o.props=c,u=t.pendingProps,d=o.context,"object"===typeof(l=i.contextType)&&null!==l?l=Ts(l):l=Dr(t,l=Lr(i)?Rr:Ar.current);var f=i.getDerivedStateFromProps;(h="function"===typeof f||"function"===typeof o.getSnapshotBeforeUpdate)||"function"!==typeof o.UNSAFE_componentWillReceiveProps&&"function"!==typeof o.componentWillReceiveProps||(a!==u||d!==l)&&zs(t,o,n,l),Rs=!1,d=t.memoizedState,o.state=d,Ns(t,n,o,r);var g=t.memoizedState;a!==u||d!==g||Or.current||Rs?("function"===typeof f&&(Us(t,i,f,n),g=t.memoizedState),(c=Rs||Gs(t,i,c,n,d,g,l)||!1)?(h||"function"!==typeof o.UNSAFE_componentWillUpdate&&"function"!==typeof o.componentWillUpdate||("function"===typeof o.componentWillUpdate&&o.componentWillUpdate(n,g,l),"function"===typeof o.UNSAFE_componentWillUpdate&&o.UNSAFE_componentWillUpdate(n,g,l)),"function"===typeof o.componentDidUpdate&&(t.flags|=4),"function"===typeof o.getSnapshotBeforeUpdate&&(t.flags|=1024)):("function"!==typeof o.componentDidUpdate||a===e.memoizedProps&&d===e.memoizedState||(t.flags|=4),"function"!==typeof o.getSnapshotBeforeUpdate||a===e.memoizedProps&&d===e.memoizedState||(t.flags|=1024),t.memoizedProps=n,t.memoizedState=g),o.props=n,o.state=g,o.context=l,n=c):("function"!==typeof o.componentDidUpdate||a===e.memoizedProps&&d===e.memoizedState||(t.flags|=4),"function"!==typeof o.getSnapshotBeforeUpdate||a===e.memoizedProps&&d===e.memoizedState||(t.flags|=1024),n=!1)}return Oa(e,t,i,n,s,r)}function Oa(e,t,i,n,r,s){xa(e,t);var o=0!==(128&t.flags);if(!n&&!o)return r&&Nr(t,i,!1),Ha(e,t,s);n=t.stateNode,ya.current=t;var a=o&&"function"!==typeof i.getDerivedStateFromError?null:n.render();return t.flags|=1,null!==e&&o?(t.child=Ks(t,e.child,null,s),t.child=Ks(t,null,a,s)):ba(e,t,a,s),t.memoizedState=n.state,r&&Nr(t,i,!0),t.child}function Ra(e){var t=e.stateNode;t.pendingContext?Mr(0,t.pendingContext,t.pendingContext!==t.context):t.context&&Mr(0,t.context,!1),no(e,t.containerInfo)}function Da(e,t,i,n,r){return fs(),gs(r),t.flags|=256,ba(e,t,i,n),t.child}var La,ka,Ma,Pa,Fa={dehydrated:null,treeContext:null,retryLane:0};function Na(e){return{baseLanes:e,cachePool:null,transitions:null}}function Ba(e,t,i){var n,r=t.pendingProps,o=ao.current,a=!1,l=0!==(128&t.flags);if((n=l)||(n=(null===e||null!==e.memoizedState)&&0!==(2&o)),n?(a=!0,t.flags&=-129):null!==e&&null===e.memoizedState||(o|=1),xr(ao,1&o),null===e)return cs(t),null!==(e=t.memoizedState)&&null!==(e=e.dehydrated)?(0===(1&t.mode)?t.lanes=1:"$!"===e.data?t.lanes=8:t.lanes=1073741824,null):(l=r.children,e=r.fallback,a?(r=t.mode,a=t.child,l={mode:"hidden",children:l},0===(1&r)&&null!==a?(a.childLanes=0,a.pendingProps=l):a=Nc(l,r,0,null),e=Fc(e,r,i,null),a.return=t,e.return=t,a.sibling=e,t.child=a,t.child.memoizedState=Na(i),t.memoizedState=Fa,e):ja(t,l));if(null!==(o=e.memoizedState)&&null!==(n=o.dehydrated))return function(e,t,i,n,r,o,a){if(i)return 256&t.flags?(t.flags&=-257,Ua(e,t,a,n=ua(Error(s(422))))):null!==t.memoizedState?(t.child=e.child,t.flags|=128,null):(o=n.fallback,r=t.mode,n=Nc({mode:"visible",children:n.children},r,0,null),(o=Fc(o,r,a,null)).flags|=2,n.return=t,o.return=t,n.sibling=o,t.child=n,0!==(1&t.mode)&&Ks(t,e.child,null,a),t.child.memoizedState=Na(a),t.memoizedState=Fa,o);if(0===(1&t.mode))return Ua(e,t,a,null);if("$!"===r.data){if(n=r.nextSibling&&r.nextSibling.dataset)var l=n.dgst;return n=l,Ua(e,t,a,n=ua(o=Error(s(419)),n,void 0))}if(l=0!==(a&e.childLanes),wa||l){if(null!==(n=Rl)){switch(a&-a){case 4:r=2;break;case 16:r=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:r=32;break;case 536870912:r=268435456;break;default:r=0}0!==(r=0!==(r&(n.suspendedLanes|a))?0:r)&&r!==o.retryLane&&(o.retryLane=r,Os(e,r),nc(n,e,r,-1))}return mc(),Ua(e,t,a,n=ua(Error(s(421))))}return"$?"===r.data?(t.flags|=128,t.child=e.child,t=Ac.bind(null,e),r._reactRetry=t,null):(e=o.treeContext,ns=cr(r.nextSibling),is=t,rs=!0,ss=null,null!==e&&(Xr[qr++]=Kr,Xr[qr++]=Qr,Xr[qr++]=Zr,Kr=e.id,Qr=e.overflow,Zr=t),t=ja(t,n.children),t.flags|=4096,t)}(e,t,l,r,n,o,i);if(a){a=r.fallback,l=t.mode,n=(o=e.child).sibling;var c={mode:"hidden",children:r.children};return 0===(1&l)&&t.child!==o?((r=t.child).childLanes=0,r.pendingProps=c,t.deletions=null):(r=Mc(o,c)).subtreeFlags=14680064&o.subtreeFlags,null!==n?a=Mc(n,a):(a=Fc(a,l,i,null)).flags|=2,a.return=t,r.return=t,r.sibling=a,t.child=r,r=a,a=t.child,l=null===(l=e.child.memoizedState)?Na(i):{baseLanes:l.baseLanes|i,cachePool:null,transitions:l.transitions},a.memoizedState=l,a.childLanes=e.childLanes&~i,t.memoizedState=Fa,r}return e=(a=e.child).sibling,r=Mc(a,{mode:"visible",children:r.children}),0===(1&t.mode)&&(r.lanes=i),r.return=t,r.sibling=null,null!==e&&(null===(i=t.deletions)?(t.deletions=[e],t.flags|=16):i.push(e)),t.child=r,t.memoizedState=null,r}function ja(e,t){return(t=Nc({mode:"visible",children:t},e.mode,0,null)).return=e,e.child=t}function Ua(e,t,i,n){return null!==n&&gs(n),Ks(t,e.child,null,i),(e=ja(t,t.pendingProps.children)).flags|=2,t.memoizedState=null,e}function Va(e,t,i){e.lanes|=t;var n=e.alternate;null!==n&&(n.lanes|=t),Ss(e.return,t,i)}function Ga(e,t,i,n,r){var s=e.memoizedState;null===s?e.memoizedState={isBackwards:t,rendering:null,renderingStartTime:0,last:n,tail:i,tailMode:r}:(s.isBackwards=t,s.rendering=null,s.renderingStartTime=0,s.last=n,s.tail=i,s.tailMode=r)}function Wa(e,t,i){var n=t.pendingProps,r=n.revealOrder,s=n.tail;if(ba(e,t,n.children,i),0!==(2&(n=ao.current)))n=1&n|2,t.flags|=128;else{if(null!==e&&0!==(128&e.flags))e:for(e=t.child;null!==e;){if(13===e.tag)null!==e.memoizedState&&Va(e,i,t);else if(19===e.tag)Va(e,i,t);else if(null!==e.child){e.child.return=e,e=e.child;continue}if(e===t)break e;for(;null===e.sibling;){if(null===e.return||e.return===t)break e;e=e.return}e.sibling.return=e.return,e=e.sibling}n&=1}if(xr(ao,n),0===(1&t.mode))t.memoizedState=null;else switch(r){case"forwards":for(i=t.child,r=null;null!==i;)null!==(e=i.alternate)&&null===lo(e)&&(r=i),i=i.sibling;null===(i=r)?(r=t.child,t.child=null):(r=i.sibling,i.sibling=null),Ga(t,!1,r,i,s);break;case"backwards":for(i=null,r=t.child,t.child=null;null!==r;){if(null!==(e=r.alternate)&&null===lo(e)){t.child=r;break}e=r.sibling,r.sibling=i,i=r,r=e}Ga(t,!0,i,null,s);break;case"together":Ga(t,!1,null,null,void 0);break;default:t.memoizedState=null}return t.child}function za(e,t){0===(1&t.mode)&&null!==e&&(e.alternate=null,t.alternate=null,t.flags|=2)}function Ha(e,t,i){if(null!==e&&(t.dependencies=e.dependencies),Nl|=t.lanes,0===(i&t.childLanes))return null;if(null!==e&&t.child!==e.child)throw Error(s(153));if(null!==t.child){for(i=Mc(e=t.child,e.pendingProps),t.child=i,i.return=t;null!==e.sibling;)e=e.sibling,(i=i.sibling=Mc(e,e.pendingProps)).return=t;i.sibling=null}return t.child}function Ya(e,t){if(!rs)switch(e.tailMode){case"hidden":t=e.tail;for(var i=null;null!==t;)null!==t.alternate&&(i=t),t=t.sibling;null===i?e.tail=null:i.sibling=null;break;case"collapsed":i=e.tail;for(var n=null;null!==i;)null!==i.alternate&&(n=i),i=i.sibling;null===n?t||null===e.tail?e.tail=null:e.tail.sibling=null:n.sibling=null}}function Xa(e){var t=null!==e.alternate&&e.alternate.child===e.child,i=0,n=0;if(t)for(var r=e.child;null!==r;)i|=r.lanes|r.childLanes,n|=14680064&r.subtreeFlags,n|=14680064&r.flags,r.return=e,r=r.sibling;else for(r=e.child;null!==r;)i|=r.lanes|r.childLanes,n|=r.subtreeFlags,n|=r.flags,r.return=e,r=r.sibling;return e.subtreeFlags|=n,e.childLanes=i,t}function qa(e,t,i){var n=t.pendingProps;switch(ts(t),t.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return Xa(t),null;case 1:case 17:return Lr(t.type)&&kr(),Xa(t),null;case 3:return n=t.stateNode,ro(),Tr(Or),Tr(Ar),ho(),n.pendingContext&&(n.context=n.pendingContext,n.pendingContext=null),null!==e&&null!==e.child||(us(t)?t.flags|=4:null===e||e.memoizedState.isDehydrated&&0===(256&t.flags)||(t.flags|=1024,null!==ss&&(ac(ss),ss=null))),ka(e,t),Xa(t),null;case 5:oo(t);var r=io(to.current);if(i=t.type,null!==e&&null!=t.stateNode)Ma(e,t,i,n,r),e.ref!==t.ref&&(t.flags|=512,t.flags|=2097152);else{if(!n){if(null===t.stateNode)throw Error(s(166));return Xa(t),null}if(e=io($s.current),us(t)){n=t.stateNode,i=t.type;var o=t.memoizedProps;switch(n[dr]=t,n[fr]=o,e=0!==(1&t.mode),i){case"dialog":jn("cancel",n),jn("close",n);break;case"iframe":case"object":case"embed":jn("load",n);break;case"video":case"audio":for(r=0;r<Pn.length;r++)jn(Pn[r],n);break;case"source":jn("error",n);break;case"img":case"image":case"link":jn("error",n),jn("load",n);break;case"details":jn("toggle",n);break;case"input":K(n,o),jn("invalid",n);break;case"select":n._wrapperState={wasMultiple:!!o.multiple},jn("invalid",n);break;case"textarea":re(n,o),jn("invalid",n)}for(var l in ve(i,o),r=null,o)if(o.hasOwnProperty(l)){var c=o[l];"children"===l?"string"===typeof c?n.textContent!==c&&(!0!==o.suppressHydrationWarning&&Jn(n.textContent,c,e),r=["children",c]):"number"===typeof c&&n.textContent!==""+c&&(!0!==o.suppressHydrationWarning&&Jn(n.textContent,c,e),r=["children",""+c]):a.hasOwnProperty(l)&&null!=c&&"onScroll"===l&&jn("scroll",n)}switch(i){case"input":Y(n),$(n,o,!0);break;case"textarea":Y(n),oe(n);break;case"select":case"option":break;default:"function"===typeof o.onClick&&(n.onclick=$n)}n=r,t.updateQueue=n,null!==n&&(t.flags|=4)}else{l=9===r.nodeType?r:r.ownerDocument,"http://www.w3.org/1999/xhtml"===e&&(e=ae(i)),"http://www.w3.org/1999/xhtml"===e?"script"===i?((e=l.createElement("div")).innerHTML="<script><\/script>",e=e.removeChild(e.firstChild)):"string"===typeof n.is?e=l.createElement(i,{is:n.is}):(e=l.createElement(i),"select"===i&&(l=e,n.multiple?l.multiple=!0:n.size&&(l.size=n.size))):e=l.createElementNS(e,i),e[dr]=t,e[fr]=n,La(e,t,!1,!1),t.stateNode=e;e:{switch(l=ye(i,n),i){case"dialog":jn("cancel",e),jn("close",e),r=n;break;case"iframe":case"object":case"embed":jn("load",e),r=n;break;case"video":case"audio":for(r=0;r<Pn.length;r++)jn(Pn[r],e);r=n;break;case"source":jn("error",e),r=n;break;case"img":case"image":case"link":jn("error",e),jn("load",e),r=n;break;case"details":jn("toggle",e),r=n;break;case"input":K(e,n),r=Z(e,n),jn("invalid",e);break;case"option":default:r=n;break;case"select":e._wrapperState={wasMultiple:!!n.multiple},r=N({},n,{value:void 0}),jn("invalid",e);break;case"textarea":re(e,n),r=ne(e,n),jn("invalid",e)}for(o in ve(i,r),c=r)if(c.hasOwnProperty(o)){var h=c[o];"style"===o?me(e,h):"dangerouslySetInnerHTML"===o?null!=(h=h?h.__html:void 0)&&ue(e,h):"children"===o?"string"===typeof h?("textarea"!==i||""!==h)&&de(e,h):"number"===typeof h&&de(e,""+h):"suppressContentEditableWarning"!==o&&"suppressHydrationWarning"!==o&&"autoFocus"!==o&&(a.hasOwnProperty(o)?null!=h&&"onScroll"===o&&jn("scroll",e):null!=h&&y(e,o,h,l))}switch(i){case"input":Y(e),$(e,n,!1);break;case"textarea":Y(e),oe(e);break;case"option":null!=n.value&&e.setAttribute("value",""+z(n.value));break;case"select":e.multiple=!!n.multiple,null!=(o=n.value)?ie(e,!!n.multiple,o,!1):null!=n.defaultValue&&ie(e,!!n.multiple,n.defaultValue,!0);break;default:"function"===typeof r.onClick&&(e.onclick=$n)}switch(i){case"button":case"input":case"select":case"textarea":n=!!n.autoFocus;break e;case"img":n=!0;break e;default:n=!1}}n&&(t.flags|=4)}null!==t.ref&&(t.flags|=512,t.flags|=2097152)}return Xa(t),null;case 6:if(e&&null!=t.stateNode)Pa(e,t,e.memoizedProps,n);else{if("string"!==typeof n&&null===t.stateNode)throw Error(s(166));if(i=io(to.current),io($s.current),us(t)){if(n=t.stateNode,i=t.memoizedProps,n[dr]=t,(o=n.nodeValue!==i)&&null!==(e=is))switch(e.tag){case 3:Jn(n.nodeValue,i,0!==(1&e.mode));break;case 5:!0!==e.memoizedProps.suppressHydrationWarning&&Jn(n.nodeValue,i,0!==(1&e.mode))}o&&(t.flags|=4)}else(n=(9===i.nodeType?i:i.ownerDocument).createTextNode(n))[dr]=t,t.stateNode=n}return Xa(t),null;case 13:if(Tr(ao),n=t.memoizedState,null===e||null!==e.memoizedState&&null!==e.memoizedState.dehydrated){if(rs&&null!==ns&&0!==(1&t.mode)&&0===(128&t.flags))ds(),fs(),t.flags|=98560,o=!1;else if(o=us(t),null!==n&&null!==n.dehydrated){if(null===e){if(!o)throw Error(s(318));if(!(o=null!==(o=t.memoizedState)?o.dehydrated:null))throw Error(s(317));o[dr]=t}else fs(),0===(128&t.flags)&&(t.memoizedState=null),t.flags|=4;Xa(t),o=!1}else null!==ss&&(ac(ss),ss=null),o=!0;if(!o)return 65536&t.flags?t:null}return 0!==(128&t.flags)?(t.lanes=i,t):((n=null!==n)!==(null!==e&&null!==e.memoizedState)&&n&&(t.child.flags|=8192,0!==(1&t.mode)&&(null===e||0!==(1&ao.current)?0===Pl&&(Pl=3):mc())),null!==t.updateQueue&&(t.flags|=4),Xa(t),null);case 4:return ro(),ka(e,t),null===e&&Gn(t.stateNode.containerInfo),Xa(t),null;case 10:return Cs(t.type._context),Xa(t),null;case 19:if(Tr(ao),null===(o=t.memoizedState))return Xa(t),null;if(n=0!==(128&t.flags),null===(l=o.rendering))if(n)Ya(o,!1);else{if(0!==Pl||null!==e&&0!==(128&e.flags))for(e=t.child;null!==e;){if(null!==(l=lo(e))){for(t.flags|=128,Ya(o,!1),null!==(n=l.updateQueue)&&(t.updateQueue=n,t.flags|=4),t.subtreeFlags=0,n=i,i=t.child;null!==i;)e=n,(o=i).flags&=14680066,null===(l=o.alternate)?(o.childLanes=0,o.lanes=e,o.child=null,o.subtreeFlags=0,o.memoizedProps=null,o.memoizedState=null,o.updateQueue=null,o.dependencies=null,o.stateNode=null):(o.childLanes=l.childLanes,o.lanes=l.lanes,o.child=l.child,o.subtreeFlags=0,o.deletions=null,o.memoizedProps=l.memoizedProps,o.memoizedState=l.memoizedState,o.updateQueue=l.updateQueue,o.type=l.type,e=l.dependencies,o.dependencies=null===e?null:{lanes:e.lanes,firstContext:e.firstContext}),i=i.sibling;return xr(ao,1&ao.current|2),t.child}e=e.sibling}null!==o.tail&&Qe()>Wl&&(t.flags|=128,n=!0,Ya(o,!1),t.lanes=4194304)}else{if(!n)if(null!==(e=lo(l))){if(t.flags|=128,n=!0,null!==(i=e.updateQueue)&&(t.updateQueue=i,t.flags|=4),Ya(o,!0),null===o.tail&&"hidden"===o.tailMode&&!l.alternate&&!rs)return Xa(t),null}else 2*Qe()-o.renderingStartTime>Wl&&1073741824!==i&&(t.flags|=128,n=!0,Ya(o,!1),t.lanes=4194304);o.isBackwards?(l.sibling=t.child,t.child=l):(null!==(i=o.last)?i.sibling=l:t.child=l,o.last=l)}return null!==o.tail?(t=o.tail,o.rendering=t,o.tail=t.sibling,o.renderingStartTime=Qe(),t.sibling=null,i=ao.current,xr(ao,n?1&i|2:1&i),t):(Xa(t),null);case 22:case 23:return dc(),n=null!==t.memoizedState,null!==e&&null!==e.memoizedState!==n&&(t.flags|=8192),n&&0!==(1&t.mode)?0!==(1073741824&kl)&&(Xa(t),6&t.subtreeFlags&&(t.flags|=8192)):Xa(t),null;case 24:case 25:return null}throw Error(s(156,t.tag))}function Za(e,t){switch(ts(t),t.tag){case 1:return Lr(t.type)&&kr(),65536&(e=t.flags)?(t.flags=-65537&e|128,t):null;case 3:return ro(),Tr(Or),Tr(Ar),ho(),0!==(65536&(e=t.flags))&&0===(128&e)?(t.flags=-65537&e|128,t):null;case 5:return oo(t),null;case 13:if(Tr(ao),null!==(e=t.memoizedState)&&null!==e.dehydrated){if(null===t.alternate)throw Error(s(340));fs()}return 65536&(e=t.flags)?(t.flags=-65537&e|128,t):null;case 19:return Tr(ao),null;case 4:return ro(),null;case 10:return Cs(t.type._context),null;case 22:case 23:return dc(),null;default:return null}}La=function(e,t){for(var i=t.child;null!==i;){if(5===i.tag||6===i.tag)e.appendChild(i.stateNode);else if(4!==i.tag&&null!==i.child){i.child.return=i,i=i.child;continue}if(i===t)break;for(;null===i.sibling;){if(null===i.return||i.return===t)return;i=i.return}i.sibling.return=i.return,i=i.sibling}},ka=function(){},Ma=function(e,t,i,n){var r=e.memoizedProps;if(r!==n){e=t.stateNode,io($s.current);var s,o=null;switch(i){case"input":r=Z(e,r),n=Z(e,n),o=[];break;case"select":r=N({},r,{value:void 0}),n=N({},n,{value:void 0}),o=[];break;case"textarea":r=ne(e,r),n=ne(e,n),o=[];break;default:"function"!==typeof r.onClick&&"function"===typeof n.onClick&&(e.onclick=$n)}for(h in ve(i,n),i=null,r)if(!n.hasOwnProperty(h)&&r.hasOwnProperty(h)&&null!=r[h])if("style"===h){var l=r[h];for(s in l)l.hasOwnProperty(s)&&(i||(i={}),i[s]="")}else"dangerouslySetInnerHTML"!==h&&"children"!==h&&"suppressContentEditableWarning"!==h&&"suppressHydrationWarning"!==h&&"autoFocus"!==h&&(a.hasOwnProperty(h)?o||(o=[]):(o=o||[]).push(h,null));for(h in n){var c=n[h];if(l=null!=r?r[h]:void 0,n.hasOwnProperty(h)&&c!==l&&(null!=c||null!=l))if("style"===h)if(l){for(s in l)!l.hasOwnProperty(s)||c&&c.hasOwnProperty(s)||(i||(i={}),i[s]="");for(s in c)c.hasOwnProperty(s)&&l[s]!==c[s]&&(i||(i={}),i[s]=c[s])}else i||(o||(o=[]),o.push(h,i)),i=c;else"dangerouslySetInnerHTML"===h?(c=c?c.__html:void 0,l=l?l.__html:void 0,null!=c&&l!==c&&(o=o||[]).push(h,c)):"children"===h?"string"!==typeof c&&"number"!==typeof c||(o=o||[]).push(h,""+c):"suppressContentEditableWarning"!==h&&"suppressHydrationWarning"!==h&&(a.hasOwnProperty(h)?(null!=c&&"onScroll"===h&&jn("scroll",e),o||l===c||(o=[])):(o=o||[]).push(h,c))}i&&(o=o||[]).push("style",i);var h=o;(t.updateQueue=h)&&(t.flags|=4)}},Pa=function(e,t,i,n){i!==n&&(t.flags|=4)};var Ka=!1,Qa=!1,Ja="function"===typeof WeakSet?WeakSet:Set,$a=null;function el(e,t){var i=e.ref;if(null!==i)if("function"===typeof i)try{i(null)}catch(n){Tc(e,t,n)}else i.current=null}function tl(e,t,i){try{i()}catch(n){Tc(e,t,n)}}var il=!1;function nl(e,t,i){var n=t.updateQueue;if(null!==(n=null!==n?n.lastEffect:null)){var r=n=n.next;do{if((r.tag&e)===e){var s=r.destroy;r.destroy=void 0,void 0!==s&&tl(t,i,s)}r=r.next}while(r!==n)}}function rl(e,t){if(null!==(t=null!==(t=t.updateQueue)?t.lastEffect:null)){var i=t=t.next;do{if((i.tag&e)===e){var n=i.create;i.destroy=n()}i=i.next}while(i!==t)}}function sl(e){var t=e.ref;if(null!==t){var i=e.stateNode;e.tag,e=i,"function"===typeof t?t(e):t.current=e}}function ol(e){var t=e.alternate;null!==t&&(e.alternate=null,ol(t)),e.child=null,e.deletions=null,e.sibling=null,5===e.tag&&(null!==(t=e.stateNode)&&(delete t[dr],delete t[fr],delete t[pr],delete t[mr],delete t[_r])),e.stateNode=null,e.return=null,e.dependencies=null,e.memoizedProps=null,e.memoizedState=null,e.pendingProps=null,e.stateNode=null,e.updateQueue=null}function al(e){return 5===e.tag||3===e.tag||4===e.tag}function ll(e){e:for(;;){for(;null===e.sibling;){if(null===e.return||al(e.return))return null;e=e.return}for(e.sibling.return=e.return,e=e.sibling;5!==e.tag&&6!==e.tag&&18!==e.tag;){if(2&e.flags)continue e;if(null===e.child||4===e.tag)continue e;e.child.return=e,e=e.child}if(!(2&e.flags))return e.stateNode}}function cl(e,t,i){var n=e.tag;if(5===n||6===n)e=e.stateNode,t?8===i.nodeType?i.parentNode.insertBefore(e,t):i.insertBefore(e,t):(8===i.nodeType?(t=i.parentNode).insertBefore(e,i):(t=i).appendChild(e),null!==(i=i._reactRootContainer)&&void 0!==i||null!==t.onclick||(t.onclick=$n));else if(4!==n&&null!==(e=e.child))for(cl(e,t,i),e=e.sibling;null!==e;)cl(e,t,i),e=e.sibling}function hl(e,t,i){var n=e.tag;if(5===n||6===n)e=e.stateNode,t?i.insertBefore(e,t):i.appendChild(e);else if(4!==n&&null!==(e=e.child))for(hl(e,t,i),e=e.sibling;null!==e;)hl(e,t,i),e=e.sibling}var ul=null,dl=!1;function fl(e,t,i){for(i=i.child;null!==i;)gl(e,t,i),i=i.sibling}function gl(e,t,i){if(st&&"function"===typeof st.onCommitFiberUnmount)try{st.onCommitFiberUnmount(rt,i)}catch(a){}switch(i.tag){case 5:Qa||el(i,t);case 6:var n=ul,r=dl;ul=null,fl(e,t,i),dl=r,null!==(ul=n)&&(dl?(e=ul,i=i.stateNode,8===e.nodeType?e.parentNode.removeChild(i):e.removeChild(i)):ul.removeChild(i.stateNode));break;case 18:null!==ul&&(dl?(e=ul,i=i.stateNode,8===e.nodeType?lr(e.parentNode,i):1===e.nodeType&&lr(e,i),Gt(e)):lr(ul,i.stateNode));break;case 4:n=ul,r=dl,ul=i.stateNode.containerInfo,dl=!0,fl(e,t,i),ul=n,dl=r;break;case 0:case 11:case 14:case 15:if(!Qa&&(null!==(n=i.updateQueue)&&null!==(n=n.lastEffect))){r=n=n.next;do{var s=r,o=s.destroy;s=s.tag,void 0!==o&&(0!==(2&s)||0!==(4&s))&&tl(i,t,o),r=r.next}while(r!==n)}fl(e,t,i);break;case 1:if(!Qa&&(el(i,t),"function"===typeof(n=i.stateNode).componentWillUnmount))try{n.props=i.memoizedProps,n.state=i.memoizedState,n.componentWillUnmount()}catch(a){Tc(i,t,a)}fl(e,t,i);break;case 21:fl(e,t,i);break;case 22:1&i.mode?(Qa=(n=Qa)||null!==i.memoizedState,fl(e,t,i),Qa=n):fl(e,t,i);break;default:fl(e,t,i)}}function pl(e){var t=e.updateQueue;if(null!==t){e.updateQueue=null;var i=e.stateNode;null===i&&(i=e.stateNode=new Ja),t.forEach((function(t){var n=Oc.bind(null,e,t);i.has(t)||(i.add(t),t.then(n,n))}))}}function ml(e,t){var i=t.deletions;if(null!==i)for(var n=0;n<i.length;n++){var r=i[n];try{var o=e,a=t,l=a;e:for(;null!==l;){switch(l.tag){case 5:ul=l.stateNode,dl=!1;break e;case 3:case 4:ul=l.stateNode.containerInfo,dl=!0;break e}l=l.return}if(null===ul)throw Error(s(160));gl(o,a,r),ul=null,dl=!1;var c=r.alternate;null!==c&&(c.return=null),r.return=null}catch(h){Tc(r,t,h)}}if(12854&t.subtreeFlags)for(t=t.child;null!==t;)_l(t,e),t=t.sibling}function _l(e,t){var i=e.alternate,n=e.flags;switch(e.tag){case 0:case 11:case 14:case 15:if(ml(t,e),vl(e),4&n){try{nl(3,e,e.return),rl(3,e)}catch(m){Tc(e,e.return,m)}try{nl(5,e,e.return)}catch(m){Tc(e,e.return,m)}}break;case 1:ml(t,e),vl(e),512&n&&null!==i&&el(i,i.return);break;case 5:if(ml(t,e),vl(e),512&n&&null!==i&&el(i,i.return),32&e.flags){var r=e.stateNode;try{de(r,"")}catch(m){Tc(e,e.return,m)}}if(4&n&&null!=(r=e.stateNode)){var o=e.memoizedProps,a=null!==i?i.memoizedProps:o,l=e.type,c=e.updateQueue;if(e.updateQueue=null,null!==c)try{"input"===l&&"radio"===o.type&&null!=o.name&&Q(r,o),ye(l,a);var h=ye(l,o);for(a=0;a<c.length;a+=2){var u=c[a],d=c[a+1];"style"===u?me(r,d):"dangerouslySetInnerHTML"===u?ue(r,d):"children"===u?de(r,d):y(r,u,d,h)}switch(l){case"input":J(r,o);break;case"textarea":se(r,o);break;case"select":var f=r._wrapperState.wasMultiple;r._wrapperState.wasMultiple=!!o.multiple;var g=o.value;null!=g?ie(r,!!o.multiple,g,!1):f!==!!o.multiple&&(null!=o.defaultValue?ie(r,!!o.multiple,o.defaultValue,!0):ie(r,!!o.multiple,o.multiple?[]:"",!1))}r[fr]=o}catch(m){Tc(e,e.return,m)}}break;case 6:if(ml(t,e),vl(e),4&n){if(null===e.stateNode)throw Error(s(162));r=e.stateNode,o=e.memoizedProps;try{r.nodeValue=o}catch(m){Tc(e,e.return,m)}}break;case 3:if(ml(t,e),vl(e),4&n&&null!==i&&i.memoizedState.isDehydrated)try{Gt(t.containerInfo)}catch(m){Tc(e,e.return,m)}break;case 4:default:ml(t,e),vl(e);break;case 13:ml(t,e),vl(e),8192&(r=e.child).flags&&(o=null!==r.memoizedState,r.stateNode.isHidden=o,!o||null!==r.alternate&&null!==r.alternate.memoizedState||(Gl=Qe())),4&n&&pl(e);break;case 22:if(u=null!==i&&null!==i.memoizedState,1&e.mode?(Qa=(h=Qa)||u,ml(t,e),Qa=h):ml(t,e),vl(e),8192&n){if(h=null!==e.memoizedState,(e.stateNode.isHidden=h)&&!u&&0!==(1&e.mode))for($a=e,u=e.child;null!==u;){for(d=$a=u;null!==$a;){switch(g=(f=$a).child,f.tag){case 0:case 11:case 14:case 15:nl(4,f,f.return);break;case 1:el(f,f.return);var p=f.stateNode;if("function"===typeof p.componentWillUnmount){n=f,i=f.return;try{t=n,p.props=t.memoizedProps,p.state=t.memoizedState,p.componentWillUnmount()}catch(m){Tc(n,i,m)}}break;case 5:el(f,f.return);break;case 22:if(null!==f.memoizedState){Cl(d);continue}}null!==g?(g.return=f,$a=g):Cl(d)}u=u.sibling}e:for(u=null,d=e;;){if(5===d.tag){if(null===u){u=d;try{r=d.stateNode,h?"function"===typeof(o=r.style).setProperty?o.setProperty("display","none","important"):o.display="none":(l=d.stateNode,a=void 0!==(c=d.memoizedProps.style)&&null!==c&&c.hasOwnProperty("display")?c.display:null,l.style.display=pe("display",a))}catch(m){Tc(e,e.return,m)}}}else if(6===d.tag){if(null===u)try{d.stateNode.nodeValue=h?"":d.memoizedProps}catch(m){Tc(e,e.return,m)}}else if((22!==d.tag&&23!==d.tag||null===d.memoizedState||d===e)&&null!==d.child){d.child.return=d,d=d.child;continue}if(d===e)break e;for(;null===d.sibling;){if(null===d.return||d.return===e)break e;u===d&&(u=null),d=d.return}u===d&&(u=null),d.sibling.return=d.return,d=d.sibling}}break;case 19:ml(t,e),vl(e),4&n&&pl(e);case 21:}}function vl(e){var t=e.flags;if(2&t){try{e:{for(var i=e.return;null!==i;){if(al(i)){var n=i;break e}i=i.return}throw Error(s(160))}switch(n.tag){case 5:var r=n.stateNode;32&n.flags&&(de(r,""),n.flags&=-33),hl(e,ll(e),r);break;case 3:case 4:var o=n.stateNode.containerInfo;cl(e,ll(e),o);break;default:throw Error(s(161))}}catch(a){Tc(e,e.return,a)}e.flags&=-3}4096&t&&(e.flags&=-4097)}function yl(e,t,i){$a=e,wl(e,t,i)}function wl(e,t,i){for(var n=0!==(1&e.mode);null!==$a;){var r=$a,s=r.child;if(22===r.tag&&n){var o=null!==r.memoizedState||Ka;if(!o){var a=r.alternate,l=null!==a&&null!==a.memoizedState||Qa;a=Ka;var c=Qa;if(Ka=o,(Qa=l)&&!c)for($a=r;null!==$a;)l=(o=$a).child,22===o.tag&&null!==o.memoizedState?Sl(r):null!==l?(l.return=o,$a=l):Sl(r);for(;null!==s;)$a=s,wl(s,t,i),s=s.sibling;$a=r,Ka=a,Qa=c}bl(e)}else 0!==(8772&r.subtreeFlags)&&null!==s?(s.return=r,$a=s):bl(e)}}function bl(e){for(;null!==$a;){var t=$a;if(0!==(8772&t.flags)){var i=t.alternate;try{if(0!==(8772&t.flags))switch(t.tag){case 0:case 11:case 15:Qa||rl(5,t);break;case 1:var n=t.stateNode;if(4&t.flags&&!Qa)if(null===i)n.componentDidMount();else{var r=t.elementType===t.type?i.memoizedProps:ms(t.type,i.memoizedProps);n.componentDidUpdate(r,i.memoizedState,n.__reactInternalSnapshotBeforeUpdate)}var o=t.updateQueue;null!==o&&Bs(t,o,n);break;case 3:var a=t.updateQueue;if(null!==a){if(i=null,null!==t.child)switch(t.child.tag){case 5:case 1:i=t.child.stateNode}Bs(t,a,i)}break;case 5:var l=t.stateNode;if(null===i&&4&t.flags){i=l;var c=t.memoizedProps;switch(t.type){case"button":case"input":case"select":case"textarea":c.autoFocus&&i.focus();break;case"img":c.src&&(i.src=c.src)}}break;case 6:case 4:case 12:case 19:case 17:case 21:case 22:case 23:case 25:break;case 13:if(null===t.memoizedState){var h=t.alternate;if(null!==h){var u=h.memoizedState;if(null!==u){var d=u.dehydrated;null!==d&&Gt(d)}}}break;default:throw Error(s(163))}Qa||512&t.flags&&sl(t)}catch(f){Tc(t,t.return,f)}}if(t===e){$a=null;break}if(null!==(i=t.sibling)){i.return=t.return,$a=i;break}$a=t.return}}function Cl(e){for(;null!==$a;){var t=$a;if(t===e){$a=null;break}var i=t.sibling;if(null!==i){i.return=t.return,$a=i;break}$a=t.return}}function Sl(e){for(;null!==$a;){var t=$a;try{switch(t.tag){case 0:case 11:case 15:var i=t.return;try{rl(4,t)}catch(l){Tc(t,i,l)}break;case 1:var n=t.stateNode;if("function"===typeof n.componentDidMount){var r=t.return;try{n.componentDidMount()}catch(l){Tc(t,r,l)}}var s=t.return;try{sl(t)}catch(l){Tc(t,s,l)}break;case 5:var o=t.return;try{sl(t)}catch(l){Tc(t,o,l)}}}catch(l){Tc(t,t.return,l)}if(t===e){$a=null;break}var a=t.sibling;if(null!==a){a.return=t.return,$a=a;break}$a=t.return}}var El,Tl=Math.ceil,xl=w.ReactCurrentDispatcher,Il=w.ReactCurrentOwner,Al=w.ReactCurrentBatchConfig,Ol=0,Rl=null,Dl=null,Ll=0,kl=0,Ml=Er(0),Pl=0,Fl=null,Nl=0,Bl=0,jl=0,Ul=null,Vl=null,Gl=0,Wl=1/0,zl=null,Hl=!1,Yl=null,Xl=null,ql=!1,Zl=null,Kl=0,Ql=0,Jl=null,$l=-1,ec=0;function tc(){return 0!==(6&Ol)?Qe():-1!==$l?$l:$l=Qe()}function ic(e){return 0===(1&e.mode)?1:0!==(2&Ol)&&0!==Ll?Ll&-Ll:null!==ps.transition?(0===ec&&(ec=pt()),ec):0!==(e=yt)?e:e=void 0===(e=window.event)?16:Kt(e.type)}function nc(e,t,i,n){if(50<Ql)throw Ql=0,Jl=null,Error(s(185));_t(e,i,n),0!==(2&Ol)&&e===Rl||(e===Rl&&(0===(2&Ol)&&(Bl|=i),4===Pl&&lc(e,Ll)),rc(e,n),1===i&&0===Ol&&0===(1&t.mode)&&(Wl=Qe()+500,jr&&Gr()))}function rc(e,t){var i=e.callbackNode;!function(e,t){for(var i=e.suspendedLanes,n=e.pingedLanes,r=e.expirationTimes,s=e.pendingLanes;0<s;){var o=31-ot(s),a=1<<o,l=r[o];-1===l?0!==(a&i)&&0===(a&n)||(r[o]=ft(a,t)):l<=t&&(e.expiredLanes|=a),s&=~a}}(e,t);var n=dt(e,e===Rl?Ll:0);if(0===n)null!==i&&qe(i),e.callbackNode=null,e.callbackPriority=0;else if(t=n&-n,e.callbackPriority!==t){if(null!=i&&qe(i),1===t)0===e.tag?function(e){jr=!0,Vr(e)}(cc.bind(null,e)):Vr(cc.bind(null,e)),or((function(){0===(6&Ol)&&Gr()})),i=null;else{switch(wt(n)){case 1:i=$e;break;case 4:i=et;break;case 16:default:i=tt;break;case 536870912:i=nt}i=Rc(i,sc.bind(null,e))}e.callbackPriority=t,e.callbackNode=i}}function sc(e,t){if($l=-1,ec=0,0!==(6&Ol))throw Error(s(327));var i=e.callbackNode;if(Sc()&&e.callbackNode!==i)return null;var n=dt(e,e===Rl?Ll:0);if(0===n)return null;if(0!==(30&n)||0!==(n&e.expiredLanes)||t)t=_c(e,n);else{t=n;var r=Ol;Ol|=2;var o=pc();for(Rl===e&&Ll===t||(zl=null,Wl=Qe()+500,fc(e,t));;)try{yc();break}catch(l){gc(e,l)}bs(),xl.current=o,Ol=r,null!==Dl?t=0:(Rl=null,Ll=0,t=Pl)}if(0!==t){if(2===t&&(0!==(r=gt(e))&&(n=r,t=oc(e,r))),1===t)throw i=Fl,fc(e,0),lc(e,n),rc(e,Qe()),i;if(6===t)lc(e,n);else{if(r=e.current.alternate,0===(30&n)&&!function(e){for(var t=e;;){if(16384&t.flags){var i=t.updateQueue;if(null!==i&&null!==(i=i.stores))for(var n=0;n<i.length;n++){var r=i[n],s=r.getSnapshot;r=r.value;try{if(!an(s(),r))return!1}catch(a){return!1}}}if(i=t.child,16384&t.subtreeFlags&&null!==i)i.return=t,t=i;else{if(t===e)break;for(;null===t.sibling;){if(null===t.return||t.return===e)return!0;t=t.return}t.sibling.return=t.return,t=t.sibling}}return!0}(r)&&(2===(t=_c(e,n))&&(0!==(o=gt(e))&&(n=o,t=oc(e,o))),1===t))throw i=Fl,fc(e,0),lc(e,n),rc(e,Qe()),i;switch(e.finishedWork=r,e.finishedLanes=n,t){case 0:case 1:throw Error(s(345));case 2:case 5:Cc(e,Vl,zl);break;case 3:if(lc(e,n),(130023424&n)===n&&10<(t=Gl+500-Qe())){if(0!==dt(e,0))break;if(((r=e.suspendedLanes)&n)!==n){tc(),e.pingedLanes|=e.suspendedLanes&r;break}e.timeoutHandle=nr(Cc.bind(null,e,Vl,zl),t);break}Cc(e,Vl,zl);break;case 4:if(lc(e,n),(4194240&n)===n)break;for(t=e.eventTimes,r=-1;0<n;){var a=31-ot(n);o=1<<a,(a=t[a])>r&&(r=a),n&=~o}if(n=r,10<(n=(120>(n=Qe()-n)?120:480>n?480:1080>n?1080:1920>n?1920:3e3>n?3e3:4320>n?4320:1960*Tl(n/1960))-n)){e.timeoutHandle=nr(Cc.bind(null,e,Vl,zl),n);break}Cc(e,Vl,zl);break;default:throw Error(s(329))}}}return rc(e,Qe()),e.callbackNode===i?sc.bind(null,e):null}function oc(e,t){var i=Ul;return e.current.memoizedState.isDehydrated&&(fc(e,t).flags|=256),2!==(e=_c(e,t))&&(t=Vl,Vl=i,null!==t&&ac(t)),e}function ac(e){null===Vl?Vl=e:Vl.push.apply(Vl,e)}function lc(e,t){for(t&=~jl,t&=~Bl,e.suspendedLanes|=t,e.pingedLanes&=~t,e=e.expirationTimes;0<t;){var i=31-ot(t),n=1<<i;e[i]=-1,t&=~n}}function cc(e){if(0!==(6&Ol))throw Error(s(327));Sc();var t=dt(e,0);if(0===(1&t))return rc(e,Qe()),null;var i=_c(e,t);if(0!==e.tag&&2===i){var n=gt(e);0!==n&&(t=n,i=oc(e,n))}if(1===i)throw i=Fl,fc(e,0),lc(e,t),rc(e,Qe()),i;if(6===i)throw Error(s(345));return e.finishedWork=e.current.alternate,e.finishedLanes=t,Cc(e,Vl,zl),rc(e,Qe()),null}function hc(e,t){var i=Ol;Ol|=1;try{return e(t)}finally{0===(Ol=i)&&(Wl=Qe()+500,jr&&Gr())}}function uc(e){null!==Zl&&0===Zl.tag&&0===(6&Ol)&&Sc();var t=Ol;Ol|=1;var i=Al.transition,n=yt;try{if(Al.transition=null,yt=1,e)return e()}finally{yt=n,Al.transition=i,0===(6&(Ol=t))&&Gr()}}function dc(){kl=Ml.current,Tr(Ml)}function fc(e,t){e.finishedWork=null,e.finishedLanes=0;var i=e.timeoutHandle;if(-1!==i&&(e.timeoutHandle=-1,rr(i)),null!==Dl)for(i=Dl.return;null!==i;){var n=i;switch(ts(n),n.tag){case 1:null!==(n=n.type.childContextTypes)&&void 0!==n&&kr();break;case 3:ro(),Tr(Or),Tr(Ar),ho();break;case 5:oo(n);break;case 4:ro();break;case 13:case 19:Tr(ao);break;case 10:Cs(n.type._context);break;case 22:case 23:dc()}i=i.return}if(Rl=e,Dl=e=Mc(e.current,null),Ll=kl=t,Pl=0,Fl=null,jl=Bl=Nl=0,Vl=Ul=null,null!==xs){for(t=0;t<xs.length;t++)if(null!==(n=(i=xs[t]).interleaved)){i.interleaved=null;var r=n.next,s=i.pending;if(null!==s){var o=s.next;s.next=r,n.next=o}i.pending=n}xs=null}return e}function gc(e,t){for(;;){var i=Dl;try{if(bs(),uo.current=oa,vo){for(var n=po.memoizedState;null!==n;){var r=n.queue;null!==r&&(r.pending=null),n=n.next}vo=!1}if(go=0,_o=mo=po=null,yo=!1,wo=0,Il.current=null,null===i||null===i.return){Pl=1,Fl=t,Dl=null;break}e:{var o=e,a=i.return,l=i,c=t;if(t=Ll,l.flags|=32768,null!==c&&"object"===typeof c&&"function"===typeof c.then){var h=c,u=l,d=u.tag;if(0===(1&u.mode)&&(0===d||11===d||15===d)){var f=u.alternate;f?(u.updateQueue=f.updateQueue,u.memoizedState=f.memoizedState,u.lanes=f.lanes):(u.updateQueue=null,u.memoizedState=null)}var g=_a(a);if(null!==g){g.flags&=-257,va(g,a,l,0,t),1&g.mode&&ma(o,h,t),c=h;var p=(t=g).updateQueue;if(null===p){var m=new Set;m.add(c),t.updateQueue=m}else p.add(c);break e}if(0===(1&t)){ma(o,h,t),mc();break e}c=Error(s(426))}else if(rs&&1&l.mode){var _=_a(a);if(null!==_){0===(65536&_.flags)&&(_.flags|=256),va(_,a,l,0,t),gs(ha(c,l));break e}}o=c=ha(c,l),4!==Pl&&(Pl=2),null===Ul?Ul=[o]:Ul.push(o),o=a;do{switch(o.tag){case 3:o.flags|=65536,t&=-t,o.lanes|=t,Fs(o,ga(0,c,t));break e;case 1:l=c;var v=o.type,y=o.stateNode;if(0===(128&o.flags)&&("function"===typeof v.getDerivedStateFromError||null!==y&&"function"===typeof y.componentDidCatch&&(null===Xl||!Xl.has(y)))){o.flags|=65536,t&=-t,o.lanes|=t,Fs(o,pa(o,l,t));break e}}o=o.return}while(null!==o)}bc(i)}catch(w){t=w,Dl===i&&null!==i&&(Dl=i=i.return);continue}break}}function pc(){var e=xl.current;return xl.current=oa,null===e?oa:e}function mc(){0!==Pl&&3!==Pl&&2!==Pl||(Pl=4),null===Rl||0===(268435455&Nl)&&0===(268435455&Bl)||lc(Rl,Ll)}function _c(e,t){var i=Ol;Ol|=2;var n=pc();for(Rl===e&&Ll===t||(zl=null,fc(e,t));;)try{vc();break}catch(r){gc(e,r)}if(bs(),Ol=i,xl.current=n,null!==Dl)throw Error(s(261));return Rl=null,Ll=0,Pl}function vc(){for(;null!==Dl;)wc(Dl)}function yc(){for(;null!==Dl&&!Ze();)wc(Dl)}function wc(e){var t=El(e.alternate,e,kl);e.memoizedProps=e.pendingProps,null===t?bc(e):Dl=t,Il.current=null}function bc(e){var t=e;do{var i=t.alternate;if(e=t.return,0===(32768&t.flags)){if(null!==(i=qa(i,t,kl)))return void(Dl=i)}else{if(null!==(i=Za(i,t)))return i.flags&=32767,void(Dl=i);if(null===e)return Pl=6,void(Dl=null);e.flags|=32768,e.subtreeFlags=0,e.deletions=null}if(null!==(t=t.sibling))return void(Dl=t);Dl=t=e}while(null!==t);0===Pl&&(Pl=5)}function Cc(e,t,i){var n=yt,r=Al.transition;try{Al.transition=null,yt=1,function(e,t,i,n){do{Sc()}while(null!==Zl);if(0!==(6&Ol))throw Error(s(327));i=e.finishedWork;var r=e.finishedLanes;if(null===i)return null;if(e.finishedWork=null,e.finishedLanes=0,i===e.current)throw Error(s(177));e.callbackNode=null,e.callbackPriority=0;var o=i.lanes|i.childLanes;if(function(e,t){var i=e.pendingLanes&~t;e.pendingLanes=t,e.suspendedLanes=0,e.pingedLanes=0,e.expiredLanes&=t,e.mutableReadLanes&=t,e.entangledLanes&=t,t=e.entanglements;var n=e.eventTimes;for(e=e.expirationTimes;0<i;){var r=31-ot(i),s=1<<r;t[r]=0,n[r]=-1,e[r]=-1,i&=~s}}(e,o),e===Rl&&(Dl=Rl=null,Ll=0),0===(2064&i.subtreeFlags)&&0===(2064&i.flags)||ql||(ql=!0,Rc(tt,(function(){return Sc(),null}))),o=0!==(15990&i.flags),0!==(15990&i.subtreeFlags)||o){o=Al.transition,Al.transition=null;var a=yt;yt=1;var l=Ol;Ol|=4,Il.current=null,function(e,t){if(er=zt,fn(e=dn())){if("selectionStart"in e)var i={start:e.selectionStart,end:e.selectionEnd};else e:{var n=(i=(i=e.ownerDocument)&&i.defaultView||window).getSelection&&i.getSelection();if(n&&0!==n.rangeCount){i=n.anchorNode;var r=n.anchorOffset,o=n.focusNode;n=n.focusOffset;try{i.nodeType,o.nodeType}catch(b){i=null;break e}var a=0,l=-1,c=-1,h=0,u=0,d=e,f=null;t:for(;;){for(var g;d!==i||0!==r&&3!==d.nodeType||(l=a+r),d!==o||0!==n&&3!==d.nodeType||(c=a+n),3===d.nodeType&&(a+=d.nodeValue.length),null!==(g=d.firstChild);)f=d,d=g;for(;;){if(d===e)break t;if(f===i&&++h===r&&(l=a),f===o&&++u===n&&(c=a),null!==(g=d.nextSibling))break;f=(d=f).parentNode}d=g}i=-1===l||-1===c?null:{start:l,end:c}}else i=null}i=i||{start:0,end:0}}else i=null;for(tr={focusedElem:e,selectionRange:i},zt=!1,$a=t;null!==$a;)if(e=(t=$a).child,0!==(1028&t.subtreeFlags)&&null!==e)e.return=t,$a=e;else for(;null!==$a;){t=$a;try{var p=t.alternate;if(0!==(1024&t.flags))switch(t.tag){case 0:case 11:case 15:case 5:case 6:case 4:case 17:break;case 1:if(null!==p){var m=p.memoizedProps,_=p.memoizedState,v=t.stateNode,y=v.getSnapshotBeforeUpdate(t.elementType===t.type?m:ms(t.type,m),_);v.__reactInternalSnapshotBeforeUpdate=y}break;case 3:var w=t.stateNode.containerInfo;1===w.nodeType?w.textContent="":9===w.nodeType&&w.documentElement&&w.removeChild(w.documentElement);break;default:throw Error(s(163))}}catch(b){Tc(t,t.return,b)}if(null!==(e=t.sibling)){e.return=t.return,$a=e;break}$a=t.return}p=il,il=!1}(e,i),_l(i,e),gn(tr),zt=!!er,tr=er=null,e.current=i,yl(i,e,r),Ke(),Ol=l,yt=a,Al.transition=o}else e.current=i;if(ql&&(ql=!1,Zl=e,Kl=r),o=e.pendingLanes,0===o&&(Xl=null),function(e){if(st&&"function"===typeof st.onCommitFiberRoot)try{st.onCommitFiberRoot(rt,e,void 0,128===(128&e.current.flags))}catch(t){}}(i.stateNode),rc(e,Qe()),null!==t)for(n=e.onRecoverableError,i=0;i<t.length;i++)r=t[i],n(r.value,{componentStack:r.stack,digest:r.digest});if(Hl)throw Hl=!1,e=Yl,Yl=null,e;0!==(1&Kl)&&0!==e.tag&&Sc(),o=e.pendingLanes,0!==(1&o)?e===Jl?Ql++:(Ql=0,Jl=e):Ql=0,Gr()}(e,t,i,n)}finally{Al.transition=r,yt=n}return null}function Sc(){if(null!==Zl){var e=wt(Kl),t=Al.transition,i=yt;try{if(Al.transition=null,yt=16>e?16:e,null===Zl)var n=!1;else{if(e=Zl,Zl=null,Kl=0,0!==(6&Ol))throw Error(s(331));var r=Ol;for(Ol|=4,$a=e.current;null!==$a;){var o=$a,a=o.child;if(0!==(16&$a.flags)){var l=o.deletions;if(null!==l){for(var c=0;c<l.length;c++){var h=l[c];for($a=h;null!==$a;){var u=$a;switch(u.tag){case 0:case 11:case 15:nl(8,u,o)}var d=u.child;if(null!==d)d.return=u,$a=d;else for(;null!==$a;){var f=(u=$a).sibling,g=u.return;if(ol(u),u===h){$a=null;break}if(null!==f){f.return=g,$a=f;break}$a=g}}}var p=o.alternate;if(null!==p){var m=p.child;if(null!==m){p.child=null;do{var _=m.sibling;m.sibling=null,m=_}while(null!==m)}}$a=o}}if(0!==(2064&o.subtreeFlags)&&null!==a)a.return=o,$a=a;else e:for(;null!==$a;){if(0!==(2048&(o=$a).flags))switch(o.tag){case 0:case 11:case 15:nl(9,o,o.return)}var v=o.sibling;if(null!==v){v.return=o.return,$a=v;break e}$a=o.return}}var y=e.current;for($a=y;null!==$a;){var w=(a=$a).child;if(0!==(2064&a.subtreeFlags)&&null!==w)w.return=a,$a=w;else e:for(a=y;null!==$a;){if(0!==(2048&(l=$a).flags))try{switch(l.tag){case 0:case 11:case 15:rl(9,l)}}catch(C){Tc(l,l.return,C)}if(l===a){$a=null;break e}var b=l.sibling;if(null!==b){b.return=l.return,$a=b;break e}$a=l.return}}if(Ol=r,Gr(),st&&"function"===typeof st.onPostCommitFiberRoot)try{st.onPostCommitFiberRoot(rt,e)}catch(C){}n=!0}return n}finally{yt=i,Al.transition=t}}return!1}function Ec(e,t,i){e=Ms(e,t=ga(0,t=ha(i,t),1),1),t=tc(),null!==e&&(_t(e,1,t),rc(e,t))}function Tc(e,t,i){if(3===e.tag)Ec(e,e,i);else for(;null!==t;){if(3===t.tag){Ec(t,e,i);break}if(1===t.tag){var n=t.stateNode;if("function"===typeof t.type.getDerivedStateFromError||"function"===typeof n.componentDidCatch&&(null===Xl||!Xl.has(n))){t=Ms(t,e=pa(t,e=ha(i,e),1),1),e=tc(),null!==t&&(_t(t,1,e),rc(t,e));break}}t=t.return}}function xc(e,t,i){var n=e.pingCache;null!==n&&n.delete(t),t=tc(),e.pingedLanes|=e.suspendedLanes&i,Rl===e&&(Ll&i)===i&&(4===Pl||3===Pl&&(130023424&Ll)===Ll&&500>Qe()-Gl?fc(e,0):jl|=i),rc(e,t)}function Ic(e,t){0===t&&(0===(1&e.mode)?t=1:(t=ht,0===(130023424&(ht<<=1))&&(ht=4194304)));var i=tc();null!==(e=Os(e,t))&&(_t(e,t,i),rc(e,i))}function Ac(e){var t=e.memoizedState,i=0;null!==t&&(i=t.retryLane),Ic(e,i)}function Oc(e,t){var i=0;switch(e.tag){case 13:var n=e.stateNode,r=e.memoizedState;null!==r&&(i=r.retryLane);break;case 19:n=e.stateNode;break;default:throw Error(s(314))}null!==n&&n.delete(t),Ic(e,i)}function Rc(e,t){return Xe(e,t)}function Dc(e,t,i,n){this.tag=e,this.key=i,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=t,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=n,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function Lc(e,t,i,n){return new Dc(e,t,i,n)}function kc(e){return!(!(e=e.prototype)||!e.isReactComponent)}function Mc(e,t){var i=e.alternate;return null===i?((i=Lc(e.tag,t,e.key,e.mode)).elementType=e.elementType,i.type=e.type,i.stateNode=e.stateNode,i.alternate=e,e.alternate=i):(i.pendingProps=t,i.type=e.type,i.flags=0,i.subtreeFlags=0,i.deletions=null),i.flags=14680064&e.flags,i.childLanes=e.childLanes,i.lanes=e.lanes,i.child=e.child,i.memoizedProps=e.memoizedProps,i.memoizedState=e.memoizedState,i.updateQueue=e.updateQueue,t=e.dependencies,i.dependencies=null===t?null:{lanes:t.lanes,firstContext:t.firstContext},i.sibling=e.sibling,i.index=e.index,i.ref=e.ref,i}function Pc(e,t,i,n,r,o){var a=2;if(n=e,"function"===typeof e)kc(e)&&(a=1);else if("string"===typeof e)a=5;else e:switch(e){case S:return Fc(i.children,r,o,t);case E:a=8,r|=8;break;case T:return(e=Lc(12,i,t,2|r)).elementType=T,e.lanes=o,e;case O:return(e=Lc(13,i,t,r)).elementType=O,e.lanes=o,e;case R:return(e=Lc(19,i,t,r)).elementType=R,e.lanes=o,e;case k:return Nc(i,r,o,t);default:if("object"===typeof e&&null!==e)switch(e.$$typeof){case x:a=10;break e;case I:a=9;break e;case A:a=11;break e;case D:a=14;break e;case L:a=16,n=null;break e}throw Error(s(130,null==e?e:typeof e,""))}return(t=Lc(a,i,t,r)).elementType=e,t.type=n,t.lanes=o,t}function Fc(e,t,i,n){return(e=Lc(7,e,n,t)).lanes=i,e}function Nc(e,t,i,n){return(e=Lc(22,e,n,t)).elementType=k,e.lanes=i,e.stateNode={isHidden:!1},e}function Bc(e,t,i){return(e=Lc(6,e,null,t)).lanes=i,e}function jc(e,t,i){return(t=Lc(4,null!==e.children?e.children:[],e.key,t)).lanes=i,t.stateNode={containerInfo:e.containerInfo,pendingChildren:null,implementation:e.implementation},t}function Uc(e,t,i,n,r){this.tag=t,this.containerInfo=e,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=mt(0),this.expirationTimes=mt(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=mt(0),this.identifierPrefix=n,this.onRecoverableError=r,this.mutableSourceEagerHydrationData=null}function Vc(e,t,i,n,r,s,o,a,l){return e=new Uc(e,t,i,a,l),1===t?(t=1,!0===s&&(t|=8)):t=0,s=Lc(3,null,null,t),e.current=s,s.stateNode=e,s.memoizedState={element:n,isDehydrated:i,cache:null,transitions:null,pendingSuspenseBoundaries:null},Ds(s),e}function Gc(e){if(!e)return Ir;e:{if(Ge(e=e._reactInternals)!==e||1!==e.tag)throw Error(s(170));var t=e;do{switch(t.tag){case 3:t=t.stateNode.context;break e;case 1:if(Lr(t.type)){t=t.stateNode.__reactInternalMemoizedMergedChildContext;break e}}t=t.return}while(null!==t);throw Error(s(171))}if(1===e.tag){var i=e.type;if(Lr(i))return Pr(e,i,t)}return t}function Wc(e,t,i,n,r,s,o,a,l){return(e=Vc(i,n,!0,e,0,s,0,a,l)).context=Gc(null),i=e.current,(s=ks(n=tc(),r=ic(i))).callback=void 0!==t&&null!==t?t:null,Ms(i,s,r),e.current.lanes=r,_t(e,r,n),rc(e,n),e}function zc(e,t,i,n){var r=t.current,s=tc(),o=ic(r);return i=Gc(i),null===t.context?t.context=i:t.pendingContext=i,(t=ks(s,o)).payload={element:e},null!==(n=void 0===n?null:n)&&(t.callback=n),null!==(e=Ms(r,t,o))&&(nc(e,r,o,s),Ps(e,r,o)),o}function Hc(e){return(e=e.current).child?(e.child.tag,e.child.stateNode):null}function Yc(e,t){if(null!==(e=e.memoizedState)&&null!==e.dehydrated){var i=e.retryLane;e.retryLane=0!==i&&i<t?i:t}}function Xc(e,t){Yc(e,t),(e=e.alternate)&&Yc(e,t)}El=function(e,t,i){if(null!==e)if(e.memoizedProps!==t.pendingProps||Or.current)wa=!0;else{if(0===(e.lanes&i)&&0===(128&t.flags))return wa=!1,function(e,t,i){switch(t.tag){case 3:Ra(t),fs();break;case 5:so(t);break;case 1:Lr(t.type)&&Fr(t);break;case 4:no(t,t.stateNode.containerInfo);break;case 10:var n=t.type._context,r=t.memoizedProps.value;xr(_s,n._currentValue),n._currentValue=r;break;case 13:if(null!==(n=t.memoizedState))return null!==n.dehydrated?(xr(ao,1&ao.current),t.flags|=128,null):0!==(i&t.child.childLanes)?Ba(e,t,i):(xr(ao,1&ao.current),null!==(e=Ha(e,t,i))?e.sibling:null);xr(ao,1&ao.current);break;case 19:if(n=0!==(i&t.childLanes),0!==(128&e.flags)){if(n)return Wa(e,t,i);t.flags|=128}if(null!==(r=t.memoizedState)&&(r.rendering=null,r.tail=null,r.lastEffect=null),xr(ao,ao.current),n)break;return null;case 22:case 23:return t.lanes=0,Ta(e,t,i)}return Ha(e,t,i)}(e,t,i);wa=0!==(131072&e.flags)}else wa=!1,rs&&0!==(1048576&t.flags)&&$r(t,Yr,t.index);switch(t.lanes=0,t.tag){case 2:var n=t.type;za(e,t),e=t.pendingProps;var r=Dr(t,Ar.current);Es(t,i),r=Eo(null,t,n,e,r,i);var o=To();return t.flags|=1,"object"===typeof r&&null!==r&&"function"===typeof r.render&&void 0===r.$$typeof?(t.tag=1,t.memoizedState=null,t.updateQueue=null,Lr(n)?(o=!0,Fr(t)):o=!1,t.memoizedState=null!==r.state&&void 0!==r.state?r.state:null,Ds(t),r.updater=Vs,t.stateNode=r,r._reactInternals=t,Hs(t,n,e,i),t=Oa(null,t,n,!0,o,i)):(t.tag=0,rs&&o&&es(t),ba(null,t,r,i),t=t.child),t;case 16:n=t.elementType;e:{switch(za(e,t),e=t.pendingProps,n=(r=n._init)(n._payload),t.type=n,r=t.tag=function(e){if("function"===typeof e)return kc(e)?1:0;if(void 0!==e&&null!==e){if((e=e.$$typeof)===A)return 11;if(e===D)return 14}return 2}(n),e=ms(n,e),r){case 0:t=Ia(null,t,n,e,i);break e;case 1:t=Aa(null,t,n,e,i);break e;case 11:t=Ca(null,t,n,e,i);break e;case 14:t=Sa(null,t,n,ms(n.type,e),i);break e}throw Error(s(306,n,""))}return t;case 0:return n=t.type,r=t.pendingProps,Ia(e,t,n,r=t.elementType===n?r:ms(n,r),i);case 1:return n=t.type,r=t.pendingProps,Aa(e,t,n,r=t.elementType===n?r:ms(n,r),i);case 3:e:{if(Ra(t),null===e)throw Error(s(387));n=t.pendingProps,r=(o=t.memoizedState).element,Ls(e,t),Ns(t,n,null,i);var a=t.memoizedState;if(n=a.element,o.isDehydrated){if(o={element:n,isDehydrated:!1,cache:a.cache,pendingSuspenseBoundaries:a.pendingSuspenseBoundaries,transitions:a.transitions},t.updateQueue.baseState=o,t.memoizedState=o,256&t.flags){t=Da(e,t,n,i,r=ha(Error(s(423)),t));break e}if(n!==r){t=Da(e,t,n,i,r=ha(Error(s(424)),t));break e}for(ns=cr(t.stateNode.containerInfo.firstChild),is=t,rs=!0,ss=null,i=Qs(t,null,n,i),t.child=i;i;)i.flags=-3&i.flags|4096,i=i.sibling}else{if(fs(),n===r){t=Ha(e,t,i);break e}ba(e,t,n,i)}t=t.child}return t;case 5:return so(t),null===e&&cs(t),n=t.type,r=t.pendingProps,o=null!==e?e.memoizedProps:null,a=r.children,ir(n,r)?a=null:null!==o&&ir(n,o)&&(t.flags|=32),xa(e,t),ba(e,t,a,i),t.child;case 6:return null===e&&cs(t),null;case 13:return Ba(e,t,i);case 4:return no(t,t.stateNode.containerInfo),n=t.pendingProps,null===e?t.child=Ks(t,null,n,i):ba(e,t,n,i),t.child;case 11:return n=t.type,r=t.pendingProps,Ca(e,t,n,r=t.elementType===n?r:ms(n,r),i);case 7:return ba(e,t,t.pendingProps,i),t.child;case 8:case 12:return ba(e,t,t.pendingProps.children,i),t.child;case 10:e:{if(n=t.type._context,r=t.pendingProps,o=t.memoizedProps,a=r.value,xr(_s,n._currentValue),n._currentValue=a,null!==o)if(an(o.value,a)){if(o.children===r.children&&!Or.current){t=Ha(e,t,i);break e}}else for(null!==(o=t.child)&&(o.return=t);null!==o;){var l=o.dependencies;if(null!==l){a=o.child;for(var c=l.firstContext;null!==c;){if(c.context===n){if(1===o.tag){(c=ks(-1,i&-i)).tag=2;var h=o.updateQueue;if(null!==h){var u=(h=h.shared).pending;null===u?c.next=c:(c.next=u.next,u.next=c),h.pending=c}}o.lanes|=i,null!==(c=o.alternate)&&(c.lanes|=i),Ss(o.return,i,t),l.lanes|=i;break}c=c.next}}else if(10===o.tag)a=o.type===t.type?null:o.child;else if(18===o.tag){if(null===(a=o.return))throw Error(s(341));a.lanes|=i,null!==(l=a.alternate)&&(l.lanes|=i),Ss(a,i,t),a=o.sibling}else a=o.child;if(null!==a)a.return=o;else for(a=o;null!==a;){if(a===t){a=null;break}if(null!==(o=a.sibling)){o.return=a.return,a=o;break}a=a.return}o=a}ba(e,t,r.children,i),t=t.child}return t;case 9:return r=t.type,n=t.pendingProps.children,Es(t,i),n=n(r=Ts(r)),t.flags|=1,ba(e,t,n,i),t.child;case 14:return r=ms(n=t.type,t.pendingProps),Sa(e,t,n,r=ms(n.type,r),i);case 15:return Ea(e,t,t.type,t.pendingProps,i);case 17:return n=t.type,r=t.pendingProps,r=t.elementType===n?r:ms(n,r),za(e,t),t.tag=1,Lr(n)?(e=!0,Fr(t)):e=!1,Es(t,i),Ws(t,n,r),Hs(t,n,r,i),Oa(null,t,n,!0,e,i);case 19:return Wa(e,t,i);case 22:return Ta(e,t,i)}throw Error(s(156,t.tag))};var qc="function"===typeof reportError?reportError:function(e){console.error(e)};function Zc(e){this._internalRoot=e}function Kc(e){this._internalRoot=e}function Qc(e){return!(!e||1!==e.nodeType&&9!==e.nodeType&&11!==e.nodeType)}function Jc(e){return!(!e||1!==e.nodeType&&9!==e.nodeType&&11!==e.nodeType&&(8!==e.nodeType||" react-mount-point-unstable "!==e.nodeValue))}function $c(){}function eh(e,t,i,n,r){var s=i._reactRootContainer;if(s){var o=s;if("function"===typeof r){var a=r;r=function(){var e=Hc(o);a.call(e)}}zc(t,o,e,r)}else o=function(e,t,i,n,r){if(r){if("function"===typeof n){var s=n;n=function(){var e=Hc(o);s.call(e)}}var o=Wc(t,n,e,0,null,!1,0,"",$c);return e._reactRootContainer=o,e[gr]=o.current,Gn(8===e.nodeType?e.parentNode:e),uc(),o}for(;r=e.lastChild;)e.removeChild(r);if("function"===typeof n){var a=n;n=function(){var e=Hc(l);a.call(e)}}var l=Vc(e,0,!1,null,0,!1,0,"",$c);return e._reactRootContainer=l,e[gr]=l.current,Gn(8===e.nodeType?e.parentNode:e),uc((function(){zc(t,l,i,n)})),l}(i,t,e,r,n);return Hc(o)}Kc.prototype.render=Zc.prototype.render=function(e){var t=this._internalRoot;if(null===t)throw Error(s(409));zc(e,t,null,null)},Kc.prototype.unmount=Zc.prototype.unmount=function(){var e=this._internalRoot;if(null!==e){this._internalRoot=null;var t=e.containerInfo;uc((function(){zc(null,e,null,null)})),t[gr]=null}},Kc.prototype.unstable_scheduleHydration=function(e){if(e){var t=Et();e={blockedOn:null,target:e,priority:t};for(var i=0;i<kt.length&&0!==t&&t<kt[i].priority;i++);kt.splice(i,0,e),0===i&&Nt(e)}},bt=function(e){switch(e.tag){case 3:var t=e.stateNode;if(t.current.memoizedState.isDehydrated){var i=ut(t.pendingLanes);0!==i&&(vt(t,1|i),rc(t,Qe()),0===(6&Ol)&&(Wl=Qe()+500,Gr()))}break;case 13:uc((function(){var t=Os(e,1);if(null!==t){var i=tc();nc(t,e,1,i)}})),Xc(e,1)}},Ct=function(e){if(13===e.tag){var t=Os(e,134217728);if(null!==t)nc(t,e,134217728,tc());Xc(e,134217728)}},St=function(e){if(13===e.tag){var t=ic(e),i=Os(e,t);if(null!==i)nc(i,e,t,tc());Xc(e,t)}},Et=function(){return yt},Tt=function(e,t){var i=yt;try{return yt=e,t()}finally{yt=i}},Ce=function(e,t,i){switch(t){case"input":if(J(e,i),t=i.name,"radio"===i.type&&null!=t){for(i=e;i.parentNode;)i=i.parentNode;for(i=i.querySelectorAll("input[name="+JSON.stringify(""+t)+'][type="radio"]'),t=0;t<i.length;t++){var n=i[t];if(n!==e&&n.form===e.form){var r=br(n);if(!r)throw Error(s(90));X(n),J(n,r)}}}break;case"textarea":se(e,i);break;case"select":null!=(t=i.value)&&ie(e,!!i.multiple,t,!1)}},Ae=hc,Oe=uc;var th={usingClientEntryPoint:!1,Events:[yr,wr,br,xe,Ie,hc]},ih={findFiberByHostInstance:vr,bundleType:0,version:"18.2.0",rendererPackageName:"react-dom"},nh={bundleType:ih.bundleType,version:ih.version,rendererPackageName:ih.rendererPackageName,rendererConfig:ih.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:w.ReactCurrentDispatcher,findHostInstanceByFiber:function(e){return null===(e=He(e))?null:e.stateNode},findFiberByHostInstance:ih.findFiberByHostInstance||function(){return null},findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.2.0-next-9e3b772b8-20220608"};if("undefined"!==typeof __REACT_DEVTOOLS_GLOBAL_HOOK__){var rh=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!rh.isDisabled&&rh.supportsFiber)try{rt=rh.inject(nh),st=rh}catch(he){}}t.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=th,t.createPortal=function(e,t){var i=2<arguments.length&&void 0!==arguments[2]?arguments[2]:null;if(!Qc(t))throw Error(s(200));return function(e,t,i){var n=3<arguments.length&&void 0!==arguments[3]?arguments[3]:null;return{$$typeof:C,key:null==n?null:""+n,children:e,containerInfo:t,implementation:i}}(e,t,null,i)},t.createRoot=function(e,t){if(!Qc(e))throw Error(s(299));var i=!1,n="",r=qc;return null!==t&&void 0!==t&&(!0===t.unstable_strictMode&&(i=!0),void 0!==t.identifierPrefix&&(n=t.identifierPrefix),void 0!==t.onRecoverableError&&(r=t.onRecoverableError)),t=Vc(e,1,!1,null,0,i,0,n,r),e[gr]=t.current,Gn(8===e.nodeType?e.parentNode:e),new Zc(t)},t.findDOMNode=function(e){if(null==e)return null;if(1===e.nodeType)return e;var t=e._reactInternals;if(void 0===t){if("function"===typeof e.render)throw Error(s(188));throw e=Object.keys(e).join(","),Error(s(268,e))}return e=null===(e=He(t))?null:e.stateNode},t.flushSync=function(e){return uc(e)},t.hydrate=function(e,t,i){if(!Jc(t))throw Error(s(200));return eh(null,e,t,!0,i)},t.hydrateRoot=function(e,t,i){if(!Qc(e))throw Error(s(405));var n=null!=i&&i.hydratedSources||null,r=!1,o="",a=qc;if(null!==i&&void 0!==i&&(!0===i.unstable_strictMode&&(r=!0),void 0!==i.identifierPrefix&&(o=i.identifierPrefix),void 0!==i.onRecoverableError&&(a=i.onRecoverableError)),t=Wc(t,null,e,1,null!=i?i:null,r,0,o,a),e[gr]=t.current,Gn(e),n)for(e=0;e<n.length;e++)r=(r=(i=n[e])._getVersion)(i._source),null==t.mutableSourceEagerHydrationData?t.mutableSourceEagerHydrationData=[i,r]:t.mutableSourceEagerHydrationData.push(i,r);return new Kc(t)},t.render=function(e,t,i){if(!Jc(t))throw Error(s(200));return eh(null,e,t,!1,i)},t.unmountComponentAtNode=function(e){if(!Jc(e))throw Error(s(40));return!!e._reactRootContainer&&(uc((function(){eh(null,null,e,!1,(function(){e._reactRootContainer=null,e[gr]=null}))})),!0)},t.unstable_batchedUpdates=hc,t.unstable_renderSubtreeIntoContainer=function(e,t,i,n){if(!Jc(i))throw Error(s(200));if(null==e||void 0===e._reactInternals)throw Error(s(38));return eh(e,t,i,!1,n)},t.version="18.2.0-next-9e3b772b8-20220608"},250:(e,t,i)=>{var n=i(164);t.createRoot=n.createRoot,t.hydrateRoot=n.hydrateRoot},164:(e,t,i)=>{!function e(){if("undefined"!==typeof __REACT_DEVTOOLS_GLOBAL_HOOK__&&"function"===typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE)try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(e)}catch(t){console.error(t)}}(),e.exports=i(463)},374:(e,t,i)=>{var n=i(791),r=Symbol.for("react.element"),s=Symbol.for("react.fragment"),o=Object.prototype.hasOwnProperty,a=n.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,l={key:!0,ref:!0,__self:!0,__source:!0};function c(e,t,i){var n,s={},c=null,h=null;for(n in void 0!==i&&(c=""+i),void 0!==t.key&&(c=""+t.key),void 0!==t.ref&&(h=t.ref),t)o.call(t,n)&&!l.hasOwnProperty(n)&&(s[n]=t[n]);if(e&&e.defaultProps)for(n in t=e.defaultProps)void 0===s[n]&&(s[n]=t[n]);return{$$typeof:r,type:e,key:c,ref:h,props:s,_owner:a.current}}t.jsx=c,t.jsxs=c},117:(e,t)=>{var i=Symbol.for("react.element"),n=Symbol.for("react.portal"),r=Symbol.for("react.fragment"),s=Symbol.for("react.strict_mode"),o=Symbol.for("react.profiler"),a=Symbol.for("react.provider"),l=Symbol.for("react.context"),c=Symbol.for("react.forward_ref"),h=Symbol.for("react.suspense"),u=Symbol.for("react.memo"),d=Symbol.for("react.lazy"),f=Symbol.iterator;var g={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},p=Object.assign,m={};function _(e,t,i){this.props=e,this.context=t,this.refs=m,this.updater=i||g}function v(){}function y(e,t,i){this.props=e,this.context=t,this.refs=m,this.updater=i||g}_.prototype.isReactComponent={},_.prototype.setState=function(e,t){if("object"!==typeof e&&"function"!==typeof e&&null!=e)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,e,t,"setState")},_.prototype.forceUpdate=function(e){this.updater.enqueueForceUpdate(this,e,"forceUpdate")},v.prototype=_.prototype;var w=y.prototype=new v;w.constructor=y,p(w,_.prototype),w.isPureReactComponent=!0;var b=Array.isArray,C=Object.prototype.hasOwnProperty,S={current:null},E={key:!0,ref:!0,__self:!0,__source:!0};function T(e,t,n){var r,s={},o=null,a=null;if(null!=t)for(r in void 0!==t.ref&&(a=t.ref),void 0!==t.key&&(o=""+t.key),t)C.call(t,r)&&!E.hasOwnProperty(r)&&(s[r]=t[r]);var l=arguments.length-2;if(1===l)s.children=n;else if(1<l){for(var c=Array(l),h=0;h<l;h++)c[h]=arguments[h+2];s.children=c}if(e&&e.defaultProps)for(r in l=e.defaultProps)void 0===s[r]&&(s[r]=l[r]);return{$$typeof:i,type:e,key:o,ref:a,props:s,_owner:S.current}}function x(e){return"object"===typeof e&&null!==e&&e.$$typeof===i}var I=/\/+/g;function A(e,t){return"object"===typeof e&&null!==e&&null!=e.key?function(e){var t={"=":"=0",":":"=2"};return"$"+e.replace(/[=:]/g,(function(e){return t[e]}))}(""+e.key):t.toString(36)}function O(e,t,r,s,o){var a=typeof e;"undefined"!==a&&"boolean"!==a||(e=null);var l=!1;if(null===e)l=!0;else switch(a){case"string":case"number":l=!0;break;case"object":switch(e.$$typeof){case i:case n:l=!0}}if(l)return o=o(l=e),e=""===s?"."+A(l,0):s,b(o)?(r="",null!=e&&(r=e.replace(I,"$&/")+"/"),O(o,t,r,"",(function(e){return e}))):null!=o&&(x(o)&&(o=function(e,t){return{$$typeof:i,type:e.type,key:t,ref:e.ref,props:e.props,_owner:e._owner}}(o,r+(!o.key||l&&l.key===o.key?"":(""+o.key).replace(I,"$&/")+"/")+e)),t.push(o)),1;if(l=0,s=""===s?".":s+":",b(e))for(var c=0;c<e.length;c++){var h=s+A(a=e[c],c);l+=O(a,t,r,h,o)}else if(h=function(e){return null===e||"object"!==typeof e?null:"function"===typeof(e=f&&e[f]||e["@@iterator"])?e:null}(e),"function"===typeof h)for(e=h.call(e),c=0;!(a=e.next()).done;)l+=O(a=a.value,t,r,h=s+A(a,c++),o);else if("object"===a)throw t=String(e),Error("Objects are not valid as a React child (found: "+("[object Object]"===t?"object with keys {"+Object.keys(e).join(", ")+"}":t)+"). If you meant to render a collection of children, use an array instead.");return l}function R(e,t,i){if(null==e)return e;var n=[],r=0;return O(e,n,"","",(function(e){return t.call(i,e,r++)})),n}function D(e){if(-1===e._status){var t=e._result;(t=t()).then((function(t){0!==e._status&&-1!==e._status||(e._status=1,e._result=t)}),(function(t){0!==e._status&&-1!==e._status||(e._status=2,e._result=t)})),-1===e._status&&(e._status=0,e._result=t)}if(1===e._status)return e._result.default;throw e._result}var L={current:null},k={transition:null},M={ReactCurrentDispatcher:L,ReactCurrentBatchConfig:k,ReactCurrentOwner:S};t.Children={map:R,forEach:function(e,t,i){R(e,(function(){t.apply(this,arguments)}),i)},count:function(e){var t=0;return R(e,(function(){t++})),t},toArray:function(e){return R(e,(function(e){return e}))||[]},only:function(e){if(!x(e))throw Error("React.Children.only expected to receive a single React element child.");return e}},t.Component=_,t.Fragment=r,t.Profiler=o,t.PureComponent=y,t.StrictMode=s,t.Suspense=h,t.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=M,t.cloneElement=function(e,t,n){if(null===e||void 0===e)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+e+".");var r=p({},e.props),s=e.key,o=e.ref,a=e._owner;if(null!=t){if(void 0!==t.ref&&(o=t.ref,a=S.current),void 0!==t.key&&(s=""+t.key),e.type&&e.type.defaultProps)var l=e.type.defaultProps;for(c in t)C.call(t,c)&&!E.hasOwnProperty(c)&&(r[c]=void 0===t[c]&&void 0!==l?l[c]:t[c])}var c=arguments.length-2;if(1===c)r.children=n;else if(1<c){l=Array(c);for(var h=0;h<c;h++)l[h]=arguments[h+2];r.children=l}return{$$typeof:i,type:e.type,key:s,ref:o,props:r,_owner:a}},t.createContext=function(e){return(e={$$typeof:l,_currentValue:e,_currentValue2:e,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null}).Provider={$$typeof:a,_context:e},e.Consumer=e},t.createElement=T,t.createFactory=function(e){var t=T.bind(null,e);return t.type=e,t},t.createRef=function(){return{current:null}},t.forwardRef=function(e){return{$$typeof:c,render:e}},t.isValidElement=x,t.lazy=function(e){return{$$typeof:d,_payload:{_status:-1,_result:e},_init:D}},t.memo=function(e,t){return{$$typeof:u,type:e,compare:void 0===t?null:t}},t.startTransition=function(e){var t=k.transition;k.transition={};try{e()}finally{k.transition=t}},t.unstable_act=function(){throw Error("act(...) is not supported in production builds of React.")},t.useCallback=function(e,t){return L.current.useCallback(e,t)},t.useContext=function(e){return L.current.useContext(e)},t.useDebugValue=function(){},t.useDeferredValue=function(e){return L.current.useDeferredValue(e)},t.useEffect=function(e,t){return L.current.useEffect(e,t)},t.useId=function(){return L.current.useId()},t.useImperativeHandle=function(e,t,i){return L.current.useImperativeHandle(e,t,i)},t.useInsertionEffect=function(e,t){return L.current.useInsertionEffect(e,t)},t.useLayoutEffect=function(e,t){return L.current.useLayoutEffect(e,t)},t.useMemo=function(e,t){return L.current.useMemo(e,t)},t.useReducer=function(e,t,i){return L.current.useReducer(e,t,i)},t.useRef=function(e){return L.current.useRef(e)},t.useState=function(e){return L.current.useState(e)},t.useSyncExternalStore=function(e,t,i){return L.current.useSyncExternalStore(e,t,i)},t.useTransition=function(){return L.current.useTransition()},t.version="18.2.0"},791:(e,t,i)=>{e.exports=i(117)},184:(e,t,i)=>{e.exports=i(374)},813:(e,t)=>{function i(e,t){var i=e.length;e.push(t);e:for(;0<i;){var n=i-1>>>1,r=e[n];if(!(0<s(r,t)))break e;e[n]=t,e[i]=r,i=n}}function n(e){return 0===e.length?null:e[0]}function r(e){if(0===e.length)return null;var t=e[0],i=e.pop();if(i!==t){e[0]=i;e:for(var n=0,r=e.length,o=r>>>1;n<o;){var a=2*(n+1)-1,l=e[a],c=a+1,h=e[c];if(0>s(l,i))c<r&&0>s(h,l)?(e[n]=h,e[c]=i,n=c):(e[n]=l,e[a]=i,n=a);else{if(!(c<r&&0>s(h,i)))break e;e[n]=h,e[c]=i,n=c}}}return t}function s(e,t){var i=e.sortIndex-t.sortIndex;return 0!==i?i:e.id-t.id}if("object"===typeof performance&&"function"===typeof performance.now){var o=performance;t.unstable_now=function(){return o.now()}}else{var a=Date,l=a.now();t.unstable_now=function(){return a.now()-l}}var c=[],h=[],u=1,d=null,f=3,g=!1,p=!1,m=!1,_="function"===typeof setTimeout?setTimeout:null,v="function"===typeof clearTimeout?clearTimeout:null,y="undefined"!==typeof setImmediate?setImmediate:null;function w(e){for(var t=n(h);null!==t;){if(null===t.callback)r(h);else{if(!(t.startTime<=e))break;r(h),t.sortIndex=t.expirationTime,i(c,t)}t=n(h)}}function b(e){if(m=!1,w(e),!p)if(null!==n(c))p=!0,k(C);else{var t=n(h);null!==t&&M(b,t.startTime-e)}}function C(e,i){p=!1,m&&(m=!1,v(x),x=-1),g=!0;var s=f;try{for(w(i),d=n(c);null!==d&&(!(d.expirationTime>i)||e&&!O());){var o=d.callback;if("function"===typeof o){d.callback=null,f=d.priorityLevel;var a=o(d.expirationTime<=i);i=t.unstable_now(),"function"===typeof a?d.callback=a:d===n(c)&&r(c),w(i)}else r(c);d=n(c)}if(null!==d)var l=!0;else{var u=n(h);null!==u&&M(b,u.startTime-i),l=!1}return l}finally{d=null,f=s,g=!1}}"undefined"!==typeof navigator&&void 0!==navigator.scheduling&&void 0!==navigator.scheduling.isInputPending&&navigator.scheduling.isInputPending.bind(navigator.scheduling);var S,E=!1,T=null,x=-1,I=5,A=-1;function O(){return!(t.unstable_now()-A<I)}function R(){if(null!==T){var e=t.unstable_now();A=e;var i=!0;try{i=T(!0,e)}finally{i?S():(E=!1,T=null)}}else E=!1}if("function"===typeof y)S=function(){y(R)};else if("undefined"!==typeof MessageChannel){var D=new MessageChannel,L=D.port2;D.port1.onmessage=R,S=function(){L.postMessage(null)}}else S=function(){_(R,0)};function k(e){T=e,E||(E=!0,S())}function M(e,i){x=_((function(){e(t.unstable_now())}),i)}t.unstable_IdlePriority=5,t.unstable_ImmediatePriority=1,t.unstable_LowPriority=4,t.unstable_NormalPriority=3,t.unstable_Profiling=null,t.unstable_UserBlockingPriority=2,t.unstable_cancelCallback=function(e){e.callback=null},t.unstable_continueExecution=function(){p||g||(p=!0,k(C))},t.unstable_forceFrameRate=function(e){0>e||125<e?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):I=0<e?Math.floor(1e3/e):5},t.unstable_getCurrentPriorityLevel=function(){return f},t.unstable_getFirstCallbackNode=function(){return n(c)},t.unstable_next=function(e){switch(f){case 1:case 2:case 3:var t=3;break;default:t=f}var i=f;f=t;try{return e()}finally{f=i}},t.unstable_pauseExecution=function(){},t.unstable_requestPaint=function(){},t.unstable_runWithPriority=function(e,t){switch(e){case 1:case 2:case 3:case 4:case 5:break;default:e=3}var i=f;f=e;try{return t()}finally{f=i}},t.unstable_scheduleCallback=function(e,r,s){var o=t.unstable_now();switch("object"===typeof s&&null!==s?s="number"===typeof(s=s.delay)&&0<s?o+s:o:s=o,e){case 1:var a=-1;break;case 2:a=250;break;case 5:a=1073741823;break;case 4:a=1e4;break;default:a=5e3}return e={id:u++,callback:r,priorityLevel:e,startTime:s,expirationTime:a=s+a,sortIndex:-1},s>o?(e.sortIndex=s,i(h,e),null===n(c)&&e===n(h)&&(m?(v(x),x=-1):m=!0,M(b,s-o))):(e.sortIndex=a,i(c,e),p||g||(p=!0,k(C))),e},t.unstable_shouldYield=O,t.unstable_wrapCallback=function(e){var t=f;return function(){var i=f;f=t;try{return e.apply(this,arguments)}finally{f=i}}}},296:(e,t,i)=>{e.exports=i(813)}},t={};function i(n){var r=t[n];if(void 0!==r)return r.exports;var s=t[n]={exports:{}};return e[n](s,s.exports,i),s.exports}i.m=e,i.d=(e,t)=>{for(var n in t)i.o(t,n)&&!i.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})},i.f={},i.e=e=>Promise.all(Object.keys(i.f).reduce(((t,n)=>(i.f[n](e,t),t)),[])),i.u=e=>"static/js/"+e+".1540c181.chunk.js",i.miniCssF=e=>{},i.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),(()=>{var e={},t="hello-world:";i.l=(n,r,s,o)=>{if(e[n])e[n].push(r);else{var a,l;if(void 0!==s)for(var c=document.getElementsByTagName("script"),h=0;h<c.length;h++){var u=c[h];if(u.getAttribute("src")==n||u.getAttribute("data-webpack")==t+s){a=u;break}}a||(l=!0,(a=document.createElement("script")).charset="utf-8",a.timeout=120,i.nc&&a.setAttribute("nonce",i.nc),a.setAttribute("data-webpack",t+s),a.src=n),e[n]=[r];var d=(t,i)=>{a.onerror=a.onload=null,clearTimeout(f);var r=e[n];if(delete e[n],a.parentNode&&a.parentNode.removeChild(a),r&&r.forEach((e=>e(i))),t)return t(i)},f=setTimeout(d.bind(null,void 0,{type:"timeout",target:a}),12e4);a.onerror=d.bind(null,a.onerror),a.onload=d.bind(null,a.onload),l&&document.head.appendChild(a)}}})(),i.r=e=>{"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},i.p="./",(()=>{var e={179:0};i.f.j=(t,n)=>{var r=i.o(e,t)?e[t]:void 0;if(0!==r)if(r)n.push(r[2]);else{var s=new Promise(((i,n)=>r=e[t]=[i,n]));n.push(r[2]=s);var o=i.p+i.u(t),a=new Error;i.l(o,(n=>{if(i.o(e,t)&&(0!==(r=e[t])&&(e[t]=void 0),r)){var s=n&&("load"===n.type?"missing":n.type),o=n&&n.target&&n.target.src;a.message="Loading chunk "+t+" failed.\n("+s+": "+o+")",a.name="ChunkLoadError",a.type=s,a.request=o,r[1](a)}}),"chunk-"+t,t)}};var t=(t,n)=>{var r,s,o=n[0],a=n[1],l=n[2],c=0;if(o.some((t=>0!==e[t]))){for(r in a)i.o(a,r)&&(i.m[r]=a[r]);if(l)l(i)}for(t&&t(n);c<o.length;c++)s=o[c],i.o(e,s)&&e[s]&&e[s][0](),e[s]=0},n=self.webpackChunkhello_world=self.webpackChunkhello_world||[];n.forEach(t.bind(null,0)),n.push=t.bind(null,n.push.bind(n))})(),(()=>{var e,t,n,r=i(791),s=i(250);function o(e,t,i,n){if("a"===i&&!n)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!n:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===i?n:"a"===i?n.call(e):n?n.value:t.get(e)}function a(e,t,i,n,r){if("m"===n)throw new TypeError("Private method is not writable");if("a"===n&&!r)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!r:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===n?r.call(e,i):r?r.value=i:t.set(e,i),i}"function"==typeof SuppressedError&&SuppressedError,function(e){e[e.BOPM_BLOCK=0]="BOPM_BLOCK",e[e.BOPM_UPDATE=1]="BOPM_UPDATE"}(e||(e={})),function(e){e[e.CCUT_AUTO=0]="CCUT_AUTO",e[e.CCUT_FULL_CHANNEL=1]="CCUT_FULL_CHANNEL",e[e.CCUT_Y_CHANNEL_ONLY=2]="CCUT_Y_CHANNEL_ONLY",e[e.CCUT_RGB_R_CHANNEL_ONLY=3]="CCUT_RGB_R_CHANNEL_ONLY",e[e.CCUT_RGB_G_CHANNEL_ONLY=4]="CCUT_RGB_G_CHANNEL_ONLY",e[e.CCUT_RGB_B_CHANNEL_ONLY=5]="CCUT_RGB_B_CHANNEL_ONLY"}(t||(t={})),function(e){e[e.IPF_BINARY=0]="IPF_BINARY",e[e.IPF_BINARYINVERTED=1]="IPF_BINARYINVERTED",e[e.IPF_GRAYSCALED=2]="IPF_GRAYSCALED",e[e.IPF_NV21=3]="IPF_NV21",e[e.IPF_RGB_565=4]="IPF_RGB_565",e[e.IPF_RGB_555=5]="IPF_RGB_555",e[e.IPF_RGB_888=6]="IPF_RGB_888",e[e.IPF_ARGB_8888=7]="IPF_ARGB_8888",e[e.IPF_RGB_161616=8]="IPF_RGB_161616",e[e.IPF_ARGB_16161616=9]="IPF_ARGB_16161616",e[e.IPF_ABGR_8888=10]="IPF_ABGR_8888",e[e.IPF_ABGR_16161616=11]="IPF_ABGR_16161616",e[e.IPF_BGR_888=12]="IPF_BGR_888",e[e.IPF_BINARY_8=13]="IPF_BINARY_8",e[e.IPF_NV12=14]="IPF_NV12"}(n||(n={}));const l=e=>Object.prototype.toString.call(e),c=e=>Array.isArray?Array.isArray(e):"[object Array]"===l(e),h=e=>"[object Boolean]"===l(e),u=e=>"number"==typeof e&&!Number.isNaN(e),d=e=>null!==e&&"object"==typeof e&&!Array.isArray(e),f=e=>!!d(e)&&e.bytes instanceof Uint8Array&&!!u(e.width)&&!(e.width<=0)&&!!u(e.height)&&!(e.height<=0)&&!!u(e.stride)&&!(e.stride<=0)&&"format"in e&&!("tag"in e&&!g(e.tag)),g=e=>!!d(e)&&!!u(e.imageId)&&"type"in e,p=e=>!!d(e)&&!!u(e.x)&&!!u(e.y);const m=(e,t)=>{let i=e.split("."),n=t.split(".");for(let r=0;r<i.length&&r<n.length;++r){let e=i[r],t=n[r];if(e===t)continue;let s=parseInt(i[r]),o=parseInt(n[r]);return s===o||Number.isNaN(s)&&Number.isNaN(o)?e<t?-1:1:s<o||Number.isNaN(s)&&Number.isInteger(o)?-1:1}return i.length===n.length?0:i.length<n.length?-1:1};var _,v,y,w,b,C,S,E;class T{get _isFetchingStarted(){return o(this,b,"f")}constructor(){_.add(this),v.set(this,[]),y.set(this,1),w.set(this,e.BOPM_BLOCK),b.set(this,!1),C.set(this,void 0),S.set(this,t.CCUT_AUTO)}setErrorListener(e){}addImageToBuffer(t){var i;if(!f(t))throw new TypeError("Invalid 'image'.");if((null===(i=t.tag)||void 0===i?void 0:i.hasOwnProperty("imageId"))&&"number"==typeof t.tag.imageId&&this.hasImage(t.tag.imageId))throw new Error("Existed imageId.");if(o(this,v,"f").length>=o(this,y,"f"))switch(o(this,w,"f")){case e.BOPM_BLOCK:break;case e.BOPM_UPDATE:if(o(this,v,"f").push(t),d(o(this,C,"f"))&&u(o(this,C,"f").imageId)&&1==o(this,C,"f").keepInBuffer)for(;o(this,v,"f").length>o(this,y,"f");){const e=o(this,v,"f").findIndex((e=>{var t;return(null===(t=e.tag)||void 0===t?void 0:t.imageId)!==o(this,C,"f").imageId}));o(this,v,"f").splice(e,1)}else o(this,v,"f").splice(0,o(this,v,"f").length-o(this,y,"f"))}else o(this,v,"f").push(t)}getImage(){if(0===o(this,v,"f").length)return null;let e;if(o(this,C,"f")&&u(o(this,C,"f").imageId)){const t=o(this,_,"m",E).call(this,o(this,C,"f").imageId);if(t<0)throw new Error("Image with id ".concat(o(this,C,"f").imageId," doesn't exist."));e=o(this,v,"f").slice(t,t+1)[0]}else e=o(this,v,"f").pop();if([n.IPF_RGB_565,n.IPF_RGB_555,n.IPF_RGB_888,n.IPF_ARGB_8888,n.IPF_RGB_161616,n.IPF_ARGB_16161616,n.IPF_ABGR_8888,n.IPF_ABGR_16161616,n.IPF_BGR_888].includes(e.format)){if(o(this,S,"f")===t.CCUT_RGB_R_CHANNEL_ONLY){T._onLog&&T._onLog("only get R channel data.");const t=new Uint8Array(e.width*e.height);for(let i=0;i<t.length;i++)switch(e.format){case n.IPF_RGB_565:case n.IPF_RGB_555:case n.IPF_RGB_888:case n.IPF_RGB_161616:t[i]=e.bytes[3*i+2];break;case n.IPF_ARGB_8888:case n.IPF_ARGB_16161616:t[i]=e.bytes[4*i+2];break;case n.IPF_BGR_888:t[i]=e.bytes[3*i];break;case n.IPF_ABGR_8888:case n.IPF_ABGR_16161616:t[i]=e.bytes[4*i]}e.bytes=t,e.stride=e.width,e.format=n.IPF_GRAYSCALED}else if(o(this,S,"f")===t.CCUT_RGB_G_CHANNEL_ONLY){T._onLog&&T._onLog("only get G channel data.");const t=new Uint8Array(e.width*e.height);for(let i=0;i<t.length;i++)switch(e.format){case n.IPF_RGB_565:case n.IPF_RGB_555:case n.IPF_RGB_888:case n.IPF_RGB_161616:case n.IPF_BGR_888:t[i]=e.bytes[3*i+1];break;case n.IPF_ARGB_8888:case n.IPF_ARGB_16161616:case n.IPF_ABGR_8888:case n.IPF_ABGR_16161616:t[i]=e.bytes[4*i+1]}e.bytes=t,e.stride=e.width,e.format=n.IPF_GRAYSCALED}else if(o(this,S,"f")===t.CCUT_RGB_B_CHANNEL_ONLY){T._onLog&&T._onLog("only get B channel data.");const t=new Uint8Array(e.width*e.height);for(let i=0;i<t.length;i++)switch(e.format){case n.IPF_RGB_565:case n.IPF_RGB_555:case n.IPF_RGB_888:case n.IPF_RGB_161616:t[i]=e.bytes[3*i];break;case n.IPF_ARGB_8888:case n.IPF_ARGB_16161616:t[i]=e.bytes[4*i];break;case n.IPF_BGR_888:t[i]=e.bytes[3*i+2];break;case n.IPF_ABGR_8888:case n.IPF_ABGR_16161616:t[i]=e.bytes[4*i+2]}e.bytes=t,e.stride=e.width,e.format=n.IPF_GRAYSCALED}}else[n.IPF_NV21,n.IPF_NV12].includes(e.format)&&T._onLog&&T._onLog("NV21 or NV12 is not supported.");return e}setNextImageToReturn(e,t){if(!function(){for(var e=arguments.length,t=new Array(e),i=0;i<e;i++)t[i]=arguments[i];return 0!==t.length&&t.every((e=>u(e)))}(e))throw new TypeError("Invalid 'imageId'.");if(void 0!==t&&!h(t))throw new TypeError("Invalid 'keepInBuffer'.");a(this,C,{imageId:e,keepInBuffer:t},"f")}_resetNextReturnedImage(){a(this,C,null,"f")}hasImage(e){return o(this,_,"m",E).call(this,e)>=0}startFetching(){a(this,b,!0,"f")}stopFetching(){a(this,b,!1,"f")}setMaxImageCount(e){if("number"!=typeof e)throw new TypeError("Invalid 'count'.");if(e<1||Math.round(e)!==e)throw new Error("Invalid 'count'.");for(a(this,y,e,"f");o(this,v,"f")&&o(this,v,"f").length>e;)o(this,v,"f").shift()}getMaxImageCount(){return o(this,y,"f")}getImageCount(){return o(this,v,"f").length}clearBuffer(){o(this,v,"f").length=0}isBufferEmpty(){return 0===o(this,v,"f").length}setBufferOverflowProtectionMode(e){a(this,w,e,"f")}getBufferOverflowProtectionMode(){return o(this,w,"f")}setColourChannelUsageType(e){a(this,S,e,"f")}getColourChannelUsageType(){return o(this,S,"f")}}v=new WeakMap,y=new WeakMap,w=new WeakMap,b=new WeakMap,C=new WeakMap,S=new WeakMap,_=new WeakSet,E=function(e){if("number"!=typeof e)throw new TypeError("Invalid 'imageId'.");return o(this,v,"f").findIndex((t=>{var i;return(null===(i=t.tag)||void 0===i?void 0:i.imageId)===e}))};const x="undefined"==typeof self,I=(()=>{if(!x&&document.currentScript){let e=document.currentScript.src,t=e.indexOf("?");if(-1!=t)e=e.substring(0,t);else{let t=e.indexOf("#");-1!=t&&(e=e.substring(0,t))}return e.substring(0,e.lastIndexOf("/")+1)}return"./"})(),A=e=>{if(null==e&&(e="./"),x);else{let t=document.createElement("a");t.href=e,e=t.href}return e.endsWith("/")||(e+="/"),e};let O,R,D,L,k;"undefined"!=typeof navigator&&(O=navigator,R=O.userAgent,D=O.platform,L=O.mediaDevices),function(){if(!x){const e={Edge:{search:"Edg",verSearch:"Edg"},OPR:null,Chrome:null,Safari:{str:O.vendor,search:"Apple",verSearch:["Version","iPhone OS","CPU OS"]},Firefox:null,Explorer:{search:"MSIE",verSearch:"MSIE"}},t={HarmonyOS:null,Android:null,iPhone:null,iPad:null,Windows:{str:D,search:"Win"},Mac:{str:D},Linux:{str:D}};let i="unknownBrowser",n=0,r="unknownOS";for(let s in e){const t=e[s]||{};let r=t.str||R,o=t.search||s,a=t.verStr||R,l=t.verSearch||s;if(l instanceof Array||(l=[l]),-1!=r.indexOf(o)){i=s;for(let e of l){let t=a.indexOf(e);if(-1!=t){n=parseFloat(a.substring(t+e.length+1));break}}break}}for(let s in t){const e=t[s]||{};let i=e.str||R,n=e.search||s;if(-1!=i.indexOf(n)){r=s;break}}"Linux"==r&&-1!=R.indexOf("Windows NT")&&(r="HarmonyOS"),k={browser:i,version:n,OS:r}}x&&(k={browser:"ssr",version:0,OS:"ssr"})}();const M="undefined"!=typeof WebAssembly&&R&&!(/Safari/.test(R)&&!/Chrome/.test(R)&&/\(.+\s11_2_([2-6]).*\)/.test(R)),P=!("undefined"==typeof Worker),F=!(!L||!L.getUserMedia),N=async()=>{let e=!1;if(F)try{(await L.getUserMedia({video:!0})).getTracks().forEach((e=>{e.stop()})),e=!0}catch(e){}return e};"Chrome"===k.browser&&k.version>66||"Safari"===k.browser&&k.version>13||"OPR"===k.browser&&k.version>43||"Edge"===k.browser&&k.version;const B=e=>e&&"object"==typeof e&&"function"==typeof e.then;class j extends Promise{constructor(e){let t,i;super(((e,n)=>{t=e,i=n})),this._s="pending",this.resolve=e=>{this.isPending&&(B(e)?this.task=e:(this._s="fulfilled",t(e)))},this.reject=e=>{this.isPending&&(this._s="rejected",i(e))},this.task=e}get status(){return this._s}get isPending(){return"pending"===this._s}get isFulfilled(){return"fulfilled"===this._s}get isRejected(){return"rejected"===this._s}get task(){return this._task}set task(e){let t;this._task=e,B(e)?t=e:"function"==typeof e&&(t=new Promise(e)),t&&(async()=>{try{const i=await t;e===this._task&&this.resolve(i)}catch(t){e===this._task&&this.reject(t)}})()}get isEmpty(){return null==this._task}}const U={},V=e=>{let t=U[e],i=!1;return t?t.isEmpty?t.task=()=>{}:i=!0:t=U[e]=new j((()=>{})),{p:t,justWait:i}};let G,W=0;const z=()=>W++,H={};let Y;let X=!1;const q={},Z={},K=e=>"std"===e?A(I+"../../dynamsoft-capture-vision-std@1.0.0/dist/"):"dip"===e?A(I+"../../dynamsoft-image-processing@2.0.30/dist/"):"dcm"===e?A(I+"../../dynamsoft-label-recognizer-data@1.0.0/dist/"):void 0,Q={std:{version:"1.0.0",path:K("std")},core:{version:"3.0.32",path:I},dip:{version:"2.0.30",path:K("dip")},dcm:K("dcm")},J=new Proxy(Q,{get(e,t,i){let n=Reflect.get(e,t,i);return n&&n.path&&(n=n.path),n}}),$={core:{js:!0,wasm:!0},dip:{wasm:!0}},ee=async e=>{e instanceof Array||(e=e?[e]:[]),e=e.map((e=>e.toLowerCase())).filter((e=>"core"!=e&&"std"!=e));for(let a of e)if(!$[a]&&"dedicator"!==a)throw Error("Module '"+a+"' not existed.");e.some((e=>["dbr","dlr","ddn"].includes(e)))&&(e.unshift("dip"),e=[...new Set(e)]);let t=!1;const i=[];{const{p:e,justWait:n}=V("core");n?await e:(i.push(e),t=!0)}const n={};for(let a of e){const{p:e,justWait:t}=V(a);t?await e:i.push(e),n[a]=$[a]}if(0==i.length)return;const r={};for(let a in J){if("rootDirectory"==a)continue;let e=J[a];J.rootDirectory&&(e=J.rootDirectory+"/"+e),r[a]=A(e)}const s={engineResourcePaths:r,autoResources:n,names:e};if(t){s.needLoadCore=!0;let e=r.core+te._workerName;r.rootDirectory&&(e=r.rootDirectory+e),e.startsWith(location.origin)||(e=await fetch(e).then((e=>e.blob())).then((e=>URL.createObjectURL(e)))),G=new Worker(e),G.onerror=e=>{let t=new Error(e.message);for(let n of i)n.reject(t)},G.addEventListener("message",(e=>{let t=e.data?e.data:e;switch(t.type){case"log":Y&&Y(t.message);break;case"task":{let e=t.id,i=t.body;try{H[e](i),delete H[e]}catch(t){throw delete H[e],t}break}case"event":{let i=t.id,n=t.body;try{H[i](n)}catch(e){throw e}break}default:console.log(e)}})),s.bLog=!!Y,s.bd=X,s.dm=location.origin.startsWith("http")?location.origin:"https://localhost"}let o=W++;return H[o]=e=>{if(e.success){Object.assign(q,e.versions),"{}"!==JSON.stringify(e.versions)&&(te._versions=e.versions);for(let e of i)e.resolve(void 0)}else{const t=Error(e.message);e.stack&&(t.stack=e.stack);for(let e of i)e.reject(t)}},G.postMessage({type:"loadWasm",body:s,id:o}),i[0]};class te{static get engineResourcePaths(){return J}static set engineResourcePaths(e){Object.assign(Q,e)}static get bSupportDce4Module(){return this._bSupportDce4Module}static get bSupportIRTModule(){return this._bSupportIRTModule}static get versions(){return this._versions}static get onLog(){return Y}static set onLog(e){(e=>{Y=e,G&&G.postMessage({type:"setBLog",body:{value:!!e}})})(e)}static get _bDebug(){return X}static set _bDebug(e){(e=>{X=e,G&&G.postMessage({type:"setBDebug",body:{value:!!e}})})(e)}static isModuleLoaded(e){return e=(e=e||"core").toLowerCase(),!!U[e]&&U[e].isFulfilled}static async loadWasm(e){return await ee(e)}static async detectEnvironment(){return await(async()=>({wasm:M,worker:P,getUserMedia:F,camera:await N(),browser:k.browser,version:k.version,OS:k.OS}))()}static async getModuleVersion(){return await new Promise(((e,t)=>{let i=z();H[i]=async i=>{if(i.success)return e(i.versions);{let e=new Error(i.message);return e.stack=i.stack+"\n"+e.stack,t(e)}},G.postMessage({type:"getModuleVersion",id:i})}))}static getVersion(){const e=q.core&&q.core.worker,t=q.core&&q.core.wasm;return"3.0.32(Worker: ".concat(e||"Not Loaded",", Wasm: ").concat(t||"Not Loaded",")")}static enableLogging(){T._onLog=console.log}static disableLogging(){T._onLog=null}static async cfd(e){return await new Promise(((t,i)=>{let n=z();H[n]=async e=>{if(e.success)return t();{let t=new Error(e.message);return t.stack=e.stack+"\n"+t.stack,i(t)}},G.postMessage({type:"cfd",id:n,body:{count:e}})}))}}var ie,ne,re,se,oe,ae,le,ce,he,ue,de;te._bSupportDce4Module=-1,te._bSupportIRTModule=-1,te._versions=null,te._workerName="core.worker.js",te.browserInfo=k,function(e){e[e.CRIT_ORIGINAL_IMAGE=1]="CRIT_ORIGINAL_IMAGE",e[e.CRIT_BARCODE=2]="CRIT_BARCODE",e[e.CRIT_TEXT_LINE=4]="CRIT_TEXT_LINE",e[e.CRIT_DETECTED_QUAD=8]="CRIT_DETECTED_QUAD",e[e.CRIT_NORMALIZED_IMAGE=16]="CRIT_NORMALIZED_IMAGE",e[e.CRIT_PARSED_RESULT=32]="CRIT_PARSED_RESULT"}(ie||(ie={})),function(e){e[e.CT_NORMAL_INTERSECTED=0]="CT_NORMAL_INTERSECTED",e[e.CT_T_INTERSECTED=1]="CT_T_INTERSECTED",e[e.CT_CROSS_INTERSECTED=2]="CT_CROSS_INTERSECTED",e[e.CT_NOT_INTERSECTED=3]="CT_NOT_INTERSECTED"}(ne||(ne={})),function(e){e[e.EC_OK=0]="EC_OK",e[e.EC_UNKNOWN=-1e4]="EC_UNKNOWN",e[e.EC_NO_MEMORY=-10001]="EC_NO_MEMORY",e[e.EC_NULL_POINTER=-10002]="EC_NULL_POINTER",e[e.EC_LICENSE_INVALID=-10003]="EC_LICENSE_INVALID",e[e.EC_LICENSE_EXPIRED=-10004]="EC_LICENSE_EXPIRED",e[e.EC_FILE_NOT_FOUND=-10005]="EC_FILE_NOT_FOUND",e[e.EC_FILE_TYPE_NOT_SUPPORTED=-10006]="EC_FILE_TYPE_NOT_SUPPORTED",e[e.EC_BPP_NOT_SUPPORTED=-10007]="EC_BPP_NOT_SUPPORTED",e[e.EC_INDEX_INVALID=-10008]="EC_INDEX_INVALID",e[e.EC_CUSTOM_REGION_INVALID=-10010]="EC_CUSTOM_REGION_INVALID",e[e.EC_IMAGE_READ_FAILED=-10012]="EC_IMAGE_READ_FAILED",e[e.EC_TIFF_READ_FAILED=-10013]="EC_TIFF_READ_FAILED",e[e.EC_DIB_BUFFER_INVALID=-10018]="EC_DIB_BUFFER_INVALID",e[e.EC_PDF_READ_FAILED=-10021]="EC_PDF_READ_FAILED",e[e.EC_PDF_DLL_MISSING=-10022]="EC_PDF_DLL_MISSING",e[e.EC_PAGE_NUMBER_INVALID=-10023]="EC_PAGE_NUMBER_INVALID",e[e.EC_CUSTOM_SIZE_INVALID=-10024]="EC_CUSTOM_SIZE_INVALID",e[e.EC_TIMEOUT=-10026]="EC_TIMEOUT",e[e.EC_JSON_PARSE_FAILED=-10030]="EC_JSON_PARSE_FAILED",e[e.EC_JSON_TYPE_INVALID=-10031]="EC_JSON_TYPE_INVALID",e[e.EC_JSON_KEY_INVALID=-10032]="EC_JSON_KEY_INVALID",e[e.EC_JSON_VALUE_INVALID=-10033]="EC_JSON_VALUE_INVALID",e[e.EC_JSON_NAME_KEY_MISSING=-10034]="EC_JSON_NAME_KEY_MISSING",e[e.EC_JSON_NAME_VALUE_DUPLICATED=-10035]="EC_JSON_NAME_VALUE_DUPLICATED",e[e.EC_TEMPLATE_NAME_INVALID=-10036]="EC_TEMPLATE_NAME_INVALID",e[e.EC_JSON_NAME_REFERENCE_INVALID=-10037]="EC_JSON_NAME_REFERENCE_INVALID",e[e.EC_PARAMETER_VALUE_INVALID=-10038]="EC_PARAMETER_VALUE_INVALID",e[e.EC_DOMAIN_NOT_MATCH=-10039]="EC_DOMAIN_NOT_MATCH",e[e.EC_RESERVED_INFO_NOT_MATCH=-10040]="EC_RESERVED_INFO_NOT_MATCH",e[e.EC_LICENSE_KEY_NOT_MATCH=-10043]="EC_LICENSE_KEY_NOT_MATCH",e[e.EC_REQUEST_FAILED=-10044]="EC_REQUEST_FAILED",e[e.EC_LICENSE_INIT_FAILED=-10045]="EC_LICENSE_INIT_FAILED",e[e.EC_SET_MODE_ARGUMENT_ERROR=-10051]="EC_SET_MODE_ARGUMENT_ERROR",e[e.EC_LICENSE_CONTENT_INVALID=-10052]="EC_LICENSE_CONTENT_INVALID",e[e.EC_LICENSE_KEY_INVALID=-10053]="EC_LICENSE_KEY_INVALID",e[e.EC_LICENSE_DEVICE_RUNS_OUT=-10054]="EC_LICENSE_DEVICE_RUNS_OUT",e[e.EC_GET_MODE_ARGUMENT_ERROR=-10055]="EC_GET_MODE_ARGUMENT_ERROR",e[e.EC_IRT_LICENSE_INVALID=-10056]="EC_IRT_LICENSE_INVALID",e[e.EC_FILE_SAVE_FAILED=-10058]="EC_FILE_SAVE_FAILED",e[e.EC_STAGE_TYPE_INVALID=-10059]="EC_STAGE_TYPE_INVALID",e[e.EC_IMAGE_ORIENTATION_INVALID=-10060]="EC_IMAGE_ORIENTATION_INVALID",e[e.EC_CONVERT_COMPLEX_TEMPLATE_ERROR=-10061]="EC_CONVERT_COMPLEX_TEMPLATE_ERROR",e[e.EC_CALL_REJECTED_WHEN_CAPTURING=-10062]="EC_CALL_REJECTED_WHEN_CAPTURING",e[e.EC_NO_IMAGE_SOURCE=-10063]="EC_NO_IMAGE_SOURCE",e[e.EC_READ_DIRECTORY_FAILED=-10064]="EC_READ_DIRECTORY_FAILED",e[e.EC_MODULE_NOT_FOUND=-10065]="EC_MODULE_NOT_FOUND",e[e.EC_MULTI_PAGES_NOT_SUPPORTED=-10066]="EC_MULTI_PAGES_NOT_SUPPORTED",e[e.EC_FILE_ALREADY_EXISTS=-10067]="EC_FILE_ALREADY_EXISTS",e[e.EC_CREATE_FILE_FAILED=-10068]="EC_CREATE_FILE_FAILED",e[e.EC_IMAGE_DATA_INVALID=-10069]="EC_IMAGE_DATA_INVALID",e[e.EC_NO_LICENSE=-2e4]="EC_NO_LICENSE",e[e.EC_HANDSHAKE_CODE_INVALID=-20001]="EC_HANDSHAKE_CODE_INVALID",e[e.EC_LICENSE_BUFFER_FAILED=-20002]="EC_LICENSE_BUFFER_FAILED",e[e.EC_LICENSE_SYNC_FAILED=-20003]="EC_LICENSE_SYNC_FAILED",e[e.EC_DEVICE_NOT_MATCH=-20004]="EC_DEVICE_NOT_MATCH",e[e.EC_BIND_DEVICE_FAILED=-20005]="EC_BIND_DEVICE_FAILED",e[e.EC_INSTANCE_COUNT_OVER_LIMIT=-20008]="EC_INSTANCE_COUNT_OVER_LIMIT",e[e.EC_TRIAL_LICENSE=-20010]="EC_TRIAL_LICENSE",e[e.EC_LICENSE_VERSION_NOT_MATCH=-20011]="EC_LICENSE_VERSION_NOT_MATCH",e[e.EC_FAILED_TO_REACH_DLS=-20200]="EC_FAILED_TO_REACH_DLS",e[e.EC_BARCODE_FORMAT_INVALID=-30009]="EC_BARCODE_FORMAT_INVALID",e[e.EC_QR_LICENSE_INVALID=-30016]="EC_QR_LICENSE_INVALID",e[e.EC_1D_LICENSE_INVALID=-30017]="EC_1D_LICENSE_INVALID",e[e.EC_PDF417_LICENSE_INVALID=-30019]="EC_PDF417_LICENSE_INVALID",e[e.EC_DATAMATRIX_LICENSE_INVALID=-30020]="EC_DATAMATRIX_LICENSE_INVALID",e[e.EC_CUSTOM_MODULESIZE_INVALID=-30025]="EC_CUSTOM_MODULESIZE_INVALID",e[e.EC_AZTEC_LICENSE_INVALID=-30041]="EC_AZTEC_LICENSE_INVALID",e[e.EC_PATCHCODE_LICENSE_INVALID=-30046]="EC_PATCHCODE_LICENSE_INVALID",e[e.EC_POSTALCODE_LICENSE_INVALID=-30047]="EC_POSTALCODE_LICENSE_INVALID",e[e.EC_DPM_LICENSE_INVALID=-30048]="EC_DPM_LICENSE_INVALID",e[e.EC_FRAME_DECODING_THREAD_EXISTS=-30049]="EC_FRAME_DECODING_THREAD_EXISTS",e[e.EC_STOP_DECODING_THREAD_FAILED=-30050]="EC_STOP_DECODING_THREAD_FAILED",e[e.EC_MAXICODE_LICENSE_INVALID=-30057]="EC_MAXICODE_LICENSE_INVALID",e[e.EC_GS1_DATABAR_LICENSE_INVALID=-30058]="EC_GS1_DATABAR_LICENSE_INVALID",e[e.EC_GS1_COMPOSITE_LICENSE_INVALID=-30059]="EC_GS1_COMPOSITE_LICENSE_INVALID",e[e.EC_DOTCODE_LICENSE_INVALID=-30061]="EC_DOTCODE_LICENSE_INVALID",e[e.EC_PHARMACODE_LICENSE_INVALID=-30062]="EC_PHARMACODE_LICENSE_INVALID",e[e.EC_CHARACTER_MODEL_FILE_NOT_FOUND=-40100]="EC_CHARACTER_MODEL_FILE_NOT_FOUND",e[e.EC_QUADRILATERAL_INVALID=-50057]="EC_QUADRILATERAL_INVALID",e[e.EC_PANORAMA_LICENSE_INVALID=-70060]="EC_PANORAMA_LICENSE_INVALID",e[e.EC_RESOURCE_PATH_NOT_EXIST=-90001]="EC_RESOURCE_PATH_NOT_EXIST",e[e.EC_RESOURCE_LOAD_FAILED=-90002]="EC_RESOURCE_LOAD_FAILED",e[e.EC_CODE_SPECIFICATION_NOT_FOUND=-90003]="EC_CODE_SPECIFICATION_NOT_FOUND",e[e.EC_FULL_CODE_EMPTY=-90004]="EC_FULL_CODE_EMPTY",e[e.EC_FULL_CODE_PREPROCESS_FAILED=-90005]="EC_FULL_CODE_PREPROCESS_FAILED",e[e.EC_ZA_DL_LICENSE_INVALID=-90006]="EC_ZA_DL_LICENSE_INVALID",e[e.EC_AAMVA_DL_ID_LICENSE_INVALID=-90007]="EC_AAMVA_DL_ID_LICENSE_INVALID",e[e.EC_AADHAAR_LICENSE_INVALID=-90008]="EC_AADHAAR_LICENSE_INVALID",e[e.EC_MRTD_LICENSE_INVALID=-90009]="EC_MRTD_LICENSE_INVALID",e[e.EC_VIN_LICENSE_INVALID=-90010]="EC_VIN_LICENSE_INVALID",e[e.EC_CUSTOMIZED_CODE_TYPE_LICENSE_INVALID=-90011]="EC_CUSTOMIZED_CODE_TYPE_LICENSE_INVALID"}(re||(re={})),function(e){e[e.GEM_SKIP=0]="GEM_SKIP",e[e.GEM_AUTO=1]="GEM_AUTO",e[e.GEM_GENERAL=2]="GEM_GENERAL",e[e.GEM_GRAY_EQUALIZE=4]="GEM_GRAY_EQUALIZE",e[e.GEM_GRAY_SMOOTH=8]="GEM_GRAY_SMOOTH",e[e.GEM_SHARPEN_SMOOTH=16]="GEM_SHARPEN_SMOOTH",e[e.GEM_REV=-2147483648]="GEM_REV"}(se||(se={})),function(e){e[e.GTM_SKIP=0]="GTM_SKIP",e[e.GTM_INVERTED=1]="GTM_INVERTED",e[e.GTM_ORIGINAL=2]="GTM_ORIGINAL",e[e.GTM_AUTO=4]="GTM_AUTO",e[e.GTM_REV=-2147483648]="GTM_REV"}(oe||(oe={})),function(e){e[e.ITT_FILE_IMAGE=0]="ITT_FILE_IMAGE",e[e.ITT_VIDEO_FRAME=1]="ITT_VIDEO_FRAME"}(ae||(ae={})),function(e){e[e.PDFRM_VECTOR=1]="PDFRM_VECTOR",e[e.PDFRM_RASTER=2]="PDFRM_RASTER",e[e.PDFRM_REV=-2147483648]="PDFRM_REV"}(le||(le={})),function(e){e[e.RDS_RASTERIZED_PAGES=0]="RDS_RASTERIZED_PAGES",e[e.RDS_EXTRACTED_IMAGES=1]="RDS_EXTRACTED_IMAGES"}(ce||(ce={})),function(e){e[e.IRUT_NULL=0]="IRUT_NULL",e[e.IRUT_COLOUR_IMAGE=1]="IRUT_COLOUR_IMAGE",e[e.IRUT_SCALED_DOWN_COLOUR_IMAGE=2]="IRUT_SCALED_DOWN_COLOUR_IMAGE",e[e.IRUT_GRAYSCALE_IMAGE=4]="IRUT_GRAYSCALE_IMAGE",e[e.IRUT_TRANSOFORMED_GRAYSCALE_IMAGE=8]="IRUT_TRANSOFORMED_GRAYSCALE_IMAGE",e[e.IRUT_ENHANCED_GRAYSCALE_IMAGE=16]="IRUT_ENHANCED_GRAYSCALE_IMAGE",e[e.IRUT_PREDETECTED_REGIONS=32]="IRUT_PREDETECTED_REGIONS",e[e.IRUT_BINARY_IMAGE=64]="IRUT_BINARY_IMAGE",e[e.IRUT_TEXTURE_DETECTION_RESULT=128]="IRUT_TEXTURE_DETECTION_RESULT",e[e.IRUT_TEXTURE_REMOVED_GRAYSCALE_IMAGE=256]="IRUT_TEXTURE_REMOVED_GRAYSCALE_IMAGE",e[e.IRUT_TEXTURE_REMOVED_BINARY_IMAGE=512]="IRUT_TEXTURE_REMOVED_BINARY_IMAGE",e[e.IRUT_CONTOURS=1024]="IRUT_CONTOURS",e[e.IRUT_LINE_SEGMENTS=2048]="IRUT_LINE_SEGMENTS",e[e.IRUT_TEXT_ZONES=4096]="IRUT_TEXT_ZONES",e[e.IRUT_TEXT_REMOVED_BINARY_IMAGE=8192]="IRUT_TEXT_REMOVED_BINARY_IMAGE",e[e.IRUT_CANDIDATE_BARCODE_ZONES=16384]="IRUT_CANDIDATE_BARCODE_ZONES",e[e.IRUT_LOCALIZED_BARCODES=32768]="IRUT_LOCALIZED_BARCODES",e[e.IRUT_SCALED_UP_BARCODE_IMAGE=65536]="IRUT_SCALED_UP_BARCODE_IMAGE",e[e.IRUT_DEFORMATION_RESISTED_BARCODE_IMAGE=131072]="IRUT_DEFORMATION_RESISTED_BARCODE_IMAGE",e[e.IRUT_COMPLEMENTED_BARCODE_IMAGE=262144]="IRUT_COMPLEMENTED_BARCODE_IMAGE",e[e.IRUT_DECODED_BARCODES=524288]="IRUT_DECODED_BARCODES",e[e.IRUT_LONG_LINES=1048576]="IRUT_LONG_LINES",e[e.IRUT_CORNERS=2097152]="IRUT_CORNERS",e[e.IRUT_CANDIDATE_QUAD_EDGES=4194304]="IRUT_CANDIDATE_QUAD_EDGES",e[e.IRUT_DETECTED_QUADS=8388608]="IRUT_DETECTED_QUADS",e[e.IRUT_LOCALIZED_TEXT_LINES=16777216]="IRUT_LOCALIZED_TEXT_LINES",e[e.IRUT_RECOGNIZED_TEXT_LINES=33554432]="IRUT_RECOGNIZED_TEXT_LINES",e[e.IRUT_NORMALIZED_IMAGES=67108864]="IRUT_NORMALIZED_IMAGES",e[e.IRUT_ALL=134217727]="IRUT_ALL"}(he||(he={})),function(e){e[e.ROET_PREDETECTED_REGION=0]="ROET_PREDETECTED_REGION",e[e.ROET_LOCALIZED_BARCODE=1]="ROET_LOCALIZED_BARCODE",e[e.ROET_DECODED_BARCODE=2]="ROET_DECODED_BARCODE",e[e.ROET_LOCALIZED_TEXT_LINE=3]="ROET_LOCALIZED_TEXT_LINE",e[e.ROET_RECOGNIZED_TEXT_LINE=4]="ROET_RECOGNIZED_TEXT_LINE",e[e.ROET_DETECTED_QUAD=5]="ROET_DETECTED_QUAD",e[e.ROET_NORMALIZED_IMAGE=6]="ROET_NORMALIZED_IMAGE",e[e.ROET_SOURCE_IMAGE=7]="ROET_SOURCE_IMAGE",e[e.ROET_TARGET_ROI=8]="ROET_TARGET_ROI"}(ue||(ue={})),function(e){e[e.ST_NULL=0]="ST_NULL",e[e.ST_REGION_PREDETECTION=1]="ST_REGION_PREDETECTION",e[e.ST_BARCODE_LOCALIZATION=2]="ST_BARCODE_LOCALIZATION",e[e.ST_BARCODE_DECODING=3]="ST_BARCODE_DECODING",e[e.ST_TEXT_LINE_LOCALIZATION=4]="ST_TEXT_LINE_LOCALIZATION",e[e.ST_TEXT_LINE_RECOGNITION=5]="ST_TEXT_LINE_RECOGNITION",e[e.ST_DOCUMENT_DETECTION=6]="ST_DOCUMENT_DETECTION",e[e.ST_DOCUMENT_NORMALIZATION=7]="ST_DOCUMENT_NORMALIZATION"}(de||(de={}));const fe="undefined"==typeof self,ge=fe?{}:self,pe=(()=>{if(!fe&&document.currentScript){let e=document.currentScript.src,t=e.indexOf("?");if(-1!=t)e=e.substring(0,t);else{let t=e.indexOf("#");-1!=t&&(e=e.substring(0,t))}return e.substring(0,e.lastIndexOf("/")+1)}return"./"})(),me=e=>e&&"object"==typeof e&&"function"==typeof e.then,_e=" is not allowed to change after `createInstance` or `loadWasm` is called.",ve=!fe&&document.currentScript&&(document.currentScript.getAttribute("data-license")||document.currentScript.getAttribute("data-productKeys")||document.currentScript.getAttribute("data-licenseKey")||document.currentScript.getAttribute("data-handshakeCode")||document.currentScript.getAttribute("data-organizationID"))||"",ye=(e,t)=>{const i=e;if(!i._pLoad.isEmpty)throw new Error("`license`"+_e);i._license=t};!fe&&document.currentScript&&document.currentScript.getAttribute("data-sessionPassword");const we=e=>{if(null==e)e=[];else{e=e instanceof Array?[...e]:[e];for(let t=0;t<e.length;++t){if(!fe){let i=document.createElement("a");i.href=e[t],e[t]=i.href}e[t].endsWith("/")||(e[t]+="/")}}return e},be=(e,t)=>{const i=e;if(!i._pLoad.isEmpty)throw new Error("`licenseServer`"+_e);i._licenseServer=we(t)},Ce=(e,t)=>{const i=e;if(!i._pLoad.isEmpty)throw new Error("`deviceFriendlyName`"+_e);i._deviceFriendlyName=t||""};let Se,Ee,Te,xe,Ie,Ae,Oe;"undefined"!=typeof navigator&&(Se=navigator,Ee=Se.userAgent,Te=Se.platform,xe=Se.mediaDevices),function(){if(!fe){const e={Edge:{search:"Edg",verSearch:"Edg"},OPR:null,Chrome:null,Safari:{str:Se.vendor,search:"Apple",verSearch:["Version","iPhone OS","CPU OS"]},Firefox:null,Explorer:{search:"MSIE",verSearch:"MSIE"}},t={HarmonyOS:null,Android:null,iPhone:null,iPad:null,Windows:{str:Te,search:"Win"},Mac:{str:Te},Linux:{str:Te}};let i="unknownBrowser",n=0,r="unknownOS";for(let s in e){const t=e[s]||{};let r=t.str||Ee,o=t.search||s,a=t.verStr||Ee,l=t.verSearch||s;if(l instanceof Array||(l=[l]),-1!=r.indexOf(o)){i=s;for(let e of l){let t=a.indexOf(e);if(-1!=t){n=parseFloat(a.substring(t+e.length+1));break}}break}}for(let s in t){const e=t[s]||{};let i=e.str||Ee,n=e.search||s;if(-1!=i.indexOf(n)){r=s;break}}"Linux"==r&&-1!=Ee.indexOf("Windows NT")&&(r="HarmonyOS"),Ie={browser:i,version:n,OS:r}}fe&&(Ie={browser:"ssr",version:0,OS:"ssr"})}(),"undefined"!=typeof WebAssembly&&Ee&&(!/Safari/.test(Ee)||/Chrome/.test(Ee)||/\(.+\s11_2_([2-6]).*\)/.test(Ee)),xe&&xe.getUserMedia,"Chrome"===Ie.browser&&Ie.version>66||"Safari"===Ie.browser&&Ie.version>13||"OPR"===Ie.browser&&Ie.version>43||"Edge"===Ie.browser&&Ie.version;const Re=async()=>{await ee("license");const{p:e,justWait:t}=V("dynamsoft_inited");if(t)return e;try{let{lt:t,l:i,ls:n,sp:r,rmk:s,cv:o}=function(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];const i=e;if(i._pLoad.isEmpty){let n,r,s,o=i._license||"",a=JSON.parse(JSON.stringify(i._licenseServer)),l=i._sessionPassword,c=0;if(o.startsWith("t")||o.startsWith("f"))c=0;else if(0===o.length||o.startsWith("P")||o.startsWith("L")||o.startsWith("Y")||o.startsWith("A"))c=1;else{c=2;const t=o.indexOf(":");-1!=t&&(o=o.substring(t+1));const i=o.indexOf("?");if(-1!=i&&(r=o.substring(i+1),o=o.substring(0,i)),o.startsWith("DLC2"))c=0;else{if(o.startsWith("DLS2")){let t;try{let e=o.substring(4);e=atob(e),t=JSON.parse(e)}catch(e){throw new Error("Format Error: The license string you specified is invalid, please check to make sure it is correct.")}if(o=t.handshakeCode?t.handshakeCode:t.organizationID?t.organizationID:"","number"==typeof o&&(o=JSON.stringify(o)),0===a.length){let e=[];t.mainServerURL&&(e[0]=t.mainServerURL),t.standbyServerURL&&(e[1]=t.standbyServerURL),a=we(e)}!l&&t.sessionPassword&&(l=t.sessionPassword),n=t.remark}("200001"===o||o.startsWith("200001-"))&&(a&&a.length||(o="")),o||(c=1)}}if(c&&(t||(ge.crypto||(s="Please upgrade your browser to support online key."),ge.crypto.subtle||(s="Require https to use online key in this browser."))),s){if(1!==c)throw new Error(s);c=0,console.warn(s),i._lastErrorCode=-1,i._lastErrorString=s}return 1===c&&(o="",console.warn("Applying for a public trial license ...")),{lt:c,l:o,ls:a,sp:l,rmk:n,cv:r}}throw new Error("Can't preprocess license again"+_e)}(De);De._pLoad.task=e;let a=z();return H[a]=i=>{if(i.message&&De._onAuthMessage){let e=De._onAuthMessage(i.message);null!=e&&(i.message=e)}let n=!1;if(1===t&&(n=!0),i.success?(Y&&Y("init license success"),i.message&&console.warn(i.message),te._bSupportIRTModule=i.bSupportIRTModule,te._bSupportDce4Module=i.bSupportDce4Module,De.bPassValidation=!0):(Oe=Error(i.message),i.stack&&(Oe.stack=i.stack),n||111==i.ltsErrorCode&&-1!=i.message.toLowerCase().indexOf("trial license")&&(n=!0)),n){let e=Q.license;Q.rootDirectory&&(e=Q.rootDirectory+"/"+e),e=(e=>{if(null==e&&(e="./"),fe);else{let t=document.createElement("a");t.href=e,e=t.href}return e.endsWith("/")||(e+="/"),e})(e),(async(e,t,i)=>{if(!e._bNeverShowDialog)try{let n=await fetch(e.engineResourcePath+"dls.license.dialog.html");if(!n.ok)throw Error("Get license dialog fail. Network Error: "+n.statusText);let r=await n.text();if(!r.trim().startsWith("<"))throw Error("Get license dialog fail. Can't get valid HTMLElement.");let s=document.createElement("div");s.innerHTML=r;let o=[];for(let e=0;e<s.childElementCount;++e){let t=s.children[e];t instanceof HTMLStyleElement&&(o.push(t),document.head.append(t))}let a=1==s.childElementCount?s.children[0]:s;a.remove();let l,c,h,u,d,f=[a],g=a.children;for(let e of g)f.push(e);for(let e=0;e<f.length;++e)for(let t of f[e].children)f.push(t);for(let e of f)if(!l&&e.classList.contains("dls-license-mask"))l=e,e.addEventListener("click",(t=>{if(e==t.target){a.remove();for(let e of o)e.remove()}}));else if(!c&&e.classList.contains("dls-license-icon-close"))c=e,e.addEventListener("click",(()=>{a.remove();for(let e of o)e.remove()}));else if(!h&&e.classList.contains("dls-license-icon-error"))h=e,"error"!=t&&e.remove();else if(!u&&e.classList.contains("dls-license-icon-warn"))u=e,"warn"!=t&&e.remove();else if(!d&&e.classList.contains("dls-license-msg-content")){d=e;let t=i;for(;t;){let i=t.indexOf("["),n=t.indexOf("]",i),r=t.indexOf("(",n),s=t.indexOf(")",r);if(-1==i||-1==n||-1==r||-1==s){e.appendChild(new Text(t));break}i>0&&e.appendChild(new Text(t.substring(0,i)));let o=document.createElement("a"),a=t.substring(i+1,n);o.innerText=a;let l=t.substring(r+1,s);o.setAttribute("href",l),o.setAttribute("target","_blank"),e.appendChild(o),t=t.substring(s+1)}}document.body.appendChild(a)}catch(t){e._onLog&&e._onLog(t.message||t)}})({_bNeverShowDialog:De._bNeverShowDialog,engineResourcePath:e,_onLog:Y},i.success?"warn":"error",i.message)}i.success?e.resolve(void 0):e.reject(Oe)},i&&(i.startsWith("t")||i.startsWith("f"))&&(Ae=i),G.postMessage({type:"dynamsoft",body:{v:"3.0.20",brtk:!!t,bptk:1===t,l:i,os:Ie,fn:De.deviceFriendlyName,ls:n,sp:r,rmk:s,cv:o},id:a}),De.bCallInitLicense=!0,e}catch(Be){throw Oe=Be,e.reject(Be),Be}};Z.license={},Z.license.dynamsoft=Re,Z.license.getAR=async()=>{if(Oe)throw Oe;return G?new Promise(((e,t)=>{let i=z();H[i]=async i=>{if(i.success)if(delete i.success,Ae&&(i.pk=Ae),Object.keys(i).length){if(i.lem){let e=Error(i.lem);e.ltsErrorCode=i.lec,delete i.lem,delete i.lec,i.ae=e}e(i)}else e(null);else{let e=Error(i.message);i.stack&&(e.stack=i.stack),t(e)}},G.postMessage({type:"getAR",id:i})})):null};class De{static setLicenseServer(e){be(De,e)}static get license(){return this._license}static set license(e){ye(De,e)}static get licenseServer(){return this._licenseServer}static set licenseServer(e){be(De,e)}static get deviceFriendlyName(){return this._deviceFriendlyName}static set deviceFriendlyName(e){Ce(De,e)}static initLicense(e,t){if(ye(De,e),De.bCallInitLicense=!0,t)return(async()=>{try{await Re()}catch(e){return{isSuccess:!1,error:e.message||e}}return{isSuccess:!0,error:"Successful."}})()}static setDeviceFriendlyName(e){Ce(De,e)}static getDeviceFriendlyName(){return De._deviceFriendlyName}static getDeviceUUID(){return(async()=>{const{p:e,justWait:t}=V("license_uuid");if(t)return e;await ee();let i=z();return H[i]=t=>{if(t.success)e.resolve(t.uuid);else{const i=Error(t.message);t.stack&&(i.stack=t.stack),e.reject(i)}},G.postMessage({type:"getDeviceUUID",id:i}),e})()}}if(De._pLoad=new class extends Promise{constructor(e){let t,i;super(((e,n)=>{t=e,i=n})),this._s="pending",this.resolve=e=>{this.isPending&&(me(e)?this.task=e:(this._s="fulfilled",t(e)))},this.reject=e=>{this.isPending&&(this._s="rejected",i(e))},this.task=e}get status(){return this._s}get isPending(){return"pending"===this._s}get isFulfilled(){return"fulfilled"===this._s}get isRejected(){return"rejected"===this._s}get task(){return this._task}set task(e){let t;this._task=e,me(e)?t=e:"function"==typeof e&&(t=new Promise(e)),t&&(async()=>{try{const i=await t;e===this._task&&this.resolve(i)}catch(t){e===this._task&&this.reject(t)}})()}get isEmpty(){return null==this._task}},De.bPassValidation=!1,De.bCallInitLicense=!1,De._license=ve,De._licenseServer=[],De._deviceFriendlyName="",null==Q.license&&(Q.license=pe),$.license={wasm:!0},Z.license.LicenseManager=De,Q.std.version&&m(Q.std.version,"1.0.0")<0){const e="1.0.0";Q.std.version=e,Q.std.path=pe+"../../dynamsoft-capture-vision-std@".concat(e,"/dist/")}const Le="undefined"==typeof self,ke=(()=>{if(!Le&&document.currentScript){let e=document.currentScript.src,t=e.indexOf("?");if(-1!=t)e=e.substring(0,t);else{let t=e.indexOf("#");-1!=t&&(e=e.substring(0,t))}return e.substring(0,e.lastIndexOf("/")+1)}return"./"})(),Me=e=>{if(null==e&&(e="./"),Le);else{let t=document.createElement("a");t.href=e,e=t.href}return e.endsWith("/")||(e+="/"),e};null==Q.dbr&&(Q.dbr=ke),$.dbr={js:!1,wasm:!0},Z.dbr={};const Pe="1.0.0";Q.std.version&&m(Q.std.version,Pe)<0&&(Q.std.version=Pe,Q.std.path=Me(ke+"../../dynamsoft-capture-vision-std@".concat(Pe,"/dist/")));const Fe="2.0.30";Q.dip.version&&m(Q.dip.version,Fe)<0&&(Q.dip.version=Fe,Q.dip.path=Me(ke+"../../dynamsoft-image-processing@".concat(Fe,"/dist/")));"function"==typeof BigInt&&(BigInt(0),BigInt(0x10000000000000000),BigInt(4265345023),BigInt(3147775),BigInt(260096),BigInt(1),BigInt(2),BigInt(4),BigInt(8),BigInt(16),BigInt(32),BigInt(64),BigInt(128),BigInt(256),BigInt(512),BigInt(1024),BigInt(2048),BigInt(4096),BigInt(8192),BigInt(16384),BigInt(32768),BigInt(65536),BigInt(131072),BigInt(262144),BigInt(16777216),BigInt(33554432),BigInt(67108864),BigInt(134217728),BigInt(268435456),BigInt(536870912),BigInt(1073741824),BigInt(524288),BigInt(2147483648),BigInt(1048576),BigInt(2097152),BigInt(4194304),BigInt(8388608),BigInt(68719476736),BigInt(0x3f0000000000000),BigInt(4294967296),BigInt(4503599627370496),BigInt(9007199254740992),BigInt(0x40000000000000),BigInt(0x80000000000000),BigInt(72057594037927940),BigInt(0x200000000000000),BigInt(8589934592),BigInt(17179869184),BigInt(34359738368),BigInt(51539607552));var Ne,Be,je,Ue;!function(e){e[e.EBRT_STANDARD_RESULT=0]="EBRT_STANDARD_RESULT",e[e.EBRT_CANDIDATE_RESULT=1]="EBRT_CANDIDATE_RESULT",e[e.EBRT_PARTIAL_RESULT=2]="EBRT_PARTIAL_RESULT"}(Ne||(Ne={})),function(e){e[e.QRECL_ERROR_CORRECTION_H=0]="QRECL_ERROR_CORRECTION_H",e[e.QRECL_ERROR_CORRECTION_L=1]="QRECL_ERROR_CORRECTION_L",e[e.QRECL_ERROR_CORRECTION_M=2]="QRECL_ERROR_CORRECTION_M",e[e.QRECL_ERROR_CORRECTION_Q=3]="QRECL_ERROR_CORRECTION_Q"}(Be||(Be={})),function(e){e[e.LM_AUTO=1]="LM_AUTO",e[e.LM_CONNECTED_BLOCKS=2]="LM_CONNECTED_BLOCKS",e[e.LM_STATISTICS=4]="LM_STATISTICS",e[e.LM_LINES=8]="LM_LINES",e[e.LM_SCAN_DIRECTLY=16]="LM_SCAN_DIRECTLY",e[e.LM_STATISTICS_MARKS=32]="LM_STATISTICS_MARKS",e[e.LM_STATISTICS_POSTAL_CODE=64]="LM_STATISTICS_POSTAL_CODE",e[e.LM_CENTRE=128]="LM_CENTRE",e[e.LM_ONED_FAST_SCAN=256]="LM_ONED_FAST_SCAN",e[e.LM_REV=-2147483648]="LM_REV",e[e.LM_SKIP=0]="LM_SKIP"}(je||(je={})),function(e){e[e.DM_DIRECT_BINARIZATION=1]="DM_DIRECT_BINARIZATION",e[e.DM_THRESHOLD_BINARIZATION=2]="DM_THRESHOLD_BINARIZATION",e[e.DM_GRAY_EQUALIZATION=4]="DM_GRAY_EQUALIZATION",e[e.DM_SMOOTHING=8]="DM_SMOOTHING",e[e.DM_MORPHING=16]="DM_MORPHING",e[e.DM_DEEP_ANALYSIS=32]="DM_DEEP_ANALYSIS",e[e.DM_SHARPENING=64]="DM_SHARPENING",e[e.DM_BASED_ON_LOC_BIN=128]="DM_BASED_ON_LOC_BIN",e[e.DM_SHARPENING_SMOOTHING=256]="DM_SHARPENING_SMOOTHING",e[e.DM_REV=-2147483648]="DM_REV",e[e.DM_SKIP=0]="DM_SKIP"}(Ue||(Ue={})),De.initLicense("DLS2eyJoYW5kc2hha2VDb2RlIjoiMjAwMDAwLWRicl9qc19zYW1wbGVzIiwib3JnYW5pemF0aW9uSUQiOiIyMDAwMDAifQ=="),te.engineResourcePaths={std:"https://cdn.jsdelivr.net/npm/dynamsoft-capture-vision-std@1.0.0/dist/",dip:"https://cdn.jsdelivr.net/npm/dynamsoft-image-processing@2.0.30/dist/",core:"https://cdn.jsdelivr.net/npm/dynamsoft-core@3.0.32/dist/",license:"https://cdn.jsdelivr.net/npm/dynamsoft-license@3.0.20/dist/",cvr:"https://cdn.jsdelivr.net/npm/dynamsoft-capture-vision-router@2.0.31/dist/",dbr:"https://cdn.jsdelivr.net/npm/dynamsoft-barcode-reader@10.0.20/dist/",dce:"https://cdn.jsdelivr.net/npm/dynamsoft-camera-enhancer@4.0.1/dist/"},te.loadWasm(["DBR"]);var Ve={653:(e,t,i)=>{var n,r,s,o,a,l,c,h,u,d,f,g,p,m,_,v,y,w,b,C,S,E=E||{version:"5.2.1"};if(t.fabric=E,"undefined"!=typeof document&&"undefined"!=typeof window)document instanceof("undefined"!=typeof HTMLDocument?HTMLDocument:Document)?E.document=document:E.document=document.implementation.createHTMLDocument(""),E.window=window;else{var T=new(i(192).JSDOM)(decodeURIComponent("%3C!DOCTYPE%20html%3E%3Chtml%3E%3Chead%3E%3C%2Fhead%3E%3Cbody%3E%3C%2Fbody%3E%3C%2Fhtml%3E"),{features:{FetchExternalResources:["img"]},resources:"usable"}).window;E.document=T.document,E.jsdomImplForWrapper=i(898).implForWrapper,E.nodeCanvas=i(245).Canvas,E.window=T,DOMParser=E.window.DOMParser}function x(e,t){var i=e.canvas,n=t.targetCanvas,r=n.getContext("2d");r.translate(0,n.height),r.scale(1,-1);var s=i.height-n.height;r.drawImage(i,0,s,n.width,n.height,0,0,n.width,n.height)}function I(e,t){var i=t.targetCanvas.getContext("2d"),n=t.destinationWidth,r=t.destinationHeight,s=n*r*4,o=new Uint8Array(this.imageBuffer,0,s),a=new Uint8ClampedArray(this.imageBuffer,0,s);e.readPixels(0,0,n,r,e.RGBA,e.UNSIGNED_BYTE,o);var l=new ImageData(a,n,r);i.putImageData(l,0,0)}E.isTouchSupported="ontouchstart"in E.window||"ontouchstart"in E.document||E.window&&E.window.navigator&&E.window.navigator.maxTouchPoints>0,E.isLikelyNode="undefined"!=typeof Buffer&&"undefined"==typeof window,E.SHARED_ATTRIBUTES=["display","transform","fill","fill-opacity","fill-rule","opacity","stroke","stroke-dasharray","stroke-linecap","stroke-dashoffset","stroke-linejoin","stroke-miterlimit","stroke-opacity","stroke-width","id","paint-order","vector-effect","instantiated_by_use","clip-path"],E.DPI=96,E.reNum="(?:[-+]?(?:\\d+|\\d*\\.\\d+)(?:[eE][-+]?\\d+)?)",E.commaWsp="(?:\\s+,?\\s*|,\\s*)",E.rePathCommand=/([-+]?((\d+\.\d+)|((\d+)|(\.\d+)))(?:[eE][-+]?\d+)?)/gi,E.reNonWord=/[ \n\.,;!\?\-]/,E.fontPaths={},E.iMatrix=[1,0,0,1,0,0],E.svgNS="http://www.w3.org/2000/svg",E.perfLimitSizeTotal=2097152,E.maxCacheSideLimit=4096,E.minCacheSideLimit=256,E.charWidthsCache={},E.textureSize=2048,E.disableStyleCopyPaste=!1,E.enableGLFiltering=!0,E.devicePixelRatio=E.window.devicePixelRatio||E.window.webkitDevicePixelRatio||E.window.mozDevicePixelRatio||1,E.browserShadowBlurConstant=1,E.arcToSegmentsCache={},E.boundsOfCurveCache={},E.cachesBoundsOfCurve=!0,E.forceGLPutImageData=!1,E.initFilterBackend=function(){return E.enableGLFiltering&&E.isWebglSupported&&E.isWebglSupported(E.textureSize)?(console.log("max texture size: "+E.maxTextureSize),new E.WebglFilterBackend({tileSize:E.textureSize})):E.Canvas2dFilterBackend?new E.Canvas2dFilterBackend:void 0},"undefined"!=typeof document&&"undefined"!=typeof window&&(window.fabric=E),function(){function e(e,t){if(this.__eventListeners[e]){var i=this.__eventListeners[e];t?i[i.indexOf(t)]=!1:E.util.array.fill(i,!1)}}function t(e,t){var i=function(){t.apply(this,arguments),this.off(e,i)}.bind(this);this.on(e,i)}E.Observable={fire:function(e,t){if(!this.__eventListeners)return this;var i=this.__eventListeners[e];if(!i)return this;for(var n=0,r=i.length;n<r;n++)i[n]&&i[n].call(this,t||{});return this.__eventListeners[e]=i.filter((function(e){return!1!==e})),this},on:function(e,t){if(this.__eventListeners||(this.__eventListeners={}),1===arguments.length)for(var i in e)this.on(i,e[i]);else this.__eventListeners[e]||(this.__eventListeners[e]=[]),this.__eventListeners[e].push(t);return this},once:function(e,i){if(1===arguments.length)for(var n in e)t.call(this,n,e[n]);else t.call(this,e,i);return this},off:function(t,i){if(!this.__eventListeners)return this;if(0===arguments.length)for(t in this.__eventListeners)e.call(this,t);else if(1===arguments.length&&"object"==typeof arguments[0])for(var n in t)e.call(this,n,t[n]);else e.call(this,t,i);return this}}}(),E.Collection={_objects:[],add:function(){if(this._objects.push.apply(this._objects,arguments),this._onObjectAdded)for(var e=0,t=arguments.length;e<t;e++)this._onObjectAdded(arguments[e]);return this.renderOnAddRemove&&this.requestRenderAll(),this},insertAt:function(e,t,i){var n=this._objects;return i?n[t]=e:n.splice(t,0,e),this._onObjectAdded&&this._onObjectAdded(e),this.renderOnAddRemove&&this.requestRenderAll(),this},remove:function(){for(var e,t=this._objects,i=!1,n=0,r=arguments.length;n<r;n++)-1!==(e=t.indexOf(arguments[n]))&&(i=!0,t.splice(e,1),this._onObjectRemoved&&this._onObjectRemoved(arguments[n]));return this.renderOnAddRemove&&i&&this.requestRenderAll(),this},forEachObject:function(e,t){for(var i=this.getObjects(),n=0,r=i.length;n<r;n++)e.call(t,i[n],n,i);return this},getObjects:function(e){return void 0===e?this._objects.concat():this._objects.filter((function(t){return t.type===e}))},item:function(e){return this._objects[e]},isEmpty:function(){return 0===this._objects.length},size:function(){return this._objects.length},contains:function(e,t){return this._objects.indexOf(e)>-1||!!t&&this._objects.some((function(t){return"function"==typeof t.contains&&t.contains(e,!0)}))},complexity:function(){return this._objects.reduce((function(e,t){return e+(t.complexity?t.complexity():0)}),0)}},E.CommonMethods={_setOptions:function(e){for(var t in e)this.set(t,e[t])},_initGradient:function(e,t){!e||!e.colorStops||e instanceof E.Gradient||this.set(t,new E.Gradient(e))},_initPattern:function(e,t,i){!e||!e.source||e instanceof E.Pattern?i&&i():this.set(t,new E.Pattern(e,i))},_setObject:function(e){for(var t in e)this._set(t,e[t])},set:function(e,t){return"object"==typeof e?this._setObject(e):this._set(e,t),this},_set:function(e,t){this[e]=t},toggle:function(e){var t=this.get(e);return"boolean"==typeof t&&this.set(e,!t),this},get:function(e){return this[e]}},n=t,r=Math.sqrt,s=Math.atan2,o=Math.pow,a=Math.PI/180,l=Math.PI/2,E.util={cos:function(e){if(0===e)return 1;switch(e<0&&(e=-e),e/l){case 1:case 3:return 0;case 2:return-1}return Math.cos(e)},sin:function(e){if(0===e)return 0;var t=1;switch(e<0&&(t=-1),e/l){case 1:return t;case 2:return 0;case 3:return-t}return Math.sin(e)},removeFromArray:function(e,t){var i=e.indexOf(t);return-1!==i&&e.splice(i,1),e},getRandomInt:function(e,t){return Math.floor(Math.random()*(t-e+1))+e},degreesToRadians:function(e){return e*a},radiansToDegrees:function(e){return e/a},rotatePoint:function(e,t,i){var n=new E.Point(e.x-t.x,e.y-t.y),r=E.util.rotateVector(n,i);return new E.Point(r.x,r.y).addEquals(t)},rotateVector:function(e,t){var i=E.util.sin(t),n=E.util.cos(t);return{x:e.x*n-e.y*i,y:e.x*i+e.y*n}},createVector:function(e,t){return new E.Point(t.x-e.x,t.y-e.y)},calcAngleBetweenVectors:function(e,t){return Math.acos((e.x*t.x+e.y*t.y)/(Math.hypot(e.x,e.y)*Math.hypot(t.x,t.y)))},getHatVector:function(e){return new E.Point(e.x,e.y).multiply(1/Math.hypot(e.x,e.y))},getBisector:function(e,t,i){var n=E.util.createVector(e,t),r=E.util.createVector(e,i),s=E.util.calcAngleBetweenVectors(n,r),o=s*(0===E.util.calcAngleBetweenVectors(E.util.rotateVector(n,s),r)?1:-1)/2;return{vector:E.util.getHatVector(E.util.rotateVector(n,o)),angle:s}},projectStrokeOnPoints:function(e,t,i){var n=[],r=t.strokeWidth/2,s=t.strokeUniform?new E.Point(1/t.scaleX,1/t.scaleY):new E.Point(1,1),o=function(e){var t=r/Math.hypot(e.x,e.y);return new E.Point(e.x*t*s.x,e.y*t*s.y)};return e.length<=1||e.forEach((function(a,l){var c,h,u=new E.Point(a.x,a.y);0===l?(h=e[l+1],c=i?o(E.util.createVector(h,u)).addEquals(u):e[e.length-1]):l===e.length-1?(c=e[l-1],h=i?o(E.util.createVector(c,u)).addEquals(u):e[0]):(c=e[l-1],h=e[l+1]);var d,f,g=E.util.getBisector(u,c,h),p=g.vector,m=g.angle;if("miter"===t.strokeLineJoin&&(d=-r/Math.sin(m/2),f=new E.Point(p.x*d*s.x,p.y*d*s.y),Math.hypot(f.x,f.y)/r<=t.strokeMiterLimit))return n.push(u.add(f)),void n.push(u.subtract(f));d=-r*Math.SQRT2,f=new E.Point(p.x*d*s.x,p.y*d*s.y),n.push(u.add(f)),n.push(u.subtract(f))})),n},transformPoint:function(e,t,i){return i?new E.Point(t[0]*e.x+t[2]*e.y,t[1]*e.x+t[3]*e.y):new E.Point(t[0]*e.x+t[2]*e.y+t[4],t[1]*e.x+t[3]*e.y+t[5])},makeBoundingBoxFromPoints:function(e,t){if(t)for(var i=0;i<e.length;i++)e[i]=E.util.transformPoint(e[i],t);var n=[e[0].x,e[1].x,e[2].x,e[3].x],r=E.util.array.min(n),s=E.util.array.max(n)-r,o=[e[0].y,e[1].y,e[2].y,e[3].y],a=E.util.array.min(o);return{left:r,top:a,width:s,height:E.util.array.max(o)-a}},invertTransform:function(e){var t=1/(e[0]*e[3]-e[1]*e[2]),i=[t*e[3],-t*e[1],-t*e[2],t*e[0]],n=E.util.transformPoint({x:e[4],y:e[5]},i,!0);return i[4]=-n.x,i[5]=-n.y,i},toFixed:function(e,t){return parseFloat(Number(e).toFixed(t))},parseUnit:function(e,t){var i=/\D{0,2}$/.exec(e),n=parseFloat(e);switch(t||(t=E.Text.DEFAULT_SVG_FONT_SIZE),i[0]){case"mm":return n*E.DPI/25.4;case"cm":return n*E.DPI/2.54;case"in":return n*E.DPI;case"pt":return n*E.DPI/72;case"pc":return n*E.DPI/72*12;case"em":return n*t;default:return n}},falseFunction:function(){return!1},getKlass:function(e,t){return e=E.util.string.camelize(e.charAt(0).toUpperCase()+e.slice(1)),E.util.resolveNamespace(t)[e]},getSvgAttributes:function(e){var t=["instantiated_by_use","style","id","class"];switch(e){case"linearGradient":t=t.concat(["x1","y1","x2","y2","gradientUnits","gradientTransform"]);break;case"radialGradient":t=t.concat(["gradientUnits","gradientTransform","cx","cy","r","fx","fy","fr"]);break;case"stop":t=t.concat(["offset","stop-color","stop-opacity"])}return t},resolveNamespace:function(e){if(!e)return E;var t,i=e.split("."),r=i.length,s=n||E.window;for(t=0;t<r;++t)s=s[i[t]];return s},loadImage:function(e,t,i,n){if(e){var r=E.util.createImage(),s=function(){t&&t.call(i,r,!1),r=r.onload=r.onerror=null};r.onload=s,r.onerror=function(){E.log("Error loading "+r.src),t&&t.call(i,null,!0),r=r.onload=r.onerror=null},0!==e.indexOf("data")&&null!=n&&(r.crossOrigin=n),"data:image/svg"===e.substring(0,14)&&(r.onload=null,E.util.loadImageInDom(r,s)),r.src=e}else t&&t.call(i,e)},loadImageInDom:function(e,t){var i=E.document.createElement("div");i.style.width=i.style.height="1px",i.style.left=i.style.top="-100%",i.style.position="absolute",i.appendChild(e),E.document.querySelector("body").appendChild(i),e.onload=function(){t(),i.parentNode.removeChild(i),i=null}},enlivenObjects:function(e,t,i,n){var r=[],s=0,o=(e=e||[]).length;function a(){++s===o&&t&&t(r.filter((function(e){return e})))}o?e.forEach((function(e,t){e&&e.type?E.util.getKlass(e.type,i).fromObject(e,(function(i,s){s||(r[t]=i),n&&n(e,i,s),a()})):a()})):t&&t(r)},enlivenObjectEnlivables:function(e,t,i){var n=E.Object.ENLIVEN_PROPS.filter((function(t){return!!e[t]}));E.util.enlivenObjects(n.map((function(t){return e[t]})),(function(e){var r={};n.forEach((function(i,n){r[i]=e[n],t&&(t[i]=e[n])})),i&&i(r)}))},enlivenPatterns:function(e,t){function i(){++r===s&&t&&t(n)}var n=[],r=0,s=(e=e||[]).length;s?e.forEach((function(e,t){e&&e.source?new E.Pattern(e,(function(e){n[t]=e,i()})):(n[t]=e,i())})):t&&t(n)},groupSVGElements:function(e,t,i){var n;return e&&1===e.length?e[0]:(t&&(t.width&&t.height?t.centerPoint={x:t.width/2,y:t.height/2}:(delete t.width,delete t.height)),n=new E.Group(e,t),void 0!==i&&(n.sourcePath=i),n)},populateWithProperties:function(e,t,i){if(i&&Array.isArray(i))for(var n=0,r=i.length;n<r;n++)i[n]in e&&(t[i[n]]=e[i[n]])},createCanvasElement:function(){return E.document.createElement("canvas")},copyCanvasElement:function(e){var t=E.util.createCanvasElement();return t.width=e.width,t.height=e.height,t.getContext("2d").drawImage(e,0,0),t},toDataURL:function(e,t,i){return e.toDataURL("image/"+t,i)},createImage:function(){return E.document.createElement("img")},multiplyTransformMatrices:function(e,t,i){return[e[0]*t[0]+e[2]*t[1],e[1]*t[0]+e[3]*t[1],e[0]*t[2]+e[2]*t[3],e[1]*t[2]+e[3]*t[3],i?0:e[0]*t[4]+e[2]*t[5]+e[4],i?0:e[1]*t[4]+e[3]*t[5]+e[5]]},qrDecompose:function(e){var t=s(e[1],e[0]),i=o(e[0],2)+o(e[1],2),n=r(i),l=(e[0]*e[3]-e[2]*e[1])/n,c=s(e[0]*e[2]+e[1]*e[3],i);return{angle:t/a,scaleX:n,scaleY:l,skewX:c/a,skewY:0,translateX:e[4],translateY:e[5]}},calcRotateMatrix:function(e){if(!e.angle)return E.iMatrix.concat();var t=E.util.degreesToRadians(e.angle),i=E.util.cos(t),n=E.util.sin(t);return[i,n,-n,i,0,0]},calcDimensionsMatrix:function(e){var t=void 0===e.scaleX?1:e.scaleX,i=void 0===e.scaleY?1:e.scaleY,n=[e.flipX?-t:t,0,0,e.flipY?-i:i,0,0],r=E.util.multiplyTransformMatrices,s=E.util.degreesToRadians;return e.skewX&&(n=r(n,[1,0,Math.tan(s(e.skewX)),1],!0)),e.skewY&&(n=r(n,[1,Math.tan(s(e.skewY)),0,1],!0)),n},composeMatrix:function(e){var t=[1,0,0,1,e.translateX||0,e.translateY||0],i=E.util.multiplyTransformMatrices;return e.angle&&(t=i(t,E.util.calcRotateMatrix(e))),(1!==e.scaleX||1!==e.scaleY||e.skewX||e.skewY||e.flipX||e.flipY)&&(t=i(t,E.util.calcDimensionsMatrix(e))),t},resetObjectTransform:function(e){e.scaleX=1,e.scaleY=1,e.skewX=0,e.skewY=0,e.flipX=!1,e.flipY=!1,e.rotate(0)},saveObjectTransform:function(e){return{scaleX:e.scaleX,scaleY:e.scaleY,skewX:e.skewX,skewY:e.skewY,angle:e.angle,left:e.left,flipX:e.flipX,flipY:e.flipY,top:e.top}},isTransparent:function(e,t,i,n){n>0&&(t>n?t-=n:t=0,i>n?i-=n:i=0);var r,s=!0,o=e.getImageData(t,i,2*n||1,2*n||1),a=o.data.length;for(r=3;r<a&&0!=(s=o.data[r]<=0);r+=4);return o=null,s},parsePreserveAspectRatioAttribute:function(e){var t,i="meet",n=e.split(" ");return n&&n.length&&("meet"!==(i=n.pop())&&"slice"!==i?(t=i,i="meet"):n.length&&(t=n.pop())),{meetOrSlice:i,alignX:"none"!==t?t.slice(1,4):"none",alignY:"none"!==t?t.slice(5,8):"none"}},clearFabricFontCache:function(e){(e=(e||"").toLowerCase())?E.charWidthsCache[e]&&delete E.charWidthsCache[e]:E.charWidthsCache={}},limitDimsByArea:function(e,t){var i=Math.sqrt(t*e),n=Math.floor(t/i);return{x:Math.floor(i),y:n}},capValue:function(e,t,i){return Math.max(e,Math.min(t,i))},findScaleToFit:function(e,t){return Math.min(t.width/e.width,t.height/e.height)},findScaleToCover:function(e,t){return Math.max(t.width/e.width,t.height/e.height)},matrixToSVG:function(e){return"matrix("+e.map((function(e){return E.util.toFixed(e,E.Object.NUM_FRACTION_DIGITS)})).join(" ")+")"},removeTransformFromObject:function(e,t){var i=E.util.invertTransform(t),n=E.util.multiplyTransformMatrices(i,e.calcOwnMatrix());E.util.applyTransformToObject(e,n)},addTransformToObject:function(e,t){E.util.applyTransformToObject(e,E.util.multiplyTransformMatrices(t,e.calcOwnMatrix()))},applyTransformToObject:function(e,t){var i=E.util.qrDecompose(t),n=new E.Point(i.translateX,i.translateY);e.flipX=!1,e.flipY=!1,e.set("scaleX",i.scaleX),e.set("scaleY",i.scaleY),e.skewX=i.skewX,e.skewY=i.skewY,e.angle=i.angle,e.setPositionByOrigin(n,"center","center")},sizeAfterTransform:function(e,t,i){var n=e/2,r=t/2,s=[{x:-n,y:-r},{x:n,y:-r},{x:-n,y:r},{x:n,y:r}],o=E.util.calcDimensionsMatrix(i),a=E.util.makeBoundingBoxFromPoints(s,o);return{x:a.width,y:a.height}},mergeClipPaths:function(e,t){var i=e,n=t;i.inverted&&!n.inverted&&(i=t,n=e),E.util.applyTransformToObject(n,E.util.multiplyTransformMatrices(E.util.invertTransform(i.calcTransformMatrix()),n.calcTransformMatrix()));var r=i.inverted&&n.inverted;return r&&(i.inverted=n.inverted=!1),new E.Group([i],{clipPath:n,inverted:r})}},function(){var e=Array.prototype.join,t={m:2,l:2,h:1,v:1,c:6,s:4,q:4,t:2,a:7},i={m:"l",M:"L"};function n(e,t,i,n,r,s,o,a,l,c,h){var u=E.util.cos(e),d=E.util.sin(e),f=E.util.cos(t),g=E.util.sin(t),p=i*r*f-n*s*g+o,m=n*r*f+i*s*g+a;return["C",c+l*(-i*r*d-n*s*u),h+l*(-n*r*d+i*s*u),p+l*(i*r*g+n*s*f),m+l*(n*r*g-i*s*f),p,m]}function r(e,t,i,n){var r=Math.atan2(t,e),s=Math.atan2(n,i);return s>=r?s-r:2*Math.PI-(r-s)}function s(e,t,i){for(var s=i[1],o=i[2],a=i[3],l=i[4],c=i[5],h=function(e,t,i,s,o,a,l){var c=Math.PI,h=l*c/180,u=E.util.sin(h),d=E.util.cos(h),f=0,g=0,p=-d*e*.5-u*t*.5,m=-d*t*.5+u*e*.5,_=(i=Math.abs(i))*i,v=(s=Math.abs(s))*s,y=m*m,w=p*p,b=_*v-_*y-v*w,C=0;if(b<0){var S=Math.sqrt(1-b/(_*v));i*=S,s*=S}else C=(o===a?-1:1)*Math.sqrt(b/(_*y+v*w));var T=C*i*m/s,x=-C*s*p/i,I=d*T-u*x+.5*e,A=u*T+d*x+.5*t,O=r(1,0,(p-T)/i,(m-x)/s),R=r((p-T)/i,(m-x)/s,(-p-T)/i,(-m-x)/s);0===a&&R>0?R-=2*c:1===a&&R<0&&(R+=2*c);for(var D=Math.ceil(Math.abs(R/c*2)),L=[],k=R/D,M=8/3*Math.sin(k/4)*Math.sin(k/4)/Math.sin(k/2),P=O+k,F=0;F<D;F++)L[F]=n(O,P,d,u,i,s,I,A,M,f,g),f=L[F][5],g=L[F][6],O=P,P+=k;return L}(i[6]-e,i[7]-t,s,o,l,c,a),u=0,d=h.length;u<d;u++)h[u][1]+=e,h[u][2]+=t,h[u][3]+=e,h[u][4]+=t,h[u][5]+=e,h[u][6]+=t;return h}function o(e,t,i,n){return Math.sqrt((i-e)*(i-e)+(n-t)*(n-t))}function a(e,t,i,n,r,s,o,a){return function(l){var c,h=(c=l)*c*c,u=function(e){return 3*e*e*(1-e)}(l),d=function(e){return 3*e*(1-e)*(1-e)}(l),f=function(e){return(1-e)*(1-e)*(1-e)}(l);return{x:o*h+r*u+i*d+e*f,y:a*h+s*u+n*d+t*f}}}function l(e,t,i,n,r,s,o,a){return function(l){var c=1-l,h=3*c*c*(i-e)+6*c*l*(r-i)+3*l*l*(o-r),u=3*c*c*(n-t)+6*c*l*(s-n)+3*l*l*(a-s);return Math.atan2(u,h)}}function c(e,t,i,n,r,s){return function(o){var a,l=(a=o)*a,c=function(e){return 2*e*(1-e)}(o),h=function(e){return(1-e)*(1-e)}(o);return{x:r*l+i*c+e*h,y:s*l+n*c+t*h}}}function h(e,t,i,n,r,s){return function(o){var a=1-o,l=2*a*(i-e)+2*o*(r-i),c=2*a*(n-t)+2*o*(s-n);return Math.atan2(c,l)}}function u(e,t,i){var n,r,s={x:t,y:i},a=0;for(r=1;r<=100;r+=1)n=e(r/100),a+=o(s.x,s.y,n.x,n.y),s=n;return a}function d(e){for(var t,i,n,r,s=0,d=e.length,f=0,g=0,p=0,m=0,_=[],v=0;v<d;v++){switch(n={x:f,y:g,command:(t=e[v])[0]},t[0]){case"M":n.length=0,p=f=t[1],m=g=t[2];break;case"L":n.length=o(f,g,t[1],t[2]),f=t[1],g=t[2];break;case"C":i=a(f,g,t[1],t[2],t[3],t[4],t[5],t[6]),r=l(f,g,t[1],t[2],t[3],t[4],t[5],t[6]),n.iterator=i,n.angleFinder=r,n.length=u(i,f,g),f=t[5],g=t[6];break;case"Q":i=c(f,g,t[1],t[2],t[3],t[4]),r=h(f,g,t[1],t[2],t[3],t[4]),n.iterator=i,n.angleFinder=r,n.length=u(i,f,g),f=t[3],g=t[4];break;case"Z":case"z":n.destX=p,n.destY=m,n.length=o(f,g,p,m),f=p,g=m}s+=n.length,_.push(n)}return _.push({length:s,x:f,y:g}),_}E.util.joinPath=function(e){return e.map((function(e){return e.join(" ")})).join(" ")},E.util.parsePath=function(e){var n,r,s,o,a,l=[],c=[],h=E.rePathCommand,u="[-+]?(?:\\d*\\.\\d+|\\d+\\.?)(?:[eE][-+]?\\d+)?\\s*",d="("+u+")"+E.commaWsp,f="([01])"+E.commaWsp+"?",g=new RegExp(d+"?"+d+"?"+d+f+f+d+"?("+u+")","g");if(!e||!e.match)return l;for(var p,m=0,_=(a=e.match(/[mzlhvcsqta][^mzlhvcsqta]*/gi)).length;m<_;m++){o=(n=a[m]).slice(1).trim(),c.length=0;var v=n.charAt(0);if(p=[v],"a"===v.toLowerCase())for(var y;y=g.exec(o);)for(var w=1;w<y.length;w++)c.push(y[w]);else for(;s=h.exec(o);)c.push(s[0]);w=0;for(var b=c.length;w<b;w++)r=parseFloat(c[w]),isNaN(r)||p.push(r);var C=t[v.toLowerCase()],S=i[v]||v;if(p.length-1>C)for(var T=1,x=p.length;T<x;T+=C)l.push([v].concat(p.slice(T,T+C))),v=S;else l.push(p)}return l},E.util.makePathSimpler=function(e){var t,i,n,r,o,a,l=0,c=0,h=e.length,u=0,d=0,f=[];for(i=0;i<h;++i){switch(n=!1,(t=e[i].slice(0))[0]){case"l":t[0]="L",t[1]+=l,t[2]+=c;case"L":l=t[1],c=t[2];break;case"h":t[1]+=l;case"H":t[0]="L",t[2]=c,l=t[1];break;case"v":t[1]+=c;case"V":t[0]="L",c=t[1],t[1]=l,t[2]=c;break;case"m":t[0]="M",t[1]+=l,t[2]+=c;case"M":l=t[1],c=t[2],u=t[1],d=t[2];break;case"c":t[0]="C",t[1]+=l,t[2]+=c,t[3]+=l,t[4]+=c,t[5]+=l,t[6]+=c;case"C":o=t[3],a=t[4],l=t[5],c=t[6];break;case"s":t[0]="S",t[1]+=l,t[2]+=c,t[3]+=l,t[4]+=c;case"S":"C"===r?(o=2*l-o,a=2*c-a):(o=l,a=c),l=t[3],c=t[4],t[0]="C",t[5]=t[3],t[6]=t[4],t[3]=t[1],t[4]=t[2],t[1]=o,t[2]=a,o=t[3],a=t[4];break;case"q":t[0]="Q",t[1]+=l,t[2]+=c,t[3]+=l,t[4]+=c;case"Q":o=t[1],a=t[2],l=t[3],c=t[4];break;case"t":t[0]="T",t[1]+=l,t[2]+=c;case"T":"Q"===r?(o=2*l-o,a=2*c-a):(o=l,a=c),t[0]="Q",l=t[1],c=t[2],t[1]=o,t[2]=a,t[3]=l,t[4]=c;break;case"a":t[0]="A",t[6]+=l,t[7]+=c;case"A":n=!0,f=f.concat(s(l,c,t)),l=t[6],c=t[7];break;case"z":case"Z":l=u,c=d}n||f.push(t),r=t[0]}return f},E.util.getSmoothPathFromPoints=function(e,t){var i,n=[],r=new E.Point(e[0].x,e[0].y),s=new E.Point(e[1].x,e[1].y),o=e.length,a=1,l=0,c=o>2;for(t=t||0,c&&(a=e[2].x<s.x?-1:e[2].x===s.x?0:1,l=e[2].y<s.y?-1:e[2].y===s.y?0:1),n.push(["M",r.x-a*t,r.y-l*t]),i=1;i<o;i++){if(!r.eq(s)){var h=r.midPointFrom(s);n.push(["Q",r.x,r.y,h.x,h.y])}r=e[i],i+1<e.length&&(s=e[i+1])}return c&&(a=r.x>e[i-2].x?1:r.x===e[i-2].x?0:-1,l=r.y>e[i-2].y?1:r.y===e[i-2].y?0:-1),n.push(["L",r.x+a*t,r.y+l*t]),n},E.util.getPathSegmentsInfo=d,E.util.getBoundsOfCurve=function(t,i,n,r,s,o,a,l){var c;if(E.cachesBoundsOfCurve&&(c=e.call(arguments),E.boundsOfCurveCache[c]))return E.boundsOfCurveCache[c];var h,u,d,f,g,p,m,_,v=Math.sqrt,y=Math.min,w=Math.max,b=Math.abs,C=[],S=[[],[]];u=6*t-12*n+6*s,h=-3*t+9*n-9*s+3*a,d=3*n-3*t;for(var T=0;T<2;++T)if(T>0&&(u=6*i-12*r+6*o,h=-3*i+9*r-9*o+3*l,d=3*r-3*i),b(h)<1e-12){if(b(u)<1e-12)continue;0<(f=-d/u)&&f<1&&C.push(f)}else(m=u*u-4*d*h)<0||(0<(g=(-u+(_=v(m)))/(2*h))&&g<1&&C.push(g),0<(p=(-u-_)/(2*h))&&p<1&&C.push(p));for(var x,I,A,O=C.length,R=O;O--;)x=(A=1-(f=C[O]))*A*A*t+3*A*A*f*n+3*A*f*f*s+f*f*f*a,S[0][O]=x,I=A*A*A*i+3*A*A*f*r+3*A*f*f*o+f*f*f*l,S[1][O]=I;S[0][R]=t,S[1][R]=i,S[0][R+1]=a,S[1][R+1]=l;var D=[{x:y.apply(null,S[0]),y:y.apply(null,S[1])},{x:w.apply(null,S[0]),y:w.apply(null,S[1])}];return E.cachesBoundsOfCurve&&(E.boundsOfCurveCache[c]=D),D},E.util.getPointOnPath=function(e,t,i){i||(i=d(e));for(var n=0;t-i[n].length>0&&n<i.length-2;)t-=i[n].length,n++;var r,s=i[n],a=t/s.length,l=s.command,c=e[n];switch(l){case"M":return{x:s.x,y:s.y,angle:0};case"Z":case"z":return(r=new E.Point(s.x,s.y).lerp(new E.Point(s.destX,s.destY),a)).angle=Math.atan2(s.destY-s.y,s.destX-s.x),r;case"L":return(r=new E.Point(s.x,s.y).lerp(new E.Point(c[1],c[2]),a)).angle=Math.atan2(c[2]-s.y,c[1]-s.x),r;case"C":case"Q":return function(e,t){for(var i,n,r,s=0,a=0,l=e.iterator,c={x:e.x,y:e.y},h=.01,u=e.angleFinder;a<t&&h>1e-4;)i=l(s),r=s,(n=o(c.x,c.y,i.x,i.y))+a>t?(s-=h,h/=2):(c=i,s+=h,a+=n);return i.angle=u(r),i}(s,t)}},E.util.transformPath=function(e,t,i){return i&&(t=E.util.multiplyTransformMatrices(t,[1,0,0,1,-i.x,-i.y])),e.map((function(e){for(var i=e.slice(0),n={},r=1;r<e.length-1;r+=2)n.x=e[r],n.y=e[r+1],n=E.util.transformPoint(n,t),i[r]=n.x,i[r+1]=n.y;return i}))}}(),function(){var e=Array.prototype.slice;function t(e,t,i){if(e&&0!==e.length){var n=e.length-1,r=t?e[n][t]:e[n];if(t)for(;n--;)i(e[n][t],r)&&(r=e[n][t]);else for(;n--;)i(e[n],r)&&(r=e[n]);return r}}E.util.array={fill:function(e,t){for(var i=e.length;i--;)e[i]=t;return e},invoke:function(t,i){for(var n=e.call(arguments,2),r=[],s=0,o=t.length;s<o;s++)r[s]=n.length?t[s][i].apply(t[s],n):t[s][i].call(t[s]);return r},min:function(e,i){return t(e,i,(function(e,t){return e<t}))},max:function(e,i){return t(e,i,(function(e,t){return e>=t}))}}}(),function(){function e(t,i,n){if(n)if(!E.isLikelyNode&&i instanceof Element)t=i;else if(i instanceof Array){t=[];for(var r=0,s=i.length;r<s;r++)t[r]=e({},i[r],n)}else if(i&&"object"==typeof i)for(var o in i)"canvas"===o||"group"===o?t[o]=null:i.hasOwnProperty(o)&&(t[o]=e({},i[o],n));else t=i;else for(var o in i)t[o]=i[o];return t}E.util.object={extend:e,clone:function(t,i){return e({},t,i)}},E.util.object.extend(E.util,E.Observable)}(),function(){function e(e,t){var i=e.charCodeAt(t);if(isNaN(i))return"";if(i<55296||i>57343)return e.charAt(t);if(55296<=i&&i<=56319){if(e.length<=t+1)throw"High surrogate without following low surrogate";var n=e.charCodeAt(t+1);if(56320>n||n>57343)throw"High surrogate without following low surrogate";return e.charAt(t)+e.charAt(t+1)}if(0===t)throw"Low surrogate without preceding high surrogate";var r=e.charCodeAt(t-1);if(55296>r||r>56319)throw"Low surrogate without preceding high surrogate";return!1}E.util.string={camelize:function(e){return e.replace(/-+(.)?/g,(function(e,t){return t?t.toUpperCase():""}))},capitalize:function(e,t){return e.charAt(0).toUpperCase()+(t?e.slice(1):e.slice(1).toLowerCase())},escapeXml:function(e){return e.replace(/&/g,"&amp;").replace(/"/g,"&quot;").replace(/'/g,"&apos;").replace(/</g,"&lt;").replace(/>/g,"&gt;")},graphemeSplit:function(t){var i,n=0,r=[];for(n=0;n<t.length;n++)!1!==(i=e(t,n))&&r.push(i);return r}}}(),function(){var e=Array.prototype.slice,t=function(){},i=function(){for(var e in{toString:1})if("toString"===e)return!1;return!0}(),n=function(e,t,n){for(var r in t)r in e.prototype&&"function"==typeof e.prototype[r]&&(t[r]+"").indexOf("callSuper")>-1?e.prototype[r]=function(e){return function(){var i=this.constructor.superclass;this.constructor.superclass=n;var r=t[e].apply(this,arguments);if(this.constructor.superclass=i,"initialize"!==e)return r}}(r):e.prototype[r]=t[r],i&&(t.toString!==Object.prototype.toString&&(e.prototype.toString=t.toString),t.valueOf!==Object.prototype.valueOf&&(e.prototype.valueOf=t.valueOf))};function r(){}function s(t){for(var i=null,n=this;n.constructor.superclass;){var r=n.constructor.superclass.prototype[t];if(n[t]!==r){i=r;break}n=n.constructor.superclass.prototype}return i?arguments.length>1?i.apply(this,e.call(arguments,1)):i.call(this):console.log("tried to callSuper "+t+", method not found in prototype chain",this)}E.util.createClass=function(){var i=null,o=e.call(arguments,0);function a(){this.initialize.apply(this,arguments)}"function"==typeof o[0]&&(i=o.shift()),a.superclass=i,a.subclasses=[],i&&(r.prototype=i.prototype,a.prototype=new r,i.subclasses.push(a));for(var l=0,c=o.length;l<c;l++)n(a,o[l],i);return a.prototype.initialize||(a.prototype.initialize=t),a.prototype.constructor=a,a.prototype.callSuper=s,a}}(),c=!!E.document.createElement("div").attachEvent,h=["touchstart","touchmove","touchend"],E.util.addListener=function(e,t,i,n){e&&e.addEventListener(t,i,!c&&n)},E.util.removeListener=function(e,t,i,n){e&&e.removeEventListener(t,i,!c&&n)},E.util.getPointer=function(e){var t=e.target,i=E.util.getScrollLeftTop(t),n=function(e){var t=e.changedTouches;return t&&t[0]?t[0]:e}(e);return{x:n.clientX+i.left,y:n.clientY+i.top}},E.util.isTouchEvent=function(e){return h.indexOf(e.type)>-1||"touch"===e.pointerType},d="string"==typeof(u=E.document.createElement("div")).style.opacity,f="string"==typeof u.style.filter,g=/alpha\s*\(\s*opacity\s*=\s*([^\)]+)\)/,p=function(e){return e},d?p=function(e,t){return e.style.opacity=t,e}:f&&(p=function(e,t){var i=e.style;return e.currentStyle&&!e.currentStyle.hasLayout&&(i.zoom=1),g.test(i.filter)?(t=t>=.9999?"":"alpha(opacity="+100*t+")",i.filter=i.filter.replace(g,t)):i.filter+=" alpha(opacity="+100*t+")",e}),E.util.setStyle=function(e,t){var i=e.style;if(!i)return e;if("string"==typeof t)return e.style.cssText+=";"+t,t.indexOf("opacity")>-1?p(e,t.match(/opacity:\s*(\d?\.?\d*)/)[1]):e;for(var n in t)"opacity"===n?p(e,t[n]):i["float"===n||"cssFloat"===n?void 0===i.styleFloat?"cssFloat":"styleFloat":n]=t[n];return e},function(){var e,t,i,n,r=Array.prototype.slice,s=function(e){return r.call(e,0)};try{e=s(E.document.childNodes)instanceof Array}catch(e){}function o(e,t){var i=E.document.createElement(e);for(var n in t)"class"===n?i.className=t[n]:"for"===n?i.htmlFor=t[n]:i.setAttribute(n,t[n]);return i}function a(e){for(var t=0,i=0,n=E.document.documentElement,r=E.document.body||{scrollLeft:0,scrollTop:0};e&&(e.parentNode||e.host)&&((e=e.parentNode||e.host)===E.document?(t=r.scrollLeft||n.scrollLeft||0,i=r.scrollTop||n.scrollTop||0):(t+=e.scrollLeft||0,i+=e.scrollTop||0),1!==e.nodeType||"fixed"!==e.style.position););return{left:t,top:i}}e||(s=function(e){for(var t=new Array(e.length),i=e.length;i--;)t[i]=e[i];return t}),t=E.document.defaultView&&E.document.defaultView.getComputedStyle?function(e,t){var i=E.document.defaultView.getComputedStyle(e,null);return i?i[t]:void 0}:function(e,t){var i=e.style[t];return!i&&e.currentStyle&&(i=e.currentStyle[t]),i},i=E.document.documentElement.style,n="userSelect"in i?"userSelect":"MozUserSelect"in i?"MozUserSelect":"WebkitUserSelect"in i?"WebkitUserSelect":"KhtmlUserSelect"in i?"KhtmlUserSelect":"",E.util.makeElementUnselectable=function(e){return void 0!==e.onselectstart&&(e.onselectstart=E.util.falseFunction),n?e.style[n]="none":"string"==typeof e.unselectable&&(e.unselectable="on"),e},E.util.makeElementSelectable=function(e){return void 0!==e.onselectstart&&(e.onselectstart=null),n?e.style[n]="":"string"==typeof e.unselectable&&(e.unselectable=""),e},E.util.setImageSmoothing=function(e,t){e.imageSmoothingEnabled=e.imageSmoothingEnabled||e.webkitImageSmoothingEnabled||e.mozImageSmoothingEnabled||e.msImageSmoothingEnabled||e.oImageSmoothingEnabled,e.imageSmoothingEnabled=t},E.util.getById=function(e){return"string"==typeof e?E.document.getElementById(e):e},E.util.toArray=s,E.util.addClass=function(e,t){e&&-1===(" "+e.className+" ").indexOf(" "+t+" ")&&(e.className+=(e.className?" ":"")+t)},E.util.makeElement=o,E.util.wrapElement=function(e,t,i){return"string"==typeof t&&(t=o(t,i)),e.parentNode&&e.parentNode.replaceChild(t,e),t.appendChild(e),t},E.util.getScrollLeftTop=a,E.util.getElementOffset=function(e){var i,n,r=e&&e.ownerDocument,s={left:0,top:0},o={left:0,top:0},l={borderLeftWidth:"left",borderTopWidth:"top",paddingLeft:"left",paddingTop:"top"};if(!r)return o;for(var c in l)o[l[c]]+=parseInt(t(e,c),10)||0;return i=r.documentElement,void 0!==e.getBoundingClientRect&&(s=e.getBoundingClientRect()),n=a(e),{left:s.left+n.left-(i.clientLeft||0)+o.left,top:s.top+n.top-(i.clientTop||0)+o.top}},E.util.getNodeCanvas=function(e){var t=E.jsdomImplForWrapper(e);return t._canvas||t._image},E.util.cleanUpJsdomNode=function(e){if(E.isLikelyNode){var t=E.jsdomImplForWrapper(e);t&&(t._image=null,t._canvas=null,t._currentSrc=null,t._attributes=null,t._classList=null)}}}(),function(){function e(){}E.util.request=function(t,i){i||(i={});var n=i.method?i.method.toUpperCase():"GET",r=i.onComplete||function(){},s=new E.window.XMLHttpRequest,o=i.body||i.parameters;return s.onreadystatechange=function(){4===s.readyState&&(r(s),s.onreadystatechange=e)},"GET"===n&&(o=null,"string"==typeof i.parameters&&(t=function(e,t){return e+(/\?/.test(e)?"&":"?")+t}(t,i.parameters))),s.open(n,t,!0),"POST"!==n&&"PUT"!==n||s.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),s.send(o),s}}(),E.log=console.log,E.warn=console.warn,function(){var e=E.util.object.extend,t=E.util.object.clone,i=[];function n(){return!1}function r(e,t,i,n){return-i*Math.cos(e/n*(Math.PI/2))+i+t}E.util.object.extend(i,{cancelAll:function(){var e=this.splice(0);return e.forEach((function(e){e.cancel()})),e},cancelByCanvas:function(e){if(!e)return[];var t=this.filter((function(t){return"object"==typeof t.target&&t.target.canvas===e}));return t.forEach((function(e){e.cancel()})),t},cancelByTarget:function(e){var t=this.findAnimationsByTarget(e);return t.forEach((function(e){e.cancel()})),t},findAnimationIndex:function(e){return this.indexOf(this.findAnimation(e))},findAnimation:function(e){return this.find((function(t){return t.cancel===e}))},findAnimationsByTarget:function(e){return e?this.filter((function(t){return t.target===e})):[]}});var s=E.window.requestAnimationFrame||E.window.webkitRequestAnimationFrame||E.window.mozRequestAnimationFrame||E.window.oRequestAnimationFrame||E.window.msRequestAnimationFrame||function(e){return E.window.setTimeout(e,1e3/60)},o=E.window.cancelAnimationFrame||E.window.clearTimeout;function a(){return s.apply(E.window,arguments)}E.util.animate=function(i){i||(i={});var s,o=!1,l=function(){var e=E.runningAnimations.indexOf(s);return e>-1&&E.runningAnimations.splice(e,1)[0]};return s=e(t(i),{cancel:function(){return o=!0,l()},currentValue:"startValue"in i?i.startValue:0,completionRate:0,durationRate:0}),E.runningAnimations.push(s),a((function(e){var t,c=e||+new Date,h=i.duration||500,u=c+h,d=i.onChange||n,f=i.abort||n,g=i.onComplete||n,p=i.easing||r,m="startValue"in i&&i.startValue.length>0,_="startValue"in i?i.startValue:0,v="endValue"in i?i.endValue:100,y=i.byValue||(m?_.map((function(e,t){return v[t]-_[t]})):v-_);i.onStart&&i.onStart(),function e(i){var n=(t=i||+new Date)>u?h:t-c,r=n/h,w=m?_.map((function(e,t){return p(n,_[t],y[t],h)})):p(n,_,y,h),b=m?Math.abs((w[0]-_[0])/y[0]):Math.abs((w-_)/y);if(s.currentValue=m?w.slice():w,s.completionRate=b,s.durationRate=r,!o){if(!f(w,b,r))return t>u?(s.currentValue=m?v.slice():v,s.completionRate=1,s.durationRate=1,d(m?v.slice():v,1,1),g(v,1,1),void l()):(d(w,b,r),void a(e));l()}}(c)})),s.cancel},E.util.requestAnimFrame=a,E.util.cancelAnimFrame=function(){return o.apply(E.window,arguments)},E.runningAnimations=i}(),function(){function e(e,t,i){var n="rgba("+parseInt(e[0]+i*(t[0]-e[0]),10)+","+parseInt(e[1]+i*(t[1]-e[1]),10)+","+parseInt(e[2]+i*(t[2]-e[2]),10);return(n+=","+(e&&t?parseFloat(e[3]+i*(t[3]-e[3])):1))+")"}E.util.animateColor=function(t,i,n,r){var s=new E.Color(t).getSource(),o=new E.Color(i).getSource(),a=r.onComplete,l=r.onChange;return r=r||{},E.util.animate(E.util.object.extend(r,{duration:n||500,startValue:s,endValue:o,byValue:o,easing:function(t,i,n,s){return e(i,n,r.colorEasing?r.colorEasing(t,s):1-Math.cos(t/s*(Math.PI/2)))},onComplete:function(t,i,n){if(a)return a(e(o,o,0),i,n)},onChange:function(t,i,n){if(l){if(Array.isArray(t))return l(e(t,t,0),i,n);l(t,i,n)}}}))}}(),function(){function e(e,t,i,n){return e<Math.abs(t)?(e=t,n=i/4):n=0===t&&0===e?i/(2*Math.PI)*Math.asin(1):i/(2*Math.PI)*Math.asin(t/e),{a:e,c:t,p:i,s:n}}function t(e,t,i){return e.a*Math.pow(2,10*(t-=1))*Math.sin((t*i-e.s)*(2*Math.PI)/e.p)}function i(e,t,i,r){return i-n(r-e,0,i,r)+t}function n(e,t,i,n){return(e/=n)<1/2.75?i*(7.5625*e*e)+t:e<2/2.75?i*(7.5625*(e-=1.5/2.75)*e+.75)+t:e<2.5/2.75?i*(7.5625*(e-=2.25/2.75)*e+.9375)+t:i*(7.5625*(e-=2.625/2.75)*e+.984375)+t}E.util.ease={easeInQuad:function(e,t,i,n){return i*(e/=n)*e+t},easeOutQuad:function(e,t,i,n){return-i*(e/=n)*(e-2)+t},easeInOutQuad:function(e,t,i,n){return(e/=n/2)<1?i/2*e*e+t:-i/2*(--e*(e-2)-1)+t},easeInCubic:function(e,t,i,n){return i*(e/=n)*e*e+t},easeOutCubic:function(e,t,i,n){return i*((e=e/n-1)*e*e+1)+t},easeInOutCubic:function(e,t,i,n){return(e/=n/2)<1?i/2*e*e*e+t:i/2*((e-=2)*e*e+2)+t},easeInQuart:function(e,t,i,n){return i*(e/=n)*e*e*e+t},easeOutQuart:function(e,t,i,n){return-i*((e=e/n-1)*e*e*e-1)+t},easeInOutQuart:function(e,t,i,n){return(e/=n/2)<1?i/2*e*e*e*e+t:-i/2*((e-=2)*e*e*e-2)+t},easeInQuint:function(e,t,i,n){return i*(e/=n)*e*e*e*e+t},easeOutQuint:function(e,t,i,n){return i*((e=e/n-1)*e*e*e*e+1)+t},easeInOutQuint:function(e,t,i,n){return(e/=n/2)<1?i/2*e*e*e*e*e+t:i/2*((e-=2)*e*e*e*e+2)+t},easeInSine:function(e,t,i,n){return-i*Math.cos(e/n*(Math.PI/2))+i+t},easeOutSine:function(e,t,i,n){return i*Math.sin(e/n*(Math.PI/2))+t},easeInOutSine:function(e,t,i,n){return-i/2*(Math.cos(Math.PI*e/n)-1)+t},easeInExpo:function(e,t,i,n){return 0===e?t:i*Math.pow(2,10*(e/n-1))+t},easeOutExpo:function(e,t,i,n){return e===n?t+i:i*(1-Math.pow(2,-10*e/n))+t},easeInOutExpo:function(e,t,i,n){return 0===e?t:e===n?t+i:(e/=n/2)<1?i/2*Math.pow(2,10*(e-1))+t:i/2*(2-Math.pow(2,-10*--e))+t},easeInCirc:function(e,t,i,n){return-i*(Math.sqrt(1-(e/=n)*e)-1)+t},easeOutCirc:function(e,t,i,n){return i*Math.sqrt(1-(e=e/n-1)*e)+t},easeInOutCirc:function(e,t,i,n){return(e/=n/2)<1?-i/2*(Math.sqrt(1-e*e)-1)+t:i/2*(Math.sqrt(1-(e-=2)*e)+1)+t},easeInElastic:function(i,n,r,s){var o=0;return 0===i?n:1==(i/=s)?n+r:(o||(o=.3*s),-t(e(r,r,o,1.70158),i,s)+n)},easeOutElastic:function(t,i,n,r){var s=0;if(0===t)return i;if(1==(t/=r))return i+n;s||(s=.3*r);var o=e(n,n,s,1.70158);return o.a*Math.pow(2,-10*t)*Math.sin((t*r-o.s)*(2*Math.PI)/o.p)+o.c+i},easeInOutElastic:function(i,n,r,s){var o=0;if(0===i)return n;if(2==(i/=s/2))return n+r;o||(o=s*(.3*1.5));var a=e(r,r,o,1.70158);return i<1?-.5*t(a,i,s)+n:a.a*Math.pow(2,-10*(i-=1))*Math.sin((i*s-a.s)*(2*Math.PI)/a.p)*.5+a.c+n},easeInBack:function(e,t,i,n,r){return void 0===r&&(r=1.70158),i*(e/=n)*e*((r+1)*e-r)+t},easeOutBack:function(e,t,i,n,r){return void 0===r&&(r=1.70158),i*((e=e/n-1)*e*((r+1)*e+r)+1)+t},easeInOutBack:function(e,t,i,n,r){return void 0===r&&(r=1.70158),(e/=n/2)<1?i/2*(e*e*((1+(r*=1.525))*e-r))+t:i/2*((e-=2)*e*((1+(r*=1.525))*e+r)+2)+t},easeInBounce:i,easeOutBounce:n,easeInOutBounce:function(e,t,r,s){return e<s/2?.5*i(2*e,0,r,s)+t:.5*n(2*e-s,0,r,s)+.5*r+t}}}(),function(e){var t=e.fabric||(e.fabric={}),i=t.util.object.extend,n=t.util.object.clone,r=t.util.toFixed,s=t.util.parseUnit,o=t.util.multiplyTransformMatrices,a={cx:"left",x:"left",r:"radius",cy:"top",y:"top",display:"visible",visibility:"visible",transform:"transformMatrix","fill-opacity":"fillOpacity","fill-rule":"fillRule","font-family":"fontFamily","font-size":"fontSize","font-style":"fontStyle","font-weight":"fontWeight","letter-spacing":"charSpacing","paint-order":"paintFirst","stroke-dasharray":"strokeDashArray","stroke-dashoffset":"strokeDashOffset","stroke-linecap":"strokeLineCap","stroke-linejoin":"strokeLineJoin","stroke-miterlimit":"strokeMiterLimit","stroke-opacity":"strokeOpacity","stroke-width":"strokeWidth","text-decoration":"textDecoration","text-anchor":"textAnchor",opacity:"opacity","clip-path":"clipPath","clip-rule":"clipRule","vector-effect":"strokeUniform","image-rendering":"imageSmoothing"},l={stroke:"strokeOpacity",fill:"fillOpacity"},c="font-size",h="clip-path";function u(e){return e in a?a[e]:e}function d(e,i,n,r){var a,l=Array.isArray(i);if("fill"!==e&&"stroke"!==e||"none"!==i){if("strokeUniform"===e)return"non-scaling-stroke"===i;if("strokeDashArray"===e)i="none"===i?null:i.replace(/,/g," ").split(/\s+/).map(parseFloat);else if("transformMatrix"===e)i=n&&n.transformMatrix?o(n.transformMatrix,t.parseTransformAttribute(i)):t.parseTransformAttribute(i);else if("visible"===e)i="none"!==i&&"hidden"!==i,n&&!1===n.visible&&(i=!1);else if("opacity"===e)i=parseFloat(i),n&&void 0!==n.opacity&&(i*=n.opacity);else if("textAnchor"===e)i="start"===i?"left":"end"===i?"right":"center";else if("charSpacing"===e)a=s(i,r)/r*1e3;else if("paintFirst"===e){var c=i.indexOf("fill"),h=i.indexOf("stroke");i="fill",(c>-1&&h>-1&&h<c||-1===c&&h>-1)&&(i="stroke")}else{if("href"===e||"xlink:href"===e||"font"===e)return i;if("imageSmoothing"===e)return"optimizeQuality"===i;a=l?i.map(s):s(i,r)}}else i="";return!l&&isNaN(a)?i:a}function f(e){return new RegExp("^("+e.join("|")+")\\b","i")}function g(e,t){var i,n,r,s,o=[];for(r=0,s=t.length;r<s;r++)i=t[r],n=e.getElementsByTagName(i),o=o.concat(Array.prototype.slice.call(n));return o}function p(e,t){var i,n=!0;return(i=m(e,t.pop()))&&t.length&&(n=function(e,t){for(var i,n=!0;e.parentNode&&1===e.parentNode.nodeType&&t.length;)n&&(i=t.pop()),n=m(e=e.parentNode,i);return 0===t.length}(e,t)),i&&n&&0===t.length}function m(e,t){var i,n,r=e.nodeName,s=e.getAttribute("class"),o=e.getAttribute("id");if(i=new RegExp("^"+r,"i"),t=t.replace(i,""),o&&t.length&&(i=new RegExp("#"+o+"(?![a-zA-Z\\-]+)","i"),t=t.replace(i,"")),s&&t.length)for(n=(s=s.split(" ")).length;n--;)i=new RegExp("\\."+s[n]+"(?![a-zA-Z\\-]+)","i"),t=t.replace(i,"");return 0===t.length}function _(e,t){var i;if(e.getElementById&&(i=e.getElementById(t)),i)return i;var n,r,s,o=e.getElementsByTagName("*");for(r=0,s=o.length;r<s;r++)if(t===(n=o[r]).getAttribute("id"))return n}t.svgValidTagNamesRegEx=f(["path","circle","polygon","polyline","ellipse","rect","line","image","text"]),t.svgViewBoxElementsRegEx=f(["symbol","image","marker","pattern","view","svg"]),t.svgInvalidAncestorsRegEx=f(["pattern","defs","symbol","metadata","clipPath","mask","desc"]),t.svgValidParentsRegEx=f(["symbol","g","a","svg","clipPath","defs"]),t.cssRules={},t.gradientDefs={},t.clipPaths={},t.parseTransformAttribute=function(){function e(e,i,n){e[n]=Math.tan(t.util.degreesToRadians(i[0]))}var i=t.iMatrix,n=t.reNum,r=t.commaWsp,s="(?:(?:(matrix)\\s*\\(\\s*("+n+")"+r+"("+n+")"+r+"("+n+")"+r+"("+n+")"+r+"("+n+")"+r+"("+n+")\\s*\\))|(?:(translate)\\s*\\(\\s*("+n+")(?:"+r+"("+n+"))?\\s*\\))|(?:(scale)\\s*\\(\\s*("+n+")(?:"+r+"("+n+"))?\\s*\\))|(?:(rotate)\\s*\\(\\s*("+n+")(?:"+r+"("+n+")"+r+"("+n+"))?\\s*\\))|(?:(skewX)\\s*\\(\\s*("+n+")\\s*\\))|(?:(skewY)\\s*\\(\\s*("+n+")\\s*\\)))",o=new RegExp("^\\s*(?:(?:"+s+"(?:"+r+"*"+s+")*)?)\\s*$"),a=new RegExp(s,"g");return function(n){var r=i.concat(),l=[];if(!n||n&&!o.test(n))return r;n.replace(a,(function(n){var o=new RegExp(s).exec(n).filter((function(e){return!!e})),a=o[1],c=o.slice(2).map(parseFloat);switch(a){case"translate":!function(e,t){e[4]=t[0],2===t.length&&(e[5]=t[1])}(r,c);break;case"rotate":c[0]=t.util.degreesToRadians(c[0]),function(e,i){var n=t.util.cos(i[0]),r=t.util.sin(i[0]),s=0,o=0;3===i.length&&(s=i[1],o=i[2]),e[0]=n,e[1]=r,e[2]=-r,e[3]=n,e[4]=s-(n*s-r*o),e[5]=o-(r*s+n*o)}(r,c);break;case"scale":!function(e,t){var i=t[0],n=2===t.length?t[1]:t[0];e[0]=i,e[3]=n}(r,c);break;case"skewX":e(r,c,2);break;case"skewY":e(r,c,1);break;case"matrix":r=c}l.push(r.concat()),r=i.concat()}));for(var c=l[0];l.length>1;)l.shift(),c=t.util.multiplyTransformMatrices(c,l[0]);return c}}();var v=new RegExp("^\\s*("+t.reNum+"+)\\s*,?\\s*("+t.reNum+"+)\\s*,?\\s*("+t.reNum+"+)\\s*,?\\s*("+t.reNum+"+)\\s*$");function y(e){if(!t.svgViewBoxElementsRegEx.test(e.nodeName))return{};var i,n,r,o,a,l,c=e.getAttribute("viewBox"),h=1,u=1,d=e.getAttribute("width"),f=e.getAttribute("height"),g=e.getAttribute("x")||0,p=e.getAttribute("y")||0,m=e.getAttribute("preserveAspectRatio")||"",_=!c||!(c=c.match(v)),y=!d||!f||"100%"===d||"100%"===f,w=_&&y,b={},C="",S=0,E=0;if(b.width=0,b.height=0,b.toBeParsed=w,_&&(g||p)&&e.parentNode&&"#document"!==e.parentNode.nodeName&&(C=" translate("+s(g)+" "+s(p)+") ",a=(e.getAttribute("transform")||"")+C,e.setAttribute("transform",a),e.removeAttribute("x"),e.removeAttribute("y")),w)return b;if(_)return b.width=s(d),b.height=s(f),b;if(i=-parseFloat(c[1]),n=-parseFloat(c[2]),r=parseFloat(c[3]),o=parseFloat(c[4]),b.minX=i,b.minY=n,b.viewBoxWidth=r,b.viewBoxHeight=o,y?(b.width=r,b.height=o):(b.width=s(d),b.height=s(f),h=b.width/r,u=b.height/o),"none"!==(m=t.util.parsePreserveAspectRatioAttribute(m)).alignX&&("meet"===m.meetOrSlice&&(u=h=h>u?u:h),"slice"===m.meetOrSlice&&(u=h=h>u?h:u),S=b.width-r*h,E=b.height-o*h,"Mid"===m.alignX&&(S/=2),"Mid"===m.alignY&&(E/=2),"Min"===m.alignX&&(S=0),"Min"===m.alignY&&(E=0)),1===h&&1===u&&0===i&&0===n&&0===g&&0===p)return b;if((g||p)&&"#document"!==e.parentNode.nodeName&&(C=" translate("+s(g)+" "+s(p)+") "),a=C+" matrix("+h+" 0 0 "+u+" "+(i*h+S)+" "+(n*u+E)+") ","svg"===e.nodeName){for(l=e.ownerDocument.createElementNS(t.svgNS,"g");e.firstChild;)l.appendChild(e.firstChild);e.appendChild(l)}else(l=e).removeAttribute("x"),l.removeAttribute("y"),a=l.getAttribute("transform")+a;return l.setAttribute("transform",a),b}function w(e,t){var i="xlink:href",n=_(e,t.getAttribute(i).slice(1));if(n&&n.getAttribute(i)&&w(e,n),["gradientTransform","x1","x2","y1","y2","gradientUnits","cx","cy","r","fx","fy"].forEach((function(e){n&&!t.hasAttribute(e)&&n.hasAttribute(e)&&t.setAttribute(e,n.getAttribute(e))})),!t.children.length)for(var r=n.cloneNode(!0);r.firstChild;)t.appendChild(r.firstChild);t.removeAttribute(i)}t.parseSVGDocument=function(e,i,r,s){if(e){!function(e){for(var i=g(e,["use","svg:use"]),n=0;i.length&&n<i.length;){var r=i[n],s=r.getAttribute("xlink:href")||r.getAttribute("href");if(null===s)return;var o,a,l,c,h=s.slice(1),u=r.getAttribute("x")||0,d=r.getAttribute("y")||0,f=_(e,h).cloneNode(!0),p=(f.getAttribute("transform")||"")+" translate("+u+", "+d+")",m=i.length,v=t.svgNS;if(y(f),/^svg$/i.test(f.nodeName)){var w=f.ownerDocument.createElementNS(v,"g");for(a=0,c=(l=f.attributes).length;a<c;a++)o=l.item(a),w.setAttributeNS(v,o.nodeName,o.nodeValue);for(;f.firstChild;)w.appendChild(f.firstChild);f=w}for(a=0,c=(l=r.attributes).length;a<c;a++)"x"!==(o=l.item(a)).nodeName&&"y"!==o.nodeName&&"xlink:href"!==o.nodeName&&"href"!==o.nodeName&&("transform"===o.nodeName?p=o.nodeValue+" "+p:f.setAttribute(o.nodeName,o.nodeValue));f.setAttribute("transform",p),f.setAttribute("instantiated_by_use","1"),f.removeAttribute("id"),r.parentNode.replaceChild(f,r),i.length===m&&n++}}(e);var o,a,l=t.Object.__uid++,c=y(e),h=t.util.toArray(e.getElementsByTagName("*"));if(c.crossOrigin=s&&s.crossOrigin,c.svgUid=l,0===h.length&&t.isLikelyNode){var u=[];for(o=0,a=(h=e.selectNodes('//*[name(.)!="svg"]')).length;o<a;o++)u[o]=h[o];h=u}var d=h.filter((function(e){return y(e),t.svgValidTagNamesRegEx.test(e.nodeName.replace("svg:",""))&&!function(e,t){for(;e&&(e=e.parentNode);)if(e.nodeName&&t.test(e.nodeName.replace("svg:",""))&&!e.getAttribute("instantiated_by_use"))return!0;return!1}(e,t.svgInvalidAncestorsRegEx)}));if(!d||d&&!d.length)i&&i([],{});else{var f={};h.filter((function(e){return"clipPath"===e.nodeName.replace("svg:","")})).forEach((function(e){var i=e.getAttribute("id");f[i]=t.util.toArray(e.getElementsByTagName("*")).filter((function(e){return t.svgValidTagNamesRegEx.test(e.nodeName.replace("svg:",""))}))})),t.gradientDefs[l]=t.getGradientDefs(e),t.cssRules[l]=t.getCSSRules(e),t.clipPaths[l]=f,t.parseElements(d,(function(e,n){i&&(i(e,c,n,h),delete t.gradientDefs[l],delete t.cssRules[l],delete t.clipPaths[l])}),n(c),r,s)}}};var b=new RegExp("(normal|italic)?\\s*(normal|small-caps)?\\s*(normal|bold|bolder|lighter|100|200|300|400|500|600|700|800|900)?\\s*("+t.reNum+"(?:px|cm|mm|em|pt|pc|in)*)(?:\\/(normal|"+t.reNum+"))?\\s+(.*)");i(t,{parseFontDeclaration:function(e,t){var i=e.match(b);if(i){var n=i[1],r=i[3],o=i[4],a=i[5],l=i[6];n&&(t.fontStyle=n),r&&(t.fontWeight=isNaN(parseFloat(r))?r:parseFloat(r)),o&&(t.fontSize=s(o)),l&&(t.fontFamily=l),a&&(t.lineHeight="normal"===a?1:a)}},getGradientDefs:function(e){var t,i=g(e,["linearGradient","radialGradient","svg:linearGradient","svg:radialGradient"]),n=0,r={};for(n=i.length;n--;)(t=i[n]).getAttribute("xlink:href")&&w(e,t),r[t.getAttribute("id")]=t;return r},parseAttributes:function(e,n,o){if(e){var a,f,g,m={};void 0===o&&(o=e.getAttribute("svgUid")),e.parentNode&&t.svgValidParentsRegEx.test(e.parentNode.nodeName)&&(m=t.parseAttributes(e.parentNode,n,o));var _=n.reduce((function(t,i){return(a=e.getAttribute(i))&&(t[i]=a),t}),{}),v=i(function(e,i){var n={};for(var r in t.cssRules[i])if(p(e,r.split(" ")))for(var s in t.cssRules[i][r])n[s]=t.cssRules[i][r][s];return n}(e,o),t.parseStyleAttribute(e));_=i(_,v),v[h]&&e.setAttribute(h,v[h]),f=g=m.fontSize||t.Text.DEFAULT_SVG_FONT_SIZE,_[c]&&(_[c]=f=s(_[c],g));var y,w,b={};for(var C in _)w=d(y=u(C),_[C],m,f),b[y]=w;b&&b.font&&t.parseFontDeclaration(b.font,b);var S=i(m,b);return t.svgValidParentsRegEx.test(e.nodeName)?S:function(e){for(var i in l)if(void 0!==e[l[i]]&&""!==e[i]){if(void 0===e[i]){if(!t.Object.prototype[i])continue;e[i]=t.Object.prototype[i]}if(0!==e[i].indexOf("url(")){var n=new t.Color(e[i]);e[i]=n.setAlpha(r(n.getAlpha()*e[l[i]],2)).toRgba()}}return e}(S)}},parseElements:function(e,i,n,r,s){new t.ElementsParser(e,i,n,r,s).parse()},parseStyleAttribute:function(e){var t={},i=e.getAttribute("style");return i?("string"==typeof i?function(e,t){var i,n;e.replace(/;\s*$/,"").split(";").forEach((function(e){var r=e.split(":");i=r[0].trim().toLowerCase(),n=r[1].trim(),t[i]=n}))}(i,t):function(e,t){var i,n;for(var r in e)void 0!==e[r]&&(i=r.toLowerCase(),n=e[r],t[i]=n)}(i,t),t):t},parsePointsAttribute:function(e){if(!e)return null;var t,i,n=[];for(t=0,i=(e=(e=e.replace(/,/g," ").trim()).split(/\s+/)).length;t<i;t+=2)n.push({x:parseFloat(e[t]),y:parseFloat(e[t+1])});return n},getCSSRules:function(e){var i,n,r=e.getElementsByTagName("style"),s={};for(i=0,n=r.length;i<n;i++){var o=r[i].textContent;""!==(o=o.replace(/\/\*[\s\S]*?\*\//g,"")).trim()&&o.split("}").filter((function(e){return e.trim()})).forEach((function(e){var r=e.split("{"),o={},a=r[1].trim().split(";").filter((function(e){return e.trim()}));for(i=0,n=a.length;i<n;i++){var l=a[i].split(":"),c=l[0].trim(),h=l[1].trim();o[c]=h}(e=r[0].trim()).split(",").forEach((function(e){""!==(e=e.replace(/^svg/i,"").trim())&&(s[e]?t.util.object.extend(s[e],o):s[e]=t.util.object.clone(o))}))}))}return s},loadSVGFromURL:function(e,i,n,r){e=e.replace(/^\n\s*/,"").trim(),new t.util.request(e,{method:"get",onComplete:function(e){var s=e.responseXML;if(!s||!s.documentElement)return i&&i(null),!1;t.parseSVGDocument(s.documentElement,(function(e,t,n,r){i&&i(e,t,n,r)}),n,r)}})},loadSVGFromString:function(e,i,n,r){var s=(new t.window.DOMParser).parseFromString(e.trim(),"text/xml");t.parseSVGDocument(s.documentElement,(function(e,t,n,r){i(e,t,n,r)}),n,r)}})}(t),E.ElementsParser=function(e,t,i,n,r,s){this.elements=e,this.callback=t,this.options=i,this.reviver=n,this.svgUid=i&&i.svgUid||0,this.parsingOptions=r,this.regexUrl=/^url\(['"]?#([^'"]+)['"]?\)/g,this.doc=s},(m=E.ElementsParser.prototype).parse=function(){this.instances=new Array(this.elements.length),this.numElements=this.elements.length,this.createObjects()},m.createObjects=function(){var e=this;this.elements.forEach((function(t,i){t.setAttribute("svgUid",e.svgUid),e.createObject(t,i)}))},m.findTag=function(e){return E[E.util.string.capitalize(e.tagName.replace("svg:",""))]},m.createObject=function(e,t){var i=this.findTag(e);if(i&&i.fromElement)try{i.fromElement(e,this.createCallback(t,e),this.options)}catch(e){E.log(e)}else this.checkIfDone()},m.createCallback=function(e,t){var i=this;return function(n){var r;i.resolveGradient(n,t,"fill"),i.resolveGradient(n,t,"stroke"),n instanceof E.Image&&n._originalElement&&(r=n.parsePreserveAspectRatioAttribute(t)),n._removeTransformMatrix(r),i.resolveClipPath(n,t),i.reviver&&i.reviver(t,n),i.instances[e]=n,i.checkIfDone()}},m.extractPropertyDefinition=function(e,t,i){var n=e[t],r=this.regexUrl;if(r.test(n)){r.lastIndex=0;var s=r.exec(n)[1];return r.lastIndex=0,E[i][this.svgUid][s]}},m.resolveGradient=function(e,t,i){var n=this.extractPropertyDefinition(e,i,"gradientDefs");if(n){var r=t.getAttribute(i+"-opacity"),s=E.Gradient.fromElement(n,e,r,this.options);e.set(i,s)}},m.createClipPathCallback=function(e,t){return function(e){e._removeTransformMatrix(),e.fillRule=e.clipRule,t.push(e)}},m.resolveClipPath=function(e,t){var i,n,r,s,o=this.extractPropertyDefinition(e,"clipPath","clipPaths");if(o){r=[],n=E.util.invertTransform(e.calcTransformMatrix());for(var a=o[0].parentNode,l=t;l.parentNode&&l.getAttribute("clip-path")!==e.clipPath;)l=l.parentNode;l.parentNode.appendChild(a);for(var c=0;c<o.length;c++)i=o[c],this.findTag(i).fromElement(i,this.createClipPathCallback(e,r),this.options);o=1===r.length?r[0]:new E.Group(r),s=E.util.multiplyTransformMatrices(n,o.calcTransformMatrix()),o.clipPath&&this.resolveClipPath(o,l);var h=E.util.qrDecompose(s);o.flipX=!1,o.flipY=!1,o.set("scaleX",h.scaleX),o.set("scaleY",h.scaleY),o.angle=h.angle,o.skewX=h.skewX,o.skewY=0,o.setPositionByOrigin({x:h.translateX,y:h.translateY},"center","center"),e.clipPath=o}else delete e.clipPath},m.checkIfDone=function(){0==--this.numElements&&(this.instances=this.instances.filter((function(e){return null!=e})),this.callback(this.instances,this.elements))},function(e){var t=e.fabric||(e.fabric={});function i(e,t){this.x=e,this.y=t}t.Point?t.warn("fabric.Point is already defined"):(t.Point=i,i.prototype={type:"point",constructor:i,add:function(e){return new i(this.x+e.x,this.y+e.y)},addEquals:function(e){return this.x+=e.x,this.y+=e.y,this},scalarAdd:function(e){return new i(this.x+e,this.y+e)},scalarAddEquals:function(e){return this.x+=e,this.y+=e,this},subtract:function(e){return new i(this.x-e.x,this.y-e.y)},subtractEquals:function(e){return this.x-=e.x,this.y-=e.y,this},scalarSubtract:function(e){return new i(this.x-e,this.y-e)},scalarSubtractEquals:function(e){return this.x-=e,this.y-=e,this},multiply:function(e){return new i(this.x*e,this.y*e)},multiplyEquals:function(e){return this.x*=e,this.y*=e,this},divide:function(e){return new i(this.x/e,this.y/e)},divideEquals:function(e){return this.x/=e,this.y/=e,this},eq:function(e){return this.x===e.x&&this.y===e.y},lt:function(e){return this.x<e.x&&this.y<e.y},lte:function(e){return this.x<=e.x&&this.y<=e.y},gt:function(e){return this.x>e.x&&this.y>e.y},gte:function(e){return this.x>=e.x&&this.y>=e.y},lerp:function(e,t){return void 0===t&&(t=.5),t=Math.max(Math.min(1,t),0),new i(this.x+(e.x-this.x)*t,this.y+(e.y-this.y)*t)},distanceFrom:function(e){var t=this.x-e.x,i=this.y-e.y;return Math.sqrt(t*t+i*i)},midPointFrom:function(e){return this.lerp(e)},min:function(e){return new i(Math.min(this.x,e.x),Math.min(this.y,e.y))},max:function(e){return new i(Math.max(this.x,e.x),Math.max(this.y,e.y))},toString:function(){return this.x+","+this.y},setXY:function(e,t){return this.x=e,this.y=t,this},setX:function(e){return this.x=e,this},setY:function(e){return this.y=e,this},setFromPoint:function(e){return this.x=e.x,this.y=e.y,this},swap:function(e){var t=this.x,i=this.y;this.x=e.x,this.y=e.y,e.x=t,e.y=i},clone:function(){return new i(this.x,this.y)}})}(t),function(e){var t=e.fabric||(e.fabric={});function i(e){this.status=e,this.points=[]}t.Intersection?t.warn("fabric.Intersection is already defined"):(t.Intersection=i,t.Intersection.prototype={constructor:i,appendPoint:function(e){return this.points.push(e),this},appendPoints:function(e){return this.points=this.points.concat(e),this}},t.Intersection.intersectLineLine=function(e,n,r,s){var o,a=(s.x-r.x)*(e.y-r.y)-(s.y-r.y)*(e.x-r.x),l=(n.x-e.x)*(e.y-r.y)-(n.y-e.y)*(e.x-r.x),c=(s.y-r.y)*(n.x-e.x)-(s.x-r.x)*(n.y-e.y);if(0!==c){var h=a/c,u=l/c;0<=h&&h<=1&&0<=u&&u<=1?(o=new i("Intersection")).appendPoint(new t.Point(e.x+h*(n.x-e.x),e.y+h*(n.y-e.y))):o=new i}else o=new i(0===a||0===l?"Coincident":"Parallel");return o},t.Intersection.intersectLinePolygon=function(e,t,n){var r,s,o,a,l=new i,c=n.length;for(a=0;a<c;a++)r=n[a],s=n[(a+1)%c],o=i.intersectLineLine(e,t,r,s),l.appendPoints(o.points);return l.points.length>0&&(l.status="Intersection"),l},t.Intersection.intersectPolygonPolygon=function(e,t){var n,r=new i,s=e.length;for(n=0;n<s;n++){var o=e[n],a=e[(n+1)%s],l=i.intersectLinePolygon(o,a,t);r.appendPoints(l.points)}return r.points.length>0&&(r.status="Intersection"),r},t.Intersection.intersectPolygonRectangle=function(e,n,r){var s=n.min(r),o=n.max(r),a=new t.Point(o.x,s.y),l=new t.Point(s.x,o.y),c=i.intersectLinePolygon(s,a,e),h=i.intersectLinePolygon(a,o,e),u=i.intersectLinePolygon(o,l,e),d=i.intersectLinePolygon(l,s,e),f=new i;return f.appendPoints(c.points),f.appendPoints(h.points),f.appendPoints(u.points),f.appendPoints(d.points),f.points.length>0&&(f.status="Intersection"),f})}(t),function(e){var t=e.fabric||(e.fabric={});function i(e){e?this._tryParsingColor(e):this.setSource([0,0,0,1])}function n(e,t,i){return i<0&&(i+=1),i>1&&(i-=1),i<1/6?e+6*(t-e)*i:i<.5?t:i<2/3?e+(t-e)*(2/3-i)*6:e}t.Color?t.warn("fabric.Color is already defined."):(t.Color=i,t.Color.prototype={_tryParsingColor:function(e){var t;e in i.colorNameMap&&(e=i.colorNameMap[e]),"transparent"===e&&(t=[255,255,255,0]),t||(t=i.sourceFromHex(e)),t||(t=i.sourceFromRgb(e)),t||(t=i.sourceFromHsl(e)),t||(t=[0,0,0,1]),t&&this.setSource(t)},_rgbToHsl:function(e,i,n){e/=255,i/=255,n/=255;var r,s,o,a=t.util.array.max([e,i,n]),l=t.util.array.min([e,i,n]);if(o=(a+l)/2,a===l)r=s=0;else{var c=a-l;switch(s=o>.5?c/(2-a-l):c/(a+l),a){case e:r=(i-n)/c+(i<n?6:0);break;case i:r=(n-e)/c+2;break;case n:r=(e-i)/c+4}r/=6}return[Math.round(360*r),Math.round(100*s),Math.round(100*o)]},getSource:function(){return this._source},setSource:function(e){this._source=e},toRgb:function(){var e=this.getSource();return"rgb("+e[0]+","+e[1]+","+e[2]+")"},toRgba:function(){var e=this.getSource();return"rgba("+e[0]+","+e[1]+","+e[2]+","+e[3]+")"},toHsl:function(){var e=this.getSource(),t=this._rgbToHsl(e[0],e[1],e[2]);return"hsl("+t[0]+","+t[1]+"%,"+t[2]+"%)"},toHsla:function(){var e=this.getSource(),t=this._rgbToHsl(e[0],e[1],e[2]);return"hsla("+t[0]+","+t[1]+"%,"+t[2]+"%,"+e[3]+")"},toHex:function(){var e,t,i,n=this.getSource();return e=1===(e=n[0].toString(16)).length?"0"+e:e,t=1===(t=n[1].toString(16)).length?"0"+t:t,i=1===(i=n[2].toString(16)).length?"0"+i:i,e.toUpperCase()+t.toUpperCase()+i.toUpperCase()},toHexa:function(){var e,t=this.getSource();return e=1===(e=(e=Math.round(255*t[3])).toString(16)).length?"0"+e:e,this.toHex()+e.toUpperCase()},getAlpha:function(){return this.getSource()[3]},setAlpha:function(e){var t=this.getSource();return t[3]=e,this.setSource(t),this},toGrayscale:function(){var e=this.getSource(),t=parseInt((.3*e[0]+.59*e[1]+.11*e[2]).toFixed(0),10),i=e[3];return this.setSource([t,t,t,i]),this},toBlackWhite:function(e){var t=this.getSource(),i=(.3*t[0]+.59*t[1]+.11*t[2]).toFixed(0),n=t[3];return e=e||127,i=Number(i)<Number(e)?0:255,this.setSource([i,i,i,n]),this},overlayWith:function(e){e instanceof i||(e=new i(e));var t,n=[],r=this.getAlpha(),s=this.getSource(),o=e.getSource();for(t=0;t<3;t++)n.push(Math.round(.5*s[t]+.5*o[t]));return n[3]=r,this.setSource(n),this}},t.Color.reRGBa=/^rgba?\(\s*(\d{1,3}(?:\.\d+)?\%?)\s*,\s*(\d{1,3}(?:\.\d+)?\%?)\s*,\s*(\d{1,3}(?:\.\d+)?\%?)\s*(?:\s*,\s*((?:\d*\.?\d+)?)\s*)?\)$/i,t.Color.reHSLa=/^hsla?\(\s*(\d{1,3})\s*,\s*(\d{1,3}\%)\s*,\s*(\d{1,3}\%)\s*(?:\s*,\s*(\d+(?:\.\d+)?)\s*)?\)$/i,t.Color.reHex=/^#?([0-9a-f]{8}|[0-9a-f]{6}|[0-9a-f]{4}|[0-9a-f]{3})$/i,t.Color.colorNameMap={aliceblue:"#F0F8FF",antiquewhite:"#FAEBD7",aqua:"#00FFFF",aquamarine:"#7FFFD4",azure:"#F0FFFF",beige:"#F5F5DC",bisque:"#FFE4C4",black:"#000000",blanchedalmond:"#FFEBCD",blue:"#0000FF",blueviolet:"#8A2BE2",brown:"#A52A2A",burlywood:"#DEB887",cadetblue:"#5F9EA0",chartreuse:"#7FFF00",chocolate:"#D2691E",coral:"#FF7F50",cornflowerblue:"#6495ED",cornsilk:"#FFF8DC",crimson:"#DC143C",cyan:"#00FFFF",darkblue:"#00008B",darkcyan:"#008B8B",darkgoldenrod:"#B8860B",darkgray:"#A9A9A9",darkgrey:"#A9A9A9",darkgreen:"#006400",darkkhaki:"#BDB76B",darkmagenta:"#8B008B",darkolivegreen:"#556B2F",darkorange:"#FF8C00",darkorchid:"#9932CC",darkred:"#8B0000",darksalmon:"#E9967A",darkseagreen:"#8FBC8F",darkslateblue:"#483D8B",darkslategray:"#2F4F4F",darkslategrey:"#2F4F4F",darkturquoise:"#00CED1",darkviolet:"#9400D3",deeppink:"#FF1493",deepskyblue:"#00BFFF",dimgray:"#696969",dimgrey:"#696969",dodgerblue:"#1E90FF",firebrick:"#B22222",floralwhite:"#FFFAF0",forestgreen:"#228B22",fuchsia:"#FF00FF",gainsboro:"#DCDCDC",ghostwhite:"#F8F8FF",gold:"#FFD700",goldenrod:"#DAA520",gray:"#808080",grey:"#808080",green:"#008000",greenyellow:"#ADFF2F",honeydew:"#F0FFF0",hotpink:"#FF69B4",indianred:"#CD5C5C",indigo:"#4B0082",ivory:"#FFFFF0",khaki:"#F0E68C",lavender:"#E6E6FA",lavenderblush:"#FFF0F5",lawngreen:"#7CFC00",lemonchiffon:"#FFFACD",lightblue:"#ADD8E6",lightcoral:"#F08080",lightcyan:"#E0FFFF",lightgoldenrodyellow:"#FAFAD2",lightgray:"#D3D3D3",lightgrey:"#D3D3D3",lightgreen:"#90EE90",lightpink:"#FFB6C1",lightsalmon:"#FFA07A",lightseagreen:"#20B2AA",lightskyblue:"#87CEFA",lightslategray:"#778899",lightslategrey:"#778899",lightsteelblue:"#B0C4DE",lightyellow:"#FFFFE0",lime:"#00FF00",limegreen:"#32CD32",linen:"#FAF0E6",magenta:"#FF00FF",maroon:"#800000",mediumaquamarine:"#66CDAA",mediumblue:"#0000CD",mediumorchid:"#BA55D3",mediumpurple:"#9370DB",mediumseagreen:"#3CB371",mediumslateblue:"#7B68EE",mediumspringgreen:"#00FA9A",mediumturquoise:"#48D1CC",mediumvioletred:"#C71585",midnightblue:"#191970",mintcream:"#F5FFFA",mistyrose:"#FFE4E1",moccasin:"#FFE4B5",navajowhite:"#FFDEAD",navy:"#000080",oldlace:"#FDF5E6",olive:"#808000",olivedrab:"#6B8E23",orange:"#FFA500",orangered:"#FF4500",orchid:"#DA70D6",palegoldenrod:"#EEE8AA",palegreen:"#98FB98",paleturquoise:"#AFEEEE",palevioletred:"#DB7093",papayawhip:"#FFEFD5",peachpuff:"#FFDAB9",peru:"#CD853F",pink:"#FFC0CB",plum:"#DDA0DD",powderblue:"#B0E0E6",purple:"#800080",rebeccapurple:"#663399",red:"#FF0000",rosybrown:"#BC8F8F",royalblue:"#4169E1",saddlebrown:"#8B4513",salmon:"#FA8072",sandybrown:"#F4A460",seagreen:"#2E8B57",seashell:"#FFF5EE",sienna:"#A0522D",silver:"#C0C0C0",skyblue:"#87CEEB",slateblue:"#6A5ACD",slategray:"#708090",slategrey:"#708090",snow:"#FFFAFA",springgreen:"#00FF7F",steelblue:"#4682B4",tan:"#D2B48C",teal:"#008080",thistle:"#D8BFD8",tomato:"#FF6347",turquoise:"#40E0D0",violet:"#EE82EE",wheat:"#F5DEB3",white:"#FFFFFF",whitesmoke:"#F5F5F5",yellow:"#FFFF00",yellowgreen:"#9ACD32"},t.Color.fromRgb=function(e){return i.fromSource(i.sourceFromRgb(e))},t.Color.sourceFromRgb=function(e){var t=e.match(i.reRGBa);if(t){var n=parseInt(t[1],10)/(/%$/.test(t[1])?100:1)*(/%$/.test(t[1])?255:1),r=parseInt(t[2],10)/(/%$/.test(t[2])?100:1)*(/%$/.test(t[2])?255:1),s=parseInt(t[3],10)/(/%$/.test(t[3])?100:1)*(/%$/.test(t[3])?255:1);return[parseInt(n,10),parseInt(r,10),parseInt(s,10),t[4]?parseFloat(t[4]):1]}},t.Color.fromRgba=i.fromRgb,t.Color.fromHsl=function(e){return i.fromSource(i.sourceFromHsl(e))},t.Color.sourceFromHsl=function(e){var t=e.match(i.reHSLa);if(t){var r,s,o,a=(parseFloat(t[1])%360+360)%360/360,l=parseFloat(t[2])/(/%$/.test(t[2])?100:1),c=parseFloat(t[3])/(/%$/.test(t[3])?100:1);if(0===l)r=s=o=c;else{var h=c<=.5?c*(l+1):c+l-c*l,u=2*c-h;r=n(u,h,a+1/3),s=n(u,h,a),o=n(u,h,a-1/3)}return[Math.round(255*r),Math.round(255*s),Math.round(255*o),t[4]?parseFloat(t[4]):1]}},t.Color.fromHsla=i.fromHsl,t.Color.fromHex=function(e){return i.fromSource(i.sourceFromHex(e))},t.Color.sourceFromHex=function(e){if(e.match(i.reHex)){var t=e.slice(e.indexOf("#")+1),n=3===t.length||4===t.length,r=8===t.length||4===t.length,s=n?t.charAt(0)+t.charAt(0):t.substring(0,2),o=n?t.charAt(1)+t.charAt(1):t.substring(2,4),a=n?t.charAt(2)+t.charAt(2):t.substring(4,6),l=r?n?t.charAt(3)+t.charAt(3):t.substring(6,8):"FF";return[parseInt(s,16),parseInt(o,16),parseInt(a,16),parseFloat((parseInt(l,16)/255).toFixed(2))]}},t.Color.fromSource=function(e){var t=new i;return t.setSource(e),t})}(t),function(e){var t=e.fabric||(e.fabric={}),i=["e","se","s","sw","w","nw","n","ne","e"],n=["ns","nesw","ew","nwse"],r={},s="left",o="top",a="right",l="bottom",c="center",h={top:l,bottom:o,left:a,right:s,center:c},u=t.util.radiansToDegrees,d=Math.sign||function(e){return(e>0)-(e<0)||+e};function f(e,t){var i=e.angle+u(Math.atan2(t.y,t.x))+360;return Math.round(i%360/45)}function g(e,i){var n=i.transform.target,r=n.canvas,s=t.util.object.clone(i);s.target=n,r&&r.fire("object:"+e,s),n.fire(e,i)}function p(e,t){var i=t.canvas,n=e[i.uniScaleKey];return i.uniformScaling&&!n||!i.uniformScaling&&n}function m(e){return e.originX===c&&e.originY===c}function _(e,t,i){var n=e.lockScalingX,r=e.lockScalingY;return!((!n||!r)&&(t||!n&&!r||!i)&&(!n||"x"!==t)&&(!r||"y"!==t))}function v(e,t,i,n){return{e:e,transform:t,pointer:{x:i,y:n}}}function y(e){return function(t,i,n,r){var s=i.target,o=s.getCenterPoint(),a=s.translateToOriginPoint(o,i.originX,i.originY),l=e(t,i,n,r);return s.setPositionByOrigin(a,i.originX,i.originY),l}}function w(e,t){return function(i,n,r,s){var o=t(i,n,r,s);return o&&g(e,v(i,n,r,s)),o}}function b(e,i,n,r,s){var o=e.target,a=o.controls[e.corner],l=o.canvas.getZoom(),c=o.padding/l,h=o.toLocalPoint(new t.Point(r,s),i,n);return h.x>=c&&(h.x-=c),h.x<=-c&&(h.x+=c),h.y>=c&&(h.y-=c),h.y<=c&&(h.y+=c),h.x-=a.offsetX,h.y-=a.offsetY,h}function C(e){return e.flipX!==e.flipY}function S(e,t,i,n,r){if(0!==e[t]){var s=r/e._getTransformedDimensions()[n]*e[i];e.set(i,s)}}function E(e,t,i,n){var r,c=t.target,h=c._getTransformedDimensions(0,c.skewY),d=b(t,t.originX,t.originY,i,n),f=Math.abs(2*d.x)-h.x,g=c.skewX;f<2?r=0:(r=u(Math.atan2(f/c.scaleX,h.y/c.scaleY)),t.originX===s&&t.originY===l&&(r=-r),t.originX===a&&t.originY===o&&(r=-r),C(c)&&(r=-r));var p=g!==r;if(p){var m=c._getTransformedDimensions().y;c.set("skewX",r),S(c,"skewY","scaleY","y",m)}return p}function T(e,t,i,n){var r,c=t.target,h=c._getTransformedDimensions(c.skewX,0),d=b(t,t.originX,t.originY,i,n),f=Math.abs(2*d.y)-h.y,g=c.skewY;f<2?r=0:(r=u(Math.atan2(f/c.scaleY,h.x/c.scaleX)),t.originX===s&&t.originY===l&&(r=-r),t.originX===a&&t.originY===o&&(r=-r),C(c)&&(r=-r));var p=g!==r;if(p){var m=c._getTransformedDimensions().x;c.set("skewY",r),S(c,"skewX","scaleX","x",m)}return p}function x(e,t,i,n,r){r=r||{};var s,o,a,l,c,u,f=t.target,g=f.lockScalingX,v=f.lockScalingY,y=r.by,w=p(e,f),C=_(f,y,w),S=t.gestureScale;if(C)return!1;if(S)o=t.scaleX*S,a=t.scaleY*S;else{if(s=b(t,t.originX,t.originY,i,n),c="y"!==y?d(s.x):1,u="x"!==y?d(s.y):1,t.signX||(t.signX=c),t.signY||(t.signY=u),f.lockScalingFlip&&(t.signX!==c||t.signY!==u))return!1;if(l=f._getTransformedDimensions(),w&&!y){var E=Math.abs(s.x)+Math.abs(s.y),T=t.original,x=E/(Math.abs(l.x*T.scaleX/f.scaleX)+Math.abs(l.y*T.scaleY/f.scaleY));o=T.scaleX*x,a=T.scaleY*x}else o=Math.abs(s.x*f.scaleX/l.x),a=Math.abs(s.y*f.scaleY/l.y);m(t)&&(o*=2,a*=2),t.signX!==c&&"y"!==y&&(t.originX=h[t.originX],o*=-1,t.signX=c),t.signY!==u&&"x"!==y&&(t.originY=h[t.originY],a*=-1,t.signY=u)}var I=f.scaleX,A=f.scaleY;return y?("x"===y&&f.set("scaleX",o),"y"===y&&f.set("scaleY",a)):(!g&&f.set("scaleX",o),!v&&f.set("scaleY",a)),I!==f.scaleX||A!==f.scaleY}r.scaleCursorStyleHandler=function(e,t,n){var r=p(e,n),s="";if(0!==t.x&&0===t.y?s="x":0===t.x&&0!==t.y&&(s="y"),_(n,s,r))return"not-allowed";var o=f(n,t);return i[o]+"-resize"},r.skewCursorStyleHandler=function(e,t,i){var r="not-allowed";if(0!==t.x&&i.lockSkewingY)return r;if(0!==t.y&&i.lockSkewingX)return r;var s=f(i,t)%4;return n[s]+"-resize"},r.scaleSkewCursorStyleHandler=function(e,t,i){return e[i.canvas.altActionKey]?r.skewCursorStyleHandler(e,t,i):r.scaleCursorStyleHandler(e,t,i)},r.rotationWithSnapping=w("rotating",y((function(e,t,i,n){var r=t,s=r.target,o=s.translateToOriginPoint(s.getCenterPoint(),r.originX,r.originY);if(s.lockRotation)return!1;var a,l=Math.atan2(r.ey-o.y,r.ex-o.x),c=Math.atan2(n-o.y,i-o.x),h=u(c-l+r.theta);if(s.snapAngle>0){var d=s.snapAngle,f=s.snapThreshold||d,g=Math.ceil(h/d)*d,p=Math.floor(h/d)*d;Math.abs(h-p)<f?h=p:Math.abs(h-g)<f&&(h=g)}return h<0&&(h=360+h),h%=360,a=s.angle!==h,s.angle=h,a}))),r.scalingEqually=w("scaling",y((function(e,t,i,n){return x(e,t,i,n)}))),r.scalingX=w("scaling",y((function(e,t,i,n){return x(e,t,i,n,{by:"x"})}))),r.scalingY=w("scaling",y((function(e,t,i,n){return x(e,t,i,n,{by:"y"})}))),r.scalingYOrSkewingX=function(e,t,i,n){return e[t.target.canvas.altActionKey]?r.skewHandlerX(e,t,i,n):r.scalingY(e,t,i,n)},r.scalingXOrSkewingY=function(e,t,i,n){return e[t.target.canvas.altActionKey]?r.skewHandlerY(e,t,i,n):r.scalingX(e,t,i,n)},r.changeWidth=w("resizing",y((function(e,t,i,n){var r=t.target,s=b(t,t.originX,t.originY,i,n),o=r.strokeWidth/(r.strokeUniform?r.scaleX:1),a=m(t)?2:1,l=r.width,c=Math.abs(s.x*a/r.scaleX)-o;return r.set("width",Math.max(c,0)),l!==c}))),r.skewHandlerX=function(e,t,i,n){var r,l=t.target,h=l.skewX,u=t.originY;return!l.lockSkewingX&&(0===h?r=b(t,c,c,i,n).x>0?s:a:(h>0&&(r=u===o?s:a),h<0&&(r=u===o?a:s),C(l)&&(r=r===s?a:s)),t.originX=r,w("skewing",y(E))(e,t,i,n))},r.skewHandlerY=function(e,t,i,n){var r,a=t.target,h=a.skewY,u=t.originX;return!a.lockSkewingY&&(0===h?r=b(t,c,c,i,n).y>0?o:l:(h>0&&(r=u===s?o:l),h<0&&(r=u===s?l:o),C(a)&&(r=r===o?l:o)),t.originY=r,w("skewing",y(T))(e,t,i,n))},r.dragHandler=function(e,t,i,n){var r=t.target,s=i-t.offsetX,o=n-t.offsetY,a=!r.get("lockMovementX")&&r.left!==s,l=!r.get("lockMovementY")&&r.top!==o;return a&&r.set("left",s),l&&r.set("top",o),(a||l)&&g("moving",v(e,t,i,n)),a||l},r.scaleOrSkewActionName=function(e,t,i){var n=e[i.canvas.altActionKey];return 0===t.x?n?"skewX":"scaleY":0===t.y?n?"skewY":"scaleX":void 0},r.rotationStyleHandler=function(e,t,i){return i.lockRotation?"not-allowed":t.cursorStyle},r.fireEvent=g,r.wrapWithFixedAnchor=y,r.wrapWithFireEvent=w,r.getLocalPoint=b,t.controlsUtils=r}(t),function(e){var t=e.fabric||(e.fabric={}),i=t.util.degreesToRadians,n=t.controlsUtils;n.renderCircleControl=function(e,t,i,n,r){n=n||{};var s,o=this.sizeX||n.cornerSize||r.cornerSize,a=this.sizeY||n.cornerSize||r.cornerSize,l=void 0!==n.transparentCorners?n.transparentCorners:r.transparentCorners,c=l?"stroke":"fill",h=!l&&(n.cornerStrokeColor||r.cornerStrokeColor),u=t,d=i;e.save(),e.fillStyle=n.cornerColor||r.cornerColor,e.strokeStyle=n.cornerStrokeColor||r.cornerStrokeColor,o>a?(s=o,e.scale(1,a/o),d=i*o/a):a>o?(s=a,e.scale(o/a,1),u=t*a/o):s=o,e.lineWidth=1,e.beginPath(),e.arc(u,d,s/2,0,2*Math.PI,!1),e[c](),h&&e.stroke(),e.restore()},n.renderSquareControl=function(e,t,n,r,s){r=r||{};var o=this.sizeX||r.cornerSize||s.cornerSize,a=this.sizeY||r.cornerSize||s.cornerSize,l=void 0!==r.transparentCorners?r.transparentCorners:s.transparentCorners,c=l?"stroke":"fill",h=!l&&(r.cornerStrokeColor||s.cornerStrokeColor),u=o/2,d=a/2;e.save(),e.fillStyle=r.cornerColor||s.cornerColor,e.strokeStyle=r.cornerStrokeColor||s.cornerStrokeColor,e.lineWidth=1,e.translate(t,n),e.rotate(i(s.angle)),e[c+"Rect"](-u,-d,o,a),h&&e.strokeRect(-u,-d,o,a),e.restore()}}(t),function(e){var t=e.fabric||(e.fabric={});t.Control=function(e){for(var t in e)this[t]=e[t]},t.Control.prototype={visible:!0,actionName:"scale",angle:0,x:0,y:0,offsetX:0,offsetY:0,sizeX:null,sizeY:null,touchSizeX:null,touchSizeY:null,cursorStyle:"crosshair",withConnection:!1,actionHandler:function(){},mouseDownHandler:function(){},mouseUpHandler:function(){},getActionHandler:function(){return this.actionHandler},getMouseDownHandler:function(){return this.mouseDownHandler},getMouseUpHandler:function(){return this.mouseUpHandler},cursorStyleHandler:function(e,t){return t.cursorStyle},getActionName:function(e,t){return t.actionName},getVisibility:function(e,t){var i=e._controlsVisibility;return i&&void 0!==i[t]?i[t]:this.visible},setVisibility:function(e){this.visible=e},positionHandler:function(e,i){return t.util.transformPoint({x:this.x*e.x+this.offsetX,y:this.y*e.y+this.offsetY},i)},calcCornerCoords:function(e,i,n,r,s){var o,a,l,c,h=s?this.touchSizeX:this.sizeX,u=s?this.touchSizeY:this.sizeY;if(h&&u&&h!==u){var d=Math.atan2(u,h),f=Math.sqrt(h*h+u*u)/2,g=d-t.util.degreesToRadians(e),p=Math.PI/2-d-t.util.degreesToRadians(e);o=f*t.util.cos(g),a=f*t.util.sin(g),l=f*t.util.cos(p),c=f*t.util.sin(p)}else f=.7071067812*(h&&u?h:i),g=t.util.degreesToRadians(45-e),o=l=f*t.util.cos(g),a=c=f*t.util.sin(g);return{tl:{x:n-c,y:r-l},tr:{x:n+o,y:r-a},bl:{x:n-o,y:r+a},br:{x:n+c,y:r+l}}},render:function(e,i,n,r,s){"circle"===((r=r||{}).cornerStyle||s.cornerStyle)?t.controlsUtils.renderCircleControl.call(this,e,i,n,r,s):t.controlsUtils.renderSquareControl.call(this,e,i,n,r,s)}}}(t),function(){function e(e,t){var i,n,r,s,o=e.getAttribute("style"),a=e.getAttribute("offset")||0;if(a=(a=parseFloat(a)/(/%$/.test(a)?100:1))<0?0:a>1?1:a,o){var l=o.split(/\s*;\s*/);for(""===l[l.length-1]&&l.pop(),s=l.length;s--;){var c=l[s].split(/\s*:\s*/),h=c[0].trim(),u=c[1].trim();"stop-color"===h?i=u:"stop-opacity"===h&&(r=u)}}return i||(i=e.getAttribute("stop-color")||"rgb(0,0,0)"),r||(r=e.getAttribute("stop-opacity")),n=(i=new E.Color(i)).getAlpha(),r=isNaN(parseFloat(r))?1:parseFloat(r),r*=n*t,{offset:a,color:i.toRgb(),opacity:r}}var t=E.util.object.clone;E.Gradient=E.util.createClass({offsetX:0,offsetY:0,gradientTransform:null,gradientUnits:"pixels",type:"linear",initialize:function(e){e||(e={}),e.coords||(e.coords={});var t,i=this;Object.keys(e).forEach((function(t){i[t]=e[t]})),this.id?this.id+="_"+E.Object.__uid++:this.id=E.Object.__uid++,t={x1:e.coords.x1||0,y1:e.coords.y1||0,x2:e.coords.x2||0,y2:e.coords.y2||0},"radial"===this.type&&(t.r1=e.coords.r1||0,t.r2=e.coords.r2||0),this.coords=t,this.colorStops=e.colorStops.slice()},addColorStop:function(e){for(var t in e){var i=new E.Color(e[t]);this.colorStops.push({offset:parseFloat(t),color:i.toRgb(),opacity:i.getAlpha()})}return this},toObject:function(e){var t={type:this.type,coords:this.coords,colorStops:this.colorStops,offsetX:this.offsetX,offsetY:this.offsetY,gradientUnits:this.gradientUnits,gradientTransform:this.gradientTransform?this.gradientTransform.concat():this.gradientTransform};return E.util.populateWithProperties(this,t,e),t},toSVG:function(e,i){var n,r,s,o,a=t(this.coords,!0),l=(i=i||{},t(this.colorStops,!0)),c=a.r1>a.r2,h=this.gradientTransform?this.gradientTransform.concat():E.iMatrix.concat(),u=-this.offsetX,d=-this.offsetY,f=!!i.additionalTransform,g="pixels"===this.gradientUnits?"userSpaceOnUse":"objectBoundingBox";if(l.sort((function(e,t){return e.offset-t.offset})),"objectBoundingBox"===g?(u/=e.width,d/=e.height):(u+=e.width/2,d+=e.height/2),"path"===e.type&&"percentage"!==this.gradientUnits&&(u-=e.pathOffset.x,d-=e.pathOffset.y),h[4]-=u,h[5]-=d,o='id="SVGID_'+this.id+'" gradientUnits="'+g+'"',o+=' gradientTransform="'+(f?i.additionalTransform+" ":"")+E.util.matrixToSVG(h)+'" ',"linear"===this.type?s=["<linearGradient ",o,' x1="',a.x1,'" y1="',a.y1,'" x2="',a.x2,'" y2="',a.y2,'">\n']:"radial"===this.type&&(s=["<radialGradient ",o,' cx="',c?a.x1:a.x2,'" cy="',c?a.y1:a.y2,'" r="',c?a.r1:a.r2,'" fx="',c?a.x2:a.x1,'" fy="',c?a.y2:a.y1,'">\n']),"radial"===this.type){if(c)for((l=l.concat()).reverse(),n=0,r=l.length;n<r;n++)l[n].offset=1-l[n].offset;var p=Math.min(a.r1,a.r2);if(p>0){var m=p/Math.max(a.r1,a.r2);for(n=0,r=l.length;n<r;n++)l[n].offset+=m*(1-l[n].offset)}}for(n=0,r=l.length;n<r;n++){var _=l[n];s.push("<stop ",'offset="',100*_.offset+"%",'" style="stop-color:',_.color,void 0!==_.opacity?";stop-opacity: "+_.opacity:";",'"/>\n')}return s.push("linear"===this.type?"</linearGradient>\n":"</radialGradient>\n"),s.join("")},toLive:function(e){var t,i,n,r=E.util.object.clone(this.coords);if(this.type){for("linear"===this.type?t=e.createLinearGradient(r.x1,r.y1,r.x2,r.y2):"radial"===this.type&&(t=e.createRadialGradient(r.x1,r.y1,r.r1,r.x2,r.y2,r.r2)),i=0,n=this.colorStops.length;i<n;i++){var s=this.colorStops[i].color,o=this.colorStops[i].opacity,a=this.colorStops[i].offset;void 0!==o&&(s=new E.Color(s).setAlpha(o).toRgba()),t.addColorStop(a,s)}return t}}}),E.util.object.extend(E.Gradient,{fromElement:function(t,i,n,r){var s=parseFloat(n)/(/%$/.test(n)?100:1);s=s<0?0:s>1?1:s,isNaN(s)&&(s=1);var o,a,l,c,h=t.getElementsByTagName("stop"),u="userSpaceOnUse"===t.getAttribute("gradientUnits")?"pixels":"percentage",d=t.getAttribute("gradientTransform")||"",f=[],g=0,p=0;for("linearGradient"===t.nodeName||"LINEARGRADIENT"===t.nodeName?(o="linear",a=function(e){return{x1:e.getAttribute("x1")||0,y1:e.getAttribute("y1")||0,x2:e.getAttribute("x2")||"100%",y2:e.getAttribute("y2")||0}}(t)):(o="radial",a=function(e){return{x1:e.getAttribute("fx")||e.getAttribute("cx")||"50%",y1:e.getAttribute("fy")||e.getAttribute("cy")||"50%",r1:0,x2:e.getAttribute("cx")||"50%",y2:e.getAttribute("cy")||"50%",r2:e.getAttribute("r")||"50%"}}(t)),l=h.length;l--;)f.push(e(h[l],s));return c=E.parseTransformAttribute(d),function(e,t,i,n){var r,s;Object.keys(t).forEach((function(e){"Infinity"===(r=t[e])?s=1:"-Infinity"===r?s=0:(s=parseFloat(t[e],10),"string"==typeof r&&/^(\d+\.\d+)%|(\d+)%$/.test(r)&&(s*=.01,"pixels"===n&&("x1"!==e&&"x2"!==e&&"r2"!==e||(s*=i.viewBoxWidth||i.width),"y1"!==e&&"y2"!==e||(s*=i.viewBoxHeight||i.height)))),t[e]=s}))}(0,a,r,u),"pixels"===u&&(g=-i.left,p=-i.top),new E.Gradient({id:t.getAttribute("id"),type:o,coords:a,colorStops:f,gradientUnits:u,gradientTransform:c,offsetX:g,offsetY:p})}})}(),_=E.util.toFixed,E.Pattern=E.util.createClass({repeat:"repeat",offsetX:0,offsetY:0,crossOrigin:"",patternTransform:null,initialize:function(e,t){if(e||(e={}),this.id=E.Object.__uid++,this.setOptions(e),!e.source||e.source&&"string"!=typeof e.source)t&&t(this);else{var i=this;this.source=E.util.createImage(),E.util.loadImage(e.source,(function(e,n){i.source=e,t&&t(i,n)}),null,this.crossOrigin)}},toObject:function(e){var t,i,n=E.Object.NUM_FRACTION_DIGITS;return"string"==typeof this.source.src?t=this.source.src:"object"==typeof this.source&&this.source.toDataURL&&(t=this.source.toDataURL()),i={type:"pattern",source:t,repeat:this.repeat,crossOrigin:this.crossOrigin,offsetX:_(this.offsetX,n),offsetY:_(this.offsetY,n),patternTransform:this.patternTransform?this.patternTransform.concat():null},E.util.populateWithProperties(this,i,e),i},toSVG:function(e){var t="function"==typeof this.source?this.source():this.source,i=t.width/e.width,n=t.height/e.height,r=this.offsetX/e.width,s=this.offsetY/e.height,o="";return"repeat-x"!==this.repeat&&"no-repeat"!==this.repeat||(n=1,s&&(n+=Math.abs(s))),"repeat-y"!==this.repeat&&"no-repeat"!==this.repeat||(i=1,r&&(i+=Math.abs(r))),t.src?o=t.src:t.toDataURL&&(o=t.toDataURL()),'<pattern id="SVGID_'+this.id+'" x="'+r+'" y="'+s+'" width="'+i+'" height="'+n+'">\n<image x="0" y="0" width="'+t.width+'" height="'+t.height+'" xlink:href="'+o+'"></image>\n</pattern>\n'},setOptions:function(e){for(var t in e)this[t]=e[t]},toLive:function(e){var t=this.source;if(!t)return"";if(void 0!==t.src){if(!t.complete)return"";if(0===t.naturalWidth||0===t.naturalHeight)return""}return e.createPattern(t,this.repeat)}}),function(e){var t=e.fabric||(e.fabric={}),i=t.util.toFixed;t.Shadow?t.warn("fabric.Shadow is already defined."):(t.Shadow=t.util.createClass({color:"rgb(0,0,0)",blur:0,offsetX:0,offsetY:0,affectStroke:!1,includeDefaultValues:!0,nonScaling:!1,initialize:function(e){for(var i in"string"==typeof e&&(e=this._parseShadow(e)),e)this[i]=e[i];this.id=t.Object.__uid++},_parseShadow:function(e){var i=e.trim(),n=t.Shadow.reOffsetsAndBlur.exec(i)||[];return{color:(i.replace(t.Shadow.reOffsetsAndBlur,"")||"rgb(0,0,0)").trim(),offsetX:parseFloat(n[1],10)||0,offsetY:parseFloat(n[2],10)||0,blur:parseFloat(n[3],10)||0}},toString:function(){return[this.offsetX,this.offsetY,this.blur,this.color].join("px ")},toSVG:function(e){var n=40,r=40,s=t.Object.NUM_FRACTION_DIGITS,o=t.util.rotateVector({x:this.offsetX,y:this.offsetY},t.util.degreesToRadians(-e.angle)),a=new t.Color(this.color);return e.width&&e.height&&(n=100*i((Math.abs(o.x)+this.blur)/e.width,s)+20,r=100*i((Math.abs(o.y)+this.blur)/e.height,s)+20),e.flipX&&(o.x*=-1),e.flipY&&(o.y*=-1),'<filter id="SVGID_'+this.id+'" y="-'+r+'%" height="'+(100+2*r)+'%" x="-'+n+'%" width="'+(100+2*n)+'%" >\n\t<feGaussianBlur in="SourceAlpha" stdDeviation="'+i(this.blur?this.blur/2:0,s)+'"></feGaussianBlur>\n\t<feOffset dx="'+i(o.x,s)+'" dy="'+i(o.y,s)+'" result="oBlur" ></feOffset>\n\t<feFlood flood-color="'+a.toRgb()+'" flood-opacity="'+a.getAlpha()+'"/>\n\t<feComposite in2="oBlur" operator="in" />\n\t<feMerge>\n\t\t<feMergeNode></feMergeNode>\n\t\t<feMergeNode in="SourceGraphic"></feMergeNode>\n\t</feMerge>\n</filter>\n'},toObject:function(){if(this.includeDefaultValues)return{color:this.color,blur:this.blur,offsetX:this.offsetX,offsetY:this.offsetY,affectStroke:this.affectStroke,nonScaling:this.nonScaling};var e={},i=t.Shadow.prototype;return["color","blur","offsetX","offsetY","affectStroke","nonScaling"].forEach((function(t){this[t]!==i[t]&&(e[t]=this[t])}),this),e}}),t.Shadow.reOffsetsAndBlur=/(?:\s|^)(-?\d+(?:\.\d*)?(?:px)?(?:\s?|$))?(-?\d+(?:\.\d*)?(?:px)?(?:\s?|$))?(\d+(?:\.\d*)?(?:px)?)?(?:\s?|$)(?:$|\s)/)}(t),function(){if(E.StaticCanvas)E.warn("fabric.StaticCanvas is already defined.");else{var e=E.util.object.extend,t=E.util.getElementOffset,i=E.util.removeFromArray,n=E.util.toFixed,r=E.util.transformPoint,s=E.util.invertTransform,o=E.util.getNodeCanvas,a=E.util.createCanvasElement,l=new Error("Could not initialize `canvas` element");E.StaticCanvas=E.util.createClass(E.CommonMethods,{initialize:function(e,t){t||(t={}),this.renderAndResetBound=this.renderAndReset.bind(this),this.requestRenderAllBound=this.requestRenderAll.bind(this),this._initStatic(e,t)},backgroundColor:"",backgroundImage:null,overlayColor:"",overlayImage:null,includeDefaultValues:!0,stateful:!1,renderOnAddRemove:!0,controlsAboveOverlay:!1,allowTouchScrolling:!1,imageSmoothingEnabled:!0,viewportTransform:E.iMatrix.concat(),backgroundVpt:!0,overlayVpt:!0,enableRetinaScaling:!0,vptCoords:{},skipOffscreen:!0,clipPath:void 0,_initStatic:function(e,t){var i=this.requestRenderAllBound;this._objects=[],this._createLowerCanvas(e),this._initOptions(t),this.interactive||this._initRetinaScaling(),t.overlayImage&&this.setOverlayImage(t.overlayImage,i),t.backgroundImage&&this.setBackgroundImage(t.backgroundImage,i),t.backgroundColor&&this.setBackgroundColor(t.backgroundColor,i),t.overlayColor&&this.setOverlayColor(t.overlayColor,i),this.calcOffset()},_isRetinaScaling:function(){return E.devicePixelRatio>1&&this.enableRetinaScaling},getRetinaScaling:function(){return this._isRetinaScaling()?Math.max(1,E.devicePixelRatio):1},_initRetinaScaling:function(){if(this._isRetinaScaling()){var e=E.devicePixelRatio;this.__initRetinaScaling(e,this.lowerCanvasEl,this.contextContainer),this.upperCanvasEl&&this.__initRetinaScaling(e,this.upperCanvasEl,this.contextTop)}},__initRetinaScaling:function(e,t,i){t.setAttribute("width",this.width*e),t.setAttribute("height",this.height*e),i.scale(e,e)},calcOffset:function(){return this._offset=t(this.lowerCanvasEl),this},setOverlayImage:function(e,t,i){return this.__setBgOverlayImage("overlayImage",e,t,i)},setBackgroundImage:function(e,t,i){return this.__setBgOverlayImage("backgroundImage",e,t,i)},setOverlayColor:function(e,t){return this.__setBgOverlayColor("overlayColor",e,t)},setBackgroundColor:function(e,t){return this.__setBgOverlayColor("backgroundColor",e,t)},__setBgOverlayImage:function(e,t,i,n){return"string"==typeof t?E.util.loadImage(t,(function(t,r){if(t){var s=new E.Image(t,n);this[e]=s,s.canvas=this}i&&i(t,r)}),this,n&&n.crossOrigin):(n&&t.setOptions(n),this[e]=t,t&&(t.canvas=this),i&&i(t,!1)),this},__setBgOverlayColor:function(e,t,i){return this[e]=t,this._initGradient(t,e),this._initPattern(t,e,i),this},_createCanvasElement:function(){var e=a();if(!e)throw l;if(e.style||(e.style={}),void 0===e.getContext)throw l;return e},_initOptions:function(e){var t=this.lowerCanvasEl;this._setOptions(e),this.width=this.width||parseInt(t.width,10)||0,this.height=this.height||parseInt(t.height,10)||0,this.lowerCanvasEl.style&&(t.width=this.width,t.height=this.height,t.style.width=this.width+"px",t.style.height=this.height+"px",this.viewportTransform=this.viewportTransform.slice())},_createLowerCanvas:function(e){e&&e.getContext?this.lowerCanvasEl=e:this.lowerCanvasEl=E.util.getById(e)||this._createCanvasElement(),E.util.addClass(this.lowerCanvasEl,"lower-canvas"),this._originalCanvasStyle=this.lowerCanvasEl.style,this.interactive&&this._applyCanvasStyle(this.lowerCanvasEl),this.contextContainer=this.lowerCanvasEl.getContext("2d")},getWidth:function(){return this.width},getHeight:function(){return this.height},setWidth:function(e,t){return this.setDimensions({width:e},t)},setHeight:function(e,t){return this.setDimensions({height:e},t)},setDimensions:function(e,t){var i;for(var n in t=t||{},e)i=e[n],t.cssOnly||(this._setBackstoreDimension(n,e[n]),i+="px",this.hasLostContext=!0),t.backstoreOnly||this._setCssDimension(n,i);return this._isCurrentlyDrawing&&this.freeDrawingBrush&&this.freeDrawingBrush._setBrushStyles(this.contextTop),this._initRetinaScaling(),this.calcOffset(),t.cssOnly||this.requestRenderAll(),this},_setBackstoreDimension:function(e,t){return this.lowerCanvasEl[e]=t,this.upperCanvasEl&&(this.upperCanvasEl[e]=t),this.cacheCanvasEl&&(this.cacheCanvasEl[e]=t),this[e]=t,this},_setCssDimension:function(e,t){return this.lowerCanvasEl.style[e]=t,this.upperCanvasEl&&(this.upperCanvasEl.style[e]=t),this.wrapperEl&&(this.wrapperEl.style[e]=t),this},getZoom:function(){return this.viewportTransform[0]},setViewportTransform:function(e){var t,i,n,r=this._activeObject,s=this.backgroundImage,o=this.overlayImage;for(this.viewportTransform=e,i=0,n=this._objects.length;i<n;i++)(t=this._objects[i]).group||t.setCoords(!0);return r&&r.setCoords(),s&&s.setCoords(!0),o&&o.setCoords(!0),this.calcViewportBoundaries(),this.renderOnAddRemove&&this.requestRenderAll(),this},zoomToPoint:function(e,t){var i=e,n=this.viewportTransform.slice(0);e=r(e,s(this.viewportTransform)),n[0]=t,n[3]=t;var o=r(e,n);return n[4]+=i.x-o.x,n[5]+=i.y-o.y,this.setViewportTransform(n)},setZoom:function(e){return this.zoomToPoint(new E.Point(0,0),e),this},absolutePan:function(e){var t=this.viewportTransform.slice(0);return t[4]=-e.x,t[5]=-e.y,this.setViewportTransform(t)},relativePan:function(e){return this.absolutePan(new E.Point(-e.x-this.viewportTransform[4],-e.y-this.viewportTransform[5]))},getElement:function(){return this.lowerCanvasEl},_onObjectAdded:function(e){this.stateful&&e.setupState(),e._set("canvas",this),e.setCoords(),this.fire("object:added",{target:e}),e.fire("added")},_onObjectRemoved:function(e){this.fire("object:removed",{target:e}),e.fire("removed"),delete e.canvas},clearContext:function(e){return e.clearRect(0,0,this.width,this.height),this},getContext:function(){return this.contextContainer},clear:function(){return this.remove.apply(this,this.getObjects()),this.backgroundImage=null,this.overlayImage=null,this.backgroundColor="",this.overlayColor="",this._hasITextHandlers&&(this.off("mouse:up",this._mouseUpITextHandler),this._iTextInstances=null,this._hasITextHandlers=!1),this.clearContext(this.contextContainer),this.fire("canvas:cleared"),this.renderOnAddRemove&&this.requestRenderAll(),this},renderAll:function(){var e=this.contextContainer;return this.renderCanvas(e,this._objects),this},renderAndReset:function(){this.isRendering=0,this.renderAll()},requestRenderAll:function(){return this.isRendering||(this.isRendering=E.util.requestAnimFrame(this.renderAndResetBound)),this},calcViewportBoundaries:function(){var e={},t=this.width,i=this.height,n=s(this.viewportTransform);return e.tl=r({x:0,y:0},n),e.br=r({x:t,y:i},n),e.tr=new E.Point(e.br.x,e.tl.y),e.bl=new E.Point(e.tl.x,e.br.y),this.vptCoords=e,e},cancelRequestedRender:function(){this.isRendering&&(E.util.cancelAnimFrame(this.isRendering),this.isRendering=0)},renderCanvas:function(e,t){var i=this.viewportTransform,n=this.clipPath;this.cancelRequestedRender(),this.calcViewportBoundaries(),this.clearContext(e),E.util.setImageSmoothing(e,this.imageSmoothingEnabled),this.fire("before:render",{ctx:e}),this._renderBackground(e),e.save(),e.transform(i[0],i[1],i[2],i[3],i[4],i[5]),this._renderObjects(e,t),e.restore(),!this.controlsAboveOverlay&&this.interactive&&this.drawControls(e),n&&(n.canvas=this,n.shouldCache(),n._transformDone=!0,n.renderCache({forClipping:!0}),this.drawClipPathOnCanvas(e)),this._renderOverlay(e),this.controlsAboveOverlay&&this.interactive&&this.drawControls(e),this.fire("after:render",{ctx:e})},drawClipPathOnCanvas:function(e){var t=this.viewportTransform,i=this.clipPath;e.save(),e.transform(t[0],t[1],t[2],t[3],t[4],t[5]),e.globalCompositeOperation="destination-in",i.transform(e),e.scale(1/i.zoomX,1/i.zoomY),e.drawImage(i._cacheCanvas,-i.cacheTranslationX,-i.cacheTranslationY),e.restore()},_renderObjects:function(e,t){var i,n;for(i=0,n=t.length;i<n;++i)t[i]&&t[i].render(e)},_renderBackgroundOrOverlay:function(e,t){var i=this[t+"Color"],n=this[t+"Image"],r=this.viewportTransform,s=this[t+"Vpt"];if(i||n){if(i){e.save(),e.beginPath(),e.moveTo(0,0),e.lineTo(this.width,0),e.lineTo(this.width,this.height),e.lineTo(0,this.height),e.closePath(),e.fillStyle=i.toLive?i.toLive(e,this):i,s&&e.transform(r[0],r[1],r[2],r[3],r[4],r[5]),e.transform(1,0,0,1,i.offsetX||0,i.offsetY||0);var o=i.gradientTransform||i.patternTransform;o&&e.transform(o[0],o[1],o[2],o[3],o[4],o[5]),e.fill(),e.restore()}n&&(e.save(),s&&e.transform(r[0],r[1],r[2],r[3],r[4],r[5]),n.render(e),e.restore())}},_renderBackground:function(e){this._renderBackgroundOrOverlay(e,"background")},_renderOverlay:function(e){this._renderBackgroundOrOverlay(e,"overlay")},getCenter:function(){return{top:this.height/2,left:this.width/2}},getCenterPoint:function(){return new E.Point(this.width/2,this.height/2)},centerObjectH:function(e){return this._centerObject(e,new E.Point(this.getCenterPoint().x,e.getCenterPoint().y))},centerObjectV:function(e){return this._centerObject(e,new E.Point(e.getCenterPoint().x,this.getCenterPoint().y))},centerObject:function(e){var t=this.getCenterPoint();return this._centerObject(e,t)},viewportCenterObject:function(e){var t=this.getVpCenter();return this._centerObject(e,t)},viewportCenterObjectH:function(e){var t=this.getVpCenter();return this._centerObject(e,new E.Point(t.x,e.getCenterPoint().y)),this},viewportCenterObjectV:function(e){var t=this.getVpCenter();return this._centerObject(e,new E.Point(e.getCenterPoint().x,t.y))},getVpCenter:function(){var e=this.getCenterPoint(),t=s(this.viewportTransform);return r(e,t)},_centerObject:function(e,t){return e.setPositionByOrigin(t,"center","center"),e.setCoords(),this.renderOnAddRemove&&this.requestRenderAll(),this},toDatalessJSON:function(e){return this.toDatalessObject(e)},toObject:function(e){return this._toObjectMethod("toObject",e)},toDatalessObject:function(e){return this._toObjectMethod("toDatalessObject",e)},_toObjectMethod:function(t,i){var n=this.clipPath,r={version:E.version,objects:this._toObjects(t,i)};return n&&!n.excludeFromExport&&(r.clipPath=this._toObject(this.clipPath,t,i)),e(r,this.__serializeBgOverlay(t,i)),E.util.populateWithProperties(this,r,i),r},_toObjects:function(e,t){return this._objects.filter((function(e){return!e.excludeFromExport})).map((function(i){return this._toObject(i,e,t)}),this)},_toObject:function(e,t,i){var n;this.includeDefaultValues||(n=e.includeDefaultValues,e.includeDefaultValues=!1);var r=e[t](i);return this.includeDefaultValues||(e.includeDefaultValues=n),r},__serializeBgOverlay:function(e,t){var i={},n=this.backgroundImage,r=this.overlayImage,s=this.backgroundColor,o=this.overlayColor;return s&&s.toObject?s.excludeFromExport||(i.background=s.toObject(t)):s&&(i.background=s),o&&o.toObject?o.excludeFromExport||(i.overlay=o.toObject(t)):o&&(i.overlay=o),n&&!n.excludeFromExport&&(i.backgroundImage=this._toObject(n,e,t)),r&&!r.excludeFromExport&&(i.overlayImage=this._toObject(r,e,t)),i},svgViewportTransformation:!0,toSVG:function(e,t){e||(e={}),e.reviver=t;var i=[];return this._setSVGPreamble(i,e),this._setSVGHeader(i,e),this.clipPath&&i.push('<g clip-path="url(#'+this.clipPath.clipPathId+')" >\n'),this._setSVGBgOverlayColor(i,"background"),this._setSVGBgOverlayImage(i,"backgroundImage",t),this._setSVGObjects(i,t),this.clipPath&&i.push("</g>\n"),this._setSVGBgOverlayColor(i,"overlay"),this._setSVGBgOverlayImage(i,"overlayImage",t),i.push("</svg>"),i.join("")},_setSVGPreamble:function(e,t){t.suppressPreamble||e.push('<?xml version="1.0" encoding="',t.encoding||"UTF-8",'" standalone="no" ?>\n','<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN" ','"http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">\n')},_setSVGHeader:function(e,t){var i,r=t.width||this.width,s=t.height||this.height,o='viewBox="0 0 '+this.width+" "+this.height+'" ',a=E.Object.NUM_FRACTION_DIGITS;t.viewBox?o='viewBox="'+t.viewBox.x+" "+t.viewBox.y+" "+t.viewBox.width+" "+t.viewBox.height+'" ':this.svgViewportTransformation&&(i=this.viewportTransform,o='viewBox="'+n(-i[4]/i[0],a)+" "+n(-i[5]/i[3],a)+" "+n(this.width/i[0],a)+" "+n(this.height/i[3],a)+'" '),e.push("<svg ",'xmlns="http://www.w3.org/2000/svg" ','xmlns:xlink="http://www.w3.org/1999/xlink" ','version="1.1" ','width="',r,'" ','height="',s,'" ',o,'xml:space="preserve">\n',"<desc>Created with Fabric.js ",E.version,"</desc>\n","<defs>\n",this.createSVGFontFacesMarkup(),this.createSVGRefElementsMarkup(),this.createSVGClipPathMarkup(t),"</defs>\n")},createSVGClipPathMarkup:function(e){var t=this.clipPath;return t?(t.clipPathId="CLIPPATH_"+E.Object.__uid++,'<clipPath id="'+t.clipPathId+'" >\n'+this.clipPath.toClipPathSVG(e.reviver)+"</clipPath>\n"):""},createSVGRefElementsMarkup:function(){var e=this;return["background","overlay"].map((function(t){var i=e[t+"Color"];if(i&&i.toLive){var n=e[t+"Vpt"],r=e.viewportTransform,s={width:e.width/(n?r[0]:1),height:e.height/(n?r[3]:1)};return i.toSVG(s,{additionalTransform:n?E.util.matrixToSVG(r):""})}})).join("")},createSVGFontFacesMarkup:function(){var e,t,i,n,r,s,o,a,l="",c={},h=E.fontPaths,u=[];for(this._objects.forEach((function e(t){u.push(t),t._objects&&t._objects.forEach(e)})),o=0,a=u.length;o<a;o++)if(t=(e=u[o]).fontFamily,-1!==e.type.indexOf("text")&&!c[t]&&h[t]&&(c[t]=!0,e.styles))for(r in i=e.styles)for(s in n=i[r])!c[t=n[s].fontFamily]&&h[t]&&(c[t]=!0);for(var d in c)l+=["\t\t@font-face {\n","\t\t\tfont-family: '",d,"';\n","\t\t\tsrc: url('",h[d],"');\n","\t\t}\n"].join("");return l&&(l=['\t<style type="text/css">',"<![CDATA[\n",l,"]]>","</style>\n"].join("")),l},_setSVGObjects:function(e,t){var i,n,r,s=this._objects;for(n=0,r=s.length;n<r;n++)(i=s[n]).excludeFromExport||this._setSVGObject(e,i,t)},_setSVGObject:function(e,t,i){e.push(t.toSVG(i))},_setSVGBgOverlayImage:function(e,t,i){this[t]&&!this[t].excludeFromExport&&this[t].toSVG&&e.push(this[t].toSVG(i))},_setSVGBgOverlayColor:function(e,t){var i=this[t+"Color"],n=this.viewportTransform,r=this.width,s=this.height;if(i)if(i.toLive){var o=i.repeat,a=E.util.invertTransform(n),l=this[t+"Vpt"]?E.util.matrixToSVG(a):"";e.push('<rect transform="'+l+" translate(",r/2,",",s/2,')"',' x="',i.offsetX-r/2,'" y="',i.offsetY-s/2,'" ','width="',"repeat-y"===o||"no-repeat"===o?i.source.width:r,'" height="',"repeat-x"===o||"no-repeat"===o?i.source.height:s,'" fill="url(#SVGID_'+i.id+')"',"></rect>\n")}else e.push('<rect x="0" y="0" width="100%" height="100%" ','fill="',i,'"',"></rect>\n")},sendToBack:function(e){if(!e)return this;var t,n,r,s=this._activeObject;if(e===s&&"activeSelection"===e.type)for(t=(r=s._objects).length;t--;)n=r[t],i(this._objects,n),this._objects.unshift(n);else i(this._objects,e),this._objects.unshift(e);return this.renderOnAddRemove&&this.requestRenderAll(),this},bringToFront:function(e){if(!e)return this;var t,n,r,s=this._activeObject;if(e===s&&"activeSelection"===e.type)for(r=s._objects,t=0;t<r.length;t++)n=r[t],i(this._objects,n),this._objects.push(n);else i(this._objects,e),this._objects.push(e);return this.renderOnAddRemove&&this.requestRenderAll(),this},sendBackwards:function(e,t){if(!e)return this;var n,r,s,o,a,l=this._activeObject,c=0;if(e===l&&"activeSelection"===e.type)for(a=l._objects,n=0;n<a.length;n++)r=a[n],(s=this._objects.indexOf(r))>0+c&&(o=s-1,i(this._objects,r),this._objects.splice(o,0,r)),c++;else 0!==(s=this._objects.indexOf(e))&&(o=this._findNewLowerIndex(e,s,t),i(this._objects,e),this._objects.splice(o,0,e));return this.renderOnAddRemove&&this.requestRenderAll(),this},_findNewLowerIndex:function(e,t,i){var n,r;if(i){for(n=t,r=t-1;r>=0;--r)if(e.intersectsWithObject(this._objects[r])||e.isContainedWithinObject(this._objects[r])||this._objects[r].isContainedWithinObject(e)){n=r;break}}else n=t-1;return n},bringForward:function(e,t){if(!e)return this;var n,r,s,o,a,l=this._activeObject,c=0;if(e===l&&"activeSelection"===e.type)for(n=(a=l._objects).length;n--;)r=a[n],(s=this._objects.indexOf(r))<this._objects.length-1-c&&(o=s+1,i(this._objects,r),this._objects.splice(o,0,r)),c++;else(s=this._objects.indexOf(e))!==this._objects.length-1&&(o=this._findNewUpperIndex(e,s,t),i(this._objects,e),this._objects.splice(o,0,e));return this.renderOnAddRemove&&this.requestRenderAll(),this},_findNewUpperIndex:function(e,t,i){var n,r,s;if(i){for(n=t,r=t+1,s=this._objects.length;r<s;++r)if(e.intersectsWithObject(this._objects[r])||e.isContainedWithinObject(this._objects[r])||this._objects[r].isContainedWithinObject(e)){n=r;break}}else n=t+1;return n},moveTo:function(e,t){return i(this._objects,e),this._objects.splice(t,0,e),this.renderOnAddRemove&&this.requestRenderAll()},dispose:function(){return this.isRendering&&(E.util.cancelAnimFrame(this.isRendering),this.isRendering=0),this.forEachObject((function(e){e.dispose&&e.dispose()})),this._objects=[],this.backgroundImage&&this.backgroundImage.dispose&&this.backgroundImage.dispose(),this.backgroundImage=null,this.overlayImage&&this.overlayImage.dispose&&this.overlayImage.dispose(),this.overlayImage=null,this._iTextInstances=null,this.contextContainer=null,this.lowerCanvasEl.classList.remove("lower-canvas"),E.util.setStyle(this.lowerCanvasEl,this._originalCanvasStyle),delete this._originalCanvasStyle,this.lowerCanvasEl.setAttribute("width",this.width),this.lowerCanvasEl.setAttribute("height",this.height),E.util.cleanUpJsdomNode(this.lowerCanvasEl),this.lowerCanvasEl=void 0,this},toString:function(){return"#<fabric.Canvas ("+this.complexity()+"): { objects: "+this._objects.length+" }>"}}),e(E.StaticCanvas.prototype,E.Observable),e(E.StaticCanvas.prototype,E.Collection),e(E.StaticCanvas.prototype,E.DataURLExporter),e(E.StaticCanvas,{EMPTY_JSON:'{"objects": [], "background": "white"}',supports:function(e){var t=a();if(!t||!t.getContext)return null;var i=t.getContext("2d");return i&&"setLineDash"===e?void 0!==i.setLineDash:null}}),E.StaticCanvas.prototype.toJSON=E.StaticCanvas.prototype.toObject,E.isLikelyNode&&(E.StaticCanvas.prototype.createPNGStream=function(){var e=o(this.lowerCanvasEl);return e&&e.createPNGStream()},E.StaticCanvas.prototype.createJPEGStream=function(e){var t=o(this.lowerCanvasEl);return t&&t.createJPEGStream(e)})}}(),E.BaseBrush=E.util.createClass({color:"rgb(0, 0, 0)",width:1,shadow:null,strokeLineCap:"round",strokeLineJoin:"round",strokeMiterLimit:10,strokeDashArray:null,limitedToCanvasSize:!1,_setBrushStyles:function(e){e.strokeStyle=this.color,e.lineWidth=this.width,e.lineCap=this.strokeLineCap,e.miterLimit=this.strokeMiterLimit,e.lineJoin=this.strokeLineJoin,e.setLineDash(this.strokeDashArray||[])},_saveAndTransform:function(e){var t=this.canvas.viewportTransform;e.save(),e.transform(t[0],t[1],t[2],t[3],t[4],t[5])},_setShadow:function(){if(this.shadow){var e=this.canvas,t=this.shadow,i=e.contextTop,n=e.getZoom();e&&e._isRetinaScaling()&&(n*=E.devicePixelRatio),i.shadowColor=t.color,i.shadowBlur=t.blur*n,i.shadowOffsetX=t.offsetX*n,i.shadowOffsetY=t.offsetY*n}},needsFullRender:function(){return new E.Color(this.color).getAlpha()<1||!!this.shadow},_resetShadow:function(){var e=this.canvas.contextTop;e.shadowColor="",e.shadowBlur=e.shadowOffsetX=e.shadowOffsetY=0},_isOutSideCanvas:function(e){return e.x<0||e.x>this.canvas.getWidth()||e.y<0||e.y>this.canvas.getHeight()}}),E.PencilBrush=E.util.createClass(E.BaseBrush,{decimate:.4,drawStraightLine:!1,straightLineKey:"shiftKey",initialize:function(e){this.canvas=e,this._points=[]},needsFullRender:function(){return this.callSuper("needsFullRender")||this._hasStraightLine},_drawSegment:function(e,t,i){var n=t.midPointFrom(i);return e.quadraticCurveTo(t.x,t.y,n.x,n.y),n},onMouseDown:function(e,t){this.canvas._isMainEvent(t.e)&&(this.drawStraightLine=t.e[this.straightLineKey],this._prepareForDrawing(e),this._captureDrawingPath(e),this._render())},onMouseMove:function(e,t){if(this.canvas._isMainEvent(t.e)&&(this.drawStraightLine=t.e[this.straightLineKey],(!0!==this.limitedToCanvasSize||!this._isOutSideCanvas(e))&&this._captureDrawingPath(e)&&this._points.length>1))if(this.needsFullRender())this.canvas.clearContext(this.canvas.contextTop),this._render();else{var i=this._points,n=i.length,r=this.canvas.contextTop;this._saveAndTransform(r),this.oldEnd&&(r.beginPath(),r.moveTo(this.oldEnd.x,this.oldEnd.y)),this.oldEnd=this._drawSegment(r,i[n-2],i[n-1],!0),r.stroke(),r.restore()}},onMouseUp:function(e){return!this.canvas._isMainEvent(e.e)||(this.drawStraightLine=!1,this.oldEnd=void 0,this._finalizeAndAddPath(),!1)},_prepareForDrawing:function(e){var t=new E.Point(e.x,e.y);this._reset(),this._addPoint(t),this.canvas.contextTop.moveTo(t.x,t.y)},_addPoint:function(e){return!(this._points.length>1&&e.eq(this._points[this._points.length-1])||(this.drawStraightLine&&this._points.length>1&&(this._hasStraightLine=!0,this._points.pop()),this._points.push(e),0))},_reset:function(){this._points=[],this._setBrushStyles(this.canvas.contextTop),this._setShadow(),this._hasStraightLine=!1},_captureDrawingPath:function(e){var t=new E.Point(e.x,e.y);return this._addPoint(t)},_render:function(e){var t,i,n=this._points[0],r=this._points[1];if(e=e||this.canvas.contextTop,this._saveAndTransform(e),e.beginPath(),2===this._points.length&&n.x===r.x&&n.y===r.y){var s=this.width/1e3;n=new E.Point(n.x,n.y),r=new E.Point(r.x,r.y),n.x-=s,r.x+=s}for(e.moveTo(n.x,n.y),t=1,i=this._points.length;t<i;t++)this._drawSegment(e,n,r),n=this._points[t],r=this._points[t+1];e.lineTo(n.x,n.y),e.stroke(),e.restore()},convertPointsToSVGPath:function(e){var t=this.width/1e3;return E.util.getSmoothPathFromPoints(e,t)},_isEmptySVGPath:function(e){return"M 0 0 Q 0 0 0 0 L 0 0"===E.util.joinPath(e)},createPath:function(e){var t=new E.Path(e,{fill:null,stroke:this.color,strokeWidth:this.width,strokeLineCap:this.strokeLineCap,strokeMiterLimit:this.strokeMiterLimit,strokeLineJoin:this.strokeLineJoin,strokeDashArray:this.strokeDashArray});return this.shadow&&(this.shadow.affectStroke=!0,t.shadow=new E.Shadow(this.shadow)),t},decimatePoints:function(e,t){if(e.length<=2)return e;var i,n=this.canvas.getZoom(),r=Math.pow(t/n,2),s=e.length-1,o=e[0],a=[o];for(i=1;i<s-1;i++)Math.pow(o.x-e[i].x,2)+Math.pow(o.y-e[i].y,2)>=r&&(o=e[i],a.push(o));return a.push(e[s]),a},_finalizeAndAddPath:function(){this.canvas.contextTop.closePath(),this.decimate&&(this._points=this.decimatePoints(this._points,this.decimate));var e=this.convertPointsToSVGPath(this._points);if(this._isEmptySVGPath(e))this.canvas.requestRenderAll();else{var t=this.createPath(e);this.canvas.clearContext(this.canvas.contextTop),this.canvas.fire("before:path:created",{path:t}),this.canvas.add(t),this.canvas.requestRenderAll(),t.setCoords(),this._resetShadow(),this.canvas.fire("path:created",{path:t})}}}),E.CircleBrush=E.util.createClass(E.BaseBrush,{width:10,initialize:function(e){this.canvas=e,this.points=[]},drawDot:function(e){var t=this.addPoint(e),i=this.canvas.contextTop;this._saveAndTransform(i),this.dot(i,t),i.restore()},dot:function(e,t){e.fillStyle=t.fill,e.beginPath(),e.arc(t.x,t.y,t.radius,0,2*Math.PI,!1),e.closePath(),e.fill()},onMouseDown:function(e){this.points.length=0,this.canvas.clearContext(this.canvas.contextTop),this._setShadow(),this.drawDot(e)},_render:function(){var e,t,i=this.canvas.contextTop,n=this.points;for(this._saveAndTransform(i),e=0,t=n.length;e<t;e++)this.dot(i,n[e]);i.restore()},onMouseMove:function(e){!0===this.limitedToCanvasSize&&this._isOutSideCanvas(e)||(this.needsFullRender()?(this.canvas.clearContext(this.canvas.contextTop),this.addPoint(e),this._render()):this.drawDot(e))},onMouseUp:function(){var e,t,i=this.canvas.renderOnAddRemove;this.canvas.renderOnAddRemove=!1;var n=[];for(e=0,t=this.points.length;e<t;e++){var r=this.points[e],s=new E.Circle({radius:r.radius,left:r.x,top:r.y,originX:"center",originY:"center",fill:r.fill});this.shadow&&(s.shadow=new E.Shadow(this.shadow)),n.push(s)}var o=new E.Group(n);o.canvas=this.canvas,this.canvas.fire("before:path:created",{path:o}),this.canvas.add(o),this.canvas.fire("path:created",{path:o}),this.canvas.clearContext(this.canvas.contextTop),this._resetShadow(),this.canvas.renderOnAddRemove=i,this.canvas.requestRenderAll()},addPoint:function(e){var t=new E.Point(e.x,e.y),i=E.util.getRandomInt(Math.max(0,this.width-20),this.width+20)/2,n=new E.Color(this.color).setAlpha(E.util.getRandomInt(0,100)/100).toRgba();return t.radius=i,t.fill=n,this.points.push(t),t}}),E.SprayBrush=E.util.createClass(E.BaseBrush,{width:10,density:20,dotWidth:1,dotWidthVariance:1,randomOpacity:!1,optimizeOverlapping:!0,initialize:function(e){this.canvas=e,this.sprayChunks=[]},onMouseDown:function(e){this.sprayChunks.length=0,this.canvas.clearContext(this.canvas.contextTop),this._setShadow(),this.addSprayChunk(e),this.render(this.sprayChunkPoints)},onMouseMove:function(e){!0===this.limitedToCanvasSize&&this._isOutSideCanvas(e)||(this.addSprayChunk(e),this.render(this.sprayChunkPoints))},onMouseUp:function(){var e=this.canvas.renderOnAddRemove;this.canvas.renderOnAddRemove=!1;for(var t=[],i=0,n=this.sprayChunks.length;i<n;i++)for(var r=this.sprayChunks[i],s=0,o=r.length;s<o;s++){var a=new E.Rect({width:r[s].width,height:r[s].width,left:r[s].x+1,top:r[s].y+1,originX:"center",originY:"center",fill:this.color});t.push(a)}this.optimizeOverlapping&&(t=this._getOptimizedRects(t));var l=new E.Group(t);this.shadow&&l.set("shadow",new E.Shadow(this.shadow)),this.canvas.fire("before:path:created",{path:l}),this.canvas.add(l),this.canvas.fire("path:created",{path:l}),this.canvas.clearContext(this.canvas.contextTop),this._resetShadow(),this.canvas.renderOnAddRemove=e,this.canvas.requestRenderAll()},_getOptimizedRects:function(e){var t,i,n,r={};for(i=0,n=e.length;i<n;i++)r[t=e[i].left+""+e[i].top]||(r[t]=e[i]);var s=[];for(t in r)s.push(r[t]);return s},render:function(e){var t,i,n=this.canvas.contextTop;for(n.fillStyle=this.color,this._saveAndTransform(n),t=0,i=e.length;t<i;t++){var r=e[t];void 0!==r.opacity&&(n.globalAlpha=r.opacity),n.fillRect(r.x,r.y,r.width,r.width)}n.restore()},_render:function(){var e,t,i=this.canvas.contextTop;for(i.fillStyle=this.color,this._saveAndTransform(i),e=0,t=this.sprayChunks.length;e<t;e++)this.render(this.sprayChunks[e]);i.restore()},addSprayChunk:function(e){this.sprayChunkPoints=[];var t,i,n,r,s=this.width/2;for(r=0;r<this.density;r++){t=E.util.getRandomInt(e.x-s,e.x+s),i=E.util.getRandomInt(e.y-s,e.y+s),n=this.dotWidthVariance?E.util.getRandomInt(Math.max(1,this.dotWidth-this.dotWidthVariance),this.dotWidth+this.dotWidthVariance):this.dotWidth;var o=new E.Point(t,i);o.width=n,this.randomOpacity&&(o.opacity=E.util.getRandomInt(0,100)/100),this.sprayChunkPoints.push(o)}this.sprayChunks.push(this.sprayChunkPoints)}}),E.PatternBrush=E.util.createClass(E.PencilBrush,{getPatternSrc:function(){var e=E.util.createCanvasElement(),t=e.getContext("2d");return e.width=e.height=25,t.fillStyle=this.color,t.beginPath(),t.arc(10,10,10,0,2*Math.PI,!1),t.closePath(),t.fill(),e},getPatternSrcFunction:function(){return String(this.getPatternSrc).replace("this.color",'"'+this.color+'"')},getPattern:function(e){return e.createPattern(this.source||this.getPatternSrc(),"repeat")},_setBrushStyles:function(e){this.callSuper("_setBrushStyles",e),e.strokeStyle=this.getPattern(e)},createPath:function(e){var t=this.callSuper("createPath",e),i=t._getLeftTopCoords().scalarAdd(t.strokeWidth/2);return t.stroke=new E.Pattern({source:this.source||this.getPatternSrcFunction(),offsetX:-i.x,offsetY:-i.y}),t}}),function(){var e=E.util.getPointer,t=E.util.degreesToRadians,i=E.util.isTouchEvent;for(var n in E.Canvas=E.util.createClass(E.StaticCanvas,{initialize:function(e,t){t||(t={}),this.renderAndResetBound=this.renderAndReset.bind(this),this.requestRenderAllBound=this.requestRenderAll.bind(this),this._initStatic(e,t),this._initInteractive(),this._createCacheCanvas()},uniformScaling:!0,uniScaleKey:"shiftKey",centeredScaling:!1,centeredRotation:!1,centeredKey:"altKey",altActionKey:"shiftKey",interactive:!0,selection:!0,selectionKey:"shiftKey",altSelectionKey:null,selectionColor:"rgba(100, 100, 255, 0.3)",selectionDashArray:[],selectionBorderColor:"rgba(255, 255, 255, 0.3)",selectionLineWidth:1,selectionFullyContained:!1,hoverCursor:"move",moveCursor:"move",defaultCursor:"default",freeDrawingCursor:"crosshair",notAllowedCursor:"not-allowed",containerClass:"canvas-container",perPixelTargetFind:!1,targetFindTolerance:0,skipTargetFind:!1,isDrawingMode:!1,preserveObjectStacking:!1,snapAngle:0,snapThreshold:null,stopContextMenu:!1,fireRightClick:!1,fireMiddleClick:!1,targets:[],enablePointerEvents:!1,_hoveredTarget:null,_hoveredTargets:[],_initInteractive:function(){this._currentTransform=null,this._groupSelector=null,this._initWrapperElement(),this._createUpperCanvas(),this._initEventListeners(),this._initRetinaScaling(),this.freeDrawingBrush=E.PencilBrush&&new E.PencilBrush(this),this.calcOffset()},_chooseObjectsToRender:function(){var e,t,i,n=this.getActiveObjects();if(n.length>0&&!this.preserveObjectStacking){t=[],i=[];for(var r=0,s=this._objects.length;r<s;r++)e=this._objects[r],-1===n.indexOf(e)?t.push(e):i.push(e);n.length>1&&(this._activeObject._objects=i),t.push.apply(t,i)}else t=this._objects;return t},renderAll:function(){!this.contextTopDirty||this._groupSelector||this.isDrawingMode||(this.clearContext(this.contextTop),this.contextTopDirty=!1),this.hasLostContext&&(this.renderTopLayer(this.contextTop),this.hasLostContext=!1);var e=this.contextContainer;return this.renderCanvas(e,this._chooseObjectsToRender()),this},renderTopLayer:function(e){e.save(),this.isDrawingMode&&this._isCurrentlyDrawing&&(this.freeDrawingBrush&&this.freeDrawingBrush._render(),this.contextTopDirty=!0),this.selection&&this._groupSelector&&(this._drawSelection(e),this.contextTopDirty=!0),e.restore()},renderTop:function(){var e=this.contextTop;return this.clearContext(e),this.renderTopLayer(e),this.fire("after:render"),this},_normalizePointer:function(e,t){var i=e.calcTransformMatrix(),n=E.util.invertTransform(i),r=this.restorePointerVpt(t);return E.util.transformPoint(r,n)},isTargetTransparent:function(e,t,i){if(e.shouldCache()&&e._cacheCanvas&&e!==this._activeObject){var n=this._normalizePointer(e,{x:t,y:i}),r=Math.max(e.cacheTranslationX+n.x*e.zoomX,0),s=Math.max(e.cacheTranslationY+n.y*e.zoomY,0);return E.util.isTransparent(e._cacheContext,Math.round(r),Math.round(s),this.targetFindTolerance)}var o=this.contextCache,a=e.selectionBackgroundColor,l=this.viewportTransform;return e.selectionBackgroundColor="",this.clearContext(o),o.save(),o.transform(l[0],l[1],l[2],l[3],l[4],l[5]),e.render(o),o.restore(),e.selectionBackgroundColor=a,E.util.isTransparent(o,t,i,this.targetFindTolerance)},_isSelectionKeyPressed:function(e){return Array.isArray(this.selectionKey)?!!this.selectionKey.find((function(t){return!0===e[t]})):e[this.selectionKey]},_shouldClearSelection:function(e,t){var i=this.getActiveObjects(),n=this._activeObject;return!t||t&&n&&i.length>1&&-1===i.indexOf(t)&&n!==t&&!this._isSelectionKeyPressed(e)||t&&!t.evented||t&&!t.selectable&&n&&n!==t},_shouldCenterTransform:function(e,t,i){var n;if(e)return"scale"===t||"scaleX"===t||"scaleY"===t||"resizing"===t?n=this.centeredScaling||e.centeredScaling:"rotate"===t&&(n=this.centeredRotation||e.centeredRotation),n?!i:i},_getOriginFromCorner:function(e,t){var i={x:e.originX,y:e.originY};return"ml"===t||"tl"===t||"bl"===t?i.x="right":"mr"!==t&&"tr"!==t&&"br"!==t||(i.x="left"),"tl"===t||"mt"===t||"tr"===t?i.y="bottom":"bl"!==t&&"mb"!==t&&"br"!==t||(i.y="top"),i},_getActionFromCorner:function(e,t,i,n){if(!t||!e)return"drag";var r=n.controls[t];return r.getActionName(i,r,n)},_setupCurrentTransform:function(e,i,n){if(i){var r=this.getPointer(e),s=i.__corner,o=i.controls[s],a=n&&s?o.getActionHandler(e,i,o):E.controlsUtils.dragHandler,l=this._getActionFromCorner(n,s,e,i),c=this._getOriginFromCorner(i,s),h=e[this.centeredKey],u={target:i,action:l,actionHandler:a,corner:s,scaleX:i.scaleX,scaleY:i.scaleY,skewX:i.skewX,skewY:i.skewY,offsetX:r.x-i.left,offsetY:r.y-i.top,originX:c.x,originY:c.y,ex:r.x,ey:r.y,lastX:r.x,lastY:r.y,theta:t(i.angle),width:i.width*i.scaleX,shiftKey:e.shiftKey,altKey:h,original:E.util.saveObjectTransform(i)};this._shouldCenterTransform(i,l,h)&&(u.originX="center",u.originY="center"),u.original.originX=c.x,u.original.originY=c.y,this._currentTransform=u,this._beforeTransform(e)}},setCursor:function(e){this.upperCanvasEl.style.cursor=e},_drawSelection:function(e){var t=this._groupSelector,i=new E.Point(t.ex,t.ey),n=E.util.transformPoint(i,this.viewportTransform),r=new E.Point(t.ex+t.left,t.ey+t.top),s=E.util.transformPoint(r,this.viewportTransform),o=Math.min(n.x,s.x),a=Math.min(n.y,s.y),l=Math.max(n.x,s.x),c=Math.max(n.y,s.y),h=this.selectionLineWidth/2;this.selectionColor&&(e.fillStyle=this.selectionColor,e.fillRect(o,a,l-o,c-a)),this.selectionLineWidth&&this.selectionBorderColor&&(e.lineWidth=this.selectionLineWidth,e.strokeStyle=this.selectionBorderColor,o+=h,a+=h,l-=h,c-=h,E.Object.prototype._setLineDash.call(this,e,this.selectionDashArray),e.strokeRect(o,a,l-o,c-a))},findTarget:function(e,t){if(!this.skipTargetFind){var n,r,s=this.getPointer(e,!0),o=this._activeObject,a=this.getActiveObjects(),l=i(e),c=a.length>1&&!t||1===a.length;if(this.targets=[],c&&o._findTargetCorner(s,l))return o;if(a.length>1&&!t&&o===this._searchPossibleTargets([o],s))return o;if(1===a.length&&o===this._searchPossibleTargets([o],s)){if(!this.preserveObjectStacking)return o;n=o,r=this.targets,this.targets=[]}var h=this._searchPossibleTargets(this._objects,s);return e[this.altSelectionKey]&&h&&n&&h!==n&&(h=n,this.targets=r),h}},_checkTarget:function(e,t,i){if(t&&t.visible&&t.evented&&t.containsPoint(e)){if(!this.perPixelTargetFind&&!t.perPixelTargetFind||t.isEditing)return!0;if(!this.isTargetTransparent(t,i.x,i.y))return!0}},_searchPossibleTargets:function(e,t){for(var i,n,r=e.length;r--;){var s=e[r],o=s.group?this._normalizePointer(s.group,t):t;if(this._checkTarget(o,s,t)){(i=e[r]).subTargetCheck&&i instanceof E.Group&&(n=this._searchPossibleTargets(i._objects,t))&&this.targets.push(n);break}}return i},restorePointerVpt:function(e){return E.util.transformPoint(e,E.util.invertTransform(this.viewportTransform))},getPointer:function(t,i){if(this._absolutePointer&&!i)return this._absolutePointer;if(this._pointer&&i)return this._pointer;var n,r=e(t),s=this.upperCanvasEl,o=s.getBoundingClientRect(),a=o.width||0,l=o.height||0;a&&l||("top"in o&&"bottom"in o&&(l=Math.abs(o.top-o.bottom)),"right"in o&&"left"in o&&(a=Math.abs(o.right-o.left))),this.calcOffset(),r.x=r.x-this._offset.left,r.y=r.y-this._offset.top,i||(r=this.restorePointerVpt(r));var c=this.getRetinaScaling();return 1!==c&&(r.x/=c,r.y/=c),n=0===a||0===l?{width:1,height:1}:{width:s.width/a,height:s.height/l},{x:r.x*n.width,y:r.y*n.height}},_createUpperCanvas:function(){var e=this.lowerCanvasEl.className.replace(/\s*lower-canvas\s*/,""),t=this.lowerCanvasEl,i=this.upperCanvasEl;i?i.className="":(i=this._createCanvasElement(),this.upperCanvasEl=i),E.util.addClass(i,"upper-canvas "+e),this.wrapperEl.appendChild(i),this._copyCanvasStyle(t,i),this._applyCanvasStyle(i),this.contextTop=i.getContext("2d")},getTopContext:function(){return this.contextTop},_createCacheCanvas:function(){this.cacheCanvasEl=this._createCanvasElement(),this.cacheCanvasEl.setAttribute("width",this.width),this.cacheCanvasEl.setAttribute("height",this.height),this.contextCache=this.cacheCanvasEl.getContext("2d")},_initWrapperElement:function(){this.wrapperEl=E.util.wrapElement(this.lowerCanvasEl,"div",{class:this.containerClass}),E.util.setStyle(this.wrapperEl,{width:this.width+"px",height:this.height+"px",position:"relative"}),E.util.makeElementUnselectable(this.wrapperEl)},_applyCanvasStyle:function(e){var t=this.width||e.width,i=this.height||e.height;E.util.setStyle(e,{position:"absolute",width:t+"px",height:i+"px",left:0,top:0,"touch-action":this.allowTouchScrolling?"manipulation":"none","-ms-touch-action":this.allowTouchScrolling?"manipulation":"none"}),e.width=t,e.height=i,E.util.makeElementUnselectable(e)},_copyCanvasStyle:function(e,t){t.style.cssText=e.style.cssText},getSelectionContext:function(){return this.contextTop},getSelectionElement:function(){return this.upperCanvasEl},getActiveObject:function(){return this._activeObject},getActiveObjects:function(){var e=this._activeObject;return e?"activeSelection"===e.type&&e._objects?e._objects.slice(0):[e]:[]},_onObjectRemoved:function(e){e===this._activeObject&&(this.fire("before:selection:cleared",{target:e}),this._discardActiveObject(),this.fire("selection:cleared",{target:e}),e.fire("deselected")),e===this._hoveredTarget&&(this._hoveredTarget=null,this._hoveredTargets=[]),this.callSuper("_onObjectRemoved",e)},_fireSelectionEvents:function(e,t){var i=!1,n=this.getActiveObjects(),r=[],s=[];e.forEach((function(e){-1===n.indexOf(e)&&(i=!0,e.fire("deselected",{e:t,target:e}),s.push(e))})),n.forEach((function(n){-1===e.indexOf(n)&&(i=!0,n.fire("selected",{e:t,target:n}),r.push(n))})),e.length>0&&n.length>0?i&&this.fire("selection:updated",{e:t,selected:r,deselected:s}):n.length>0?this.fire("selection:created",{e:t,selected:r}):e.length>0&&this.fire("selection:cleared",{e:t,deselected:s})},setActiveObject:function(e,t){var i=this.getActiveObjects();return this._setActiveObject(e,t),this._fireSelectionEvents(i,t),this},_setActiveObject:function(e,t){return this._activeObject!==e&&!!this._discardActiveObject(t,e)&&!e.onSelect({e:t})&&(this._activeObject=e,!0)},_discardActiveObject:function(e,t){var i=this._activeObject;if(i){if(i.onDeselect({e:e,object:t}))return!1;this._activeObject=null}return!0},discardActiveObject:function(e){var t=this.getActiveObjects(),i=this.getActiveObject();return t.length&&this.fire("before:selection:cleared",{target:i,e:e}),this._discardActiveObject(e),this._fireSelectionEvents(t,e),this},dispose:function(){var e=this.wrapperEl;return this.removeListeners(),e.removeChild(this.upperCanvasEl),e.removeChild(this.lowerCanvasEl),this.contextCache=null,this.contextTop=null,["upperCanvasEl","cacheCanvasEl"].forEach(function(e){E.util.cleanUpJsdomNode(this[e]),this[e]=void 0}.bind(this)),e.parentNode&&e.parentNode.replaceChild(this.lowerCanvasEl,this.wrapperEl),delete this.wrapperEl,E.StaticCanvas.prototype.dispose.call(this),this},clear:function(){return this.discardActiveObject(),this.clearContext(this.contextTop),this.callSuper("clear")},drawControls:function(e){var t=this._activeObject;t&&t._renderControls(e)},_toObject:function(e,t,i){var n=this._realizeGroupTransformOnObject(e),r=this.callSuper("_toObject",e,t,i);return this._unwindGroupTransformOnObject(e,n),r},_realizeGroupTransformOnObject:function(e){if(e.group&&"activeSelection"===e.group.type&&this._activeObject===e.group){var t={};return["angle","flipX","flipY","left","scaleX","scaleY","skewX","skewY","top"].forEach((function(i){t[i]=e[i]})),E.util.addTransformToObject(e,this._activeObject.calcOwnMatrix()),t}return null},_unwindGroupTransformOnObject:function(e,t){t&&e.set(t)},_setSVGObject:function(e,t,i){var n=this._realizeGroupTransformOnObject(t);this.callSuper("_setSVGObject",e,t,i),this._unwindGroupTransformOnObject(t,n)},setViewportTransform:function(e){this.renderOnAddRemove&&this._activeObject&&this._activeObject.isEditing&&this._activeObject.clearContextTop(),E.StaticCanvas.prototype.setViewportTransform.call(this,e)}}),E.StaticCanvas)"prototype"!==n&&(E.Canvas[n]=E.StaticCanvas[n])}(),function(){var e=E.util.addListener,t=E.util.removeListener,i={passive:!1};function n(e,t){return e.button&&e.button===t-1}E.util.object.extend(E.Canvas.prototype,{mainTouchId:null,_initEventListeners:function(){this.removeListeners(),this._bindEvents(),this.addOrRemove(e,"add")},_getEventPrefix:function(){return this.enablePointerEvents?"pointer":"mouse"},addOrRemove:function(e,t){var n=this.upperCanvasEl,r=this._getEventPrefix();e(E.window,"resize",this._onResize),e(n,r+"down",this._onMouseDown),e(n,r+"move",this._onMouseMove,i),e(n,r+"out",this._onMouseOut),e(n,r+"enter",this._onMouseEnter),e(n,"wheel",this._onMouseWheel),e(n,"contextmenu",this._onContextMenu),e(n,"dblclick",this._onDoubleClick),e(n,"dragover",this._onDragOver),e(n,"dragenter",this._onDragEnter),e(n,"dragleave",this._onDragLeave),e(n,"drop",this._onDrop),this.enablePointerEvents||e(n,"touchstart",this._onTouchStart,i),"undefined"!=typeof eventjs&&t in eventjs&&(eventjs[t](n,"gesture",this._onGesture),eventjs[t](n,"drag",this._onDrag),eventjs[t](n,"orientation",this._onOrientationChange),eventjs[t](n,"shake",this._onShake),eventjs[t](n,"longpress",this._onLongPress))},removeListeners:function(){this.addOrRemove(t,"remove");var e=this._getEventPrefix();t(E.document,e+"up",this._onMouseUp),t(E.document,"touchend",this._onTouchEnd,i),t(E.document,e+"move",this._onMouseMove,i),t(E.document,"touchmove",this._onMouseMove,i)},_bindEvents:function(){this.eventsBound||(this._onMouseDown=this._onMouseDown.bind(this),this._onTouchStart=this._onTouchStart.bind(this),this._onMouseMove=this._onMouseMove.bind(this),this._onMouseUp=this._onMouseUp.bind(this),this._onTouchEnd=this._onTouchEnd.bind(this),this._onResize=this._onResize.bind(this),this._onGesture=this._onGesture.bind(this),this._onDrag=this._onDrag.bind(this),this._onShake=this._onShake.bind(this),this._onLongPress=this._onLongPress.bind(this),this._onOrientationChange=this._onOrientationChange.bind(this),this._onMouseWheel=this._onMouseWheel.bind(this),this._onMouseOut=this._onMouseOut.bind(this),this._onMouseEnter=this._onMouseEnter.bind(this),this._onContextMenu=this._onContextMenu.bind(this),this._onDoubleClick=this._onDoubleClick.bind(this),this._onDragOver=this._onDragOver.bind(this),this._onDragEnter=this._simpleEventHandler.bind(this,"dragenter"),this._onDragLeave=this._simpleEventHandler.bind(this,"dragleave"),this._onDrop=this._onDrop.bind(this),this.eventsBound=!0)},_onGesture:function(e,t){this.__onTransformGesture&&this.__onTransformGesture(e,t)},_onDrag:function(e,t){this.__onDrag&&this.__onDrag(e,t)},_onMouseWheel:function(e){this.__onMouseWheel(e)},_onMouseOut:function(e){var t=this._hoveredTarget;this.fire("mouse:out",{target:t,e:e}),this._hoveredTarget=null,t&&t.fire("mouseout",{e:e});var i=this;this._hoveredTargets.forEach((function(n){i.fire("mouse:out",{target:t,e:e}),n&&t.fire("mouseout",{e:e})})),this._hoveredTargets=[],this._iTextInstances&&this._iTextInstances.forEach((function(e){e.isEditing&&e.hiddenTextarea.focus()}))},_onMouseEnter:function(e){this._currentTransform||this.findTarget(e)||(this.fire("mouse:over",{target:null,e:e}),this._hoveredTarget=null,this._hoveredTargets=[])},_onOrientationChange:function(e,t){this.__onOrientationChange&&this.__onOrientationChange(e,t)},_onShake:function(e,t){this.__onShake&&this.__onShake(e,t)},_onLongPress:function(e,t){this.__onLongPress&&this.__onLongPress(e,t)},_onDragOver:function(e){e.preventDefault();var t=this._simpleEventHandler("dragover",e);this._fireEnterLeaveEvents(t,e)},_onDrop:function(e){return this._simpleEventHandler("drop:before",e),this._simpleEventHandler("drop",e)},_onContextMenu:function(e){return this.stopContextMenu&&(e.stopPropagation(),e.preventDefault()),!1},_onDoubleClick:function(e){this._cacheTransformEventData(e),this._handleEvent(e,"dblclick"),this._resetTransformEventData(e)},getPointerId:function(e){var t=e.changedTouches;return t?t[0]&&t[0].identifier:this.enablePointerEvents?e.pointerId:-1},_isMainEvent:function(e){return!0===e.isPrimary||!1!==e.isPrimary&&("touchend"===e.type&&0===e.touches.length||!e.changedTouches||e.changedTouches[0].identifier===this.mainTouchId)},_onTouchStart:function(n){n.preventDefault(),null===this.mainTouchId&&(this.mainTouchId=this.getPointerId(n)),this.__onMouseDown(n),this._resetTransformEventData();var r=this.upperCanvasEl,s=this._getEventPrefix();e(E.document,"touchend",this._onTouchEnd,i),e(E.document,"touchmove",this._onMouseMove,i),t(r,s+"down",this._onMouseDown)},_onMouseDown:function(n){this.__onMouseDown(n),this._resetTransformEventData();var r=this.upperCanvasEl,s=this._getEventPrefix();t(r,s+"move",this._onMouseMove,i),e(E.document,s+"up",this._onMouseUp),e(E.document,s+"move",this._onMouseMove,i)},_onTouchEnd:function(n){if(!(n.touches.length>0)){this.__onMouseUp(n),this._resetTransformEventData(),this.mainTouchId=null;var r=this._getEventPrefix();t(E.document,"touchend",this._onTouchEnd,i),t(E.document,"touchmove",this._onMouseMove,i);var s=this;this._willAddMouseDown&&clearTimeout(this._willAddMouseDown),this._willAddMouseDown=setTimeout((function(){e(s.upperCanvasEl,r+"down",s._onMouseDown),s._willAddMouseDown=0}),400)}},_onMouseUp:function(n){this.__onMouseUp(n),this._resetTransformEventData();var r=this.upperCanvasEl,s=this._getEventPrefix();this._isMainEvent(n)&&(t(E.document,s+"up",this._onMouseUp),t(E.document,s+"move",this._onMouseMove,i),e(r,s+"move",this._onMouseMove,i))},_onMouseMove:function(e){!this.allowTouchScrolling&&e.preventDefault&&e.preventDefault(),this.__onMouseMove(e)},_onResize:function(){this.calcOffset()},_shouldRender:function(e){var t=this._activeObject;return!!(!!t!=!!e||t&&e&&t!==e)||(t&&t.isEditing,!1)},__onMouseUp:function(e){var t,i=this._currentTransform,r=this._groupSelector,s=!1,o=!r||0===r.left&&0===r.top;if(this._cacheTransformEventData(e),t=this._target,this._handleEvent(e,"up:before"),n(e,3))this.fireRightClick&&this._handleEvent(e,"up",3,o);else{if(n(e,2))return this.fireMiddleClick&&this._handleEvent(e,"up",2,o),void this._resetTransformEventData();if(this.isDrawingMode&&this._isCurrentlyDrawing)this._onMouseUpInDrawingMode(e);else if(this._isMainEvent(e)){if(i&&(this._finalizeCurrentTransform(e),s=i.actionPerformed),!o){var a=t===this._activeObject;this._maybeGroupObjects(e),s||(s=this._shouldRender(t)||!a&&t===this._activeObject)}var l,c;if(t){if(l=t._findTargetCorner(this.getPointer(e,!0),E.util.isTouchEvent(e)),t.selectable&&t!==this._activeObject&&"up"===t.activeOn)this.setActiveObject(t,e),s=!0;else{var h=t.controls[l],u=h&&h.getMouseUpHandler(e,t,h);u&&u(e,i,(c=this.getPointer(e)).x,c.y)}t.isMoving=!1}if(i&&(i.target!==t||i.corner!==l)){var d=i.target&&i.target.controls[i.corner],f=d&&d.getMouseUpHandler(e,t,h);c=c||this.getPointer(e),f&&f(e,i,c.x,c.y)}this._setCursorFromEvent(e,t),this._handleEvent(e,"up",1,o),this._groupSelector=null,this._currentTransform=null,t&&(t.__corner=0),s?this.requestRenderAll():o||this.renderTop()}}},_simpleEventHandler:function(e,t){var i=this.findTarget(t),n=this.targets,r={e:t,target:i,subTargets:n};if(this.fire(e,r),i&&i.fire(e,r),!n)return i;for(var s=0;s<n.length;s++)n[s].fire(e,r);return i},_handleEvent:function(e,t,i,n){var r=this._target,s=this.targets||[],o={e:e,target:r,subTargets:s,button:i||1,isClick:n||!1,pointer:this._pointer,absolutePointer:this._absolutePointer,transform:this._currentTransform};"up"===t&&(o.currentTarget=this.findTarget(e),o.currentSubTargets=this.targets),this.fire("mouse:"+t,o),r&&r.fire("mouse"+t,o);for(var a=0;a<s.length;a++)s[a].fire("mouse"+t,o)},_finalizeCurrentTransform:function(e){var t=this._currentTransform,i=t.target,n={e:e,target:i,transform:t,action:t.action};i._scaling&&(i._scaling=!1),i.setCoords(),(t.actionPerformed||this.stateful&&i.hasStateChanged())&&this._fire("modified",n)},_onMouseDownInDrawingMode:function(e){this._isCurrentlyDrawing=!0,this.getActiveObject()&&this.discardActiveObject(e).requestRenderAll();var t=this.getPointer(e);this.freeDrawingBrush.onMouseDown(t,{e:e,pointer:t}),this._handleEvent(e,"down")},_onMouseMoveInDrawingMode:function(e){if(this._isCurrentlyDrawing){var t=this.getPointer(e);this.freeDrawingBrush.onMouseMove(t,{e:e,pointer:t})}this.setCursor(this.freeDrawingCursor),this._handleEvent(e,"move")},_onMouseUpInDrawingMode:function(e){var t=this.getPointer(e);this._isCurrentlyDrawing=this.freeDrawingBrush.onMouseUp({e:e,pointer:t}),this._handleEvent(e,"up")},__onMouseDown:function(e){this._cacheTransformEventData(e),this._handleEvent(e,"down:before");var t=this._target;if(n(e,3))this.fireRightClick&&this._handleEvent(e,"down",3);else if(n(e,2))this.fireMiddleClick&&this._handleEvent(e,"down",2);else if(this.isDrawingMode)this._onMouseDownInDrawingMode(e);else if(this._isMainEvent(e)&&!this._currentTransform){var i=this._pointer;this._previousPointer=i;var r=this._shouldRender(t),s=this._shouldGroup(e,t);if(this._shouldClearSelection(e,t)?this.discardActiveObject(e):s&&(this._handleGrouping(e,t),t=this._activeObject),!this.selection||t&&(t.selectable||t.isEditing||t===this._activeObject)||(this._groupSelector={ex:this._absolutePointer.x,ey:this._absolutePointer.y,top:0,left:0}),t){var o=t===this._activeObject;t.selectable&&"down"===t.activeOn&&this.setActiveObject(t,e);var a=t._findTargetCorner(this.getPointer(e,!0),E.util.isTouchEvent(e));if(t.__corner=a,t===this._activeObject&&(a||!s)){this._setupCurrentTransform(e,t,o);var l=t.controls[a],c=(i=this.getPointer(e),l&&l.getMouseDownHandler(e,t,l));c&&c(e,this._currentTransform,i.x,i.y)}}this._handleEvent(e,"down"),(r||s)&&this.requestRenderAll()}},_resetTransformEventData:function(){this._target=null,this._pointer=null,this._absolutePointer=null},_cacheTransformEventData:function(e){this._resetTransformEventData(),this._pointer=this.getPointer(e,!0),this._absolutePointer=this.restorePointerVpt(this._pointer),this._target=this._currentTransform?this._currentTransform.target:this.findTarget(e)||null},_beforeTransform:function(e){var t=this._currentTransform;this.stateful&&t.target.saveState(),this.fire("before:transform",{e:e,transform:t})},__onMouseMove:function(e){var t,i;if(this._handleEvent(e,"move:before"),this._cacheTransformEventData(e),this.isDrawingMode)this._onMouseMoveInDrawingMode(e);else if(this._isMainEvent(e)){var n=this._groupSelector;n?(i=this._absolutePointer,n.left=i.x-n.ex,n.top=i.y-n.ey,this.renderTop()):this._currentTransform?this._transformObject(e):(t=this.findTarget(e)||null,this._setCursorFromEvent(e,t),this._fireOverOutEvents(t,e)),this._handleEvent(e,"move"),this._resetTransformEventData()}},_fireOverOutEvents:function(e,t){var i=this._hoveredTarget,n=this._hoveredTargets,r=this.targets,s=Math.max(n.length,r.length);this.fireSyntheticInOutEvents(e,t,{oldTarget:i,evtOut:"mouseout",canvasEvtOut:"mouse:out",evtIn:"mouseover",canvasEvtIn:"mouse:over"});for(var o=0;o<s;o++)this.fireSyntheticInOutEvents(r[o],t,{oldTarget:n[o],evtOut:"mouseout",evtIn:"mouseover"});this._hoveredTarget=e,this._hoveredTargets=this.targets.concat()},_fireEnterLeaveEvents:function(e,t){var i=this._draggedoverTarget,n=this._hoveredTargets,r=this.targets,s=Math.max(n.length,r.length);this.fireSyntheticInOutEvents(e,t,{oldTarget:i,evtOut:"dragleave",evtIn:"dragenter"});for(var o=0;o<s;o++)this.fireSyntheticInOutEvents(r[o],t,{oldTarget:n[o],evtOut:"dragleave",evtIn:"dragenter"});this._draggedoverTarget=e},fireSyntheticInOutEvents:function(e,t,i){var n,r,s,o=i.oldTarget,a=o!==e,l=i.canvasEvtIn,c=i.canvasEvtOut;a&&(n={e:t,target:e,previousTarget:o},r={e:t,target:o,nextTarget:e}),s=e&&a,o&&a&&(c&&this.fire(c,r),o.fire(i.evtOut,r)),s&&(l&&this.fire(l,n),e.fire(i.evtIn,n))},__onMouseWheel:function(e){this._cacheTransformEventData(e),this._handleEvent(e,"wheel"),this._resetTransformEventData()},_transformObject:function(e){var t=this.getPointer(e),i=this._currentTransform;i.reset=!1,i.shiftKey=e.shiftKey,i.altKey=e[this.centeredKey],this._performTransformAction(e,i,t),i.actionPerformed&&this.requestRenderAll()},_performTransformAction:function(e,t,i){var n=i.x,r=i.y,s=t.action,o=!1,a=t.actionHandler;a&&(o=a(e,t,n,r)),"drag"===s&&o&&(t.target.isMoving=!0,this.setCursor(t.target.moveCursor||this.moveCursor)),t.actionPerformed=t.actionPerformed||o},_fire:E.controlsUtils.fireEvent,_setCursorFromEvent:function(e,t){if(!t)return this.setCursor(this.defaultCursor),!1;var i=t.hoverCursor||this.hoverCursor,n=this._activeObject&&"activeSelection"===this._activeObject.type?this._activeObject:null,r=(!n||!n.contains(t))&&t._findTargetCorner(this.getPointer(e,!0));r?this.setCursor(this.getCornerCursor(r,t,e)):(t.subTargetCheck&&this.targets.concat().reverse().map((function(e){i=e.hoverCursor||i})),this.setCursor(i))},getCornerCursor:function(e,t,i){var n=t.controls[e];return n.cursorStyleHandler(i,n,t)}})}(),v=Math.min,y=Math.max,E.util.object.extend(E.Canvas.prototype,{_shouldGroup:function(e,t){var i=this._activeObject;return i&&this._isSelectionKeyPressed(e)&&t&&t.selectable&&this.selection&&(i!==t||"activeSelection"===i.type)&&!t.onSelect({e:e})},_handleGrouping:function(e,t){var i=this._activeObject;i.__corner||(t!==i||(t=this.findTarget(e,!0))&&t.selectable)&&(i&&"activeSelection"===i.type?this._updateActiveSelection(t,e):this._createActiveSelection(t,e))},_updateActiveSelection:function(e,t){var i=this._activeObject,n=i._objects.slice(0);i.contains(e)?(i.removeWithUpdate(e),this._hoveredTarget=e,this._hoveredTargets=this.targets.concat(),1===i.size()&&this._setActiveObject(i.item(0),t)):(i.addWithUpdate(e),this._hoveredTarget=i,this._hoveredTargets=this.targets.concat()),this._fireSelectionEvents(n,t)},_createActiveSelection:function(e,t){var i=this.getActiveObjects(),n=this._createGroup(e);this._hoveredTarget=n,this._setActiveObject(n,t),this._fireSelectionEvents(i,t)},_createGroup:function(e){var t=this._objects,i=t.indexOf(this._activeObject)<t.indexOf(e)?[this._activeObject,e]:[e,this._activeObject];return this._activeObject.isEditing&&this._activeObject.exitEditing(),new E.ActiveSelection(i,{canvas:this})},_groupSelectedObjects:function(e){var t,i=this._collectObjects(e);1===i.length?this.setActiveObject(i[0],e):i.length>1&&(t=new E.ActiveSelection(i.reverse(),{canvas:this}),this.setActiveObject(t,e))},_collectObjects:function(e){for(var t,i=[],n=this._groupSelector.ex,r=this._groupSelector.ey,s=n+this._groupSelector.left,o=r+this._groupSelector.top,a=new E.Point(v(n,s),v(r,o)),l=new E.Point(y(n,s),y(r,o)),c=!this.selectionFullyContained,h=n===s&&r===o,u=this._objects.length;u--&&!((t=this._objects[u])&&t.selectable&&t.visible&&(c&&t.intersectsWithRect(a,l,!0)||t.isContainedWithinRect(a,l,!0)||c&&t.containsPoint(a,null,!0)||c&&t.containsPoint(l,null,!0))&&(i.push(t),h)););return i.length>1&&(i=i.filter((function(t){return!t.onSelect({e:e})}))),i},_maybeGroupObjects:function(e){this.selection&&this._groupSelector&&this._groupSelectedObjects(e),this.setCursor(this.defaultCursor),this._groupSelector=null}}),E.util.object.extend(E.StaticCanvas.prototype,{toDataURL:function(e){e||(e={});var t=e.format||"png",i=e.quality||1,n=(e.multiplier||1)*(e.enableRetinaScaling?this.getRetinaScaling():1),r=this.toCanvasElement(n,e);return E.util.toDataURL(r,t,i)},toCanvasElement:function(e,t){e=e||1;var i=((t=t||{}).width||this.width)*e,n=(t.height||this.height)*e,r=this.getZoom(),s=this.width,o=this.height,a=r*e,l=this.viewportTransform,c=(l[4]-(t.left||0))*e,h=(l[5]-(t.top||0))*e,u=this.interactive,d=[a,0,0,a,c,h],f=this.enableRetinaScaling,g=E.util.createCanvasElement(),p=this.contextTop;return g.width=i,g.height=n,this.contextTop=null,this.enableRetinaScaling=!1,this.interactive=!1,this.viewportTransform=d,this.width=i,this.height=n,this.calcViewportBoundaries(),this.renderCanvas(g.getContext("2d"),this._objects),this.viewportTransform=l,this.width=s,this.height=o,this.calcViewportBoundaries(),this.interactive=u,this.enableRetinaScaling=f,this.contextTop=p,g}}),E.util.object.extend(E.StaticCanvas.prototype,{loadFromJSON:function(e,t,i){if(e){var n="string"==typeof e?JSON.parse(e):E.util.object.clone(e),r=this,s=n.clipPath,o=this.renderOnAddRemove;return this.renderOnAddRemove=!1,delete n.clipPath,this._enlivenObjects(n.objects,(function(e){r.clear(),r._setBgOverlay(n,(function(){s?r._enlivenObjects([s],(function(i){r.clipPath=i[0],r.__setupCanvas.call(r,n,e,o,t)})):r.__setupCanvas.call(r,n,e,o,t)}))}),i),this}},__setupCanvas:function(e,t,i,n){var r=this;t.forEach((function(e,t){r.insertAt(e,t)})),this.renderOnAddRemove=i,delete e.objects,delete e.backgroundImage,delete e.overlayImage,delete e.background,delete e.overlay,this._setOptions(e),this.renderAll(),n&&n()},_setBgOverlay:function(e,t){var i={backgroundColor:!1,overlayColor:!1,backgroundImage:!1,overlayImage:!1};if(e.backgroundImage||e.overlayImage||e.background||e.overlay){var n=function(){i.backgroundImage&&i.overlayImage&&i.backgroundColor&&i.overlayColor&&t&&t()};this.__setBgOverlay("backgroundImage",e.backgroundImage,i,n),this.__setBgOverlay("overlayImage",e.overlayImage,i,n),this.__setBgOverlay("backgroundColor",e.background,i,n),this.__setBgOverlay("overlayColor",e.overlay,i,n)}else t&&t()},__setBgOverlay:function(e,t,i,n){var r=this;if(!t)return i[e]=!0,void(n&&n());"backgroundImage"===e||"overlayImage"===e?E.util.enlivenObjects([t],(function(t){r[e]=t[0],i[e]=!0,n&&n()})):this["set"+E.util.string.capitalize(e,!0)](t,(function(){i[e]=!0,n&&n()}))},_enlivenObjects:function(e,t,i){e&&0!==e.length?E.util.enlivenObjects(e,(function(e){t&&t(e)}),null,i):t&&t([])},_toDataURL:function(e,t){this.clone((function(i){t(i.toDataURL(e))}))},_toDataURLWithMultiplier:function(e,t,i){this.clone((function(n){i(n.toDataURLWithMultiplier(e,t))}))},clone:function(e,t){var i=JSON.stringify(this.toJSON(t));this.cloneWithoutData((function(t){t.loadFromJSON(i,(function(){e&&e(t)}))}))},cloneWithoutData:function(e){var t=E.util.createCanvasElement();t.width=this.width,t.height=this.height;var i=new E.Canvas(t);this.backgroundImage?(i.setBackgroundImage(this.backgroundImage.src,(function(){i.renderAll(),e&&e(i)})),i.backgroundImageOpacity=this.backgroundImageOpacity,i.backgroundImageStretch=this.backgroundImageStretch):e&&e(i)}}),function(e){var t=e.fabric||(e.fabric={}),i=t.util.object.extend,n=t.util.object.clone,r=t.util.toFixed,s=t.util.string.capitalize,o=t.util.degreesToRadians,a=!t.isLikelyNode;t.Object||(t.Object=t.util.createClass(t.CommonMethods,{type:"object",originX:"left",originY:"top",top:0,left:0,width:0,height:0,scaleX:1,scaleY:1,flipX:!1,flipY:!1,opacity:1,angle:0,skewX:0,skewY:0,cornerSize:13,touchCornerSize:24,transparentCorners:!0,hoverCursor:null,moveCursor:null,padding:0,borderColor:"rgb(178,204,255)",borderDashArray:null,cornerColor:"rgb(178,204,255)",cornerStrokeColor:null,cornerStyle:"rect",cornerDashArray:null,centeredScaling:!1,centeredRotation:!0,fill:"rgb(0,0,0)",fillRule:"nonzero",globalCompositeOperation:"source-over",backgroundColor:"",selectionBackgroundColor:"",stroke:null,strokeWidth:1,strokeDashArray:null,strokeDashOffset:0,strokeLineCap:"butt",strokeLineJoin:"miter",strokeMiterLimit:4,shadow:null,borderOpacityWhenMoving:.4,borderScaleFactor:1,minScaleLimit:0,selectable:!0,evented:!0,visible:!0,hasControls:!0,hasBorders:!0,perPixelTargetFind:!1,includeDefaultValues:!0,lockMovementX:!1,lockMovementY:!1,lockRotation:!1,lockScalingX:!1,lockScalingY:!1,lockSkewingX:!1,lockSkewingY:!1,lockScalingFlip:!1,excludeFromExport:!1,objectCaching:a,statefullCache:!1,noScaleCache:!0,strokeUniform:!1,dirty:!0,__corner:0,paintFirst:"fill",activeOn:"down",stateProperties:"top left width height scaleX scaleY flipX flipY originX originY transformMatrix stroke strokeWidth strokeDashArray strokeLineCap strokeDashOffset strokeLineJoin strokeMiterLimit angle opacity fill globalCompositeOperation shadow visible backgroundColor skewX skewY fillRule paintFirst clipPath strokeUniform".split(" "),cacheProperties:"fill stroke strokeWidth strokeDashArray width height paintFirst strokeUniform strokeLineCap strokeDashOffset strokeLineJoin strokeMiterLimit backgroundColor clipPath".split(" "),colorProperties:"fill stroke backgroundColor".split(" "),clipPath:void 0,inverted:!1,absolutePositioned:!1,initialize:function(e){e&&this.setOptions(e)},_createCacheCanvas:function(){this._cacheProperties={},this._cacheCanvas=t.util.createCanvasElement(),this._cacheContext=this._cacheCanvas.getContext("2d"),this._updateCacheCanvas(),this.dirty=!0},_limitCacheSize:function(e){var i=t.perfLimitSizeTotal,n=e.width,r=e.height,s=t.maxCacheSideLimit,o=t.minCacheSideLimit;if(n<=s&&r<=s&&n*r<=i)return n<o&&(e.width=o),r<o&&(e.height=o),e;var a=n/r,l=t.util.limitDimsByArea(a,i),c=t.util.capValue,h=c(o,l.x,s),u=c(o,l.y,s);return n>h&&(e.zoomX/=n/h,e.width=h,e.capped=!0),r>u&&(e.zoomY/=r/u,e.height=u,e.capped=!0),e},_getCacheCanvasDimensions:function(){var e=this.getTotalObjectScaling(),t=this._getTransformedDimensions(0,0),i=t.x*e.scaleX/this.scaleX,n=t.y*e.scaleY/this.scaleY;return{width:i+2,height:n+2,zoomX:e.scaleX,zoomY:e.scaleY,x:i,y:n}},_updateCacheCanvas:function(){var e=this.canvas;if(this.noScaleCache&&e&&e._currentTransform){var i=e._currentTransform.target,n=e._currentTransform.action;if(this===i&&n.slice&&"scale"===n.slice(0,5))return!1}var r,s,o=this._cacheCanvas,a=this._limitCacheSize(this._getCacheCanvasDimensions()),l=t.minCacheSideLimit,c=a.width,h=a.height,u=a.zoomX,d=a.zoomY,f=c!==this.cacheWidth||h!==this.cacheHeight,g=this.zoomX!==u||this.zoomY!==d,p=f||g,m=0,_=0,v=!1;if(f){var y=this._cacheCanvas.width,w=this._cacheCanvas.height,b=c>y||h>w;v=b||(c<.9*y||h<.9*w)&&y>l&&w>l,b&&!a.capped&&(c>l||h>l)&&(m=.1*c,_=.1*h)}return this instanceof t.Text&&this.path&&(p=!0,v=!0,m+=this.getHeightOfLine(0)*this.zoomX,_+=this.getHeightOfLine(0)*this.zoomY),!!p&&(v?(o.width=Math.ceil(c+m),o.height=Math.ceil(h+_)):(this._cacheContext.setTransform(1,0,0,1,0,0),this._cacheContext.clearRect(0,0,o.width,o.height)),r=a.x/2,s=a.y/2,this.cacheTranslationX=Math.round(o.width/2-r)+r,this.cacheTranslationY=Math.round(o.height/2-s)+s,this.cacheWidth=c,this.cacheHeight=h,this._cacheContext.translate(this.cacheTranslationX,this.cacheTranslationY),this._cacheContext.scale(u,d),this.zoomX=u,this.zoomY=d,!0)},setOptions:function(e){this._setOptions(e),this._initGradient(e.fill,"fill"),this._initGradient(e.stroke,"stroke"),this._initPattern(e.fill,"fill"),this._initPattern(e.stroke,"stroke")},transform:function(e){var t=this.group&&!this.group._transformDone||this.group&&this.canvas&&e===this.canvas.contextTop,i=this.calcTransformMatrix(!t);e.transform(i[0],i[1],i[2],i[3],i[4],i[5])},toObject:function(e){var i=t.Object.NUM_FRACTION_DIGITS,n={type:this.type,version:t.version,originX:this.originX,originY:this.originY,left:r(this.left,i),top:r(this.top,i),width:r(this.width,i),height:r(this.height,i),fill:this.fill&&this.fill.toObject?this.fill.toObject():this.fill,stroke:this.stroke&&this.stroke.toObject?this.stroke.toObject():this.stroke,strokeWidth:r(this.strokeWidth,i),strokeDashArray:this.strokeDashArray?this.strokeDashArray.concat():this.strokeDashArray,strokeLineCap:this.strokeLineCap,strokeDashOffset:this.strokeDashOffset,strokeLineJoin:this.strokeLineJoin,strokeUniform:this.strokeUniform,strokeMiterLimit:r(this.strokeMiterLimit,i),scaleX:r(this.scaleX,i),scaleY:r(this.scaleY,i),angle:r(this.angle,i),flipX:this.flipX,flipY:this.flipY,opacity:r(this.opacity,i),shadow:this.shadow&&this.shadow.toObject?this.shadow.toObject():this.shadow,visible:this.visible,backgroundColor:this.backgroundColor,fillRule:this.fillRule,paintFirst:this.paintFirst,globalCompositeOperation:this.globalCompositeOperation,skewX:r(this.skewX,i),skewY:r(this.skewY,i)};return this.clipPath&&!this.clipPath.excludeFromExport&&(n.clipPath=this.clipPath.toObject(e),n.clipPath.inverted=this.clipPath.inverted,n.clipPath.absolutePositioned=this.clipPath.absolutePositioned),t.util.populateWithProperties(this,n,e),this.includeDefaultValues||(n=this._removeDefaultValues(n)),n},toDatalessObject:function(e){return this.toObject(e)},_removeDefaultValues:function(e){var i=t.util.getKlass(e.type).prototype;return i.stateProperties.forEach((function(t){"left"!==t&&"top"!==t&&(e[t]===i[t]&&delete e[t],Array.isArray(e[t])&&Array.isArray(i[t])&&0===e[t].length&&0===i[t].length&&delete e[t])})),e},toString:function(){return"#<fabric."+s(this.type)+">"},getObjectScaling:function(){if(!this.group)return{scaleX:this.scaleX,scaleY:this.scaleY};var e=t.util.qrDecompose(this.calcTransformMatrix());return{scaleX:Math.abs(e.scaleX),scaleY:Math.abs(e.scaleY)}},getTotalObjectScaling:function(){var e=this.getObjectScaling(),t=e.scaleX,i=e.scaleY;if(this.canvas){var n=this.canvas.getZoom(),r=this.canvas.getRetinaScaling();t*=n*r,i*=n*r}return{scaleX:t,scaleY:i}},getObjectOpacity:function(){var e=this.opacity;return this.group&&(e*=this.group.getObjectOpacity()),e},_set:function(e,i){var n="scaleX"===e||"scaleY"===e,r=this[e]!==i,s=!1;return n&&(i=this._constrainScale(i)),"scaleX"===e&&i<0?(this.flipX=!this.flipX,i*=-1):"scaleY"===e&&i<0?(this.flipY=!this.flipY,i*=-1):"shadow"!==e||!i||i instanceof t.Shadow?"dirty"===e&&this.group&&this.group.set("dirty",i):i=new t.Shadow(i),this[e]=i,r&&(s=this.group&&this.group.isOnACache(),this.cacheProperties.indexOf(e)>-1?(this.dirty=!0,s&&this.group.set("dirty",!0)):s&&this.stateProperties.indexOf(e)>-1&&this.group.set("dirty",!0)),this},setOnGroup:function(){},getViewportTransform:function(){return this.canvas&&this.canvas.viewportTransform?this.canvas.viewportTransform:t.iMatrix.concat()},isNotVisible:function(){return 0===this.opacity||!this.width&&!this.height&&0===this.strokeWidth||!this.visible},render:function(e){this.isNotVisible()||this.canvas&&this.canvas.skipOffscreen&&!this.group&&!this.isOnScreen()||(e.save(),this._setupCompositeOperation(e),this.drawSelectionBackground(e),this.transform(e),this._setOpacity(e),this._setShadow(e,this),this.shouldCache()?(this.renderCache(),this.drawCacheOnCanvas(e)):(this._removeCacheCanvas(),this.dirty=!1,this.drawObject(e),this.objectCaching&&this.statefullCache&&this.saveState({propertySet:"cacheProperties"})),e.restore())},renderCache:function(e){e=e||{},this._cacheCanvas&&this._cacheContext||this._createCacheCanvas(),this.isCacheDirty()&&(this.statefullCache&&this.saveState({propertySet:"cacheProperties"}),this.drawObject(this._cacheContext,e.forClipping),this.dirty=!1)},_removeCacheCanvas:function(){this._cacheCanvas=null,this._cacheContext=null,this.cacheWidth=0,this.cacheHeight=0},hasStroke:function(){return this.stroke&&"transparent"!==this.stroke&&0!==this.strokeWidth},hasFill:function(){return this.fill&&"transparent"!==this.fill},needsItsOwnCache:function(){return!("stroke"!==this.paintFirst||!this.hasFill()||!this.hasStroke()||"object"!=typeof this.shadow)||!!this.clipPath},shouldCache:function(){return this.ownCaching=this.needsItsOwnCache()||this.objectCaching&&(!this.group||!this.group.isOnACache()),this.ownCaching},willDrawShadow:function(){return!!this.shadow&&(0!==this.shadow.offsetX||0!==this.shadow.offsetY)},drawClipPathOnCache:function(e,i){if(e.save(),i.inverted?e.globalCompositeOperation="destination-out":e.globalCompositeOperation="destination-in",i.absolutePositioned){var n=t.util.invertTransform(this.calcTransformMatrix());e.transform(n[0],n[1],n[2],n[3],n[4],n[5])}i.transform(e),e.scale(1/i.zoomX,1/i.zoomY),e.drawImage(i._cacheCanvas,-i.cacheTranslationX,-i.cacheTranslationY),e.restore()},drawObject:function(e,t){var i=this.fill,n=this.stroke;t?(this.fill="black",this.stroke="",this._setClippingProperties(e)):this._renderBackground(e),this._render(e),this._drawClipPath(e,this.clipPath),this.fill=i,this.stroke=n},_drawClipPath:function(e,t){t&&(t.canvas=this.canvas,t.shouldCache(),t._transformDone=!0,t.renderCache({forClipping:!0}),this.drawClipPathOnCache(e,t))},drawCacheOnCanvas:function(e){e.scale(1/this.zoomX,1/this.zoomY),e.drawImage(this._cacheCanvas,-this.cacheTranslationX,-this.cacheTranslationY)},isCacheDirty:function(e){if(this.isNotVisible())return!1;if(this._cacheCanvas&&this._cacheContext&&!e&&this._updateCacheCanvas())return!0;if(this.dirty||this.clipPath&&this.clipPath.absolutePositioned||this.statefullCache&&this.hasStateChanged("cacheProperties")){if(this._cacheCanvas&&this._cacheContext&&!e){var t=this.cacheWidth/this.zoomX,i=this.cacheHeight/this.zoomY;this._cacheContext.clearRect(-t/2,-i/2,t,i)}return!0}return!1},_renderBackground:function(e){if(this.backgroundColor){var t=this._getNonTransformedDimensions();e.fillStyle=this.backgroundColor,e.fillRect(-t.x/2,-t.y/2,t.x,t.y),this._removeShadow(e)}},_setOpacity:function(e){this.group&&!this.group._transformDone?e.globalAlpha=this.getObjectOpacity():e.globalAlpha*=this.opacity},_setStrokeStyles:function(e,t){var i=t.stroke;i&&(e.lineWidth=t.strokeWidth,e.lineCap=t.strokeLineCap,e.lineDashOffset=t.strokeDashOffset,e.lineJoin=t.strokeLineJoin,e.miterLimit=t.strokeMiterLimit,i.toLive?"percentage"===i.gradientUnits||i.gradientTransform||i.patternTransform?this._applyPatternForTransformedGradient(e,i):(e.strokeStyle=i.toLive(e,this),this._applyPatternGradientTransform(e,i)):e.strokeStyle=t.stroke)},_setFillStyles:function(e,t){var i=t.fill;i&&(i.toLive?(e.fillStyle=i.toLive(e,this),this._applyPatternGradientTransform(e,t.fill)):e.fillStyle=i)},_setClippingProperties:function(e){e.globalAlpha=1,e.strokeStyle="transparent",e.fillStyle="#000000"},_setLineDash:function(e,t){t&&0!==t.length&&(1&t.length&&t.push.apply(t,t),e.setLineDash(t))},_renderControls:function(e,i){var n,r,s,a=this.getViewportTransform(),l=this.calcTransformMatrix();r=void 0!==(i=i||{}).hasBorders?i.hasBorders:this.hasBorders,s=void 0!==i.hasControls?i.hasControls:this.hasControls,l=t.util.multiplyTransformMatrices(a,l),n=t.util.qrDecompose(l),e.save(),e.translate(n.translateX,n.translateY),e.lineWidth=1*this.borderScaleFactor,this.group||(e.globalAlpha=this.isMoving?this.borderOpacityWhenMoving:1),this.flipX&&(n.angle-=180),e.rotate(o(this.group?n.angle:this.angle)),i.forActiveSelection||this.group?r&&this.drawBordersInGroup(e,n,i):r&&this.drawBorders(e,i),s&&this.drawControls(e,i),e.restore()},_setShadow:function(e){if(this.shadow){var i,n=this.shadow,r=this.canvas,s=r&&r.viewportTransform[0]||1,o=r&&r.viewportTransform[3]||1;i=n.nonScaling?{scaleX:1,scaleY:1}:this.getObjectScaling(),r&&r._isRetinaScaling()&&(s*=t.devicePixelRatio,o*=t.devicePixelRatio),e.shadowColor=n.color,e.shadowBlur=n.blur*t.browserShadowBlurConstant*(s+o)*(i.scaleX+i.scaleY)/4,e.shadowOffsetX=n.offsetX*s*i.scaleX,e.shadowOffsetY=n.offsetY*o*i.scaleY}},_removeShadow:function(e){this.shadow&&(e.shadowColor="",e.shadowBlur=e.shadowOffsetX=e.shadowOffsetY=0)},_applyPatternGradientTransform:function(e,t){if(!t||!t.toLive)return{offsetX:0,offsetY:0};var i=t.gradientTransform||t.patternTransform,n=-this.width/2+t.offsetX||0,r=-this.height/2+t.offsetY||0;return"percentage"===t.gradientUnits?e.transform(this.width,0,0,this.height,n,r):e.transform(1,0,0,1,n,r),i&&e.transform(i[0],i[1],i[2],i[3],i[4],i[5]),{offsetX:n,offsetY:r}},_renderPaintInOrder:function(e){"stroke"===this.paintFirst?(this._renderStroke(e),this._renderFill(e)):(this._renderFill(e),this._renderStroke(e))},_render:function(){},_renderFill:function(e){this.fill&&(e.save(),this._setFillStyles(e,this),"evenodd"===this.fillRule?e.fill("evenodd"):e.fill(),e.restore())},_renderStroke:function(e){if(this.stroke&&0!==this.strokeWidth){if(this.shadow&&!this.shadow.affectStroke&&this._removeShadow(e),e.save(),this.strokeUniform&&this.group){var t=this.getObjectScaling();e.scale(1/t.scaleX,1/t.scaleY)}else this.strokeUniform&&e.scale(1/this.scaleX,1/this.scaleY);this._setLineDash(e,this.strokeDashArray),this._setStrokeStyles(e,this),e.stroke(),e.restore()}},_applyPatternForTransformedGradient:function(e,i){var n,r=this._limitCacheSize(this._getCacheCanvasDimensions()),s=t.util.createCanvasElement(),o=this.canvas.getRetinaScaling(),a=r.x/this.scaleX/o,l=r.y/this.scaleY/o;s.width=a,s.height=l,(n=s.getContext("2d")).beginPath(),n.moveTo(0,0),n.lineTo(a,0),n.lineTo(a,l),n.lineTo(0,l),n.closePath(),n.translate(a/2,l/2),n.scale(r.zoomX/this.scaleX/o,r.zoomY/this.scaleY/o),this._applyPatternGradientTransform(n,i),n.fillStyle=i.toLive(e),n.fill(),e.translate(-this.width/2-this.strokeWidth/2,-this.height/2-this.strokeWidth/2),e.scale(o*this.scaleX/r.zoomX,o*this.scaleY/r.zoomY),e.strokeStyle=n.createPattern(s,"no-repeat")},_findCenterFromElement:function(){return{x:this.left+this.width/2,y:this.top+this.height/2}},_assignTransformMatrixProps:function(){if(this.transformMatrix){var e=t.util.qrDecompose(this.transformMatrix);this.flipX=!1,this.flipY=!1,this.set("scaleX",e.scaleX),this.set("scaleY",e.scaleY),this.angle=e.angle,this.skewX=e.skewX,this.skewY=0}},_removeTransformMatrix:function(e){var i=this._findCenterFromElement();this.transformMatrix&&(this._assignTransformMatrixProps(),i=t.util.transformPoint(i,this.transformMatrix)),this.transformMatrix=null,e&&(this.scaleX*=e.scaleX,this.scaleY*=e.scaleY,this.cropX=e.cropX,this.cropY=e.cropY,i.x+=e.offsetLeft,i.y+=e.offsetTop,this.width=e.width,this.height=e.height),this.setPositionByOrigin(i,"center","center")},clone:function(e,i){var n=this.toObject(i);this.constructor.fromObject?this.constructor.fromObject(n,e):t.Object._fromObject("Object",n,e)},cloneAsImage:function(e,i){var n=this.toCanvasElement(i);return e&&e(new t.Image(n)),this},toCanvasElement:function(e){e||(e={});var i=t.util,n=i.saveObjectTransform(this),r=this.group,s=this.shadow,o=Math.abs,a=(e.multiplier||1)*(e.enableRetinaScaling?t.devicePixelRatio:1);delete this.group,e.withoutTransform&&i.resetObjectTransform(this),e.withoutShadow&&(this.shadow=null);var l,c,h,u,d=t.util.createCanvasElement(),f=this.getBoundingRect(!0,!0),g=this.shadow,p={x:0,y:0};g&&(c=g.blur,l=g.nonScaling?{scaleX:1,scaleY:1}:this.getObjectScaling(),p.x=2*Math.round(o(g.offsetX)+c)*o(l.scaleX),p.y=2*Math.round(o(g.offsetY)+c)*o(l.scaleY)),h=f.width+p.x,u=f.height+p.y,d.width=Math.ceil(h),d.height=Math.ceil(u);var m=new t.StaticCanvas(d,{enableRetinaScaling:!1,renderOnAddRemove:!1,skipOffscreen:!1});"jpeg"===e.format&&(m.backgroundColor="#fff"),this.setPositionByOrigin(new t.Point(m.width/2,m.height/2),"center","center");var _=this.canvas;m.add(this);var v=m.toCanvasElement(a||1,e);return this.shadow=s,this.set("canvas",_),r&&(this.group=r),this.set(n).setCoords(),m._objects=[],m.dispose(),m=null,v},toDataURL:function(e){return e||(e={}),t.util.toDataURL(this.toCanvasElement(e),e.format||"png",e.quality||1)},isType:function(e){return arguments.length>1?Array.from(arguments).includes(this.type):this.type===e},complexity:function(){return 1},toJSON:function(e){return this.toObject(e)},rotate:function(e){var t=("center"!==this.originX||"center"!==this.originY)&&this.centeredRotation;return t&&this._setOriginToCenter(),this.set("angle",e),t&&this._resetOrigin(),this},centerH:function(){return this.canvas&&this.canvas.centerObjectH(this),this},viewportCenterH:function(){return this.canvas&&this.canvas.viewportCenterObjectH(this),this},centerV:function(){return this.canvas&&this.canvas.centerObjectV(this),this},viewportCenterV:function(){return this.canvas&&this.canvas.viewportCenterObjectV(this),this},center:function(){return this.canvas&&this.canvas.centerObject(this),this},viewportCenter:function(){return this.canvas&&this.canvas.viewportCenterObject(this),this},getLocalPointer:function(e,i){i=i||this.canvas.getPointer(e);var n=new t.Point(i.x,i.y),r=this._getLeftTopCoords();return this.angle&&(n=t.util.rotatePoint(n,r,o(-this.angle))),{x:n.x-r.x,y:n.y-r.y}},_setupCompositeOperation:function(e){this.globalCompositeOperation&&(e.globalCompositeOperation=this.globalCompositeOperation)},dispose:function(){t.runningAnimations&&t.runningAnimations.cancelByTarget(this)}}),t.util.createAccessors&&t.util.createAccessors(t.Object),i(t.Object.prototype,t.Observable),t.Object.NUM_FRACTION_DIGITS=2,t.Object.ENLIVEN_PROPS=["clipPath"],t.Object._fromObject=function(e,i,r,s){var o=t[e];i=n(i,!0),t.util.enlivenPatterns([i.fill,i.stroke],(function(e){void 0!==e[0]&&(i.fill=e[0]),void 0!==e[1]&&(i.stroke=e[1]),t.util.enlivenObjectEnlivables(i,i,(function(){var e=s?new o(i[s],i):new o(i);r&&r(e)}))}))},t.Object.__uid=0)}(t),w=E.util.degreesToRadians,b={left:-.5,center:0,right:.5},C={top:-.5,center:0,bottom:.5},E.util.object.extend(E.Object.prototype,{translateToGivenOrigin:function(e,t,i,n,r){var s,o,a,l=e.x,c=e.y;return"string"==typeof t?t=b[t]:t-=.5,"string"==typeof n?n=b[n]:n-=.5,"string"==typeof i?i=C[i]:i-=.5,"string"==typeof r?r=C[r]:r-=.5,o=r-i,((s=n-t)||o)&&(a=this._getTransformedDimensions(),l=e.x+s*a.x,c=e.y+o*a.y),new E.Point(l,c)},translateToCenterPoint:function(e,t,i){var n=this.translateToGivenOrigin(e,t,i,"center","center");return this.angle?E.util.rotatePoint(n,e,w(this.angle)):n},translateToOriginPoint:function(e,t,i){var n=this.translateToGivenOrigin(e,"center","center",t,i);return this.angle?E.util.rotatePoint(n,e,w(this.angle)):n},getCenterPoint:function(){var e=new E.Point(this.left,this.top);return this.translateToCenterPoint(e,this.originX,this.originY)},getPointByOrigin:function(e,t){var i=this.getCenterPoint();return this.translateToOriginPoint(i,e,t)},toLocalPoint:function(e,t,i){var n,r,s=this.getCenterPoint();return n=void 0!==t&&void 0!==i?this.translateToGivenOrigin(s,"center","center",t,i):new E.Point(this.left,this.top),r=new E.Point(e.x,e.y),this.angle&&(r=E.util.rotatePoint(r,s,-w(this.angle))),r.subtractEquals(n)},setPositionByOrigin:function(e,t,i){var n=this.translateToCenterPoint(e,t,i),r=this.translateToOriginPoint(n,this.originX,this.originY);this.set("left",r.x),this.set("top",r.y)},adjustPosition:function(e){var t,i,n=w(this.angle),r=this.getScaledWidth(),s=E.util.cos(n)*r,o=E.util.sin(n)*r;t="string"==typeof this.originX?b[this.originX]:this.originX-.5,i="string"==typeof e?b[e]:e-.5,this.left+=s*(i-t),this.top+=o*(i-t),this.setCoords(),this.originX=e},_setOriginToCenter:function(){this._originalOriginX=this.originX,this._originalOriginY=this.originY;var e=this.getCenterPoint();this.originX="center",this.originY="center",this.left=e.x,this.top=e.y},_resetOrigin:function(){var e=this.translateToOriginPoint(this.getCenterPoint(),this._originalOriginX,this._originalOriginY);this.originX=this._originalOriginX,this.originY=this._originalOriginY,this.left=e.x,this.top=e.y,this._originalOriginX=null,this._originalOriginY=null},_getLeftTopCoords:function(){return this.translateToOriginPoint(this.getCenterPoint(),"left","top")}}),function(){var e=E.util,t=e.degreesToRadians,i=e.multiplyTransformMatrices,n=e.transformPoint;e.object.extend(E.Object.prototype,{oCoords:null,aCoords:null,lineCoords:null,ownMatrixCache:null,matrixCache:null,controls:{},_getCoords:function(e,t){return t?e?this.calcACoords():this.calcLineCoords():(this.aCoords&&this.lineCoords||this.setCoords(!0),e?this.aCoords:this.lineCoords)},getCoords:function(e,t){return i=this._getCoords(e,t),[new E.Point(i.tl.x,i.tl.y),new E.Point(i.tr.x,i.tr.y),new E.Point(i.br.x,i.br.y),new E.Point(i.bl.x,i.bl.y)];var i},intersectsWithRect:function(e,t,i,n){var r=this.getCoords(i,n);return"Intersection"===E.Intersection.intersectPolygonRectangle(r,e,t).status},intersectsWithObject:function(e,t,i){return"Intersection"===E.Intersection.intersectPolygonPolygon(this.getCoords(t,i),e.getCoords(t,i)).status||e.isContainedWithinObject(this,t,i)||this.isContainedWithinObject(e,t,i)},isContainedWithinObject:function(e,t,i){for(var n=this.getCoords(t,i),r=t?e.aCoords:e.lineCoords,s=0,o=e._getImageLines(r);s<4;s++)if(!e.containsPoint(n[s],o))return!1;return!0},isContainedWithinRect:function(e,t,i,n){var r=this.getBoundingRect(i,n);return r.left>=e.x&&r.left+r.width<=t.x&&r.top>=e.y&&r.top+r.height<=t.y},containsPoint:function(e,t,i,n){var r=this._getCoords(i,n),s=(t=t||this._getImageLines(r),this._findCrossPoints(e,t));return 0!==s&&s%2==1},isOnScreen:function(e){if(!this.canvas)return!1;var t=this.canvas.vptCoords.tl,i=this.canvas.vptCoords.br;return!!this.getCoords(!0,e).some((function(e){return e.x<=i.x&&e.x>=t.x&&e.y<=i.y&&e.y>=t.y}))||!!this.intersectsWithRect(t,i,!0,e)||this._containsCenterOfCanvas(t,i,e)},_containsCenterOfCanvas:function(e,t,i){var n={x:(e.x+t.x)/2,y:(e.y+t.y)/2};return!!this.containsPoint(n,null,!0,i)},isPartiallyOnScreen:function(e){if(!this.canvas)return!1;var t=this.canvas.vptCoords.tl,i=this.canvas.vptCoords.br;return!!this.intersectsWithRect(t,i,!0,e)||this.getCoords(!0,e).every((function(e){return(e.x>=i.x||e.x<=t.x)&&(e.y>=i.y||e.y<=t.y)}))&&this._containsCenterOfCanvas(t,i,e)},_getImageLines:function(e){return{topline:{o:e.tl,d:e.tr},rightline:{o:e.tr,d:e.br},bottomline:{o:e.br,d:e.bl},leftline:{o:e.bl,d:e.tl}}},_findCrossPoints:function(e,t){var i,n,r,s=0;for(var o in t)if(!((r=t[o]).o.y<e.y&&r.d.y<e.y||r.o.y>=e.y&&r.d.y>=e.y||(r.o.x===r.d.x&&r.o.x>=e.x?n=r.o.x:(i=(r.d.y-r.o.y)/(r.d.x-r.o.x),n=-(e.y-0*e.x-(r.o.y-i*r.o.x))/(0-i)),n>=e.x&&(s+=1),2!==s)))break;return s},getBoundingRect:function(t,i){var n=this.getCoords(t,i);return e.makeBoundingBoxFromPoints(n)},getScaledWidth:function(){return this._getTransformedDimensions().x},getScaledHeight:function(){return this._getTransformedDimensions().y},_constrainScale:function(e){return Math.abs(e)<this.minScaleLimit?e<0?-this.minScaleLimit:this.minScaleLimit:0===e?1e-4:e},scale:function(e){return this._set("scaleX",e),this._set("scaleY",e),this.setCoords()},scaleToWidth:function(e,t){var i=this.getBoundingRect(t).width/this.getScaledWidth();return this.scale(e/this.width/i)},scaleToHeight:function(e,t){var i=this.getBoundingRect(t).height/this.getScaledHeight();return this.scale(e/this.height/i)},calcLineCoords:function(){var i=this.getViewportTransform(),r=this.padding,s=t(this.angle),o=e.cos(s)*r,a=e.sin(s)*r,l=o+a,c=o-a,h=this.calcACoords(),u={tl:n(h.tl,i),tr:n(h.tr,i),bl:n(h.bl,i),br:n(h.br,i)};return r&&(u.tl.x-=c,u.tl.y-=l,u.tr.x+=l,u.tr.y-=c,u.bl.x-=l,u.bl.y+=c,u.br.x+=c,u.br.y+=l),u},calcOCoords:function(){var e=this._calcRotateMatrix(),t=this._calcTranslateMatrix(),n=this.getViewportTransform(),r=i(n,t),s=i(r,e),o=(s=i(s,[1/n[0],0,0,1/n[3],0,0]),this._calculateCurrentDimensions()),a={};return this.forEachControl((function(e,t,i){a[t]=e.positionHandler(o,s,i)})),a},calcACoords:function(){var e=this._calcRotateMatrix(),t=this._calcTranslateMatrix(),r=i(t,e),s=this._getTransformedDimensions(),o=s.x/2,a=s.y/2;return{tl:n({x:-o,y:-a},r),tr:n({x:o,y:-a},r),bl:n({x:-o,y:a},r),br:n({x:o,y:a},r)}},setCoords:function(e){return this.aCoords=this.calcACoords(),this.lineCoords=this.group?this.aCoords:this.calcLineCoords(),e||(this.oCoords=this.calcOCoords(),this._setCornerCoords&&this._setCornerCoords()),this},_calcRotateMatrix:function(){return e.calcRotateMatrix(this)},_calcTranslateMatrix:function(){var e=this.getCenterPoint();return[1,0,0,1,e.x,e.y]},transformMatrixKey:function(e){var t="_",i="";return!e&&this.group&&(i=this.group.transformMatrixKey(e)+t),i+this.top+t+this.left+t+this.scaleX+t+this.scaleY+t+this.skewX+t+this.skewY+t+this.angle+t+this.originX+t+this.originY+t+this.width+t+this.height+t+this.strokeWidth+this.flipX+this.flipY},calcTransformMatrix:function(e){var t=this.calcOwnMatrix();if(e||!this.group)return t;var n=this.transformMatrixKey(e),r=this.matrixCache||(this.matrixCache={});return r.key===n?r.value:(this.group&&(t=i(this.group.calcTransformMatrix(!1),t)),r.key=n,r.value=t,t)},calcOwnMatrix:function(){var t=this.transformMatrixKey(!0),i=this.ownMatrixCache||(this.ownMatrixCache={});if(i.key===t)return i.value;var n=this._calcTranslateMatrix(),r={angle:this.angle,translateX:n[4],translateY:n[5],scaleX:this.scaleX,scaleY:this.scaleY,skewX:this.skewX,skewY:this.skewY,flipX:this.flipX,flipY:this.flipY};return i.key=t,i.value=e.composeMatrix(r),i.value},_getNonTransformedDimensions:function(){var e=this.strokeWidth;return{x:this.width+e,y:this.height+e}},_getTransformedDimensions:function(t,i){void 0===t&&(t=this.skewX),void 0===i&&(i=this.skewY);var n,r,s,o=0===t&&0===i;if(this.strokeUniform?(r=this.width,s=this.height):(r=(n=this._getNonTransformedDimensions()).x,s=n.y),o)return this._finalizeDimensions(r*this.scaleX,s*this.scaleY);var a=e.sizeAfterTransform(r,s,{scaleX:this.scaleX,scaleY:this.scaleY,skewX:t,skewY:i});return this._finalizeDimensions(a.x,a.y)},_finalizeDimensions:function(e,t){return this.strokeUniform?{x:e+this.strokeWidth,y:t+this.strokeWidth}:{x:e,y:t}},_calculateCurrentDimensions:function(){var e=this.getViewportTransform(),t=this._getTransformedDimensions();return n(t,e,!0).scalarAdd(2*this.padding)}})}(),E.util.object.extend(E.Object.prototype,{sendToBack:function(){return this.group?E.StaticCanvas.prototype.sendToBack.call(this.group,this):this.canvas&&this.canvas.sendToBack(this),this},bringToFront:function(){return this.group?E.StaticCanvas.prototype.bringToFront.call(this.group,this):this.canvas&&this.canvas.bringToFront(this),this},sendBackwards:function(e){return this.group?E.StaticCanvas.prototype.sendBackwards.call(this.group,this,e):this.canvas&&this.canvas.sendBackwards(this,e),this},bringForward:function(e){return this.group?E.StaticCanvas.prototype.bringForward.call(this.group,this,e):this.canvas&&this.canvas.bringForward(this,e),this},moveTo:function(e){return this.group&&"activeSelection"!==this.group.type?E.StaticCanvas.prototype.moveTo.call(this.group,this,e):this.canvas&&this.canvas.moveTo(this,e),this}}),function(){function e(e,t){if(t){if(t.toLive)return e+": url(#SVGID_"+t.id+"); ";var i=new E.Color(t),n=e+": "+i.toRgb()+"; ",r=i.getAlpha();return 1!==r&&(n+=e+"-opacity: "+r.toString()+"; "),n}return e+": none; "}var t=E.util.toFixed;E.util.object.extend(E.Object.prototype,{getSvgStyles:function(t){var i=this.fillRule?this.fillRule:"nonzero",n=this.strokeWidth?this.strokeWidth:"0",r=this.strokeDashArray?this.strokeDashArray.join(" "):"none",s=this.strokeDashOffset?this.strokeDashOffset:"0",o=this.strokeLineCap?this.strokeLineCap:"butt",a=this.strokeLineJoin?this.strokeLineJoin:"miter",l=this.strokeMiterLimit?this.strokeMiterLimit:"4",c=void 0!==this.opacity?this.opacity:"1",h=this.visible?"":" visibility: hidden;",u=t?"":this.getSvgFilter(),d=e("fill",this.fill);return[e("stroke",this.stroke),"stroke-width: ",n,"; ","stroke-dasharray: ",r,"; ","stroke-linecap: ",o,"; ","stroke-dashoffset: ",s,"; ","stroke-linejoin: ",a,"; ","stroke-miterlimit: ",l,"; ",d,"fill-rule: ",i,"; ","opacity: ",c,";",u,h].join("")},getSvgSpanStyles:function(t,i){var n="; ",r=t.fontFamily?"font-family: "+(-1===t.fontFamily.indexOf("'")&&-1===t.fontFamily.indexOf('"')?"'"+t.fontFamily+"'":t.fontFamily)+n:"",s=t.strokeWidth?"stroke-width: "+t.strokeWidth+n:"",o=t.fontSize?"font-size: "+t.fontSize+"px"+n:"",a=t.fontStyle?"font-style: "+t.fontStyle+n:"",l=t.fontWeight?"font-weight: "+t.fontWeight+n:"",c=t.fill?e("fill",t.fill):"",h=t.stroke?e("stroke",t.stroke):"",u=this.getSvgTextDecoration(t);return u&&(u="text-decoration: "+u+n),[h,s,r,o,a,l,u,c,t.deltaY?"baseline-shift: "+-t.deltaY+"; ":"",i?"white-space: pre; ":""].join("")},getSvgTextDecoration:function(e){return["overline","underline","line-through"].filter((function(t){return e[t.replace("-","")]})).join(" ")},getSvgFilter:function(){return this.shadow?"filter: url(#SVGID_"+this.shadow.id+");":""},getSvgCommons:function(){return[this.id?'id="'+this.id+'" ':"",this.clipPath?'clip-path="url(#'+this.clipPath.clipPathId+')" ':""].join("")},getSvgTransform:function(e,t){var i=e?this.calcTransformMatrix():this.calcOwnMatrix();return'transform="'+E.util.matrixToSVG(i)+(t||"")+'" '},_setSVGBg:function(e){if(this.backgroundColor){var i=E.Object.NUM_FRACTION_DIGITS;e.push("\t\t<rect ",this._getFillAttributes(this.backgroundColor),' x="',t(-this.width/2,i),'" y="',t(-this.height/2,i),'" width="',t(this.width,i),'" height="',t(this.height,i),'"></rect>\n')}},toSVG:function(e){return this._createBaseSVGMarkup(this._toSVG(e),{reviver:e})},toClipPathSVG:function(e){return"\t"+this._createBaseClipPathSVGMarkup(this._toSVG(e),{reviver:e})},_createBaseClipPathSVGMarkup:function(e,t){var i=(t=t||{}).reviver,n=t.additionalTransform||"",r=[this.getSvgTransform(!0,n),this.getSvgCommons()].join(""),s=e.indexOf("COMMON_PARTS");return e[s]=r,i?i(e.join("")):e.join("")},_createBaseSVGMarkup:function(e,t){var i,n,r=(t=t||{}).noStyle,s=t.reviver,o=r?"":'style="'+this.getSvgStyles()+'" ',a=t.withShadow?'style="'+this.getSvgFilter()+'" ':"",l=this.clipPath,c=this.strokeUniform?'vector-effect="non-scaling-stroke" ':"",h=l&&l.absolutePositioned,u=this.stroke,d=this.fill,f=this.shadow,g=[],p=e.indexOf("COMMON_PARTS"),m=t.additionalTransform;return l&&(l.clipPathId="CLIPPATH_"+E.Object.__uid++,n='<clipPath id="'+l.clipPathId+'" >\n'+l.toClipPathSVG(s)+"</clipPath>\n"),h&&g.push("<g ",a,this.getSvgCommons()," >\n"),g.push("<g ",this.getSvgTransform(!1),h?"":a+this.getSvgCommons()," >\n"),i=[o,c,r?"":this.addPaintOrder()," ",m?'transform="'+m+'" ':""].join(""),e[p]=i,d&&d.toLive&&g.push(d.toSVG(this)),u&&u.toLive&&g.push(u.toSVG(this)),f&&g.push(f.toSVG(this)),l&&g.push(n),g.push(e.join("")),g.push("</g>\n"),h&&g.push("</g>\n"),s?s(g.join("")):g.join("")},addPaintOrder:function(){return"fill"!==this.paintFirst?' paint-order="'+this.paintFirst+'" ':""}})}(),function(){var e=E.util.object.extend,t="stateProperties";function i(t,i,n){var r={};n.forEach((function(e){r[e]=t[e]})),e(t[i],r,!0)}function n(e,t,i){if(e===t)return!0;if(Array.isArray(e)){if(!Array.isArray(t)||e.length!==t.length)return!1;for(var r=0,s=e.length;r<s;r++)if(!n(e[r],t[r]))return!1;return!0}if(e&&"object"==typeof e){var o,a=Object.keys(e);if(!t||"object"!=typeof t||!i&&a.length!==Object.keys(t).length)return!1;for(r=0,s=a.length;r<s;r++)if("canvas"!==(o=a[r])&&"group"!==o&&!n(e[o],t[o]))return!1;return!0}}E.util.object.extend(E.Object.prototype,{hasStateChanged:function(e){var i="_"+(e=e||t);return Object.keys(this[i]).length<this[e].length||!n(this[i],this,!0)},saveState:function(e){var n=e&&e.propertySet||t,r="_"+n;return this[r]?(i(this,r,this[n]),e&&e.stateProperties&&i(this,r,e.stateProperties),this):this.setupState(e)},setupState:function(e){var i=(e=e||{}).propertySet||t;return e.propertySet=i,this["_"+i]={},this.saveState(e),this}})}(),function(){var e=E.util.degreesToRadians;E.util.object.extend(E.Object.prototype,{_findTargetCorner:function(e,t){if(!this.hasControls||this.group||!this.canvas||this.canvas._activeObject!==this)return!1;var i,n,r,s=e.x,o=e.y,a=Object.keys(this.oCoords),l=a.length-1;for(this.__corner=0;l>=0;l--)if(r=a[l],this.isControlVisible(r)&&(n=this._getImageLines(t?this.oCoords[r].touchCorner:this.oCoords[r].corner),0!==(i=this._findCrossPoints({x:s,y:o},n))&&i%2==1))return this.__corner=r,r;return!1},forEachControl:function(e){for(var t in this.controls)e(this.controls[t],t,this)},_setCornerCoords:function(){var e=this.oCoords;for(var t in e){var i=this.controls[t];e[t].corner=i.calcCornerCoords(this.angle,this.cornerSize,e[t].x,e[t].y,!1),e[t].touchCorner=i.calcCornerCoords(this.angle,this.touchCornerSize,e[t].x,e[t].y,!0)}},drawSelectionBackground:function(t){if(!this.selectionBackgroundColor||this.canvas&&!this.canvas.interactive||this.canvas&&this.canvas._activeObject!==this)return this;t.save();var i=this.getCenterPoint(),n=this._calculateCurrentDimensions(),r=this.canvas.viewportTransform;return t.translate(i.x,i.y),t.scale(1/r[0],1/r[3]),t.rotate(e(this.angle)),t.fillStyle=this.selectionBackgroundColor,t.fillRect(-n.x/2,-n.y/2,n.x,n.y),t.restore(),this},drawBorders:function(e,t){t=t||{};var i=this._calculateCurrentDimensions(),n=this.borderScaleFactor,r=i.x+n,s=i.y+n,o=void 0!==t.hasControls?t.hasControls:this.hasControls,a=!1;return e.save(),e.strokeStyle=t.borderColor||this.borderColor,this._setLineDash(e,t.borderDashArray||this.borderDashArray),e.strokeRect(-r/2,-s/2,r,s),o&&(e.beginPath(),this.forEachControl((function(t,i,n){t.withConnection&&t.getVisibility(n,i)&&(a=!0,e.moveTo(t.x*r,t.y*s),e.lineTo(t.x*r+t.offsetX,t.y*s+t.offsetY))})),a&&e.stroke()),e.restore(),this},drawBordersInGroup:function(e,t,i){i=i||{};var n=E.util.sizeAfterTransform(this.width,this.height,t),r=this.strokeWidth,s=this.strokeUniform,o=this.borderScaleFactor,a=n.x+r*(s?this.canvas.getZoom():t.scaleX)+o,l=n.y+r*(s?this.canvas.getZoom():t.scaleY)+o;return e.save(),this._setLineDash(e,i.borderDashArray||this.borderDashArray),e.strokeStyle=i.borderColor||this.borderColor,e.strokeRect(-a/2,-l/2,a,l),e.restore(),this},drawControls:function(e,t){t=t||{},e.save();var i,n,r=this.canvas.getRetinaScaling();return e.setTransform(r,0,0,r,0,0),e.strokeStyle=e.fillStyle=t.cornerColor||this.cornerColor,this.transparentCorners||(e.strokeStyle=t.cornerStrokeColor||this.cornerStrokeColor),this._setLineDash(e,t.cornerDashArray||this.cornerDashArray),this.setCoords(),this.group&&(i=this.group.calcTransformMatrix()),this.forEachControl((function(r,s,o){n=o.oCoords[s],r.getVisibility(o,s)&&(i&&(n=E.util.transformPoint(n,i)),r.render(e,n.x,n.y,t,o))})),e.restore(),this},isControlVisible:function(e){return this.controls[e]&&this.controls[e].getVisibility(this,e)},setControlVisible:function(e,t){return this._controlsVisibility||(this._controlsVisibility={}),this._controlsVisibility[e]=t,this},setControlsVisibility:function(e){for(var t in e||(e={}),e)this.setControlVisible(t,e[t]);return this},onDeselect:function(){},onSelect:function(){}})}(),E.util.object.extend(E.StaticCanvas.prototype,{FX_DURATION:500,fxCenterObjectH:function(e,t){var i=function(){},n=(t=t||{}).onComplete||i,r=t.onChange||i,s=this;return E.util.animate({target:this,startValue:e.left,endValue:this.getCenterPoint().x,duration:this.FX_DURATION,onChange:function(t){e.set("left",t),s.requestRenderAll(),r()},onComplete:function(){e.setCoords(),n()}})},fxCenterObjectV:function(e,t){var i=function(){},n=(t=t||{}).onComplete||i,r=t.onChange||i,s=this;return E.util.animate({target:this,startValue:e.top,endValue:this.getCenterPoint().y,duration:this.FX_DURATION,onChange:function(t){e.set("top",t),s.requestRenderAll(),r()},onComplete:function(){e.setCoords(),n()}})},fxRemove:function(e,t){var i=function(){},n=(t=t||{}).onComplete||i,r=t.onChange||i,s=this;return E.util.animate({target:this,startValue:e.opacity,endValue:0,duration:this.FX_DURATION,onChange:function(t){e.set("opacity",t),s.requestRenderAll(),r()},onComplete:function(){s.remove(e),n()}})}}),E.util.object.extend(E.Object.prototype,{animate:function(){if(arguments[0]&&"object"==typeof arguments[0]){var e,t,i=[],n=[];for(e in arguments[0])i.push(e);for(var r=0,s=i.length;r<s;r++)e=i[r],t=r!==s-1,n.push(this._animate(e,arguments[0][e],arguments[1],t));return n}return this._animate.apply(this,arguments)},_animate:function(e,t,i,n){var r,s=this;t=t.toString(),i=i?E.util.object.clone(i):{},~e.indexOf(".")&&(r=e.split("."));var o=s.colorProperties.indexOf(e)>-1||r&&s.colorProperties.indexOf(r[1])>-1,a=r?this.get(r[0])[r[1]]:this.get(e);"from"in i||(i.from=a),o||(t=~t.indexOf("=")?a+parseFloat(t.replace("=","")):parseFloat(t));var l={target:this,startValue:i.from,endValue:t,byValue:i.by,easing:i.easing,duration:i.duration,abort:i.abort&&function(e,t,n){return i.abort.call(s,e,t,n)},onChange:function(t,o,a){r?s[r[0]][r[1]]=t:s.set(e,t),n||i.onChange&&i.onChange(t,o,a)},onComplete:function(e,t,r){n||(s.setCoords(),i.onComplete&&i.onComplete(e,t,r))}};return o?E.util.animateColor(l.startValue,l.endValue,l.duration,l):E.util.animate(l)}}),function(e){var t=e.fabric||(e.fabric={}),i=t.util.object.extend,n=t.util.object.clone,r={x1:1,x2:1,y1:1,y2:1};function s(e,t){var i=e.origin,n=e.axis1,r=e.axis2,s=e.dimension,o=t.nearest,a=t.center,l=t.farthest;return function(){switch(this.get(i)){case o:return Math.min(this.get(n),this.get(r));case a:return Math.min(this.get(n),this.get(r))+.5*this.get(s);case l:return Math.max(this.get(n),this.get(r))}}}t.Line?t.warn("fabric.Line is already defined"):(t.Line=t.util.createClass(t.Object,{type:"line",x1:0,y1:0,x2:0,y2:0,cacheProperties:t.Object.prototype.cacheProperties.concat("x1","x2","y1","y2"),initialize:function(e,t){e||(e=[0,0,0,0]),this.callSuper("initialize",t),this.set("x1",e[0]),this.set("y1",e[1]),this.set("x2",e[2]),this.set("y2",e[3]),this._setWidthHeight(t)},_setWidthHeight:function(e){e||(e={}),this.width=Math.abs(this.x2-this.x1),this.height=Math.abs(this.y2-this.y1),this.left="left"in e?e.left:this._getLeftToOriginX(),this.top="top"in e?e.top:this._getTopToOriginY()},_set:function(e,t){return this.callSuper("_set",e,t),void 0!==r[e]&&this._setWidthHeight(),this},_getLeftToOriginX:s({origin:"originX",axis1:"x1",axis2:"x2",dimension:"width"},{nearest:"left",center:"center",farthest:"right"}),_getTopToOriginY:s({origin:"originY",axis1:"y1",axis2:"y2",dimension:"height"},{nearest:"top",center:"center",farthest:"bottom"}),_render:function(e){e.beginPath();var t=this.calcLinePoints();e.moveTo(t.x1,t.y1),e.lineTo(t.x2,t.y2),e.lineWidth=this.strokeWidth;var i=e.strokeStyle;e.strokeStyle=this.stroke||e.fillStyle,this.stroke&&this._renderStroke(e),e.strokeStyle=i},_findCenterFromElement:function(){return{x:(this.x1+this.x2)/2,y:(this.y1+this.y2)/2}},toObject:function(e){return i(this.callSuper("toObject",e),this.calcLinePoints())},_getNonTransformedDimensions:function(){var e=this.callSuper("_getNonTransformedDimensions");return"butt"===this.strokeLineCap&&(0===this.width&&(e.y-=this.strokeWidth),0===this.height&&(e.x-=this.strokeWidth)),e},calcLinePoints:function(){var e=this.x1<=this.x2?-1:1,t=this.y1<=this.y2?-1:1,i=e*this.width*.5,n=t*this.height*.5;return{x1:i,x2:e*this.width*-.5,y1:n,y2:t*this.height*-.5}},_toSVG:function(){var e=this.calcLinePoints();return["<line ","COMMON_PARTS",'x1="',e.x1,'" y1="',e.y1,'" x2="',e.x2,'" y2="',e.y2,'" />\n']}}),t.Line.ATTRIBUTE_NAMES=t.SHARED_ATTRIBUTES.concat("x1 y1 x2 y2".split(" ")),t.Line.fromElement=function(e,n,r){r=r||{};var s=t.parseAttributes(e,t.Line.ATTRIBUTE_NAMES),o=[s.x1||0,s.y1||0,s.x2||0,s.y2||0];n(new t.Line(o,i(s,r)))},t.Line.fromObject=function(e,i){var r=n(e,!0);r.points=[e.x1,e.y1,e.x2,e.y2],t.Object._fromObject("Line",r,(function(e){delete e.points,i&&i(e)}),"points")})}(t),function(e){var t=e.fabric||(e.fabric={}),i=t.util.degreesToRadians;t.Circle?t.warn("fabric.Circle is already defined."):(t.Circle=t.util.createClass(t.Object,{type:"circle",radius:0,startAngle:0,endAngle:360,cacheProperties:t.Object.prototype.cacheProperties.concat("radius","startAngle","endAngle"),_set:function(e,t){return this.callSuper("_set",e,t),"radius"===e&&this.setRadius(t),this},toObject:function(e){return this.callSuper("toObject",["radius","startAngle","endAngle"].concat(e))},_toSVG:function(){var e,n=(this.endAngle-this.startAngle)%360;if(0===n)e=["<circle ","COMMON_PARTS",'cx="0" cy="0" ','r="',this.radius,'" />\n'];else{var r=i(this.startAngle),s=i(this.endAngle),o=this.radius;e=['<path d="M '+t.util.cos(r)*o+" "+t.util.sin(r)*o," A "+o+" "+o," 0 ",+(n>180?"1":"0")+" 1"," "+t.util.cos(s)*o+" "+t.util.sin(s)*o,'" ',"COMMON_PARTS"," />\n"]}return e},_render:function(e){e.beginPath(),e.arc(0,0,this.radius,i(this.startAngle),i(this.endAngle),!1),this._renderPaintInOrder(e)},getRadiusX:function(){return this.get("radius")*this.get("scaleX")},getRadiusY:function(){return this.get("radius")*this.get("scaleY")},setRadius:function(e){return this.radius=e,this.set("width",2*e).set("height",2*e)}}),t.Circle.ATTRIBUTE_NAMES=t.SHARED_ATTRIBUTES.concat("cx cy r".split(" ")),t.Circle.fromElement=function(e,i){var n,r=t.parseAttributes(e,t.Circle.ATTRIBUTE_NAMES);if(!("radius"in(n=r)&&n.radius>=0))throw new Error("value of `r` attribute is required and can not be negative");r.left=(r.left||0)-r.radius,r.top=(r.top||0)-r.radius,i(new t.Circle(r))},t.Circle.fromObject=function(e,i){t.Object._fromObject("Circle",e,i)})}(t),function(e){var t=e.fabric||(e.fabric={});t.Triangle?t.warn("fabric.Triangle is already defined"):(t.Triangle=t.util.createClass(t.Object,{type:"triangle",width:100,height:100,_render:function(e){var t=this.width/2,i=this.height/2;e.beginPath(),e.moveTo(-t,i),e.lineTo(0,-i),e.lineTo(t,i),e.closePath(),this._renderPaintInOrder(e)},_toSVG:function(){var e=this.width/2,t=this.height/2;return["<polygon ","COMMON_PARTS",'points="',[-e+" "+t,"0 "+-t,e+" "+t].join(","),'" />']}}),t.Triangle.fromObject=function(e,i){return t.Object._fromObject("Triangle",e,i)})}(t),function(e){var t=e.fabric||(e.fabric={}),i=2*Math.PI;t.Ellipse?t.warn("fabric.Ellipse is already defined."):(t.Ellipse=t.util.createClass(t.Object,{type:"ellipse",rx:0,ry:0,cacheProperties:t.Object.prototype.cacheProperties.concat("rx","ry"),initialize:function(e){this.callSuper("initialize",e),this.set("rx",e&&e.rx||0),this.set("ry",e&&e.ry||0)},_set:function(e,t){switch(this.callSuper("_set",e,t),e){case"rx":this.rx=t,this.set("width",2*t);break;case"ry":this.ry=t,this.set("height",2*t)}return this},getRx:function(){return this.get("rx")*this.get("scaleX")},getRy:function(){return this.get("ry")*this.get("scaleY")},toObject:function(e){return this.callSuper("toObject",["rx","ry"].concat(e))},_toSVG:function(){return["<ellipse ","COMMON_PARTS",'cx="0" cy="0" ','rx="',this.rx,'" ry="',this.ry,'" />\n']},_render:function(e){e.beginPath(),e.save(),e.transform(1,0,0,this.ry/this.rx,0,0),e.arc(0,0,this.rx,0,i,!1),e.restore(),this._renderPaintInOrder(e)}}),t.Ellipse.ATTRIBUTE_NAMES=t.SHARED_ATTRIBUTES.concat("cx cy rx ry".split(" ")),t.Ellipse.fromElement=function(e,i){var n=t.parseAttributes(e,t.Ellipse.ATTRIBUTE_NAMES);n.left=(n.left||0)-n.rx,n.top=(n.top||0)-n.ry,i(new t.Ellipse(n))},t.Ellipse.fromObject=function(e,i){t.Object._fromObject("Ellipse",e,i)})}(t),function(e){var t=e.fabric||(e.fabric={}),i=t.util.object.extend;t.Rect?t.warn("fabric.Rect is already defined"):(t.Rect=t.util.createClass(t.Object,{stateProperties:t.Object.prototype.stateProperties.concat("rx","ry"),type:"rect",rx:0,ry:0,cacheProperties:t.Object.prototype.cacheProperties.concat("rx","ry"),initialize:function(e){this.callSuper("initialize",e),this._initRxRy()},_initRxRy:function(){this.rx&&!this.ry?this.ry=this.rx:this.ry&&!this.rx&&(this.rx=this.ry)},_render:function(e){var t=this.rx?Math.min(this.rx,this.width/2):0,i=this.ry?Math.min(this.ry,this.height/2):0,n=this.width,r=this.height,s=-this.width/2,o=-this.height/2,a=0!==t||0!==i,l=.4477152502;e.beginPath(),e.moveTo(s+t,o),e.lineTo(s+n-t,o),a&&e.bezierCurveTo(s+n-l*t,o,s+n,o+l*i,s+n,o+i),e.lineTo(s+n,o+r-i),a&&e.bezierCurveTo(s+n,o+r-l*i,s+n-l*t,o+r,s+n-t,o+r),e.lineTo(s+t,o+r),a&&e.bezierCurveTo(s+l*t,o+r,s,o+r-l*i,s,o+r-i),e.lineTo(s,o+i),a&&e.bezierCurveTo(s,o+l*i,s+l*t,o,s+t,o),e.closePath(),this._renderPaintInOrder(e)},toObject:function(e){return this.callSuper("toObject",["rx","ry"].concat(e))},_toSVG:function(){return["<rect ","COMMON_PARTS",'x="',-this.width/2,'" y="',-this.height/2,'" rx="',this.rx,'" ry="',this.ry,'" width="',this.width,'" height="',this.height,'" />\n']}}),t.Rect.ATTRIBUTE_NAMES=t.SHARED_ATTRIBUTES.concat("x y rx ry width height".split(" ")),t.Rect.fromElement=function(e,n,r){if(!e)return n(null);r=r||{};var s=t.parseAttributes(e,t.Rect.ATTRIBUTE_NAMES);s.left=s.left||0,s.top=s.top||0,s.height=s.height||0,s.width=s.width||0;var o=new t.Rect(i(r?t.util.object.clone(r):{},s));o.visible=o.visible&&o.width>0&&o.height>0,n(o)},t.Rect.fromObject=function(e,i){return t.Object._fromObject("Rect",e,i)})}(t),function(e){var t=e.fabric||(e.fabric={}),i=t.util.object.extend,n=t.util.array.min,r=t.util.array.max,s=t.util.toFixed,o=t.util.projectStrokeOnPoints;t.Polyline?t.warn("fabric.Polyline is already defined"):(t.Polyline=t.util.createClass(t.Object,{type:"polyline",points:null,exactBoundingBox:!1,cacheProperties:t.Object.prototype.cacheProperties.concat("points"),initialize:function(e,t){t=t||{},this.points=e||[],this.callSuper("initialize",t),this._setPositionDimensions(t)},_projectStrokeOnPoints:function(){return o(this.points,this,!0)},_setPositionDimensions:function(e){var t,i=this._calcDimensions(e),n=this.exactBoundingBox?this.strokeWidth:0;this.width=i.width-n,this.height=i.height-n,e.fromSVG||(t=this.translateToGivenOrigin({x:i.left-this.strokeWidth/2+n/2,y:i.top-this.strokeWidth/2+n/2},"left","top",this.originX,this.originY)),void 0===e.left&&(this.left=e.fromSVG?i.left:t.x),void 0===e.top&&(this.top=e.fromSVG?i.top:t.y),this.pathOffset={x:i.left+this.width/2+n/2,y:i.top+this.height/2+n/2}},_calcDimensions:function(){var e=this.exactBoundingBox?this._projectStrokeOnPoints():this.points,t=n(e,"x")||0,i=n(e,"y")||0;return{left:t,top:i,width:(r(e,"x")||0)-t,height:(r(e,"y")||0)-i}},toObject:function(e){return i(this.callSuper("toObject",e),{points:this.points.concat()})},_toSVG:function(){for(var e=[],i=this.pathOffset.x,n=this.pathOffset.y,r=t.Object.NUM_FRACTION_DIGITS,o=0,a=this.points.length;o<a;o++)e.push(s(this.points[o].x-i,r),",",s(this.points[o].y-n,r)," ");return["<"+this.type+" ","COMMON_PARTS",'points="',e.join(""),'" />\n']},commonRender:function(e){var t,i=this.points.length,n=this.pathOffset.x,r=this.pathOffset.y;if(!i||isNaN(this.points[i-1].y))return!1;e.beginPath(),e.moveTo(this.points[0].x-n,this.points[0].y-r);for(var s=0;s<i;s++)t=this.points[s],e.lineTo(t.x-n,t.y-r);return!0},_render:function(e){this.commonRender(e)&&this._renderPaintInOrder(e)},complexity:function(){return this.get("points").length}}),t.Polyline.ATTRIBUTE_NAMES=t.SHARED_ATTRIBUTES.concat(),t.Polyline.fromElementGenerator=function(e){return function(n,r,s){if(!n)return r(null);s||(s={});var o=t.parsePointsAttribute(n.getAttribute("points")),a=t.parseAttributes(n,t[e].ATTRIBUTE_NAMES);a.fromSVG=!0,r(new t[e](o,i(a,s)))}},t.Polyline.fromElement=t.Polyline.fromElementGenerator("Polyline"),t.Polyline.fromObject=function(e,i){return t.Object._fromObject("Polyline",e,i,"points")})}(t),function(e){var t=e.fabric||(e.fabric={}),i=t.util.projectStrokeOnPoints;t.Polygon?t.warn("fabric.Polygon is already defined"):(t.Polygon=t.util.createClass(t.Polyline,{type:"polygon",_projectStrokeOnPoints:function(){return i(this.points,this)},_render:function(e){this.commonRender(e)&&(e.closePath(),this._renderPaintInOrder(e))}}),t.Polygon.ATTRIBUTE_NAMES=t.SHARED_ATTRIBUTES.concat(),t.Polygon.fromElement=t.Polyline.fromElementGenerator("Polygon"),t.Polygon.fromObject=function(e,i){t.Object._fromObject("Polygon",e,i,"points")})}(t),function(e){var t=e.fabric||(e.fabric={}),i=t.util.array.min,n=t.util.array.max,r=t.util.object.extend,s=t.util.object.clone,o=t.util.toFixed;t.Path?t.warn("fabric.Path is already defined"):(t.Path=t.util.createClass(t.Object,{type:"path",path:null,cacheProperties:t.Object.prototype.cacheProperties.concat("path","fillRule"),stateProperties:t.Object.prototype.stateProperties.concat("path"),initialize:function(e,t){delete(t=s(t||{})).path,this.callSuper("initialize",t),this._setPath(e||[],t)},_setPath:function(e,i){this.path=t.util.makePathSimpler(Array.isArray(e)?e:t.util.parsePath(e)),t.Polyline.prototype._setPositionDimensions.call(this,i||{})},_renderPathCommands:function(e){var t,i=0,n=0,r=0,s=0,o=0,a=0,l=-this.pathOffset.x,c=-this.pathOffset.y;e.beginPath();for(var h=0,u=this.path.length;h<u;++h)switch((t=this.path[h])[0]){case"L":r=t[1],s=t[2],e.lineTo(r+l,s+c);break;case"M":i=r=t[1],n=s=t[2],e.moveTo(r+l,s+c);break;case"C":r=t[5],s=t[6],o=t[3],a=t[4],e.bezierCurveTo(t[1]+l,t[2]+c,o+l,a+c,r+l,s+c);break;case"Q":e.quadraticCurveTo(t[1]+l,t[2]+c,t[3]+l,t[4]+c),r=t[3],s=t[4],o=t[1],a=t[2];break;case"z":case"Z":r=i,s=n,e.closePath()}},_render:function(e){this._renderPathCommands(e),this._renderPaintInOrder(e)},toString:function(){return"#<fabric.Path ("+this.complexity()+'): { "top": '+this.top+', "left": '+this.left+" }>"},toObject:function(e){return r(this.callSuper("toObject",e),{path:this.path.map((function(e){return e.slice()}))})},toDatalessObject:function(e){var t=this.toObject(["sourcePath"].concat(e));return t.sourcePath&&delete t.path,t},_toSVG:function(){return["<path ","COMMON_PARTS",'d="',t.util.joinPath(this.path),'" stroke-linecap="round" ',"/>\n"]},_getOffsetTransform:function(){var e=t.Object.NUM_FRACTION_DIGITS;return" translate("+o(-this.pathOffset.x,e)+", "+o(-this.pathOffset.y,e)+")"},toClipPathSVG:function(e){var t=this._getOffsetTransform();return"\t"+this._createBaseClipPathSVGMarkup(this._toSVG(),{reviver:e,additionalTransform:t})},toSVG:function(e){var t=this._getOffsetTransform();return this._createBaseSVGMarkup(this._toSVG(),{reviver:e,additionalTransform:t})},complexity:function(){return this.path.length},_calcDimensions:function(){for(var e,r,s=[],o=[],a=0,l=0,c=0,h=0,u=0,d=this.path.length;u<d;++u){switch((e=this.path[u])[0]){case"L":c=e[1],h=e[2],r=[];break;case"M":a=c=e[1],l=h=e[2],r=[];break;case"C":r=t.util.getBoundsOfCurve(c,h,e[1],e[2],e[3],e[4],e[5],e[6]),c=e[5],h=e[6];break;case"Q":r=t.util.getBoundsOfCurve(c,h,e[1],e[2],e[1],e[2],e[3],e[4]),c=e[3],h=e[4];break;case"z":case"Z":c=a,h=l}r.forEach((function(e){s.push(e.x),o.push(e.y)})),s.push(c),o.push(h)}var f=i(s)||0,g=i(o)||0;return{left:f,top:g,width:(n(s)||0)-f,height:(n(o)||0)-g}}}),t.Path.fromObject=function(e,i){if("string"==typeof e.sourcePath){var n=e.sourcePath;t.loadSVGFromURL(n,(function(t){var n=t[0];n.setOptions(e),i&&i(n)}))}else t.Object._fromObject("Path",e,i,"path")},t.Path.ATTRIBUTE_NAMES=t.SHARED_ATTRIBUTES.concat(["d"]),t.Path.fromElement=function(e,i,n){var s=t.parseAttributes(e,t.Path.ATTRIBUTE_NAMES);s.fromSVG=!0,i(new t.Path(s.d,r(s,n)))})}(t),function(e){var t=e.fabric||(e.fabric={}),i=t.util.array.min,n=t.util.array.max;t.Group||(t.Group=t.util.createClass(t.Object,t.Collection,{type:"group",strokeWidth:0,subTargetCheck:!1,cacheProperties:[],useSetOnGroup:!1,initialize:function(e,t,i){t=t||{},this._objects=[],i&&this.callSuper("initialize",t),this._objects=e||[];for(var n=this._objects.length;n--;)this._objects[n].group=this;if(i)this._updateObjectsACoords();else{var r=t&&t.centerPoint;void 0!==t.originX&&(this.originX=t.originX),void 0!==t.originY&&(this.originY=t.originY),r||this._calcBounds(),this._updateObjectsCoords(r),delete t.centerPoint,this.callSuper("initialize",t)}this.setCoords()},_updateObjectsACoords:function(){for(var e=this._objects.length;e--;)this._objects[e].setCoords(!0)},_updateObjectsCoords:function(e){e=e||this.getCenterPoint();for(var t=this._objects.length;t--;)this._updateObjectCoords(this._objects[t],e)},_updateObjectCoords:function(e,t){var i=e.left,n=e.top;e.set({left:i-t.x,top:n-t.y}),e.group=this,e.setCoords(!0)},toString:function(){return"#<fabric.Group: ("+this.complexity()+")>"},addWithUpdate:function(e){var i=!!this.group;return this._restoreObjectsState(),t.util.resetObjectTransform(this),e&&(i&&t.util.removeTransformFromObject(e,this.group.calcTransformMatrix()),this._objects.push(e),e.group=this,e._set("canvas",this.canvas)),this._calcBounds(),this._updateObjectsCoords(),this.dirty=!0,i?this.group.addWithUpdate():this.setCoords(),this},removeWithUpdate:function(e){return this._restoreObjectsState(),t.util.resetObjectTransform(this),this.remove(e),this._calcBounds(),this._updateObjectsCoords(),this.setCoords(),this.dirty=!0,this},_onObjectAdded:function(e){this.dirty=!0,e.group=this,e._set("canvas",this.canvas)},_onObjectRemoved:function(e){this.dirty=!0,delete e.group},_set:function(e,i){var n=this._objects.length;if(this.useSetOnGroup)for(;n--;)this._objects[n].setOnGroup(e,i);if("canvas"===e)for(;n--;)this._objects[n]._set(e,i);t.Object.prototype._set.call(this,e,i)},toObject:function(e){var i=this.includeDefaultValues,n=this._objects.filter((function(e){return!e.excludeFromExport})).map((function(t){var n=t.includeDefaultValues;t.includeDefaultValues=i;var r=t.toObject(e);return t.includeDefaultValues=n,r})),r=t.Object.prototype.toObject.call(this,e);return r.objects=n,r},toDatalessObject:function(e){var i,n=this.sourcePath;if(n)i=n;else{var r=this.includeDefaultValues;i=this._objects.map((function(t){var i=t.includeDefaultValues;t.includeDefaultValues=r;var n=t.toDatalessObject(e);return t.includeDefaultValues=i,n}))}var s=t.Object.prototype.toDatalessObject.call(this,e);return s.objects=i,s},render:function(e){this._transformDone=!0,this.callSuper("render",e),this._transformDone=!1},shouldCache:function(){var e=t.Object.prototype.shouldCache.call(this);if(e)for(var i=0,n=this._objects.length;i<n;i++)if(this._objects[i].willDrawShadow())return this.ownCaching=!1,!1;return e},willDrawShadow:function(){if(t.Object.prototype.willDrawShadow.call(this))return!0;for(var e=0,i=this._objects.length;e<i;e++)if(this._objects[e].willDrawShadow())return!0;return!1},isOnACache:function(){return this.ownCaching||this.group&&this.group.isOnACache()},drawObject:function(e){for(var t=0,i=this._objects.length;t<i;t++)this._objects[t].render(e);this._drawClipPath(e,this.clipPath)},isCacheDirty:function(e){if(this.callSuper("isCacheDirty",e))return!0;if(!this.statefullCache)return!1;for(var t=0,i=this._objects.length;t<i;t++)if(this._objects[t].isCacheDirty(!0)){if(this._cacheCanvas){var n=this.cacheWidth/this.zoomX,r=this.cacheHeight/this.zoomY;this._cacheContext.clearRect(-n/2,-r/2,n,r)}return!0}return!1},_restoreObjectsState:function(){var e=this.calcOwnMatrix();return this._objects.forEach((function(i){t.util.addTransformToObject(i,e),delete i.group,i.setCoords()})),this},destroy:function(){return this._objects.forEach((function(e){e.set("dirty",!0)})),this._restoreObjectsState()},dispose:function(){this.callSuper("dispose"),this.forEachObject((function(e){e.dispose&&e.dispose()})),this._objects=[]},toActiveSelection:function(){if(this.canvas){var e=this._objects,i=this.canvas;this._objects=[];var n=this.toObject();delete n.objects;var r=new t.ActiveSelection([]);return r.set(n),r.type="activeSelection",i.remove(this),e.forEach((function(e){e.group=r,e.dirty=!0,i.add(e)})),r.canvas=i,r._objects=e,i._activeObject=r,r.setCoords(),r}},ungroupOnCanvas:function(){return this._restoreObjectsState()},setObjectsCoords:function(){return this.forEachObject((function(e){e.setCoords(!0)})),this},_calcBounds:function(e){for(var t,i,n,r,s=[],o=[],a=["tr","br","bl","tl"],l=0,c=this._objects.length,h=a.length;l<c;++l){for(n=(t=this._objects[l]).calcACoords(),r=0;r<h;r++)i=a[r],s.push(n[i].x),o.push(n[i].y);t.aCoords=n}this._getBounds(s,o,e)},_getBounds:function(e,r,s){var o=new t.Point(i(e),i(r)),a=new t.Point(n(e),n(r)),l=o.y||0,c=o.x||0,h=a.x-o.x||0,u=a.y-o.y||0;this.width=h,this.height=u,s||this.setPositionByOrigin({x:c,y:l},"left","top")},_toSVG:function(e){for(var t=["<g ","COMMON_PARTS"," >\n"],i=0,n=this._objects.length;i<n;i++)t.push("\t\t",this._objects[i].toSVG(e));return t.push("</g>\n"),t},getSvgStyles:function(){var e=void 0!==this.opacity&&1!==this.opacity?"opacity: "+this.opacity+";":"",t=this.visible?"":" visibility: hidden;";return[e,this.getSvgFilter(),t].join("")},toClipPathSVG:function(e){for(var t=[],i=0,n=this._objects.length;i<n;i++)t.push("\t",this._objects[i].toClipPathSVG(e));return this._createBaseClipPathSVGMarkup(t,{reviver:e})}}),t.Group.fromObject=function(e,i){var n=e.objects,r=t.util.object.clone(e,!0);delete r.objects,"string"!=typeof n?t.util.enlivenObjects(n,(function(n){var r=t.util.object.clone(e,!0);delete r.objects,t.util.enlivenObjectEnlivables(e,r,(function(){i&&i(new t.Group(n,r,!0))}))})):t.loadSVGFromURL(n,(function(s){var o=t.util.groupSVGElements(s,e,n);o.set(r),i&&i(o)}))})}(t),function(e){var t=e.fabric||(e.fabric={});t.ActiveSelection||(t.ActiveSelection=t.util.createClass(t.Group,{type:"activeSelection",initialize:function(e,i){i=i||{},this._objects=e||[];for(var n=this._objects.length;n--;)this._objects[n].group=this;i.originX&&(this.originX=i.originX),i.originY&&(this.originY=i.originY),this._calcBounds(),this._updateObjectsCoords(),t.Object.prototype.initialize.call(this,i),this.setCoords()},toGroup:function(){var e=this._objects.concat();this._objects=[];var i=t.Object.prototype.toObject.call(this),n=new t.Group([]);if(delete i.type,n.set(i),e.forEach((function(e){e.canvas.remove(e),e.group=n})),n._objects=e,!this.canvas)return n;var r=this.canvas;return r.add(n),r._activeObject=n,n.setCoords(),n},onDeselect:function(){return this.destroy(),!1},toString:function(){return"#<fabric.ActiveSelection: ("+this.complexity()+")>"},shouldCache:function(){return!1},isOnACache:function(){return!1},_renderControls:function(e,t,i){e.save(),e.globalAlpha=this.isMoving?this.borderOpacityWhenMoving:1,this.callSuper("_renderControls",e,t),void 0===(i=i||{}).hasControls&&(i.hasControls=!1),i.forActiveSelection=!0;for(var n=0,r=this._objects.length;n<r;n++)this._objects[n]._renderControls(e,i);e.restore()}}),t.ActiveSelection.fromObject=function(e,i){t.util.enlivenObjects(e.objects,(function(n){delete e.objects,i&&i(new t.ActiveSelection(n,e,!0))}))})}(t),function(e){var t=E.util.object.extend;e.fabric||(e.fabric={}),e.fabric.Image?E.warn("fabric.Image is already defined."):(E.Image=E.util.createClass(E.Object,{type:"image",strokeWidth:0,srcFromAttribute:!1,_lastScaleX:1,_lastScaleY:1,_filterScalingX:1,_filterScalingY:1,minimumScaleTrigger:.5,stateProperties:E.Object.prototype.stateProperties.concat("cropX","cropY"),cacheProperties:E.Object.prototype.cacheProperties.concat("cropX","cropY"),cacheKey:"",cropX:0,cropY:0,imageSmoothing:!0,initialize:function(e,t){t||(t={}),this.filters=[],this.cacheKey="texture"+E.Object.__uid++,this.callSuper("initialize",t),this._initElement(e,t)},getElement:function(){return this._element||{}},setElement:function(e,t){return this.removeTexture(this.cacheKey),this.removeTexture(this.cacheKey+"_filtered"),this._element=e,this._originalElement=e,this._initConfig(t),0!==this.filters.length&&this.applyFilters(),this.resizeFilter&&this.applyResizeFilters(),this},removeTexture:function(e){var t=E.filterBackend;t&&t.evictCachesForKey&&t.evictCachesForKey(e)},dispose:function(){this.callSuper("dispose"),this.removeTexture(this.cacheKey),this.removeTexture(this.cacheKey+"_filtered"),this._cacheContext=void 0,["_originalElement","_element","_filteredEl","_cacheCanvas"].forEach(function(e){E.util.cleanUpJsdomNode(this[e]),this[e]=void 0}.bind(this))},getCrossOrigin:function(){return this._originalElement&&(this._originalElement.crossOrigin||null)},getOriginalSize:function(){var e=this.getElement();return{width:e.naturalWidth||e.width,height:e.naturalHeight||e.height}},_stroke:function(e){if(this.stroke&&0!==this.strokeWidth){var t=this.width/2,i=this.height/2;e.beginPath(),e.moveTo(-t,-i),e.lineTo(t,-i),e.lineTo(t,i),e.lineTo(-t,i),e.lineTo(-t,-i),e.closePath()}},toObject:function(e){var i=[];this.filters.forEach((function(e){e&&i.push(e.toObject())}));var n=t(this.callSuper("toObject",["cropX","cropY"].concat(e)),{src:this.getSrc(),crossOrigin:this.getCrossOrigin(),filters:i});return this.resizeFilter&&(n.resizeFilter=this.resizeFilter.toObject()),n},hasCrop:function(){return this.cropX||this.cropY||this.width<this._element.width||this.height<this._element.height},_toSVG:function(){var e,t=[],i=[],n=this._element,r=-this.width/2,s=-this.height/2,o="",a="";if(!n)return[];if(this.hasCrop()){var l=E.Object.__uid++;t.push('<clipPath id="imageCrop_'+l+'">\n','\t<rect x="'+r+'" y="'+s+'" width="'+this.width+'" height="'+this.height+'" />\n',"</clipPath>\n"),o=' clip-path="url(#imageCrop_'+l+')" '}if(this.imageSmoothing||(a='" image-rendering="optimizeSpeed'),i.push("\t<image ","COMMON_PARTS",'xlink:href="',this.getSvgSrc(!0),'" x="',r-this.cropX,'" y="',s-this.cropY,'" width="',n.width||n.naturalWidth,'" height="',n.height||n.height,a,'"',o,"></image>\n"),this.stroke||this.strokeDashArray){var c=this.fill;this.fill=null,e=["\t<rect ",'x="',r,'" y="',s,'" width="',this.width,'" height="',this.height,'" style="',this.getSvgStyles(),'"/>\n'],this.fill=c}return"fill"!==this.paintFirst?t.concat(e,i):t.concat(i,e)},getSrc:function(e){var t=e?this._element:this._originalElement;return t?t.toDataURL?t.toDataURL():this.srcFromAttribute?t.getAttribute("src"):t.src:this.src||""},setSrc:function(e,t,i){return E.util.loadImage(e,(function(e,n){this.setElement(e,i),this._setWidthHeight(),t&&t(this,n)}),this,i&&i.crossOrigin),this},toString:function(){return'#<fabric.Image: { src: "'+this.getSrc()+'" }>'},applyResizeFilters:function(){var e=this.resizeFilter,t=this.minimumScaleTrigger,i=this.getTotalObjectScaling(),n=i.scaleX,r=i.scaleY,s=this._filteredEl||this._originalElement;if(this.group&&this.set("dirty",!0),!e||n>t&&r>t)return this._element=s,this._filterScalingX=1,this._filterScalingY=1,this._lastScaleX=n,void(this._lastScaleY=r);E.filterBackend||(E.filterBackend=E.initFilterBackend());var o=E.util.createCanvasElement(),a=this._filteredEl?this.cacheKey+"_filtered":this.cacheKey,l=s.width,c=s.height;o.width=l,o.height=c,this._element=o,this._lastScaleX=e.scaleX=n,this._lastScaleY=e.scaleY=r,E.filterBackend.applyFilters([e],s,l,c,this._element,a),this._filterScalingX=o.width/this._originalElement.width,this._filterScalingY=o.height/this._originalElement.height},applyFilters:function(e){if(e=(e=e||this.filters||[]).filter((function(e){return e&&!e.isNeutralState()})),this.set("dirty",!0),this.removeTexture(this.cacheKey+"_filtered"),0===e.length)return this._element=this._originalElement,this._filteredEl=null,this._filterScalingX=1,this._filterScalingY=1,this;var t=this._originalElement,i=t.naturalWidth||t.width,n=t.naturalHeight||t.height;if(this._element===this._originalElement){var r=E.util.createCanvasElement();r.width=i,r.height=n,this._element=r,this._filteredEl=r}else this._element=this._filteredEl,this._filteredEl.getContext("2d").clearRect(0,0,i,n),this._lastScaleX=1,this._lastScaleY=1;return E.filterBackend||(E.filterBackend=E.initFilterBackend()),E.filterBackend.applyFilters(e,this._originalElement,i,n,this._element,this.cacheKey),this._originalElement.width===this._element.width&&this._originalElement.height===this._element.height||(this._filterScalingX=this._element.width/this._originalElement.width,this._filterScalingY=this._element.height/this._originalElement.height),this},_render:function(e){E.util.setImageSmoothing(e,this.imageSmoothing),!0!==this.isMoving&&this.resizeFilter&&this._needsResize()&&this.applyResizeFilters(),this._stroke(e),this._renderPaintInOrder(e)},drawCacheOnCanvas:function(e){E.util.setImageSmoothing(e,this.imageSmoothing),E.Object.prototype.drawCacheOnCanvas.call(this,e)},shouldCache:function(){return this.needsItsOwnCache()},_renderFill:function(e){var t=this._element;if(t){var i=this._filterScalingX,n=this._filterScalingY,r=this.width,s=this.height,o=Math.min,a=Math.max,l=a(this.cropX,0),c=a(this.cropY,0),h=t.naturalWidth||t.width,u=t.naturalHeight||t.height,d=l*i,f=c*n,g=o(r*i,h-d),p=o(s*n,u-f),m=-r/2,_=-s/2,v=o(r,h/i-l),y=o(s,u/n-c);t&&e.drawImage(t,d,f,g,p,m,_,v,y)}},_needsResize:function(){var e=this.getTotalObjectScaling();return e.scaleX!==this._lastScaleX||e.scaleY!==this._lastScaleY},_resetWidthHeight:function(){this.set(this.getOriginalSize())},_initElement:function(e,t){this.setElement(E.util.getById(e),t),E.util.addClass(this.getElement(),E.Image.CSS_CANVAS)},_initConfig:function(e){e||(e={}),this.setOptions(e),this._setWidthHeight(e)},_initFilters:function(e,t){e&&e.length?E.util.enlivenObjects(e,(function(e){t&&t(e)}),"fabric.Image.filters"):t&&t()},_setWidthHeight:function(e){e||(e={});var t=this.getElement();this.width=e.width||t.naturalWidth||t.width||0,this.height=e.height||t.naturalHeight||t.height||0},parsePreserveAspectRatioAttribute:function(){var e,t=E.util.parsePreserveAspectRatioAttribute(this.preserveAspectRatio||""),i=this._element.width,n=this._element.height,r=1,s=1,o=0,a=0,l=0,c=0,h=this.width,u=this.height,d={width:h,height:u};return!t||"none"===t.alignX&&"none"===t.alignY?(r=h/i,s=u/n):("meet"===t.meetOrSlice&&(e=(h-i*(r=s=E.util.findScaleToFit(this._element,d)))/2,"Min"===t.alignX&&(o=-e),"Max"===t.alignX&&(o=e),e=(u-n*s)/2,"Min"===t.alignY&&(a=-e),"Max"===t.alignY&&(a=e)),"slice"===t.meetOrSlice&&(e=i-h/(r=s=E.util.findScaleToCover(this._element,d)),"Mid"===t.alignX&&(l=e/2),"Max"===t.alignX&&(l=e),e=n-u/s,"Mid"===t.alignY&&(c=e/2),"Max"===t.alignY&&(c=e),i=h/r,n=u/s)),{width:i,height:n,scaleX:r,scaleY:s,offsetLeft:o,offsetTop:a,cropX:l,cropY:c}}}),E.Image.CSS_CANVAS="canvas-img",E.Image.prototype.getSvgSrc=E.Image.prototype.getSrc,E.Image.fromObject=function(e,t){var i=E.util.object.clone(e);E.util.loadImage(i.src,(function(e,n){n?t&&t(null,!0):E.Image.prototype._initFilters.call(i,i.filters,(function(n){i.filters=n||[],E.Image.prototype._initFilters.call(i,[i.resizeFilter],(function(n){i.resizeFilter=n[0],E.util.enlivenObjectEnlivables(i,i,(function(){var n=new E.Image(e,i);t(n,!1)}))}))}))}),null,i.crossOrigin)},E.Image.fromURL=function(e,t,i){E.util.loadImage(e,(function(e,n){t&&t(new E.Image(e,i),n)}),null,i&&i.crossOrigin)},E.Image.ATTRIBUTE_NAMES=E.SHARED_ATTRIBUTES.concat("x y width height preserveAspectRatio xlink:href crossOrigin image-rendering".split(" ")),E.Image.fromElement=function(e,i,n){var r=E.parseAttributes(e,E.Image.ATTRIBUTE_NAMES);E.Image.fromURL(r["xlink:href"],i,t(n?E.util.object.clone(n):{},r))})}(t),E.util.object.extend(E.Object.prototype,{_getAngleValueForStraighten:function(){var e=this.angle%360;return e>0?90*Math.round((e-1)/90):90*Math.round(e/90)},straighten:function(){return this.rotate(this._getAngleValueForStraighten())},fxStraighten:function(e){var t=function(){},i=(e=e||{}).onComplete||t,n=e.onChange||t,r=this;return E.util.animate({target:this,startValue:this.get("angle"),endValue:this._getAngleValueForStraighten(),duration:this.FX_DURATION,onChange:function(e){r.rotate(e),n()},onComplete:function(){r.setCoords(),i()}})}}),E.util.object.extend(E.StaticCanvas.prototype,{straightenObject:function(e){return e.straighten(),this.requestRenderAll(),this},fxStraightenObject:function(e){return e.fxStraighten({onChange:this.requestRenderAllBound})}}),function(){function e(e,t){var i="precision "+t+" float;\nvoid main(){}",n=e.createShader(e.FRAGMENT_SHADER);return e.shaderSource(n,i),e.compileShader(n),!!e.getShaderParameter(n,e.COMPILE_STATUS)}function t(e){e&&e.tileSize&&(this.tileSize=e.tileSize),this.setupGLContext(this.tileSize,this.tileSize),this.captureGPUInfo()}E.isWebglSupported=function(t){if(E.isLikelyNode)return!1;t=t||E.WebglFilterBackend.prototype.tileSize;var i=document.createElement("canvas"),n=i.getContext("webgl")||i.getContext("experimental-webgl"),r=!1;if(n){E.maxTextureSize=n.getParameter(n.MAX_TEXTURE_SIZE),r=E.maxTextureSize>=t;for(var s=["highp","mediump","lowp"],o=0;o<3;o++)if(e(n,s[o])){E.webGlPrecision=s[o];break}}return this.isSupported=r,r},E.WebglFilterBackend=t,t.prototype={tileSize:2048,resources:{},setupGLContext:function(e,t){this.dispose(),this.createWebGLCanvas(e,t),this.aPosition=new Float32Array([0,0,0,1,1,0,1,1]),this.chooseFastestCopyGLTo2DMethod(e,t)},chooseFastestCopyGLTo2DMethod:function(e,t){var i,n=void 0!==window.performance;try{new ImageData(1,1),i=!0}catch(e){i=!1}var r="undefined"!=typeof ArrayBuffer,s="undefined"!=typeof Uint8ClampedArray;if(n&&i&&r&&s){var o=E.util.createCanvasElement(),a=new ArrayBuffer(e*t*4);if(E.forceGLPutImageData)return this.imageBuffer=a,void(this.copyGLTo2D=I);var l,c,h={imageBuffer:a,destinationWidth:e,destinationHeight:t,targetCanvas:o};o.width=e,o.height=t,l=window.performance.now(),x.call(h,this.gl,h),c=window.performance.now()-l,l=window.performance.now(),I.call(h,this.gl,h),c>window.performance.now()-l?(this.imageBuffer=a,this.copyGLTo2D=I):this.copyGLTo2D=x}},createWebGLCanvas:function(e,t){var i=E.util.createCanvasElement();i.width=e,i.height=t;var n={alpha:!0,premultipliedAlpha:!1,depth:!1,stencil:!1,antialias:!1},r=i.getContext("webgl",n);r||(r=i.getContext("experimental-webgl",n)),r&&(r.clearColor(0,0,0,0),this.canvas=i,this.gl=r)},applyFilters:function(e,t,i,n,r,s){var o,a=this.gl;s&&(o=this.getCachedTexture(s,t));var l={originalWidth:t.width||t.originalWidth,originalHeight:t.height||t.originalHeight,sourceWidth:i,sourceHeight:n,destinationWidth:i,destinationHeight:n,context:a,sourceTexture:this.createTexture(a,i,n,!o&&t),targetTexture:this.createTexture(a,i,n),originalTexture:o||this.createTexture(a,i,n,!o&&t),passes:e.length,webgl:!0,aPosition:this.aPosition,programCache:this.programCache,pass:0,filterBackend:this,targetCanvas:r},c=a.createFramebuffer();return a.bindFramebuffer(a.FRAMEBUFFER,c),e.forEach((function(e){e&&e.applyTo(l)})),function(e){var t=e.targetCanvas,i=t.width,n=t.height,r=e.destinationWidth,s=e.destinationHeight;i===r&&n===s||(t.width=r,t.height=s)}(l),this.copyGLTo2D(a,l),a.bindTexture(a.TEXTURE_2D,null),a.deleteTexture(l.sourceTexture),a.deleteTexture(l.targetTexture),a.deleteFramebuffer(c),r.getContext("2d").setTransform(1,0,0,1,0,0),l},dispose:function(){this.canvas&&(this.canvas=null,this.gl=null),this.clearWebGLCaches()},clearWebGLCaches:function(){this.programCache={},this.textureCache={}},createTexture:function(e,t,i,n){var r=e.createTexture();return e.bindTexture(e.TEXTURE_2D,r),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.NEAREST),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.NEAREST),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),n?e.texImage2D(e.TEXTURE_2D,0,e.RGBA,e.RGBA,e.UNSIGNED_BYTE,n):e.texImage2D(e.TEXTURE_2D,0,e.RGBA,t,i,0,e.RGBA,e.UNSIGNED_BYTE,null),r},getCachedTexture:function(e,t){if(this.textureCache[e])return this.textureCache[e];var i=this.createTexture(this.gl,t.width,t.height,t);return this.textureCache[e]=i,i},evictCachesForKey:function(e){this.textureCache[e]&&(this.gl.deleteTexture(this.textureCache[e]),delete this.textureCache[e])},copyGLTo2D:x,captureGPUInfo:function(){if(this.gpuInfo)return this.gpuInfo;var e=this.gl,t={renderer:"",vendor:""};if(!e)return t;var i=e.getExtension("WEBGL_debug_renderer_info");if(i){var n=e.getParameter(i.UNMASKED_RENDERER_WEBGL),r=e.getParameter(i.UNMASKED_VENDOR_WEBGL);n&&(t.renderer=n.toLowerCase()),r&&(t.vendor=r.toLowerCase())}return this.gpuInfo=t,t}}}(),function(){var e=function(){};function t(){}E.Canvas2dFilterBackend=t,t.prototype={evictCachesForKey:e,dispose:e,clearWebGLCaches:e,resources:{},applyFilters:function(e,t,i,n,r){var s=r.getContext("2d");s.drawImage(t,0,0,i,n);var o={sourceWidth:i,sourceHeight:n,imageData:s.getImageData(0,0,i,n),originalEl:t,originalImageData:s.getImageData(0,0,i,n),canvasEl:r,ctx:s,filterBackend:this};return e.forEach((function(e){e.applyTo(o)})),o.imageData.width===i&&o.imageData.height===n||(r.width=o.imageData.width,r.height=o.imageData.height),s.putImageData(o.imageData,0,0),o}}}(),E.Image=E.Image||{},E.Image.filters=E.Image.filters||{},E.Image.filters.BaseFilter=E.util.createClass({type:"BaseFilter",vertexSource:"attribute vec2 aPosition;\nvarying vec2 vTexCoord;\nvoid main() {\nvTexCoord = aPosition;\ngl_Position = vec4(aPosition * 2.0 - 1.0, 0.0, 1.0);\n}",fragmentSource:"precision highp float;\nvarying vec2 vTexCoord;\nuniform sampler2D uTexture;\nvoid main() {\ngl_FragColor = texture2D(uTexture, vTexCoord);\n}",initialize:function(e){e&&this.setOptions(e)},setOptions:function(e){for(var t in e)this[t]=e[t]},createProgram:function(e,t,i){t=t||this.fragmentSource,i=i||this.vertexSource,"highp"!==E.webGlPrecision&&(t=t.replace(/precision highp float/g,"precision "+E.webGlPrecision+" float"));var n=e.createShader(e.VERTEX_SHADER);if(e.shaderSource(n,i),e.compileShader(n),!e.getShaderParameter(n,e.COMPILE_STATUS))throw new Error("Vertex shader compile error for "+this.type+": "+e.getShaderInfoLog(n));var r=e.createShader(e.FRAGMENT_SHADER);if(e.shaderSource(r,t),e.compileShader(r),!e.getShaderParameter(r,e.COMPILE_STATUS))throw new Error("Fragment shader compile error for "+this.type+": "+e.getShaderInfoLog(r));var s=e.createProgram();if(e.attachShader(s,n),e.attachShader(s,r),e.linkProgram(s),!e.getProgramParameter(s,e.LINK_STATUS))throw new Error('Shader link error for "${this.type}" '+e.getProgramInfoLog(s));var o=this.getAttributeLocations(e,s),a=this.getUniformLocations(e,s)||{};return a.uStepW=e.getUniformLocation(s,"uStepW"),a.uStepH=e.getUniformLocation(s,"uStepH"),{program:s,attributeLocations:o,uniformLocations:a}},getAttributeLocations:function(e,t){return{aPosition:e.getAttribLocation(t,"aPosition")}},getUniformLocations:function(){return{}},sendAttributeData:function(e,t,i){var n=t.aPosition,r=e.createBuffer();e.bindBuffer(e.ARRAY_BUFFER,r),e.enableVertexAttribArray(n),e.vertexAttribPointer(n,2,e.FLOAT,!1,0,0),e.bufferData(e.ARRAY_BUFFER,i,e.STATIC_DRAW)},_setupFrameBuffer:function(e){var t,i,n=e.context;e.passes>1?(t=e.destinationWidth,i=e.destinationHeight,e.sourceWidth===t&&e.sourceHeight===i||(n.deleteTexture(e.targetTexture),e.targetTexture=e.filterBackend.createTexture(n,t,i)),n.framebufferTexture2D(n.FRAMEBUFFER,n.COLOR_ATTACHMENT0,n.TEXTURE_2D,e.targetTexture,0)):(n.bindFramebuffer(n.FRAMEBUFFER,null),n.finish())},_swapTextures:function(e){e.passes--,e.pass++;var t=e.targetTexture;e.targetTexture=e.sourceTexture,e.sourceTexture=t},isNeutralState:function(){var e=this.mainParameter,t=E.Image.filters[this.type].prototype;if(e){if(Array.isArray(t[e])){for(var i=t[e].length;i--;)if(this[e][i]!==t[e][i])return!1;return!0}return t[e]===this[e]}return!1},applyTo:function(e){e.webgl?(this._setupFrameBuffer(e),this.applyToWebGL(e),this._swapTextures(e)):this.applyTo2d(e)},retrieveShader:function(e){return e.programCache.hasOwnProperty(this.type)||(e.programCache[this.type]=this.createProgram(e.context)),e.programCache[this.type]},applyToWebGL:function(e){var t=e.context,i=this.retrieveShader(e);0===e.pass&&e.originalTexture?t.bindTexture(t.TEXTURE_2D,e.originalTexture):t.bindTexture(t.TEXTURE_2D,e.sourceTexture),t.useProgram(i.program),this.sendAttributeData(t,i.attributeLocations,e.aPosition),t.uniform1f(i.uniformLocations.uStepW,1/e.sourceWidth),t.uniform1f(i.uniformLocations.uStepH,1/e.sourceHeight),this.sendUniformData(t,i.uniformLocations),t.viewport(0,0,e.destinationWidth,e.destinationHeight),t.drawArrays(t.TRIANGLE_STRIP,0,4)},bindAdditionalTexture:function(e,t,i){e.activeTexture(i),e.bindTexture(e.TEXTURE_2D,t),e.activeTexture(e.TEXTURE0)},unbindAdditionalTexture:function(e,t){e.activeTexture(t),e.bindTexture(e.TEXTURE_2D,null),e.activeTexture(e.TEXTURE0)},getMainParameter:function(){return this[this.mainParameter]},setMainParameter:function(e){this[this.mainParameter]=e},sendUniformData:function(){},createHelpLayer:function(e){if(!e.helpLayer){var t=document.createElement("canvas");t.width=e.sourceWidth,t.height=e.sourceHeight,e.helpLayer=t}},toObject:function(){var e={type:this.type},t=this.mainParameter;return t&&(e[t]=this[t]),e},toJSON:function(){return this.toObject()}}),E.Image.filters.BaseFilter.fromObject=function(e,t){var i=new E.Image.filters[e.type](e);return t&&t(i),i},function(e){var t=e.fabric||(e.fabric={}),i=t.Image.filters,n=t.util.createClass;i.ColorMatrix=n(i.BaseFilter,{type:"ColorMatrix",fragmentSource:"precision highp float;\nuniform sampler2D uTexture;\nvarying vec2 vTexCoord;\nuniform mat4 uColorMatrix;\nuniform vec4 uConstants;\nvoid main() {\nvec4 color = texture2D(uTexture, vTexCoord);\ncolor *= uColorMatrix;\ncolor += uConstants;\ngl_FragColor = color;\n}",matrix:[1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0],mainParameter:"matrix",colorsOnly:!0,initialize:function(e){this.callSuper("initialize",e),this.matrix=this.matrix.slice(0)},applyTo2d:function(e){var t,i,n,r,s,o=e.imageData.data,a=o.length,l=this.matrix,c=this.colorsOnly;for(s=0;s<a;s+=4)t=o[s],i=o[s+1],n=o[s+2],c?(o[s]=t*l[0]+i*l[1]+n*l[2]+255*l[4],o[s+1]=t*l[5]+i*l[6]+n*l[7]+255*l[9],o[s+2]=t*l[10]+i*l[11]+n*l[12]+255*l[14]):(r=o[s+3],o[s]=t*l[0]+i*l[1]+n*l[2]+r*l[3]+255*l[4],o[s+1]=t*l[5]+i*l[6]+n*l[7]+r*l[8]+255*l[9],o[s+2]=t*l[10]+i*l[11]+n*l[12]+r*l[13]+255*l[14],o[s+3]=t*l[15]+i*l[16]+n*l[17]+r*l[18]+255*l[19])},getUniformLocations:function(e,t){return{uColorMatrix:e.getUniformLocation(t,"uColorMatrix"),uConstants:e.getUniformLocation(t,"uConstants")}},sendUniformData:function(e,t){var i=this.matrix,n=[i[0],i[1],i[2],i[3],i[5],i[6],i[7],i[8],i[10],i[11],i[12],i[13],i[15],i[16],i[17],i[18]],r=[i[4],i[9],i[14],i[19]];e.uniformMatrix4fv(t.uColorMatrix,!1,n),e.uniform4fv(t.uConstants,r)}}),t.Image.filters.ColorMatrix.fromObject=t.Image.filters.BaseFilter.fromObject}(t),function(e){var t=e.fabric||(e.fabric={}),i=t.Image.filters,n=t.util.createClass;i.Brightness=n(i.BaseFilter,{type:"Brightness",fragmentSource:"precision highp float;\nuniform sampler2D uTexture;\nuniform float uBrightness;\nvarying vec2 vTexCoord;\nvoid main() {\nvec4 color = texture2D(uTexture, vTexCoord);\ncolor.rgb += uBrightness;\ngl_FragColor = color;\n}",brightness:0,mainParameter:"brightness",applyTo2d:function(e){if(0!==this.brightness){var t,i=e.imageData.data,n=i.length,r=Math.round(255*this.brightness);for(t=0;t<n;t+=4)i[t]=i[t]+r,i[t+1]=i[t+1]+r,i[t+2]=i[t+2]+r}},getUniformLocations:function(e,t){return{uBrightness:e.getUniformLocation(t,"uBrightness")}},sendUniformData:function(e,t){e.uniform1f(t.uBrightness,this.brightness)}}),t.Image.filters.Brightness.fromObject=t.Image.filters.BaseFilter.fromObject}(t),function(e){var t=e.fabric||(e.fabric={}),i=t.util.object.extend,n=t.Image.filters,r=t.util.createClass;n.Convolute=r(n.BaseFilter,{type:"Convolute",opaque:!1,matrix:[0,0,0,0,1,0,0,0,0],fragmentSource:{Convolute_3_1:"precision highp float;\nuniform sampler2D uTexture;\nuniform float uMatrix[9];\nuniform float uStepW;\nuniform float uStepH;\nvarying vec2 vTexCoord;\nvoid main() {\nvec4 color = vec4(0, 0, 0, 0);\nfor (float h = 0.0; h < 3.0; h+=1.0) {\nfor (float w = 0.0; w < 3.0; w+=1.0) {\nvec2 matrixPos = vec2(uStepW * (w - 1), uStepH * (h - 1));\ncolor += texture2D(uTexture, vTexCoord + matrixPos) * uMatrix[int(h * 3.0 + w)];\n}\n}\ngl_FragColor = color;\n}",Convolute_3_0:"precision highp float;\nuniform sampler2D uTexture;\nuniform float uMatrix[9];\nuniform float uStepW;\nuniform float uStepH;\nvarying vec2 vTexCoord;\nvoid main() {\nvec4 color = vec4(0, 0, 0, 1);\nfor (float h = 0.0; h < 3.0; h+=1.0) {\nfor (float w = 0.0; w < 3.0; w+=1.0) {\nvec2 matrixPos = vec2(uStepW * (w - 1.0), uStepH * (h - 1.0));\ncolor.rgb += texture2D(uTexture, vTexCoord + matrixPos).rgb * uMatrix[int(h * 3.0 + w)];\n}\n}\nfloat alpha = texture2D(uTexture, vTexCoord).a;\ngl_FragColor = color;\ngl_FragColor.a = alpha;\n}",Convolute_5_1:"precision highp float;\nuniform sampler2D uTexture;\nuniform float uMatrix[25];\nuniform float uStepW;\nuniform float uStepH;\nvarying vec2 vTexCoord;\nvoid main() {\nvec4 color = vec4(0, 0, 0, 0);\nfor (float h = 0.0; h < 5.0; h+=1.0) {\nfor (float w = 0.0; w < 5.0; w+=1.0) {\nvec2 matrixPos = vec2(uStepW * (w - 2.0), uStepH * (h - 2.0));\ncolor += texture2D(uTexture, vTexCoord + matrixPos) * uMatrix[int(h * 5.0 + w)];\n}\n}\ngl_FragColor = color;\n}",Convolute_5_0:"precision highp float;\nuniform sampler2D uTexture;\nuniform float uMatrix[25];\nuniform float uStepW;\nuniform float uStepH;\nvarying vec2 vTexCoord;\nvoid main() {\nvec4 color = vec4(0, 0, 0, 1);\nfor (float h = 0.0; h < 5.0; h+=1.0) {\nfor (float w = 0.0; w < 5.0; w+=1.0) {\nvec2 matrixPos = vec2(uStepW * (w - 2.0), uStepH * (h - 2.0));\ncolor.rgb += texture2D(uTexture, vTexCoord + matrixPos).rgb * uMatrix[int(h * 5.0 + w)];\n}\n}\nfloat alpha = texture2D(uTexture, vTexCoord).a;\ngl_FragColor = color;\ngl_FragColor.a = alpha;\n}",Convolute_7_1:"precision highp float;\nuniform sampler2D uTexture;\nuniform float uMatrix[49];\nuniform float uStepW;\nuniform float uStepH;\nvarying vec2 vTexCoord;\nvoid main() {\nvec4 color = vec4(0, 0, 0, 0);\nfor (float h = 0.0; h < 7.0; h+=1.0) {\nfor (float w = 0.0; w < 7.0; w+=1.0) {\nvec2 matrixPos = vec2(uStepW * (w - 3.0), uStepH * (h - 3.0));\ncolor += texture2D(uTexture, vTexCoord + matrixPos) * uMatrix[int(h * 7.0 + w)];\n}\n}\ngl_FragColor = color;\n}",Convolute_7_0:"precision highp float;\nuniform sampler2D uTexture;\nuniform float uMatrix[49];\nuniform float uStepW;\nuniform float uStepH;\nvarying vec2 vTexCoord;\nvoid main() {\nvec4 color = vec4(0, 0, 0, 1);\nfor (float h = 0.0; h < 7.0; h+=1.0) {\nfor (float w = 0.0; w < 7.0; w+=1.0) {\nvec2 matrixPos = vec2(uStepW * (w - 3.0), uStepH * (h - 3.0));\ncolor.rgb += texture2D(uTexture, vTexCoord + matrixPos).rgb * uMatrix[int(h * 7.0 + w)];\n}\n}\nfloat alpha = texture2D(uTexture, vTexCoord).a;\ngl_FragColor = color;\ngl_FragColor.a = alpha;\n}",Convolute_9_1:"precision highp float;\nuniform sampler2D uTexture;\nuniform float uMatrix[81];\nuniform float uStepW;\nuniform float uStepH;\nvarying vec2 vTexCoord;\nvoid main() {\nvec4 color = vec4(0, 0, 0, 0);\nfor (float h = 0.0; h < 9.0; h+=1.0) {\nfor (float w = 0.0; w < 9.0; w+=1.0) {\nvec2 matrixPos = vec2(uStepW * (w - 4.0), uStepH * (h - 4.0));\ncolor += texture2D(uTexture, vTexCoord + matrixPos) * uMatrix[int(h * 9.0 + w)];\n}\n}\ngl_FragColor = color;\n}",Convolute_9_0:"precision highp float;\nuniform sampler2D uTexture;\nuniform float uMatrix[81];\nuniform float uStepW;\nuniform float uStepH;\nvarying vec2 vTexCoord;\nvoid main() {\nvec4 color = vec4(0, 0, 0, 1);\nfor (float h = 0.0; h < 9.0; h+=1.0) {\nfor (float w = 0.0; w < 9.0; w+=1.0) {\nvec2 matrixPos = vec2(uStepW * (w - 4.0), uStepH * (h - 4.0));\ncolor.rgb += texture2D(uTexture, vTexCoord + matrixPos).rgb * uMatrix[int(h * 9.0 + w)];\n}\n}\nfloat alpha = texture2D(uTexture, vTexCoord).a;\ngl_FragColor = color;\ngl_FragColor.a = alpha;\n}"},retrieveShader:function(e){var t=Math.sqrt(this.matrix.length),i=this.type+"_"+t+"_"+(this.opaque?1:0),n=this.fragmentSource[i];return e.programCache.hasOwnProperty(i)||(e.programCache[i]=this.createProgram(e.context,n)),e.programCache[i]},applyTo2d:function(e){var t,i,n,r,s,o,a,l,c,h,u,d,f,g=e.imageData,p=g.data,m=this.matrix,_=Math.round(Math.sqrt(m.length)),v=Math.floor(_/2),y=g.width,w=g.height,b=e.ctx.createImageData(y,w),C=b.data,S=this.opaque?1:0;for(u=0;u<w;u++)for(h=0;h<y;h++){for(s=4*(u*y+h),t=0,i=0,n=0,r=0,f=0;f<_;f++)for(d=0;d<_;d++)o=h+d-v,(a=u+f-v)<0||a>=w||o<0||o>=y||(l=4*(a*y+o),c=m[f*_+d],t+=p[l]*c,i+=p[l+1]*c,n+=p[l+2]*c,S||(r+=p[l+3]*c));C[s]=t,C[s+1]=i,C[s+2]=n,C[s+3]=S?p[s+3]:r}e.imageData=b},getUniformLocations:function(e,t){return{uMatrix:e.getUniformLocation(t,"uMatrix"),uOpaque:e.getUniformLocation(t,"uOpaque"),uHalfSize:e.getUniformLocation(t,"uHalfSize"),uSize:e.getUniformLocation(t,"uSize")}},sendUniformData:function(e,t){e.uniform1fv(t.uMatrix,this.matrix)},toObject:function(){return i(this.callSuper("toObject"),{opaque:this.opaque,matrix:this.matrix})}}),t.Image.filters.Convolute.fromObject=t.Image.filters.BaseFilter.fromObject}(t),function(e){var t=e.fabric||(e.fabric={}),i=t.Image.filters,n=t.util.createClass;i.Grayscale=n(i.BaseFilter,{type:"Grayscale",fragmentSource:{average:"precision highp float;\nuniform sampler2D uTexture;\nvarying vec2 vTexCoord;\nvoid main() {\nvec4 color = texture2D(uTexture, vTexCoord);\nfloat average = (color.r + color.b + color.g) / 3.0;\ngl_FragColor = vec4(average, average, average, color.a);\n}",lightness:"precision highp float;\nuniform sampler2D uTexture;\nuniform int uMode;\nvarying vec2 vTexCoord;\nvoid main() {\nvec4 col = texture2D(uTexture, vTexCoord);\nfloat average = (max(max(col.r, col.g),col.b) + min(min(col.r, col.g),col.b)) / 2.0;\ngl_FragColor = vec4(average, average, average, col.a);\n}",luminosity:"precision highp float;\nuniform sampler2D uTexture;\nuniform int uMode;\nvarying vec2 vTexCoord;\nvoid main() {\nvec4 col = texture2D(uTexture, vTexCoord);\nfloat average = 0.21 * col.r + 0.72 * col.g + 0.07 * col.b;\ngl_FragColor = vec4(average, average, average, col.a);\n}"},mode:"average",mainParameter:"mode",applyTo2d:function(e){var t,i,n=e.imageData.data,r=n.length,s=this.mode;for(t=0;t<r;t+=4)"average"===s?i=(n[t]+n[t+1]+n[t+2])/3:"lightness"===s?i=(Math.min(n[t],n[t+1],n[t+2])+Math.max(n[t],n[t+1],n[t+2]))/2:"luminosity"===s&&(i=.21*n[t]+.72*n[t+1]+.07*n[t+2]),n[t]=i,n[t+1]=i,n[t+2]=i},retrieveShader:function(e){var t=this.type+"_"+this.mode;if(!e.programCache.hasOwnProperty(t)){var i=this.fragmentSource[this.mode];e.programCache[t]=this.createProgram(e.context,i)}return e.programCache[t]},getUniformLocations:function(e,t){return{uMode:e.getUniformLocation(t,"uMode")}},sendUniformData:function(e,t){e.uniform1i(t.uMode,1)},isNeutralState:function(){return!1}}),t.Image.filters.Grayscale.fromObject=t.Image.filters.BaseFilter.fromObject}(t),function(e){var t=e.fabric||(e.fabric={}),i=t.Image.filters,n=t.util.createClass;i.Invert=n(i.BaseFilter,{type:"Invert",fragmentSource:"precision highp float;\nuniform sampler2D uTexture;\nuniform int uInvert;\nvarying vec2 vTexCoord;\nvoid main() {\nvec4 color = texture2D(uTexture, vTexCoord);\nif (uInvert == 1) {\ngl_FragColor = vec4(1.0 - color.r,1.0 -color.g,1.0 -color.b,color.a);\n} else {\ngl_FragColor = color;\n}\n}",invert:!0,mainParameter:"invert",applyTo2d:function(e){var t,i=e.imageData.data,n=i.length;for(t=0;t<n;t+=4)i[t]=255-i[t],i[t+1]=255-i[t+1],i[t+2]=255-i[t+2]},isNeutralState:function(){return!this.invert},getUniformLocations:function(e,t){return{uInvert:e.getUniformLocation(t,"uInvert")}},sendUniformData:function(e,t){e.uniform1i(t.uInvert,this.invert)}}),t.Image.filters.Invert.fromObject=t.Image.filters.BaseFilter.fromObject}(t),function(e){var t=e.fabric||(e.fabric={}),i=t.util.object.extend,n=t.Image.filters,r=t.util.createClass;n.Noise=r(n.BaseFilter,{type:"Noise",fragmentSource:"precision highp float;\nuniform sampler2D uTexture;\nuniform float uStepH;\nuniform float uNoise;\nuniform float uSeed;\nvarying vec2 vTexCoord;\nfloat rand(vec2 co, float seed, float vScale) {\nreturn fract(sin(dot(co.xy * vScale ,vec2(12.9898 , 78.233))) * 43758.5453 * (seed + 0.01) / 2.0);\n}\nvoid main() {\nvec4 color = texture2D(uTexture, vTexCoord);\ncolor.rgb += (0.5 - rand(vTexCoord, uSeed, 0.1 / uStepH)) * uNoise;\ngl_FragColor = color;\n}",mainParameter:"noise",noise:0,applyTo2d:function(e){if(0!==this.noise){var t,i,n=e.imageData.data,r=n.length,s=this.noise;for(t=0,r=n.length;t<r;t+=4)i=(.5-Math.random())*s,n[t]+=i,n[t+1]+=i,n[t+2]+=i}},getUniformLocations:function(e,t){return{uNoise:e.getUniformLocation(t,"uNoise"),uSeed:e.getUniformLocation(t,"uSeed")}},sendUniformData:function(e,t){e.uniform1f(t.uNoise,this.noise/255),e.uniform1f(t.uSeed,Math.random())},toObject:function(){return i(this.callSuper("toObject"),{noise:this.noise})}}),t.Image.filters.Noise.fromObject=t.Image.filters.BaseFilter.fromObject}(t),function(e){var t=e.fabric||(e.fabric={}),i=t.Image.filters,n=t.util.createClass;i.Pixelate=n(i.BaseFilter,{type:"Pixelate",blocksize:4,mainParameter:"blocksize",fragmentSource:"precision highp float;\nuniform sampler2D uTexture;\nuniform float uBlocksize;\nuniform float uStepW;\nuniform float uStepH;\nvarying vec2 vTexCoord;\nvoid main() {\nfloat blockW = uBlocksize * uStepW;\nfloat blockH = uBlocksize * uStepW;\nint posX = int(vTexCoord.x / blockW);\nint posY = int(vTexCoord.y / blockH);\nfloat fposX = float(posX);\nfloat fposY = float(posY);\nvec2 squareCoords = vec2(fposX * blockW, fposY * blockH);\nvec4 color = texture2D(uTexture, squareCoords);\ngl_FragColor = color;\n}",applyTo2d:function(e){var t,i,n,r,s,o,a,l,c,h,u,d=e.imageData,f=d.data,g=d.height,p=d.width;for(i=0;i<g;i+=this.blocksize)for(n=0;n<p;n+=this.blocksize)for(r=f[t=4*i*p+4*n],s=f[t+1],o=f[t+2],a=f[t+3],h=Math.min(i+this.blocksize,g),u=Math.min(n+this.blocksize,p),l=i;l<h;l++)for(c=n;c<u;c++)f[t=4*l*p+4*c]=r,f[t+1]=s,f[t+2]=o,f[t+3]=a},isNeutralState:function(){return 1===this.blocksize},getUniformLocations:function(e,t){return{uBlocksize:e.getUniformLocation(t,"uBlocksize"),uStepW:e.getUniformLocation(t,"uStepW"),uStepH:e.getUniformLocation(t,"uStepH")}},sendUniformData:function(e,t){e.uniform1f(t.uBlocksize,this.blocksize)}}),t.Image.filters.Pixelate.fromObject=t.Image.filters.BaseFilter.fromObject}(t),function(e){var t=e.fabric||(e.fabric={}),i=t.util.object.extend,n=t.Image.filters,r=t.util.createClass;n.RemoveColor=r(n.BaseFilter,{type:"RemoveColor",color:"#FFFFFF",fragmentSource:"precision highp float;\nuniform sampler2D uTexture;\nuniform vec4 uLow;\nuniform vec4 uHigh;\nvarying vec2 vTexCoord;\nvoid main() {\ngl_FragColor = texture2D(uTexture, vTexCoord);\nif(all(greaterThan(gl_FragColor.rgb,uLow.rgb)) && all(greaterThan(uHigh.rgb,gl_FragColor.rgb))) {\ngl_FragColor.a = 0.0;\n}\n}",distance:.02,useAlpha:!1,applyTo2d:function(e){var i,n,r,s,o=e.imageData.data,a=255*this.distance,l=new t.Color(this.color).getSource(),c=[l[0]-a,l[1]-a,l[2]-a],h=[l[0]+a,l[1]+a,l[2]+a];for(i=0;i<o.length;i+=4)n=o[i],r=o[i+1],s=o[i+2],n>c[0]&&r>c[1]&&s>c[2]&&n<h[0]&&r<h[1]&&s<h[2]&&(o[i+3]=0)},getUniformLocations:function(e,t){return{uLow:e.getUniformLocation(t,"uLow"),uHigh:e.getUniformLocation(t,"uHigh")}},sendUniformData:function(e,i){var n=new t.Color(this.color).getSource(),r=parseFloat(this.distance),s=[0+n[0]/255-r,0+n[1]/255-r,0+n[2]/255-r,1],o=[n[0]/255+r,n[1]/255+r,n[2]/255+r,1];e.uniform4fv(i.uLow,s),e.uniform4fv(i.uHigh,o)},toObject:function(){return i(this.callSuper("toObject"),{color:this.color,distance:this.distance})}}),t.Image.filters.RemoveColor.fromObject=t.Image.filters.BaseFilter.fromObject}(t),function(e){var t=e.fabric||(e.fabric={}),i=t.Image.filters,n=t.util.createClass,r={Brownie:[.5997,.34553,-.27082,0,.186,-.0377,.86095,.15059,0,-.1449,.24113,-.07441,.44972,0,-.02965,0,0,0,1,0],Vintage:[.62793,.32021,-.03965,0,.03784,.02578,.64411,.03259,0,.02926,.0466,-.08512,.52416,0,.02023,0,0,0,1,0],Kodachrome:[1.12855,-.39673,-.03992,0,.24991,-.16404,1.08352,-.05498,0,.09698,-.16786,-.56034,1.60148,0,.13972,0,0,0,1,0],Technicolor:[1.91252,-.85453,-.09155,0,.04624,-.30878,1.76589,-.10601,0,-.27589,-.2311,-.75018,1.84759,0,.12137,0,0,0,1,0],Polaroid:[1.438,-.062,-.062,0,0,-.122,1.378,-.122,0,0,-.016,-.016,1.483,0,0,0,0,0,1,0],Sepia:[.393,.769,.189,0,0,.349,.686,.168,0,0,.272,.534,.131,0,0,0,0,0,1,0],BlackWhite:[1.5,1.5,1.5,0,-1,1.5,1.5,1.5,0,-1,1.5,1.5,1.5,0,-1,0,0,0,1,0]};for(var s in r)i[s]=n(i.ColorMatrix,{type:s,matrix:r[s],mainParameter:!1,colorsOnly:!0}),t.Image.filters[s].fromObject=t.Image.filters.BaseFilter.fromObject}(t),function(e){var t=e.fabric,i=t.Image.filters,n=t.util.createClass;i.BlendColor=n(i.BaseFilter,{type:"BlendColor",color:"#F95C63",mode:"multiply",alpha:1,fragmentSource:{multiply:"gl_FragColor.rgb *= uColor.rgb;\n",screen:"gl_FragColor.rgb = 1.0 - (1.0 - gl_FragColor.rgb) * (1.0 - uColor.rgb);\n",add:"gl_FragColor.rgb += uColor.rgb;\n",diff:"gl_FragColor.rgb = abs(gl_FragColor.rgb - uColor.rgb);\n",subtract:"gl_FragColor.rgb -= uColor.rgb;\n",lighten:"gl_FragColor.rgb = max(gl_FragColor.rgb, uColor.rgb);\n",darken:"gl_FragColor.rgb = min(gl_FragColor.rgb, uColor.rgb);\n",exclusion:"gl_FragColor.rgb += uColor.rgb - 2.0 * (uColor.rgb * gl_FragColor.rgb);\n",overlay:"if (uColor.r < 0.5) {\ngl_FragColor.r *= 2.0 * uColor.r;\n} else {\ngl_FragColor.r = 1.0 - 2.0 * (1.0 - gl_FragColor.r) * (1.0 - uColor.r);\n}\nif (uColor.g < 0.5) {\ngl_FragColor.g *= 2.0 * uColor.g;\n} else {\ngl_FragColor.g = 1.0 - 2.0 * (1.0 - gl_FragColor.g) * (1.0 - uColor.g);\n}\nif (uColor.b < 0.5) {\ngl_FragColor.b *= 2.0 * uColor.b;\n} else {\ngl_FragColor.b = 1.0 - 2.0 * (1.0 - gl_FragColor.b) * (1.0 - uColor.b);\n}\n",tint:"gl_FragColor.rgb *= (1.0 - uColor.a);\ngl_FragColor.rgb += uColor.rgb;\n"},buildSource:function(e){return"precision highp float;\nuniform sampler2D uTexture;\nuniform vec4 uColor;\nvarying vec2 vTexCoord;\nvoid main() {\nvec4 color = texture2D(uTexture, vTexCoord);\ngl_FragColor = color;\nif (color.a > 0.0) {\n"+this.fragmentSource[e]+"}\n}"},retrieveShader:function(e){var t,i=this.type+"_"+this.mode;return e.programCache.hasOwnProperty(i)||(t=this.buildSource(this.mode),e.programCache[i]=this.createProgram(e.context,t)),e.programCache[i]},applyTo2d:function(e){var i,n,r,s,o,a,l,c=e.imageData.data,h=c.length,u=1-this.alpha;i=(l=new t.Color(this.color).getSource())[0]*this.alpha,n=l[1]*this.alpha,r=l[2]*this.alpha;for(var d=0;d<h;d+=4)switch(s=c[d],o=c[d+1],a=c[d+2],this.mode){case"multiply":c[d]=s*i/255,c[d+1]=o*n/255,c[d+2]=a*r/255;break;case"screen":c[d]=255-(255-s)*(255-i)/255,c[d+1]=255-(255-o)*(255-n)/255,c[d+2]=255-(255-a)*(255-r)/255;break;case"add":c[d]=s+i,c[d+1]=o+n,c[d+2]=a+r;break;case"diff":case"difference":c[d]=Math.abs(s-i),c[d+1]=Math.abs(o-n),c[d+2]=Math.abs(a-r);break;case"subtract":c[d]=s-i,c[d+1]=o-n,c[d+2]=a-r;break;case"darken":c[d]=Math.min(s,i),c[d+1]=Math.min(o,n),c[d+2]=Math.min(a,r);break;case"lighten":c[d]=Math.max(s,i),c[d+1]=Math.max(o,n),c[d+2]=Math.max(a,r);break;case"overlay":c[d]=i<128?2*s*i/255:255-2*(255-s)*(255-i)/255,c[d+1]=n<128?2*o*n/255:255-2*(255-o)*(255-n)/255,c[d+2]=r<128?2*a*r/255:255-2*(255-a)*(255-r)/255;break;case"exclusion":c[d]=i+s-2*i*s/255,c[d+1]=n+o-2*n*o/255,c[d+2]=r+a-2*r*a/255;break;case"tint":c[d]=i+s*u,c[d+1]=n+o*u,c[d+2]=r+a*u}},getUniformLocations:function(e,t){return{uColor:e.getUniformLocation(t,"uColor")}},sendUniformData:function(e,i){var n=new t.Color(this.color).getSource();n[0]=this.alpha*n[0]/255,n[1]=this.alpha*n[1]/255,n[2]=this.alpha*n[2]/255,n[3]=this.alpha,e.uniform4fv(i.uColor,n)},toObject:function(){return{type:this.type,color:this.color,mode:this.mode,alpha:this.alpha}}}),t.Image.filters.BlendColor.fromObject=t.Image.filters.BaseFilter.fromObject}(t),function(e){var t=e.fabric,i=t.Image.filters,n=t.util.createClass;i.BlendImage=n(i.BaseFilter,{type:"BlendImage",image:null,mode:"multiply",alpha:1,vertexSource:"attribute vec2 aPosition;\nvarying vec2 vTexCoord;\nvarying vec2 vTexCoord2;\nuniform mat3 uTransformMatrix;\nvoid main() {\nvTexCoord = aPosition;\nvTexCoord2 = (uTransformMatrix * vec3(aPosition, 1.0)).xy;\ngl_Position = vec4(aPosition * 2.0 - 1.0, 0.0, 1.0);\n}",fragmentSource:{multiply:"precision highp float;\nuniform sampler2D uTexture;\nuniform sampler2D uImage;\nuniform vec4 uColor;\nvarying vec2 vTexCoord;\nvarying vec2 vTexCoord2;\nvoid main() {\nvec4 color = texture2D(uTexture, vTexCoord);\nvec4 color2 = texture2D(uImage, vTexCoord2);\ncolor.rgba *= color2.rgba;\ngl_FragColor = color;\n}",mask:"precision highp float;\nuniform sampler2D uTexture;\nuniform sampler2D uImage;\nuniform vec4 uColor;\nvarying vec2 vTexCoord;\nvarying vec2 vTexCoord2;\nvoid main() {\nvec4 color = texture2D(uTexture, vTexCoord);\nvec4 color2 = texture2D(uImage, vTexCoord2);\ncolor.a = color2.a;\ngl_FragColor = color;\n}"},retrieveShader:function(e){var t=this.type+"_"+this.mode,i=this.fragmentSource[this.mode];return e.programCache.hasOwnProperty(t)||(e.programCache[t]=this.createProgram(e.context,i)),e.programCache[t]},applyToWebGL:function(e){var t=e.context,i=this.createTexture(e.filterBackend,this.image);this.bindAdditionalTexture(t,i,t.TEXTURE1),this.callSuper("applyToWebGL",e),this.unbindAdditionalTexture(t,t.TEXTURE1)},createTexture:function(e,t){return e.getCachedTexture(t.cacheKey,t._element)},calculateMatrix:function(){var e=this.image,t=e._element.width,i=e._element.height;return[1/e.scaleX,0,0,0,1/e.scaleY,0,-e.left/t,-e.top/i,1]},applyTo2d:function(e){var i,n,r,s,o,a,l,c,h,u,d,f=e.imageData,g=e.filterBackend.resources,p=f.data,m=p.length,_=f.width,v=f.height,y=this.image;g.blendImage||(g.blendImage=t.util.createCanvasElement()),u=(h=g.blendImage).getContext("2d"),h.width!==_||h.height!==v?(h.width=_,h.height=v):u.clearRect(0,0,_,v),u.setTransform(y.scaleX,0,0,y.scaleY,y.left,y.top),u.drawImage(y._element,0,0,_,v),d=u.getImageData(0,0,_,v).data;for(var w=0;w<m;w+=4)switch(o=p[w],a=p[w+1],l=p[w+2],c=p[w+3],i=d[w],n=d[w+1],r=d[w+2],s=d[w+3],this.mode){case"multiply":p[w]=o*i/255,p[w+1]=a*n/255,p[w+2]=l*r/255,p[w+3]=c*s/255;break;case"mask":p[w+3]=s}},getUniformLocations:function(e,t){return{uTransformMatrix:e.getUniformLocation(t,"uTransformMatrix"),uImage:e.getUniformLocation(t,"uImage")}},sendUniformData:function(e,t){var i=this.calculateMatrix();e.uniform1i(t.uImage,1),e.uniformMatrix3fv(t.uTransformMatrix,!1,i)},toObject:function(){return{type:this.type,image:this.image&&this.image.toObject(),mode:this.mode,alpha:this.alpha}}}),t.Image.filters.BlendImage.fromObject=function(e,i){t.Image.fromObject(e.image,(function(n){var r=t.util.object.clone(e);r.image=n,i(new t.Image.filters.BlendImage(r))}))}}(t),function(e){var t=e.fabric||(e.fabric={}),i=Math.pow,n=Math.floor,r=Math.sqrt,s=Math.abs,o=Math.round,a=Math.sin,l=Math.ceil,c=t.Image.filters,h=t.util.createClass;c.Resize=h(c.BaseFilter,{type:"Resize",resizeType:"hermite",scaleX:1,scaleY:1,lanczosLobes:3,getUniformLocations:function(e,t){return{uDelta:e.getUniformLocation(t,"uDelta"),uTaps:e.getUniformLocation(t,"uTaps")}},sendUniformData:function(e,t){e.uniform2fv(t.uDelta,this.horizontal?[1/this.width,0]:[0,1/this.height]),e.uniform1fv(t.uTaps,this.taps)},retrieveShader:function(e){var t=this.getFilterWindow(),i=this.type+"_"+t;if(!e.programCache.hasOwnProperty(i)){var n=this.generateShader(t);e.programCache[i]=this.createProgram(e.context,n)}return e.programCache[i]},getFilterWindow:function(){var e=this.tempScale;return Math.ceil(this.lanczosLobes/e)},getTaps:function(){for(var e=this.lanczosCreate(this.lanczosLobes),t=this.tempScale,i=this.getFilterWindow(),n=new Array(i),r=1;r<=i;r++)n[r-1]=e(r*t);return n},generateShader:function(e){for(var t=new Array(e),i=this.fragmentSourceTOP,n=1;n<=e;n++)t[n-1]=n+".0 * uDelta";return i+="uniform float uTaps["+e+"];\n",i+="void main() {\n",i+="  vec4 color = texture2D(uTexture, vTexCoord);\n",i+="  float sum = 1.0;\n",t.forEach((function(e,t){i+="  color += texture2D(uTexture, vTexCoord + "+e+") * uTaps["+t+"];\n",i+="  color += texture2D(uTexture, vTexCoord - "+e+") * uTaps["+t+"];\n",i+="  sum += 2.0 * uTaps["+t+"];\n"})),i+="  gl_FragColor = color / sum;\n",i+="}"},fragmentSourceTOP:"precision highp float;\nuniform sampler2D uTexture;\nuniform vec2 uDelta;\nvarying vec2 vTexCoord;\n",applyTo:function(e){e.webgl?(e.passes++,this.width=e.sourceWidth,this.horizontal=!0,this.dW=Math.round(this.width*this.scaleX),this.dH=e.sourceHeight,this.tempScale=this.dW/this.width,this.taps=this.getTaps(),e.destinationWidth=this.dW,this._setupFrameBuffer(e),this.applyToWebGL(e),this._swapTextures(e),e.sourceWidth=e.destinationWidth,this.height=e.sourceHeight,this.horizontal=!1,this.dH=Math.round(this.height*this.scaleY),this.tempScale=this.dH/this.height,this.taps=this.getTaps(),e.destinationHeight=this.dH,this._setupFrameBuffer(e),this.applyToWebGL(e),this._swapTextures(e),e.sourceHeight=e.destinationHeight):this.applyTo2d(e)},isNeutralState:function(){return 1===this.scaleX&&1===this.scaleY},lanczosCreate:function(e){return function(t){if(t>=e||t<=-e)return 0;if(t<1.1920929e-7&&t>-1.1920929e-7)return 1;var i=(t*=Math.PI)/e;return a(t)/t*a(i)/i}},applyTo2d:function(e){var t=e.imageData,i=this.scaleX,n=this.scaleY;this.rcpScaleX=1/i,this.rcpScaleY=1/n;var r,s=t.width,a=t.height,l=o(s*i),c=o(a*n);"sliceHack"===this.resizeType?r=this.sliceByTwo(e,s,a,l,c):"hermite"===this.resizeType?r=this.hermiteFastResize(e,s,a,l,c):"bilinear"===this.resizeType?r=this.bilinearFiltering(e,s,a,l,c):"lanczos"===this.resizeType&&(r=this.lanczosResize(e,s,a,l,c)),e.imageData=r},sliceByTwo:function(e,i,r,s,o){var a,l,c=e.imageData,h=.5,u=!1,d=!1,f=i*h,g=r*h,p=t.filterBackend.resources,m=0,_=0,v=i,y=0;for(p.sliceByTwo||(p.sliceByTwo=document.createElement("canvas")),((a=p.sliceByTwo).width<1.5*i||a.height<r)&&(a.width=1.5*i,a.height=r),(l=a.getContext("2d")).clearRect(0,0,1.5*i,r),l.putImageData(c,0,0),s=n(s),o=n(o);!u||!d;)i=f,r=g,s<n(f*h)?f=n(f*h):(f=s,u=!0),o<n(g*h)?g=n(g*h):(g=o,d=!0),l.drawImage(a,m,_,i,r,v,y,f,g),m=v,_=y,y+=g;return l.getImageData(m,_,s,o)},lanczosResize:function(e,t,o,a,c){var h=e.imageData.data,u=e.ctx.createImageData(a,c),d=u.data,f=this.lanczosCreate(this.lanczosLobes),g=this.rcpScaleX,p=this.rcpScaleY,m=2/this.rcpScaleX,_=2/this.rcpScaleY,v=l(g*this.lanczosLobes/2),y=l(p*this.lanczosLobes/2),w={},b={},C={};return function e(l){var S,E,T,x,I,A,O,R,D,L,k;for(b.x=(l+.5)*g,C.x=n(b.x),S=0;S<c;S++){for(b.y=(S+.5)*p,C.y=n(b.y),I=0,A=0,O=0,R=0,D=0,E=C.x-v;E<=C.x+v;E++)if(!(E<0||E>=t)){L=n(1e3*s(E-b.x)),w[L]||(w[L]={});for(var M=C.y-y;M<=C.y+y;M++)M<0||M>=o||(k=n(1e3*s(M-b.y)),w[L][k]||(w[L][k]=f(r(i(L*m,2)+i(k*_,2))/1e3)),(T=w[L][k])>0&&(I+=T,A+=T*h[x=4*(M*t+E)],O+=T*h[x+1],R+=T*h[x+2],D+=T*h[x+3]))}d[x=4*(S*a+l)]=A/I,d[x+1]=O/I,d[x+2]=R/I,d[x+3]=D/I}return++l<a?e(l):u}(0)},bilinearFiltering:function(e,t,i,r,s){var o,a,l,c,h,u,d,f,g,p=0,m=this.rcpScaleX,_=this.rcpScaleY,v=4*(t-1),y=e.imageData.data,w=e.ctx.createImageData(r,s),b=w.data;for(l=0;l<s;l++)for(c=0;c<r;c++)for(h=m*c-(o=n(m*c)),u=_*l-(a=n(_*l)),g=4*(a*t+o),d=0;d<4;d++)f=y[g+d]*(1-h)*(1-u)+y[g+4+d]*h*(1-u)+y[g+v+d]*u*(1-h)+y[g+v+4+d]*h*u,b[p++]=f;return w},hermiteFastResize:function(e,t,i,o,a){for(var c=this.rcpScaleX,h=this.rcpScaleY,u=l(c/2),d=l(h/2),f=e.imageData.data,g=e.ctx.createImageData(o,a),p=g.data,m=0;m<a;m++)for(var _=0;_<o;_++){for(var v=4*(_+m*o),y=0,w=0,b=0,C=0,S=0,E=0,T=0,x=(m+.5)*h,I=n(m*h);I<(m+1)*h;I++)for(var A=s(x-(I+.5))/d,O=(_+.5)*c,R=A*A,D=n(_*c);D<(_+1)*c;D++){var L=s(O-(D+.5))/u,k=r(R+L*L);k>1&&k<-1||(y=2*k*k*k-3*k*k+1)>0&&(T+=y*f[3+(L=4*(D+I*t))],b+=y,f[L+3]<255&&(y=y*f[L+3]/250),C+=y*f[L],S+=y*f[L+1],E+=y*f[L+2],w+=y)}p[v]=C/w,p[v+1]=S/w,p[v+2]=E/w,p[v+3]=T/b}return g},toObject:function(){return{type:this.type,scaleX:this.scaleX,scaleY:this.scaleY,resizeType:this.resizeType,lanczosLobes:this.lanczosLobes}}}),t.Image.filters.Resize.fromObject=t.Image.filters.BaseFilter.fromObject}(t),function(e){var t=e.fabric||(e.fabric={}),i=t.Image.filters,n=t.util.createClass;i.Contrast=n(i.BaseFilter,{type:"Contrast",fragmentSource:"precision highp float;\nuniform sampler2D uTexture;\nuniform float uContrast;\nvarying vec2 vTexCoord;\nvoid main() {\nvec4 color = texture2D(uTexture, vTexCoord);\nfloat contrastF = 1.015 * (uContrast + 1.0) / (1.0 * (1.015 - uContrast));\ncolor.rgb = contrastF * (color.rgb - 0.5) + 0.5;\ngl_FragColor = color;\n}",contrast:0,mainParameter:"contrast",applyTo2d:function(e){if(0!==this.contrast){var t,i=e.imageData.data,n=i.length,r=Math.floor(255*this.contrast),s=259*(r+255)/(255*(259-r));for(t=0;t<n;t+=4)i[t]=s*(i[t]-128)+128,i[t+1]=s*(i[t+1]-128)+128,i[t+2]=s*(i[t+2]-128)+128}},getUniformLocations:function(e,t){return{uContrast:e.getUniformLocation(t,"uContrast")}},sendUniformData:function(e,t){e.uniform1f(t.uContrast,this.contrast)}}),t.Image.filters.Contrast.fromObject=t.Image.filters.BaseFilter.fromObject}(t),function(e){var t=e.fabric||(e.fabric={}),i=t.Image.filters,n=t.util.createClass;i.Saturation=n(i.BaseFilter,{type:"Saturation",fragmentSource:"precision highp float;\nuniform sampler2D uTexture;\nuniform float uSaturation;\nvarying vec2 vTexCoord;\nvoid main() {\nvec4 color = texture2D(uTexture, vTexCoord);\nfloat rgMax = max(color.r, color.g);\nfloat rgbMax = max(rgMax, color.b);\ncolor.r += rgbMax != color.r ? (rgbMax - color.r) * uSaturation : 0.00;\ncolor.g += rgbMax != color.g ? (rgbMax - color.g) * uSaturation : 0.00;\ncolor.b += rgbMax != color.b ? (rgbMax - color.b) * uSaturation : 0.00;\ngl_FragColor = color;\n}",saturation:0,mainParameter:"saturation",applyTo2d:function(e){if(0!==this.saturation){var t,i,n=e.imageData.data,r=n.length,s=-this.saturation;for(t=0;t<r;t+=4)i=Math.max(n[t],n[t+1],n[t+2]),n[t]+=i!==n[t]?(i-n[t])*s:0,n[t+1]+=i!==n[t+1]?(i-n[t+1])*s:0,n[t+2]+=i!==n[t+2]?(i-n[t+2])*s:0}},getUniformLocations:function(e,t){return{uSaturation:e.getUniformLocation(t,"uSaturation")}},sendUniformData:function(e,t){e.uniform1f(t.uSaturation,-this.saturation)}}),t.Image.filters.Saturation.fromObject=t.Image.filters.BaseFilter.fromObject}(t),function(e){var t=e.fabric||(e.fabric={}),i=t.Image.filters,n=t.util.createClass;i.Vibrance=n(i.BaseFilter,{type:"Vibrance",fragmentSource:"precision highp float;\nuniform sampler2D uTexture;\nuniform float uVibrance;\nvarying vec2 vTexCoord;\nvoid main() {\nvec4 color = texture2D(uTexture, vTexCoord);\nfloat max = max(color.r, max(color.g, color.b));\nfloat avg = (color.r + color.g + color.b) / 3.0;\nfloat amt = (abs(max - avg) * 2.0) * uVibrance;\ncolor.r += max != color.r ? (max - color.r) * amt : 0.00;\ncolor.g += max != color.g ? (max - color.g) * amt : 0.00;\ncolor.b += max != color.b ? (max - color.b) * amt : 0.00;\ngl_FragColor = color;\n}",vibrance:0,mainParameter:"vibrance",applyTo2d:function(e){if(0!==this.vibrance){var t,i,n,r,s=e.imageData.data,o=s.length,a=-this.vibrance;for(t=0;t<o;t+=4)i=Math.max(s[t],s[t+1],s[t+2]),n=(s[t]+s[t+1]+s[t+2])/3,r=2*Math.abs(i-n)/255*a,s[t]+=i!==s[t]?(i-s[t])*r:0,s[t+1]+=i!==s[t+1]?(i-s[t+1])*r:0,s[t+2]+=i!==s[t+2]?(i-s[t+2])*r:0}},getUniformLocations:function(e,t){return{uVibrance:e.getUniformLocation(t,"uVibrance")}},sendUniformData:function(e,t){e.uniform1f(t.uVibrance,-this.vibrance)}}),t.Image.filters.Vibrance.fromObject=t.Image.filters.BaseFilter.fromObject}(t),function(e){var t=e.fabric||(e.fabric={}),i=t.Image.filters,n=t.util.createClass;i.Blur=n(i.BaseFilter,{type:"Blur",fragmentSource:"precision highp float;\nuniform sampler2D uTexture;\nuniform vec2 uDelta;\nvarying vec2 vTexCoord;\nconst float nSamples = 15.0;\nvec3 v3offset = vec3(12.9898, 78.233, 151.7182);\nfloat random(vec3 scale) {\nreturn fract(sin(dot(gl_FragCoord.xyz, scale)) * 43758.5453);\n}\nvoid main() {\nvec4 color = vec4(0.0);\nfloat total = 0.0;\nfloat offset = random(v3offset);\nfor (float t = -nSamples; t <= nSamples; t++) {\nfloat percent = (t + offset - 0.5) / nSamples;\nfloat weight = 1.0 - abs(percent);\ncolor += texture2D(uTexture, vTexCoord + uDelta * percent) * weight;\ntotal += weight;\n}\ngl_FragColor = color / total;\n}",blur:0,mainParameter:"blur",applyTo:function(e){e.webgl?(this.aspectRatio=e.sourceWidth/e.sourceHeight,e.passes++,this._setupFrameBuffer(e),this.horizontal=!0,this.applyToWebGL(e),this._swapTextures(e),this._setupFrameBuffer(e),this.horizontal=!1,this.applyToWebGL(e),this._swapTextures(e)):this.applyTo2d(e)},applyTo2d:function(e){e.imageData=this.simpleBlur(e)},simpleBlur:function(e){var i,n,r=e.filterBackend.resources,s=e.imageData.width,o=e.imageData.height;r.blurLayer1||(r.blurLayer1=t.util.createCanvasElement(),r.blurLayer2=t.util.createCanvasElement()),i=r.blurLayer1,n=r.blurLayer2,i.width===s&&i.height===o||(n.width=i.width=s,n.height=i.height=o);var a,l,c,h,u=i.getContext("2d"),d=n.getContext("2d"),f=.06*this.blur*.5;for(u.putImageData(e.imageData,0,0),d.clearRect(0,0,s,o),h=-15;h<=15;h++)c=f*(l=h/15)*s+(a=(Math.random()-.5)/4),d.globalAlpha=1-Math.abs(l),d.drawImage(i,c,a),u.drawImage(n,0,0),d.globalAlpha=1,d.clearRect(0,0,n.width,n.height);for(h=-15;h<=15;h++)c=f*(l=h/15)*o+(a=(Math.random()-.5)/4),d.globalAlpha=1-Math.abs(l),d.drawImage(i,a,c),u.drawImage(n,0,0),d.globalAlpha=1,d.clearRect(0,0,n.width,n.height);e.ctx.drawImage(i,0,0);var g=e.ctx.getImageData(0,0,i.width,i.height);return u.globalAlpha=1,u.clearRect(0,0,i.width,i.height),g},getUniformLocations:function(e,t){return{delta:e.getUniformLocation(t,"uDelta")}},sendUniformData:function(e,t){var i=this.chooseRightDelta();e.uniform2fv(t.delta,i)},chooseRightDelta:function(){var e,t=1,i=[0,0];return this.horizontal?this.aspectRatio>1&&(t=1/this.aspectRatio):this.aspectRatio<1&&(t=this.aspectRatio),e=t*this.blur*.12,this.horizontal?i[0]=e:i[1]=e,i}}),i.Blur.fromObject=t.Image.filters.BaseFilter.fromObject}(t),function(e){var t=e.fabric||(e.fabric={}),i=t.Image.filters,n=t.util.createClass;i.Gamma=n(i.BaseFilter,{type:"Gamma",fragmentSource:"precision highp float;\nuniform sampler2D uTexture;\nuniform vec3 uGamma;\nvarying vec2 vTexCoord;\nvoid main() {\nvec4 color = texture2D(uTexture, vTexCoord);\nvec3 correction = (1.0 / uGamma);\ncolor.r = pow(color.r, correction.r);\ncolor.g = pow(color.g, correction.g);\ncolor.b = pow(color.b, correction.b);\ngl_FragColor = color;\ngl_FragColor.rgb *= color.a;\n}",gamma:[1,1,1],mainParameter:"gamma",initialize:function(e){this.gamma=[1,1,1],i.BaseFilter.prototype.initialize.call(this,e)},applyTo2d:function(e){var t,i=e.imageData.data,n=this.gamma,r=i.length,s=1/n[0],o=1/n[1],a=1/n[2];for(this.rVals||(this.rVals=new Uint8Array(256),this.gVals=new Uint8Array(256),this.bVals=new Uint8Array(256)),t=0,r=256;t<r;t++)this.rVals[t]=255*Math.pow(t/255,s),this.gVals[t]=255*Math.pow(t/255,o),this.bVals[t]=255*Math.pow(t/255,a);for(t=0,r=i.length;t<r;t+=4)i[t]=this.rVals[i[t]],i[t+1]=this.gVals[i[t+1]],i[t+2]=this.bVals[i[t+2]]},getUniformLocations:function(e,t){return{uGamma:e.getUniformLocation(t,"uGamma")}},sendUniformData:function(e,t){e.uniform3fv(t.uGamma,this.gamma)}}),t.Image.filters.Gamma.fromObject=t.Image.filters.BaseFilter.fromObject}(t),function(e){var t=e.fabric||(e.fabric={}),i=t.Image.filters,n=t.util.createClass;i.Composed=n(i.BaseFilter,{type:"Composed",subFilters:[],initialize:function(e){this.callSuper("initialize",e),this.subFilters=this.subFilters.slice(0)},applyTo:function(e){e.passes+=this.subFilters.length-1,this.subFilters.forEach((function(t){t.applyTo(e)}))},toObject:function(){return t.util.object.extend(this.callSuper("toObject"),{subFilters:this.subFilters.map((function(e){return e.toObject()}))})},isNeutralState:function(){return!this.subFilters.some((function(e){return!e.isNeutralState()}))}}),t.Image.filters.Composed.fromObject=function(e,i){var n=(e.subFilters||[]).map((function(e){return new t.Image.filters[e.type](e)})),r=new t.Image.filters.Composed({subFilters:n});return i&&i(r),r}}(t),function(e){var t=e.fabric||(e.fabric={}),i=t.Image.filters,n=t.util.createClass;i.HueRotation=n(i.ColorMatrix,{type:"HueRotation",rotation:0,mainParameter:"rotation",calculateMatrix:function(){var e=this.rotation*Math.PI,i=t.util.cos(e),n=t.util.sin(e),r=1/3,s=Math.sqrt(r)*n,o=1-i;this.matrix=[1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0],this.matrix[0]=i+o/3,this.matrix[1]=r*o-s,this.matrix[2]=r*o+s,this.matrix[5]=r*o+s,this.matrix[6]=i+r*o,this.matrix[7]=r*o-s,this.matrix[10]=r*o-s,this.matrix[11]=r*o+s,this.matrix[12]=i+r*o},isNeutralState:function(e){return this.calculateMatrix(),i.BaseFilter.prototype.isNeutralState.call(this,e)},applyTo:function(e){this.calculateMatrix(),i.BaseFilter.prototype.applyTo.call(this,e)}}),t.Image.filters.HueRotation.fromObject=t.Image.filters.BaseFilter.fromObject}(t),function(e){var t=e.fabric||(e.fabric={}),i=t.util.object.clone;if(t.Text)t.warn("fabric.Text is already defined");else{var n="fontFamily fontWeight fontSize text underline overline linethrough textAlign fontStyle lineHeight textBackgroundColor charSpacing styles direction path pathStartOffset pathSide pathAlign".split(" ");t.Text=t.util.createClass(t.Object,{_dimensionAffectingProps:["fontSize","fontWeight","fontFamily","fontStyle","lineHeight","text","charSpacing","textAlign","styles","path","pathStartOffset","pathSide","pathAlign"],_reNewline:/\r?\n/,_reSpacesAndTabs:/[ \t\r]/g,_reSpaceAndTab:/[ \t\r]/,_reWords:/\S+/g,type:"text",fontSize:40,fontWeight:"normal",fontFamily:"Times New Roman",underline:!1,overline:!1,linethrough:!1,textAlign:"left",fontStyle:"normal",lineHeight:1.16,superscript:{size:.6,baseline:-.35},subscript:{size:.6,baseline:.11},textBackgroundColor:"",stateProperties:t.Object.prototype.stateProperties.concat(n),cacheProperties:t.Object.prototype.cacheProperties.concat(n),stroke:null,shadow:null,path:null,pathStartOffset:0,pathSide:"left",pathAlign:"baseline",_fontSizeFraction:.222,offsets:{underline:.1,linethrough:-.315,overline:-.88},_fontSizeMult:1.13,charSpacing:0,styles:null,_measuringContext:null,deltaY:0,direction:"ltr",_styleProperties:["stroke","strokeWidth","fill","fontFamily","fontSize","fontWeight","fontStyle","underline","overline","linethrough","deltaY","textBackgroundColor"],__charBounds:[],CACHE_FONT_SIZE:400,MIN_TEXT_WIDTH:2,initialize:function(e,t){this.styles=t&&t.styles||{},this.text=e,this.__skipDimension=!0,this.callSuper("initialize",t),this.path&&this.setPathInfo(),this.__skipDimension=!1,this.initDimensions(),this.setCoords(),this.setupState({propertySet:"_dimensionAffectingProps"})},setPathInfo:function(){var e=this.path;e&&(e.segmentsInfo=t.util.getPathSegmentsInfo(e.path))},getMeasuringContext:function(){return t._measuringContext||(t._measuringContext=this.canvas&&this.canvas.contextCache||t.util.createCanvasElement().getContext("2d")),t._measuringContext},_splitText:function(){var e=this._splitTextIntoLines(this.text);return this.textLines=e.lines,this._textLines=e.graphemeLines,this._unwrappedTextLines=e._unwrappedLines,this._text=e.graphemeText,e},initDimensions:function(){this.__skipDimension||(this._splitText(),this._clearCache(),this.path?(this.width=this.path.width,this.height=this.path.height):(this.width=this.calcTextWidth()||this.cursorWidth||this.MIN_TEXT_WIDTH,this.height=this.calcTextHeight()),-1!==this.textAlign.indexOf("justify")&&this.enlargeSpaces(),this.saveState({propertySet:"_dimensionAffectingProps"}))},enlargeSpaces:function(){for(var e,t,i,n,r,s,o,a=0,l=this._textLines.length;a<l;a++)if(("justify"===this.textAlign||a!==l-1&&!this.isEndOfWrapping(a))&&(n=0,r=this._textLines[a],(t=this.getLineWidth(a))<this.width&&(o=this.textLines[a].match(this._reSpacesAndTabs)))){i=o.length,e=(this.width-t)/i;for(var c=0,h=r.length;c<=h;c++)s=this.__charBounds[a][c],this._reSpaceAndTab.test(r[c])?(s.width+=e,s.kernedWidth+=e,s.left+=n,n+=e):s.left+=n}},isEndOfWrapping:function(e){return e===this._textLines.length-1},missingNewlineOffset:function(){return 1},toString:function(){return"#<fabric.Text ("+this.complexity()+'): { "text": "'+this.text+'", "fontFamily": "'+this.fontFamily+'" }>'},_getCacheCanvasDimensions:function(){var e=this.callSuper("_getCacheCanvasDimensions"),t=this.fontSize;return e.width+=t*e.zoomX,e.height+=t*e.zoomY,e},_render:function(e){var t=this.path;t&&!t.isNotVisible()&&t._render(e),this._setTextStyles(e),this._renderTextLinesBackground(e),this._renderTextDecoration(e,"underline"),this._renderText(e),this._renderTextDecoration(e,"overline"),this._renderTextDecoration(e,"linethrough")},_renderText:function(e){"stroke"===this.paintFirst?(this._renderTextStroke(e),this._renderTextFill(e)):(this._renderTextFill(e),this._renderTextStroke(e))},_setTextStyles:function(e,t,i){if(e.textBaseline="alphabetical",this.path)switch(this.pathAlign){case"center":e.textBaseline="middle";break;case"ascender":e.textBaseline="top";break;case"descender":e.textBaseline="bottom"}e.font=this._getFontDeclaration(t,i)},calcTextWidth:function(){for(var e=this.getLineWidth(0),t=1,i=this._textLines.length;t<i;t++){var n=this.getLineWidth(t);n>e&&(e=n)}return e},_renderTextLine:function(e,t,i,n,r,s){this._renderChars(e,t,i,n,r,s)},_renderTextLinesBackground:function(e){if(this.textBackgroundColor||this.styleHas("textBackgroundColor")){for(var t,i,n,r,s,o,a,l=e.fillStyle,c=this._getLeftOffset(),h=this._getTopOffset(),u=0,d=0,f=this.path,g=0,p=this._textLines.length;g<p;g++)if(t=this.getHeightOfLine(g),this.textBackgroundColor||this.styleHas("textBackgroundColor",g)){n=this._textLines[g],i=this._getLineLeftOffset(g),d=0,u=0,r=this.getValueOfPropertyAt(g,0,"textBackgroundColor");for(var m=0,_=n.length;m<_;m++)s=this.__charBounds[g][m],o=this.getValueOfPropertyAt(g,m,"textBackgroundColor"),f?(e.save(),e.translate(s.renderLeft,s.renderTop),e.rotate(s.angle),e.fillStyle=o,o&&e.fillRect(-s.width/2,-t/this.lineHeight*(1-this._fontSizeFraction),s.width,t/this.lineHeight),e.restore()):o!==r?(a=c+i+u,"rtl"===this.direction&&(a=this.width-a-d),e.fillStyle=r,r&&e.fillRect(a,h,d,t/this.lineHeight),u=s.left,d=s.width,r=o):d+=s.kernedWidth;o&&!f&&(a=c+i+u,"rtl"===this.direction&&(a=this.width-a-d),e.fillStyle=o,e.fillRect(a,h,d,t/this.lineHeight)),h+=t}else h+=t;e.fillStyle=l,this._removeShadow(e)}},getFontCache:function(e){var i=e.fontFamily.toLowerCase();t.charWidthsCache[i]||(t.charWidthsCache[i]={});var n=t.charWidthsCache[i],r=e.fontStyle.toLowerCase()+"_"+(e.fontWeight+"").toLowerCase();return n[r]||(n[r]={}),n[r]},_measureChar:function(e,t,i,n){var r,s,o,a,l=this.getFontCache(t),c=i+e,h=this._getFontDeclaration(t)===this._getFontDeclaration(n),u=t.fontSize/this.CACHE_FONT_SIZE;if(i&&void 0!==l[i]&&(o=l[i]),void 0!==l[e]&&(a=r=l[e]),h&&void 0!==l[c]&&(a=(s=l[c])-o),void 0===r||void 0===o||void 0===s){var d=this.getMeasuringContext();this._setTextStyles(d,t,!0)}return void 0===r&&(a=r=d.measureText(e).width,l[e]=r),void 0===o&&h&&i&&(o=d.measureText(i).width,l[i]=o),h&&void 0===s&&(s=d.measureText(c).width,l[c]=s,a=s-o),{width:r*u,kernedWidth:a*u}},getHeightOfChar:function(e,t){return this.getValueOfPropertyAt(e,t,"fontSize")},measureLine:function(e){var t=this._measureLine(e);return 0!==this.charSpacing&&(t.width-=this._getWidthOfCharSpacing()),t.width<0&&(t.width=0),t},_measureLine:function(e){var i,n,r,s,o,a,l=0,c=this._textLines[e],h=new Array(c.length),u=0,d=this.path,f="right"===this.pathSide;for(this.__charBounds[e]=h,i=0;i<c.length;i++)n=c[i],s=this._getGraphemeBox(n,e,i,r),h[i]=s,l+=s.kernedWidth,r=n;if(h[i]={left:s?s.left+s.width:0,width:0,kernedWidth:0,height:this.fontSize},d){switch(a=d.segmentsInfo[d.segmentsInfo.length-1].length,(o=t.util.getPointOnPath(d.path,0,d.segmentsInfo)).x+=d.pathOffset.x,o.y+=d.pathOffset.y,this.textAlign){case"left":u=f?a-l:0;break;case"center":u=(a-l)/2;break;case"right":u=f?0:a-l}for(u+=this.pathStartOffset*(f?-1:1),i=f?c.length-1:0;f?i>=0:i<c.length;f?i--:i++)s=h[i],u>a?u%=a:u<0&&(u+=a),this._setGraphemeOnPath(u,s,o),u+=s.kernedWidth}return{width:l,numOfSpaces:0}},_setGraphemeOnPath:function(e,i,n){var r=e+i.kernedWidth/2,s=this.path,o=t.util.getPointOnPath(s.path,r,s.segmentsInfo);i.renderLeft=o.x-n.x,i.renderTop=o.y-n.y,i.angle=o.angle+("right"===this.pathSide?Math.PI:0)},_getGraphemeBox:function(e,t,i,n,r){var s,o=this.getCompleteStyleDeclaration(t,i),a=n?this.getCompleteStyleDeclaration(t,i-1):{},l=this._measureChar(e,o,n,a),c=l.kernedWidth,h=l.width;0!==this.charSpacing&&(h+=s=this._getWidthOfCharSpacing(),c+=s);var u={width:h,left:0,height:o.fontSize,kernedWidth:c,deltaY:o.deltaY};if(i>0&&!r){var d=this.__charBounds[t][i-1];u.left=d.left+d.width+l.kernedWidth-l.width}return u},getHeightOfLine:function(e){if(this.__lineHeights[e])return this.__lineHeights[e];for(var t=this._textLines[e],i=this.getHeightOfChar(e,0),n=1,r=t.length;n<r;n++)i=Math.max(this.getHeightOfChar(e,n),i);return this.__lineHeights[e]=i*this.lineHeight*this._fontSizeMult},calcTextHeight:function(){for(var e,t=0,i=0,n=this._textLines.length;i<n;i++)e=this.getHeightOfLine(i),t+=i===n-1?e/this.lineHeight:e;return t},_getLeftOffset:function(){return"ltr"===this.direction?-this.width/2:this.width/2},_getTopOffset:function(){return-this.height/2},_renderTextCommon:function(e,t){e.save();for(var i=0,n=this._getLeftOffset(),r=this._getTopOffset(),s=0,o=this._textLines.length;s<o;s++){var a=this.getHeightOfLine(s),l=a/this.lineHeight,c=this._getLineLeftOffset(s);this._renderTextLine(t,e,this._textLines[s],n+c,r+i+l,s),i+=a}e.restore()},_renderTextFill:function(e){(this.fill||this.styleHas("fill"))&&this._renderTextCommon(e,"fillText")},_renderTextStroke:function(e){(this.stroke&&0!==this.strokeWidth||!this.isEmptyStyles())&&(this.shadow&&!this.shadow.affectStroke&&this._removeShadow(e),e.save(),this._setLineDash(e,this.strokeDashArray),e.beginPath(),this._renderTextCommon(e,"strokeText"),e.closePath(),e.restore())},_renderChars:function(e,t,i,n,r,s){var o,a,l,c,h,u=this.getHeightOfLine(s),d=-1!==this.textAlign.indexOf("justify"),f="",g=0,p=this.path,m=!d&&0===this.charSpacing&&this.isEmptyStyles(s)&&!p,_="ltr"===this.direction,v="ltr"===this.direction?1:-1,y=t.canvas.getAttribute("dir");if(t.save(),y!==this.direction&&(t.canvas.setAttribute("dir",_?"ltr":"rtl"),t.direction=_?"ltr":"rtl",t.textAlign=_?"left":"right"),r-=u*this._fontSizeFraction/this.lineHeight,m)return this._renderChar(e,t,s,0,i.join(""),n,r,u),void t.restore();for(var w=0,b=i.length-1;w<=b;w++)c=w===b||this.charSpacing||p,f+=i[w],l=this.__charBounds[s][w],0===g?(n+=v*(l.kernedWidth-l.width),g+=l.width):g+=l.kernedWidth,d&&!c&&this._reSpaceAndTab.test(i[w])&&(c=!0),c||(o=o||this.getCompleteStyleDeclaration(s,w),a=this.getCompleteStyleDeclaration(s,w+1),c=this._hasStyleChanged(o,a)),c&&(p?(t.save(),t.translate(l.renderLeft,l.renderTop),t.rotate(l.angle),this._renderChar(e,t,s,w,f,-g/2,0,u),t.restore()):(h=n,this._renderChar(e,t,s,w,f,h,r,u)),f="",o=a,n+=v*g,g=0);t.restore()},_applyPatternGradientTransformText:function(e){var i,n=t.util.createCanvasElement(),r=this.width+this.strokeWidth,s=this.height+this.strokeWidth;return n.width=r,n.height=s,(i=n.getContext("2d")).beginPath(),i.moveTo(0,0),i.lineTo(r,0),i.lineTo(r,s),i.lineTo(0,s),i.closePath(),i.translate(r/2,s/2),i.fillStyle=e.toLive(i),this._applyPatternGradientTransform(i,e),i.fill(),i.createPattern(n,"no-repeat")},handleFiller:function(e,t,i){var n,r;return i.toLive?"percentage"===i.gradientUnits||i.gradientTransform||i.patternTransform?(n=-this.width/2,r=-this.height/2,e.translate(n,r),e[t]=this._applyPatternGradientTransformText(i),{offsetX:n,offsetY:r}):(e[t]=i.toLive(e,this),this._applyPatternGradientTransform(e,i)):(e[t]=i,{offsetX:0,offsetY:0})},_setStrokeStyles:function(e,t){return e.lineWidth=t.strokeWidth,e.lineCap=this.strokeLineCap,e.lineDashOffset=this.strokeDashOffset,e.lineJoin=this.strokeLineJoin,e.miterLimit=this.strokeMiterLimit,this.handleFiller(e,"strokeStyle",t.stroke)},_setFillStyles:function(e,t){return this.handleFiller(e,"fillStyle",t.fill)},_renderChar:function(e,t,i,n,r,s,o){var a,l,c=this._getStyleDeclaration(i,n),h=this.getCompleteStyleDeclaration(i,n),u="fillText"===e&&h.fill,d="strokeText"===e&&h.stroke&&h.strokeWidth;(d||u)&&(t.save(),u&&(a=this._setFillStyles(t,h)),d&&(l=this._setStrokeStyles(t,h)),t.font=this._getFontDeclaration(h),c&&c.textBackgroundColor&&this._removeShadow(t),c&&c.deltaY&&(o+=c.deltaY),u&&t.fillText(r,s-a.offsetX,o-a.offsetY),d&&t.strokeText(r,s-l.offsetX,o-l.offsetY),t.restore())},setSuperscript:function(e,t){return this._setScript(e,t,this.superscript)},setSubscript:function(e,t){return this._setScript(e,t,this.subscript)},_setScript:function(e,t,i){var n=this.get2DCursorLocation(e,!0),r=this.getValueOfPropertyAt(n.lineIndex,n.charIndex,"fontSize"),s=this.getValueOfPropertyAt(n.lineIndex,n.charIndex,"deltaY"),o={fontSize:r*i.size,deltaY:s+r*i.baseline};return this.setSelectionStyles(o,e,t),this},_hasStyleChanged:function(e,t){return e.fill!==t.fill||e.stroke!==t.stroke||e.strokeWidth!==t.strokeWidth||e.fontSize!==t.fontSize||e.fontFamily!==t.fontFamily||e.fontWeight!==t.fontWeight||e.fontStyle!==t.fontStyle||e.deltaY!==t.deltaY},_hasStyleChangedForSvg:function(e,t){return this._hasStyleChanged(e,t)||e.overline!==t.overline||e.underline!==t.underline||e.linethrough!==t.linethrough},_getLineLeftOffset:function(e){var t=this.getLineWidth(e),i=this.width-t,n=this.textAlign,r=this.direction,s=0,o=this.isEndOfWrapping(e);return"justify"===n||"justify-center"===n&&!o||"justify-right"===n&&!o||"justify-left"===n&&!o?0:("center"===n&&(s=i/2),"right"===n&&(s=i),"justify-center"===n&&(s=i/2),"justify-right"===n&&(s=i),"rtl"===r&&(s-=i),s)},_clearCache:function(){this.__lineWidths=[],this.__lineHeights=[],this.__charBounds=[]},_shouldClearDimensionCache:function(){var e=this._forceClearCache;return e||(e=this.hasStateChanged("_dimensionAffectingProps")),e&&(this.dirty=!0,this._forceClearCache=!1),e},getLineWidth:function(e){if(void 0!==this.__lineWidths[e])return this.__lineWidths[e];var t=this.measureLine(e).width;return this.__lineWidths[e]=t,t},_getWidthOfCharSpacing:function(){return 0!==this.charSpacing?this.fontSize*this.charSpacing/1e3:0},getValueOfPropertyAt:function(e,t,i){var n=this._getStyleDeclaration(e,t);return n&&void 0!==n[i]?n[i]:this[i]},_renderTextDecoration:function(e,t){if(this[t]||this.styleHas(t)){for(var i,n,r,s,o,a,l,c,h,u,d,f,g,p,m,_,v=this._getLeftOffset(),y=this._getTopOffset(),w=this.path,b=this._getWidthOfCharSpacing(),C=this.offsets[t],S=0,E=this._textLines.length;S<E;S++)if(i=this.getHeightOfLine(S),this[t]||this.styleHas(t,S)){l=this._textLines[S],p=i/this.lineHeight,s=this._getLineLeftOffset(S),u=0,d=0,c=this.getValueOfPropertyAt(S,0,t),_=this.getValueOfPropertyAt(S,0,"fill"),h=y+p*(1-this._fontSizeFraction),n=this.getHeightOfChar(S,0),o=this.getValueOfPropertyAt(S,0,"deltaY");for(var T=0,x=l.length;T<x;T++)if(f=this.__charBounds[S][T],g=this.getValueOfPropertyAt(S,T,t),m=this.getValueOfPropertyAt(S,T,"fill"),r=this.getHeightOfChar(S,T),a=this.getValueOfPropertyAt(S,T,"deltaY"),w&&g&&m)e.save(),e.fillStyle=_,e.translate(f.renderLeft,f.renderTop),e.rotate(f.angle),e.fillRect(-f.kernedWidth/2,C*r+a,f.kernedWidth,this.fontSize/15),e.restore();else if((g!==c||m!==_||r!==n||a!==o)&&d>0){var I=v+s+u;"rtl"===this.direction&&(I=this.width-I-d),c&&_&&(e.fillStyle=_,e.fillRect(I,h+C*n+o,d,this.fontSize/15)),u=f.left,d=f.width,c=g,_=m,n=r,o=a}else d+=f.kernedWidth;I=v+s+u,"rtl"===this.direction&&(I=this.width-I-d),e.fillStyle=m,g&&m&&e.fillRect(I,h+C*n+o,d-b,this.fontSize/15),y+=i}else y+=i;this._removeShadow(e)}},_getFontDeclaration:function(e,i){var n=e||this,r=this.fontFamily,s=t.Text.genericFonts.indexOf(r.toLowerCase())>-1,o=void 0===r||r.indexOf("'")>-1||r.indexOf(",")>-1||r.indexOf('"')>-1||s?n.fontFamily:'"'+n.fontFamily+'"';return[t.isLikelyNode?n.fontWeight:n.fontStyle,t.isLikelyNode?n.fontStyle:n.fontWeight,i?this.CACHE_FONT_SIZE+"px":n.fontSize+"px",o].join(" ")},render:function(e){this.visible&&(this.canvas&&this.canvas.skipOffscreen&&!this.group&&!this.isOnScreen()||(this._shouldClearDimensionCache()&&this.initDimensions(),this.callSuper("render",e)))},_splitTextIntoLines:function(e){for(var i=e.split(this._reNewline),n=new Array(i.length),r=["\n"],s=[],o=0;o<i.length;o++)n[o]=t.util.string.graphemeSplit(i[o]),s=s.concat(n[o],r);return s.pop(),{_unwrappedLines:n,lines:i,graphemeText:s,graphemeLines:n}},toObject:function(e){var t=n.concat(e),r=this.callSuper("toObject",t);return r.styles=i(this.styles,!0),r.path&&(r.path=this.path.toObject()),r},set:function(e,t){this.callSuper("set",e,t);var i=!1,n=!1;if("object"==typeof e)for(var r in e)"path"===r&&this.setPathInfo(),i=i||-1!==this._dimensionAffectingProps.indexOf(r),n=n||"path"===r;else i=-1!==this._dimensionAffectingProps.indexOf(e),n="path"===e;return n&&this.setPathInfo(),i&&(this.initDimensions(),this.setCoords()),this},complexity:function(){return 1}}),t.Text.ATTRIBUTE_NAMES=t.SHARED_ATTRIBUTES.concat("x y dx dy font-family font-style font-weight font-size letter-spacing text-decoration text-anchor".split(" ")),t.Text.DEFAULT_SVG_FONT_SIZE=16,t.Text.fromElement=function(e,n,r){if(!e)return n(null);var s=t.parseAttributes(e,t.Text.ATTRIBUTE_NAMES),o=s.textAnchor||"left";if((r=t.util.object.extend(r?i(r):{},s)).top=r.top||0,r.left=r.left||0,s.textDecoration){var a=s.textDecoration;-1!==a.indexOf("underline")&&(r.underline=!0),-1!==a.indexOf("overline")&&(r.overline=!0),-1!==a.indexOf("line-through")&&(r.linethrough=!0),delete r.textDecoration}"dx"in s&&(r.left+=s.dx),"dy"in s&&(r.top+=s.dy),"fontSize"in r||(r.fontSize=t.Text.DEFAULT_SVG_FONT_SIZE);var l="";"textContent"in e?l=e.textContent:"firstChild"in e&&null!==e.firstChild&&"data"in e.firstChild&&null!==e.firstChild.data&&(l=e.firstChild.data),l=l.replace(/^\s+|\s+$|\n+/g,"").replace(/\s+/g," ");var c=r.strokeWidth;r.strokeWidth=0;var h=new t.Text(l,r),u=h.getScaledHeight()/h.height,d=((h.height+h.strokeWidth)*h.lineHeight-h.height)*u,f=h.getScaledHeight()+d,g=0;"center"===o&&(g=h.getScaledWidth()/2),"right"===o&&(g=h.getScaledWidth()),h.set({left:h.left-g,top:h.top-(f-h.fontSize*(.07+h._fontSizeFraction))/h.lineHeight,strokeWidth:void 0!==c?c:1}),n(h)},t.Text.fromObject=function(e,n){var r=i(e),s=e.path;return delete r.path,t.Object._fromObject("Text",r,(function(e){s?t.Object._fromObject("Path",s,(function(t){e.set("path",t),n(e)}),"path"):n(e)}),"text")},t.Text.genericFonts=["sans-serif","serif","cursive","fantasy","monospace"],t.util.createAccessors&&t.util.createAccessors(t.Text)}}(t),E.util.object.extend(E.Text.prototype,{isEmptyStyles:function(e){if(!this.styles)return!0;if(void 0!==e&&!this.styles[e])return!0;var t=void 0===e?this.styles:{line:this.styles[e]};for(var i in t)for(var n in t[i])for(var r in t[i][n])return!1;return!0},styleHas:function(e,t){if(!this.styles||!e||""===e)return!1;if(void 0!==t&&!this.styles[t])return!1;var i=void 0===t?this.styles:{0:this.styles[t]};for(var n in i)for(var r in i[n])if(void 0!==i[n][r][e])return!0;return!1},cleanStyle:function(e){if(!this.styles||!e||""===e)return!1;var t,i,n=this.styles,r=0,s=!0,o=0;for(var a in n){for(var l in t=0,n[a]){var c;r++,(c=n[a][l]).hasOwnProperty(e)?(i?c[e]!==i&&(s=!1):i=c[e],c[e]===this[e]&&delete c[e]):s=!1,0!==Object.keys(c).length?t++:delete n[a][l]}0===t&&delete n[a]}for(var h=0;h<this._textLines.length;h++)o+=this._textLines[h].length;s&&r===o&&(this[e]=i,this.removeStyle(e))},removeStyle:function(e){if(this.styles&&e&&""!==e){var t,i,n,r=this.styles;for(i in r){for(n in t=r[i])delete t[n][e],0===Object.keys(t[n]).length&&delete t[n];0===Object.keys(t).length&&delete r[i]}}},_extendStyles:function(e,t){var i=this.get2DCursorLocation(e);this._getLineStyle(i.lineIndex)||this._setLineStyle(i.lineIndex),this._getStyleDeclaration(i.lineIndex,i.charIndex)||this._setStyleDeclaration(i.lineIndex,i.charIndex,{}),E.util.object.extend(this._getStyleDeclaration(i.lineIndex,i.charIndex),t)},get2DCursorLocation:function(e,t){void 0===e&&(e=this.selectionStart);for(var i=t?this._unwrappedTextLines:this._textLines,n=i.length,r=0;r<n;r++){if(e<=i[r].length)return{lineIndex:r,charIndex:e};e-=i[r].length+this.missingNewlineOffset(r)}return{lineIndex:r-1,charIndex:i[r-1].length<e?i[r-1].length:e}},getSelectionStyles:function(e,t,i){void 0===e&&(e=this.selectionStart||0),void 0===t&&(t=this.selectionEnd||e);for(var n=[],r=e;r<t;r++)n.push(this.getStyleAtPosition(r,i));return n},getStyleAtPosition:function(e,t){var i=this.get2DCursorLocation(e);return(t?this.getCompleteStyleDeclaration(i.lineIndex,i.charIndex):this._getStyleDeclaration(i.lineIndex,i.charIndex))||{}},setSelectionStyles:function(e,t,i){void 0===t&&(t=this.selectionStart||0),void 0===i&&(i=this.selectionEnd||t);for(var n=t;n<i;n++)this._extendStyles(n,e);return this._forceClearCache=!0,this},_getStyleDeclaration:function(e,t){var i=this.styles&&this.styles[e];return i?i[t]:null},getCompleteStyleDeclaration:function(e,t){for(var i,n=this._getStyleDeclaration(e,t)||{},r={},s=0;s<this._styleProperties.length;s++)r[i=this._styleProperties[s]]=void 0===n[i]?this[i]:n[i];return r},_setStyleDeclaration:function(e,t,i){this.styles[e][t]=i},_deleteStyleDeclaration:function(e,t){delete this.styles[e][t]},_getLineStyle:function(e){return!!this.styles[e]},_setLineStyle:function(e){this.styles[e]={}},_deleteLineStyle:function(e){delete this.styles[e]}}),function(){function e(e){e.textDecoration&&(e.textDecoration.indexOf("underline")>-1&&(e.underline=!0),e.textDecoration.indexOf("line-through")>-1&&(e.linethrough=!0),e.textDecoration.indexOf("overline")>-1&&(e.overline=!0),delete e.textDecoration)}E.IText=E.util.createClass(E.Text,E.Observable,{type:"i-text",selectionStart:0,selectionEnd:0,selectionColor:"rgba(17,119,255,0.3)",isEditing:!1,editable:!0,editingBorderColor:"rgba(102,153,255,0.25)",cursorWidth:2,cursorColor:"",cursorDelay:1e3,cursorDuration:600,caching:!0,hiddenTextareaContainer:null,_reSpace:/\s|\n/,_currentCursorOpacity:0,_selectionDirection:null,_abortCursorAnimation:!1,__widthOfSpace:[],inCompositionMode:!1,initialize:function(e,t){this.callSuper("initialize",e,t),this.initBehavior()},setSelectionStart:function(e){e=Math.max(e,0),this._updateAndFire("selectionStart",e)},setSelectionEnd:function(e){e=Math.min(e,this.text.length),this._updateAndFire("selectionEnd",e)},_updateAndFire:function(e,t){this[e]!==t&&(this._fireSelectionChanged(),this[e]=t),this._updateTextarea()},_fireSelectionChanged:function(){this.fire("selection:changed"),this.canvas&&this.canvas.fire("text:selection:changed",{target:this})},initDimensions:function(){this.isEditing&&this.initDelayedCursor(),this.clearContextTop(),this.callSuper("initDimensions")},render:function(e){this.clearContextTop(),this.callSuper("render",e),this.cursorOffsetCache={},this.renderCursorOrSelection()},_render:function(e){this.callSuper("_render",e)},clearContextTop:function(e){if(this.isEditing&&this.canvas&&this.canvas.contextTop){var t=this.canvas.contextTop,i=this.canvas.viewportTransform;t.save(),t.transform(i[0],i[1],i[2],i[3],i[4],i[5]),this.transform(t),this._clearTextArea(t),e||t.restore()}},renderCursorOrSelection:function(){if(this.isEditing&&this.canvas&&this.canvas.contextTop){var e=this._getCursorBoundaries(),t=this.canvas.contextTop;this.clearContextTop(!0),this.selectionStart===this.selectionEnd?this.renderCursor(e,t):this.renderSelection(e,t),t.restore()}},_clearTextArea:function(e){var t=this.width+4,i=this.height+4;e.clearRect(-t/2,-i/2,t,i)},_getCursorBoundaries:function(e){void 0===e&&(e=this.selectionStart);var t=this._getLeftOffset(),i=this._getTopOffset(),n=this._getCursorBoundariesOffsets(e);return{left:t,top:i,leftOffset:n.left,topOffset:n.top}},_getCursorBoundariesOffsets:function(e){if(this.cursorOffsetCache&&"top"in this.cursorOffsetCache)return this.cursorOffsetCache;var t,i,n,r,s=0,o=0,a=this.get2DCursorLocation(e);n=a.charIndex,i=a.lineIndex;for(var l=0;l<i;l++)s+=this.getHeightOfLine(l);t=this._getLineLeftOffset(i);var c=this.__charBounds[i][n];return c&&(o=c.left),0!==this.charSpacing&&n===this._textLines[i].length&&(o-=this._getWidthOfCharSpacing()),r={top:s,left:t+(o>0?o:0)},"rtl"===this.direction&&(r.left*=-1),this.cursorOffsetCache=r,this.cursorOffsetCache},renderCursor:function(e,t){var i=this.get2DCursorLocation(),n=i.lineIndex,r=i.charIndex>0?i.charIndex-1:0,s=this.getValueOfPropertyAt(n,r,"fontSize"),o=this.scaleX*this.canvas.getZoom(),a=this.cursorWidth/o,l=e.topOffset,c=this.getValueOfPropertyAt(n,r,"deltaY");l+=(1-this._fontSizeFraction)*this.getHeightOfLine(n)/this.lineHeight-s*(1-this._fontSizeFraction),this.inCompositionMode&&this.renderSelection(e,t),t.fillStyle=this.cursorColor||this.getValueOfPropertyAt(n,r,"fill"),t.globalAlpha=this.__isMousedown?1:this._currentCursorOpacity,t.fillRect(e.left+e.leftOffset-a/2,l+e.top+c,a,s)},renderSelection:function(e,t){for(var i=this.inCompositionMode?this.hiddenTextarea.selectionStart:this.selectionStart,n=this.inCompositionMode?this.hiddenTextarea.selectionEnd:this.selectionEnd,r=-1!==this.textAlign.indexOf("justify"),s=this.get2DCursorLocation(i),o=this.get2DCursorLocation(n),a=s.lineIndex,l=o.lineIndex,c=s.charIndex<0?0:s.charIndex,h=o.charIndex<0?0:o.charIndex,u=a;u<=l;u++){var d,f=this._getLineLeftOffset(u)||0,g=this.getHeightOfLine(u),p=0,m=0;if(u===a&&(p=this.__charBounds[a][c].left),u>=a&&u<l)m=r&&!this.isEndOfWrapping(u)?this.width:this.getLineWidth(u)||5;else if(u===l)if(0===h)m=this.__charBounds[l][h].left;else{var _=this._getWidthOfCharSpacing();m=this.__charBounds[l][h-1].left+this.__charBounds[l][h-1].width-_}d=g,(this.lineHeight<1||u===l&&this.lineHeight>1)&&(g/=this.lineHeight);var v=e.left+f+p,y=m-p,w=g,b=0;this.inCompositionMode?(t.fillStyle=this.compositionColor||"black",w=1,b=g):t.fillStyle=this.selectionColor,"rtl"===this.direction&&(v=this.width-v-y),t.fillRect(v,e.top+e.topOffset+b,y,w),e.topOffset+=d}},getCurrentCharFontSize:function(){var e=this._getCurrentCharIndex();return this.getValueOfPropertyAt(e.l,e.c,"fontSize")},getCurrentCharColor:function(){var e=this._getCurrentCharIndex();return this.getValueOfPropertyAt(e.l,e.c,"fill")},_getCurrentCharIndex:function(){var e=this.get2DCursorLocation(this.selectionStart,!0),t=e.charIndex>0?e.charIndex-1:0;return{l:e.lineIndex,c:t}}}),E.IText.fromObject=function(t,i){if(e(t),t.styles)for(var n in t.styles)for(var r in t.styles[n])e(t.styles[n][r]);E.Object._fromObject("IText",t,i,"text")}}(),S=E.util.object.clone,E.util.object.extend(E.IText.prototype,{initBehavior:function(){this.initAddedHandler(),this.initRemovedHandler(),this.initCursorSelectionHandlers(),this.initDoubleClickSimulation(),this.mouseMoveHandler=this.mouseMoveHandler.bind(this)},onDeselect:function(){this.isEditing&&this.exitEditing(),this.selected=!1},initAddedHandler:function(){var e=this;this.on("added",(function(){var t=e.canvas;t&&(t._hasITextHandlers||(t._hasITextHandlers=!0,e._initCanvasHandlers(t)),t._iTextInstances=t._iTextInstances||[],t._iTextInstances.push(e))}))},initRemovedHandler:function(){var e=this;this.on("removed",(function(){var t=e.canvas;t&&(t._iTextInstances=t._iTextInstances||[],E.util.removeFromArray(t._iTextInstances,e),0===t._iTextInstances.length&&(t._hasITextHandlers=!1,e._removeCanvasHandlers(t)))}))},_initCanvasHandlers:function(e){e._mouseUpITextHandler=function(){e._iTextInstances&&e._iTextInstances.forEach((function(e){e.__isMousedown=!1}))},e.on("mouse:up",e._mouseUpITextHandler)},_removeCanvasHandlers:function(e){e.off("mouse:up",e._mouseUpITextHandler)},_tick:function(){this._currentTickState=this._animateCursor(this,1,this.cursorDuration,"_onTickComplete")},_animateCursor:function(e,t,i,n){var r;return r={isAborted:!1,abort:function(){this.isAborted=!0}},e.animate("_currentCursorOpacity",t,{duration:i,onComplete:function(){r.isAborted||e[n]()},onChange:function(){e.canvas&&e.selectionStart===e.selectionEnd&&e.renderCursorOrSelection()},abort:function(){return r.isAborted}}),r},_onTickComplete:function(){var e=this;this._cursorTimeout1&&clearTimeout(this._cursorTimeout1),this._cursorTimeout1=setTimeout((function(){e._currentTickCompleteState=e._animateCursor(e,0,this.cursorDuration/2,"_tick")}),100)},initDelayedCursor:function(e){var t=this,i=e?0:this.cursorDelay;this.abortCursorAnimation(),this._currentCursorOpacity=1,this._cursorTimeout2=setTimeout((function(){t._tick()}),i)},abortCursorAnimation:function(){var e=this._currentTickState||this._currentTickCompleteState,t=this.canvas;this._currentTickState&&this._currentTickState.abort(),this._currentTickCompleteState&&this._currentTickCompleteState.abort(),clearTimeout(this._cursorTimeout1),clearTimeout(this._cursorTimeout2),this._currentCursorOpacity=0,e&&t&&t.clearContext(t.contextTop||t.contextContainer)},selectAll:function(){return this.selectionStart=0,this.selectionEnd=this._text.length,this._fireSelectionChanged(),this._updateTextarea(),this},getSelectedText:function(){return this._text.slice(this.selectionStart,this.selectionEnd).join("")},findWordBoundaryLeft:function(e){var t=0,i=e-1;if(this._reSpace.test(this._text[i]))for(;this._reSpace.test(this._text[i]);)t++,i--;for(;/\S/.test(this._text[i])&&i>-1;)t++,i--;return e-t},findWordBoundaryRight:function(e){var t=0,i=e;if(this._reSpace.test(this._text[i]))for(;this._reSpace.test(this._text[i]);)t++,i++;for(;/\S/.test(this._text[i])&&i<this._text.length;)t++,i++;return e+t},findLineBoundaryLeft:function(e){for(var t=0,i=e-1;!/\n/.test(this._text[i])&&i>-1;)t++,i--;return e-t},findLineBoundaryRight:function(e){for(var t=0,i=e;!/\n/.test(this._text[i])&&i<this._text.length;)t++,i++;return e+t},searchWordBoundary:function(e,t){for(var i=this._text,n=this._reSpace.test(i[e])?e-1:e,r=i[n],s=E.reNonWord;!s.test(r)&&n>0&&n<i.length;)r=i[n+=t];return s.test(r)&&(n+=1===t?0:1),n},selectWord:function(e){e=e||this.selectionStart;var t=this.searchWordBoundary(e,-1),i=this.searchWordBoundary(e,1);this.selectionStart=t,this.selectionEnd=i,this._fireSelectionChanged(),this._updateTextarea(),this.renderCursorOrSelection()},selectLine:function(e){e=e||this.selectionStart;var t=this.findLineBoundaryLeft(e),i=this.findLineBoundaryRight(e);return this.selectionStart=t,this.selectionEnd=i,this._fireSelectionChanged(),this._updateTextarea(),this},enterEditing:function(e){if(!this.isEditing&&this.editable)return this.canvas&&(this.canvas.calcOffset(),this.exitEditingOnOthers(this.canvas)),this.isEditing=!0,this.initHiddenTextarea(e),this.hiddenTextarea.focus(),this.hiddenTextarea.value=this.text,this._updateTextarea(),this._saveEditingProps(),this._setEditingProps(),this._textBeforeEdit=this.text,this._tick(),this.fire("editing:entered"),this._fireSelectionChanged(),this.canvas?(this.canvas.fire("text:editing:entered",{target:this}),this.initMouseMoveHandler(),this.canvas.requestRenderAll(),this):this},exitEditingOnOthers:function(e){e._iTextInstances&&e._iTextInstances.forEach((function(e){e.selected=!1,e.isEditing&&e.exitEditing()}))},initMouseMoveHandler:function(){this.canvas.on("mouse:move",this.mouseMoveHandler)},mouseMoveHandler:function(e){if(this.__isMousedown&&this.isEditing){var t=this.getSelectionStartFromPointer(e.e),i=this.selectionStart,n=this.selectionEnd;(t===this.__selectionStartOnMouseDown&&i!==n||i!==t&&n!==t)&&(t>this.__selectionStartOnMouseDown?(this.selectionStart=this.__selectionStartOnMouseDown,this.selectionEnd=t):(this.selectionStart=t,this.selectionEnd=this.__selectionStartOnMouseDown),this.selectionStart===i&&this.selectionEnd===n||(this.restartCursorIfNeeded(),this._fireSelectionChanged(),this._updateTextarea(),this.renderCursorOrSelection()))}},_setEditingProps:function(){this.hoverCursor="text",this.canvas&&(this.canvas.defaultCursor=this.canvas.moveCursor="text"),this.borderColor=this.editingBorderColor,this.hasControls=this.selectable=!1,this.lockMovementX=this.lockMovementY=!0},fromStringToGraphemeSelection:function(e,t,i){var n=i.slice(0,e),r=E.util.string.graphemeSplit(n).length;if(e===t)return{selectionStart:r,selectionEnd:r};var s=i.slice(e,t);return{selectionStart:r,selectionEnd:r+E.util.string.graphemeSplit(s).length}},fromGraphemeToStringSelection:function(e,t,i){var n=i.slice(0,e).join("").length;return e===t?{selectionStart:n,selectionEnd:n}:{selectionStart:n,selectionEnd:n+i.slice(e,t).join("").length}},_updateTextarea:function(){if(this.cursorOffsetCache={},this.hiddenTextarea){if(!this.inCompositionMode){var e=this.fromGraphemeToStringSelection(this.selectionStart,this.selectionEnd,this._text);this.hiddenTextarea.selectionStart=e.selectionStart,this.hiddenTextarea.selectionEnd=e.selectionEnd}this.updateTextareaPosition()}},updateFromTextArea:function(){if(this.hiddenTextarea){this.cursorOffsetCache={},this.text=this.hiddenTextarea.value,this._shouldClearDimensionCache()&&(this.initDimensions(),this.setCoords());var e=this.fromStringToGraphemeSelection(this.hiddenTextarea.selectionStart,this.hiddenTextarea.selectionEnd,this.hiddenTextarea.value);this.selectionEnd=this.selectionStart=e.selectionEnd,this.inCompositionMode||(this.selectionStart=e.selectionStart),this.updateTextareaPosition()}},updateTextareaPosition:function(){if(this.selectionStart===this.selectionEnd){var e=this._calcTextareaPosition();this.hiddenTextarea.style.left=e.left,this.hiddenTextarea.style.top=e.top}},_calcTextareaPosition:function(){if(!this.canvas)return{x:1,y:1};var e=this.inCompositionMode?this.compositionStart:this.selectionStart,t=this._getCursorBoundaries(e),i=this.get2DCursorLocation(e),n=i.lineIndex,r=i.charIndex,s=this.getValueOfPropertyAt(n,r,"fontSize")*this.lineHeight,o=t.leftOffset,a=this.calcTransformMatrix(),l={x:t.left+o,y:t.top+t.topOffset+s},c=this.canvas.getRetinaScaling(),h=this.canvas.upperCanvasEl,u=h.width/c,d=h.height/c,f=u-s,g=d-s,p=h.clientWidth/u,m=h.clientHeight/d;return l=E.util.transformPoint(l,a),(l=E.util.transformPoint(l,this.canvas.viewportTransform)).x*=p,l.y*=m,l.x<0&&(l.x=0),l.x>f&&(l.x=f),l.y<0&&(l.y=0),l.y>g&&(l.y=g),l.x+=this.canvas._offset.left,l.y+=this.canvas._offset.top,{left:l.x+"px",top:l.y+"px",fontSize:s+"px",charHeight:s}},_saveEditingProps:function(){this._savedProps={hasControls:this.hasControls,borderColor:this.borderColor,lockMovementX:this.lockMovementX,lockMovementY:this.lockMovementY,hoverCursor:this.hoverCursor,selectable:this.selectable,defaultCursor:this.canvas&&this.canvas.defaultCursor,moveCursor:this.canvas&&this.canvas.moveCursor}},_restoreEditingProps:function(){this._savedProps&&(this.hoverCursor=this._savedProps.hoverCursor,this.hasControls=this._savedProps.hasControls,this.borderColor=this._savedProps.borderColor,this.selectable=this._savedProps.selectable,this.lockMovementX=this._savedProps.lockMovementX,this.lockMovementY=this._savedProps.lockMovementY,this.canvas&&(this.canvas.defaultCursor=this._savedProps.defaultCursor,this.canvas.moveCursor=this._savedProps.moveCursor))},exitEditing:function(){var e=this._textBeforeEdit!==this.text,t=this.hiddenTextarea;return this.selected=!1,this.isEditing=!1,this.selectionEnd=this.selectionStart,t&&(t.blur&&t.blur(),t.parentNode&&t.parentNode.removeChild(t)),this.hiddenTextarea=null,this.abortCursorAnimation(),this._restoreEditingProps(),this._currentCursorOpacity=0,this._shouldClearDimensionCache()&&(this.initDimensions(),this.setCoords()),this.fire("editing:exited"),e&&this.fire("modified"),this.canvas&&(this.canvas.off("mouse:move",this.mouseMoveHandler),this.canvas.fire("text:editing:exited",{target:this}),e&&this.canvas.fire("object:modified",{target:this})),this},_removeExtraneousStyles:function(){for(var e in this.styles)this._textLines[e]||delete this.styles[e]},removeStyleFromTo:function(e,t){var i,n,r=this.get2DCursorLocation(e,!0),s=this.get2DCursorLocation(t,!0),o=r.lineIndex,a=r.charIndex,l=s.lineIndex,c=s.charIndex;if(o!==l){if(this.styles[o])for(i=a;i<this._unwrappedTextLines[o].length;i++)delete this.styles[o][i];if(this.styles[l])for(i=c;i<this._unwrappedTextLines[l].length;i++)(n=this.styles[l][i])&&(this.styles[o]||(this.styles[o]={}),this.styles[o][a+i-c]=n);for(i=o+1;i<=l;i++)delete this.styles[i];this.shiftLineStyles(l,o-l)}else if(this.styles[o]){n=this.styles[o];var h,u,d=c-a;for(i=a;i<c;i++)delete n[i];for(u in this.styles[o])(h=parseInt(u,10))>=c&&(n[h-d]=n[u],delete n[u])}},shiftLineStyles:function(e,t){var i=S(this.styles);for(var n in this.styles){var r=parseInt(n,10);r>e&&(this.styles[r+t]=i[r],i[r-t]||delete this.styles[r])}},restartCursorIfNeeded:function(){this._currentTickState&&!this._currentTickState.isAborted&&this._currentTickCompleteState&&!this._currentTickCompleteState.isAborted||this.initDelayedCursor()},insertNewlineStyleObject:function(e,t,i,n){var r,s={},o=!1,a=this._unwrappedTextLines[e].length===t;for(var l in i||(i=1),this.shiftLineStyles(e,i),this.styles[e]&&(r=this.styles[e][0===t?t:t-1]),this.styles[e]){var c=parseInt(l,10);c>=t&&(o=!0,s[c-t]=this.styles[e][l],a&&0===t||delete this.styles[e][l])}var h=!1;for(o&&!a&&(this.styles[e+i]=s,h=!0),h&&i--;i>0;)n&&n[i-1]?this.styles[e+i]={0:S(n[i-1])}:r?this.styles[e+i]={0:S(r)}:delete this.styles[e+i],i--;this._forceClearCache=!0},insertCharStyleObject:function(e,t,i,n){this.styles||(this.styles={});var r=this.styles[e],s=r?S(r):{};for(var o in i||(i=1),s){var a=parseInt(o,10);a>=t&&(r[a+i]=s[a],s[a-i]||delete r[a])}if(this._forceClearCache=!0,n)for(;i--;)Object.keys(n[i]).length&&(this.styles[e]||(this.styles[e]={}),this.styles[e][t+i]=S(n[i]));else if(r)for(var l=r[t?t-1:1];l&&i--;)this.styles[e][t+i]=S(l)},insertNewStyleBlock:function(e,t,i){for(var n=this.get2DCursorLocation(t,!0),r=[0],s=0,o=0;o<e.length;o++)"\n"===e[o]?r[++s]=0:r[s]++;for(r[0]>0&&(this.insertCharStyleObject(n.lineIndex,n.charIndex,r[0],i),i=i&&i.slice(r[0]+1)),s&&this.insertNewlineStyleObject(n.lineIndex,n.charIndex+r[0],s),o=1;o<s;o++)r[o]>0?this.insertCharStyleObject(n.lineIndex+o,0,r[o],i):i&&this.styles[n.lineIndex+o]&&i[0]&&(this.styles[n.lineIndex+o][0]=i[0]),i=i&&i.slice(r[o]+1);r[o]>0&&this.insertCharStyleObject(n.lineIndex+o,0,r[o],i)},setSelectionStartEndWithShift:function(e,t,i){i<=e?(t===e?this._selectionDirection="left":"right"===this._selectionDirection&&(this._selectionDirection="left",this.selectionEnd=e),this.selectionStart=i):i>e&&i<t?"right"===this._selectionDirection?this.selectionEnd=i:this.selectionStart=i:(t===e?this._selectionDirection="right":"left"===this._selectionDirection&&(this._selectionDirection="right",this.selectionStart=t),this.selectionEnd=i)},setSelectionInBoundaries:function(){var e=this.text.length;this.selectionStart>e?this.selectionStart=e:this.selectionStart<0&&(this.selectionStart=0),this.selectionEnd>e?this.selectionEnd=e:this.selectionEnd<0&&(this.selectionEnd=0)}}),E.util.object.extend(E.IText.prototype,{initDoubleClickSimulation:function(){this.__lastClickTime=+new Date,this.__lastLastClickTime=+new Date,this.__lastPointer={},this.on("mousedown",this.onMouseDown)},onMouseDown:function(e){if(this.canvas){this.__newClickTime=+new Date;var t=e.pointer;this.isTripleClick(t)&&(this.fire("tripleclick",e),this._stopEvent(e.e)),this.__lastLastClickTime=this.__lastClickTime,this.__lastClickTime=this.__newClickTime,this.__lastPointer=t,this.__lastIsEditing=this.isEditing,this.__lastSelected=this.selected}},isTripleClick:function(e){return this.__newClickTime-this.__lastClickTime<500&&this.__lastClickTime-this.__lastLastClickTime<500&&this.__lastPointer.x===e.x&&this.__lastPointer.y===e.y},_stopEvent:function(e){e.preventDefault&&e.preventDefault(),e.stopPropagation&&e.stopPropagation()},initCursorSelectionHandlers:function(){this.initMousedownHandler(),this.initMouseupHandler(),this.initClicks()},doubleClickHandler:function(e){this.isEditing&&this.selectWord(this.getSelectionStartFromPointer(e.e))},tripleClickHandler:function(e){this.isEditing&&this.selectLine(this.getSelectionStartFromPointer(e.e))},initClicks:function(){this.on("mousedblclick",this.doubleClickHandler),this.on("tripleclick",this.tripleClickHandler)},_mouseDownHandler:function(e){!this.canvas||!this.editable||e.e.button&&1!==e.e.button||(this.__isMousedown=!0,this.selected&&(this.inCompositionMode=!1,this.setCursorByClick(e.e)),this.isEditing&&(this.__selectionStartOnMouseDown=this.selectionStart,this.selectionStart===this.selectionEnd&&this.abortCursorAnimation(),this.renderCursorOrSelection()))},_mouseDownHandlerBefore:function(e){!this.canvas||!this.editable||e.e.button&&1!==e.e.button||(this.selected=this===this.canvas._activeObject)},initMousedownHandler:function(){this.on("mousedown",this._mouseDownHandler),this.on("mousedown:before",this._mouseDownHandlerBefore)},initMouseupHandler:function(){this.on("mouseup",this.mouseUpHandler)},mouseUpHandler:function(e){if(this.__isMousedown=!1,!(!this.editable||this.group||e.transform&&e.transform.actionPerformed||e.e.button&&1!==e.e.button)){if(this.canvas){var t=this.canvas._activeObject;if(t&&t!==this)return}this.__lastSelected&&!this.__corner?(this.selected=!1,this.__lastSelected=!1,this.enterEditing(e.e),this.selectionStart===this.selectionEnd?this.initDelayedCursor(!0):this.renderCursorOrSelection()):this.selected=!0}},setCursorByClick:function(e){var t=this.getSelectionStartFromPointer(e),i=this.selectionStart,n=this.selectionEnd;e.shiftKey?this.setSelectionStartEndWithShift(i,n,t):(this.selectionStart=t,this.selectionEnd=t),this.isEditing&&(this._fireSelectionChanged(),this._updateTextarea())},getSelectionStartFromPointer:function(e){for(var t,i=this.getLocalPointer(e),n=0,r=0,s=0,o=0,a=0,l=0,c=this._textLines.length;l<c&&s<=i.y;l++)s+=this.getHeightOfLine(l)*this.scaleY,a=l,l>0&&(o+=this._textLines[l-1].length+this.missingNewlineOffset(l-1));r=this._getLineLeftOffset(a)*this.scaleX,t=this._textLines[a],"rtl"===this.direction&&(i.x=this.width*this.scaleX-i.x+r);for(var h=0,u=t.length;h<u&&(n=r,(r+=this.__charBounds[a][h].kernedWidth*this.scaleX)<=i.x);h++)o++;return this._getNewSelectionStartFromOffset(i,n,r,o,u)},_getNewSelectionStartFromOffset:function(e,t,i,n,r){var s=e.x-t,o=i-e.x,a=n+(o>s||o<0?0:1);return this.flipX&&(a=r-a),a>this._text.length&&(a=this._text.length),a}}),E.util.object.extend(E.IText.prototype,{initHiddenTextarea:function(){this.hiddenTextarea=E.document.createElement("textarea"),this.hiddenTextarea.setAttribute("autocapitalize","off"),this.hiddenTextarea.setAttribute("autocorrect","off"),this.hiddenTextarea.setAttribute("autocomplete","off"),this.hiddenTextarea.setAttribute("spellcheck","false"),this.hiddenTextarea.setAttribute("data-fabric-hiddentextarea",""),this.hiddenTextarea.setAttribute("wrap","off");var e=this._calcTextareaPosition();this.hiddenTextarea.style.cssText="position: absolute; top: "+e.top+"; left: "+e.left+"; z-index: -999; opacity: 0; width: 1px; height: 1px; font-size: 1px; padding\uff70top: "+e.fontSize+";",this.hiddenTextareaContainer?this.hiddenTextareaContainer.appendChild(this.hiddenTextarea):E.document.body.appendChild(this.hiddenTextarea),E.util.addListener(this.hiddenTextarea,"keydown",this.onKeyDown.bind(this)),E.util.addListener(this.hiddenTextarea,"keyup",this.onKeyUp.bind(this)),E.util.addListener(this.hiddenTextarea,"input",this.onInput.bind(this)),E.util.addListener(this.hiddenTextarea,"copy",this.copy.bind(this)),E.util.addListener(this.hiddenTextarea,"cut",this.copy.bind(this)),E.util.addListener(this.hiddenTextarea,"paste",this.paste.bind(this)),E.util.addListener(this.hiddenTextarea,"compositionstart",this.onCompositionStart.bind(this)),E.util.addListener(this.hiddenTextarea,"compositionupdate",this.onCompositionUpdate.bind(this)),E.util.addListener(this.hiddenTextarea,"compositionend",this.onCompositionEnd.bind(this)),!this._clickHandlerInitialized&&this.canvas&&(E.util.addListener(this.canvas.upperCanvasEl,"click",this.onClick.bind(this)),this._clickHandlerInitialized=!0)},keysMap:{9:"exitEditing",27:"exitEditing",33:"moveCursorUp",34:"moveCursorDown",35:"moveCursorRight",36:"moveCursorLeft",37:"moveCursorLeft",38:"moveCursorUp",39:"moveCursorRight",40:"moveCursorDown"},keysMapRtl:{9:"exitEditing",27:"exitEditing",33:"moveCursorUp",34:"moveCursorDown",35:"moveCursorLeft",36:"moveCursorRight",37:"moveCursorRight",38:"moveCursorUp",39:"moveCursorLeft",40:"moveCursorDown"},ctrlKeysMapUp:{67:"copy",88:"cut"},ctrlKeysMapDown:{65:"selectAll"},onClick:function(){this.hiddenTextarea&&this.hiddenTextarea.focus()},onKeyDown:function(e){if(this.isEditing){var t="rtl"===this.direction?this.keysMapRtl:this.keysMap;if(e.keyCode in t)this[t[e.keyCode]](e);else{if(!(e.keyCode in this.ctrlKeysMapDown)||!e.ctrlKey&&!e.metaKey)return;this[this.ctrlKeysMapDown[e.keyCode]](e)}e.stopImmediatePropagation(),e.preventDefault(),e.keyCode>=33&&e.keyCode<=40?(this.inCompositionMode=!1,this.clearContextTop(),this.renderCursorOrSelection()):this.canvas&&this.canvas.requestRenderAll()}},onKeyUp:function(e){!this.isEditing||this._copyDone||this.inCompositionMode?this._copyDone=!1:e.keyCode in this.ctrlKeysMapUp&&(e.ctrlKey||e.metaKey)&&(this[this.ctrlKeysMapUp[e.keyCode]](e),e.stopImmediatePropagation(),e.preventDefault(),this.canvas&&this.canvas.requestRenderAll())},onInput:function(e){var t=this.fromPaste;if(this.fromPaste=!1,e&&e.stopPropagation(),this.isEditing){var i,n,r,s,o,a=this._splitTextIntoLines(this.hiddenTextarea.value).graphemeText,l=this._text.length,c=a.length,h=c-l,u=this.selectionStart,d=this.selectionEnd,f=u!==d;if(""===this.hiddenTextarea.value)return this.styles={},this.updateFromTextArea(),this.fire("changed"),void(this.canvas&&(this.canvas.fire("text:changed",{target:this}),this.canvas.requestRenderAll()));var g=this.fromStringToGraphemeSelection(this.hiddenTextarea.selectionStart,this.hiddenTextarea.selectionEnd,this.hiddenTextarea.value),p=u>g.selectionStart;f?(i=this._text.slice(u,d),h+=d-u):c<l&&(i=p?this._text.slice(d+h,d):this._text.slice(u,u-h)),n=a.slice(g.selectionEnd-h,g.selectionEnd),i&&i.length&&(n.length&&(r=this.getSelectionStyles(u,u+1,!1),r=n.map((function(){return r[0]}))),f?(s=u,o=d):p?(s=d-i.length,o=d):(s=d,o=d+i.length),this.removeStyleFromTo(s,o)),n.length&&(t&&n.join("")===E.copiedText&&!E.disableStyleCopyPaste&&(r=E.copiedTextStyle),this.insertNewStyleBlock(n,u,r)),this.updateFromTextArea(),this.fire("changed"),this.canvas&&(this.canvas.fire("text:changed",{target:this}),this.canvas.requestRenderAll())}},onCompositionStart:function(){this.inCompositionMode=!0},onCompositionEnd:function(){this.inCompositionMode=!1},onCompositionUpdate:function(e){this.compositionStart=e.target.selectionStart,this.compositionEnd=e.target.selectionEnd,this.updateTextareaPosition()},copy:function(){this.selectionStart!==this.selectionEnd&&(E.copiedText=this.getSelectedText(),E.disableStyleCopyPaste?E.copiedTextStyle=null:E.copiedTextStyle=this.getSelectionStyles(this.selectionStart,this.selectionEnd,!0),this._copyDone=!0)},paste:function(){this.fromPaste=!0},_getClipboardData:function(e){return e&&e.clipboardData||E.window.clipboardData},_getWidthBeforeCursor:function(e,t){var i,n=this._getLineLeftOffset(e);return t>0&&(n+=(i=this.__charBounds[e][t-1]).left+i.width),n},getDownCursorOffset:function(e,t){var i=this._getSelectionForOffset(e,t),n=this.get2DCursorLocation(i),r=n.lineIndex;if(r===this._textLines.length-1||e.metaKey||34===e.keyCode)return this._text.length-i;var s=n.charIndex,o=this._getWidthBeforeCursor(r,s),a=this._getIndexOnLine(r+1,o);return this._textLines[r].slice(s).length+a+1+this.missingNewlineOffset(r)},_getSelectionForOffset:function(e,t){return e.shiftKey&&this.selectionStart!==this.selectionEnd&&t?this.selectionEnd:this.selectionStart},getUpCursorOffset:function(e,t){var i=this._getSelectionForOffset(e,t),n=this.get2DCursorLocation(i),r=n.lineIndex;if(0===r||e.metaKey||33===e.keyCode)return-i;var s=n.charIndex,o=this._getWidthBeforeCursor(r,s),a=this._getIndexOnLine(r-1,o),l=this._textLines[r].slice(0,s),c=this.missingNewlineOffset(r-1);return-this._textLines[r-1].length+a-l.length+(1-c)},_getIndexOnLine:function(e,t){for(var i,n,r=this._textLines[e],s=this._getLineLeftOffset(e),o=0,a=0,l=r.length;a<l;a++)if((s+=i=this.__charBounds[e][a].width)>t){n=!0;var c=s-i,h=s,u=Math.abs(c-t);o=Math.abs(h-t)<u?a:a-1;break}return n||(o=r.length-1),o},moveCursorDown:function(e){this.selectionStart>=this._text.length&&this.selectionEnd>=this._text.length||this._moveCursorUpOrDown("Down",e)},moveCursorUp:function(e){0===this.selectionStart&&0===this.selectionEnd||this._moveCursorUpOrDown("Up",e)},_moveCursorUpOrDown:function(e,t){var i=this["get"+e+"CursorOffset"](t,"right"===this._selectionDirection);t.shiftKey?this.moveCursorWithShift(i):this.moveCursorWithoutShift(i),0!==i&&(this.setSelectionInBoundaries(),this.abortCursorAnimation(),this._currentCursorOpacity=1,this.initDelayedCursor(),this._fireSelectionChanged(),this._updateTextarea())},moveCursorWithShift:function(e){var t="left"===this._selectionDirection?this.selectionStart+e:this.selectionEnd+e;return this.setSelectionStartEndWithShift(this.selectionStart,this.selectionEnd,t),0!==e},moveCursorWithoutShift:function(e){return e<0?(this.selectionStart+=e,this.selectionEnd=this.selectionStart):(this.selectionEnd+=e,this.selectionStart=this.selectionEnd),0!==e},moveCursorLeft:function(e){0===this.selectionStart&&0===this.selectionEnd||this._moveCursorLeftOrRight("Left",e)},_move:function(e,t,i){var n;if(e.altKey)n=this["findWordBoundary"+i](this[t]);else{if(!e.metaKey&&35!==e.keyCode&&36!==e.keyCode)return this[t]+="Left"===i?-1:1,!0;n=this["findLineBoundary"+i](this[t])}if(void 0!==typeof n&&this[t]!==n)return this[t]=n,!0},_moveLeft:function(e,t){return this._move(e,t,"Left")},_moveRight:function(e,t){return this._move(e,t,"Right")},moveCursorLeftWithoutShift:function(e){var t=!0;return this._selectionDirection="left",this.selectionEnd===this.selectionStart&&0!==this.selectionStart&&(t=this._moveLeft(e,"selectionStart")),this.selectionEnd=this.selectionStart,t},moveCursorLeftWithShift:function(e){return"right"===this._selectionDirection&&this.selectionStart!==this.selectionEnd?this._moveLeft(e,"selectionEnd"):0!==this.selectionStart?(this._selectionDirection="left",this._moveLeft(e,"selectionStart")):void 0},moveCursorRight:function(e){this.selectionStart>=this._text.length&&this.selectionEnd>=this._text.length||this._moveCursorLeftOrRight("Right",e)},_moveCursorLeftOrRight:function(e,t){var i="moveCursor"+e+"With";this._currentCursorOpacity=1,t.shiftKey?i+="Shift":i+="outShift",this[i](t)&&(this.abortCursorAnimation(),this.initDelayedCursor(),this._fireSelectionChanged(),this._updateTextarea())},moveCursorRightWithShift:function(e){return"left"===this._selectionDirection&&this.selectionStart!==this.selectionEnd?this._moveRight(e,"selectionStart"):this.selectionEnd!==this._text.length?(this._selectionDirection="right",this._moveRight(e,"selectionEnd")):void 0},moveCursorRightWithoutShift:function(e){var t=!0;return this._selectionDirection="right",this.selectionStart===this.selectionEnd?(t=this._moveRight(e,"selectionStart"),this.selectionEnd=this.selectionStart):this.selectionStart=this.selectionEnd,t},removeChars:function(e,t){void 0===t&&(t=e+1),this.removeStyleFromTo(e,t),this._text.splice(e,t-e),this.text=this._text.join(""),this.set("dirty",!0),this._shouldClearDimensionCache()&&(this.initDimensions(),this.setCoords()),this._removeExtraneousStyles()},insertChars:function(e,t,i,n){void 0===n&&(n=i),n>i&&this.removeStyleFromTo(i,n);var r=E.util.string.graphemeSplit(e);this.insertNewStyleBlock(r,i,t),this._text=[].concat(this._text.slice(0,i),r,this._text.slice(n)),this.text=this._text.join(""),this.set("dirty",!0),this._shouldClearDimensionCache()&&(this.initDimensions(),this.setCoords()),this._removeExtraneousStyles()}}),function(){var e=E.util.toFixed,t=/  +/g;E.util.object.extend(E.Text.prototype,{_toSVG:function(){var e=this._getSVGLeftTopOffsets(),t=this._getSVGTextAndBg(e.textTop,e.textLeft);return this._wrapSVGTextAndBg(t)},toSVG:function(e){return this._createBaseSVGMarkup(this._toSVG(),{reviver:e,noStyle:!0,withShadow:!0})},_getSVGLeftTopOffsets:function(){return{textLeft:-this.width/2,textTop:-this.height/2,lineTop:this.getHeightOfLine(0)}},_wrapSVGTextAndBg:function(e){var t=this.getSvgTextDecoration(this);return[e.textBgRects.join(""),'\t\t<text xml:space="preserve" ',this.fontFamily?'font-family="'+this.fontFamily.replace(/"/g,"'")+'" ':"",this.fontSize?'font-size="'+this.fontSize+'" ':"",this.fontStyle?'font-style="'+this.fontStyle+'" ':"",this.fontWeight?'font-weight="'+this.fontWeight+'" ':"",t?'text-decoration="'+t+'" ':"",'style="',this.getSvgStyles(!0),'"',this.addPaintOrder()," >",e.textSpans.join(""),"</text>\n"]},_getSVGTextAndBg:function(e,t){var i,n=[],r=[],s=e;this._setSVGBg(r);for(var o=0,a=this._textLines.length;o<a;o++)i=this._getLineLeftOffset(o),(this.textBackgroundColor||this.styleHas("textBackgroundColor",o))&&this._setSVGTextLineBg(r,o,t+i,s),this._setSVGTextLineText(n,o,t+i,s),s+=this.getHeightOfLine(o);return{textSpans:n,textBgRects:r}},_createTextCharSpan:function(i,n,r,s){var o=i!==i.trim()||i.match(t),a=this.getSvgSpanStyles(n,o),l=a?'style="'+a+'"':"",c=n.deltaY,h="",u=E.Object.NUM_FRACTION_DIGITS;return c&&(h=' dy="'+e(c,u)+'" '),['<tspan x="',e(r,u),'" y="',e(s,u),'" ',h,l,">",E.util.string.escapeXml(i),"</tspan>"].join("")},_setSVGTextLineText:function(e,t,i,n){var r,s,o,a,l,c=this.getHeightOfLine(t),h=-1!==this.textAlign.indexOf("justify"),u="",d=0,f=this._textLines[t];n+=c*(1-this._fontSizeFraction)/this.lineHeight;for(var g=0,p=f.length-1;g<=p;g++)l=g===p||this.charSpacing,u+=f[g],o=this.__charBounds[t][g],0===d?(i+=o.kernedWidth-o.width,d+=o.width):d+=o.kernedWidth,h&&!l&&this._reSpaceAndTab.test(f[g])&&(l=!0),l||(r=r||this.getCompleteStyleDeclaration(t,g),s=this.getCompleteStyleDeclaration(t,g+1),l=this._hasStyleChangedForSvg(r,s)),l&&(a=this._getStyleDeclaration(t,g)||{},e.push(this._createTextCharSpan(u,a,i,n)),u="",r=s,i+=d,d=0)},_pushTextBgRect:function(t,i,n,r,s,o){var a=E.Object.NUM_FRACTION_DIGITS;t.push("\t\t<rect ",this._getFillAttributes(i),' x="',e(n,a),'" y="',e(r,a),'" width="',e(s,a),'" height="',e(o,a),'"></rect>\n')},_setSVGTextLineBg:function(e,t,i,n){for(var r,s,o=this._textLines[t],a=this.getHeightOfLine(t)/this.lineHeight,l=0,c=0,h=this.getValueOfPropertyAt(t,0,"textBackgroundColor"),u=0,d=o.length;u<d;u++)r=this.__charBounds[t][u],(s=this.getValueOfPropertyAt(t,u,"textBackgroundColor"))!==h?(h&&this._pushTextBgRect(e,h,i+c,n,l,a),c=r.left,l=r.width,h=s):l+=r.kernedWidth;s&&this._pushTextBgRect(e,s,i+c,n,l,a)},_getFillAttributes:function(e){var t=e&&"string"==typeof e?new E.Color(e):"";return t&&t.getSource()&&1!==t.getAlpha()?'opacity="'+t.getAlpha()+'" fill="'+t.setAlpha(1).toRgb()+'"':'fill="'+e+'"'},_getSVGLineTopOffset:function(e){for(var t,i=0,n=0;n<e;n++)i+=this.getHeightOfLine(n);return t=this.getHeightOfLine(n),{lineTop:i,offset:(this._fontSizeMult-this._fontSizeFraction)*t/(this.lineHeight*this._fontSizeMult)}},getSvgStyles:function(e){return E.Object.prototype.getSvgStyles.call(this,e)+" white-space: pre;"}})}(),function(e){var t=e.fabric||(e.fabric={});t.Textbox=t.util.createClass(t.IText,t.Observable,{type:"textbox",minWidth:20,dynamicMinWidth:2,__cachedLines:null,lockScalingFlip:!0,noScaleCache:!1,_dimensionAffectingProps:t.Text.prototype._dimensionAffectingProps.concat("width"),_wordJoiners:/[ \t\r]/,splitByGrapheme:!1,initDimensions:function(){this.__skipDimension||(this.isEditing&&this.initDelayedCursor(),this.clearContextTop(),this._clearCache(),this.dynamicMinWidth=0,this._styleMap=this._generateStyleMap(this._splitText()),this.dynamicMinWidth>this.width&&this._set("width",this.dynamicMinWidth),-1!==this.textAlign.indexOf("justify")&&this.enlargeSpaces(),this.height=this.calcTextHeight(),this.saveState({propertySet:"_dimensionAffectingProps"}))},_generateStyleMap:function(e){for(var t=0,i=0,n=0,r={},s=0;s<e.graphemeLines.length;s++)"\n"===e.graphemeText[n]&&s>0?(i=0,n++,t++):!this.splitByGrapheme&&this._reSpaceAndTab.test(e.graphemeText[n])&&s>0&&(i++,n++),r[s]={line:t,offset:i},n+=e.graphemeLines[s].length,i+=e.graphemeLines[s].length;return r},styleHas:function(e,i){if(this._styleMap&&!this.isWrapping){var n=this._styleMap[i];n&&(i=n.line)}return t.Text.prototype.styleHas.call(this,e,i)},isEmptyStyles:function(e){if(!this.styles)return!0;var t,i,n=0,r=!1,s=this._styleMap[e],o=this._styleMap[e+1];for(var a in s&&(e=s.line,n=s.offset),o&&(r=o.line===e,t=o.offset),i=void 0===e?this.styles:{line:this.styles[e]})for(var l in i[a])if(l>=n&&(!r||l<t))for(var c in i[a][l])return!1;return!0},_getStyleDeclaration:function(e,t){if(this._styleMap&&!this.isWrapping){var i=this._styleMap[e];if(!i)return null;e=i.line,t=i.offset+t}return this.callSuper("_getStyleDeclaration",e,t)},_setStyleDeclaration:function(e,t,i){var n=this._styleMap[e];e=n.line,t=n.offset+t,this.styles[e][t]=i},_deleteStyleDeclaration:function(e,t){var i=this._styleMap[e];e=i.line,t=i.offset+t,delete this.styles[e][t]},_getLineStyle:function(e){var t=this._styleMap[e];return!!this.styles[t.line]},_setLineStyle:function(e){var t=this._styleMap[e];this.styles[t.line]={}},_wrapText:function(e,t){var i,n=[];for(this.isWrapping=!0,i=0;i<e.length;i++)n=n.concat(this._wrapLine(e[i],i,t));return this.isWrapping=!1,n},_measureWord:function(e,t,i){var n,r=0;i=i||0;for(var s=0,o=e.length;s<o;s++)r+=this._getGraphemeBox(e[s],t,s+i,n,!0).kernedWidth,n=e[s];return r},_wrapLine:function(e,i,n,r){var s=0,o=this.splitByGrapheme,a=[],l=[],c=o?t.util.string.graphemeSplit(e):e.split(this._wordJoiners),h="",u=0,d=o?"":" ",f=0,g=0,p=0,m=!0,_=this._getWidthOfCharSpacing();r=r||0,0===c.length&&c.push([]),n-=r;for(var v=0;v<c.length;v++)h=o?c[v]:t.util.string.graphemeSplit(c[v]),f=this._measureWord(h,i,u),u+=h.length,(s+=g+f-_)>n&&!m?(a.push(l),l=[],s=f,m=!0):s+=_,m||o||l.push(d),l=l.concat(h),g=o?0:this._measureWord([d],i,u),u++,m=!1,f>p&&(p=f);return v&&a.push(l),p+r>this.dynamicMinWidth&&(this.dynamicMinWidth=p-_+r),a},isEndOfWrapping:function(e){return!this._styleMap[e+1]||this._styleMap[e+1].line!==this._styleMap[e].line},missingNewlineOffset:function(e){return this.splitByGrapheme?this.isEndOfWrapping(e)?1:0:1},_splitTextIntoLines:function(e){for(var i=t.Text.prototype._splitTextIntoLines.call(this,e),n=this._wrapText(i.lines,this.width),r=new Array(n.length),s=0;s<n.length;s++)r[s]=n[s].join("");return i.lines=r,i.graphemeLines=n,i},getMinWidth:function(){return Math.max(this.minWidth,this.dynamicMinWidth)},_removeExtraneousStyles:function(){var e={};for(var t in this._styleMap)this._textLines[t]&&(e[this._styleMap[t].line]=1);for(var t in this.styles)e[t]||delete this.styles[t]},toObject:function(e){return this.callSuper("toObject",["minWidth","splitByGrapheme"].concat(e))}}),t.Textbox.fromObject=function(e,i){return t.Object._fromObject("Textbox",e,i,"text")}}(t),function(){var e=E.controlsUtils,t=e.scaleSkewCursorStyleHandler,i=e.scaleCursorStyleHandler,n=e.scalingEqually,r=e.scalingYOrSkewingX,s=e.scalingXOrSkewingY,o=e.scaleOrSkewActionName,a=E.Object.prototype.controls;if(a.ml=new E.Control({x:-.5,y:0,cursorStyleHandler:t,actionHandler:s,getActionName:o}),a.mr=new E.Control({x:.5,y:0,cursorStyleHandler:t,actionHandler:s,getActionName:o}),a.mb=new E.Control({x:0,y:.5,cursorStyleHandler:t,actionHandler:r,getActionName:o}),a.mt=new E.Control({x:0,y:-.5,cursorStyleHandler:t,actionHandler:r,getActionName:o}),a.tl=new E.Control({x:-.5,y:-.5,cursorStyleHandler:i,actionHandler:n}),a.tr=new E.Control({x:.5,y:-.5,cursorStyleHandler:i,actionHandler:n}),a.bl=new E.Control({x:-.5,y:.5,cursorStyleHandler:i,actionHandler:n}),a.br=new E.Control({x:.5,y:.5,cursorStyleHandler:i,actionHandler:n}),a.mtr=new E.Control({x:0,y:-.5,actionHandler:e.rotationWithSnapping,cursorStyleHandler:e.rotationStyleHandler,offsetY:-40,withConnection:!0,actionName:"rotate"}),E.Textbox){var l=E.Textbox.prototype.controls={};l.mtr=a.mtr,l.tr=a.tr,l.br=a.br,l.tl=a.tl,l.bl=a.bl,l.mt=a.mt,l.mb=a.mb,l.mr=new E.Control({x:.5,y:0,actionHandler:e.changeWidth,cursorStyleHandler:t,actionName:"resizing"}),l.ml=new E.Control({x:-.5,y:0,actionHandler:e.changeWidth,cursorStyleHandler:t,actionName:"resizing"})}}()},192:()=>{},898:()=>{},245:()=>{}},Ge={};function We(e){var t=Ge[e];if(void 0!==t)return t.exports;var i=Ge[e]={exports:{}};return Ve[e](i,i.exports,We),i.exports}We.d=(e,t)=>{for(var i in t)We.o(t,i)&&!We.o(e,i)&&Object.defineProperty(e,i,{enumerable:!0,get:t[i]})},We.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t);var ze={};(()=>{let e;We.d(ze,{R:()=>e}),e="undefined"!=typeof document&&"undefined"!=typeof window?We(653).fabric:{version:"5.2.1"}})();var He=ze.R;var Ye=function(){this.init()};Ye.prototype={init:function(){var e=this||Xe;return e._counter=1e3,e._html5AudioPool=[],e.html5PoolSize=10,e._codecs={},e._howls=[],e._muted=!1,e._volume=1,e._canPlayEvent="canplaythrough",e._navigator="undefined"!==typeof window&&window.navigator?window.navigator:null,e.masterGain=null,e.noAudio=!1,e.usingWebAudio=!0,e.autoSuspend=!0,e.ctx=null,e.autoUnlock=!0,e._setup(),e},volume:function(e){var t=this||Xe;if(e=parseFloat(e),t.ctx||tt(),"undefined"!==typeof e&&e>=0&&e<=1){if(t._volume=e,t._muted)return t;t.usingWebAudio&&t.masterGain.gain.setValueAtTime(e,Xe.ctx.currentTime);for(var i=0;i<t._howls.length;i++)if(!t._howls[i]._webAudio)for(var n=t._howls[i]._getSoundIds(),r=0;r<n.length;r++){var s=t._howls[i]._soundById(n[r]);s&&s._node&&(s._node.volume=s._volume*e)}return t}return t._volume},mute:function(e){var t=this||Xe;t.ctx||tt(),t._muted=e,t.usingWebAudio&&t.masterGain.gain.setValueAtTime(e?0:t._volume,Xe.ctx.currentTime);for(var i=0;i<t._howls.length;i++)if(!t._howls[i]._webAudio)for(var n=t._howls[i]._getSoundIds(),r=0;r<n.length;r++){var s=t._howls[i]._soundById(n[r]);s&&s._node&&(s._node.muted=!!e||s._muted)}return t},stop:function(){for(var e=this||Xe,t=0;t<e._howls.length;t++)e._howls[t].stop();return e},unload:function(){for(var e=this||Xe,t=e._howls.length-1;t>=0;t--)e._howls[t].unload();return e.usingWebAudio&&e.ctx&&"undefined"!==typeof e.ctx.close&&(e.ctx.close(),e.ctx=null,tt()),e},codecs:function(e){return(this||Xe)._codecs[e.replace(/^x-/,"")]},_setup:function(){var e=this||Xe;if(e.state=e.ctx&&e.ctx.state||"suspended",e._autoSuspend(),!e.usingWebAudio)if("undefined"!==typeof Audio)try{"undefined"===typeof(new Audio).oncanplaythrough&&(e._canPlayEvent="canplay")}catch(t){e.noAudio=!0}else e.noAudio=!0;try{(new Audio).muted&&(e.noAudio=!0)}catch(t){}return e.noAudio||e._setupCodecs(),e},_setupCodecs:function(){var e=this||Xe,t=null;try{t="undefined"!==typeof Audio?new Audio:null}catch(c){return e}if(!t||"function"!==typeof t.canPlayType)return e;var i=t.canPlayType("audio/mpeg;").replace(/^no$/,""),n=e._navigator?e._navigator.userAgent:"",r=n.match(/OPR\/([0-6].)/g),s=r&&parseInt(r[0].split("/")[1],10)<33,o=-1!==n.indexOf("Safari")&&-1===n.indexOf("Chrome"),a=n.match(/Version\/(.*?) /),l=o&&a&&parseInt(a[1],10)<15;return e._codecs={mp3:!(s||!i&&!t.canPlayType("audio/mp3;").replace(/^no$/,"")),mpeg:!!i,opus:!!t.canPlayType('audio/ogg; codecs="opus"').replace(/^no$/,""),ogg:!!t.canPlayType('audio/ogg; codecs="vorbis"').replace(/^no$/,""),oga:!!t.canPlayType('audio/ogg; codecs="vorbis"').replace(/^no$/,""),wav:!!(t.canPlayType('audio/wav; codecs="1"')||t.canPlayType("audio/wav")).replace(/^no$/,""),aac:!!t.canPlayType("audio/aac;").replace(/^no$/,""),caf:!!t.canPlayType("audio/x-caf;").replace(/^no$/,""),m4a:!!(t.canPlayType("audio/x-m4a;")||t.canPlayType("audio/m4a;")||t.canPlayType("audio/aac;")).replace(/^no$/,""),m4b:!!(t.canPlayType("audio/x-m4b;")||t.canPlayType("audio/m4b;")||t.canPlayType("audio/aac;")).replace(/^no$/,""),mp4:!!(t.canPlayType("audio/x-mp4;")||t.canPlayType("audio/mp4;")||t.canPlayType("audio/aac;")).replace(/^no$/,""),weba:!(l||!t.canPlayType('audio/webm; codecs="vorbis"').replace(/^no$/,"")),webm:!(l||!t.canPlayType('audio/webm; codecs="vorbis"').replace(/^no$/,"")),dolby:!!t.canPlayType('audio/mp4; codecs="ec-3"').replace(/^no$/,""),flac:!!(t.canPlayType("audio/x-flac;")||t.canPlayType("audio/flac;")).replace(/^no$/,"")},e},_unlockAudio:function(){var e=this||Xe;if(!e._audioUnlocked&&e.ctx){e._audioUnlocked=!1,e.autoUnlock=!1,e._mobileUnloaded||44100===e.ctx.sampleRate||(e._mobileUnloaded=!0,e.unload()),e._scratchBuffer=e.ctx.createBuffer(1,1,22050);var t=function(i){for(;e._html5AudioPool.length<e.html5PoolSize;)try{var n=new Audio;n._unlocked=!0,e._releaseHtml5Audio(n)}catch(i){e.noAudio=!0;break}for(var r=0;r<e._howls.length;r++)if(!e._howls[r]._webAudio)for(var s=e._howls[r]._getSoundIds(),o=0;o<s.length;o++){var a=e._howls[r]._soundById(s[o]);a&&a._node&&!a._node._unlocked&&(a._node._unlocked=!0,a._node.load())}e._autoResume();var l=e.ctx.createBufferSource();l.buffer=e._scratchBuffer,l.connect(e.ctx.destination),"undefined"===typeof l.start?l.noteOn(0):l.start(0),"function"===typeof e.ctx.resume&&e.ctx.resume(),l.onended=function(){l.disconnect(0),e._audioUnlocked=!0,document.removeEventListener("touchstart",t,!0),document.removeEventListener("touchend",t,!0),document.removeEventListener("click",t,!0),document.removeEventListener("keydown",t,!0);for(var i=0;i<e._howls.length;i++)e._howls[i]._emit("unlock")}};return document.addEventListener("touchstart",t,!0),document.addEventListener("touchend",t,!0),document.addEventListener("click",t,!0),document.addEventListener("keydown",t,!0),e}},_obtainHtml5Audio:function(){var e=this||Xe;if(e._html5AudioPool.length)return e._html5AudioPool.pop();var t=(new Audio).play();return t&&"undefined"!==typeof Promise&&(t instanceof Promise||"function"===typeof t.then)&&t.catch((function(){console.warn("HTML5 Audio pool exhausted, returning potentially locked audio object.")})),new Audio},_releaseHtml5Audio:function(e){var t=this||Xe;return e._unlocked&&t._html5AudioPool.push(e),t},_autoSuspend:function(){var e=this;if(e.autoSuspend&&e.ctx&&"undefined"!==typeof e.ctx.suspend&&Xe.usingWebAudio){for(var t=0;t<e._howls.length;t++)if(e._howls[t]._webAudio)for(var i=0;i<e._howls[t]._sounds.length;i++)if(!e._howls[t]._sounds[i]._paused)return e;return e._suspendTimer&&clearTimeout(e._suspendTimer),e._suspendTimer=setTimeout((function(){if(e.autoSuspend){e._suspendTimer=null,e.state="suspending";var t=function(){e.state="suspended",e._resumeAfterSuspend&&(delete e._resumeAfterSuspend,e._autoResume())};e.ctx.suspend().then(t,t)}}),3e4),e}},_autoResume:function(){var e=this;if(e.ctx&&"undefined"!==typeof e.ctx.resume&&Xe.usingWebAudio)return"running"===e.state&&"interrupted"!==e.ctx.state&&e._suspendTimer?(clearTimeout(e._suspendTimer),e._suspendTimer=null):"suspended"===e.state||"running"===e.state&&"interrupted"===e.ctx.state?(e.ctx.resume().then((function(){e.state="running";for(var t=0;t<e._howls.length;t++)e._howls[t]._emit("resume")})),e._suspendTimer&&(clearTimeout(e._suspendTimer),e._suspendTimer=null)):"suspending"===e.state&&(e._resumeAfterSuspend=!0),e}};var Xe=new Ye,qe=function(e){e.src&&0!==e.src.length?this.init(e):console.error("An array of source files must be passed with any new Howl.")};qe.prototype={init:function(e){var t=this;return Xe.ctx||tt(),t._autoplay=e.autoplay||!1,t._format="string"!==typeof e.format?e.format:[e.format],t._html5=e.html5||!1,t._muted=e.mute||!1,t._loop=e.loop||!1,t._pool=e.pool||5,t._preload="boolean"!==typeof e.preload&&"metadata"!==e.preload||e.preload,t._rate=e.rate||1,t._sprite=e.sprite||{},t._src="string"!==typeof e.src?e.src:[e.src],t._volume=void 0!==e.volume?e.volume:1,t._xhr={method:e.xhr&&e.xhr.method?e.xhr.method:"GET",headers:e.xhr&&e.xhr.headers?e.xhr.headers:null,withCredentials:!(!e.xhr||!e.xhr.withCredentials)&&e.xhr.withCredentials},t._duration=0,t._state="unloaded",t._sounds=[],t._endTimers={},t._queue=[],t._playLock=!1,t._onend=e.onend?[{fn:e.onend}]:[],t._onfade=e.onfade?[{fn:e.onfade}]:[],t._onload=e.onload?[{fn:e.onload}]:[],t._onloaderror=e.onloaderror?[{fn:e.onloaderror}]:[],t._onplayerror=e.onplayerror?[{fn:e.onplayerror}]:[],t._onpause=e.onpause?[{fn:e.onpause}]:[],t._onplay=e.onplay?[{fn:e.onplay}]:[],t._onstop=e.onstop?[{fn:e.onstop}]:[],t._onmute=e.onmute?[{fn:e.onmute}]:[],t._onvolume=e.onvolume?[{fn:e.onvolume}]:[],t._onrate=e.onrate?[{fn:e.onrate}]:[],t._onseek=e.onseek?[{fn:e.onseek}]:[],t._onunlock=e.onunlock?[{fn:e.onunlock}]:[],t._onresume=[],t._webAudio=Xe.usingWebAudio&&!t._html5,"undefined"!==typeof Xe.ctx&&Xe.ctx&&Xe.autoUnlock&&Xe._unlockAudio(),Xe._howls.push(t),t._autoplay&&t._queue.push({event:"play",action:function(){t.play()}}),t._preload&&"none"!==t._preload&&t.load(),t},load:function(){var e=this,t=null;if(Xe.noAudio)e._emit("loaderror",null,"No audio support.");else{"string"===typeof e._src&&(e._src=[e._src]);for(var i=0;i<e._src.length;i++){var n,r;if(e._format&&e._format[i])n=e._format[i];else{if("string"!==typeof(r=e._src[i])){e._emit("loaderror",null,"Non-string found in selected audio sources - ignoring.");continue}(n=/^data:audio\/([^;,]+);/i.exec(r))||(n=/\.([^.]+)$/.exec(r.split("?",1)[0])),n&&(n=n[1].toLowerCase())}if(n||console.warn('No file extension was found. Consider using the "format" property or specify an extension.'),n&&Xe.codecs(n)){t=e._src[i];break}}if(t)return e._src=t,e._state="loading","https:"===window.location.protocol&&"http:"===t.slice(0,5)&&(e._html5=!0,e._webAudio=!1),new Ze(e),e._webAudio&&Qe(e),e;e._emit("loaderror",null,"No codec support for selected audio sources.")}},play:function(e,t){var i=this,n=null;if("number"===typeof e)n=e,e=null;else{if("string"===typeof e&&"loaded"===i._state&&!i._sprite[e])return null;if("undefined"===typeof e&&(e="__default",!i._playLock)){for(var r=0,s=0;s<i._sounds.length;s++)i._sounds[s]._paused&&!i._sounds[s]._ended&&(r++,n=i._sounds[s]._id);1===r?e=null:n=null}}var o=n?i._soundById(n):i._inactiveSound();if(!o)return null;if(n&&!e&&(e=o._sprite||"__default"),"loaded"!==i._state){o._sprite=e,o._ended=!1;var a=o._id;return i._queue.push({event:"play",action:function(){i.play(a)}}),a}if(n&&!o._paused)return t||i._loadQueue("play"),o._id;i._webAudio&&Xe._autoResume();var l=Math.max(0,o._seek>0?o._seek:i._sprite[e][0]/1e3),c=Math.max(0,(i._sprite[e][0]+i._sprite[e][1])/1e3-l),h=1e3*c/Math.abs(o._rate),u=i._sprite[e][0]/1e3,d=(i._sprite[e][0]+i._sprite[e][1])/1e3;o._sprite=e,o._ended=!1;var f=function(){o._paused=!1,o._seek=l,o._start=u,o._stop=d,o._loop=!(!o._loop&&!i._sprite[e][2])};if(!(l>=d)){var g=o._node;if(i._webAudio){var p=function(){i._playLock=!1,f(),i._refreshBuffer(o);var e=o._muted||i._muted?0:o._volume;g.gain.setValueAtTime(e,Xe.ctx.currentTime),o._playStart=Xe.ctx.currentTime,"undefined"===typeof g.bufferSource.start?o._loop?g.bufferSource.noteGrainOn(0,l,86400):g.bufferSource.noteGrainOn(0,l,c):o._loop?g.bufferSource.start(0,l,86400):g.bufferSource.start(0,l,c),h!==1/0&&(i._endTimers[o._id]=setTimeout(i._ended.bind(i,o),h)),t||setTimeout((function(){i._emit("play",o._id),i._loadQueue()}),0)};"running"===Xe.state&&"interrupted"!==Xe.ctx.state?p():(i._playLock=!0,i.once("resume",p),i._clearTimer(o._id))}else{var m=function(){g.currentTime=l,g.muted=o._muted||i._muted||Xe._muted||g.muted,g.volume=o._volume*Xe.volume(),g.playbackRate=o._rate;try{var n=g.play();if(n&&"undefined"!==typeof Promise&&(n instanceof Promise||"function"===typeof n.then)?(i._playLock=!0,f(),n.then((function(){i._playLock=!1,g._unlocked=!0,t?i._loadQueue():i._emit("play",o._id)})).catch((function(){i._playLock=!1,i._emit("playerror",o._id,"Playback was unable to start. This is most commonly an issue on mobile devices and Chrome where playback was not within a user interaction."),o._ended=!0,o._paused=!0}))):t||(i._playLock=!1,f(),i._emit("play",o._id)),g.playbackRate=o._rate,g.paused)return void i._emit("playerror",o._id,"Playback was unable to start. This is most commonly an issue on mobile devices and Chrome where playback was not within a user interaction.");"__default"!==e||o._loop?i._endTimers[o._id]=setTimeout(i._ended.bind(i,o),h):(i._endTimers[o._id]=function(){i._ended(o),g.removeEventListener("ended",i._endTimers[o._id],!1)},g.addEventListener("ended",i._endTimers[o._id],!1))}catch(r){i._emit("playerror",o._id,r)}};"data:audio/wav;base64,UklGRigAAABXQVZFZm10IBIAAAABAAEARKwAAIhYAQACABAAAABkYXRhAgAAAAEA"===g.src&&(g.src=i._src,g.load());var _=window&&window.ejecta||!g.readyState&&Xe._navigator.isCocoonJS;if(g.readyState>=3||_)m();else{i._playLock=!0,i._state="loading";var v=function(){i._state="loaded",m(),g.removeEventListener(Xe._canPlayEvent,v,!1)};g.addEventListener(Xe._canPlayEvent,v,!1),i._clearTimer(o._id)}}return o._id}i._ended(o)},pause:function(e){var t=this;if("loaded"!==t._state||t._playLock)return t._queue.push({event:"pause",action:function(){t.pause(e)}}),t;for(var i=t._getSoundIds(e),n=0;n<i.length;n++){t._clearTimer(i[n]);var r=t._soundById(i[n]);if(r&&!r._paused&&(r._seek=t.seek(i[n]),r._rateSeek=0,r._paused=!0,t._stopFade(i[n]),r._node))if(t._webAudio){if(!r._node.bufferSource)continue;"undefined"===typeof r._node.bufferSource.stop?r._node.bufferSource.noteOff(0):r._node.bufferSource.stop(0),t._cleanBuffer(r._node)}else isNaN(r._node.duration)&&r._node.duration!==1/0||r._node.pause();arguments[1]||t._emit("pause",r?r._id:null)}return t},stop:function(e,t){var i=this;if("loaded"!==i._state||i._playLock)return i._queue.push({event:"stop",action:function(){i.stop(e)}}),i;for(var n=i._getSoundIds(e),r=0;r<n.length;r++){i._clearTimer(n[r]);var s=i._soundById(n[r]);s&&(s._seek=s._start||0,s._rateSeek=0,s._paused=!0,s._ended=!0,i._stopFade(n[r]),s._node&&(i._webAudio?s._node.bufferSource&&("undefined"===typeof s._node.bufferSource.stop?s._node.bufferSource.noteOff(0):s._node.bufferSource.stop(0),i._cleanBuffer(s._node)):isNaN(s._node.duration)&&s._node.duration!==1/0||(s._node.currentTime=s._start||0,s._node.pause(),s._node.duration===1/0&&i._clearSound(s._node))),t||i._emit("stop",s._id))}return i},mute:function(e,t){var i=this;if("loaded"!==i._state||i._playLock)return i._queue.push({event:"mute",action:function(){i.mute(e,t)}}),i;if("undefined"===typeof t){if("boolean"!==typeof e)return i._muted;i._muted=e}for(var n=i._getSoundIds(t),r=0;r<n.length;r++){var s=i._soundById(n[r]);s&&(s._muted=e,s._interval&&i._stopFade(s._id),i._webAudio&&s._node?s._node.gain.setValueAtTime(e?0:s._volume,Xe.ctx.currentTime):s._node&&(s._node.muted=!!Xe._muted||e),i._emit("mute",s._id))}return i},volume:function(){var e,t,i,n=this,r=arguments;if(0===r.length)return n._volume;if(1===r.length||2===r.length&&"undefined"===typeof r[1]?n._getSoundIds().indexOf(r[0])>=0?t=parseInt(r[0],10):e=parseFloat(r[0]):r.length>=2&&(e=parseFloat(r[0]),t=parseInt(r[1],10)),!("undefined"!==typeof e&&e>=0&&e<=1))return(i=t?n._soundById(t):n._sounds[0])?i._volume:0;if("loaded"!==n._state||n._playLock)return n._queue.push({event:"volume",action:function(){n.volume.apply(n,r)}}),n;"undefined"===typeof t&&(n._volume=e),t=n._getSoundIds(t);for(var s=0;s<t.length;s++)(i=n._soundById(t[s]))&&(i._volume=e,r[2]||n._stopFade(t[s]),n._webAudio&&i._node&&!i._muted?i._node.gain.setValueAtTime(e,Xe.ctx.currentTime):i._node&&!i._muted&&(i._node.volume=e*Xe.volume()),n._emit("volume",i._id));return n},fade:function(e,t,i,n){var r=this;if("loaded"!==r._state||r._playLock)return r._queue.push({event:"fade",action:function(){r.fade(e,t,i,n)}}),r;e=Math.min(Math.max(0,parseFloat(e)),1),t=Math.min(Math.max(0,parseFloat(t)),1),i=parseFloat(i),r.volume(e,n);for(var s=r._getSoundIds(n),o=0;o<s.length;o++){var a=r._soundById(s[o]);if(a){if(n||r._stopFade(s[o]),r._webAudio&&!a._muted){var l=Xe.ctx.currentTime,c=l+i/1e3;a._volume=e,a._node.gain.setValueAtTime(e,l),a._node.gain.linearRampToValueAtTime(t,c)}r._startFadeInterval(a,e,t,i,s[o],"undefined"===typeof n)}}return r},_startFadeInterval:function(e,t,i,n,r,s){var o=this,a=t,l=i-t,c=Math.abs(l/.01),h=Math.max(4,c>0?n/c:n),u=Date.now();e._fadeTo=i,e._interval=setInterval((function(){var r=(Date.now()-u)/n;u=Date.now(),a+=l*r,a=Math.round(100*a)/100,a=l<0?Math.max(i,a):Math.min(i,a),o._webAudio?e._volume=a:o.volume(a,e._id,!0),s&&(o._volume=a),(i<t&&a<=i||i>t&&a>=i)&&(clearInterval(e._interval),e._interval=null,e._fadeTo=null,o.volume(i,e._id),o._emit("fade",e._id))}),h)},_stopFade:function(e){var t=this,i=t._soundById(e);return i&&i._interval&&(t._webAudio&&i._node.gain.cancelScheduledValues(Xe.ctx.currentTime),clearInterval(i._interval),i._interval=null,t.volume(i._fadeTo,e),i._fadeTo=null,t._emit("fade",e)),t},loop:function(){var e,t,i,n=this,r=arguments;if(0===r.length)return n._loop;if(1===r.length){if("boolean"!==typeof r[0])return!!(i=n._soundById(parseInt(r[0],10)))&&i._loop;e=r[0],n._loop=e}else 2===r.length&&(e=r[0],t=parseInt(r[1],10));for(var s=n._getSoundIds(t),o=0;o<s.length;o++)(i=n._soundById(s[o]))&&(i._loop=e,n._webAudio&&i._node&&i._node.bufferSource&&(i._node.bufferSource.loop=e,e&&(i._node.bufferSource.loopStart=i._start||0,i._node.bufferSource.loopEnd=i._stop,n.playing(s[o])&&(n.pause(s[o],!0),n.play(s[o],!0)))));return n},rate:function(){var e,t,i,n=this,r=arguments;if(0===r.length)t=n._sounds[0]._id;else if(1===r.length){n._getSoundIds().indexOf(r[0])>=0?t=parseInt(r[0],10):e=parseFloat(r[0])}else 2===r.length&&(e=parseFloat(r[0]),t=parseInt(r[1],10));if("number"!==typeof e)return(i=n._soundById(t))?i._rate:n._rate;if("loaded"!==n._state||n._playLock)return n._queue.push({event:"rate",action:function(){n.rate.apply(n,r)}}),n;"undefined"===typeof t&&(n._rate=e),t=n._getSoundIds(t);for(var s=0;s<t.length;s++)if(i=n._soundById(t[s])){n.playing(t[s])&&(i._rateSeek=n.seek(t[s]),i._playStart=n._webAudio?Xe.ctx.currentTime:i._playStart),i._rate=e,n._webAudio&&i._node&&i._node.bufferSource?i._node.bufferSource.playbackRate.setValueAtTime(e,Xe.ctx.currentTime):i._node&&(i._node.playbackRate=e);var o=n.seek(t[s]),a=1e3*((n._sprite[i._sprite][0]+n._sprite[i._sprite][1])/1e3-o)/Math.abs(i._rate);!n._endTimers[t[s]]&&i._paused||(n._clearTimer(t[s]),n._endTimers[t[s]]=setTimeout(n._ended.bind(n,i),a)),n._emit("rate",i._id)}return n},seek:function(){var e,t,i=this,n=arguments;if(0===n.length)i._sounds.length&&(t=i._sounds[0]._id);else if(1===n.length){i._getSoundIds().indexOf(n[0])>=0?t=parseInt(n[0],10):i._sounds.length&&(t=i._sounds[0]._id,e=parseFloat(n[0]))}else 2===n.length&&(e=parseFloat(n[0]),t=parseInt(n[1],10));if("undefined"===typeof t)return 0;if("number"===typeof e&&("loaded"!==i._state||i._playLock))return i._queue.push({event:"seek",action:function(){i.seek.apply(i,n)}}),i;var r=i._soundById(t);if(r){if(!("number"===typeof e&&e>=0)){if(i._webAudio){var s=i.playing(t)?Xe.ctx.currentTime-r._playStart:0,o=r._rateSeek?r._rateSeek-r._seek:0;return r._seek+(o+s*Math.abs(r._rate))}return r._node.currentTime}var a=i.playing(t);a&&i.pause(t,!0),r._seek=e,r._ended=!1,i._clearTimer(t),i._webAudio||!r._node||isNaN(r._node.duration)||(r._node.currentTime=e);var l=function(){a&&i.play(t,!0),i._emit("seek",t)};if(a&&!i._webAudio){var c=function(){i._playLock?setTimeout(c,0):l()};setTimeout(c,0)}else l()}return i},playing:function(e){var t=this;if("number"===typeof e){var i=t._soundById(e);return!!i&&!i._paused}for(var n=0;n<t._sounds.length;n++)if(!t._sounds[n]._paused)return!0;return!1},duration:function(e){var t=this,i=t._duration,n=t._soundById(e);return n&&(i=t._sprite[n._sprite][1]/1e3),i},state:function(){return this._state},unload:function(){for(var e=this,t=e._sounds,i=0;i<t.length;i++)t[i]._paused||e.stop(t[i]._id),e._webAudio||(e._clearSound(t[i]._node),t[i]._node.removeEventListener("error",t[i]._errorFn,!1),t[i]._node.removeEventListener(Xe._canPlayEvent,t[i]._loadFn,!1),t[i]._node.removeEventListener("ended",t[i]._endFn,!1),Xe._releaseHtml5Audio(t[i]._node)),delete t[i]._node,e._clearTimer(t[i]._id);var n=Xe._howls.indexOf(e);n>=0&&Xe._howls.splice(n,1);var r=!0;for(i=0;i<Xe._howls.length;i++)if(Xe._howls[i]._src===e._src||e._src.indexOf(Xe._howls[i]._src)>=0){r=!1;break}return Ke&&r&&delete Ke[e._src],Xe.noAudio=!1,e._state="unloaded",e._sounds=[],e=null,null},on:function(e,t,i,n){var r=this["_on"+e];return"function"===typeof t&&r.push(n?{id:i,fn:t,once:n}:{id:i,fn:t}),this},off:function(e,t,i){var n=this,r=n["_on"+e],s=0;if("number"===typeof t&&(i=t,t=null),t||i)for(s=0;s<r.length;s++){var o=i===r[s].id;if(t===r[s].fn&&o||!t&&o){r.splice(s,1);break}}else if(e)n["_on"+e]=[];else{var a=Object.keys(n);for(s=0;s<a.length;s++)0===a[s].indexOf("_on")&&Array.isArray(n[a[s]])&&(n[a[s]]=[])}return n},once:function(e,t,i){return this.on(e,t,i,1),this},_emit:function(e,t,i){for(var n=this,r=n["_on"+e],s=r.length-1;s>=0;s--)r[s].id&&r[s].id!==t&&"load"!==e||(setTimeout(function(e){e.call(this,t,i)}.bind(n,r[s].fn),0),r[s].once&&n.off(e,r[s].fn,r[s].id));return n._loadQueue(e),n},_loadQueue:function(e){var t=this;if(t._queue.length>0){var i=t._queue[0];i.event===e&&(t._queue.shift(),t._loadQueue()),e||i.action()}return t},_ended:function(e){var t=this,i=e._sprite;if(!t._webAudio&&e._node&&!e._node.paused&&!e._node.ended&&e._node.currentTime<e._stop)return setTimeout(t._ended.bind(t,e),100),t;var n=!(!e._loop&&!t._sprite[i][2]);if(t._emit("end",e._id),!t._webAudio&&n&&t.stop(e._id,!0).play(e._id),t._webAudio&&n){t._emit("play",e._id),e._seek=e._start||0,e._rateSeek=0,e._playStart=Xe.ctx.currentTime;var r=1e3*(e._stop-e._start)/Math.abs(e._rate);t._endTimers[e._id]=setTimeout(t._ended.bind(t,e),r)}return t._webAudio&&!n&&(e._paused=!0,e._ended=!0,e._seek=e._start||0,e._rateSeek=0,t._clearTimer(e._id),t._cleanBuffer(e._node),Xe._autoSuspend()),t._webAudio||n||t.stop(e._id,!0),t},_clearTimer:function(e){var t=this;if(t._endTimers[e]){if("function"!==typeof t._endTimers[e])clearTimeout(t._endTimers[e]);else{var i=t._soundById(e);i&&i._node&&i._node.removeEventListener("ended",t._endTimers[e],!1)}delete t._endTimers[e]}return t},_soundById:function(e){for(var t=this,i=0;i<t._sounds.length;i++)if(e===t._sounds[i]._id)return t._sounds[i];return null},_inactiveSound:function(){var e=this;e._drain();for(var t=0;t<e._sounds.length;t++)if(e._sounds[t]._ended)return e._sounds[t].reset();return new Ze(e)},_drain:function(){var e=this,t=e._pool,i=0,n=0;if(!(e._sounds.length<t)){for(n=0;n<e._sounds.length;n++)e._sounds[n]._ended&&i++;for(n=e._sounds.length-1;n>=0;n--){if(i<=t)return;e._sounds[n]._ended&&(e._webAudio&&e._sounds[n]._node&&e._sounds[n]._node.disconnect(0),e._sounds.splice(n,1),i--)}}},_getSoundIds:function(e){if("undefined"===typeof e){for(var t=[],i=0;i<this._sounds.length;i++)t.push(this._sounds[i]._id);return t}return[e]},_refreshBuffer:function(e){return e._node.bufferSource=Xe.ctx.createBufferSource(),e._node.bufferSource.buffer=Ke[this._src],e._panner?e._node.bufferSource.connect(e._panner):e._node.bufferSource.connect(e._node),e._node.bufferSource.loop=e._loop,e._loop&&(e._node.bufferSource.loopStart=e._start||0,e._node.bufferSource.loopEnd=e._stop||0),e._node.bufferSource.playbackRate.setValueAtTime(e._rate,Xe.ctx.currentTime),this},_cleanBuffer:function(e){var t=Xe._navigator&&Xe._navigator.vendor.indexOf("Apple")>=0;if(!e.bufferSource)return this;if(Xe._scratchBuffer&&e.bufferSource&&(e.bufferSource.onended=null,e.bufferSource.disconnect(0),t))try{e.bufferSource.buffer=Xe._scratchBuffer}catch(i){}return e.bufferSource=null,this},_clearSound:function(e){/MSIE |Trident\//.test(Xe._navigator&&Xe._navigator.userAgent)||(e.src="data:audio/wav;base64,UklGRigAAABXQVZFZm10IBIAAAABAAEARKwAAIhYAQACABAAAABkYXRhAgAAAAEA")}};var Ze=function(e){this._parent=e,this.init()};Ze.prototype={init:function(){var e=this,t=e._parent;return e._muted=t._muted,e._loop=t._loop,e._volume=t._volume,e._rate=t._rate,e._seek=0,e._paused=!0,e._ended=!0,e._sprite="__default",e._id=++Xe._counter,t._sounds.push(e),e.create(),e},create:function(){var e=this,t=e._parent,i=Xe._muted||e._muted||e._parent._muted?0:e._volume;return t._webAudio?(e._node="undefined"===typeof Xe.ctx.createGain?Xe.ctx.createGainNode():Xe.ctx.createGain(),e._node.gain.setValueAtTime(i,Xe.ctx.currentTime),e._node.paused=!0,e._node.connect(Xe.masterGain)):Xe.noAudio||(e._node=Xe._obtainHtml5Audio(),e._errorFn=e._errorListener.bind(e),e._node.addEventListener("error",e._errorFn,!1),e._loadFn=e._loadListener.bind(e),e._node.addEventListener(Xe._canPlayEvent,e._loadFn,!1),e._endFn=e._endListener.bind(e),e._node.addEventListener("ended",e._endFn,!1),e._node.src=t._src,e._node.preload=!0===t._preload?"auto":t._preload,e._node.volume=i*Xe.volume(),e._node.load()),e},reset:function(){var e=this,t=e._parent;return e._muted=t._muted,e._loop=t._loop,e._volume=t._volume,e._rate=t._rate,e._seek=0,e._rateSeek=0,e._paused=!0,e._ended=!0,e._sprite="__default",e._id=++Xe._counter,e},_errorListener:function(){var e=this;e._parent._emit("loaderror",e._id,e._node.error?e._node.error.code:0),e._node.removeEventListener("error",e._errorFn,!1)},_loadListener:function(){var e=this,t=e._parent;t._duration=Math.ceil(10*e._node.duration)/10,0===Object.keys(t._sprite).length&&(t._sprite={__default:[0,1e3*t._duration]}),"loaded"!==t._state&&(t._state="loaded",t._emit("load"),t._loadQueue()),e._node.removeEventListener(Xe._canPlayEvent,e._loadFn,!1)},_endListener:function(){var e=this,t=e._parent;t._duration===1/0&&(t._duration=Math.ceil(10*e._node.duration)/10,t._sprite.__default[1]===1/0&&(t._sprite.__default[1]=1e3*t._duration),t._ended(e)),e._node.removeEventListener("ended",e._endFn,!1)}};var Ke={},Qe=function(e){var t=e._src;if(Ke[t])return e._duration=Ke[t].duration,void et(e);if(/^data:[^;]+;base64,/.test(t)){for(var i=atob(t.split(",")[1]),n=new Uint8Array(i.length),r=0;r<i.length;++r)n[r]=i.charCodeAt(r);$e(n.buffer,e)}else{var s=new XMLHttpRequest;s.open(e._xhr.method,t,!0),s.withCredentials=e._xhr.withCredentials,s.responseType="arraybuffer",e._xhr.headers&&Object.keys(e._xhr.headers).forEach((function(t){s.setRequestHeader(t,e._xhr.headers[t])})),s.onload=function(){var t=(s.status+"")[0];"0"===t||"2"===t||"3"===t?$e(s.response,e):e._emit("loaderror",null,"Failed loading audio file with status: "+s.status+".")},s.onerror=function(){e._webAudio&&(e._html5=!0,e._webAudio=!1,e._sounds=[],delete Ke[t],e.load())},Je(s)}},Je=function(e){try{e.send()}catch(t){e.onerror()}},$e=function(e,t){var i=function(){t._emit("loaderror",null,"Decoding audio data failed.")},n=function(e){e&&t._sounds.length>0?(Ke[t._src]=e,et(t,e)):i()};"undefined"!==typeof Promise&&1===Xe.ctx.decodeAudioData.length?Xe.ctx.decodeAudioData(e).then(n).catch(i):Xe.ctx.decodeAudioData(e,n,i)},et=function(e,t){t&&!e._duration&&(e._duration=t.duration),0===Object.keys(e._sprite).length&&(e._sprite={__default:[0,1e3*e._duration]}),"loaded"!==e._state&&(e._state="loaded",e._emit("load"),e._loadQueue())},tt=function(){if(Xe.usingWebAudio){try{"undefined"!==typeof AudioContext?Xe.ctx=new AudioContext:"undefined"!==typeof webkitAudioContext?Xe.ctx=new webkitAudioContext:Xe.usingWebAudio=!1}catch(r){Xe.usingWebAudio=!1}Xe.ctx||(Xe.usingWebAudio=!1);var e=/iP(hone|od|ad)/.test(Xe._navigator&&Xe._navigator.platform),t=Xe._navigator&&Xe._navigator.appVersion.match(/OS (\d+)_(\d+)_?(\d+)?/),i=t?parseInt(t[1],10):null;if(e&&i&&i<9){var n=/safari/.test(Xe._navigator&&Xe._navigator.userAgent.toLowerCase());Xe._navigator&&!n&&(Xe.usingWebAudio=!1)}Xe.usingWebAudio&&(Xe.masterGain="undefined"===typeof Xe.ctx.createGain?Xe.ctx.createGainNode():Xe.ctx.createGain(),Xe.masterGain.gain.setValueAtTime(Xe._muted?0:Xe._volume,Xe.ctx.currentTime),Xe.masterGain.connect(Xe.ctx.destination)),Xe._setup()}};!function(e,t,i,n){var r;e.prototype._pos=[0,0,0],e.prototype._orientation=[0,0,-1,0,1,0],e.prototype.stereo=function(e){var t=this;if(!t.ctx||!t.ctx.listener)return t;for(var i=t._howls.length-1;i>=0;i--)t._howls[i].stereo(e);return t},e.prototype.pos=function(e,i,n){var r=this;return r.ctx&&r.ctx.listener?(i="number"!==typeof i?r._pos[1]:i,n="number"!==typeof n?r._pos[2]:n,"number"!==typeof e?r._pos:(r._pos=[e,i,n],"undefined"!==typeof r.ctx.listener.positionX?(r.ctx.listener.positionX.setTargetAtTime(r._pos[0],t.ctx.currentTime,.1),r.ctx.listener.positionY.setTargetAtTime(r._pos[1],t.ctx.currentTime,.1),r.ctx.listener.positionZ.setTargetAtTime(r._pos[2],t.ctx.currentTime,.1)):r.ctx.listener.setPosition(r._pos[0],r._pos[1],r._pos[2]),r)):r},e.prototype.orientation=function(e,i,n,r,s,o){var a=this;if(!a.ctx||!a.ctx.listener)return a;var l=a._orientation;return i="number"!==typeof i?l[1]:i,n="number"!==typeof n?l[2]:n,r="number"!==typeof r?l[3]:r,s="number"!==typeof s?l[4]:s,o="number"!==typeof o?l[5]:o,"number"!==typeof e?l:(a._orientation=[e,i,n,r,s,o],"undefined"!==typeof a.ctx.listener.forwardX?(a.ctx.listener.forwardX.setTargetAtTime(e,t.ctx.currentTime,.1),a.ctx.listener.forwardY.setTargetAtTime(i,t.ctx.currentTime,.1),a.ctx.listener.forwardZ.setTargetAtTime(n,t.ctx.currentTime,.1),a.ctx.listener.upX.setTargetAtTime(r,t.ctx.currentTime,.1),a.ctx.listener.upY.setTargetAtTime(s,t.ctx.currentTime,.1),a.ctx.listener.upZ.setTargetAtTime(o,t.ctx.currentTime,.1)):a.ctx.listener.setOrientation(e,i,n,r,s,o),a)},i.prototype.init=(r=i.prototype.init,function(e){var t=this;return t._orientation=e.orientation||[1,0,0],t._stereo=e.stereo||null,t._pos=e.pos||null,t._pannerAttr={coneInnerAngle:"undefined"!==typeof e.coneInnerAngle?e.coneInnerAngle:360,coneOuterAngle:"undefined"!==typeof e.coneOuterAngle?e.coneOuterAngle:360,coneOuterGain:"undefined"!==typeof e.coneOuterGain?e.coneOuterGain:0,distanceModel:"undefined"!==typeof e.distanceModel?e.distanceModel:"inverse",maxDistance:"undefined"!==typeof e.maxDistance?e.maxDistance:1e4,panningModel:"undefined"!==typeof e.panningModel?e.panningModel:"HRTF",refDistance:"undefined"!==typeof e.refDistance?e.refDistance:1,rolloffFactor:"undefined"!==typeof e.rolloffFactor?e.rolloffFactor:1},t._onstereo=e.onstereo?[{fn:e.onstereo}]:[],t._onpos=e.onpos?[{fn:e.onpos}]:[],t._onorientation=e.onorientation?[{fn:e.onorientation}]:[],r.call(this,e)}),i.prototype.stereo=function(e,i){var n=this;if(!n._webAudio)return n;if("loaded"!==n._state)return n._queue.push({event:"stereo",action:function(){n.stereo(e,i)}}),n;var r="undefined"===typeof t.ctx.createStereoPanner?"spatial":"stereo";if("undefined"===typeof i){if("number"!==typeof e)return n._stereo;n._stereo=e,n._pos=[e,0,0]}for(var o=n._getSoundIds(i),a=0;a<o.length;a++){var l=n._soundById(o[a]);if(l){if("number"!==typeof e)return l._stereo;l._stereo=e,l._pos=[e,0,0],l._node&&(l._pannerAttr.panningModel="equalpower",l._panner&&l._panner.pan||s(l,r),"spatial"===r?"undefined"!==typeof l._panner.positionX?(l._panner.positionX.setValueAtTime(e,t.ctx.currentTime),l._panner.positionY.setValueAtTime(0,t.ctx.currentTime),l._panner.positionZ.setValueAtTime(0,t.ctx.currentTime)):l._panner.setPosition(e,0,0):l._panner.pan.setValueAtTime(e,t.ctx.currentTime)),n._emit("stereo",l._id)}}return n},i.prototype.pos=function(e,i,n,r){var o=this;if(!o._webAudio)return o;if("loaded"!==o._state)return o._queue.push({event:"pos",action:function(){o.pos(e,i,n,r)}}),o;if(i="number"!==typeof i?0:i,n="number"!==typeof n?-.5:n,"undefined"===typeof r){if("number"!==typeof e)return o._pos;o._pos=[e,i,n]}for(var a=o._getSoundIds(r),l=0;l<a.length;l++){var c=o._soundById(a[l]);if(c){if("number"!==typeof e)return c._pos;c._pos=[e,i,n],c._node&&(c._panner&&!c._panner.pan||s(c,"spatial"),"undefined"!==typeof c._panner.positionX?(c._panner.positionX.setValueAtTime(e,t.ctx.currentTime),c._panner.positionY.setValueAtTime(i,t.ctx.currentTime),c._panner.positionZ.setValueAtTime(n,t.ctx.currentTime)):c._panner.setPosition(e,i,n)),o._emit("pos",c._id)}}return o},i.prototype.orientation=function(e,i,n,r){var o=this;if(!o._webAudio)return o;if("loaded"!==o._state)return o._queue.push({event:"orientation",action:function(){o.orientation(e,i,n,r)}}),o;if(i="number"!==typeof i?o._orientation[1]:i,n="number"!==typeof n?o._orientation[2]:n,"undefined"===typeof r){if("number"!==typeof e)return o._orientation;o._orientation=[e,i,n]}for(var a=o._getSoundIds(r),l=0;l<a.length;l++){var c=o._soundById(a[l]);if(c){if("number"!==typeof e)return c._orientation;c._orientation=[e,i,n],c._node&&(c._panner||(c._pos||(c._pos=o._pos||[0,0,-.5]),s(c,"spatial")),"undefined"!==typeof c._panner.orientationX?(c._panner.orientationX.setValueAtTime(e,t.ctx.currentTime),c._panner.orientationY.setValueAtTime(i,t.ctx.currentTime),c._panner.orientationZ.setValueAtTime(n,t.ctx.currentTime)):c._panner.setOrientation(e,i,n)),o._emit("orientation",c._id)}}return o},i.prototype.pannerAttr=function(){var e,t,i,n=this,r=arguments;if(!n._webAudio)return n;if(0===r.length)return n._pannerAttr;if(1===r.length){if("object"!==typeof r[0])return(i=n._soundById(parseInt(r[0],10)))?i._pannerAttr:n._pannerAttr;e=r[0],"undefined"===typeof t&&(e.pannerAttr||(e.pannerAttr={coneInnerAngle:e.coneInnerAngle,coneOuterAngle:e.coneOuterAngle,coneOuterGain:e.coneOuterGain,distanceModel:e.distanceModel,maxDistance:e.maxDistance,refDistance:e.refDistance,rolloffFactor:e.rolloffFactor,panningModel:e.panningModel}),n._pannerAttr={coneInnerAngle:"undefined"!==typeof e.pannerAttr.coneInnerAngle?e.pannerAttr.coneInnerAngle:n._coneInnerAngle,coneOuterAngle:"undefined"!==typeof e.pannerAttr.coneOuterAngle?e.pannerAttr.coneOuterAngle:n._coneOuterAngle,coneOuterGain:"undefined"!==typeof e.pannerAttr.coneOuterGain?e.pannerAttr.coneOuterGain:n._coneOuterGain,distanceModel:"undefined"!==typeof e.pannerAttr.distanceModel?e.pannerAttr.distanceModel:n._distanceModel,maxDistance:"undefined"!==typeof e.pannerAttr.maxDistance?e.pannerAttr.maxDistance:n._maxDistance,refDistance:"undefined"!==typeof e.pannerAttr.refDistance?e.pannerAttr.refDistance:n._refDistance,rolloffFactor:"undefined"!==typeof e.pannerAttr.rolloffFactor?e.pannerAttr.rolloffFactor:n._rolloffFactor,panningModel:"undefined"!==typeof e.pannerAttr.panningModel?e.pannerAttr.panningModel:n._panningModel})}else 2===r.length&&(e=r[0],t=parseInt(r[1],10));for(var o=n._getSoundIds(t),a=0;a<o.length;a++)if(i=n._soundById(o[a])){var l=i._pannerAttr;l={coneInnerAngle:"undefined"!==typeof e.coneInnerAngle?e.coneInnerAngle:l.coneInnerAngle,coneOuterAngle:"undefined"!==typeof e.coneOuterAngle?e.coneOuterAngle:l.coneOuterAngle,coneOuterGain:"undefined"!==typeof e.coneOuterGain?e.coneOuterGain:l.coneOuterGain,distanceModel:"undefined"!==typeof e.distanceModel?e.distanceModel:l.distanceModel,maxDistance:"undefined"!==typeof e.maxDistance?e.maxDistance:l.maxDistance,refDistance:"undefined"!==typeof e.refDistance?e.refDistance:l.refDistance,rolloffFactor:"undefined"!==typeof e.rolloffFactor?e.rolloffFactor:l.rolloffFactor,panningModel:"undefined"!==typeof e.panningModel?e.panningModel:l.panningModel};var c=i._panner;c||(i._pos||(i._pos=n._pos||[0,0,-.5]),s(i,"spatial"),c=i._panner),c.coneInnerAngle=l.coneInnerAngle,c.coneOuterAngle=l.coneOuterAngle,c.coneOuterGain=l.coneOuterGain,c.distanceModel=l.distanceModel,c.maxDistance=l.maxDistance,c.refDistance=l.refDistance,c.rolloffFactor=l.rolloffFactor,c.panningModel=l.panningModel}return n},n.prototype.init=function(e){return function(){var t=this,i=t._parent;t._orientation=i._orientation,t._stereo=i._stereo,t._pos=i._pos,t._pannerAttr=i._pannerAttr,e.call(this),t._stereo?i.stereo(t._stereo):t._pos&&i.pos(t._pos[0],t._pos[1],t._pos[2],t._id)}}(n.prototype.init),n.prototype.reset=function(e){return function(){var t=this,i=t._parent;return t._orientation=i._orientation,t._stereo=i._stereo,t._pos=i._pos,t._pannerAttr=i._pannerAttr,t._stereo?i.stereo(t._stereo):t._pos?i.pos(t._pos[0],t._pos[1],t._pos[2],t._id):t._panner&&(t._panner.disconnect(0),t._panner=void 0,i._refreshBuffer(t)),e.call(this)}}(n.prototype.reset);var s=function(e,i){"spatial"===(i=i||"spatial")?(e._panner=t.ctx.createPanner(),e._panner.coneInnerAngle=e._pannerAttr.coneInnerAngle,e._panner.coneOuterAngle=e._pannerAttr.coneOuterAngle,e._panner.coneOuterGain=e._pannerAttr.coneOuterGain,e._panner.distanceModel=e._pannerAttr.distanceModel,e._panner.maxDistance=e._pannerAttr.maxDistance,e._panner.refDistance=e._pannerAttr.refDistance,e._panner.rolloffFactor=e._pannerAttr.rolloffFactor,e._panner.panningModel=e._pannerAttr.panningModel,"undefined"!==typeof e._panner.positionX?(e._panner.positionX.setValueAtTime(e._pos[0],t.ctx.currentTime),e._panner.positionY.setValueAtTime(e._pos[1],t.ctx.currentTime),e._panner.positionZ.setValueAtTime(e._pos[2],t.ctx.currentTime)):e._panner.setPosition(e._pos[0],e._pos[1],e._pos[2]),"undefined"!==typeof e._panner.orientationX?(e._panner.orientationX.setValueAtTime(e._orientation[0],t.ctx.currentTime),e._panner.orientationY.setValueAtTime(e._orientation[1],t.ctx.currentTime),e._panner.orientationZ.setValueAtTime(e._orientation[2],t.ctx.currentTime)):e._panner.setOrientation(e._orientation[0],e._orientation[1],e._orientation[2])):(e._panner=t.ctx.createStereoPanner(),e._panner.pan.setValueAtTime(e._stereo,t.ctx.currentTime)),e._panner.connect(e._node),e._paused||e._parent.pause(e._id,!0).play(e._id,!0)}}(Ye,Xe,qe,Ze);const it="undefined"==typeof self,nt=(()=>{if(!it&&document.currentScript){let e=document.currentScript.src,t=e.indexOf("?");if(-1!=t)e=e.substring(0,t);else{let t=e.indexOf("#");-1!=t&&(e=e.substring(0,t))}return e.substring(0,e.lastIndexOf("/")+1)}return"./"})();null==Q.dce&&(Q.dce=nt),$.dce={wasm:!1,js:!1},Z.dce={};function rt(e,t,i,n){if("a"===i&&!n)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!n:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===i?n:"a"===i?n.call(e):n?n.value:t.get(e)}function st(e,t,i,n,r){if("m"===n)throw new TypeError("Private method is not writable");if("a"===n&&!r)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!r:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===n?r.call(e,i):r?r.value=i:t.set(e,i),i}let ot,at,lt,ct,ht;"function"==typeof SuppressedError&&SuppressedError,"undefined"!=typeof navigator&&(ot=navigator,at=ot.userAgent,lt=ot.platform,ct=ot.mediaDevices),function(){if(!it){const e={Edge:{search:"Edg",verSearch:"Edg"},OPR:null,Chrome:null,Safari:{str:ot.vendor,search:"Apple",verSearch:["Version","iPhone OS","CPU OS"]},Firefox:null,Explorer:{search:"MSIE",verSearch:"MSIE"}},t={HarmonyOS:null,Android:null,iPhone:null,iPad:null,Windows:{str:lt,search:"Win"},Mac:{str:lt},Linux:{str:lt}};let i="unknownBrowser",n=0,r="unknownOS";for(let s in e){const t=e[s]||{};let r=t.str||at,o=t.search||s,a=t.verStr||at,l=t.verSearch||s;if(l instanceof Array||(l=[l]),-1!=r.indexOf(o)){i=s;for(let e of l){let t=a.indexOf(e);if(-1!=t){n=parseFloat(a.substring(t+e.length+1));break}}break}}for(let s in t){const e=t[s]||{};let i=e.str||at,n=e.search||s;if(-1!=i.indexOf(n)){r=s;break}}"Linux"==r&&-1!=at.indexOf("Windows NT")&&(r="HarmonyOS"),ht={browser:i,version:n,OS:r}}it&&(ht={browser:"ssr",version:0,OS:"ssr"})}();const ut="undefined"!=typeof WebAssembly&&at&&!(/Safari/.test(at)&&!/Chrome/.test(at)&&/\(.+\s11_2_([2-6]).*\)/.test(at)),dt=!("undefined"==typeof Worker),ft=!(!ct||!ct.getUserMedia),gt=async()=>{let e=!1;if(ft)try{(await ct.getUserMedia({video:!0})).getTracks().forEach((e=>{e.stop()})),e=!0}catch(e){}return e};var pt,mt,_t,vt;"Chrome"===ht.browser&&ht.version>66||"Safari"===ht.browser&&ht.version>13||"OPR"===ht.browser&&ht.version>43||"Edge"===ht.browser&&ht.version,function(e){e[e.DIMT_RECTANGLE=1]="DIMT_RECTANGLE",e[e.DIMT_QUADRILATERAL=2]="DIMT_QUADRILATERAL",e[e.DIMT_TEXT=4]="DIMT_TEXT",e[e.DIMT_ARC=8]="DIMT_ARC",e[e.DIMT_IMAGE=16]="DIMT_IMAGE",e[e.DIMT_POLYGON=32]="DIMT_POLYGON",e[e.DIMT_LINE=64]="DIMT_LINE",e[e.DIMT_GROUP=128]="DIMT_GROUP"}(pt||(pt={})),function(e){e[e.DIS_DEFAULT=1]="DIS_DEFAULT",e[e.DIS_SELECTED=2]="DIS_SELECTED"}(mt||(mt={})),function(e){e[e.EF_ENHANCED_FOCUS=4]="EF_ENHANCED_FOCUS",e[e.EF_AUTO_ZOOM=16]="EF_AUTO_ZOOM",e[e.EF_TAP_TO_FOCUS=64]="EF_TAP_TO_FOCUS"}(_t||(_t={})),function(e){e.GREY="grey",e.GREY32="grey32",e.RGBA="rgba",e.RBGA="rbga",e.GRBA="grba",e.GBRA="gbra",e.BRGA="brga",e.BGRA="bgra"}(vt||(vt={}));const yt=e=>"number"==typeof e&&!Number.isNaN(e),wt=e=>"string"==typeof e;var bt,Ct,St,Et,Tt,xt;!function(e){e.ARC="arc",e.IMAGE="image",e.LINE="line",e.POLYGON="polygon",e.QUAD="quad",e.RECT="rect",e.TEXT="text",e.GROUP="group"}(Tt||(Tt={})),function(e){e.DEFAULT="default",e.SELECTED="selected"}(xt||(xt={}));class It{get mediaType(){return new Map([["rect",pt.DIMT_RECTANGLE],["quad",pt.DIMT_QUADRILATERAL],["text",pt.DIMT_TEXT],["arc",pt.DIMT_ARC],["image",pt.DIMT_IMAGE],["polygon",pt.DIMT_POLYGON],["line",pt.DIMT_LINE],["group",pt.DIMT_GROUP]]).get(this._mediaType)}get styleSelector(){switch(rt(this,Ct,"f")){case mt.DIS_DEFAULT:return"default";case mt.DIS_SELECTED:return"selected"}}set drawingStyleId(e){this.styleId=e}get drawingStyleId(){return this.styleId}set coordinateBase(e){if(!["view","image"].includes(e))throw new Error("Invalid 'coordinateBase'.");this._drawingLayer&&("image"===rt(this,St,"f")&&"view"===e?this.updateCoordinateBaseFromImageToView():"view"===rt(this,St,"f")&&"image"===e&&this.updateCoordinateBaseFromViewToImage()),st(this,St,e,"f")}get coordinateBase(){return rt(this,St,"f")}get drawingLayerId(){return this._drawingLayerId}constructor(e,t){if(bt.add(this),Ct.set(this,void 0),St.set(this,"image"),this._zIndex=null,this._drawingLayer=null,this._drawingLayerId=null,this._mapStyle=new Map,this._mapState_StyleId=new Map,this.mapEvent_Callbacks=new Map([["selected",new Map],["deselected",new Map],["mousedown",new Map],["mouseup",new Map],["dblclick",new Map],["mouseover",new Map],["mouseout",new Map]]),this.mapNoteName_Content=new Map([]),this.isDrawingItem=!0,null!=t&&!yt(t))throw new TypeError("Invalid 'drawingStyleId'.");e&&this._setFabricObject(e),this.setState(mt.DIS_DEFAULT),this.styleId=t}_setFabricObject(e){this._fabricObject=e,this._fabricObject.on("selected",(()=>{this.setState(mt.DIS_SELECTED)})),this._fabricObject.on("deselected",(()=>{this._fabricObject.canvas&&this._fabricObject.canvas.getActiveObjects().includes(this._fabricObject)?this.setState(mt.DIS_SELECTED):this.setState(mt.DIS_DEFAULT),"textbox"===this._fabricObject.type&&(this._fabricObject.isEditing&&this._fabricObject.exitEditing(),this._fabricObject.selected=!1)})),e.getDrawingItem=()=>this}_getFabricObject(){return this._fabricObject}setState(e){st(this,Ct,e,"f")}getState(){return rt(this,Ct,"f")}_on(e,t){if(!t)return;const i=e.toLowerCase(),n=this.mapEvent_Callbacks.get(i);if(!n)throw new Error("Event '".concat(e,"' does not exist."));let r=n.get(t);r||(r=e=>{const i=e.e;if(!i)return void(t&&t.apply(this,[{targetItem:this,itemClientX:null,itemClientY:null,itemPageX:null,itemPageY:null}]));const n={targetItem:this,itemClientX:null,itemClientY:null,itemPageX:null,itemPageY:null};if(this._drawingLayer){let e,t,r,s;const o=i.target.getBoundingClientRect();e=o.left,t=o.top,r=e+window.scrollX,s=t+window.scrollY;const{width:a,height:l}=this._drawingLayer.fabricCanvas.lowerCanvasEl.getBoundingClientRect(),c=this._drawingLayer.width,h=this._drawingLayer.height,u=a/l,d=c/h,f=this._drawingLayer._getObjectFit();let g,p,m,_,v=1;if("contain"===f)u<d?(v=a/c,g=e+this.get("x")*v,p=t+this.get("y")*v+(l-h*v)/2,m=r+this.get("x")*v,_=s+this.get("y")*v+(l-h*v)/2):(v=l/h,g=e+this.get("x")*v+(a-c*v)/2,p=t+this.get("y")*v,m=r+this.get("x")*v+(a-c*v)/2,_=s+this.get("y")*v);else if("cover"===f)if(u<d){v=l/h;let i=this.get("x")*v-(c*v-a)/2;i=Math.max(i,0),i=Math.min(i,a),g=e+i,p=t+this.get("y")*v,m=r+i,_=s+this.get("y")*v}else{v=a/c;let i=this.get("y")*v-(h*v-l)/2;i=Math.max(i,0),i=Math.min(i,l),g=e+this.get("x")*v,p=t+i,m=r+this.get("x")*v,_=s+i}n.itemClientX=Math.round(g),n.itemClientY=Math.round(p),n.itemPageX=Math.round(m),n.itemPageY=Math.round(_)}for(let t of Object.getOwnPropertyNames(n))Object.defineProperty(i,t,{value:n[t],writable:!0});t&&t.apply(this,[i])},n.set(t,r),this._fabricObject.on("dblclick"===i?"mousedblclick":i,r))}on(e,t){this._on(e,t)}_off(e,t){const i=e.toLowerCase(),n=this.mapEvent_Callbacks.get(i);if(!n)throw new Error("Event '".concat(e,"' does not exist."));let r=n.get(t);r&&(n.delete(t),this._fabricObject.off("dblclick"===i?"mousedblclick":i,r))}off(e,t){this._off(e,t)}_setEditable(e){const t=this._fabricObject;e?(t.selectable=!0,t.hasControls=!0,t.hoverCursor=null):(t.selectable=!1,t.hasControls=!1,t.hoverCursor="default")}hasNote(e){return this.mapNoteName_Content.has(e)}addNote(e,t){if(this.hasNote(e.name)&&!t)throw new Error("A note with the same name already exists, please use a different name.");const i=e.content?JSON.parse(JSON.stringify(e.content)):e.content;this.mapNoteName_Content.set(e.name,[i])}getNote(e){const t=this.mapNoteName_Content.get(e);return t?1===t.length?{name:e,content:t[0]?JSON.parse(JSON.stringify(t[0])):t[0]}:{name:e,content:JSON.parse(JSON.stringify(t))}:null}getNotes(){const e=[];for(let t of this.mapNoteName_Content){let i=1===t[1].length?t[1][0]:t[1];i=i?JSON.parse(JSON.stringify(i)):i,e.push({name:t[0],content:i})}return e}updateNote(e,t,i){const n=this.mapNoteName_Content.get(e);if(!n)throw new Error("The note name does not exist.");i||(n.length=0),t=t?JSON.parse(JSON.stringify(t)):t,n.push(t)}deleteNote(e){this.mapNoteName_Content.delete(e)}clearNotes(){this.mapNoteName_Content.clear()}set(e,t){if(!this.extendSet(e,t))if("x"===e){const e=this._fabricObject.group;e?(this._fabricObject.set("left",t-e.left-e.width/2),e.addWithUpdate()):this._fabricObject.set("left",t)}else if("y"===e){const e=this._fabricObject.group;e?(this._fabricObject.set("top",t-e.top-e.height/2),e.addWithUpdate()):this._fabricObject.set("top",t)}else"styleId"===e?this.styleId=t:this._fabricObject.set(e,t);["vertices","startPoint","endPoint","x","y","left","top","width","height","scaleX","scaleY","skewX","skewY","padding","angle","strokeWidth"].includes(e)&&this._fabricObject.setCoords()}get(e){let t=this.extendGet(e);if(void 0===t)if("x"===e){const e=this._fabricObject.group;t=e?this._fabricObject.get("left")+e.left+e.width/2:this._fabricObject.get("left")}else if("y"===e){const e=this._fabricObject.group;t=e?this._fabricObject.get("top")+e.top+e.height/2:this._fabricObject.get("top")}else t="scaledWidth"===e?this._fabricObject.getScaledWidth():"scaledHeight"===e?this._fabricObject.getScaledHeight():["type","mediaType"].includes(e)?this.mediaType:"state"===e?this.getState():"styleId"===e?this.styleId:"drawingLayerId"===e?this.drawingLayerId:this._fabricObject.get(e);return t}remove(){this._drawingLayer&&this._drawingLayer.removeDrawingItem(this)}convertPropFromImageToView(e){if("number"!=typeof e)throw new TypeError("Invalid value.");return e*rt(this,bt,"m",Et).call(this)}convertPropFromViewToImage(e){if("number"!=typeof e)throw new TypeError("Invalid value.");return e/rt(this,bt,"m",Et).call(this)}_setLineWidth(e){if(this._drawingLayer)if("view"===this.coordinateBase)this.set("strokeWidth",this.convertPropFromViewToImage(e));else{if("image"!==this.coordinateBase)throw new Error("Invalid 'coordinateBase'.");this.set("strokeWidth",e)}}_getLineWidth(){if(this._drawingLayer){if("view"===this.coordinateBase)return this.convertPropFromImageToView(this.get("strokeWidth"));if("image"===this.coordinateBase)return this.get("strokeWidth");throw new Error("Invalid 'coordinateBase'.")}}_setFontSize(e){if(this._drawingLayer)if("view"===this.coordinateBase)this.set("fontSize",this.convertPropFromViewToImage(e));else{if("image"!==this.coordinateBase)throw new Error("Invalid 'coordinateBase'.");this.set("fontSize",e)}}_getFontSize(){if(this._drawingLayer){if("view"===this.coordinateBase)return this.convertPropFromImageToView(this.get("fontSize"));if("image"===this.coordinateBase)return this.get("fontSize");throw new Error("Invalid 'coordinateBase'.")}}}Ct=new WeakMap,St=new WeakMap,bt=new WeakSet,Et=function(){const e=this._drawingLayer;if(!e)return 1;const t=e.width,i=e.height,{width:n,height:r}=e.fabricCanvas.wrapperEl.getBoundingClientRect();if(n<=0||r<=0)throw new Error("Unable to get drawing layer dimensions. Layer may not be rendered on the page.");const s=n/t,o=r/i,a=e._getObjectFit();let l=1;return"contain"===a?l=s<o?n/t:r/i:"cover"===a&&(l=s<o?r/i:n/t),l},It.arrMediaTypes=["rect","arc","polygon","image","text","line","quad"],It.mapItemType=new Map([[Tt.ARC,"arc"],[Tt.IMAGE,"image"],[Tt.LINE,"line"],[Tt.POLYGON,"polygon"],[Tt.QUAD,"quad"],[Tt.RECT,"rect"],[Tt.TEXT,"text"],[Tt.GROUP,"group"]]),It.arrStyleSelectors=["default","selected"],It.mapItemState=new Map([[xt.DEFAULT,"default"],[xt.SELECTED,"selected"]]);const At=e=>null!==e&&"object"==typeof e&&!Array.isArray(e),Ot=e=>!!wt(e)&&""!==e,Rt=e=>!!d(e)&&!!u(e.left)&&!(e.left<0)&&!!u(e.top)&&!(e.top<0)&&!!u(e.right)&&!(e.right<0)&&!!u(e.bottom)&&!(e.bottom<0)&&!(e.left>=e.right)&&!(e.top>=e.bottom)&&!!h(e.isMeasuredInPercentage),Dt=e=>!!d(e)&&!!c(e.points)&&0!=e.points.length&&!e.points.some((e=>!p(e))),Lt=p,kt=e=>!!d(e)&&!!c(e.points)&&0!=e.points.length&&4==e.points.length&&!e.points.some((e=>!p(e))),Mt=e=>!!d(e)&&!!u(e.x)&&!!u(e.y)&&!!u(e.width)&&!(e.width<0)&&!!u(e.height)&&!(e.height<0)&&!("isMeasuredInPercentage"in e&&!h(e.isMeasuredInPercentage)),Pt=e=>!!At(e)&&!("id"in e&&!yt(e.id))&&!("lineWidth"in e&&!yt(e.lineWidth))&&!("fillStyle"in e&&!Ot(e.fillStyle))&&!("strokeStyle"in e&&!Ot(e.strokeStyle))&&!("paintMode"in e&&!["fill","stroke","strokeAndFill"].includes(e.paintMode))&&!("fontFamily"in e&&!Ot(e.fontFamily))&&!("fontSize"in e&&!yt(e.fontSize));class Ft{static convert(e,t,i){const n={x:0,y:0,width:t,height:i};if(!e)return n;if(Mt(e))e.isMeasuredInPercentage?(n.x=e.x/100*t,n.y=e.y/100*i,n.width=e.width/100*t,n.height=e.height/100*i):(n.x=e.x,n.y=e.y,n.width=e.width,n.height=e.height);else{if(!Rt(e))throw TypeError("Invalid region.");e.isMeasuredInPercentage?(n.x=e.left/100*t,n.y=e.top/100*i,n.width=(e.right-e.left)/100*t,n.height=(e.bottom-e.top)/100*i):(n.x=e.left,n.y=e.top,n.width=e.right-e.left,n.height=e.bottom-e.top)}return n.x=Math.round(n.x),n.y=Math.round(n.y),n.width=Math.round(n.width),n.height=Math.round(n.height),n}}var Nt,Bt;class jt{constructor(){Nt.set(this,new Map),Bt.set(this,!1)}get disposed(){return rt(this,Bt,"f")}on(e,t){e=e.toLowerCase();const i=rt(this,Nt,"f").get(e);if(i){if(i.includes(t))return;i.push(t)}else rt(this,Nt,"f").set(e,[t])}off(e,t){e=e.toLowerCase();const i=rt(this,Nt,"f").get(e);if(!i)return;const n=i.indexOf(t);-1!==n&&i.splice(n,1)}offAll(e){e=e.toLowerCase();const t=rt(this,Nt,"f").get(e);t&&(t.length=0)}async fire(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{async:!1,copy:!0};t||(t=[]),e=e.toLowerCase();const n=rt(this,Nt,"f").get(e);if(n&&n.length){i=Object.assign({async:!1,copy:!0},i);for(let r of n){if(!r)continue;let n=[];if(i.copy)for(let i of t){try{i=JSON.parse(JSON.stringify(i))}catch(e){}n.push(i)}else n=t;let s=!1;if(i.async)setTimeout((()=>{this.disposed||r.apply(i.target,n)}),0);else try{s=await r.apply(i.target,n)}catch(e){}if(!0===s)break}}}dispose(){st(this,Bt,!0,"f")}}function Ut(e,t,i){return(i.x-e.x)*(t.y-e.y)==(t.x-e.x)*(i.y-e.y)&&Math.min(e.x,t.x)<=i.x&&i.x<=Math.max(e.x,t.x)&&Math.min(e.y,t.y)<=i.y&&i.y<=Math.max(e.y,t.y)}function Vt(e){return Math.abs(e)<1e-6?0:e<0?-1:1}function Gt(e,t,i,n){let r=e[0]*(i[1]-t[1])+t[0]*(e[1]-i[1])+i[0]*(t[1]-e[1]),s=e[0]*(n[1]-t[1])+t[0]*(e[1]-n[1])+n[0]*(t[1]-e[1]);return!((r^s)>=0&&0!==r&&0!==s)&&(r=i[0]*(e[1]-n[1])+n[0]*(i[1]-e[1])+e[0]*(n[1]-i[1]),s=i[0]*(t[1]-n[1])+n[0]*(i[1]-t[1])+t[0]*(n[1]-i[1]),!((r^s)>=0&&0!==r&&0!==s))}Nt=new WeakMap,Bt=new WeakMap;const Wt=async e=>{if("string"!=typeof e)throw new TypeError("Invalid url.");const t=await fetch(e);if(!t.ok)throw Error("Network Error: "+t.statusText);const i=await t.text();if(!i.trim().startsWith("<"))throw Error("Unable to get valid HTMLElement.");const n=document.createElement("div");n.insertAdjacentHTML("beforeend",i);for(let r=0;r<n.childElementCount;++r){let e=n.children[r];e instanceof HTMLStyleElement&&document.head.append(e)}return 1==n.childElementCount?n.children[0]:n};var zt,Ht,Yt;class Xt extends It{constructor(e,t){if(super(null,t),zt.set(this,void 0),!Mt(e))throw new TypeError("Invalid 'rect'.");this._setFabricObject(new He.Rect({left:e.x,top:e.y,width:e.width,height:e.height})),st(this,zt,JSON.parse(JSON.stringify(e)),"f"),this._mediaType="rect"}extendSet(e,t){return!1}extendGet(e){}updateCoordinateBaseFromImageToView(){this.set("left",this.convertPropFromViewToImage(this.get("left"))),this.set("top",this.convertPropFromViewToImage(this.get("top"))),this.set("width",this.convertPropFromViewToImage(this.get("scaledWidth"))),this.set("height",this.convertPropFromViewToImage(this.get("scaledHeight")))}updateCoordinateBaseFromViewToImage(){this.set("left",this.convertPropFromImageToView(this.get("left"))),this.set("top",this.convertPropFromImageToView(this.get("top"))),this.set("width",this.convertPropFromImageToView(this.get("scaledWidth"))),this.set("height",this.convertPropFromImageToView(this.get("scaledHeight")))}setPosition(e){this.setRect(e)}getPosition(){return this.getRect()}updatePosition(){rt(this,zt,"f")&&this.setRect(rt(this,zt,"f"))}setRect(e){if(!Mt(e))throw new TypeError("Invalid 'rect'.");if(this._drawingLayer){if("view"===this.coordinateBase)this.set("left",this.convertPropFromViewToImage(e.x)),this.set("top",this.convertPropFromViewToImage(e.y)),this.set("width",this.convertPropFromViewToImage(e.width)),this.set("height",this.convertPropFromViewToImage(e.height));else{if("image"!==this.coordinateBase)throw new Error("Invalid 'coordinateBase'.");this.set("left",e.x),this.set("top",e.y),this.set("width",e.width),this.set("height",e.height)}this._drawingLayer.renderAll()}else st(this,zt,JSON.parse(JSON.stringify(e)),"f")}getRect(){if(this._drawingLayer){if("view"===this.coordinateBase)return{x:this.convertPropFromImageToView(this.get("left")),y:this.convertPropFromImageToView(this.get("top")),width:this.convertPropFromImageToView(this.get("scaledWidth")),height:this.convertPropFromImageToView(this.get("scaledHeight"))};if("image"===this.coordinateBase)return{x:this.get("left"),y:this.get("top"),width:this.get("scaledWidth"),height:this.get("scaledHeight")};throw new Error("Invalid 'coordinateBase'.")}return rt(this,zt,"f")?JSON.parse(JSON.stringify(rt(this,zt,"f"))):null}}function qt(e,t,i){let n=i.points[this.pointIndex].x-i.pathOffset.x,r=i.points[this.pointIndex].y-i.pathOffset.y;return He.util.transformPoint({x:n,y:r},i.calcTransformMatrix())}function Zt(e){let t=new He.Point(e.strokeUniform?1/e.scaleX:1,e.strokeUniform?1/e.scaleY:1).multiply(e.strokeWidth);return new He.Point(e.width+t.x,e.height+t.y)}function Kt(e,t,i,n){let r=t.target,s=r.controls[r.__corner],o=r.toLocalPoint(new He.Point(i,n),"center","center"),a=Zt(r),l=r._getTransformedDimensions(0,0),c={x:o.x*a.x/l.x+r.pathOffset.x,y:o.y*a.y/l.y+r.pathOffset.y};return r.points[s.pointIndex]=c,!0}function Qt(e,t){return function(i,n,r,s){let o=n.target,a=He.util.transformPoint({x:o.points[e].x-o.pathOffset.x,y:o.points[e].y-o.pathOffset.y},o.calcTransformMatrix()),l=t(i,n,r,s);o._setPositionDimensions({});let c=Zt(o),h=(o.points[e].x-o.pathOffset.x)/c.x,u=(o.points[e].y-o.pathOffset.y)/c.y;return o.setPositionByOrigin(a,h+.5,u+.5),l}}zt=new WeakMap;class Jt extends It{constructor(e,t){if(super(null,t),Ht.set(this,void 0),!Dt(e))throw new TypeError("Invalid 'polygon'.");this._setFabricObject(new He.Polygon(e.points,{objectCaching:!1}));const i=this._fabricObject;let n=i.points.length-1;i.controls=i.points.reduce((function(e,t,i){return e["p"+i]=new He.Control({positionHandler:qt,actionHandler:Qt(i>0?i-1:n,Kt),actionName:"modifyPolygon",pointIndex:i}),e}),{}),st(this,Ht,JSON.parse(JSON.stringify(e)),"f"),this._mediaType="polygon"}extendSet(e,t){if("vertices"===e){const e=this._fabricObject;if(e.group){const i=e.group;e.points=t.map((e=>({x:e.x-i.left-i.width/2,y:e.y-i.top-i.height/2}))),i.addWithUpdate()}else e.points=t;const i=e.points.length-1;return e.controls=e.points.reduce((function(e,t,n){return e["p"+n]=new He.Control({positionHandler:qt,actionHandler:Qt(n>0?n-1:i,Kt),actionName:"modifyPolygon",pointIndex:n}),e}),{}),e._setPositionDimensions({}),!0}}extendGet(e){if("vertices"===e){const e=[],t=this._fabricObject;if(t.selectable&&!t.group)for(let i in t.oCoords)e.push({x:t.oCoords[i].x,y:t.oCoords[i].y});else for(let i of t.points){let n=i.x-t.pathOffset.x,r=i.y-t.pathOffset.y;const s=He.util.transformPoint({x:n,y:r},t.calcTransformMatrix());e.push({x:s.x,y:s.y})}return e}}updateCoordinateBaseFromImageToView(){const e=this.get("vertices").map((e=>({x:this.convertPropFromViewToImage(e.x),y:this.convertPropFromViewToImage(e.y)})));this.set("vertices",e)}updateCoordinateBaseFromViewToImage(){const e=this.get("vertices").map((e=>({x:this.convertPropFromImageToView(e.x),y:this.convertPropFromImageToView(e.y)})));this.set("vertices",e)}setPosition(e){this.setPolygon(e)}getPosition(){return this.getPolygon()}updatePosition(){rt(this,Ht,"f")&&this.setPolygon(rt(this,Ht,"f"))}setPolygon(e){if(!Dt(e))throw new TypeError("Invalid 'polygon'.");if(this._drawingLayer){if("view"===this.coordinateBase){const t=e.points.map((e=>({x:this.convertPropFromViewToImage(e.x),y:this.convertPropFromViewToImage(e.y)})));this.set("vertices",t)}else{if("image"!==this.coordinateBase)throw new Error("Invalid 'coordinateBase'.");this.set("vertices",e.points)}this._drawingLayer.renderAll()}else st(this,Ht,JSON.parse(JSON.stringify(e)),"f")}getPolygon(){if(this._drawingLayer){if("view"===this.coordinateBase)return{points:this.get("vertices").map((e=>({x:this.convertPropFromImageToView(e.x),y:this.convertPropFromImageToView(e.y)})))};if("image"===this.coordinateBase)return{points:this.get("vertices")};throw new Error("Invalid 'coordinateBase'.")}return rt(this,Ht,"f")?JSON.parse(JSON.stringify(rt(this,Ht,"f"))):null}}Ht=new WeakMap,new WeakMap,new WeakMap;const $t=e=>{let t=(e=>e.split("\n").map((e=>e.split("\t"))))(e);return(e=>{for(let t=0;;t++){let i=-1;for(let n=0;n<e.length;n++){let r=e[n][t];void 0!==r&&r.length>i&&(i=r.length)}if(-1===i)break;for(let n=0;n<e.length;n++){if(t>=e[n].length-1)continue;let r=" ".repeat(i+2-e[n][t].length);e[n][t]=e[n][t].concat(r)}}})(t),(e=>{let t="";for(let i=0;i<e.length;i++)t=t.concat(...e[i],i===e.length-1?"":"\n");return t})(t)};class ei extends It{constructor(e,t,i){if(super(null,i),Yt.set(this,void 0),!wt(e))throw new TypeError("Invalid 'text'.");if(!Mt(t))throw new TypeError("Invalid 'rect'.");this._setFabricObject(new He.Textbox($t(e),{left:t.x,top:t.y,width:t.width})),this._text=e,st(this,Yt,JSON.parse(JSON.stringify(t)),"f"),this._mediaType="text"}extendSet(e,t){if("text"===e)return this._text=t,this._fabricObject.set("text",$t(t)),!0}extendGet(e){if("text"===e)return this._text}updateCoordinateBaseFromImageToView(){this.set("left",this.convertPropFromViewToImage(this.get("left"))),this.set("top",this.convertPropFromViewToImage(this.get("top"))),this.set("width",this.convertPropFromViewToImage(this.get("scaledWidth")))}updateCoordinateBaseFromViewToImage(){this.set("left",this.convertPropFromImageToView(this.get("left"))),this.set("top",this.convertPropFromImageToView(this.get("top"))),this.set("width",this.convertPropFromImageToView(this.get("scaledWidth")))}setPosition(e){this.setTextRect(e)}getPosition(){return this.getTextRect()}updatePosition(){rt(this,Yt,"f")&&this.setTextRect(rt(this,Yt,"f"))}setText(e){if(!wt(e))throw new TypeError("Invalid 'text'.");this.set("text",e)}getText(){return this.get("text")}setTextRect(e){if(!Mt(e))throw new TypeError("Invalid 'rect'.");if(this._drawingLayer){if("view"===this.coordinateBase)this.set("left",this.convertPropFromViewToImage(e.x)),this.set("top",this.convertPropFromViewToImage(e.y)),this.set("width",this.convertPropFromViewToImage(e.width));else{if("image"!==this.coordinateBase)throw new Error("Invalid 'coordinateBase'.");this.set("left",e.x),this.set("top",e.y),this.set("width",e.width)}this._drawingLayer.renderAll()}else st(this,Yt,JSON.parse(JSON.stringify(e)),"f")}getTextRect(){if(this._drawingLayer){if("view"===this.coordinateBase)return{x:this.convertPropFromImageToView(this.get("left")),y:this.convertPropFromImageToView(this.get("top")),width:this.convertPropFromImageToView(this.get("scaledWidth")),height:this.convertPropFromImageToView(this.get("scaledHeight"))};if("image"===this.coordinateBase)return{x:this.get("left"),y:this.get("top"),width:this.get("scaledWidth"),height:this.get("scaledHeight")};throw new Error("Invalid 'coordinateBase'.")}return rt(this,Yt,"f")?JSON.parse(JSON.stringify(rt(this,Yt,"f"))):null}}var ti,ii,ni,ri,si,oi,ai,li,ci,hi,ui,di,fi,gi,pi,mi,_i,vi,yi,wi,bi,Ci,Si,Ei,Ti,xi,Ii,Ai,Oi,Ri,Di,Li,ki,Mi,Pi;Yt=new WeakMap,new WeakMap;class Fi extends Jt{constructor(e,t){if(super({points:null==e?void 0:e.points},t),ti.set(this,void 0),!kt(e))throw new TypeError("Invalid 'quad'.");st(this,ti,JSON.parse(JSON.stringify(e)),"f"),this._mediaType="quad"}setPosition(e){this.setQuad(e)}getPosition(){return this.getQuad()}updatePosition(){rt(this,ti,"f")&&this.setQuad(rt(this,ti,"f"))}setPolygon(){}getPolygon(){return null}setQuad(e){if(!kt(e))throw new TypeError("Invalid 'quad'.");if(this._drawingLayer){if("view"===this.coordinateBase){const t=e.points.map((e=>({x:this.convertPropFromViewToImage(e.x),y:this.convertPropFromViewToImage(e.y)})));this.set("vertices",t)}else{if("image"!==this.coordinateBase)throw new Error("Invalid 'coordinateBase'.");this.set("vertices",e.points)}this._drawingLayer.renderAll()}else st(this,ti,JSON.parse(JSON.stringify(e)),"f")}getQuad(){if(this._drawingLayer){if("view"===this.coordinateBase)return{points:this.get("vertices").map((e=>({x:this.convertPropFromImageToView(e.x),y:this.convertPropFromImageToView(e.y)})))};if("image"===this.coordinateBase)return{points:this.get("vertices")};throw new Error("Invalid 'coordinateBase'.")}return rt(this,ti,"f")?JSON.parse(JSON.stringify(rt(this,ti,"f"))):null}}ti=new WeakMap;class Ni extends It{constructor(e){super(new He.Group(e.map((e=>e._getFabricObject())))),this._fabricObject.on("selected",(()=>{this.setState(mt.DIS_SELECTED);const e=this._fabricObject._objects;for(let t of e)setTimeout((()=>{t&&t.fire("selected")}),0);setTimeout((()=>{this._fabricObject&&this._fabricObject.canvas&&(this._fabricObject.dirty=!0,this._fabricObject.canvas.renderAll())}),0)})),this._fabricObject.on("deselected",(()=>{this.setState(mt.DIS_DEFAULT);const e=this._fabricObject._objects;for(let t of e)setTimeout((()=>{t&&t.fire("deselected")}),0);setTimeout((()=>{this._fabricObject&&this._fabricObject.canvas&&(this._fabricObject.dirty=!0,this._fabricObject.canvas.renderAll())}),0)})),this._mediaType="group"}extendSet(e,t){return!1}extendGet(e){}updateCoordinateBaseFromImageToView(){}updateCoordinateBaseFromViewToImage(){}setPosition(){}getPosition(){}updatePosition(){}getChildDrawingItems(){return this._fabricObject._objects.map((e=>e.getDrawingItem()))}setChildDrawingItems(e){if(!e||!e.isDrawingItem)throw TypeError("Illegal drawing item.");this._drawingLayer?this._drawingLayer._updateGroupItem(this,e,"add"):this._fabricObject.addWithUpdate(e._getFabricObject())}removeChildItem(e){e&&e.isDrawingItem&&(this._drawingLayer?this._drawingLayer._updateGroupItem(this,e,"remove"):this._fabricObject.removeWithUpdate(e._getFabricObject()))}}class Bi{static createDrawingStyle(e){if(!Pt(e))throw new Error("Invalid style definition.");let t,i=Bi.USER_START_STYLE_ID;for(;rt(Bi,ii,"f",ni).has(i);)i++;t=i;const n=JSON.parse(JSON.stringify(e));n.id=t;for(let r in rt(Bi,ii,"f",ri))n.hasOwnProperty(r)||(n[r]=rt(Bi,ii,"f",ri)[r]);return rt(Bi,ii,"f",ni).set(t,n),n.id}static _getDrawingStyle(e,t){if("number"!=typeof e)throw new Error("Invalid style id.");const i=rt(Bi,ii,"f",ni).get(e);return i?t?JSON.parse(JSON.stringify(i)):i:null}static getDrawingStyle(e){return this._getDrawingStyle(e,!0)}static getDrawingStyles(){return JSON.parse(JSON.stringify(Array.from(rt(Bi,ii,"f",ni).values())))}static _updateDrawingStyle(e,t){if(!Pt(t))throw new Error("Invalid style definition.");const i=rt(Bi,ii,"f",ni).get(e);if(i)for(let n in t)i.hasOwnProperty(n)&&(i[n]=t[n])}static updateDrawingStyle(e,t){this._updateDrawingStyle(e,t)}}ii=Bi,Bi.STYLE_BLUE_STROKE=1,Bi.STYLE_GREEN_STROKE=2,Bi.STYLE_ORANGE_STROKE=3,Bi.STYLE_YELLOW_STROKE=4,Bi.STYLE_BLUE_STROKE_FILL=5,Bi.STYLE_GREEN_STROKE_FILL=6,Bi.STYLE_ORANGE_STROKE_FILL=7,Bi.STYLE_YELLOW_STROKE_FILL=8,Bi.STYLE_BLUE_STROKE_TRANSPARENT=9,Bi.STYLE_GREEN_STROKE_TRANSPARENT=10,Bi.STYLE_ORANGE_STROKE_TRANSPARENT=11,Bi.USER_START_STYLE_ID=1024,ni={value:new Map([[Bi.STYLE_BLUE_STROKE,{id:Bi.STYLE_BLUE_STROKE,lineWidth:4,fillStyle:"rgba(73, 173, 245, 0.3)",strokeStyle:"rgba(73, 173, 245, 1)",paintMode:"stroke",fontFamily:"consolas",fontSize:40}],[Bi.STYLE_GREEN_STROKE,{id:Bi.STYLE_GREEN_STROKE,lineWidth:2,fillStyle:"rgba(73, 245, 73, 0.3)",strokeStyle:"rgba(73, 245, 73, 0.9)",paintMode:"strokeAndFill",fontFamily:"consolas",fontSize:40}],[Bi.STYLE_ORANGE_STROKE,{id:Bi.STYLE_ORANGE_STROKE,lineWidth:2,fillStyle:"rgba(254, 180, 32, 0.3)",strokeStyle:"rgba(254, 180, 32, 0.9)",paintMode:"strokeAndFill",fontFamily:"consolas",fontSize:40}],[Bi.STYLE_YELLOW_STROKE,{id:Bi.STYLE_YELLOW_STROKE,lineWidth:2,fillStyle:"rgba(245, 236, 73, 0.3)",strokeStyle:"rgba(245, 236, 73, 1)",paintMode:"stroke",fontFamily:"consolas",fontSize:40}],[Bi.STYLE_BLUE_STROKE_FILL,{id:Bi.STYLE_BLUE_STROKE_FILL,lineWidth:4,fillStyle:"rgba(73, 173, 245, 0.3)",strokeStyle:"rgba(73, 173, 245, 1)",paintMode:"strokeAndFill",fontFamily:"consolas",fontSize:40}],[Bi.STYLE_GREEN_STROKE_FILL,{id:Bi.STYLE_GREEN_STROKE_FILL,lineWidth:2,fillStyle:"rgba(73, 245, 73, 0.3)",strokeStyle:"rgba(73, 245, 73, 0.9)",paintMode:"strokeAndFill",fontFamily:"consolas",fontSize:40}],[Bi.STYLE_ORANGE_STROKE_FILL,{id:Bi.STYLE_ORANGE_STROKE_FILL,lineWidth:2,fillStyle:"rgba(254, 180, 32, 0.3)",strokeStyle:"rgba(254, 180, 32, 1)",paintMode:"strokeAndFill",fontFamily:"consolas",fontSize:40}],[Bi.STYLE_YELLOW_STROKE_FILL,{id:Bi.STYLE_YELLOW_STROKE_FILL,lineWidth:2,fillStyle:"rgba(245, 236, 73, 0.3)",strokeStyle:"rgba(245, 236, 73, 1)",paintMode:"strokeAndFill",fontFamily:"consolas",fontSize:40}],[Bi.STYLE_BLUE_STROKE_TRANSPARENT,{id:Bi.STYLE_BLUE_STROKE_TRANSPARENT,lineWidth:4,fillStyle:"rgba(73, 245, 73, 0.2)",strokeStyle:"transparent",paintMode:"strokeAndFill",fontFamily:"consolas",fontSize:40}],[Bi.STYLE_GREEN_STROKE_TRANSPARENT,{id:Bi.STYLE_GREEN_STROKE_TRANSPARENT,lineWidth:2,fillStyle:"rgba(73, 245, 73, 0.2)",strokeStyle:"transparent",paintMode:"strokeAndFill",fontFamily:"consolas",fontSize:40}],[Bi.STYLE_ORANGE_STROKE_TRANSPARENT,{id:Bi.STYLE_ORANGE_STROKE_TRANSPARENT,lineWidth:2,fillStyle:"rgba(254, 180, 32, 0.2)",strokeStyle:"transparent",paintMode:"strokeAndFill",fontFamily:"consolas",fontSize:40}]])},ri={value:{lineWidth:2,fillStyle:"rgba(245, 236, 73, 0.3)",strokeStyle:"rgba(245, 236, 73, 1)",paintMode:"stroke",fontFamily:"consolas",fontSize:40}},"undefined"!=typeof document&&"undefined"!=typeof window&&(He.StaticCanvas.prototype.dispose=function(){return this.isRendering&&(He.util.cancelAnimFrame(this.isRendering),this.isRendering=0),this.forEachObject((function(e){e.dispose&&e.dispose()})),this._objects=[],this.backgroundImage&&this.backgroundImage.dispose&&this.backgroundImage.dispose(),this.backgroundImage=null,this.overlayImage&&this.overlayImage.dispose&&this.overlayImage.dispose(),this.overlayImage=null,this._iTextInstances=null,this.contextContainer=null,this.lowerCanvasEl.classList.remove("lower-canvas"),delete this._originalCanvasStyle,this.lowerCanvasEl.setAttribute("width",this.width),this.lowerCanvasEl.setAttribute("height",this.height),He.util.cleanUpJsdomNode(this.lowerCanvasEl),this.lowerCanvasEl=void 0,this},He.Object.prototype.transparentCorners=!1,He.Object.prototype.cornerSize=20,He.Object.prototype.touchCornerSize=100,He.Object.prototype.cornerColor="rgb(254,142,20)",He.Object.prototype.cornerStyle="circle",He.Object.prototype.strokeUniform=!0,He.Object.prototype.hasBorders=!1,He.Canvas.prototype.containerClass="",He.Canvas.prototype.getPointer=function(e,t){if(this._absolutePointer&&!t)return this._absolutePointer;if(this._pointer&&t)return this._pointer;var i,n=this.upperCanvasEl,r=He.util.getPointer(e,n),s=n.getBoundingClientRect(),o=s.width||0,a=s.height||0;o&&a||("top"in s&&"bottom"in s&&(a=Math.abs(s.top-s.bottom)),"right"in s&&"left"in s&&(o=Math.abs(s.right-s.left))),this.calcOffset(),r.x=r.x-this._offset.left,r.y=r.y-this._offset.top,t||(r=this.restorePointerVpt(r));var l=this.getRetinaScaling();if(1!==l&&(r.x/=l,r.y/=l),0!==o&&0!==a){var c=window.getComputedStyle(n).objectFit,h=n.width,u=n.height,d=o,f=a;i={width:h/d,height:u/f};var g,p,m=h/u,_=d/f;return"contain"===c?m>_?(g=d,p=d/m,{x:r.x*i.width,y:(r.y-(f-p)/2)*i.width}):(g=f*m,p=f,{x:(r.x-(d-g)/2)*i.height,y:r.y*i.height}):"cover"===c?m>_?{x:(h-i.height*d)/2+r.x*i.height,y:r.y*i.height}:{x:r.x*i.width,y:(u-i.width*f)/2+r.y*i.width}:{x:r.x*i.width,y:r.y*i.height}}return i={width:1,height:1},{x:r.x*i.width,y:r.y*i.height}},He.Canvas.prototype._onTouchStart=function(e){var t=this.findTarget(e);!this.allowTouchScrolling&&e.cancelable&&e.preventDefault&&e.preventDefault(),t&&e.cancelable&&e.preventDefault&&e.preventDefault(),null===this.mainTouchId&&(this.mainTouchId=this.getPointerId(e)),this.__onMouseDown(e),this._resetTransformEventData();var i=this.upperCanvasEl,n=this._getEventPrefix();He.util.addListener(He.document,"touchend",this._onTouchEnd,{passive:!1}),He.util.addListener(He.document,"touchmove",this._onMouseMove,{passive:!1}),He.util.removeListener(i,n+"down",this._onMouseDown)},He.Textbox.prototype._wrapLine=function(e,t,i,n){const r=e.match(/[\u3040-\u30ff\u3400-\u4dbf\u4e00-\u9fff\uf900-\ufaff\uff66-\uff9f]/g),s=!(!r||!r.length);var o=0,a=this.splitByGrapheme||s,l=[],c=[],h=a?He.util.string.graphemeSplit(e):e.split(this._wordJoiners),u="",d=0,f=a?"":" ",g=0,p=0,m=0,_=!0,v=this._getWidthOfCharSpacing();n=n||0,0===h.length&&h.push([]),i-=n;for(var y=0;y<h.length;y++)u=a?h[y]:He.util.string.graphemeSplit(h[y]),g=this._measureWord(u,t,d),d+=u.length,(o+=p+g-v)>i&&!_?(l.push(c),c=[],o=g,_=!0):o+=v,_||a||c.push(f),c=c.concat(u),p=a?0:this._measureWord([f],t,d),d++,_=!1,g>m&&(m=g);return y&&l.push(c),m+n>this.dynamicMinWidth&&(this.dynamicMinWidth=m-v+n),l});class ji{get width(){return this.fabricCanvas.width}get height(){return this.fabricCanvas.height}set _allowMultiSelect(e){this.fabricCanvas.selection=e,this.fabricCanvas.renderAll()}get _allowMultiSelect(){return this.fabricCanvas.selection}constructor(e,t,i){let n,r;switch(this.mapMediaType_Style=new Map,this.mapType_StateAndStyleId=new Map,this.mode="viewer",this.onSelectionChanged=null,this._arrDrwaingItem=[],this._arrFabricObject=[],this._visible=!0,e.hasOwnProperty("getFabricCanvas")?this.fabricCanvas=e.getFabricCanvas():(this.fabricCanvas=new He.Canvas(e,Object.assign(i,{allowTouchScrolling:!0,selection:!1})),this.fabricCanvas.setDimensions({width:"100%",height:"100%"},{cssOnly:!0}),this.fabricCanvas.lowerCanvasEl.className="",this.fabricCanvas.upperCanvasEl.className="",this.fabricCanvas.on("selection:created",(function(e){const t=e.selected,i=[];for(let n of t){const e=n.getDrawingItem()._drawingLayer;e&&!i.includes(e)&&i.push(e)}for(let n of i){const e=[];for(let i of t){const t=i.getDrawingItem();t._drawingLayer===n&&e.push(t)}setTimeout((()=>{n.onSelectionChanged&&n.onSelectionChanged(e,[])}),0)}})),this.fabricCanvas.on("before:selection:cleared",(function(e){const t=this.getActiveObjects(),i=[];for(let n of t){const e=n.getDrawingItem()._drawingLayer;e&&!i.includes(e)&&i.push(e)}for(let n of i){const e=[];for(let i of t){const t=i.getDrawingItem();t._drawingLayer===n&&e.push(t)}setTimeout((()=>{const t=[];for(let i of e)n.hasDrawingItem(i)&&t.push(i);t.length>0&&n.onSelectionChanged&&n.onSelectionChanged([],t)}),0)}})),this.fabricCanvas.on("selection:updated",(function(e){const t=e.selected,i=e.deselected,n=[];for(let r of t){const e=r.getDrawingItem()._drawingLayer;e&&!n.includes(e)&&n.push(e)}for(let r of i){const e=r.getDrawingItem()._drawingLayer;e&&!n.includes(e)&&n.push(e)}for(let r of n){const e=[],n=[];for(let i of t){const t=i.getDrawingItem();t._drawingLayer===r&&e.push(t)}for(let t of i){const e=t.getDrawingItem();e._drawingLayer===r&&n.push(e)}setTimeout((()=>{r.onSelectionChanged&&r.onSelectionChanged(e,n)}),0)}})),this.fabricCanvas.wrapperEl.style.position="absolute",e.getFabricCanvas=()=>this.fabricCanvas),this.id=t,t){case ji.DDN_LAYER_ID:n=Bi.getDrawingStyle(Bi.STYLE_BLUE_STROKE),r=Bi.getDrawingStyle(Bi.STYLE_BLUE_STROKE_FILL);break;case ji.DBR_LAYER_ID:n=Bi.getDrawingStyle(Bi.STYLE_ORANGE_STROKE),r=Bi.getDrawingStyle(Bi.STYLE_ORANGE_STROKE_FILL);break;case ji.DLR_LAYER_ID:n=Bi.getDrawingStyle(Bi.STYLE_GREEN_STROKE),r=Bi.getDrawingStyle(Bi.STYLE_GREEN_STROKE_FILL);break;default:n=Bi.getDrawingStyle(Bi.STYLE_YELLOW_STROKE),r=Bi.getDrawingStyle(Bi.STYLE_YELLOW_STROKE_FILL)}for(let s of It.arrMediaTypes)this.mapType_StateAndStyleId.set(s,{default:n.id,selected:r.id})}getId(){return this.id}setVisible(e){if(e){for(let e of this._arrFabricObject)e.visible=!0,e.hasControls=!0;this._visible=!0}else{for(let e of this._arrFabricObject)e.visible=!1,e.hasControls=!1;this._visible=!1}this.fabricCanvas.renderAll()}isVisible(){return this._visible}_getItemCurrentStyleId(e){return e.styleId?e.styleId:this.mapType_StateAndStyleId.get(e._mediaType)[e.styleSelector]}_getItemCurrentStyle(e){if(e.styleId)return Bi.getDrawingStyle(e.styleId);return Bi.getDrawingStyle(e._mapState_StyleId.get(e.styleSelector))||null}_changeMediaTypeCurStyleInStyleSelector(e,t,i,n){const r=this.getDrawingItems((t=>t._mediaType===e));for(let s of r)s.styleSelector===t&&this._changeItemStyle(s,i,!0);n||this.fabricCanvas.renderAll()}_changeItemStyle(e,t,i){if(!e||!t)return;const n=e._getFabricObject();"number"==typeof e.styleId&&(t=Bi.getDrawingStyle(e.styleId)),n.strokeWidth=t.lineWidth,"fill"===t.paintMode?(n.fill=t.fillStyle,n.stroke=t.fillStyle):"stroke"===t.paintMode?(n.fill="transparent",n.stroke=t.strokeStyle):"strokeAndFill"===t.paintMode&&(n.fill=t.fillStyle,n.stroke=t.strokeStyle),n.fontFamily&&(n.fontFamily=t.fontFamily),n.fontSize&&(n.fontSize=t.fontSize),n.group||(n.dirty=!0),i||this.fabricCanvas.renderAll()}_updateGroupItem(e,t,i){if(!e||!t)return;const n=e.getChildDrawingItems();if("add"===i){if(n.includes(t))return;const i=t._getFabricObject();if(this.fabricCanvas.getObjects().includes(i)){if(!this._arrFabricObject.includes(i))throw new Error("Existed in other drawing layers.");t._zIndex=null}else{let i;if(t.styleId)i=Bi.getDrawingStyle(t.styleId);else{const n=this.mapType_StateAndStyleId.get(t._mediaType);i=Bi.getDrawingStyle(n[e.styleSelector]);const r=()=>{this._changeItemStyle(t,Bi.getDrawingStyle(this.mapType_StateAndStyleId.get(t._mediaType).selected),!0)},s=()=>{this._changeItemStyle(t,Bi.getDrawingStyle(this.mapType_StateAndStyleId.get(t._mediaType).default),!0)};t._on("selected",r),t._on("deselected",s),t._funcChangeStyleToSelected=r,t._funcChangeStyleToDefault=s}t._drawingLayer=this,t._drawingLayerId=this.id,this._changeItemStyle(t,i,!0)}e._fabricObject.addWithUpdate(t._getFabricObject())}else{if("remove"!==i)return;if(!n.includes(t))return;t._zIndex=null,t._drawingLayer=null,t._drawingLayerId=null,t._off("selected",t._funcChangeStyleToSelected),t._off("deselected",t._funcChangeStyleToDefault),t._funcChangeStyleToSelected=null,t._funcChangeStyleToDefault=null,e._fabricObject.removeWithUpdate(t._getFabricObject())}this.fabricCanvas.renderAll()}_addDrawingItem(e,t){if(!(e instanceof It))throw new TypeError("Invalid 'drawingItem'.");if(e._drawingLayer){if(e._drawingLayer==this)return;throw new Error("This drawing item has existed in other layer.")}let i=e._getFabricObject();const n=this.fabricCanvas.getObjects();let r,s;if(n.includes(i)){if(this._arrFabricObject.includes(i))return;throw new Error("Existed in other drawing layers.")}if("group"===e._mediaType){r=e.getChildDrawingItems();for(let e of r)if(e._drawingLayer&&e._drawingLayer!==this)throw new Error("The childItems of DT_Group have existed in other drawing layers.")}if(t&&"object"==typeof t&&!Array.isArray(t))for(let l in t)i.set(l,t[l]);if(r){for(let e of r){const t=this.mapType_StateAndStyleId.get(e._mediaType);for(let i of It.arrStyleSelectors)e._mapState_StyleId.set(i,t[i]);if(e.styleId)s=Bi.getDrawingStyle(e.styleId);else{s=Bi.getDrawingStyle(t.default);const i=()=>{this._changeItemStyle(e,Bi.getDrawingStyle(this.mapType_StateAndStyleId.get(e._mediaType).selected),!0)},n=()=>{this._changeItemStyle(e,Bi.getDrawingStyle(this.mapType_StateAndStyleId.get(e._mediaType).default),!0)};e._on("selected",i),e._on("deselected",n),e._funcChangeStyleToSelected=i,e._funcChangeStyleToDefault=n}e._drawingLayer=this,e._drawingLayerId=this.id,this._changeItemStyle(e,s,!0)}i.dirty=!0,this.fabricCanvas.renderAll()}else{const t=this.mapType_StateAndStyleId.get(e._mediaType);for(let i of It.arrStyleSelectors)e._mapState_StyleId.set(i,t[i]);if(e.styleId)s=Bi.getDrawingStyle(e.styleId);else{s=Bi.getDrawingStyle(t.default);const i=()=>{this._changeItemStyle(e,Bi.getDrawingStyle(this.mapType_StateAndStyleId.get(e._mediaType).selected))},n=()=>{this._changeItemStyle(e,Bi.getDrawingStyle(this.mapType_StateAndStyleId.get(e._mediaType).default))};e._on("selected",i),e._on("deselected",n),e._funcChangeStyleToSelected=i,e._funcChangeStyleToDefault=n}this._changeItemStyle(e,s)}e._zIndex=this.id,e._drawingLayer=this,e._drawingLayerId=this.id;const o=this._arrFabricObject.length;let a=n.length;if(o)a=n.indexOf(this._arrFabricObject[o-1])+1;else for(let l=0;l<n.length;l++)if(e._zIndex<n[l].getDrawingItem()._zIndex){a=l;break}this._arrDrwaingItem.push(e),this._arrFabricObject.push(i),this._visible?i.visible=!0:i.visible=!1,this.fabricCanvas.insertAt(i,a,!1)}addDrawingItem(e){if(!e||!e.isDrawingItem)throw TypeError("Illegal drawing item.");if("viewer"===this.mode)e._setEditable(!1);else{if("editor"!==this.mode)throw new Error("Illegal 'mode'.");e._setEditable(!0)}this._addDrawingItem(e),e.updatePosition()}addDrawingItems(e){for(let t of e)this.addDrawingItem(t)}removeDrawingItem(e){if(!e||!e.isDrawingItem)throw TypeError("Illegal drawing item.");if(!this.hasDrawingItem(e))return;if(e._zIndex=null,e._drawingLayer=null,e._drawingLayerId=null,"group"===e._mediaType){const t=e.getChildDrawingItems();for(let e of t)e._zIndex=null,e._drawingLayer=null,e._drawingLayerId=null,e._off("selected",e._funcChangeStyleToSelected),e._off("deselected",e._funcChangeStyleToDefault),e._funcChangeStyleToSelected=null,e._funcChangeStyleToDefault=null,e._mapState_StyleId.clear()}else e._off("selected",e._funcChangeStyleToSelected),e._off("deselected",e._funcChangeStyleToDefault),e._funcChangeStyleToSelected=null,e._funcChangeStyleToDefault=null,e._mapState_StyleId.clear();const t=e._getFabricObject();"selected"===e.styleSelector&&(t.group?t.group.removeWithUpdate(t):this.fabricCanvas._activeObject=null,e.setState(mt.DIS_DEFAULT)),this.fabricCanvas.remove(t),this._arrDrwaingItem.splice(this._arrDrwaingItem.indexOf(e),1),this._arrFabricObject.splice(this._arrFabricObject.indexOf(t),1)}removeDrawingItems(e){for(let t of e)this.removeDrawingItem(t)}setDrawingItems(e){this.clearDrawingItems(),this.addDrawingItems(e)}getDrawingItems(e){return e&&"function"==typeof e?this._arrDrwaingItem.filter(e):Array.from(this._arrDrwaingItem)}getSelectedDrawingItems(){const e=this.fabricCanvas.getActiveObjects(),t=[];for(let i of e)this._arrFabricObject.includes(i)&&t.push(i.getDrawingItem());return t}hasDrawingItem(e){if(!e||!e.isDrawingItem)throw TypeError("Illegal drawing item.");return this._arrDrwaingItem.includes(e)}clearDrawingItems(){this.removeDrawingItems(Array.from(this._arrDrwaingItem))}_setDefaultStyle(e,t,i){t?t.forEach((e=>e.toLowerCase())):t=It.arrMediaTypes,i?i.forEach((e=>e.toLowerCase())):i=It.arrStyleSelectors;const n=Bi.getDrawingStyle(e);if(!n)throw new Error("The 'drawingStyle' with id '".concat(e,"' doesn't exist."));let r;for(let s of t)if(r=this.mapType_StateAndStyleId.get(s),r)for(let t of i){this._changeMediaTypeCurStyleInStyleSelector(s,t,n,!0),r[t]=e;for(let i of this._arrDrwaingItem)i._mediaType===s&&i._mapState_StyleId.set(t,e)}this.fabricCanvas.renderAll()}setDefaultStyle(e,t,i){const n=[];i&pt.DIMT_RECTANGLE&&n.push("rect"),i&pt.DIMT_QUADRILATERAL&&n.push("quad"),i&pt.DIMT_TEXT&&n.push("text"),i&pt.DIMT_ARC&&n.push("arc"),i&pt.DIMT_IMAGE&&n.push("image"),i&pt.DIMT_POLYGON&&n.push("polygon"),i&pt.DIMT_LINE&&n.push("line");const r=[];t&mt.DIS_DEFAULT&&r.push("default"),t&mt.DIS_SELECTED&&r.push("selected"),this._setDefaultStyle(e,n.length?n:null,r.length?r:null)}setMode(e){if("viewer"===(e=e.toLowerCase())){for(let e of this._arrDrwaingItem)e._setEditable(!1);this.fabricCanvas.discardActiveObject(),this.fabricCanvas.renderAll(),this.mode="viewer"}else{if("editor"!==e)throw new RangeError("Invalid value.");for(let e of this._arrDrwaingItem)e._setEditable(!0);this.mode="editor"}this._manager._switchPointerEvent()}getMode(){return this.mode}_setDimensions(e,t){this.fabricCanvas.setDimensions(e,t)}_setObjectFit(e){if(e=e.toLowerCase(),!["contain","cover"].includes(e))throw new Error("Unsupported value '".concat(e,"'."));this.fabricCanvas.lowerCanvasEl.style.objectFit=e,this.fabricCanvas.upperCanvasEl.style.objectFit=e}_getObjectFit(){return this.fabricCanvas.lowerCanvasEl.style.objectFit}renderAll(){for(let e of this._arrDrwaingItem){const t=this._getItemCurrentStyle(e);this._changeItemStyle(e,t,!0)}this.fabricCanvas.renderAll()}dispose(){this.clearDrawingItems(),1===this._manager._arrDrawingLayer.length&&(this.fabricCanvas.wrapperEl.style.pointerEvents="none",this.fabricCanvas.dispose(),this._arrDrwaingItem.length=0,this._arrFabricObject.length=0)}}ji.DDN_LAYER_ID=1,ji.DBR_LAYER_ID=2,ji.DLR_LAYER_ID=3,ji.USER_DEFINED_LAYER_BASE_ID=100,ji.TIP_LAYER_ID=999;class Ui{constructor(){this._arrDrawingLayer=[]}createDrawingLayer(e,t){if(this.getDrawingLayer(t))throw new Error("Existed drawing layer id.");const i=new ji(e,t,{enableRetinaScaling:!1});return i._manager=this,this._arrDrawingLayer.push(i),this._switchPointerEvent(),i}deleteDrawingLayer(e){const t=this.getDrawingLayer(e);if(!t)return;const i=this._arrDrawingLayer;t.dispose(),i.splice(i.indexOf(t),1),this._switchPointerEvent()}clearDrawingLayers(){for(let e of this._arrDrawingLayer)e.dispose();this._arrDrawingLayer.length=0}getDrawingLayer(e){for(let t of this._arrDrawingLayer)if(t.getId()===e)return t;return null}getAllDrawingLayers(){return Array.from(this._arrDrawingLayer)}getSelectedDrawingItems(){if(!this._arrDrawingLayer.length)return;const e=this._arrDrawingLayer[0].fabricCanvas.getActiveObjects(),t=[];for(let i of e)t.push(i.getDrawingItem());return t}setDimensions(e,t){this._arrDrawingLayer.length&&this._arrDrawingLayer[0]._setDimensions(e,t)}setObjectFit(e){for(let t of this._arrDrawingLayer)t&&t._setObjectFit(e)}getObjectFit(){return this._arrDrawingLayer.length?this._arrDrawingLayer[0]._getObjectFit():null}setVisible(e){this._arrDrawingLayer.length&&(this._arrDrawingLayer[0].fabricCanvas.wrapperEl.style.display=e?"block":"none")}_switchPointerEvent(){if(this._arrDrawingLayer.length)for(let e of this._arrDrawingLayer)e.getMode()}}class Vi extends ei{constructor(e,t,i,n,r){super(e,{x:t,y:i,width:n,height:0},r),si.set(this,void 0),oi.set(this,void 0),this._fabricObject.paddingTop=15,this._fabricObject.calcTextHeight=function(){for(var e=0,t=0,i=this._textLines.length;t<i;t++)e+=this.getHeightOfLine(t);return e+2*this.paddingTop},this._fabricObject._getTopOffset=function(){return-this.height/2+this.getHeightOfLine(0)*(1-1/this.lineHeight)/2+this.paddingTop},this.set("backgroundColor","rgba(50, 50, 52, .8)"),this.set("lineHeight",1.3),this.set("textAlign","center")}setDuration(e){st(this,si,e,"f"),rt(this,oi,"f")&&clearTimeout(rt(this,oi,"f")),rt(this,si,"f")>=0&&st(this,oi,setTimeout((()=>{this.set("visible",!1),this._drawingLayer&&this._drawingLayer.renderAll()}),rt(this,si,"f")),"f")}getDuration(){return rt(this,si,"f")}}si=new WeakMap,oi=new WeakMap;class Gi{constructor(){ai.add(this),li.set(this,void 0),ci.set(this,void 0),hi.set(this,void 0),ui.set(this,!0),this._drawingLayersManager=new Ui}createDrawingLayerBaseCvs(e,t){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"contain";if("number"!=typeof e||e<=1)throw new Error("Invalid 'width'.");if("number"!=typeof t||t<=1)throw new Error("Invalid 'height'.");if(!["contain","cover"].includes(i))throw new Error("Unsupported 'objectFit'.");const n=document.createElement("canvas");return n.width==e&&n.height==t||(n.width=e,n.height=t),n.style.objectFit=i,n}_createDrawingLayer(e,t,i,n){if(!this._layerBaseCvs){let r;try{r=this.getContentDimensions()}catch(e){if("Invalid content dimensions."!==(e.message||e))throw e}t||(t=(null==r?void 0:r.width)||1280),i||(i=(null==r?void 0:r.height)||720),n||(n=(null==r?void 0:r.objectFit)||"contain"),this._layerBaseCvs=this.createDrawingLayerBaseCvs(t,i,n)}const r=this._layerBaseCvs,s=this._drawingLayersManager.createDrawingLayer(r,e);return this._innerComponent.getElement("drawing-layer")||this._innerComponent.setElement("drawing-layer",r.parentElement),s}createDrawingLayer(){let e;for(let t=ji.USER_DEFINED_LAYER_BASE_ID;;t++)if(!this._drawingLayersManager.getDrawingLayer(t)&&t!==ji.TIP_LAYER_ID){e=t;break}return this._createDrawingLayer(e)}deleteDrawingLayer(e){var t;this._drawingLayersManager.deleteDrawingLayer(e),this._drawingLayersManager.getAllDrawingLayers().length||(null===(t=this._innerComponent)||void 0===t||t.removeElement("drawing-layer"),this._layerBaseCvs=null)}deleteUserDefinedDrawingLayer(e){if("number"!=typeof e)throw new TypeError("Invalid id.");if(e<ji.USER_DEFINED_LAYER_BASE_ID)throw new Error("The drawing layer with id ".concat(e," is not defined by users."));this.deleteDrawingLayer(e)}_clearDrawingLayers(){const e=this.getAllDrawingLayers();for(let t of e)this.deleteDrawingLayer(t.getId())}clearUserDefinedDrawingLayers(){const e=this.getAllDrawingLayers();for(let t of e){const e=t.getId();e<ji.USER_DEFINED_LAYER_BASE_ID||this.deleteUserDefinedDrawingLayer(e)}}getDrawingLayer(e){if(e==ji.TIP_LAYER_ID)return null;return this._drawingLayersManager.getDrawingLayer(e)||([ji.DDN_LAYER_ID,ji.DBR_LAYER_ID,ji.DLR_LAYER_ID].includes(e)?this._createDrawingLayer(e):null)}getAllDrawingLayers(){return this._drawingLayersManager.getAllDrawingLayers().filter((e=>e.getId()>=0&&e.getId()!==ji.TIP_LAYER_ID))}updateDrawingLayers(e){((e,t,i)=>{if(!(e<=1||t<=1)){if(!["contain","cover"].includes(i))throw new Error("Unsupported 'objectFit'.");this._drawingLayersManager.setDimensions({width:e,height:t},{backstoreOnly:!0}),this._drawingLayersManager.setObjectFit(i)}})(e.width,e.height,e.objectFit)}getSelectedDrawingItems(){return this._drawingLayersManager.getSelectedDrawingItems()}setTipConfig(e){if(!(At(t=e)&&Lt(t.topLeftPoint)&&yt(t.width))||t.width<=0||!yt(t.duration)||"coordinateBase"in t&&!["view","image"].includes(t.coordinateBase))throw new Error("Invalid tip config.");var t;st(this,li,JSON.parse(JSON.stringify(e)),"f"),rt(this,li,"f").coordinateBase||(rt(this,li,"f").coordinateBase="view"),st(this,hi,e.duration,"f"),rt(this,ai,"m",pi).call(this)}getTipConfig(){return rt(this,li,"f")?rt(this,li,"f"):null}setTipVisible(e){if("boolean"!=typeof e)throw new TypeError("Invalid value.");this._tip&&(this._tip.set("visible",e),this._drawingLayerOfTip&&this._drawingLayerOfTip.renderAll()),st(this,ui,e,"f")}isTipVisible(){return rt(this,ui,"f")}updateTipMessage(e){if(!rt(this,li,"f"))throw new Error("Tip config is not set.");this._tipStyleId||(this._tipStyleId=Bi.createDrawingStyle({fillStyle:"#FFFFFF",paintMode:"fill",fontFamily:"Open Sans",fontSize:40})),this._drawingLayerOfTip||(this._drawingLayerOfTip=this._drawingLayersManager.getDrawingLayer(ji.TIP_LAYER_ID)||this._createDrawingLayer(ji.TIP_LAYER_ID)),this._tip?this._tip.set("text",e):this._tip=rt(this,ai,"m",di).call(this,e,rt(this,li,"f").topLeftPoint.x,rt(this,li,"f").topLeftPoint.y,rt(this,li,"f").width,rt(this,li,"f").coordinateBase,this._tipStyleId),rt(this,ai,"m",fi).call(this,this._tip,this._drawingLayerOfTip),this._tip.set("visible",rt(this,ui,"f")),this._drawingLayerOfTip&&this._drawingLayerOfTip.renderAll(),rt(this,ci,"f")&&clearTimeout(rt(this,ci,"f")),rt(this,hi,"f")>=0&&st(this,ci,setTimeout((()=>{rt(this,ai,"m",gi).call(this)}),rt(this,hi,"f")),"f")}}li=new WeakMap,ci=new WeakMap,hi=new WeakMap,ui=new WeakMap,ai=new WeakSet,di=function(e,t,i,n,r,s){const o=new Vi(e,t,i,n,s);return o.coordinateBase=r,o},fi=function(e,t){t.hasDrawingItem(e)||t.addDrawingItems([e])},gi=function(){this._tip&&this._drawingLayerOfTip.removeDrawingItems([this._tip])},pi=function(){if(!this._tip)return;const e=rt(this,li,"f");this._tip.coordinateBase=e.coordinateBase,this._tip.setTextRect({x:e.topLeftPoint.x,y:e.topLeftPoint.y,width:e.width,height:0}),this._tip.set("width",this._tip.get("width")),this._tip._drawingLayer&&this._tip._drawingLayer.renderAll()};class Wi extends HTMLElement{constructor(){super(),mi.set(this,void 0);const e=document.createElement("template").content,t=document.createElement("div");t.setAttribute("class","wrapper"),e.appendChild(t),st(this,mi,t,"f");const i=document.createElement("slot");i.setAttribute("name","single-frame-input-container"),t.append(i);const n=document.createElement("slot");n.setAttribute("name","content"),t.append(n);const r=document.createElement("slot");r.setAttribute("name","drawing-layer"),t.append(r);const s=document.createElement("style");s.textContent='\n.wrapper {\n  position: relative;\n  width: 100%;\n  height: 100%;\n}\n::slotted(canvas[slot="content"]) {\n  object-fit: contain;\n  pointer-events: none;\n}\n::slotted(div[slot="single-frame-input-container"]) {\n  width: 1px;\n  height: 1px;\n  overflow: hidden;\n  pointer-events: none;\n}\n::slotted(*) {\n  position: absolute;\n  left: 0;\n  top: 0;\n  width: 100%;\n  height: 100%;\n}\n    ',e.appendChild(s),this.attachShadow({mode:"open"}).appendChild(e.cloneNode(!0))}getWrapper(){return rt(this,mi,"f")}setElement(e,t){if(!(t instanceof HTMLElement))throw new TypeError("Invalid 'el'.");if(!["content","single-frame-input-container","drawing-layer"].includes(e))throw new TypeError("Invalid 'slot'.");this.removeElement(e),t.setAttribute("slot",e),this.appendChild(t)}getElement(e){if(!["content","single-frame-input-container","drawing-layer"].includes(e))throw new TypeError("Invalid 'slot'.");return this.querySelector('[slot="'.concat(e,'"]'))}removeElement(e){var t;if(!["content","single-frame-input-container","drawing-layer"].includes(e))throw new TypeError("Invalid 'slot'.");null===(t=this.querySelectorAll('[slot="'.concat(e,'"]')))||void 0===t||t.forEach((e=>e.remove()))}}mi=new WeakMap,customElements.get("dce-component")||customElements.define("dce-component",Wi);class zi extends HTMLElement{constructor(){super();const e=window._dce_default_template.content;this.attachShadow({mode:"open"}).appendChild(e.cloneNode(!0))}showScanLaser(){const e=this.shadowRoot.querySelector(".dce-scanlight");e&&(e.style.display="")}hideScanLaser(){const e=this.shadowRoot.querySelector(".dce-scanlight");e&&(e.style.display="none")}getElement(e){return this.shadowRoot.querySelector(e)}getVideoContainer(){return this.shadowRoot.querySelector(".dce-video-container")}getScanAreaEl(){return this.shadowRoot.querySelector(".dce-scanarea")}getScanLightEl(){return this.shadowRoot.querySelector(".dce-scanlight")}getLoadingBackgroundEl(){return this.shadowRoot.querySelector(".dce-bg-loading")}getCameraBackgroundEl(){return this.shadowRoot.querySelector(".dce-bg-camera")}getCameraSelectEl(){return this.shadowRoot.querySelector(".dce-sel-camera")}getResolutionSelectEl(){return this.shadowRoot.querySelector(".dce-sel-resolution")}getResolutionOptionEl(){return this.shadowRoot.querySelector(".dce-opt-gotResolution")}getCloseBtnEl(){return this.shadowRoot.querySelector(".dce-btn-close")}getDLRSelectEl(){return this.shadowRoot.querySelector(".dlr-sel-minletter")}getDLROptionEl(){return this.shadowRoot.querySelector(".dlr-opt-gotMinLtr")}}class Hi extends Gi{static get engineResourcePath(){return te.engineResourcePaths.dce}static set defaultUIElementURL(e){Hi._defaultUIElementURL=e}static get defaultUIElementURL(){var e;return null===(e=Hi._defaultUIElementURL)||void 0===e?void 0:e.replace("@engineResourcePath/",Hi.engineResourcePath)}static async createInstance(e){customElements.get(Hi.uiComponentName)||customElements.define(Hi.uiComponentName,zi);const t=new Hi;return await t.setUIElement(e||Hi.defaultUIElementURL),t}static _transformCoordinates(e,t,i,n,r,s,o){const a=s/n,l=o/r;e.x=Math.round(e.x/a+t),e.y=Math.round(e.y/l+i)}set _singleFrameMode(e){if(!["disabled","image","camera"].includes(e))throw new Error("Invalid value.");e!==rt(this,xi,"f")&&(this._unbindUI(),st(this,xi,e,"f"),this._bindUI())}get _singleFrameMode(){return rt(this,xi,"f")}get disposed(){return rt(this,Ai,"f")}constructor(){var e;super(),e=this,_i.add(this),vi.set(this,void 0),yi.set(this,void 0),wi.set(this,void 0),this.containerClassName="dce-video-container",bi.set(this,void 0),this.videoFit="contain",this._hideDefaultSelection=!1,this._divScanArea=null,this._divScanLight=null,this._bgLoading=null,this._selCam=null,this._bgCamera=null,this._selRsl=null,this._optGotRsl=null,this._btnClose=null,this._selMinLtr=null,this._optGotMinLtr=null,Ci.set(this,null),this.regionMaskFillStyle="rgba(0,0,0,0.5)",this.regionMaskStrokeStyle="rgb(254,142,20)",this.regionMaskLineWidth=6,Si.set(this,!1),Ei.set(this,!1),Ti.set(this,{width:0,height:0}),this._updateLayersTimeout=500,this._videoResizeListener=()=>{rt(this,_i,"m",Mi).call(this),this._updateLayersTimeoutId&&clearTimeout(this._updateLayersTimeoutId),this._updateLayersTimeoutId=setTimeout((()=>{this.disposed||(this.eventHandler.fire("videoEl:resized",null,{async:!1}),this.eventHandler.fire("content:updated",null,{async:!1}),this.isScanLaserVisible()&&rt(this,_i,"m",ki).call(this))}),this._updateLayersTimeout)},this._windowResizeListener=()=>{Hi._onLog&&Hi._onLog("window resize event triggered."),rt(this,Ti,"f").width===document.documentElement.clientWidth&&rt(this,Ti,"f").height===document.documentElement.clientHeight||(rt(this,Ti,"f").width=document.documentElement.clientWidth,rt(this,Ti,"f").height=document.documentElement.clientHeight,this._videoResizeListener())},xi.set(this,"disabled"),this._clickIptSingleFrameMode=()=>{if(!rt(this,_i,"m",Oi).call(this))return;let e;if(this._singleFrameInputContainer)e=this._singleFrameInputContainer.firstElementChild;else{e=document.createElement("input"),e.setAttribute("type","file"),"camera"===this._singleFrameMode?(e.setAttribute("capture",""),e.setAttribute("accept","image/*")):"image"===this._singleFrameMode&&(e.removeAttribute("capture"),e.setAttribute("accept",".jpg,.jpeg,.icon,.gif,.svg,.webp,.png,.bmp")),e.addEventListener("change",(async()=>{const t=e.files[0];e.value="";{const e=async e=>{let t=null,i=null;if("undefined"!=typeof createImageBitmap)try{if(t=await createImageBitmap(e),t)return t}catch(e){}var n;return t||(i=await(n=e,new Promise(((e,t)=>{let i=URL.createObjectURL(n),r=new Image;r.src=i,r.onload=()=>{URL.revokeObjectURL(r.src),e(r)},r.onerror=e=>{t(new Error("Can't convert blob to image : "+(e instanceof Event?e.type:e)))}})))),i},i=(e,t,i,n)=>{e.width==i&&e.height==n||(e.width=i,e.height=n);const r=e.getContext("2d");r.clearRect(0,0,e.width,e.height),r.drawImage(t,0,0)},n=await e(t),r=n instanceof HTMLImageElement?n.naturalWidth:n.width,s=n instanceof HTMLImageElement?n.naturalHeight:n.height;let o=this._cvsSingleFrameMode;const a=null==o?void 0:o.width,l=null==o?void 0:o.height;o||(o=document.createElement("canvas"),this._cvsSingleFrameMode=o),i(o,n,r,s),this._innerComponent.setElement("content",o),a===o.width&&l===o.height||this.eventHandler.fire("content:updated",null,{async:!1})}this._onSingleFrameAcquired&&setTimeout((()=>{this._onSingleFrameAcquired(this._cvsSingleFrameMode)}),0)})),e.style.position="absolute",e.style.top="-9999px",e.style.backgroundColor="transparent",e.style.color="transparent";const t=document.createElement("div");t.append(e),this._innerComponent.setElement("single-frame-input-container",t),this._singleFrameInputContainer=t}null==e||e.click()},this.extraBindings=[],Ii.set(this,[]),this._capturedResultReceiver={onCapturedResultReceived:(t,i)=>{var n,r,s,o;if(this.disposed)return;if(this.clearAllInnerDrawingItems(),!t)return;const a=t.originalImageTag;if(!a)return;const l=t.items;if(!(null==l?void 0:l.length))return;const c=(null===(n=a.cropRegion)||void 0===n?void 0:n.left)||0,h=(null===(r=a.cropRegion)||void 0===r?void 0:r.top)||0,u=(null===(s=a.cropRegion)||void 0===s?void 0:s.right)?a.cropRegion.right-c:a.originalWidth,d=(null===(o=a.cropRegion)||void 0===o?void 0:o.bottom)?a.cropRegion.bottom-h:a.originalHeight,f=a.currentWidth,g=a.currentHeight,p=function(t,i,n,r,s,o,a,l){let c=arguments.length>8&&void 0!==arguments[8]?arguments[8]:[],h=arguments.length>9?arguments[9]:void 0;i.forEach((e=>Hi._transformCoordinates(e,n,r,s,o,a,l)));const u=new Fi({points:[{x:i[0].x,y:i[0].y},{x:i[1].x,y:i[1].y},{x:i[2].x,y:i[2].y},{x:i[3].x,y:i[3].y}]},h);for(let e of c)u.addNote(e);t.addDrawingItems([u]),rt(e,Ii,"f").push(u)};let m,_;for(let e of l)switch(e.type){case ie.CRIT_ORIGINAL_IMAGE:break;case ie.CRIT_BARCODE:m=this.getDrawingLayer(ji.DBR_LAYER_ID),_=[{name:"format",content:e.formatString},{name:"text",content:e.text}],(null==i?void 0:i.isBarcodeVerifyOpen)?e.verified?p(m,e.location.points,c,h,u,d,f,g,_):p(m,e.location.points,c,h,u,d,f,g,_,Bi.STYLE_ORANGE_STROKE_TRANSPARENT):p(m,e.location.points,c,h,u,d,f,g,_);break;case ie.CRIT_TEXT_LINE:m=this.getDrawingLayer(ji.DLR_LAYER_ID),_=[{name:"text",content:e.text}],i.isLabelVerifyOpen?e.verified?p(m,e.location.points,c,h,u,d,f,g,_):p(m,e.location.points,c,h,u,d,f,g,_,Bi.STYLE_GREEN_STROKE_TRANSPARENT):p(m,e.location.points,c,h,u,d,f,g,_);break;case ie.CRIT_DETECTED_QUAD:m=this.getDrawingLayer(ji.DDN_LAYER_ID),(null==i?void 0:i.isDetectVerifyOpen)?e.verified?p(m,e.location.points,c,h,u,d,f,g,[]):p(m,e.location.points,c,h,u,d,f,g,[],Bi.STYLE_BLUE_STROKE_TRANSPARENT):p(m,e.location.points,c,h,u,d,f,g,[]);break;case ie.CRIT_NORMALIZED_IMAGE:m=this.getDrawingLayer(ji.DDN_LAYER_ID),(null==i?void 0:i.isNormalizeVerifyOpen)?e.verified?p(m,e.location.points,c,h,u,d,f,g,[]):p(m,e.location.points,c,h,u,d,f,g,[],Bi.STYLE_BLUE_STROKE_TRANSPARENT):p(m,e.location.points,c,h,u,d,f,g,[]);break;case ie.CRIT_PARSED_RESULT:break;default:throw new Error("Illegal item type.")}}},Ai.set(this,!1),this.eventHandler=new jt,this.eventHandler.on("content:updated",(()=>{rt(this,vi,"f")&&clearTimeout(rt(this,vi,"f")),st(this,vi,setTimeout((()=>{if(this.disposed)return;let e;this._updateVideoContainer();try{e=this.getContentDimensions()}catch(e){if("Invalid content dimensions."===(e.message||e))return;throw e}this.updateDrawingLayers(e),this.updateConvertedRegion(e)}),0),"f")})),this.eventHandler.on("videoEl:resized",(()=>{rt(this,yi,"f")&&clearTimeout(rt(this,yi,"f")),st(this,yi,setTimeout((()=>{this.disposed||this._updateVideoContainer()}),0),"f")}))}_setUIElement(e){e instanceof HTMLTemplateElement?(window._dce_default_template=e,this.UIElement=new zi):this.UIElement=e,this._unbindUI(),this._bindUI()}async setUIElement(e){let t;if(t="string"==typeof e?await Wt(e):e,t instanceof HTMLDivElement&&0==t.childElementCount){const e=await Wt(Hi.defaultUIElementURL);e instanceof HTMLTemplateElement?(window._dce_default_template=e,t.append(new zi)):t.append(e),this._setUIElement(t)}else this._setUIElement(t)}getUIElement(){return this.UIElement}_bindUI(){var e;if(!this.UIElement)throw new Error("Need to set 'UIElement'.");if(this._innerComponent)return;let t,i=this.UIElement;if(i instanceof zi?t=i.getElement(".".concat(this.containerClassName)):i instanceof HTMLDivElement&&1===i.childElementCount&&i.firstElementChild instanceof zi?(t=i.firstElementChild.getElement(".".concat(this.containerClassName)),i=i.firstElementChild):t=i.classList.contains(this.containerClassName)?i:i.querySelector(".".concat(this.containerClassName)),!t)throw Error("Can not find the element with class '".concat(this.containerClassName,"'."));if(this._innerComponent=new Wi,t.appendChild(this._innerComponent),rt(this,_i,"m",Oi).call(this));else{const e=document.createElement("video");e.style.position="absolute",e.style.left="0",e.style.top="0",e.style.width="100%",e.style.height="100%",e.style.objectFit=this.getVideoFit(),e.setAttribute("autoplay","true"),e.setAttribute("playsinline","true"),e.setAttribute("muted","true"),["iPhone","iPad","Mac"].includes(ht.OS)&&e.setAttribute("poster","data:image/gif;base64,R0lGODlhAQABAIEAAAAAAAAAAAAAAAAAACH5BAEAAAAALAAAAAABAAEAAAgEAAEEBAA7"),st(this,bi,e,"f");const t=document.createElement("div");t.append(e),t.style.overflow="hidden",this._videoContainer=t,this._innerComponent.setElement("content",t)}if(i instanceof zi?(this._selRsl=i.getElement(".dce-sel-resolution"),this._selMinLtr=i.getElement(".dlr-sel-minletter"),this._divScanArea=i.getElement(".dce-scanarea"),this._divScanLight=i.getElement(".dce-scanlight"),this._bgLoading=i.getElement(".dce-bg-loading"),this._bgCamera=i.getElement(".dce-bg-camera"),this._selCam=i.getElement(".dce-sel-camera"),this._optGotRsl=i.getElement(".dce-opt-gotResolution"),this._btnClose=i.getElement(".dce-btn-close"),this._optGotMinLtr=i.getElement(".dlr-opt-gotMinLtr")):(this._selRsl=i.querySelector(".dce-sel-resolution"),this._selMinLtr=i.querySelector(".dlr-sel-minletter"),this._divScanArea=i.querySelector(".dce-scanarea"),this._divScanLight=i.querySelector(".dce-scanlight"),this._bgLoading=i.querySelector(".dce-bg-loading"),this._bgCamera=i.querySelector(".dce-bg-camera"),this._selCam=i.querySelector(".dce-sel-camera"),this._optGotRsl=i.querySelector(".dce-opt-gotResolution"),this._btnClose=i.querySelector(".dce-btn-close"),this._optGotMinLtr=i.querySelector(".dlr-opt-gotMinLtr")),this._selRsl&&(this._hideDefaultSelection||rt(this,_i,"m",Oi).call(this)||this._selRsl.options.length||(this._selRsl.innerHTML=['<option class="dce-opt-gotResolution" value="got"></option>','<option data-width="1920" data-height="1080">ask 1920x1080</option>','<option data-width="1280" data-height="720">ask 1280x720</option>','<option data-width="640" data-height="480">ask 640x480</option>'].join(""),this._optGotRsl=this._selRsl.options[0])),this._selMinLtr&&(this._hideDefaultSelection||rt(this,_i,"m",Oi).call(this)||this._selMinLtr.options.length||(this._selMinLtr.innerHTML=['<option class="dlr-opt-gotMinLtr" value="got"></option>','<option value="0" selected>any letter</option>','<option value="3">3+ letters</option>','<option value="5">5+ letters</option>','<option value="8">8+ letters</option>','<option value="12">12+ letters</option>','<option value="17">17+ letters</option>','<option value="30">30+ letters</option>','<option value="50">50+ letters</option>','<option value="80">80+ letters</option>','<option value="120">120+ letters</option>'].join(""),this._optGotMinLtr=this._selMinLtr.options[0])),this.isScanLaserVisible()||rt(this,_i,"m",Mi).call(this),rt(this,_i,"m",Oi).call(this)||this._hideDefaultSelection?(rt(this,_i,"m",Oi).call(this)&&(this._innerComponent&&(this._innerComponent.addEventListener("click",this._clickIptSingleFrameMode),this._innerComponent.setAttribute("title","Take a photo")),this._bgCamera&&(this._bgCamera.style.display="block")),this._selCam&&(this._selCam.style.display="none"),this._selRsl&&(this._selRsl.style.display="none"),this._selMinLtr&&(this._selMinLtr.style.display="none")):(this._selCam&&(this._selCam.style.display="block"),this._selRsl&&(this._selRsl.style.display="block"),this._selMinLtr&&(this._selMinLtr.style.display="block"),this._stopLoading()),window.ResizeObserver){this._resizeObserver||(this._resizeObserver=new ResizeObserver((e=>{var t;Hi._onLog&&Hi._onLog("resize observer triggered.");for(let i of e)i.target===(null===(t=this._innerComponent)||void 0===t?void 0:t.getWrapper())&&this._videoResizeListener()})));const t=null===(e=this._innerComponent)||void 0===e?void 0:e.getWrapper();t&&this._resizeObserver.observe(t)}rt(this,Ti,"f").width=document.documentElement.clientWidth,rt(this,Ti,"f").height=document.documentElement.clientHeight,window.addEventListener("resize",this._windowResizeListener)}_unbindUI(){var e,t,i,n;rt(this,_i,"m",Oi).call(this)?(this._innerComponent&&(this._innerComponent.removeEventListener("click",this._clickIptSingleFrameMode),this._innerComponent.removeAttribute("title")),this._bgCamera&&(this._bgCamera.style.display="none")):this._stopLoading(),rt(this,_i,"m",Mi).call(this),null===(e=this._drawingLayersManager)||void 0===e||e.clearDrawingLayers(),null===(t=this._innerComponent)||void 0===t||t.removeElement("drawing-layer"),this._layerBaseCvs=null,this._drawingLayerOfMask=null,this._drawingLayerOfTip=null,null===(i=this._innerComponent)||void 0===i||i.remove(),this._innerComponent=null,st(this,bi,null,"f"),null===(n=this._videoContainer)||void 0===n||n.remove(),this._videoContainer=null,this._selCam=null,this._selRsl=null,this._optGotRsl=null,this._btnClose=null,this._selMinLtr=null,this._optGotMinLtr=null,this._divScanArea=null,this._divScanLight=null,this._singleFrameInputContainer&&(this._singleFrameInputContainer.remove(),this._singleFrameInputContainer=null),window.ResizeObserver&&this._resizeObserver&&this._resizeObserver.disconnect(),window.removeEventListener("resize",this._windowResizeListener)}_startLoading(){this._bgLoading&&(this._bgLoading.style.display="",this._bgLoading.style.animationPlayState="")}_stopLoading(){this._bgLoading&&(this._bgLoading.style.display="none",this._bgLoading.style.animationPlayState="paused")}_renderCamerasInfo(e,t){if(!this._selCam)return;let i;this._selCam.textContent="";for(let n of t){const t=document.createElement("option");t.value=n.deviceId,t.innerText=n.label,this._selCam.append(t),n.deviceId&&e&&e.deviceId==n.deviceId&&(i=t)}this._selCam.value=i?i.value:""}_renderResolutionInfo(e){this._optGotRsl&&(this._optGotRsl.setAttribute("data-width",e.width),this._optGotRsl.setAttribute("data-height",e.height),this._optGotRsl.innerText="got "+e.width+"x"+e.height,this._selRsl&&this._optGotRsl.parentNode==this._selRsl&&(this._selRsl.value="got"))}getVideoElement(){return rt(this,bi,"f")}isVideoLoaded(){return!!rt(this,bi,"f")&&4==rt(this,bi,"f").readyState}setVideoFit(e){if(e=e.toLowerCase(),!["contain","cover"].includes(e))throw new Error("Unsupported value '".concat(e,"'."));if(this.videoFit=e,!rt(this,bi,"f"))return;if(rt(this,bi,"f").style.objectFit=e,rt(this,_i,"m",Oi).call(this))return;let t;this._updateVideoContainer();try{t=this.getContentDimensions()}catch(e){if("Invalid content dimensions."===(e.message||e))return;throw e}rt(this,_i,"m",Pi).call(this,t,this.getConvertedRegion()),this.updateDrawingLayers(t)}getVideoFit(){return this.videoFit}getContentDimensions(){var e,t,i,n;let r,s,o;if(rt(this,_i,"m",Oi).call(this)?(r=null===(i=this._cvsSingleFrameMode)||void 0===i?void 0:i.width,s=null===(n=this._cvsSingleFrameMode)||void 0===n?void 0:n.height,o="contain"):(r=null===(e=rt(this,bi,"f"))||void 0===e?void 0:e.videoWidth,s=null===(t=rt(this,bi,"f"))||void 0===t?void 0:t.videoHeight,o=this.getVideoFit()),!r||!s)throw new Error("Invalid content dimensions.");return{width:r,height:s,objectFit:o}}updateConvertedRegion(e){const t=Ft.convert(this.scanRegion,e.width,e.height);st(this,Ci,t,"f"),rt(this,wi,"f")&&clearTimeout(rt(this,wi,"f")),st(this,wi,setTimeout((()=>{let e;try{e=this.getContentDimensions()}catch(e){if("Invalid content dimensions."===(e.message||e))return;throw e}rt(this,_i,"m",Ri).call(this,e,t),rt(this,_i,"m",Pi).call(this,e,t)}),0),"f")}getConvertedRegion(){return rt(this,Ci,"f")}setScanRegion(e){if(null!=e&&!Rt(e)&&!Mt(e))throw TypeError("Invalid 'region'.");let t;this.scanRegion=e?JSON.parse(JSON.stringify(e)):null;try{t=this.getContentDimensions()}catch(e){if("Invalid content dimensions."===(e.message||e))return;throw e}this.updateConvertedRegion(t)}getScanRegion(){return JSON.parse(JSON.stringify(this.scanRegion))}getVisibleRegionOfVideo(e){if(!this.isVideoLoaded())throw new Error("The video is not loaded.");const t=rt(this,bi,"f").videoWidth,i=rt(this,bi,"f").videoHeight,n=this.getVideoFit(),{width:r,height:s}=this._innerComponent.getBoundingClientRect();if(r<=0||s<=0)throw new Error("Unable to get video dimensions. Video may not be rendered on the page.");let o;const a={x:0,y:0,width:t,height:i,isMeasuredInPercentage:!1};if("cover"===n&&(r/s<t/i?(o=s/i,a.x=Math.floor((t-r/o)/2),a.y=0,a.width=Math.ceil(r/o),a.height=i):(o=r/t,a.x=0,a.y=Math.floor((i-s/o)/2),a.width=t,a.height=Math.ceil(s/o))),null==e?void 0:e.inPixels)return a;const l=a;return l.x=Math.ceil(l.x/i*100),l.y=Math.ceil(l.y/t*100),l.width=Math.floor(l.width/t*100),l.height=Math.floor(l.height/i*100),l.isMeasuredInPercentage=!0,a}setScanRegionMask(e,t,i,n){this._drawingLayerOfMask||(this._drawingLayerOfMask=this._createDrawingLayer(-2),this.isScanRegionMaskVisible()||rt(this,_i,"m",Li).call(this)),this.clearScanRegionMask(),this._maskBackRectStyleId||(this._maskBackRectStyleId=Bi.createDrawingStyle({paintMode:"fill",fillStyle:this.regionMaskFillStyle,lineWidth:0})),this._maskCenterRectStyleId||(this._maskCenterRectStyleId=Bi.createDrawingStyle({paintMode:"stroke",strokeStyle:this.regionMaskStrokeStyle,lineWidth:this.regionMaskLineWidth}));const r=this._drawingLayerOfMask.width,s=this._drawingLayerOfMask.height,o=new Xt({x:0,y:0,width:r,height:s},this._maskBackRectStyleId),a=new Xt({x:-r/2,y:-s/2+t,width:e,height:n}),l=new Xt({x:-r/2+e+i,y:-s/2+t,width:r-e-i<0?0:r-e-i,height:n}),c=new Xt({x:-r/2,y:-s/2,width:r,height:t}),h=new Xt({x:-r/2,y:-s/2+t+n,width:r,height:s-t-n<0?0:s-t-n});a.set("strokeWidth",0),l.set("strokeWidth",0),c.set("strokeWidth",0),h.set("strokeWidth",0);const u=new Ni([a,l,c,h])._getFabricObject();o.set("clipPath",u);const d=new Xt({x:e,y:t,width:i,height:n},this._maskCenterRectStyleId);this._drawingLayerOfMask.addDrawingItems([o,d])}clearScanRegionMask(){this._drawingLayerOfMask&&this._drawingLayerOfMask.clearDrawingItems()}deleteScanRegionMask(){this._drawingLayerOfMask&&this.deleteDrawingLayer(this._drawingLayerOfMask.getId())}_setScanRegionMaskVisible(e){st(this,Si,e,"f"),e?rt(this,_i,"m",Di).call(this):rt(this,_i,"m",Li).call(this)}setScanRegionMaskVisible(e){this._setScanRegionMaskVisible(e),this._userSetMaskVisible=e}isScanRegionMaskVisible(){return rt(this,Si,"f")}setScanRegionMaskStyle(e){if(!e)return;let t;e.fillStyle&&(this.regionMaskFillStyle=e.fillStyle),e.strokeStyle&&(this.regionMaskStrokeStyle=e.strokeStyle),e.lineWidth&&(this.regionMaskLineWidth=e.lineWidth),this._maskBackRectStyleId&&Bi.updateDrawingStyle(this._maskBackRectStyleId,{fillStyle:this.regionMaskFillStyle}),this._maskCenterRectStyleId&&Bi.updateDrawingStyle(this._maskCenterRectStyleId,{strokeStyle:this.regionMaskStrokeStyle,lineWidth:this.regionMaskLineWidth});try{t=this.getContentDimensions()}catch(e){if("Invalid content dimensions."===(e.message||e))return;throw e}rt(this,_i,"m",Ri).call(this,t,this.getConvertedRegion())}getScanRegionMaskStyle(){return{fillStyle:this.regionMaskFillStyle,strokeStyle:this.regionMaskStrokeStyle,lineWidth:this.regionMaskLineWidth}}_setScanLaserVisible(e){st(this,Ei,e,"f"),e?rt(this,_i,"m",ki).call(this):rt(this,_i,"m",Mi).call(this)}setScanLaserVisible(e){this._setScanLaserVisible(e),this._userSetLaserVisible=e}isScanLaserVisible(){return rt(this,Ei,"f")}_updateVideoContainer(){if(!rt(this,bi,"f"))return;if(rt(this,_i,"m",Oi).call(this))return;let e=1;const t=rt(this,bi,"f").style.transform.match(/scale\((.+)\)/);t&&(e=parseFloat(t[1]));const i=this._videoContainer;if("contain"===this.videoFit&&e>1){const e=rt(this,bi,"f").videoWidth,t=rt(this,bi,"f").videoHeight,{width:n,height:r}=this._innerComponent.getBoundingClientRect(),s=e/t;if(n/r<s){let e=n/s;i.style.left="0",i.style.top=(r-e)/2/r*100+"%",i.style.width="100%",i.style.height=e/r*100+"%"}else{let e=r*s;i.style.left=(n-e)/2/n*100+"%",i.style.top="0",i.style.width=e/n*100+"%",i.style.height="100%"}}else i.style.left="0",i.style.top="0",i.style.width="100%",i.style.height="100%"}updateLayers(){let e;this._updateVideoContainer();try{e=this.getContentDimensions()}catch(e){if("Invalid content dimensions."===(e.message||e))return;throw e}const t=this.getConvertedRegion();rt(this,_i,"m",Pi).call(this,e,t),this.updateDrawingLayers(e),rt(this,_i,"m",Ri).call(this,e,t)}clearAllInnerDrawingItems(){rt(this,Ii,"f").forEach((e=>e.remove())),rt(this,Ii,"f").length=0}dispose(){this._unbindUI(),delete window._dce_default_template,this.__proto__=null;for(let e in this)delete this[e];Object.defineProperty(this,"disposed",{value:!0})}}vi=new WeakMap,yi=new WeakMap,wi=new WeakMap,bi=new WeakMap,Ci=new WeakMap,Si=new WeakMap,Ei=new WeakMap,Ti=new WeakMap,xi=new WeakMap,Ii=new WeakMap,Ai=new WeakMap,_i=new WeakSet,Oi=function(){return"disabled"!==this._singleFrameMode},Ri=function(e,t){!t||0===t.x&&0===t.y&&t.width===e.width&&t.height===e.height?this.clearScanRegionMask():this.setScanRegionMask(t.x,t.y,t.width,t.height)},Di=function(){this._drawingLayerOfMask&&this._drawingLayerOfMask.setVisible(!0)},Li=function(){this._drawingLayerOfMask&&this._drawingLayerOfMask.setVisible(!1)},ki=function(){this._divScanLight&&"none"==this._divScanLight.style.display&&(this._divScanLight.style.display="block")},Mi=function(){this._divScanLight&&(this._divScanLight.style.display="none")},Pi=function(e,t){if(!this._divScanArea)return;if(!this._innerComponent.getElement("content"))return;const{width:i,height:n,objectFit:r}=e;t||(t={x:0,y:0,width:i,height:n});const{width:s,height:o}=this._innerComponent.getBoundingClientRect();if(s<=0||o<=0)return;const a=s/o,l=i/n;let c,h,u,d,f=1;if("contain"===r)a<l?(f=s/i,c=0,h=(o-n*f)/2):(f=o/n,c=(s-i*f)/2,h=0),c+=t.x*f,h+=t.y*f,u=t.width*f,d=t.height*f;else if("cover"===r)if(a<l){f=o/n,c=t.x*f-(i*f-s)/2,c=Math.max(c,0),c=Math.min(c,s),h=t.y*f;let e=(t.x+t.width)*f-(i*f-s)/2;e=Math.max(e,0),e=Math.min(e,s),u=e-c,d=t.height*f}else{f=s/i,c=t.x*f,h=t.y*f-(n*f-o)/2,h=Math.max(h,0),h=Math.min(h,o);let e=(t.y+t.height)*f-(n*f-o)/2;e=Math.max(e,0),e=Math.min(e,o),u=t.width*f,d=e-h}else c=0,h=0,u=0,d=0;this._divScanArea.style.left=c+"px",this._divScanArea.style.top=h+"px",this._divScanArea.style.width=u+"px",this._divScanArea.style.height=d+"px"},Hi.uiComponentName="default-camera-view",Hi._defaultUIElementURL="@engineResourcePath/dce.ui.html";function Yi(e,t,i,n){if("a"===i&&!n)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!n:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===i?n:"a"===i?n.call(e):n?n.value:t.get(e)}function Xi(e,t,i,n,r){if("m"===n)throw new TypeError("Private method is not writable");if("a"===n&&!r)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!r:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===n?r.call(e,i):r?r.value=i:t.set(e,i),i}new WeakMap,new WeakMap,new WeakSet,"function"==typeof SuppressedError&&SuppressedError;const qi="undefined"==typeof self;let Zi,Ki,Qi,Ji,$i;function en(e,t,i,n){if("a"===i&&!n)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!n:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===i?n:"a"===i?n.call(e):n?n.value:t.get(e)}function tn(e,t,i,n,r){if("m"===n)throw new TypeError("Private method is not writable");if("a"===n&&!r)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!r:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===n?r.call(e,i):r?r.value=i:t.set(e,i),i}"undefined"!=typeof navigator&&(Zi=navigator,Ki=Zi.userAgent,Qi=Zi.platform,Ji=Zi.mediaDevices),function(){if(!qi){const e={Edge:{search:"Edg",verSearch:"Edg"},OPR:null,Chrome:null,Safari:{str:Zi.vendor,search:"Apple",verSearch:["Version","iPhone OS","CPU OS"]},Firefox:null,Explorer:{search:"MSIE",verSearch:"MSIE"}},t={HarmonyOS:null,Android:null,iPhone:null,iPad:null,Windows:{str:Qi,search:"Win"},Mac:{str:Qi},Linux:{str:Qi}};let i="unknownBrowser",n=0,r="unknownOS";for(let s in e){const t=e[s]||{};let r=t.str||Ki,o=t.search||s,a=t.verStr||Ki,l=t.verSearch||s;if(l instanceof Array||(l=[l]),-1!=r.indexOf(o)){i=s;for(let e of l){let t=a.indexOf(e);if(-1!=t){n=parseFloat(a.substring(t+e.length+1));break}}break}}for(let s in t){const e=t[s]||{};let i=e.str||Ki,n=e.search||s;if(-1!=i.indexOf(n)){r=s;break}}"Linux"==r&&-1!=Ki.indexOf("Windows NT")&&(r="HarmonyOS"),$i={browser:i,version:n,OS:r}}qi&&($i={browser:"ssr",version:0,OS:"ssr"})}(),"undefined"!=typeof WebAssembly&&Ki&&(!/Safari/.test(Ki)||/Chrome/.test(Ki)||/\(.+\s11_2_([2-6]).*\)/.test(Ki)),Ji&&Ji.getUserMedia,"Chrome"===$i.browser&&$i.version>66||"Safari"===$i.browser&&$i.version>13||"OPR"===$i.browser&&$i.version>43||"Edge"===$i.browser&&$i.version,"function"==typeof SuppressedError&&SuppressedError;class nn{static multiply(e,t){const i=[];for(let n=0;n<3;n++){const r=t.slice(3*n,3*n+3);for(let t=0;t<3;t++){const n=[e[t],e[t+3],e[t+6]].reduce(((e,t,i)=>e+t*r[i]),0);i.push(n)}}return i}static identity(){return[1,0,0,0,1,0,0,0,1]}static translate(e,t,i){return nn.multiply(e,[1,0,0,0,1,0,t,i,1])}static rotate(e,t){var i=Math.cos(t),n=Math.sin(t);return nn.multiply(e,[i,-n,0,n,i,0,0,0,1])}static scale(e,t,i){return nn.multiply(e,[t,0,0,0,i,0,0,0,1])}}var rn,sn,on,an,ln,cn,hn,un,dn,fn,gn,pn,mn,_n,vn,yn,wn,bn,Cn,Sn,En,Tn,xn,In,An,On,Rn,Dn,Ln,kn,Mn,Pn,Fn,Nn,Bn,jn,Un,Vn,Gn,Wn,zn,Hn,Yn,Xn,qn,Zn,Kn,Qn,Jn,$n,er,tr;!function(e){e.GREY="grey",e.GREY32="grey32",e.RGBA="rgba",e.RBGA="rbga",e.GRBA="grba",e.GBRA="gbra",e.BRGA="brga",e.BGRA="bgra"}(rn||(rn={}));class ir{static get version(){return"1.1.1-0"}static checkWebGLSupport(){return null===document.createElement("canvas").getContext("webgl")?(tn(ir,sn,!1,"f",on),!1):(tn(ir,sn,!0,"f",on),!0)}get disposed(){return en(this,dn,"f")}constructor(){an.set(this,rn.RGBA),ln.set(this,null),cn.set(this,null),hn.set(this,null),this.useWebGLByDefault=!0,this._reusedCvs=null,this._reusedWebGLCvs=null,un.set(this,null),dn.set(this,!1)}drawImage(e,t,i,n,r,s){if(this.disposed)throw Error("The 'ImageDataGetter' instance has been disposed.");if(!i||!n)throw new Error("Invalid 'sourceWidth' or 'sourceHeight'.");if(null==en(ir,sn,"f",on)&&ir.checkWebGLSupport(),(null==s?void 0:s.bUseWebGL)&&!en(ir,sn,"f",on))throw new Error("Your browser or machine may not support WebGL.");if(t instanceof HTMLVideoElement&&4!==t.readyState||t instanceof HTMLImageElement&&!t.complete)throw new Error("The source is not loaded.");let o;ir._onLog&&(o=Date.now(),ir._onLog("drawImage(), START: "+o));let a=0,l=0,c=i,h=n,u=0,d=0,f=i,g=n;r&&(r.sx&&(a=Math.round(r.sx)),r.sy&&(l=Math.round(r.sy)),r.sWidth&&(c=Math.round(r.sWidth)),r.sHeight&&(h=Math.round(r.sHeight)),r.dx&&(u=Math.round(r.dx)),r.dy&&(d=Math.round(r.dy)),r.dWidth&&(f=Math.round(r.dWidth)),r.dHeight&&(g=Math.round(r.dHeight)));let p,m=rn.RGBA;if((null==s?void 0:s.pixelFormat)&&(m=s.pixelFormat),(null==s?void 0:s.bufferContainer)&&(p=s.bufferContainer,p.length<4*f*g))throw new Error("Unexpected size of the 'bufferContainer'.");const _=e;if(!en(ir,sn,"f",on)||!(this.useWebGLByDefault&&null==(null==s?void 0:s.bUseWebGL)||(null==s?void 0:s.bUseWebGL))){ir._onLog&&ir._onLog("drawImage() in context2d."),_.ctx2d||(_.ctx2d=_.getContext("2d",{willReadFrequently:!0}));const e=_.ctx2d;if(!e)throw new Error("Unable to get 'CanvasRenderingContext2D' from canvas.");return(_.width<u+f||_.height<d+g)&&(_.width=u+f,_.height=d+g),e.drawImage(t,a,l,c,h,u,d,f,g),ir._onLog&&ir._onLog("drawImage() in context2d end. Costs: "+(Date.now()-o)),{context:e,pixelFormat:rn.RGBA,bUseWebGL:!1}}ir._onLog&&ir._onLog("drawImage() in WebGL.");try{(_.width<u+f||_.height<d+g)&&(_.width=u+f,_.height=d+g,_.ctxWebGL&&_.ctxWebGL.viewport(0,0,u+f,d+g));const e=_.ctxWebGL||_.getContext("webgl",{antialias:!1})||_.getContext("experimental-webgl",{antialias:!1});if(!e){ir._onLog&&ir._onLog("Browser or machine may not support WebGL, or the canvas has already been set to a different context mode.");const e=new Error("Unable to get 'WebGLRenderingContext'. Your browser or machine may not support WebGL, or the canvas has already been set to a different context mode.");throw e.name="WebGLError",e}if(!_.ctxWebGL||m!==en(this,an,"f")){_.ctxWebGL=e;const t=e=>{const t=e.createBuffer();e.bindBuffer(e.ARRAY_BUFFER,t),e.bufferData(e.ARRAY_BUFFER,new Float32Array([0,0,0,1,1,0,1,0,0,1,1,1]),e.STATIC_DRAW);const i=e.createBuffer();return e.bindBuffer(e.ARRAY_BUFFER,i),e.bufferData(e.ARRAY_BUFFER,new Float32Array([0,0,0,1,1,0,1,0,0,1,1,1]),e.STATIC_DRAW),{positions:t,texCoords:i}},i=e=>{const t=e.createTexture();return e.bindTexture(e.TEXTURE_2D,t),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.LINEAR),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.LINEAR),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),t},n=(e,t)=>{const i=e.createProgram();if(t.forEach((t=>e.attachShader(i,t))),e.linkProgram(i),!e.getProgramParameter(i,e.LINK_STATUS)){const t=new Error("An error occured linking the program: ".concat(e.getProgramInfoLog(i),"."));throw t.name="WebGLError",t}return e.useProgram(i),i},r=(e,t,i)=>{const n=e.createShader(t);if(e.shaderSource(n,i),e.compileShader(n),!e.getShaderParameter(n,e.COMPILE_STATUS)){const t=new Error("An error occured compiling the shader: ".concat(e.getShaderInfoLog(n),"."));throw t.name="WebGLError",t}return n},s="\n                  attribute vec2 a_position;\n                  attribute vec2 a_texCoord;\n  \n                  uniform mat3 u_matrix;\n                  uniform mat3 u_textureMatrix;\n  \n                  varying vec2 v_texCoord;\n                  void main(void) {\n                  gl_Position = vec4((u_matrix * vec3(a_position, 1)).xy, 0, 1.0);\n                  v_texCoord = vec4((u_textureMatrix * vec3(a_texCoord, 1)).xy, 0, 1.0).xy;\n                  }\n              ";let o="rgb";["rgba","rbga","grba","gbra","brga","bgra"].includes(m)&&(o=m.slice(0,3));const a="\n                  precision mediump float;\n                  varying vec2 v_texCoord;\n                  uniform sampler2D u_image;\n                  uniform float uColorFactor;\n  \n                  void main() {\n                      vec4 sample = texture2D(u_image, v_texCoord);\n                      float grey = 0.21 * sample.r + 0.71 * sample.g + 0.07 * sample.b;\n                      gl_FragColor = vec4(sample.".concat(o," * (1.0 - uColorFactor) + (grey * uColorFactor), sample.a);\n                  }\n              "),l=n(e,[r(e,e.VERTEX_SHADER,s),r(e,e.FRAGMENT_SHADER,a)]);tn(this,cn,{program:l,attribLocations:{vertexPosition:e.getAttribLocation(l,"a_position"),texPosition:e.getAttribLocation(l,"a_texCoord")},uniformLocations:{uSampler:e.getUniformLocation(l,"u_image"),uColorFactor:e.getUniformLocation(l,"uColorFactor"),uMatrix:e.getUniformLocation(l,"u_matrix"),uTextureMatrix:e.getUniformLocation(l,"u_textureMatrix")}},"f"),tn(this,hn,t(e),"f"),tn(this,ln,i(e),"f"),tn(this,an,m,"f")}const r=(e,t,i)=>{e.bindBuffer(e.ARRAY_BUFFER,t),e.enableVertexAttribArray(i),e.vertexAttribPointer(i,2,e.FLOAT,!1,0,0)},s=(e,t,i)=>{const n=e.RGBA,r=e.RGBA,s=e.UNSIGNED_BYTE;e.bindTexture(e.TEXTURE_2D,t),e.texImage2D(e.TEXTURE_2D,0,n,r,s,i)},v=(e,t,s,o)=>{e.clearColor(0,0,0,1),e.clearDepth(1),e.enable(e.DEPTH_TEST),e.depthFunc(e.LEQUAL),e.clear(e.COLOR_BUFFER_BIT|e.DEPTH_BUFFER_BIT),r(e,s.positions,t.attribLocations.vertexPosition),r(e,s.texCoords,t.attribLocations.texPosition),e.activeTexture(e.TEXTURE0),e.bindTexture(e.TEXTURE_2D,o),e.uniform1i(t.uniformLocations.uSampler,0),e.uniform1f(t.uniformLocations.uColorFactor,[rn.GREY,rn.GREY32].includes(m)?1:0);let p,_,v=nn.translate(nn.identity(),-1,-1);v=nn.scale(v,2,2),v=nn.scale(v,1/e.canvas.width,1/e.canvas.height),p=nn.translate(v,u,d),p=nn.scale(p,f,g),e.uniformMatrix3fv(t.uniformLocations.uMatrix,!1,p),_=nn.translate(nn.identity(),a/i,l/n),_=nn.scale(_,c/i,h/n),e.uniformMatrix3fv(t.uniformLocations.uTextureMatrix,!1,_),e.drawArrays(e.TRIANGLES,0,6)};s(e,en(this,ln,"f"),t),v(e,en(this,cn,"f"),en(this,hn,"f"),en(this,ln,"f"));const y=p||new Uint8Array(4*f*g);if(e.readPixels(u,d,f,g,e.RGBA,e.UNSIGNED_BYTE,y),255!==y[3]){ir._onLog&&ir._onLog("Incorrect WebGL drawing .");const e=new Error("WebGL error: incorrect drawing.");throw e.name="WebGLError",e}return ir._onLog&&ir._onLog("drawImage() in WebGL end. Costs: "+(Date.now()-o)),{context:e,pixelFormat:m===rn.GREY?rn.GREY32:m,bUseWebGL:!0}}catch(o){if(this.forceLoseContext(),console.log(o),null==(null==s?void 0:s.bUseWebGL))return ir._onLog&&ir._onLog("'drawImage()' in WebGL failed, try again in context2d."),this.useWebGLByDefault=!1,this.drawImage(e,t,i,n,r,Object.assign({},s,{bUseWebGL:!1}));throw o.name="WebGLError",o}}readCvsData(e,t,i){if(!(e instanceof CanvasRenderingContext2D||e instanceof WebGLRenderingContext))throw new Error("Invalid 'context'.");let n,r=0,s=0,o=e.canvas.width,a=e.canvas.height;if(t&&(t.x&&(r=t.x),t.y&&(s=t.y),t.width&&(o=t.width),t.height&&(a=t.height)),(null==i?void 0:i.length)<4*o*a)throw new Error("Unexpected size of the 'bufferContainer'.");if(e instanceof WebGLRenderingContext){const t=e;i?(t.readPixels(r,s,o,a,t.RGBA,t.UNSIGNED_BYTE,i),n=new Uint8Array(i.buffer,0,4*o*a)):(n=new Uint8Array(4*o*a),t.readPixels(r,s,o,a,t.RGBA,t.UNSIGNED_BYTE,n))}else if(e instanceof CanvasRenderingContext2D){let t;t=e.getImageData(r,s,o,a),n=new Uint8Array(t.data.buffer),null==i||i.set(n)}return n}transformPixelFormat(e,t,i,n){let r,s;if(ir._onLog&&(r=Date.now(),ir._onLog("transformPixelFormat(), START: "+r)),t===i)return ir._onLog&&ir._onLog("transformPixelFormat() end. Costs: "+(Date.now()-r)),n?new Uint8Array(e):e;const o=[rn.RGBA,rn.RBGA,rn.GRBA,rn.GBRA,rn.BRGA,rn.BGRA];if(o.includes(t))if(i===rn.GREY){s=new Uint8Array(e.length/4);for(let t=0;t<e.length;t+=4){const i=.21*e[t]+.71*e[t+1]+.07*e[t+2];s[t/4]=i}}else if(i===rn.GREY32){s=n?new Uint8Array(e):e;for(let t=0;t<e.length;t+=4){const i=.21*e[t]+.71*e[t+1]+.07*e[t+2];s[t]=i,s[t+1]=i,s[t+2]=i}}else{if(!o.includes(i))throw new Error("Unable to transform.");if(n){s=new Uint8Array(e);const n=t.indexOf("r"),r=t.indexOf("g"),o=t.indexOf("b"),a=i.indexOf("r"),l=i.indexOf("g"),c=i.indexOf("b");for(let t=0;t<e.length;t+=4)s[t+a]=e[t+n],s[t+l]=e[t+r],s[t+c]=e[t+o]}else{s=e;const n=t.indexOf("r"),r=t.indexOf("g"),o=t.indexOf("b"),a=i.indexOf("r"),l=i.indexOf("g"),c=i.indexOf("b");for(let t=0;t<e.length;t+=4){let i=[e[t],e[t+1],e[t+2]];s[t+a]=i[n],s[t+l]=i[r],s[t+c]=i[o]}}}else if(t===rn.GREY){if(i!==rn.GREY32)throw new Error("Unable to transform.");s=new Uint8Array(4*e.length);for(let t=0;t<e.length;t++)s[4*t]=e[t],s[4*t+1]=e[t],s[4*t+2]=e[t],s[4*t+3]=255}else{if(t!==rn.GREY32)throw new Error("Unable to transform.");if(i!==rn.GREY)throw new Error("Unable to transform.");s=new Uint8Array(e.length/4);for(let t=0;t<e.length;t+=4)s[t/4]=e[t]}return ir._onLog&&ir._onLog("transformPixelFormat() end. Costs: "+(Date.now()-r)),s}getImageData(e,t,i,n,r){if(this.disposed)throw Error("The 'ImageDataGetter' instance has been disposed.");if(!t||!i)throw new Error("Invalid 'sourceWidth' or 'sourceHeight'.");if(null==en(ir,sn,"f",on)&&ir.checkWebGLSupport(),(null==r?void 0:r.bUseWebGL)&&!en(ir,sn,"f",on))throw new Error("Your browser or machine may not support WebGL.");if(n.sx>t||n.sy>i||n.sx+n.sWidth>t||n.sy+n.sHeight>i)throw new Error("Invalid position.");if(e instanceof HTMLVideoElement&&4!==e.readyState||e instanceof HTMLImageElement&&!e.complete)throw new Error("The source is not loaded.");let s;ir._onLog&&(s=Date.now(),ir._onLog("getImageData(), START: "+s));const o=Math.round(n.sx),a=Math.round(n.sy),l=Math.round(n.sWidth),c=Math.round(n.sHeight),h=Math.round(n.dWidth),u=Math.round(n.dHeight);let d=rn.RGBA;(null==r?void 0:r.pixelFormat)&&(d=r.pixelFormat);let f,g,p,m=null;if((null==r?void 0:r.bufferContainer)&&(m=r.bufferContainer),en(ir,sn,"f",on)&&(this.useWebGLByDefault&&null==(null==r?void 0:r.bUseWebGL)||(null==r?void 0:r.bUseWebGL))){ir._onLog&&ir._onLog("getImageData() in WebGL."),this._reusedWebGLCvs||(this._reusedWebGLCvs=document.createElement("canvas")),f=this._reusedWebGLCvs;try{if(m)if(d===rn.GREY){if(p=new Uint8Array(4*h*u),g=this.drawImage(f,e,t,i,{sx:o,sy:a,sWidth:l,sHeight:c,dWidth:h,dHeight:u},{pixelFormat:d,bUseWebGL:!0,bufferContainer:p}),p=this.transformPixelFormat(p,g.pixelFormat,d),m){if(m.length<p.length)throw new Error("Unexpected size of the 'bufferContainer'.");m.set(p)}}else g=this.drawImage(f,e,t,i,{sx:o,sy:a,sWidth:l,sHeight:c,dWidth:h,dHeight:u},{pixelFormat:d,bUseWebGL:!0,bufferContainer:m}),p=new Uint8Array(m.buffer,0,4*h*u),p=this.transformPixelFormat(p,g.pixelFormat,d);else d===rn.GREY?((!en(this,un,"f")||en(this,un,"f").length<4*h*u)&&tn(this,un,new Uint8Array(4*h*u),"f"),p=new Uint8Array(en(this,un,"f").buffer,0,4*h*u)):p=new Uint8Array(4*h*u),g=this.drawImage(f,e,t,i,{sx:o,sy:a,sWidth:l,sHeight:c,dWidth:h,dHeight:u},{pixelFormat:d,bUseWebGL:!0,bufferContainer:p}),p=this.transformPixelFormat(p,g.pixelFormat,d)}catch(n){if("WebGLError"===n.name&&(this.forceLoseContext(),null==(null==r?void 0:r.bUseWebGL)))return ir._onLog&&ir._onLog("getImageData() in WebGL failed, try again in context2d."),this.useWebGLByDefault=!1,this.getImageData(e,t,i,{sx:o,sy:a,sWidth:l,sHeight:c,dWidth:h,dHeight:u},Object.assign({},r,{bUseWebGL:!1}));throw n}}else if(ir._onLog&&ir._onLog("getImageData() in context2d."),this._reusedCvs||(this._reusedCvs=document.createElement("canvas")),f=this._reusedCvs,g=this.drawImage(f,e,t,i,{sx:o,sy:a,sWidth:l,sHeight:c,dWidth:h,dHeight:u},{pixelFormat:rn.RGBA,bUseWebGL:!1}),p=this.readCvsData(g.context,{width:h,height:u},null),p=this.transformPixelFormat(p,g.pixelFormat,d),m){if(m.length<p.length)throw new Error("Unexpected size of the 'bufferContainer'.");m.set(p)}return ir._onLog&&ir._onLog("getImageData() end. Costs: "+(Date.now()-s)),{data:p,pixelFormat:d,width:h,height:u,bUseWebGL:g.bUseWebGL}}convertDataToCvs(e,t,i,n){if(!(e instanceof Uint8Array||e instanceof Uint8ClampedArray))throw new TypeError("Invalid 'data'.");if("number"!=typeof t||t<=0)throw new Error("Invalid 'width'.");if("number"!=typeof i||i<=0)throw new Error("Invalid 'height'.");const r=document.createElement("canvas");let s;if(r.width=t,r.height=i,n===rn.GREY){s=new Uint8ClampedArray(4*t*i);for(let t=0;t<s.length;t+=4)s[t]=e[t/4],s[t+1]=e[t/4],s[t+2]=e[t/4],s[t+3]=255}else s=new Uint8ClampedArray(e.buffer);const o=new ImageData(s,t,i);return r.getContext("2d").putImageData(o,0,0),r}forceLoseContext(){if(!this._reusedWebGLCvs)return;const e=this._reusedWebGLCvs.ctxWebGL;e&&!e.isContextLost()&&e.getExtension("WEBGL_lose_context")&&e.getExtension("WEBGL_lose_context").loseContext(),tn(this,ln,null,"f"),tn(this,cn,null,"f"),tn(this,hn,null,"f"),this._reusedWebGLCvs=null}dispose(){this.forceLoseContext(),tn(this,dn,!0,"f")}}sn=ir,an=new WeakMap,ln=new WeakMap,cn=new WeakMap,hn=new WeakMap,un=new WeakMap,dn=new WeakMap,on={value:void 0};class nr{constructor(){fn.set(this,new Map),gn.set(this,!1)}get disposed(){return Yi(this,gn,"f")}on(e,t){e=e.toLowerCase();const i=Yi(this,fn,"f").get(e);if(i){if(i.includes(t))return;i.push(t)}else Yi(this,fn,"f").set(e,[t])}off(e,t){e=e.toLowerCase();const i=Yi(this,fn,"f").get(e);if(!i)return;const n=i.indexOf(t);-1!==n&&i.splice(n,1)}offAll(e){e=e.toLowerCase();const t=Yi(this,fn,"f").get(e);t&&(t.length=0)}async fire(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{async:!1,copy:!0};t||(t=[]),e=e.toLowerCase();const n=Yi(this,fn,"f").get(e);if(n&&n.length){i=Object.assign({async:!1,copy:!0},i);for(let r of n){if(!r)continue;let n=[];if(i.copy)for(let i of t){try{i=JSON.parse(JSON.stringify(i))}catch(e){}n.push(i)}else n=t;let s=!1;if(i.async)setTimeout((()=>{this.disposed||r.apply(i.target,n)}),0);else try{s=await r.apply(i.target,n)}catch(e){}if(!0===s)break}}}dispose(){Xi(this,gn,!0,"f")}}fn=new WeakMap,gn=new WeakMap;const rr=(e,t,i,n)=>{if(!i)return e;let r=t+Math.round((e-t)/i)*i;return n&&(r=Math.min(r,n)),r};class sr{static get version(){return"2.0.0"}static isStorageAvailable(e){let t;try{t=window[e];const i="__storage_test__";return t.setItem(i,i),t.removeItem(i),!0}catch(e){return e instanceof DOMException&&(22===e.code||1014===e.code||"QuotaExceededError"===e.name||"NS_ERROR_DOM_QUOTA_REACHED"===e.name)&&t&&0!==t.length}}static findBestRearCameraInIOS(e,t){if(!e||!e.length)return null;let i=!1;if((null==t?void 0:t.getMainCamera)&&(i=!0),i){const t=["\ud6c4\uba74 \uce74\uba54\ub77c","\u80cc\u9762\u30ab\u30e1\u30e9","\u5f8c\u7f6e\u93e1\u982d","\u540e\u7f6e\u76f8\u673a","\u0e01\u0e25\u0e49\u0e2d\u0e07\u0e14\u0e49\u0e32\u0e19\u0e2b\u0e25\u0e31\u0e07","\u092c\u0948\u0915 \u0915\u0948\u092e\u0930\u093e","\u0627\u0644\u0643\u0627\u0645\u064a\u0631\u0627 \u0627\u0644\u062e\u0644\u0641\u064a\u0629","\u05de\u05e6\u05dc\u05de\u05d4 \u05d0\u05d7\u05d5\u05e8\u05d9\u05ea","\u043a\u0430\u043c\u0435\u0440\u0430 \u043d\u0430 \u0437\u0430\u0434\u043d\u0435\u0439 \u043f\u0430\u043d\u0435\u043b\u0438","\u0437\u0430\u0434\u043d\u044f \u043a\u0430\u043c\u0435\u0440\u0430","\u0437\u0430\u0434\u043d\u0430 \u043a\u0430\u043c\u0435\u0440\u0430","\u0430\u0440\u0442\u049b\u044b \u043a\u0430\u043c\u0435\u0440\u0430","\u03c0\u03af\u03c3\u03c9 \u03ba\u03ac\u03bc\u03b5\u03c1\u03b1","zadn\xed fotoapar\xe1t","zadn\xe1 kamera","tylny aparat","takakamera","stra\u017enja kamera","r\xfcckkamera","kamera p\xe5 baksidan","kamera belakang","kamera bak","h\xe1ts\xf3 kamera","fotocamera (posteriore)","c\xe2mera traseira","c\xe2mara traseira","c\xe1mara trasera","c\xe0mera posterior","cam\xe9ra arri\xe8re","camer\u0103 spate","camera m\u1eb7t sau","camera aan achterzijde","bagsidekamera","back camera","arka kamera"],i=e.find((e=>t.includes(e.label.toLowerCase())));return null==i?void 0:i.deviceId}{const t=["\ud6c4\uba74","\u80cc\u9762","\u5f8c\u7f6e","\u540e\u7f6e","\u0e32\u0e19\u0e2b\u0e25\u0e31\u0e07","\u092c\u0948\u0915","\u062e\u0644\u0641\u064a\u0629","\u05d0\u05d7\u05d5\u05e8\u05d9\u05ea","\u0437\u0430\u0434\u043d\u044f\u044f","\u0437\u0430\u0434\u043d\u0435\u0439","\u0437\u0430\u0434\u043d\u0430","\u03c0\u03af\u03c3\u03c9","zadn\xed","zadn\xe1","tylny","trasera","traseira","taka","stra\u017enja","spate","sau","r\xfcck","posteriore","posterior","h\xe1ts\xf3","belakang","baksidan","bakre","bak","bagside","back","a\u0440\u0442\u049b\u044b","arri\xe8re","arka","achterzijde"],i=["\ud2b8\ub9ac\ud50c","\u4e09\u955c\u5934","\u4e09\u93e1\u982d","\u30c8\u30ea\u30d7\u30eb","\u0e2a\u0e32\u0e21","\u091f\u094d\u0930\u093f\u092a\u0932","\u062b\u0644\u0627\u062b\u064a\u0629","\u05de\u05e9\u05d5\u05dc\u05e9\u05ea","\u04af\u0448\u0442\u0456\u043a","\u0442\u0440\u043e\u0439\u043d\u0430\u044f","\u0442\u0440\u043e\u0439\u043d\u0430","\u043f\u043e\u0442\u0440\u043e\u0454\u043d\u0430","\u03c4\u03c1\u03b9\u03c0\u03bb\u03ae","\xfc\xe7l\xfc","tr\xf3jobiektywowy","trostruka","trojn\xfd","trojit\xe1","trippelt","trippel","tripl\u0103","triple","tripla","tiga","kolmois","ba camera"],n=["\ub4c0\uc5bc \uc640\uc774\ub4dc","\u96d9\u5ee3\u89d2","\u53cc\u5e7f\u89d2","\u30c7\u30e5\u30a2\u30eb\u5e83\u89d2","\u0e04\u0e39\u0e48\u0e14\u0e49\u0e32\u0e19\u0e2b\u0e25\u0e31\u0e07\u0e21\u0e38\u0e21\u0e01\u0e27\u0e49\u0e32\u0e07","\u0921\u094d\u092f\u0941\u0905\u0932 \u0935\u093e\u0907\u0921","\u0645\u0632\u062f\u0648\u062c\u0629 \u0639\u0631\u064a\u0636\u0629","\u05db\u05e4\u05d5\u05dc\u05d4 \u05e8\u05d7\u05d1\u05d4","\u049b\u043e\u0441 \u043a\u0435\u04a3 \u0431\u04b1\u0440\u044b\u0448\u0442\u044b","\u0437\u0434\u0432\u043e\u0454\u043d\u0430 \u0448\u0438\u0440\u043e\u043a\u043e\u043a\u0443\u0442\u043d\u0430","\u0434\u0432\u043e\u0439\u043d\u0430\u044f \u0448\u0438\u0440\u043e\u043a\u043e\u0443\u0433\u043e\u043b\u044c\u043d\u0430\u044f","\u0434\u0432\u043e\u0439\u043d\u0430 \u0448\u0438\u0440\u043e\u043a\u043e\u044a\u0433\u044a\u043b\u043d\u0430","\u03b4\u03b9\u03c0\u03bb\u03ae \u03b5\u03c5\u03c1\u03b5\u03af\u03b1","\xe7ift geni\u015f","laajakulmainen kaksois","k\xe9p r\u1ed9ng m\u1eb7t sau","kett\u0151s, sz\xe9les l\xe1t\xf3sz\xf6g\u0171","grande angular dupla","ganda","dwuobiektywowy","dwikamera","dvostruka \u0161iroka","du\xe1ln\xed \u0161iroko\xfahl\xfd","du\xe1lna \u0161irokouhl\xe1","dupla grande-angular","dubl\u0103","dubbel vidvinkel","dual-weitwinkel","dual wide","dual con gran angular","dual","double","doppia con grandangolo","doble","dobbelt vidvinkelkamera"],r=e.filter((e=>{const i=e.label.toLowerCase();return t.some((e=>i.includes(e)))}));if(!r.length)return null;const s=r.find((e=>{const t=e.label.toLowerCase();return i.some((e=>t.includes(e)))}));if(s)return s.deviceId;const o=r.find((e=>{const t=e.label.toLowerCase();return n.some((e=>t.includes(e)))}));return o?o.deviceId:r[0].deviceId}}static findBestRearCamera(e,t){if(!e||!e.length)return null;if(["iPhone","iPad","Mac"].includes($i.OS))return sr.findBestRearCameraInIOS(e,{getMainCamera:null==t?void 0:t.getMainCameraInIOS});const i=["\ud6c4","\u80cc\u9762","\u80cc\u7f6e","\u5f8c\u9762","\u5f8c\u7f6e","\u540e\u9762","\u540e\u7f6e","\u0e32\u0e19\u0e2b\u0e25\u0e31\u0e07","\u0e2b\u0e25\u0e31\u0e07","\u092c\u0948\u0915","\u062e\u0644\u0641\u064a\u0629","\u05d0\u05d7\u05d5\u05e8\u05d9\u05ea","\u0437\u0430\u0434\u043d\u044f\u044f","\u0437\u0430\u0434\u043d\u044f","\u0437\u0430\u0434\u043d\u0435\u0439","\u0437\u0430\u0434\u043d\u0430","\u03c0\u03af\u03c3\u03c9","zadn\xed","zadn\xe1","tylny","tr\xe1s","trasera","traseira","taka","stra\u017enja","spate","sau","r\xfcck","rear","posteriore","posterior","h\xe1ts\xf3","darrere","belakang","baksidan","bakre","bak","bagside","back","a\u0440\u0442\u049b\u044b","arri\xe8re","arka","achterzijde"];for(let n of e){const e=n.label.toLowerCase();if(e&&i.some((t=>e.includes(t)))&&/\b0(\b)?/.test(e))return n.deviceId}return["Android","HarmonyOS"].includes($i.OS)?e[e.length-1].deviceId:null}static findBestCamera(e,t,i){return e&&e.length?"environment"===t?this.findBestRearCamera(e,i):"user"===t?null:t?void 0:null:null}static async playVideo(e,t,i){if(!e)throw new Error("Invalid 'videoEl'.");if(!t)throw new Error("Invalid 'source'.");return"string"==typeof t||t instanceof String?e.src=t:e.srcObject=t,new Promise(((t,n)=>{let r;const s=()=>{e.removeEventListener("loadstart",l),e.removeEventListener("abort",c),e.removeEventListener("play",h),e.removeEventListener("error",u)},o=()=>{r&&clearTimeout(r),s(),t(e)},a=e=>{r&&clearTimeout(r),s(),n(e)},l=()=>{e.addEventListener("abort",c,{once:!0})},c=()=>{const e=new Error("Video playing was interrupted.");e.name="AbortError",a(e)},h=()=>{o()},u=()=>{a(new Error("Video error ".concat(e.error.code,": ").concat(e.error.message,".")))};e.addEventListener("loadstart",l,{once:!0}),e.autoplay&&["iPhone","iPad","Mac"].includes($i.OS)&&$i.version>=17?(e.addEventListener("play",h,{once:!0}),e.addEventListener("error",u,{once:!0})):(e.load(),e.play().then((()=>{o()})).catch((e=>{a(e)}))),i&&(r=setTimeout((()=>{s(),n(new Error("Failed to play video. Timeout."))}),i))}))}static async testCameraAccess(e){var t,i;if(!(null===(i=null===(t=null===window||void 0===window?void 0:window.navigator)||void 0===t?void 0:t.mediaDevices)||void 0===i?void 0:i.getUserMedia))return{ok:!1,errorName:"InsecureContext",errorMessage:"Insecure context."};let n;try{n=e?await navigator.mediaDevices.getUserMedia(e):await navigator.mediaDevices.getUserMedia({video:!0})}catch(e){return{ok:!1,errorName:e.name,errorMessage:e.message}}finally{null==n||n.getTracks().forEach((e=>{e.stop()}))}return{ok:!0}}get state(){if(!Yi(this,An,"f"))return"closed";if("pending"===Yi(this,An,"f"))return"opening";if("fulfilled"===Yi(this,An,"f"))return"opened";throw new Error("Unknown state.")}set ifSaveLastUsedCamera(e){e?sr.isStorageAvailable("localStorage")?Xi(this,En,!0,"f"):(Xi(this,En,!1,"f"),console.warn("Local storage is unavailable")):Xi(this,En,!1,"f")}get ifSaveLastUsedCamera(){return Yi(this,En,"f")}get isVideoPlaying(){return!(!Yi(this,_n,"f")||Yi(this,_n,"f").paused)&&"opened"===this.state}set tapFocusEventBoundEl(e){var t,i,n;if(!(e instanceof HTMLElement)&&null!=e)throw new TypeError("Invalid 'element'.");null===(t=Yi(this,Mn,"f"))||void 0===t||t.removeEventListener("click",Yi(this,kn,"f")),null===(i=Yi(this,Mn,"f"))||void 0===i||i.removeEventListener("touchend",Yi(this,kn,"f")),null===(n=Yi(this,Mn,"f"))||void 0===n||n.removeEventListener("touchmove",Yi(this,Ln,"f")),Xi(this,Mn,e,"f"),e&&(window.TouchEvent&&["Android","HarmonyOS","iPhone","iPad"].includes($i.OS)?(e.addEventListener("touchend",Yi(this,kn,"f")),e.addEventListener("touchmove",Yi(this,Ln,"f"))):e.addEventListener("click",Yi(this,kn,"f")))}get tapFocusEventBoundEl(){return Yi(this,Mn,"f")}get disposed(){return Yi(this,Wn,"f")}constructor(e){var t,i;mn.add(this),_n.set(this,null),vn.set(this,void 0),yn.set(this,(()=>{"opened"===this.state&&Yi(this,Bn,"f").fire("resumed",null,{target:this,async:!0})})),wn.set(this,(()=>{Yi(this,Bn,"f").fire("paused",null,{target:this,async:!1})})),bn.set(this,void 0),Cn.set(this,void 0),this.cameraOpenTimeout=4e3,this._arrCameras=[],Sn.set(this,void 0),En.set(this,!1),this.ifSkipCameraInspection=!1,this.selectIOSRearMainCameraAsDefault=!1,Tn.set(this,void 0),xn.set(this,!0),In.set(this,void 0),An.set(this,void 0),On.set(this,!1),this._focusParameters={maxTimeout:400,minTimeout:300,kTimeout:void 0,oldDistance:null,fds:null,isDoingFocus:0,taskBackToContinous:null,curFocusTaskId:0,focusCancelableTime:1500,defaultFocusAreaSizeRatio:6,focusBackToContinousTime:5e3,tapFocusMinDistance:null,tapFocusMaxDistance:null,focusArea:null,tempBufferContainer:null,defaultTempBufferContainerLenRatio:1/4},Rn.set(this,!1),this._focusSupported=!0,this.calculateCoordInVideo=(e,t)=>{let i,n;const r=window.getComputedStyle(Yi(this,_n,"f")).objectFit,s=this.getResolution(),o=Yi(this,_n,"f").getBoundingClientRect(),a=o.left,l=o.top,{width:c,height:h}=Yi(this,_n,"f").getBoundingClientRect();if(c<=0||h<=0)throw new Error("Unable to get video dimensions. Video may not be rendered on the page.");const u=c/h,d=s.width/s.height;let f=1;if("contain"===r)d>u?(f=c/s.width,i=(e-a)/f,n=(t-l-(h-c/d)/2)/f):(f=h/s.height,n=(t-l)/f,i=(e-a-(c-h*d)/2)/f);else{if("cover"!==r)throw new Error("Unsupported object-fit.");d>u?(f=h/s.height,n=(t-l)/f,i=(e-a+(h*d-c)/2)/f):(f=c/s.width,i=(e-a)/f,n=(t-l+(c/d-h)/2)/f)}return{x:i,y:n}},Dn.set(this,!1),Ln.set(this,(()=>{Xi(this,Dn,!0,"f")})),kn.set(this,(async e=>{var t;if(Yi(this,Dn,"f"))return void Xi(this,Dn,!1,"f");if(!Yi(this,Rn,"f"))return;if(!this.isVideoPlaying)return;if(!Yi(this,vn,"f"))return;if(!this._focusSupported)return;if(!this._focusParameters.fds&&(this._focusParameters.fds=null===(t=this.getCameraCapabilities())||void 0===t?void 0:t.focusDistance,!this._focusParameters.fds))return void(this._focusSupported=!1);if(null==this._focusParameters.kTimeout&&(this._focusParameters.kTimeout=(this._focusParameters.maxTimeout-this._focusParameters.minTimeout)/(1/this._focusParameters.fds.min-1/this._focusParameters.fds.max)),1==this._focusParameters.isDoingFocus)return;let i,n;if(this._focusParameters.taskBackToContinous&&(clearTimeout(this._focusParameters.taskBackToContinous),this._focusParameters.taskBackToContinous=null),e instanceof MouseEvent)i=e.clientX,n=e.clientY;else{if(!(e instanceof TouchEvent))throw new Error("Unknown event type.");if(!e.changedTouches.length)return;i=e.changedTouches[0].clientX,n=e.changedTouches[0].clientY}const r=this.getResolution(),s=2*Math.round(Math.min(r.width,r.height)/this._focusParameters.defaultFocusAreaSizeRatio/2);let o;try{o=this.calculateCoordInVideo(i,n)}catch(e){}if(o.x<0||o.x>r.width||o.y<0||o.y>r.height)return;const a={x:o.x+"px",y:o.y+"px"},l=s+"px",c=l;let h;sr._onLog&&(h=Date.now());try{await Yi(this,mn,"m",$n).call(this,a,l,c,this._focusParameters.tapFocusMinDistance,this._focusParameters.tapFocusMaxDistance)}catch(e){if(sr._onLog)throw sr._onLog(e),e}sr._onLog&&sr._onLog("Tap focus costs: ".concat(Date.now()-h," ms")),this._focusParameters.taskBackToContinous=setTimeout((()=>{var e;sr._onLog&&sr._onLog("Back to continuous focus."),null===(e=Yi(this,vn,"f"))||void 0===e||e.applyConstraints({advanced:[{focusMode:"continuous"}]}).catch((()=>{}))}),this._focusParameters.focusBackToContinousTime),Yi(this,Bn,"f").fire("tapfocus",null,{target:this,async:!0})})),Mn.set(this,null),Pn.set(this,1),Fn.set(this,{x:0,y:0}),this.updateVideoElWhenSoftwareScaled=()=>{if(!Yi(this,_n,"f"))return;const e=Yi(this,Pn,"f");if(e<1)throw new RangeError("Invalid scale value.");if(1===e)Yi(this,_n,"f").style.transform="";else{const t=window.getComputedStyle(Yi(this,_n,"f")).objectFit,i=Yi(this,_n,"f").videoWidth,n=Yi(this,_n,"f").videoHeight,{width:r,height:s}=Yi(this,_n,"f").getBoundingClientRect();if(r<=0||s<=0)throw new Error("Unable to get video dimensions. Video may not be rendered on the page.");const o=r/s,a=i/n;let l=1;"contain"===t?l=o<a?r/(i/e):s/(n/e):"cover"===t&&(l=a>o?s/(i/e):r/(n/e));const c=l*(1-1/e)*(i/2-Yi(this,Fn,"f").x),h=l*(1-1/e)*(n/2-Yi(this,Fn,"f").y);Yi(this,_n,"f").style.transform="translate(".concat(c,"px, ").concat(h,"px) scale(").concat(e,")")}},Nn.set(this,(function(){if(!(this.data instanceof Uint8Array||this.data instanceof Uint8ClampedArray))throw new TypeError("Invalid data.");if("number"!=typeof this.width||this.width<=0)throw new Error("Invalid width.");if("number"!=typeof this.height||this.height<=0)throw new Error("Invalid height.");const e=document.createElement("canvas");let t;if(e.width=this.width,e.height=this.height,this.pixelFormat===rn.GREY){t=new Uint8ClampedArray(this.width*this.height*4);for(let e=0;e<t.length;e+=4)t[e]=this.data[e/4],t[e+1]=this.data[e/4],t[e+2]=this.data[e/4],t[e+3]=255}else t=new Uint8ClampedArray(this.data.buffer);const i=new ImageData(t,this.width,this.height);return e.getContext("2d").putImageData(i,0,0),e})),Bn.set(this,void 0),jn.set(this,["before:open","opened","before:close","closed","before:camera:change","camera:changed","before:resolution:change","resolution:changed","played","paused","resumed","tapfocus"]),this.detectedResolutions=[{width:160,height:120},{width:320,height:240},{width:480,height:360},{width:640,height:480},{width:800,height:600},{width:960,height:720},{width:1280,height:720},{width:1920,height:1080},{width:2560,height:1440},{width:3840,height:2160}],Un.set(this,new Map),Vn.set(this,!1),Gn.set(this,(async()=>{var e,t;if("visible"===document.visibilityState){if(sr._onLog&&sr._onLog("document visible. video paused: "+(null===(e=Yi(this,_n,"f"))||void 0===e?void 0:e.paused)),Yi(this,Vn,"f")&&Yi(this,_n,"f")&&this.videoSrc&&"opened"===this.state)return void this.resume().catch((()=>{}));if(!this._mediaStream)return;if(this._mediaStream.active&&Yi(this,vn,"f"))if(Yi(this,vn,"f").muted&&["iPhone","iPad","Mac"].includes($i.OS)){if($i.version>=17)return;await Yi(this,mn,"m",qn).call(this)}else Yi(this,Vn,"f")&&this.resume().catch((()=>{}));else await Yi(this,mn,"m",qn).call(this)}else if("hidden"===document.visibilityState&&(sr._onLog&&sr._onLog("document hidden. video paused: "+(null===(t=Yi(this,_n,"f"))||void 0===t?void 0:t.paused)),["iPhone","iPad","Mac"].includes($i.OS)?Xi(this,Vn,!0,"f"):Xi(this,Vn,this.isVideoPlaying,"f"),this.isVideoLoaded()&&"opened"==this.state)){if(["iPhone","iPad","Mac"].includes($i.OS)&&$i.version>=17)return;this.pause()}})),Wn.set(this,!1),(null===(i=null===(t=null===window||void 0===window?void 0:window.navigator)||void 0===t?void 0:t.mediaDevices)||void 0===i?void 0:i.getUserMedia)||setTimeout((()=>{sr.onWarning&&sr.onWarning("The browser is too old or the page is loaded from an insecure origin.")}),0),this.defaultConstraints={video:{facingMode:{ideal:"environment"}}},this.resetMediaStreamConstraints(),e instanceof HTMLVideoElement&&this.setVideoEl(e),Xi(this,Bn,new nr,"f"),this.imageDataGetter=new ir,document.addEventListener("visibilitychange",Yi(this,Gn,"f"))}setVideoEl(e){if(!(e&&e instanceof HTMLVideoElement))throw new Error("Invalid 'videoEl'.");e.addEventListener("play",Yi(this,yn,"f")),e.addEventListener("pause",Yi(this,wn,"f")),Xi(this,_n,e,"f")}getVideoEl(){return Yi(this,_n,"f")}releaseVideoEl(){var e,t;null===(e=Yi(this,_n,"f"))||void 0===e||e.removeEventListener("play",Yi(this,yn,"f")),null===(t=Yi(this,_n,"f"))||void 0===t||t.removeEventListener("pause",Yi(this,wn,"f")),Xi(this,_n,null,"f")}isVideoLoaded(){return!!Yi(this,_n,"f")&&4==Yi(this,_n,"f").readyState}async open(){if(Yi(this,In,"f")&&!Yi(this,xn,"f")){if("pending"===Yi(this,An,"f"))return Yi(this,In,"f");if("fulfilled"===Yi(this,An,"f"))return}Yi(this,Bn,"f").fire("before:open",null,{target:this}),await Yi(this,mn,"m",qn).call(this),Yi(this,Bn,"f").fire("opened",null,{target:this,async:!0}),Yi(this,Bn,"f").fire("played",null,{target:this,async:!0})}async close(){if("closed"===this.state)return;Yi(this,Bn,"f").fire("before:close",null,{target:this});const e=Yi(this,In,"f");if(Yi(this,mn,"m",Kn).call(this),e&&"pending"===Yi(this,An,"f")){try{await e}catch(e){}if(!1===Yi(this,xn,"f")){const e=new Error("'close()' was interrupted.");throw e.name="AbortError",e}}Xi(this,In,null,"f"),Xi(this,An,null,"f"),Yi(this,Bn,"f").fire("closed",null,{target:this,async:!0})}pause(){if(!this.isVideoLoaded())throw new Error("Video is not loaded.");if("opened"!==this.state)throw new Error("Camera or video is not open.");Yi(this,_n,"f").pause()}async resume(){if(!this.isVideoLoaded())throw new Error("Video is not loaded.");if("opened"!==this.state)throw new Error("Camera or video is not open.");await Yi(this,_n,"f").play()}async setCamera(e){if("string"!=typeof e)throw new TypeError("Invalid 'deviceId'.");if("object"!=typeof Yi(this,bn,"f").video&&(Yi(this,bn,"f").video={}),delete Yi(this,bn,"f").video.facingMode,Yi(this,bn,"f").video.deviceId={exact:e},!("closed"===this.state||this.videoSrc||"opening"===this.state&&Yi(this,xn,"f"))){Yi(this,Bn,"f").fire("before:camera:change",[],{target:this,async:!1}),await Yi(this,mn,"m",Zn).call(this);try{this.resetSoftwareScale()}catch(e){}return Yi(this,Cn,"f")}}async switchToFrontCamera(e){if("object"!=typeof Yi(this,bn,"f").video&&(Yi(this,bn,"f").video={}),(null==e?void 0:e.resolution)&&(Yi(this,bn,"f").video.width={ideal:e.resolution.width},Yi(this,bn,"f").video.height={ideal:e.resolution.height}),delete Yi(this,bn,"f").video.deviceId,Yi(this,bn,"f").video.facingMode={exact:"user"},Xi(this,Sn,null,"f"),!("closed"===this.state||this.videoSrc||"opening"===this.state&&Yi(this,xn,"f"))){Yi(this,Bn,"f").fire("before:camera:change",[],{target:this,async:!1}),Yi(this,mn,"m",Zn).call(this);try{this.resetSoftwareScale()}catch(e){}return Yi(this,Cn,"f")}}getCamera(){var e;if(Yi(this,Cn,"f"))return Yi(this,Cn,"f");{let t=(null===(e=Yi(this,bn,"f").video)||void 0===e?void 0:e.deviceId)||"";if(t){t=t.exact||t.ideal||t;for(let e of this._arrCameras)if(e.deviceId===t)return JSON.parse(JSON.stringify(e))}return{deviceId:"",label:"",_checked:!1}}}async _getCameras(e){var t,i;if(!(null===(i=null===(t=null===window||void 0===window?void 0:window.navigator)||void 0===t?void 0:t.mediaDevices)||void 0===i?void 0:i.getUserMedia))throw new Error("Failed to access the camera because the browser is too old or the page is loaded from an insecure origin.");let n;if(e){let e=await navigator.mediaDevices.getUserMedia({video:!0});n=(await navigator.mediaDevices.enumerateDevices()).filter((e=>"videoinput"===e.kind)),e.getTracks().forEach((e=>{e.stop()}))}else n=(await navigator.mediaDevices.enumerateDevices()).filter((e=>"videoinput"===e.kind));const r=[],s=[];if(this._arrCameras)for(let o of this._arrCameras)o._checked&&s.push(o);for(let o=0;o<n.length;o++){let e,t=n[o];for(let i of s)if(t.deviceId==i.deviceId){e=i;break}e||(e={deviceId:t.deviceId,label:t.label?t.label:"camera "+o,_checked:!1}),e.deviceId&&r.push(e)}return this._arrCameras=r,sr._onLog&&sr._onLog(JSON.stringify(this._arrCameras)),r}async getCameras(){var e,t;if(!(null===(t=null===(e=null===window||void 0===window?void 0:window.navigator)||void 0===e?void 0:e.mediaDevices)||void 0===t?void 0:t.enumerateDevices))throw new Error("Failed to access the camera because the browser is too old or the page is loaded from an insecure origin.");const i=(await navigator.mediaDevices.enumerateDevices()).filter((e=>"videoinput"===e.kind));return i&&i.length&&!i[0].deviceId?this._getCameras(!0):this._getCameras(!1)}async getAllCameras(){return this.getCameras()}async setResolution(e,t,i){if("number"!=typeof e||e<=0)throw new TypeError("Invalid 'width'.");if("number"!=typeof t||t<=0)throw new TypeError("Invalid 'height'.");if("object"!=typeof Yi(this,bn,"f").video&&(Yi(this,bn,"f").video={}),i?(Yi(this,bn,"f").video.width={exact:e},Yi(this,bn,"f").video.height={exact:t}):(Yi(this,bn,"f").video.width={ideal:e},Yi(this,bn,"f").video.height={ideal:t}),"closed"===this.state||this.videoSrc||"opening"===this.state&&Yi(this,xn,"f"))return null;Yi(this,Bn,"f").fire("before:resolution:change",[],{target:this,async:!1}),await Yi(this,mn,"m",Zn).call(this);try{this.resetSoftwareScale()}catch(e){}const n=this.getResolution();return{width:n.width,height:n.height}}getResolution(){if("opened"===this.state&&this.videoSrc&&Yi(this,_n,"f"))return{width:Yi(this,_n,"f").videoWidth,height:Yi(this,_n,"f").videoHeight};if(Yi(this,vn,"f")){const e=Yi(this,vn,"f").getSettings();return{width:e.width,height:e.height}}if(this.isVideoLoaded())return{width:Yi(this,_n,"f").videoWidth,height:Yi(this,_n,"f").videoHeight};{const e={width:0,height:0};let t=Yi(this,bn,"f").video.width||0,i=Yi(this,bn,"f").video.height||0;return t&&(e.width=t.exact||t.ideal||t),i&&(e.height=i.exact||i.ideal||i),e}}async getResolutions(e){var t,i,n,r,s,o,a,l,c,h,u;if(!(null===(i=null===(t=null===window||void 0===window?void 0:window.navigator)||void 0===t?void 0:t.mediaDevices)||void 0===i?void 0:i.getUserMedia))throw new Error("Failed to access the camera because the browser is too old or the page is loaded from an insecure origin.");let d="";const f=(e,t)=>{const i=Yi(this,Un,"f").get(e);if(!i||!i.length)return!1;for(let n of i)if(n.width===t.width&&n.height===t.height)return!0;return!1};if(this._mediaStream){d=null===(u=Yi(this,Cn,"f"))||void 0===u?void 0:u.deviceId;let t=Yi(this,Un,"f").get(d);if(t&&!e)return JSON.parse(JSON.stringify(t));t=[],Yi(this,Un,"f").set(d,t),Xi(this,On,!0,"f");try{for(let e of this.detectedResolutions){await Yi(this,vn,"f").applyConstraints({width:{ideal:e.width},height:{ideal:e.height}}),Yi(this,mn,"m",Hn).call(this);const i=Yi(this,vn,"f").getSettings(),n={width:i.width,height:i.height};f(d,n)||t.push({width:n.width,height:n.height})}}catch(e){throw Yi(this,mn,"m",Kn).call(this),Xi(this,On,!1,"f"),e}try{await Yi(this,mn,"m",qn).call(this)}catch(e){if("AbortError"===e.name)return t;throw e}finally{Xi(this,On,!1,"f")}return t}{const t=async(e,t,i)=>{const n={video:{deviceId:{exact:e},width:{ideal:t},height:{ideal:i}}};let r=null;try{r=await navigator.mediaDevices.getUserMedia(n)}catch(e){return null}if(!r)return null;const s=r.getVideoTracks();let o=null;try{const e=s[0].getSettings();o={width:e.width,height:e.height}}catch(e){const t=document.createElement("video");t.srcObject=r,o={width:t.videoWidth,height:t.videoHeight},t.srcObject=null}return s.forEach((e=>{e.stop()})),o};let i=(null===(s=null===(r=null===(n=Yi(this,bn,"f"))||void 0===n?void 0:n.video)||void 0===r?void 0:r.deviceId)||void 0===s?void 0:s.exact)||(null===(l=null===(a=null===(o=Yi(this,bn,"f"))||void 0===o?void 0:o.video)||void 0===a?void 0:a.deviceId)||void 0===l?void 0:l.ideal)||(null===(h=null===(c=Yi(this,bn,"f"))||void 0===c?void 0:c.video)||void 0===h?void 0:h.deviceId);if(!i)return[];let u=Yi(this,Un,"f").get(i);if(u&&!e)return JSON.parse(JSON.stringify(u));u=[],Yi(this,Un,"f").set(i,u);for(let e of this.detectedResolutions){const n=await t(i,e.width,e.height);n&&!f(i,n)&&u.push({width:n.width,height:n.height})}return u}}async setMediaStreamConstraints(e,t){if(!(e=>{return null!==e&&"[object Object]"===(t=e,Object.prototype.toString.call(t));var t})(e))throw new TypeError("Invalid 'mediaStreamConstraints'.");Xi(this,bn,JSON.parse(JSON.stringify(e)),"f"),Xi(this,Sn,null,"f"),t&&Yi(this,mn,"m",Zn).call(this)}getMediaStreamConstraints(){return JSON.parse(JSON.stringify(Yi(this,bn,"f")))}resetMediaStreamConstraints(){Xi(this,bn,this.defaultConstraints?JSON.parse(JSON.stringify(this.defaultConstraints)):null,"f")}getCameraCapabilities(){if(!Yi(this,vn,"f")||"opened"!==this.state)throw new Error("Camera is not open.");return Yi(this,vn,"f").getCapabilities?Yi(this,vn,"f").getCapabilities():{}}getCameraSettings(){if(!Yi(this,vn,"f")||"opened"!==this.state)throw new Error("Camera is not open.");return Yi(this,vn,"f").getSettings()}async turnOnTorch(){if(!Yi(this,vn,"f")||"opened"!==this.state)throw new Error("Camera is not open.");const e=this.getCameraCapabilities();if(!(null==e?void 0:e.torch))throw Error("Not supported.");await Yi(this,vn,"f").applyConstraints({advanced:[{torch:!0}]})}async turnOffTorch(){if(!Yi(this,vn,"f")||"opened"!==this.state)throw new Error("Camera is not open.");const e=this.getCameraCapabilities();if(!(null==e?void 0:e.torch))throw Error("Not supported.");await Yi(this,vn,"f").applyConstraints({advanced:[{torch:!1}]})}async setColorTemperature(e,t){var i;if("number"!=typeof e)throw new TypeError("Invalid 'value'.");if(!Yi(this,vn,"f")||"opened"!==this.state)throw new Error("Camera is not open.");const n=null===(i=this.getCameraCapabilities())||void 0===i?void 0:i.colorTemperature;if(!n)throw Error("Not supported.");return t&&(e<n.min?e=n.min:e>n.max&&(e=n.max),e=rr(e,n.min,n.step,n.max)),await Yi(this,vn,"f").applyConstraints({advanced:[{colorTemperature:e,whiteBalanceMode:"manual"}]}),e}getColorTemperature(){return this.getCameraSettings().colorTemperature||0}async setExposureCompensation(e,t){var i;if("number"!=typeof e)throw new TypeError("Invalid 'value'.");if(!Yi(this,vn,"f")||"opened"!==this.state)throw new Error("Camera is not open.");const n=null===(i=this.getCameraCapabilities())||void 0===i?void 0:i.exposureCompensation;if(!n)throw Error("Not supported.");return t&&(e<n.min?e=n.min:e>n.max&&(e=n.max),e=rr(e,n.min,n.step,n.max)),await Yi(this,vn,"f").applyConstraints({advanced:[{exposureCompensation:e}]}),e}getExposureCompensation(){return this.getCameraSettings().exposureCompensation||0}async setFrameRate(e,t){var i;if("number"!=typeof e)throw new TypeError("Invalid 'value'.");if(!Yi(this,vn,"f")||"opened"!==this.state)throw new Error("Camera is not open.");let n=null===(i=this.getCameraCapabilities())||void 0===i?void 0:i.frameRate;if(!n)throw Error("Not supported.");t&&(e<n.min?e=n.min:e>n.max&&(e=n.max));const r=this.getResolution();return await Yi(this,vn,"f").applyConstraints({width:{ideal:Math.max(r.width,r.height)},frameRate:e}),e}getFrameRate(){return this.getCameraSettings().frameRate}async setFocus(e,t){if("object"!=typeof e||Array.isArray(e)||null==e)throw new TypeError("Invalid 'settings'.");if(!Yi(this,vn,"f")||"opened"!==this.state)throw new Error("Camera is not open.");const i=this.getCameraCapabilities(),n=null==i?void 0:i.focusMode,r=null==i?void 0:i.focusDistance;if(!n)throw Error("Not supported.");if("string"!=typeof e.mode)throw TypeError("Invalid 'mode'.");const s=e.mode.toLowerCase();if(!n.includes(s))throw Error("Unsupported focus mode.");if("manual"===s){if(!r)throw Error("Manual focus unsupported.");if(e.hasOwnProperty("distance")){let i=e.distance;t&&(i<r.min?i=r.min:i>r.max&&(i=r.max),i=rr(i,r.min,r.step,r.max)),this._focusParameters.focusArea=null,await Yi(this,vn,"f").applyConstraints({advanced:[{focusMode:s,focusDistance:i}]})}else{if(!e.area)throw new Error("'distance' or 'area' should be specified in 'manual' mode.");{const t=e.area.centerPoint;let i=e.area.width,n=e.area.height;if(!i||!n){const e=this.getResolution();i||(i=2*Math.round(Math.min(e.width,e.height)/this._focusParameters.defaultFocusAreaSizeRatio/2)+"px"),n||(n=2*Math.round(Math.min(e.width,e.height)/this._focusParameters.defaultFocusAreaSizeRatio/2)+"px")}this._focusParameters.focusArea={centerPoint:{x:t.x,y:t.y},width:i,height:n},await Yi(this,mn,"m",$n).call(this,t,i,n)}}}else this._focusParameters.focusArea=null,await Yi(this,vn,"f").applyConstraints({advanced:[{focusMode:s}]})}getFocus(){const e=this.getCameraSettings(),t=e.focusMode;return t?"manual"===t?this._focusParameters.focusArea?{mode:"manual",area:JSON.parse(JSON.stringify(this._focusParameters.focusArea))}:{mode:"manual",distance:e.focusDistance}:{mode:t}:null}async enableTapToFocus(){Xi(this,Rn,!0,"f")}disableTapToFocus(){Xi(this,Rn,!1,"f")}isTapToFocusEnabled(){return Yi(this,Rn,"f")}async setZoom(e){if("object"!=typeof e||Array.isArray(e)||null==e)throw new TypeError("Invalid 'settings'.");if("number"!=typeof e.factor)throw new TypeError("Illegal type of 'factor'.");if(e.factor<1)throw new RangeError("Invalid 'factor'.");if("opened"!==this.state)throw new Error("Video is not playing.");e.centerPoint?Yi(this,mn,"m",er).call(this,e.centerPoint):this.resetScaleCenter();try{if(Yi(this,mn,"m",tr).call(this,Yi(this,Fn,"f"))){const t=await this.setHardwareScale(e.factor,!0);let i=this.getHardwareScale();1==i&&1!=t&&(i=t),e.factor>i?this.setSoftwareScale(e.factor/i):this.setSoftwareScale(1)}else await this.setHardwareScale(1),this.setSoftwareScale(e.factor)}catch(Be){const i=Be.message||Be;if("Not supported."!==i&&"Camera is not open."!==i)throw Be;this.setSoftwareScale(e.factor)}}getZoom(){if("opened"!==this.state)throw new Error("Video is not playing.");let e=1;try{e=this.getHardwareScale()}catch(e){if("Camera is not open."!==(e.message||e))throw e}return{factor:e*Yi(this,Pn,"f")}}async resetZoom(){await this.setZoom({factor:1})}async setHardwareScale(e,t){var i;if("number"!=typeof e)throw new TypeError("Invalid 'value'.");if(e<1)throw new RangeError("Invalid 'value'.");if(!Yi(this,vn,"f")||"opened"!==this.state)throw new Error("Camera is not open.");const n=null===(i=this.getCameraCapabilities())||void 0===i?void 0:i.zoom;if(!n)throw Error("Not supported.");return t&&(e<n.min?e=n.min:e>n.max&&(e=n.max),e=rr(e,n.min,n.step,n.max)),await Yi(this,vn,"f").applyConstraints({advanced:[{zoom:e}]}),e}getHardwareScale(){return this.getCameraSettings().zoom||1}setSoftwareScale(e,t){if("number"!=typeof e)throw new TypeError("Invalid 'value'.");if(e<1)throw new RangeError("Invalid 'value'.");if("opened"!==this.state)throw new Error("Video is not playing.");t&&Yi(this,mn,"m",er).call(this,t),Xi(this,Pn,e,"f"),this.updateVideoElWhenSoftwareScaled()}getSoftwareScale(){return Yi(this,Pn,"f")}resetScaleCenter(){if("opened"!==this.state)throw new Error("Video is not playing.");const e=this.getResolution();Xi(this,Fn,{x:e.width/2,y:e.height/2},"f")}resetSoftwareScale(){this.setSoftwareScale(1),this.resetScaleCenter()}getFrameData(e){if(this.disposed)throw Error("The 'Camera' instance has been disposed.");if(!this.isVideoLoaded())return null;if(Yi(this,On,"f"))return null;const t=Date.now();sr._onLog&&sr._onLog("getFrameData() START: "+t);const i=Yi(this,_n,"f").videoWidth,n=Yi(this,_n,"f").videoHeight;let r={sx:0,sy:0,sWidth:i,sHeight:n,dWidth:i,dHeight:n};(null==e?void 0:e.position)&&(r=JSON.parse(JSON.stringify(e.position)));let s=rn.RGBA;(null==e?void 0:e.pixelFormat)&&(s=e.pixelFormat);let o=Yi(this,Pn,"f");(null==e?void 0:e.scale)&&(o=e.scale);let a=Yi(this,Fn,"f");if(null==e?void 0:e.scaleCenter){if("string"!=typeof e.scaleCenter.x||"string"!=typeof e.scaleCenter.y)throw new Error("Invalid scale center.");let t=0,r=0;if(e.scaleCenter.x.endsWith("px"))t=parseFloat(e.scaleCenter.x);else{if(!e.scaleCenter.x.endsWith("%"))throw new Error("Invalid scale center.");t=parseFloat(e.scaleCenter.x)/100*i}if(e.scaleCenter.y.endsWith("px"))r=parseFloat(e.scaleCenter.y);else{if(!e.scaleCenter.y.endsWith("%"))throw new Error("Invalid scale center.");r=parseFloat(e.scaleCenter.y)/100*n}if(isNaN(t)||isNaN(r))throw new Error("Invalid scale center.");a.x=Math.round(t),a.y=Math.round(r)}let l=null;if((null==e?void 0:e.bufferContainer)&&(l=e.bufferContainer),0==i||0==n)return null;1!==o&&(r.sWidth=Math.round(r.sWidth/o),r.sHeight=Math.round(r.sHeight/o),r.sx=Math.round((1-1/o)*a.x+r.sx/o),r.sy=Math.round((1-1/o)*a.y+r.sy/o));const c=this.imageDataGetter.getImageData(Yi(this,_n,"f"),i,n,r,{pixelFormat:s,bufferContainer:l});if(!c)return null;const h=Date.now();return sr._onLog&&sr._onLog("getFrameData() END: "+h),{data:c.data,width:c.width,height:c.height,pixelFormat:c.pixelFormat,timeSpent:h-t,timeStamp:h,toCanvas:Yi(this,Nn,"f")}}on(e,t){if(!Yi(this,jn,"f").includes(e.toLowerCase()))throw new Error("Event '".concat(e,"' does not exist."));Yi(this,Bn,"f").on(e,t)}off(e,t){Yi(this,Bn,"f").off(e,t)}async dispose(){this.tapFocusEventBoundEl=null,await this.close(),this.releaseVideoEl(),Yi(this,Bn,"f").dispose(),this.imageDataGetter.dispose(),document.removeEventListener("visibilitychange",Yi(this,Gn,"f")),Xi(this,Wn,!0,"f")}}var or,ar,lr,cr,hr,ur,dr,fr,gr,pr,mr,_r,vr,yr,wr,br,Cr,Sr,Er,Tr,xr,Ir,Ar,Or,Rr,Dr,Lr,kr,Mr,Pr,Fr,Nr,Br;_n=new WeakMap,vn=new WeakMap,yn=new WeakMap,wn=new WeakMap,bn=new WeakMap,Cn=new WeakMap,Sn=new WeakMap,En=new WeakMap,Tn=new WeakMap,xn=new WeakMap,In=new WeakMap,An=new WeakMap,On=new WeakMap,Rn=new WeakMap,Dn=new WeakMap,Ln=new WeakMap,kn=new WeakMap,Mn=new WeakMap,Pn=new WeakMap,Fn=new WeakMap,Nn=new WeakMap,Bn=new WeakMap,jn=new WeakMap,Un=new WeakMap,Vn=new WeakMap,Gn=new WeakMap,Wn=new WeakMap,mn=new WeakSet,zn=async function(){const e=this.getMediaStreamConstraints();if("boolean"==typeof e.video&&(e.video={}),e.video.deviceId);else if(Yi(this,Sn,"f"))delete e.video.facingMode,e.video.deviceId={exact:Yi(this,Sn,"f")};else if(this.ifSaveLastUsedCamera&&sr.isStorageAvailable&&window.localStorage.getItem("dce_last_camera_id")){delete e.video.facingMode,e.video.deviceId={ideal:window.localStorage.getItem("dce_last_camera_id")};const t=JSON.parse(window.localStorage.getItem("dce_last_apply_width")),i=JSON.parse(window.localStorage.getItem("dce_last_apply_height"));t&&i&&(e.video.width=t,e.video.height=i)}else if(this.ifSkipCameraInspection);else{const t=async e=>{let t=null;return"environment"===e&&["Android","HarmonyOS","iPhone","iPad"].includes($i.OS)?(await this._getCameras(!1),Yi(this,mn,"m",Hn).call(this),t=sr.findBestCamera(this._arrCameras,"environment",{getMainCameraInIOS:this.selectIOSRearMainCameraAsDefault})):e||["Android","HarmonyOS","iPhone","iPad"].includes($i.OS)||(await this._getCameras(!1),Yi(this,mn,"m",Hn).call(this),t=sr.findBestCamera(this._arrCameras,null,{getMainCameraInIOS:this.selectIOSRearMainCameraAsDefault})),t};let i=e.video.facingMode;i instanceof Array&&i.length&&(i=i[0]),"object"==typeof i&&(i=i.exact||i.ideal);const n=await t(i);n&&(delete e.video.facingMode,e.video.deviceId={exact:n})}return e},Hn=function(){if(Yi(this,xn,"f")){const e=new Error("The operation was interrupted.");throw e.name="AbortError",e}},Yn=async function(e){var t,i;if(!(null===(i=null===(t=null===window||void 0===window?void 0:window.navigator)||void 0===t?void 0:t.mediaDevices)||void 0===i?void 0:i.getUserMedia))throw new Error("Failed to access the camera because the browser is too old or the page is loaded from an insecure origin.");let n;try{sr._onLog&&sr._onLog("======try getUserMedia========");let t=[0,500],i=null;const r=async e=>{for(let r of t){r&&(await new Promise((e=>setTimeout(e,r))),Yi(this,mn,"m",Hn).call(this));try{sr._onLog&&sr._onLog("ask "+JSON.stringify(e)),n=await navigator.mediaDevices.getUserMedia(e),Yi(this,mn,"m",Hn).call(this);break}catch(e){if("NotFoundError"===e.name||"NotAllowedError"===e.name||"AbortError"===e.name||"OverconstrainedError"===e.name)throw e;i=e,sr._onLog&&sr._onLog(e.message||e)}}};if(await r(e),n||(sr._onLog&&sr._onLog("======try getUserMedia again========"),sr._onLog&&sr._onLog(e),await r(e)),n||(t=[1e3,2e3],await r(e)),n||await r(e),!n)throw i;return n}catch(e){throw null==n||n.getTracks().forEach((e=>{e.stop()})),"NotFoundError"===e.name&&(DOMException?e=new DOMException("No camera available, please use a device with an accessible camera.",e.name):(e=new Error("No camera available, please use a device with an accessible camera.")).name="NotFoundError"),e}},Xn=function(){this._mediaStream&&(this._mediaStream.getTracks().forEach((e=>{e.stop()})),this._mediaStream=null),Xi(this,vn,null,"f")},qn=async function(){Xi(this,xn,!1,"f");const e=Xi(this,Tn,Symbol(),"f");if(Yi(this,In,"f")&&"pending"===Yi(this,An,"f")){try{await Yi(this,In,"f")}catch(e){}Yi(this,mn,"m",Hn).call(this)}if(e!==Yi(this,Tn,"f"))return;const t=Xi(this,In,(async()=>{Xi(this,An,"pending","f");try{if(this.videoSrc){if(!Yi(this,_n,"f"))throw new Error("'videoEl' should be set.");await sr.playVideo(Yi(this,_n,"f"),this.videoSrc,this.cameraOpenTimeout),Yi(this,mn,"m",Hn).call(this)}else{let e=await Yi(this,mn,"m",zn).call(this);Yi(this,mn,"m",Xn).call(this);let t=await Yi(this,mn,"m",Yn).call(this,e);await this._getCameras(!1),Yi(this,mn,"m",Hn).call(this);const i=()=>{const e=t.getVideoTracks();let i,n;if(e.length&&(i=e[0]),i){const e=i.getSettings();if(e)for(let t of this._arrCameras)if(e.deviceId===t.deviceId){t._checked=!0,t.label=i.label,n=t;break}}return n},n=Yi(this,bn,"f");if("object"==typeof n.video){let r=n.video.facingMode;if(r instanceof Array&&r.length&&(r=r[0]),"object"==typeof r&&(r=r.exact||r.ideal),!(Yi(this,Sn,"f")||this.ifSaveLastUsedCamera&&sr.isStorageAvailable&&window.localStorage.getItem("dce_last_camera_id")||this.ifSkipCameraInspection||n.video.deviceId)){const n=i(),s=sr.findBestCamera(this._arrCameras,r,{getMainCameraInIOS:this.selectIOSRearMainCameraAsDefault});s&&s!=(null==n?void 0:n.deviceId)&&(t.getTracks().forEach((e=>{e.stop()})),e.video.deviceId={exact:s},t=await Yi(this,mn,"m",Yn).call(this,e),Yi(this,mn,"m",Hn).call(this))}}const r=i();(null==r?void 0:r.deviceId)&&(Xi(this,Sn,r&&r.deviceId,"f"),this.ifSaveLastUsedCamera&&sr.isStorageAvailable&&(window.localStorage.setItem("dce_last_camera_id",Yi(this,Sn,"f")),"object"==typeof e.video&&e.video.width&&e.video.height&&(window.localStorage.setItem("dce_last_apply_width",JSON.stringify(e.video.width)),window.localStorage.setItem("dce_last_apply_height",JSON.stringify(e.video.height))))),Yi(this,_n,"f")&&(await sr.playVideo(Yi(this,_n,"f"),t,this.cameraOpenTimeout),Yi(this,mn,"m",Hn).call(this)),this._mediaStream=t;const s=t.getVideoTracks();(null==s?void 0:s.length)&&Xi(this,vn,s[0],"f"),Xi(this,Cn,r,"f")}}catch(e){throw Yi(this,mn,"m",Kn).call(this),Xi(this,An,null,"f"),e}Xi(this,An,"fulfilled","f")})(),"f");return t},Zn=async function(){var e;if("closed"===this.state||this.videoSrc)return;const t=null===(e=Yi(this,Cn,"f"))||void 0===e?void 0:e.deviceId,i=this.getResolution();await Yi(this,mn,"m",qn).call(this);const n=this.getResolution();t&&t!==Yi(this,Cn,"f").deviceId&&Yi(this,Bn,"f").fire("camera:changed",[Yi(this,Cn,"f").deviceId,t],{target:this,async:!0}),i.width==n.width&&i.height==n.height||Yi(this,Bn,"f").fire("resolution:changed",[{width:n.width,height:n.height},{width:i.width,height:i.height}],{target:this,async:!0}),Yi(this,Bn,"f").fire("played",null,{target:this,async:!0})},Kn=function(){Yi(this,mn,"m",Xn).call(this),Xi(this,Cn,null,"f"),Yi(this,_n,"f")&&(Yi(this,_n,"f").srcObject=null,this.videoSrc&&(Yi(this,_n,"f").pause(),Yi(this,_n,"f").currentTime=0)),Xi(this,xn,!0,"f");try{this.resetSoftwareScale()}catch(e){}},Qn=async function e(t,i){const n=e=>{if(!Yi(this,vn,"f")||!this.isVideoPlaying||e.focusTaskId!=this._focusParameters.curFocusTaskId){Yi(this,vn,"f")&&this.isVideoPlaying||(this._focusParameters.isDoingFocus=0);const t=new Error("Focus task ".concat(e.focusTaskId," canceled."));throw t.name="DeprecatedTaskError",t}1===this._focusParameters.isDoingFocus&&Date.now()-e.timeStart>this._focusParameters.focusCancelableTime&&(this._focusParameters.isDoingFocus=-1)};let r;i=rr(i,this._focusParameters.fds.min,this._focusParameters.fds.step,this._focusParameters.fds.max),await Yi(this,vn,"f").applyConstraints({advanced:[{focusMode:"manual",focusDistance:i}]}),n(t),r=null==this._focusParameters.oldDistance?this._focusParameters.kTimeout*Math.max(Math.abs(1/this._focusParameters.fds.min-1/i),Math.abs(1/this._focusParameters.fds.max-1/i))+this._focusParameters.minTimeout:this._focusParameters.kTimeout*Math.abs(1/this._focusParameters.oldDistance-1/i)+this._focusParameters.minTimeout,this._focusParameters.oldDistance=i,await new Promise((e=>{setTimeout(e,r)})),n(t);let s=t.focusL-t.focusW/2,o=t.focusT-t.focusH/2,a=t.focusW,l=t.focusH;const c=this.getResolution();if(s>=c.width||o>=c.height)throw new Error("Invalid area.");s+a>c.width&&(a=c.width-s),o+l>c.height&&(l=c.height-o),s=Math.round(s),o=Math.round(o),a=Math.round(a),l=Math.round(l);const h=4*c.width*c.height*this._focusParameters.defaultTempBufferContainerLenRatio,u=4*a*l;let d=this._focusParameters.tempBufferContainer;if(d){const e=d.length;h>e&&h>=u?d=new Uint8Array(h):u>e&&u>=h&&(d=new Uint8Array(u))}else d=this._focusParameters.tempBufferContainer=new Uint8Array(Math.max(h,u));if(!this.imageDataGetter.getImageData(Yi(this,_n,"f"),c.width,c.height,{sx:s,sy:o,sWidth:a,sHeight:l,dWidth:a,dHeight:l},{pixelFormat:rn.RGBA,bufferContainer:d}))return Yi(this,mn,"m",e).call(this,t,i);const f=d;let g=0;for(let p=0,m=u-8;p<m;++p){let e=f[p]-f[p+8];++p;let t=f[p]-f[p+8];++p;let i=f[p]-f[p+8];++p,g+=e*e+t*t+i*i}return-g},Jn=async function e(t,i,n,r,s,o,a){let l;if(i=rr(i,this._focusParameters.fds.min,this._focusParameters.fds.step,this._focusParameters.fds.max),r=rr(r,this._focusParameters.fds.min,this._focusParameters.fds.step,this._focusParameters.fds.max),o?o=rr(o,this._focusParameters.fds.min,this._focusParameters.fds.step,this._focusParameters.fds.max):(o=rr(Math.sqrt((i||this._focusParameters.fds.step)*(r||this._focusParameters.fds.step)),this._focusParameters.fds.min,this._focusParameters.fds.step,this._focusParameters.fds.max),a=await Yi(this,mn,"m",Qn).call(this,t,o)),a<=n&&a<=s?l=3:n<s&&n<a?l=1:s<n&&s<a&&(l=2),(r-i)/2<=this._focusParameters.fds.step)return 3===l||(1===l?await Yi(this,vn,"f").applyConstraints({advanced:[{focusMode:"manual",focusDistance:i}]}):2===l&&await Yi(this,vn,"f").applyConstraints({advanced:[{focusMode:"manual",focusDistance:r}]})),!0;if(1===l)return await Yi(this,mn,"m",e).call(this,t,i,n,o,a);if(2===l)return await Yi(this,mn,"m",e).call(this,t,o,a,r,s);if(3!==l)return n=await Yi(this,mn,"m",Qn).call(this,t,i),s=await Yi(this,mn,"m",Qn).call(this,t,r),await Yi(this,mn,"m",e).call(this,t,i,n,r,s);let c=rr(Math.sqrt((i||this._focusParameters.fds.step)*(o||this._focusParameters.fds.step)),this._focusParameters.fds.min,this._focusParameters.fds.step,this._focusParameters.fds.max),h=rr(Math.sqrt((r||this._focusParameters.fds.step)*(o||this._focusParameters.fds.step)),this._focusParameters.fds.min,this._focusParameters.fds.step,this._focusParameters.fds.max);if(Math.abs(1/this._focusParameters.oldDistance-1/c)<=Math.abs(1/this._focusParameters.oldDistance-1/h)){let l=await Yi(this,mn,"m",Qn).call(this,t,c);if(l<a)return await Yi(this,mn,"m",e).call(this,t,i,n,o,a,c,l);if(l==a)return await Yi(this,mn,"m",e).call(this,t,c,l,o,a);let u=await Yi(this,mn,"m",Qn).call(this,t,h);if(l>a&&a<u)return await Yi(this,mn,"m",e).call(this,t,c,l,h,u,o,a);if(a==u)return await Yi(this,mn,"m",e).call(this,t,o,a,h,u);if(a>u)return await Yi(this,mn,"m",e).call(this,t,o,a,r,s,h,u)}else{let l=await Yi(this,mn,"m",Qn).call(this,t,h);if(a>l)return await Yi(this,mn,"m",e).call(this,t,o,a,r,s,h,l);if(a==l)return await Yi(this,mn,"m",e).call(this,t,o,a,h,l);let u=await Yi(this,mn,"m",Qn).call(this,t,c);if(u>a&&a<l)return await Yi(this,mn,"m",e).call(this,t,c,u,h,l,o,a);if(u==a)return await Yi(this,mn,"m",e).call(this,t,c,u,o,a);if(u<a)return await Yi(this,mn,"m",e).call(this,t,i,n,o,a,c,u)}return!1},$n=async function(e,t,i,n,r){var s;if(1==this._focusParameters.isDoingFocus)return!1;if(!e||"string"!=typeof e.x||"string"!=typeof e.y)throw new Error("Invalid 'centerPoint'.");if(!t||"string"!=typeof t)throw new Error("Invalid 'width'.");if(!i||"string"!=typeof i)throw new Error("Invalid 'height'.");const o=this.getResolution();let a=0,l=0;if(e.x.endsWith("px"))a=parseFloat(e.x);else{if(!e.x.endsWith("%"))throw new Error("Invalid 'centerPoint'.");a=parseFloat(e.x)/100*o.width}if(e.y.endsWith("px"))l=parseFloat(e.y);else{if(!e.y.endsWith("%"))throw new Error("Invalid 'centerPoint'.");l=parseFloat(e.y)/100*o.height}if(isNaN(a)||isNaN(l)||a<0||a>o.width||l<0||l>o.height)throw new Error("Invalid 'centerPoint'.");let c=0;if(t.endsWith("px"))c=parseFloat(t);else{if(!t.endsWith("%"))throw new Error("Invalid 'width'.");c=parseFloat(t)/100*o.width}if(isNaN(c)||c<0)throw new Error("Invalid 'width'.");let h=0;if(i.endsWith("px"))h=parseFloat(i);else{if(!i.endsWith("%"))throw new Error("Invalid 'height'.");h=parseFloat(i)/100*o.height}if(isNaN(h)||h<0)throw new Error("Invalid 'height'.");if(1!==Yi(this,Pn,"f")){const e=Yi(this,Pn,"f"),t=Yi(this,Fn,"f");c/=e,h/=e,a=(1-1/e)*t.x+a/e,l=(1-1/e)*t.y+l/e}if(!this._focusSupported)throw new Error("Manual focus unsupported.");if(!this._focusParameters.fds&&(this._focusParameters.fds=null===(s=this.getCameraCapabilities())||void 0===s?void 0:s.focusDistance,!this._focusParameters.fds))throw this._focusSupported=!1,new Error("Manual focus unsupported.");null==this._focusParameters.kTimeout&&(this._focusParameters.kTimeout=(this._focusParameters.maxTimeout-this._focusParameters.minTimeout)/(1/this._focusParameters.fds.min-1/this._focusParameters.fds.max)),this._focusParameters.isDoingFocus=1;const u={focusL:a,focusT:l,focusW:c,focusH:h,focusTaskId:++this._focusParameters.curFocusTaskId,timeStart:Date.now()},d=async(e,t,i)=>{try{(null==t||t<this._focusParameters.fds.min)&&(t=this._focusParameters.fds.min),(null==i||i>this._focusParameters.fds.max)&&(i=this._focusParameters.fds.max),this._focusParameters.oldDistance=null;let n=rr(Math.sqrt(i*(t||this._focusParameters.fds.step)),this._focusParameters.fds.min,this._focusParameters.fds.step,this._focusParameters.fds.max),r=rr(Math.sqrt((t||this._focusParameters.fds.step)*n),this._focusParameters.fds.min,this._focusParameters.fds.step,this._focusParameters.fds.max),s=rr(Math.sqrt(n*i),this._focusParameters.fds.min,this._focusParameters.fds.step,this._focusParameters.fds.max),o=await Yi(this,mn,"m",Qn).call(this,e,s),a=await Yi(this,mn,"m",Qn).call(this,e,r),l=await Yi(this,mn,"m",Qn).call(this,e,n);if(a>l&&l<o){const t=await Yi(this,mn,"m",Jn).call(this,e,r,a,s,o,n,l);return this._focusParameters.isDoingFocus=0,t}if(a<l&&a<o){let i=await Yi(this,mn,"m",Qn).call(this,e,t);const s=await Yi(this,mn,"m",Jn).call(this,e,t,i,n,l,r,a);return this._focusParameters.isDoingFocus=0,s}if(l>o&&a>o){let t=await Yi(this,mn,"m",Qn).call(this,e,i);const r=await Yi(this,mn,"m",Jn).call(this,e,n,l,i,t,s,o);return this._focusParameters.isDoingFocus=0,r}if(a==l&&l<o){const t=await Yi(this,mn,"m",Jn).call(this,e,r,a,n,l);return this._focusParameters.isDoingFocus=0,t}if(l==o&&a>l){const t=await Yi(this,mn,"m",Jn).call(this,e,n,l,s,o);return this._focusParameters.isDoingFocus=0,t}return d(e,t,i)}catch(e){if("DeprecatedTaskError"!==e.name)throw e}};return d(u,n,r)},er=function(e){if("opened"!==this.state)throw new Error("Video is not playing.");if(!e||"string"!=typeof e.x||"string"!=typeof e.y)throw new Error("Invalid 'center'.");const t=this.getResolution();let i=0,n=0;if(e.x.endsWith("px"))i=parseFloat(e.x);else{if(!e.x.endsWith("%"))throw new Error("Invalid scale center.");i=parseFloat(e.x)/100*t.width}if(e.y.endsWith("px"))n=parseFloat(e.y);else{if(!e.y.endsWith("%"))throw new Error("Invalid scale center.");n=parseFloat(e.y)/100*t.height}if(isNaN(i)||isNaN(n))throw new Error("Invalid scale center.");Xi(this,Fn,{x:i,y:n},"f")},tr=function(e){if("opened"!==this.state)throw new Error("Video is not playing.");const t=this.getResolution();return e&&e.x==t.width/2&&e.y==t.height/2},sr.browserInfo=$i,sr.onWarning=null===(pn=null===window||void 0===window?void 0:window.console)||void 0===pn?void 0:pn.warn;class jr{constructor(e){or.add(this),ar.set(this,void 0),lr.set(this,0),cr.set(this,void 0),hr.set(this,0),ur.set(this,!1),st(this,ar,e,"f")}startCharging(){rt(this,ur,"f")||(jr._onLog&&jr._onLog("start charging."),rt(this,or,"m",fr).call(this),st(this,ur,!0,"f"))}stopCharging(){rt(this,cr,"f")&&clearTimeout(rt(this,cr,"f")),rt(this,ur,"f")&&(jr._onLog&&jr._onLog("stop charging."),st(this,lr,Date.now()-rt(this,hr,"f"),"f"),st(this,ur,!1,"f"))}}ar=new WeakMap,lr=new WeakMap,cr=new WeakMap,hr=new WeakMap,ur=new WeakMap,or=new WeakSet,dr=function(){te.cfd(1),jr._onLog&&jr._onLog("charge 1.")},fr=function e(){0==rt(this,lr,"f")&&rt(this,or,"m",dr).call(this),st(this,hr,Date.now(),"f"),rt(this,cr,"f")&&clearTimeout(rt(this,cr,"f")),st(this,cr,setTimeout((()=>{st(this,lr,0,"f"),rt(this,or,"m",e).call(this)}),rt(this,ar,"f")-rt(this,lr,"f")),"f")};const Ur=new Map([[n.IPF_GRAYSCALED,rn.GREY],[n.IPF_ABGR_8888,rn.RGBA],[n.IPF_ARGB_8888,rn.BGRA]]),Vr=new Map([[rn.GREY,n.IPF_GRAYSCALED],[rn.RGBA,n.IPF_ABGR_8888],[rn.BGRA,n.IPF_ARGB_8888]]),Gr="function"==typeof BigInt?{BF_NULL:BigInt(0),BF_ALL:BigInt(0x10000000000000000),BF_DEFAULT:BigInt(4265345023),BF_ONED:BigInt(3147775),BF_GS1_DATABAR:BigInt(260096),BF_CODE_39:BigInt(1),BF_CODE_128:BigInt(2),BF_CODE_93:BigInt(4),BF_CODABAR:BigInt(8),BF_ITF:BigInt(16),BF_EAN_13:BigInt(32),BF_EAN_8:BigInt(64),BF_UPC_A:BigInt(128),BF_UPC_E:BigInt(256),BF_INDUSTRIAL_25:BigInt(512),BF_CODE_39_EXTENDED:BigInt(1024),BF_GS1_DATABAR_OMNIDIRECTIONAL:BigInt(2048),BF_GS1_DATABAR_TRUNCATED:BigInt(4096),BF_GS1_DATABAR_STACKED:BigInt(8192),BF_GS1_DATABAR_STACKED_OMNIDIRECTIONAL:BigInt(16384),BF_GS1_DATABAR_EXPANDED:BigInt(32768),BF_GS1_DATABAR_EXPANDED_STACKED:BigInt(65536),BF_GS1_DATABAR_LIMITED:BigInt(131072),BF_PATCHCODE:BigInt(262144),BF_CODE_32:BigInt(16777216),BF_PDF417:BigInt(33554432),BF_QR_CODE:BigInt(67108864),BF_DATAMATRIX:BigInt(134217728),BF_AZTEC:BigInt(268435456),BF_MAXICODE:BigInt(536870912),BF_MICRO_QR:BigInt(1073741824),BF_MICRO_PDF417:BigInt(524288),BF_GS1_COMPOSITE:BigInt(2147483648),BF_MSI_CODE:BigInt(1048576),BF_CODE_11:BigInt(2097152),BF_TWO_DIGIT_ADD_ON:BigInt(4194304),BF_FIVE_DIGIT_ADD_ON:BigInt(8388608),BF_MATRIX_25:BigInt(68719476736),BF_POSTALCODE:BigInt(0x3f0000000000000),BF_NONSTANDARD_BARCODE:BigInt(4294967296),BF_USPSINTELLIGENTMAIL:BigInt(4503599627370496),BF_POSTNET:BigInt(9007199254740992),BF_PLANET:BigInt(0x40000000000000),BF_AUSTRALIANPOST:BigInt(0x80000000000000),BF_RM4SCC:BigInt(72057594037927940),BF_KIX:BigInt(0x200000000000000),BF_DOTCODE:BigInt(8589934592),BF_PHARMACODE_ONE_TRACK:BigInt(17179869184),BF_PHARMACODE_TWO_TRACK:BigInt(34359738368),BF_PHARMACODE:BigInt(51539607552)}:{BF_NULL:"0x00",BF_ALL:"0xFFFFFFFFFFFFFFFF",BF_DEFAULT:"0xFE3BFFFF",BF_ONED:"0x003007FF",BF_GS1_DATABAR:"0x0003F800",BF_CODE_39:"0x1",BF_CODE_128:"0x2",BF_CODE_93:"0x4",BF_CODABAR:"0x8",BF_ITF:"0x10",BF_EAN_13:"0x20",BF_EAN_8:"0x40",BF_UPC_A:"0x80",BF_UPC_E:"0x100",BF_INDUSTRIAL_25:"0x200",BF_CODE_39_EXTENDED:"0x400",BF_GS1_DATABAR_OMNIDIRECTIONAL:"0x800",BF_GS1_DATABAR_TRUNCATED:"0x1000",BF_GS1_DATABAR_STACKED:"0x2000",BF_GS1_DATABAR_STACKED_OMNIDIRECTIONAL:"0x4000",BF_GS1_DATABAR_EXPANDED:"0x8000",BF_GS1_DATABAR_EXPANDED_STACKED:"0x10000",BF_GS1_DATABAR_LIMITED:"0x20000",BF_PATCHCODE:"0x00040000",BF_CODE_32:"0x01000000",BF_PDF417:"0x02000000",BF_QR_CODE:"0x04000000",BF_DATAMATRIX:"0x08000000",BF_AZTEC:"0x10000000",BF_MAXICODE:"0x20000000",BF_MICRO_QR:"0x40000000",BF_MICRO_PDF417:"0x00080000",BF_GS1_COMPOSITE:"0x80000000",BF_MSI_CODE:"0x100000",BF_CODE_11:"0x200000",BF_TWO_DIGIT_ADD_ON:"0x400000",BF_FIVE_DIGIT_ADD_ON:"0x800000",BF_MATRIX_25:"0x1000000000",BF_POSTALCODE:"0x3F0000000000000",BF_NONSTANDARD_BARCODE:"0x100000000",BF_USPSINTELLIGENTMAIL:"0x10000000000000",BF_POSTNET:"0x20000000000000",BF_PLANET:"0x40000000000000",BF_AUSTRALIANPOST:"0x80000000000000",BF_RM4SCC:"0x100000000000000",BF_KIX:"0x200000000000000",BF_DOTCODE:"0x200000000",BF_PHARMACODE_ONE_TRACK:"0x400000000",BF_PHARMACODE_TWO_TRACK:"0x800000000",BF_PHARMACODE:"0xC00000000"};class Wr extends T{static set _onLog(e){st(Wr,pr,e,"f",mr),sr._onLog=e,jr._onLog=e}static get _onLog(){return rt(Wr,pr,"f",mr)}static async detectEnvironment(){return await(async()=>({wasm:ut,worker:dt,getUserMedia:ft,camera:await gt(),browser:ht.browser,version:ht.version,OS:ht.OS}))()}static async testCameraAccess(){const e=await sr.testCameraAccess();return e.ok?{ok:!0,message:"Successfully accessed the camera."}:"InsecureContext"===e.errorName?{ok:!1,message:"Insecure context."}:"OverconstrainedError"===e.errorName||"NotFoundError"===e.errorName?{ok:!1,message:"No camera detected."}:"NotAllowedError"===e.errorName?{ok:!1,message:"No permission to access camera."}:"AbortError"===e.errorName?{ok:!1,message:"Some problem occurred which prevented the device from being used."}:"NotReadableError"===e.errorName?{ok:!1,message:"A hardware error occurred."}:"SecurityError"===e.errorName?{ok:!1,message:"User media support is disabled."}:{ok:!1,message:e.errorMessage}}static async createInstance(e){var t,i;if(e&&!(e instanceof Hi))throw new TypeError("Invalid view.");if(null===(t=Z.license)||void 0===t?void 0:t.LicenseManager){if(!(null===(i=Z.license)||void 0===i?void 0:i.LicenseManager.bCallInitLicense))throw new Error("License is not set.");await te.loadWasm(["license"]),await Z.license.dynamsoft()}const n=new Wr(e);return Wr.onWarning&&(location&&"file:"===location.protocol?setTimeout((()=>{Wr.onWarning&&Wr.onWarning({id:1,message:"The page is opened over file:// and Dynamsoft Camera Enhancer may not work properly. Please open the page via https://."})}),0):!1!==window.isSecureContext&&navigator&&navigator.mediaDevices&&navigator.mediaDevices.getUserMedia||setTimeout((()=>{Wr.onWarning&&Wr.onWarning({id:2,message:"Dynamsoft Camera Enhancer may not work properly in a non-secure context. Please open the page via https://."})}),0)),n}get video(){return rt(this,_r,"f").getVideoEl()}set videoSrc(e){if(!rt(this,_r,"f"))throw new Error("Camera manager is null.");rt(this,vr,"f")&&(rt(this,vr,"f")._hideDefaultSelection=!0),rt(this,_r,"f").videoSrc=e}get videoSrc(){var e;return null===(e=rt(this,_r,"f"))||void 0===e?void 0:e.videoSrc}set ifSaveLastUsedCamera(e){if(!rt(this,_r,"f"))throw new Error("Camera manager is null.");rt(this,_r,"f").ifSaveLastUsedCamera=e}get ifSaveLastUsedCamera(){var e;return null===(e=rt(this,_r,"f"))||void 0===e?void 0:e.ifSaveLastUsedCamera}set ifSkipCameraInspection(e){if(!rt(this,_r,"f"))throw new Error("Camera manager is null.");rt(this,_r,"f").ifSkipCameraInspection=e}get ifSkipCameraInspection(){var e;return null===(e=rt(this,_r,"f"))||void 0===e?void 0:e.ifSkipCameraInspection}set cameraOpenTimeout(e){if(!rt(this,_r,"f"))throw new Error("Camera manager is null.");rt(this,_r,"f").cameraOpenTimeout=e}get cameraOpenTimeout(){var e;return null===(e=rt(this,_r,"f"))||void 0===e?void 0:e.cameraOpenTimeout}set singleFrameMode(e){if(!["disabled","image","camera"].includes(e))throw new Error("Invalid value.");if(this.isOpen())throw new Error("It is not allowed to change `singleFrameMode` when the camera is open.");st(this,Cr,e,"f")}get singleFrameMode(){return rt(this,Cr,"f")}get _isFetchingStarted(){return rt(this,Ar,"f")}get disposed(){return rt(this,kr,"f")}constructor(e){if(super(),gr.add(this),_r.set(this,void 0),vr.set(this,void 0),yr.set(this,"closed"),wr.set(this,void 0),br.set(this,!1),Cr.set(this,void 0),this._onCameraSelChange=async()=>{this.isOpen()&&rt(this,vr,"f")&&!rt(this,vr,"f").disposed&&await this.selectCamera(rt(this,vr,"f")._selCam.value)},this._onResolutionSelChange=async()=>{if(!this.isOpen())return;if(!rt(this,vr,"f")||rt(this,vr,"f").disposed)return;let e,t;if(rt(this,vr,"f")._selRsl&&-1!=rt(this,vr,"f")._selRsl.selectedIndex){let i=rt(this,vr,"f")._selRsl.options[rt(this,vr,"f")._selRsl.selectedIndex];e=parseInt(i.getAttribute("data-width")),t=parseInt(i.getAttribute("data-height"))}await this.setResolution({width:e,height:t})},this._onCloseBtnClick=async()=>{this.isOpen()&&rt(this,vr,"f")&&!rt(this,vr,"f").disposed&&this.close()},Sr.set(this,((e,t,i,n)=>{const r=Date.now(),s={sx:n.x,sy:n.y,sWidth:n.width,sHeight:n.height,dWidth:n.width,dHeight:n.height},o=Math.max(s.dWidth,s.dHeight);if(this.canvasSizeLimit&&o>this.canvasSizeLimit){const e=this.canvasSizeLimit/o;s.dWidth>s.dHeight?(s.dWidth=this.canvasSizeLimit,s.dHeight=Math.round(s.dHeight*e)):(s.dWidth=Math.round(s.dWidth*e),s.dHeight=this.canvasSizeLimit)}const a=rt(this,_r,"f").imageDataGetter.getImageData(e,t,i,s,{pixelFormat:Ur.get(this.getPixelFormat())});let l=null;if(a){const e=Date.now();let o;o=a.pixelFormat===rn.GREY?a.width:4*a.width;let c=!0;0===s.sx&&0===s.sy&&s.sWidth===t&&s.sHeight===i&&(c=!1),l={bytes:a.data,width:a.width,height:a.height,stride:o,format:Vr.get(a.pixelFormat),tag:{imageId:this._imageId==Number.MAX_VALUE?this._imageId=0:++this._imageId,type:ae.ITT_FILE_IMAGE,isCropped:c,cropRegion:{left:n.x,top:n.y,right:n.x+n.width,bottom:n.y+n.height,isMeasuredInPercentage:!1},originalWidth:t,originalHeight:i,currentWidth:a.width,currentHeight:a.height,timeSpent:e-r,timeStamp:e},toCanvas:rt(this,Er,"f"),isDCEFrame:!0}}return l})),this._onSingleFrameAcquired=e=>{let t;t=rt(this,vr,"f")?rt(this,vr,"f").getConvertedRegion():Ft.convert(rt(this,xr,"f"),e.width,e.height),t||(t={x:0,y:0,width:e.width,height:e.height});const i=rt(this,Sr,"f").call(this,e,e.width,e.height,t);rt(this,wr,"f").fire("singleFrameAcquired",[i],{async:!1,copy:!1})},Er.set(this,(function(){if(!(this.bytes instanceof Uint8Array||this.bytes instanceof Uint8ClampedArray))throw new TypeError("Invalid bytes.");if("number"!=typeof this.width||this.width<=0)throw new Error("Invalid width.");if("number"!=typeof this.height||this.height<=0)throw new Error("Invalid height.");const e=document.createElement("canvas");let t;if(e.width=this.width,e.height=this.height,this.format===n.IPF_GRAYSCALED){t=new Uint8ClampedArray(this.width*this.height*4);for(let e=0;e<t.length;e+=4)t[e]=this.bytes[e/4],t[e+1]=this.bytes[e/4],t[e+2]=this.bytes[e/4],t[e+3]=255}else t=new Uint8ClampedArray(this.bytes.buffer);return e.getContext("2d").putImageData(new ImageData(t,this.width,this.height),0,0),e})),Tr.set(this,void 0),xr.set(this,void 0),Ir.set(this,n.IPF_ABGR_8888),Ar.set(this,!1),this._imageId=-1,Or.set(this,void 0),this.fetchInterval=0,Rr.set(this,{enhancedFocus:!1,autoZoom:!1,tapToFocus:!1}),Dr.set(this,{minValue:1,maxValue:999,autoFocusFrameArray:[],autoFocusFrameLimit:[5,3],autoZoomDetectionArea:.5,autoZoomTargetBorder:.9,autoZoomIdealArea:[0,.05],autoZoomInFrameArray:[],autoZoomInFrameLimit:[5,3],autoZoomInMaxTimes:5,autoZoomInMinStep:Math.pow(10,.2),autoZoomInIdealModuleSize:6,autoZoomOutFrameCount:0,autoZoomOutFrameLimit:3,autoZoomOutStepRate:1/3,autoZoomOutStepRate_2:.05,autoZoomOutMinStep:2,frameArrayInIdealZoom:[],frameLimitInIdealZoom:[5,3],nextActionInIdealZoom:"focus",noIntermediateResultsCount:[],enableZoomOutInIdealZoom:!1}),Lr.set(this,void 0),kr.set(this,!1),this.isCameraEnhancer=!0,e&&!(e instanceof Hi))throw new TypeError("Invalid view.");st(this,wr,new jt,"f"),st(this,_r,new sr,"f"),this._imageDataGetter=rt(this,_r,"f").imageDataGetter,rt(this,_r,"f").updateVideoElWhenSoftwareScaled=()=>{if(!this.video)return;const e=rt(this,_r,"f").getSoftwareScale();if(e<1)throw new RangeError("Invalid scale value.");rt(this,vr,"f")&&!rt(this,vr,"f").disposed?(this.video.style.transform=1===e?"":"scale(".concat(e,")"),rt(this,vr,"f")._updateVideoContainer()):this.video.style.transform=1===e?"":"scale(".concat(e,")")},["iPhone","iPad","Android","HarmonyOS"].includes(ht.OS)?rt(this,_r,"f").setResolution(1280,720):rt(this,_r,"f").setResolution(1920,1080),navigator&&navigator.mediaDevices&&navigator.mediaDevices.getUserMedia?this.singleFrameMode="disabled":this.singleFrameMode="image",e&&this.setCameraView(e),this._on("before:camera:change",(()=>{rt(this,Lr,"f").stopCharging();const e=rt(this,vr,"f");e&&!e.disposed&&(e._startLoading(),e.clearAllInnerDrawingItems())})),this._on("camera:changed",(()=>{this.clearBuffer()})),this._on("before:resolution:change",(()=>{const e=rt(this,vr,"f");e&&!e.disposed&&(e._startLoading(),e.clearAllInnerDrawingItems())})),this._on("resolution:changed",(()=>{this.clearBuffer(),e.eventHandler.fire("content:updated",null,{async:!1})})),this._on("paused",(()=>{rt(this,Lr,"f").stopCharging();const e=rt(this,vr,"f");e&&e.disposed})),this._on("resumed",(()=>{const e=rt(this,vr,"f");e&&e.disposed})),this._on("tapfocus",(()=>{rt(this,Rr,"f").tapToFocus&&rt(this,Lr,"f").startCharging()})),this._intermediateResultReceiver={},this._intermediateResultReceiver.onTaskResultsReceived=async(e,t)=>{var i,n,r,s;if(rt(this,gr,"m",Mr).call(this)||!this.isOpen()||this.isPaused())return;const o=e.intermediateResultUnits;Wr._onLog&&(Wr._onLog("intermediateResultUnits:"),Wr._onLog(o));let a=!1,l=!1;for(let c of o){if(c.unitType===he.IRUT_DECODED_BARCODES&&c.decodedBarcodes.length){a=!0;break}c.unitType===he.IRUT_LOCALIZED_BARCODES&&c.localizedBarcodes.length&&(l=!0)}if(Wr._onLog&&(Wr._onLog("hasLocalizedBarcodes:"),Wr._onLog(l)),rt(this,Rr,"f").autoZoom||rt(this,Rr,"f").enhancedFocus)if(a)rt(this,Dr,"f").autoZoomInFrameArray.length=0,rt(this,Dr,"f").autoZoomOutFrameCount=0,rt(this,Dr,"f").frameArrayInIdealZoom.length=0,rt(this,Rr,"f").autoZoom&&rt(this,Rr,"f").enhancedFocus&&(rt(this,Dr,"f").nextActionInIdealZoom="focus"),rt(this,Dr,"f").autoFocusFrameArray.length=0,rt(this,Dr,"f").noIntermediateResultsCount=0;else{const t=async e=>{await this.setZoom(e),rt(this,Rr,"f").autoZoom&&rt(this,Lr,"f").startCharging()},a=async e=>{await this.setFocus(e),rt(this,Rr,"f").enhancedFocus&&rt(this,Lr,"f").startCharging()};if(l){const l=o[0].originalImageTag,c=(null===(i=l.cropRegion)||void 0===i?void 0:i.left)||0,h=(null===(n=l.cropRegion)||void 0===n?void 0:n.top)||0,u=(null===(r=l.cropRegion)||void 0===r?void 0:r.right)?l.cropRegion.right-c:l.originalWidth,d=(null===(s=l.cropRegion)||void 0===s?void 0:s.bottom)?l.cropRegion.bottom-h:l.originalHeight,f=l.currentWidth,g=l.currentHeight;let p;{let e,t,i,n,r;{const e=this.video.videoWidth*(1-rt(this,Dr,"f").autoZoomDetectionArea)/2,t=this.video.videoWidth*(1+rt(this,Dr,"f").autoZoomDetectionArea)/2,i=t,n=e,s=this.video.videoHeight*(1-rt(this,Dr,"f").autoZoomDetectionArea)/2,o=s,a=this.video.videoHeight*(1+rt(this,Dr,"f").autoZoomDetectionArea)/2;r=[{x:e,y:s},{x:t,y:o},{x:i,y:a},{x:n,y:a}]}Wr._onLog&&(Wr._onLog("detectionArea:"),Wr._onLog(r));const s=[];{const e=(e,t)=>{const i=(e,t)=>{if(!e&&!t)throw new Error("Invalid arguments.");return function(e,t,i){let n=!1;const r=e.length;if(r<=2)return!1;for(let s=0;s<r;s++){const o=e[s],a=e[(s+1)%r];if(Ut(o,a,{x:t,y:i}))return!0;Vt(o.y-i)>0!=Vt(a.y-i)>0&&Vt(t-(i-o.y)*(o.x-a.x)/(o.y-a.y)-o.x)<0&&(n=!n)}return n}(t,e.x,e.y)},n=(e,t)=>!!(Gt([e[0],e[1]],[e[2],e[3]],[t[0].x,t[0].y],[t[1].x,t[1].y])||Gt([e[0],e[1]],[e[2],e[3]],[t[1].x,t[1].y],[t[2].x,t[2].y])||Gt([e[0],e[1]],[e[2],e[3]],[t[2].x,t[2].y],[t[3].x,t[3].y])||Gt([e[0],e[1]],[e[2],e[3]],[t[3].x,t[3].y],[t[0].x,t[0].y]));return!!(i({x:e[0].x,y:e[0].y},t)||i({x:e[1].x,y:e[1].y},t)||i({x:e[2].x,y:e[2].y},t)||i({x:e[3].x,y:e[3].y},t))||!!(i({x:t[0].x,y:t[0].y},e)||i({x:t[1].x,y:t[1].y},e)||i({x:t[2].x,y:t[2].y},e)||i({x:t[3].x,y:t[3].y},e))||!!(n([t[0].x,t[0].y,t[1].x,t[1].y],e)||n([t[1].x,t[1].y,t[2].x,t[2].y],e)||n([t[2].x,t[2].y,t[3].x,t[3].y],e)||n([t[3].x,t[3].y,t[0].x,t[0].y],e))};for(let t of o)if(t.unitType===he.IRUT_LOCALIZED_BARCODES)for(let i of t.localizedBarcodes){if(!i)continue;const t=i.location.points;t.forEach((e=>{Hi._transformCoordinates(e,c,h,u,d,f,g)})),e(r,t)&&s.push(i)}if(Wr._debug&&rt(this,vr,"f")){const e=this.__layer||(this.__layer=rt(this,vr,"f")._createDrawingLayer(99));e.clearDrawingItems();const t=this.__styleId2||(this.__styleId2=Bi.createDrawingStyle({strokeStyle:"red"}));for(let i of o)if(i.unitType===he.IRUT_LOCALIZED_BARCODES)for(let n of i.localizedBarcodes){if(!n)continue;const i=n.location.points,r=new Jt({points:i},t);e.addDrawingItems([r])}}}if(Wr._onLog&&(Wr._onLog("intersectedResults:"),Wr._onLog(s)),!s.length)return;let a;if(s.length){let e=s.filter((e=>e.possibleFormats==Gr.BF_QR_CODE||e.possibleFormats==Gr.BF_DATAMATRIX));if(e.length||(e=s.filter((e=>e.possibleFormats==Gr.BF_ONED)),e.length||(e=s)),e.length){const t=e=>{const t=e.location.points,i=(t[0].x+t[1].x+t[2].x+t[3].x)/4,n=(t[0].y+t[1].y+t[2].y+t[3].y)/4;return(i-f/2)*(i-f/2)+(n-g/2)*(n-g/2)};a=e[0];let i=t(a);if(1!=e.length)for(let n=1;n<e.length;n++){const r=t(e[n]);(e[n].confidence>1.1*a.confidence||e[n].confidence>.9*a.confidence&&r<i)&&(a=e[n],i=r)}}}if(Wr._onLog&&(Wr._onLog("highPriorityResult:"),Wr._onLog(a)),a){const r=a.location.points;e=Math.min(r[0].x,r[1].x,r[2].x,r[3].x),t=Math.max(r[0].x,r[1].x,r[2].x,r[3].x),i=Math.min(r[0].y,r[1].y,r[2].y,r[3].y),n=Math.max(r[0].y,r[1].y,r[2].y,r[3].y),p={points:[{x:e,y:i},{x:t,y:i},{x:t,y:n},{x:e,y:n}],result:a}}}if(Wr._onLog&&(Wr._onLog("boundingRect:"),Wr._onLog(p)),!p)return;if(Wr._debug&&rt(this,vr,"f")&&(null==p?void 0:p.points)){const e=this.__layer||(this.__layer=rt(this,vr,"f")._createDrawingLayer(99)),t=this.__styleId1||(this.__styleId1=Bi.createDrawingStyle({strokeStyle:"blue"})),i=new Jt({points:p.points},t);e.addDrawingItems([i])}if(rt(this,Dr,"f").autoZoomOutFrameCount=0,rt(this,Dr,"f").noIntermediateResultsCount=0,rt(this,Rr,"f").autoZoom){const i=rt(this,Dr,"f").autoZoomIdealArea[1];let n=(1-rt(this,Dr,"f").autoZoomTargetBorder)/2;const r=p.points[0].x/u,s=(u-p.points[2].x)/u,o=p.points[0].y/d,l=(d-p.points[2].y)/d;if(r>i&&s>i&&o>i&&l>i&&p.result.moduleSize<rt(this,Dr,"f").autoZoomInIdealModuleSize){if(rt(this,Dr,"f").autoZoomInFrameArray.push(!0),rt(this,Dr,"f").autoZoomInFrameArray.splice(0,rt(this,Dr,"f").autoZoomInFrameArray.length-rt(this,Dr,"f").autoZoomInFrameLimit[0]),rt(this,Dr,"f").frameArrayInIdealZoom.length=0,rt(this,Rr,"f").enhancedFocus&&(rt(this,Dr,"f").nextActionInIdealZoom="focus",a({mode:"continuous"}).catch((()=>{}))),rt(this,Dr,"f").autoZoomInFrameArray.filter((e=>!0===e)).length>=rt(this,Dr,"f").autoZoomInFrameLimit[1]){rt(this,Dr,"f").autoZoomInFrameArray.length=0;const i=[(.5-n)/(.5-r),(.5-n)/(.5-s),(.5-n)/(.5-o),(.5-n)/(.5-l)].filter((e=>e>0)),a=Math.min(...i,rt(this,Dr,"f").autoZoomInIdealModuleSize/p.result.moduleSize),c=this.getZoomSettings().factor;let h=Math.max(Math.pow(c*a,1/rt(this,Dr,"f").autoZoomInMaxTimes),rt(this,Dr,"f").autoZoomInMinStep);h=Math.min(h,a);let u=c*h;u=Math.max(rt(this,Dr,"f").minValue,u),u=Math.min(rt(this,Dr,"f").maxValue,u);try{await t({factor:u})}catch(e){const t=e.message||e;console.warn(t)}this.clearBuffer()}}else if(rt(this,Dr,"f").autoZoomInFrameArray.length=0,rt(this,Dr,"f").frameArrayInIdealZoom.push(!0),rt(this,Dr,"f").frameArrayInIdealZoom.splice(0,rt(this,Dr,"f").frameArrayInIdealZoom.length-rt(this,Dr,"f").frameLimitInIdealZoom[0]),rt(this,Dr,"f").frameArrayInIdealZoom.filter((e=>!0===e)).length>=rt(this,Dr,"f").frameLimitInIdealZoom[1])if(rt(this,Dr,"f").frameArrayInIdealZoom.length=0,"focus"===rt(this,Dr,"f").nextActionInIdealZoom&&rt(this,Rr,"f").enhancedFocus){const t=p.points;try{await a({mode:"manual",area:{centerPoint:{x:(t[0].x+t[2].x)/2+"px",y:(t[0].y+t[2].y)/2+"px"},width:t[2].x-t[0].x+"px",height:t[2].y-t[0].y+"px"}})}catch(e){const t=e.message||e;console.warn(t)}this.clearBuffer()}else{if("zoomOut"!==rt(this,Dr,"f").nextActionInIdealZoom&&rt(this,Rr,"f").enhancedFocus)throw new Error("Invalid action.");if(rt(this,Dr,"f").enableZoomOutInIdealZoom){n=rt(this,Dr,"f").autoZoomIdealArea[1]+rt(this,Dr,"f").autoZoomOutStepRate_2;const i=[(.5-n)/(.5-r),(.5-n)/(.5-s),(.5-n)/(.5-o),(.5-n)/(.5-l)].filter((e=>e>0));let c=Math.min(...i)*this.getZoomSettings().factor;c=Math.max(rt(this,Dr,"f").minValue,c),c=Math.min(rt(this,Dr,"f").maxValue,c);try{await t({factor:c})}catch(e){const t=e.message||e;console.warn(t)}this.clearBuffer(),rt(this,Rr,"f").enhancedFocus&&(rt(this,Dr,"f").nextActionInIdealZoom="focus",a({mode:"continuous"}).catch((()=>{})))}}}if(!rt(this,Rr,"f").autoZoom&&rt(this,Rr,"f").enhancedFocus&&(rt(this,Dr,"f").autoFocusFrameArray.push(!0),rt(this,Dr,"f").autoFocusFrameArray.splice(0,rt(this,Dr,"f").autoFocusFrameArray.length-rt(this,Dr,"f").autoFocusFrameLimit[0]),rt(this,Dr,"f").autoFocusFrameArray.filter((e=>!0===e)).length>=rt(this,Dr,"f").autoFocusFrameLimit[1])){rt(this,Dr,"f").autoFocusFrameArray.length=0;try{const e=p.points;await a({mode:"manual",area:{centerPoint:{x:(e[0].x+e[2].x)/2+"px",y:(e[0].y+e[2].y)/2+"px"},width:e[2].x-e[0].x+"px",height:e[2].y-e[0].y+"px"}})}catch(e){const t=e.message||e;console.warn(t)}this.clearBuffer()}}else{if(rt(this,Dr,"f").noIntermediateResultsCount++,rt(this,Rr,"f").autoZoom){if(rt(this,Dr,"f").autoZoomInFrameArray.push(!1),rt(this,Dr,"f").autoZoomInFrameArray.splice(0,rt(this,Dr,"f").autoZoomInFrameArray.length-rt(this,Dr,"f").autoZoomInFrameLimit[0]),rt(this,Dr,"f").autoZoomOutFrameCount++,rt(this,Dr,"f").frameArrayInIdealZoom.push(!1),rt(this,Dr,"f").frameArrayInIdealZoom.splice(0,rt(this,Dr,"f").frameArrayInIdealZoom.length-rt(this,Dr,"f").frameLimitInIdealZoom[0]),rt(this,Dr,"f").autoZoomOutFrameCount>=rt(this,Dr,"f").autoZoomOutFrameLimit){rt(this,Dr,"f").autoZoomOutFrameCount=0;const i=this.getZoomSettings().factor;let n=i-Math.max((i-1)*rt(this,Dr,"f").autoZoomOutStepRate,rt(this,Dr,"f").autoZoomOutMinStep);n=Math.max(rt(this,Dr,"f").minValue,n),n=Math.min(rt(this,Dr,"f").maxValue,n);try{await t({factor:n})}catch(e){const t=e.message||e;console.warn(t)}this.clearBuffer()}rt(this,Rr,"f").enhancedFocus&&(rt(this,Dr,"f").nextActionInIdealZoom="focus",a({mode:"continuous"}).catch((()=>{})))}!rt(this,Rr,"f").autoZoom&&rt(this,Rr,"f").enhancedFocus&&(rt(this,Dr,"f").autoFocusFrameArray.length=0,a({mode:"continuous"}).catch((()=>{})))}}},st(this,Lr,new jr(1e4),"f")}setCameraView(e){if(!(e instanceof Hi))throw new TypeError("Invalid view.");if(e.disposed)throw new Error("The camera view has been disposed.");if(this.isOpen())throw new Error("It is not allowed to change camera view when the camera is open.");this.releaseCameraView(),e._singleFrameMode=this.singleFrameMode,e._onSingleFrameAcquired=this._onSingleFrameAcquired,this.videoSrc&&(rt(this,vr,"f")._hideDefaultSelection=!0),rt(this,gr,"m",Mr).call(this)||rt(this,_r,"f").setVideoEl(e.getVideoElement()),st(this,vr,e,"f"),this.addListenerToView()}getCameraView(){return rt(this,vr,"f")}releaseCameraView(){rt(this,vr,"f")&&(this.removeListenerFromView(),rt(this,vr,"f").disposed||(rt(this,vr,"f")._singleFrameMode="disabled",rt(this,vr,"f")._onSingleFrameAcquired=null,rt(this,vr,"f")._hideDefaultSelection=!1),rt(this,_r,"f").releaseVideoEl(),st(this,vr,null,"f"))}addListenerToView(){if(!rt(this,vr,"f"))return;if(rt(this,vr,"f").disposed)throw new Error("'cameraView' has been disposed.");const e=rt(this,vr,"f");rt(this,gr,"m",Mr).call(this)||this.videoSrc||(e._innerComponent&&(rt(this,_r,"f").tapFocusEventBoundEl=e._innerComponent),e._selCam&&e._selCam.addEventListener("change",this._onCameraSelChange),e._selRsl&&e._selRsl.addEventListener("change",this._onResolutionSelChange)),e._btnClose&&e._btnClose.addEventListener("click",this._onCloseBtnClick)}removeListenerFromView(){if(!rt(this,vr,"f")||rt(this,vr,"f").disposed)return;const e=rt(this,vr,"f");rt(this,_r,"f").tapFocusEventBoundEl=null,e._selCam&&e._selCam.removeEventListener("change",this._onCameraSelChange),e._selRsl&&e._selRsl.removeEventListener("change",this._onResolutionSelChange),e._btnClose&&e._btnClose.removeEventListener("click",this._onCloseBtnClick)}getCameraState(){return rt(this,gr,"m",Mr).call(this)?rt(this,yr,"f"):new Map([["closed","closed"],["opening","opening"],["opened","open"]]).get(rt(this,_r,"f").state)}isOpen(){return"open"===this.getCameraState()}getVideoEl(){return this.video}async open(){const e=rt(this,vr,"f");if(null==e?void 0:e.disposed)throw new Error("'cameraView' has been disposed.");e&&(e._singleFrameMode=this.singleFrameMode,rt(this,gr,"m",Mr).call(this)?e._clickIptSingleFrameMode():(rt(this,_r,"f").setVideoEl(e.getVideoElement()),e._startLoading()));let t={width:0,height:0,deviceId:""};if(rt(this,gr,"m",Mr).call(this));else{try{await rt(this,_r,"f").open()}catch(t){throw e&&e._stopLoading(),t}rt(this,br,"f")&&this.turnOnTorch().catch((()=>{}));const i=this.getResolution();t.width=i.width,t.height=i.height,t.deviceId=this.getSelectedCamera().deviceId}return st(this,yr,"open","f"),e&&(e._innerComponent.style.display="",rt(this,gr,"m",Mr).call(this)||(e._stopLoading(),e._renderCamerasInfo(this.getSelectedCamera(),rt(this,_r,"f")._arrCameras),e._renderResolutionInfo({width:t.width,height:t.height}),e.eventHandler.fire("content:updated",null,{async:!0}),e.eventHandler.fire("videoEl:resized",null,{async:!0}))),rt(this,wr,"f").fire("opened",null,{target:this,async:!0}),t}close(){const e=rt(this,vr,"f");if(null==e?void 0:e.disposed)throw new Error("'cameraView' has been disposed.");this.stopFetching(),this.clearBuffer(),rt(this,gr,"m",Mr).call(this)||rt(this,_r,"f").close(),st(this,yr,"closed","f"),rt(this,Lr,"f").stopCharging(),e&&(e._innerComponent.style.display="none",rt(this,gr,"m",Mr).call(this)&&e._innerComponent.removeElement("content"),e._stopLoading()),rt(this,wr,"f").fire("closed",null,{target:this,async:!0})}pause(){if(rt(this,gr,"m",Mr).call(this))throw new Error("'pause()' is invalid in 'singleFrameMode'.");rt(this,_r,"f").pause()}isPaused(){var e;return!rt(this,gr,"m",Mr).call(this)&&!0===(null===(e=this.video)||void 0===e?void 0:e.paused)}async resume(){if(rt(this,gr,"m",Mr).call(this))throw new Error("'resume()' is invalid in 'singleFrameMode'.");await rt(this,_r,"f").resume()}async selectCamera(e){if(!e)throw new Error("Invalid value.");let t;t="string"==typeof e?e:e.deviceId,await rt(this,_r,"f").setCamera(t),st(this,br,!1,"f");const i=this.getResolution(),n=rt(this,vr,"f");return n&&!n.disposed&&(n._stopLoading(),n._renderCamerasInfo(this.getSelectedCamera(),rt(this,_r,"f")._arrCameras),n._renderResolutionInfo({width:i.width,height:i.height})),{width:i.width,height:i.height,deviceId:this.getSelectedCamera().deviceId}}getSelectedCamera(){return rt(this,_r,"f").getCamera()}async getAllCameras(){return rt(this,_r,"f").getCameras()}async setResolution(e){await rt(this,_r,"f").setResolution(e.width,e.height),rt(this,br,"f")&&this.turnOnTorch().catch((()=>{}));const t=this.getResolution(),i=rt(this,vr,"f");return i&&!i.disposed&&(i._stopLoading(),i._renderResolutionInfo({width:t.width,height:t.height})),{width:t.width,height:t.height,deviceId:this.getSelectedCamera().deviceId}}getResolution(){return rt(this,_r,"f").getResolution()}getAvailableResolutions(){var e;return null===(e=rt(this,_r,"f"))||void 0===e?void 0:e.getResolutions()}_on(e,t){["opened","closed","singleframeacquired","frameaddedtobuffer"].includes(e.toLowerCase())?rt(this,wr,"f").on(e,t):rt(this,_r,"f").on(e,t)}_off(e,t){["opened","closed","singleframeacquired","frameaddedtobuffer"].includes(e.toLowerCase())?rt(this,wr,"f").off(e,t):rt(this,_r,"f").off(e,t)}on(e,t){const i=e.toLowerCase(),n=new Map([["cameraopen","opened"],["cameraclose","closed"],["camerachange","camera:changed"],["resolutionchange","resolution:changed"],["played","played"],["singleframeacquired","singleFrameAcquired"],["frameaddedtobuffer","frameAddedToBuffer"]]).get(i);if(!n)throw new Error("Invalid event.");this._on(n,t)}off(e,t){const i=e.toLowerCase(),n=new Map([["cameraopen","opened"],["cameraclose","closed"],["camerachange","camera:changed"],["resolutionchange","resolution:changed"],["played","played"],["singleframeacquired","singleFrameAcquired"],["frameaddedtobuffer","frameAddedToBuffer"]]).get(i);if(!n)throw new Error("Invalid event.");this._off(n,t)}getVideoSettings(){var e;return null===(e=rt(this,_r,"f"))||void 0===e?void 0:e.getMediaStreamConstraints()}async updateVideoSettings(e){var t;await(null===(t=rt(this,_r,"f"))||void 0===t?void 0:t.setMediaStreamConstraints(e,!0))}getCapabilities(){var e;return null===(e=rt(this,_r,"f"))||void 0===e?void 0:e.getCameraCapabilities()}getCameraSettings(){return rt(this,_r,"f").getCameraSettings()}async turnOnTorch(){var e;if(rt(this,gr,"m",Mr).call(this))throw new Error("'turnOnTorch()' is invalid in 'singleFrameMode'.");await(null===(e=rt(this,_r,"f"))||void 0===e?void 0:e.turnOnTorch()),st(this,br,!0,"f")}async turnOffTorch(){var e;if(rt(this,gr,"m",Mr).call(this))throw new Error("'turnOffTorch()' is invalid in 'singleFrameMode'.");await(null===(e=rt(this,_r,"f"))||void 0===e?void 0:e.turnOffTorch()),st(this,br,!1,"f")}async setColorTemperature(e){if(rt(this,gr,"m",Mr).call(this))throw new Error("'setColorTemperature()' is invalid in 'singleFrameMode'.");await rt(this,_r,"f").setColorTemperature(e,!0)}getColorTemperature(){return rt(this,_r,"f").getColorTemperature()}async setExposureCompensation(e){var t;if(rt(this,gr,"m",Mr).call(this))throw new Error("'setExposureCompensation()' is invalid in 'singleFrameMode'.");await(null===(t=rt(this,_r,"f"))||void 0===t?void 0:t.setExposureCompensation(e,!0))}getExposureCompensation(){var e;return null===(e=rt(this,_r,"f"))||void 0===e?void 0:e.getExposureCompensation()}async _setZoom(e){var t;if(rt(this,gr,"m",Mr).call(this))throw new Error("'setZoom()' is invalid in 'singleFrameMode'.");await(null===(t=rt(this,_r,"f"))||void 0===t?void 0:t.setZoom(e))}async setZoom(e){await this._setZoom(e)}getZoomSettings(){var e;return null===(e=rt(this,_r,"f"))||void 0===e?void 0:e.getZoom()}async resetZoom(){var e;if(rt(this,gr,"m",Mr).call(this))throw new Error("'resetZoom()' is invalid in 'singleFrameMode'.");await(null===(e=rt(this,_r,"f"))||void 0===e?void 0:e.resetZoom())}async setFrameRate(e){var t;if(rt(this,gr,"m",Mr).call(this))throw new Error("'setFrameRate()' is invalid in 'singleFrameMode'.");await(null===(t=rt(this,_r,"f"))||void 0===t?void 0:t.setFrameRate(e,!0))}getFrameRate(){var e;return null===(e=rt(this,_r,"f"))||void 0===e?void 0:e.getFrameRate()}async setFocus(e){var t;if(rt(this,gr,"m",Mr).call(this))throw new Error("'setFocus()' is invalid in 'singleFrameMode'.");await(null===(t=rt(this,_r,"f"))||void 0===t?void 0:t.setFocus(e,!0))}getFocusSettings(){var e;return null===(e=rt(this,_r,"f"))||void 0===e?void 0:e.getFocus()}setAutoZoomRange(e){rt(this,Dr,"f").minValue=e.min,rt(this,Dr,"f").maxValue=e.max}getAutoZoomRange(){return{min:rt(this,Dr,"f").minValue,max:rt(this,Dr,"f").maxValue}}async enableEnhancedFeatures(e){var t,i;if(!(null===(i=null===(t=Z.license)||void 0===t?void 0:t.LicenseManager)||void 0===i?void 0:i.bPassValidation))throw new Error("License is not verified, or license is invalid.");if(0!==te.bSupportDce4Module)throw new Error("Please set a license containing the DCE module.");e&_t.EF_ENHANCED_FOCUS&&(rt(this,Rr,"f").enhancedFocus=!0),e&_t.EF_AUTO_ZOOM&&(rt(this,Rr,"f").autoZoom=!0),e&_t.EF_TAP_TO_FOCUS&&(rt(this,Rr,"f").tapToFocus=!0,rt(this,_r,"f").enableTapToFocus())}disableEnhancedFeatures(e){e&_t.EF_ENHANCED_FOCUS&&(rt(this,Rr,"f").enhancedFocus=!1,this.setFocus({mode:"continuous"}).catch((()=>{}))),e&_t.EF_AUTO_ZOOM&&(rt(this,Rr,"f").autoZoom=!1,this.resetZoom().catch((()=>{}))),e&_t.EF_TAP_TO_FOCUS&&(rt(this,Rr,"f").tapToFocus=!1,rt(this,_r,"f").disableTapToFocus()),rt(this,gr,"m",Fr).call(this)&&rt(this,gr,"m",Pr).call(this)||rt(this,Lr,"f").stopCharging()}_setScanRegion(e){if(null!=e&&!Rt(e)&&!Mt(e))throw TypeError("Invalid 'region'.");st(this,xr,e?JSON.parse(JSON.stringify(e)):null,"f"),rt(this,vr,"f")&&!rt(this,vr,"f").disposed&&rt(this,vr,"f").setScanRegion(e)}setScanRegion(e){this._setScanRegion(e),rt(this,vr,"f")&&!rt(this,vr,"f").disposed&&(null===e?rt(this,vr,"f").setScanRegionMaskVisible(!1):rt(this,vr,"f").setScanRegionMaskVisible(!0))}getScanRegion(){return JSON.parse(JSON.stringify(rt(this,xr,"f")))}setErrorListener(e){if(!e)throw new TypeError("Invalid 'listener'");st(this,Tr,e,"f")}hasNextImageToFetch(){return!("open"!==this.getCameraState()||!rt(this,_r,"f").isVideoLoaded()||rt(this,gr,"m",Mr).call(this))}startFetching(){if(rt(this,gr,"m",Mr).call(this))throw Error("'startFetching()' is unavailable in 'singleFrameMode'.");rt(this,Ar,"f")||(st(this,Ar,!0,"f"),rt(this,gr,"m",Nr).call(this))}stopFetching(){rt(this,Ar,"f")&&(Wr._onLog&&Wr._onLog("DCE: stop fetching loop: "+Date.now()),rt(this,Or,"f")&&clearTimeout(rt(this,Or,"f")),st(this,Ar,!1,"f"))}fetchImage(){if(rt(this,gr,"m",Mr).call(this))throw new Error("'fetchImage()' is unavailable in 'singleFrameMode'.");if(!this.video)throw new Error("The video element does not exist.");if(4!==this.video.readyState)throw new Error("The video is not loaded.");const e=this.getResolution();if(!(null==e?void 0:e.width)||!(null==e?void 0:e.height))throw new Error("The video is not loaded.");let t;if(t=Ft.convert(rt(this,xr,"f"),e.width,e.height),t||(t={x:0,y:0,width:e.width,height:e.height}),t.x>e.width||t.y>e.height)throw new Error("Invalid scan region.");t.x+t.width>e.width&&(t.width=e.width-t.x),t.y+t.height>e.height&&(t.height=e.height-t.y);const i={sx:t.x,sy:t.y,sWidth:t.width,sHeight:t.height,dWidth:t.width,dHeight:t.height},n=Math.max(i.dWidth,i.dHeight);if(this.canvasSizeLimit&&n>this.canvasSizeLimit){const e=this.canvasSizeLimit/n;i.dWidth>i.dHeight?(i.dWidth=this.canvasSizeLimit,i.dHeight=Math.round(i.dHeight*e)):(i.dWidth=Math.round(i.dWidth*e),i.dHeight=this.canvasSizeLimit)}const r=rt(this,_r,"f").getFrameData({position:i,pixelFormat:Ur.get(this.getPixelFormat())});if(!r)return null;let s;s=r.pixelFormat===rn.GREY?r.width:4*r.width;let o=!0;return 0===i.sx&&0===i.sy&&i.sWidth===e.width&&i.sHeight===e.height&&(o=!1),{bytes:r.data,width:r.width,height:r.height,stride:s,format:Vr.get(r.pixelFormat),tag:{imageId:this._imageId==Number.MAX_VALUE?this._imageId=0:++this._imageId,type:ae.ITT_VIDEO_FRAME,isCropped:o,cropRegion:{left:t.x,top:t.y,right:t.x+t.width,bottom:t.y+t.height,isMeasuredInPercentage:!1},originalWidth:e.width,originalHeight:e.height,currentWidth:r.width,currentHeight:r.height,timeSpent:r.timeSpent,timeStamp:r.timeStamp},toCanvas:rt(this,Er,"f"),isDCEFrame:!0}}setImageFetchInterval(e){this.fetchInterval=e,rt(this,Ar,"f")&&(rt(this,Or,"f")&&clearTimeout(rt(this,Or,"f")),st(this,Or,setTimeout((()=>{this.disposed||rt(this,gr,"m",Nr).call(this)}),e),"f"))}getImageFetchInterval(){return this.fetchInterval}setPixelFormat(e){st(this,Ir,e,"f")}getPixelFormat(){return rt(this,Ir,"f")}takePhoto(e){if(!this.isOpen())throw new Error("Not open.");if(rt(this,gr,"m",Mr).call(this))throw new Error("'takePhoto()' is unavailable in 'singleFrameMode'.");const t=document.createElement("input");t.setAttribute("type","file"),t.setAttribute("accept",".jpg,.jpeg,.icon,.gif,.svg,.webp,.png,.bmp"),t.setAttribute("capture",""),t.style.position="fixed",t.style.left="-1px",t.style.top="-1px",t.style.width="1px",t.style.height="1px",t.style.backgroundColor="transparent",t.style.color="transparent",t.addEventListener("click",(()=>{const e=this.isOpen();this.close(),window.addEventListener("focus",(()=>{e&&this.open(),t.remove()}),{once:!0})})),t.addEventListener("change",(async()=>{const i=t.files[0],n=await(async e=>{let t=null,i=null;if("undefined"!=typeof createImageBitmap)try{if(t=await createImageBitmap(e),t)return t}catch(e){}var n;return t||(i=await(n=e,new Promise(((e,t)=>{let i=URL.createObjectURL(n),r=new Image;r.src=i,r.onload=()=>{URL.revokeObjectURL(r.src),e(r)},r.onerror=e=>{t(new Error("Can't convert blob to image : "+(e instanceof Event?e.type:e)))}})))),i})(i),r=n instanceof HTMLImageElement?n.naturalWidth:n.width,s=n instanceof HTMLImageElement?n.naturalHeight:n.height;let o=Ft.convert(rt(this,xr,"f"),r,s);o||(o={x:0,y:0,width:r,height:s});const a=rt(this,Sr,"f").call(this,n,r,s,o);e&&e(a)})),document.body.appendChild(t),t.click()}convertToPageCoordinates(e){const t=rt(this,gr,"m",Br).call(this,e);return{x:t.pageX,y:t.pageY}}convertToClientCoordinates(e){const t=rt(this,gr,"m",Br).call(this,e);return{x:t.clientX,y:t.clientY}}dispose(){this.close(),rt(this,_r,"f").dispose(),this.releaseCameraView(),this.__proto__=null;for(let e in this)delete this[e];Object.defineProperty(this,"isCameraEnhancer",{value:!0}),Object.defineProperty(this,"disposed",{value:!0})}}var zr,Hr,Yr,Xr;pr=Wr,_r=new WeakMap,vr=new WeakMap,yr=new WeakMap,wr=new WeakMap,br=new WeakMap,Cr=new WeakMap,Sr=new WeakMap,Er=new WeakMap,Tr=new WeakMap,xr=new WeakMap,Ir=new WeakMap,Ar=new WeakMap,Or=new WeakMap,Rr=new WeakMap,Dr=new WeakMap,Lr=new WeakMap,kr=new WeakMap,gr=new WeakSet,Mr=function(){return"disabled"!==this.singleFrameMode},Pr=function(){return!this.videoSrc&&"opened"===rt(this,_r,"f").state},Fr=function(){for(let e in rt(this,Rr,"f"))if(1==rt(this,Rr,"f")[e])return!0;return!1},Nr=function t(){if(this.disposed)return;if("open"!==this.getCameraState()||!rt(this,Ar,"f"))return rt(this,Or,"f")&&clearTimeout(rt(this,Or,"f")),void st(this,Or,setTimeout((()=>{this.disposed||rt(this,gr,"m",t).call(this)}),this.fetchInterval),"f");const i=()=>{var e;let t;Wr._onLog&&Wr._onLog("DCE: start fetching a frame into buffer: "+Date.now());try{t=this.fetchImage()}catch(t){const i=t.message||t;if("The video is not loaded."===i)return;if(null===(e=rt(this,Tr,"f"))||void 0===e?void 0:e.onErrorReceived)return void setTimeout((()=>{var e;null===(e=rt(this,Tr,"f"))||void 0===e||e.onErrorReceived(re.EC_IMAGE_READ_FAILED,i)}),0);throw t}t?(this.addImageToBuffer(t),Wr._onLog&&Wr._onLog("DCE: finish fetching a frame into buffer: "+Date.now()),rt(this,wr,"f").fire("frameAddedToBuffer",null,{async:!0})):Wr._onLog&&Wr._onLog("DCE: get a invalid frame, abandon it: "+Date.now())};if(this.getImageCount()>=this.getMaxImageCount())switch(this.getBufferOverflowProtectionMode()){case e.BOPM_BLOCK:break;case e.BOPM_UPDATE:i()}else i();rt(this,Or,"f")&&clearTimeout(rt(this,Or,"f")),st(this,Or,setTimeout((()=>{this.disposed||rt(this,gr,"m",t).call(this)}),this.fetchInterval),"f")},Br=function(e){if(!rt(this,vr,"f"))throw new Error("Camera view is not set.");if(rt(this,vr,"f").disposed)throw new Error("'cameraView' has been disposed.");if(!this.isOpen())throw new Error("Not open.");if(!rt(this,gr,"m",Mr).call(this)&&!rt(this,_r,"f").isVideoLoaded())throw new Error("Video is not loaded.");if(rt(this,gr,"m",Mr).call(this)&&!rt(this,vr,"f")._cvsSingleFrameMode)throw new Error("No image is selected.");const t=rt(this,vr,"f")._innerComponent.getBoundingClientRect(),i=t.left,n=t.top,r=i+window.scrollX,s=n+window.scrollY,{width:o,height:a}=rt(this,vr,"f")._innerComponent.getBoundingClientRect();if(o<=0||a<=0)throw new Error("Unable to get content dimensions. Camera view may not be rendered on the page.");let l,c,h;if(rt(this,gr,"m",Mr).call(this)){const e=rt(this,vr,"f")._innerComponent.getElement("content");l=e.width,c=e.height,h="contain"}else{const e=this.getVideoEl();l=e.videoWidth,c=e.videoHeight,h=rt(this,vr,"f").getVideoFit()}const u=o/a,d=l/c;let f,g,p,m,_=1;if("contain"===h)u<d?(_=o/l,f=i+e.x*_,g=n+e.y*_+(a-c*_)/2,p=r+e.x*_,m=s+e.y*_+(a-c*_)/2):(_=a/c,f=i+e.x*_+(o-l*_)/2,g=n+e.y*_,p=r+e.x*_+(o-l*_)/2,m=s+e.y*_);else if("cover"===h)if(u<d){_=a/c;let t=e.x*_-(l*_-o)/2;t=Math.max(t,0),t=Math.min(t,o),f=i+t,g=n+e.y*_,p=r+t,m=s+e.y*_}else{_=o/l;let t=e.y*_-(c*_-a)/2;t=Math.max(t,0),t=Math.min(t,a),f=i+e.x*_,g=n+t,p=r+e.x*_,m=s+t}return{clientX:f,clientY:g,pageX:p,pageY:m}},Wr._debug=!1,mr={value:void 0},Wr.browserInfo=ht;class qr{static get beepSoundSource(){return rt(qr,zr,"f",Xr)}static set beepSoundSource(e){st(qr,zr,e,"f",Xr),st(qr,zr,new qe({src:[rt(qr,zr,"f",Xr)],onplayerror:(e,t)=>{console.warn("Sound '".concat(e,"' playback failure: ").concat(t))}}),"f",Yr)}static vibrate(){if(!navigator||!navigator.vibrate)throw new Error("Not supported.");navigator.vibrate(qr.vibrateDuration)}static beep(){rt(qr,zr,"f",Yr)&&(rt(qr,zr,"f",Yr).stop(),rt(qr,zr,"f",Yr).play())}}zr=qr,qr.vibrateDuration=300,Yr={value:new qe({src:[rt(qr,zr,"f",Hr={value:"data:audio/mpeg;base64,SUQzBAAAAAAAI1RTU0UAAAAPAAADTGF2ZjU4LjI5LjEwMAAAAAAAAAAAAAAA/+M4wAAAAAAAAAAAAEluZm8AAAAPAAAABQAAAkAAgICAgICAgICAgICAgICAgICAgKCgoKCgoKCgoKCgoKCgoKCgoKCgwMDAwMDAwMDAwMDAwMDAwMDAwMDg4ODg4ODg4ODg4ODg4ODg4ODg4P//////////////////////////AAAAAExhdmM1OC41NAAAAAAAAAAAAAAAACQEUQAAAAAAAAJAk0uXRQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA/+MYxAANQAbGeUEQAAHZYZ3fASqD4P5TKBgocg+Bw/8+CAYBA4XB9/4EBAEP4nB9+UOf/6gfUCAIKyjgQ/Kf//wfswAAAwQA/+MYxAYOqrbdkZGQAMA7DJLCsQxNOij///////////+tv///3RWiZGBEhsf/FO/+LoCSFs1dFVS/g8f/4Mhv0nhqAieHleLy/+MYxAYOOrbMAY2gABf/////////////////usPJ66R0wI4boY9/8jQYg//g2SPx1M0N3Z0kVJLIs///Uw4aMyvHJJYmPBYG/+MYxAgPMALBucAQAoGgaBoFQVBUFQWDv6gZBUFQVBUGgaBr5YSgqCoKhIGg7+IQVBUFQVBoGga//SsFSoKnf/iVTEFNRTMu/+MYxAYAAANIAAAAADEwMFVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVV"})],onplayerror:(e,t)=>{console.warn("Sound '".concat(e,"' playback failure: ").concat(t))}})},Xr={value:rt(qr,zr,"f",Hr)};const Zr=e=>e&&"object"==typeof e&&"function"==typeof e.then;class Kr extends Promise{constructor(e){let t,i;super(((e,n)=>{t=e,i=n})),this._s="pending",this.resolve=e=>{this.isPending&&(Zr(e)?this.task=e:(this._s="fulfilled",t(e)))},this.reject=e=>{this.isPending&&(this._s="rejected",i(e))},this.task=e}get status(){return this._s}get isPending(){return"pending"===this._s}get isFulfilled(){return"fulfilled"===this._s}get isRejected(){return"rejected"===this._s}get task(){return this._task}set task(e){let t;this._task=e,Zr(e)?t=e:"function"==typeof e&&(t=new Promise(e)),t&&(async()=>{try{const i=await t;e===this._task&&this.resolve(i)}catch(t){e===this._task&&this.reject(t)}})()}get isEmpty(){return null==this._task}}class Qr{constructor(){this.intermediateResultReceiverSet=new Set}addResultReceiver(e){if("object"!=typeof e)throw new Error("Invalid receiver.");this.intermediateResultReceiverSet.add(e)}removeResultReceiver(e){this.intermediateResultReceiverSet.delete(e)}}var Jr={onTaskResultsReceived:!1,onTaskResultsReceivedForDce:!1,onPredetectedRegionsReceived:!1,onLocalizedBarcodesReceived:!1,onDecodedBarcodesReceived:!1,onLocalizedTextLinesReceived:!1,onRecognizedTextLinesReceived:!1,onDetectedQuadsReceived:!1,onNormalizedImagesReceived:!1,onColourImageUnitReceived:!1,onScaledDownColourImageUnitReceived:!1,onGrayscaleImageUnitReceived:!1,onTransformedGrayscaleImageUnitReceived:!1,onEnhancedGrayscaleImageUnitReceived:!1,onBinaryImageUnitReceived:!1,onTextureDetectionResultUnitReceived:!1,onTextureRemovedGrayscaleImageUnitReceived:!1,onTextureRemovedBinaryImageUnitReceived:!1,onContoursUnitReceived:!1,onLineSegmentsUnitReceived:!1,onTextZonesUnitReceived:!1,onTextRemovedBinaryImageUnitReceived:!1,onLongLinesUnitReceived:!1,onCornersUnitReceived:!1,onCandidateQuadEdgesUnitReceived:!1,onCandidateBarcodeZonesUnitReceived:!1,onScaledUpBarcodeImageUnitReceived:!1,onDeformationResistedBarcodeImageUnitReceived:!1,onComplementedBarcodeImageUnitReceived:!1};const $r="undefined"==typeof self,es=(()=>{if(!$r&&document.currentScript){let e=document.currentScript.src,t=e.indexOf("?");if(-1!=t)e=e.substring(0,t);else{let t=e.indexOf("#");-1!=t&&(e=e.substring(0,t))}return e.substring(0,e.lastIndexOf("/")+1)}return"./"})(),ts=e=>{if(null==e&&(e="./"),$r);else{let t=document.createElement("a");t.href=e,e=t.href}return e.endsWith("/")||(e+="/"),e};var is;null==Q.cvr&&(Q.cvr=es),$.cvr={js:!0,wasm:!0},Z.cvr={};const ns="1.0.0";Q.std.version&&m(Q.std.version,ns)<0&&(Q.std.version=ns,Q.std.path=ts(es+"../../dynamsoft-capture-vision-std@".concat(ns,"/dist/")));const rs="2.0.30";Q.dip.version&&m(Q.dip.version,rs)<0&&(Q.dip.version=rs,Q.dip.path=ts(es+"../../dynamsoft-image-processing@".concat(rs,"/dist/")));class ss{static getVersion(){return this._version}}var os,as,ls,cs;async function hs(e,t){return await new Promise(((i,n)=>{let r=new XMLHttpRequest;r.open("GET",e,!0),r.responseType=t,r.send(),r.onloadend=async()=>{i(r.response)},r.onerror=()=>{n(new Error("Network Error: "+r.statusText))}}))}ss._version="2.0.31(Worker: ".concat(null===(is=q.cvr)||void 0===is?void 0:is.worker,", Wasm: loading..."),function(e){e[e.ISS_BUFFER_EMPTY=0]="ISS_BUFFER_EMPTY",e[e.ISS_EXHAUSTED=1]="ISS_EXHAUSTED"}(os||(os={})),function(e){e[e.IRUT_NULL=0]="IRUT_NULL",e[e.IRUT_COLOUR_IMAGE=1]="IRUT_COLOUR_IMAGE",e[e.IRUT_SCALED_DOWN_COLOUR_IMAGE=2]="IRUT_SCALED_DOWN_COLOUR_IMAGE",e[e.IRUT_GRAYSCALE_IMAGE=4]="IRUT_GRAYSCALE_IMAGE",e[e.IRUT_TRANSOFORMED_GRAYSCALE_IMAGE=8]="IRUT_TRANSOFORMED_GRAYSCALE_IMAGE",e[e.IRUT_ENHANCED_GRAYSCALE_IMAGE=16]="IRUT_ENHANCED_GRAYSCALE_IMAGE",e[e.IRUT_PREDETECTED_REGIONS=32]="IRUT_PREDETECTED_REGIONS",e[e.IRUT_BINARY_IMAGE=64]="IRUT_BINARY_IMAGE",e[e.IRUT_TEXTURE_DETECTION_RESULT=128]="IRUT_TEXTURE_DETECTION_RESULT",e[e.IRUT_TEXTURE_REMOVED_GRAYSCALE_IMAGE=256]="IRUT_TEXTURE_REMOVED_GRAYSCALE_IMAGE",e[e.IRUT_TEXTURE_REMOVED_BINARY_IMAGE=512]="IRUT_TEXTURE_REMOVED_BINARY_IMAGE",e[e.IRUT_CONTOURS=1024]="IRUT_CONTOURS",e[e.IRUT_LINE_SEGMENTS=2048]="IRUT_LINE_SEGMENTS",e[e.IRUT_TEXT_ZONES=4096]="IRUT_TEXT_ZONES",e[e.IRUT_TEXT_REMOVED_BINARY_IMAGE=8192]="IRUT_TEXT_REMOVED_BINARY_IMAGE",e[e.IRUT_CANDIDATE_BARCODE_ZONES=16384]="IRUT_CANDIDATE_BARCODE_ZONES",e[e.IRUT_LOCALIZED_BARCODES=32768]="IRUT_LOCALIZED_BARCODES",e[e.IRUT_SCALED_UP_BARCODE_IMAGE=65536]="IRUT_SCALED_UP_BARCODE_IMAGE",e[e.IRUT_DEFORMATION_RESISTED_BARCODE_IMAGE=131072]="IRUT_DEFORMATION_RESISTED_BARCODE_IMAGE",e[e.IRUT_COMPLEMENTED_BARCODE_IMAGE=262144]="IRUT_COMPLEMENTED_BARCODE_IMAGE",e[e.IRUT_DECODED_BARCODES=524288]="IRUT_DECODED_BARCODES",e[e.IRUT_LONG_LINES=1048576]="IRUT_LONG_LINES",e[e.IRUT_CORNERS=2097152]="IRUT_CORNERS",e[e.IRUT_CANDIDATE_QUAD_EDGES=4194304]="IRUT_CANDIDATE_QUAD_EDGES",e[e.IRUT_DETECTED_QUADS=8388608]="IRUT_DETECTED_QUADS",e[e.IRUT_LOCALIZED_TEXT_LINES=16777216]="IRUT_LOCALIZED_TEXT_LINES",e[e.IRUT_RECOGNIZED_TEXT_LINES=33554432]="IRUT_RECOGNIZED_TEXT_LINES",e[e.IRUT_NORMALIZED_IMAGES=67108864]="IRUT_NORMALIZED_IMAGES",e[e.IRUT_ALL=134217727]="IRUT_ALL"}(as||(as={})),function(e){e[e.CRIT_ORIGINAL_IMAGE=1]="CRIT_ORIGINAL_IMAGE",e[e.CRIT_BARCODE=2]="CRIT_BARCODE",e[e.CRIT_TEXT_LINE=4]="CRIT_TEXT_LINE",e[e.CRIT_DETECTED_QUAD=8]="CRIT_DETECTED_QUAD",e[e.CRIT_NORMALIZED_IMAGE=16]="CRIT_NORMALIZED_IMAGE",e[e.CRIT_PARSED_RESULT=32]="CRIT_PARSED_RESULT"}(ls||(ls={})),function(e){e[e.IPF_BINARY=0]="IPF_BINARY",e[e.IPF_BINARYINVERTED=1]="IPF_BINARYINVERTED",e[e.IPF_GRAYSCALED=2]="IPF_GRAYSCALED",e[e.IPF_NV21=3]="IPF_NV21",e[e.IPF_RGB_565=4]="IPF_RGB_565",e[e.IPF_RGB_555=5]="IPF_RGB_555",e[e.IPF_RGB_888=6]="IPF_RGB_888",e[e.IPF_ARGB_8888=7]="IPF_ARGB_8888",e[e.IPF_RGB_161616=8]="IPF_RGB_161616",e[e.IPF_ARGB_16161616=9]="IPF_ARGB_16161616",e[e.IPF_ABGR_8888=10]="IPF_ABGR_8888",e[e.IPF_ABGR_16161616=11]="IPF_ABGR_16161616",e[e.IPF_BGR_888=12]="IPF_BGR_888",e[e.IPF_BINARY_8=13]="IPF_BINARY_8",e[e.IPF_NV12=14]="IPF_NV12"}(cs||(cs={}));const us=ls;function ds(e){const t={barcodeResultItems:[],textLineResultItems:[],quadsResultItems:[],normalizedImageResultItems:[],parsedResultItems:[]};return e.items.forEach((e=>{e.type===us.CRIT_BARCODE?t.barcodeResultItems.push(e):e.type===us.CRIT_TEXT_LINE?t.textLineResultItems.push(e):e.type===us.CRIT_DETECTED_QUAD?t.quadsResultItems.push(e):e.type===us.CRIT_NORMALIZED_IMAGE?t.normalizedImageResultItems.push(e):e.type===us.CRIT_PARSED_RESULT&&t.parsedResultItems.push(e)})),t}function fs(e){let t,i=e.bytes;if(!(i&&i instanceof Uint8Array))throw Error("Parameter type error");if(Number(e.format)===cs.IPF_BGR_888){const e=i.length/3;t=new Uint8ClampedArray(4*e);for(let n=0;n<e;++n)t[4*n]=i[3*n],t[4*n+1]=i[3*n+1],t[4*n+2]=i[3*n+2],t[4*n+3]=255}else if(Number(e.format)===cs.IPF_RGB_888){const e=i.length/3;t=new Uint8ClampedArray(4*e);for(let n=0;n<e;++n)t[4*n]=i[3*n+2],t[4*n+1]=i[3*n+1],t[4*n+2]=i[3*n],t[4*n+3]=255}else if(Number(e.format)===cs.IPF_GRAYSCALED){const e=i.length;t=new Uint8ClampedArray(4*e);for(let n=0;n<e;n++)t[4*n]=t[4*n+1]=t[4*n+2]=i[n],t[4*n+3]=255}else if(Number(e.format)===cs.IPF_BINARY_8){const n=i.length,r=e.width,s=e.height,o=e.stride;t=new Uint8ClampedArray(r*s*4);for(let e=0;e<n;e++){let n=i[e],s=e%o,a=Math.floor(e/o);for(let e=0;e<8;e++){let i=s+e,o=4*(a*r+i);if(i>=r)break;t[o]=t[o+1]=t[o+2]=(128&n)/128*255,t[o+3]=255,n<<=1}}}else if(Number(e.format)===cs.IPF_ABGR_8888){const e=i.length/4;t=new Uint8ClampedArray(i.length);for(let n=0;n<e;++n)t[4*n]=i[4*n],t[4*n+1]=i[4*n+1],t[4*n+2]=i[4*n+2],t[4*n+3]=i[4*n+3]}else if(Number(e.format)===cs.IPF_ARGB_8888){const e=i.length/4;t=new Uint8ClampedArray(i.length);for(let n=0;n<e;++n)t[4*n]=i[4*n],t[4*n+1]=i[4*n+1],t[4*n+2]=i[4*n+2],t[4*n+3]=i[4*n+3]}return new ImageData(t,e.width,e.height)}function gs(e,t){let i=e;i.toCanvas=()=>ps(t),i.toImage=e=>function(e,t){const i=ps(t);let n=new Image,r=i.toDataURL(e);return n.src=r,n}(e,t),i.toBlob=e=>ms(e,t),i.saveToFile=async(e,i)=>{if(!e)return null;if("string"!=typeof e)throw new TypeError("FileName must be of type string.");return async function(e,t,i){return await new Promise((async(n,r)=>{try{const r=t.split(".");let s=r[r.length-1];const o=await ms("image/".concat(s),e);r.length<=1&&(s="png");const a=new File([o],t,{type:"image/".concat(s)});if(i){const e=URL.createObjectURL(a),i=document.createElement("a");i.href=e,i.download=t,i.click()}return n(a)}catch(e){return r()}}))}(t,e,i)}}function ps(e){const t=document.createElement("canvas");return t.width=e.width,t.height=e.height,t.getContext("2d",{willReadFrequently:!0}).putImageData(e,0,0),t}async function ms(e,t){const i=ps(t);return new Promise(((t,n)=>{i.toBlob((e=>t(e)),e)}))}const _s="function"==typeof BigInt;class vs{constructor(){this._maxCvsSideLength=["iPhone","Android","HarmonyOS"].includes(te.browserInfo.OS)?2048:4096,this._isa=null,this._dsImage=null,this._instanceID=void 0,this._bPauseScan=!0,this._bNeedOutputOriginalImage=!1,this._canvas=null,this._irrRegistryState=Jr,this._resultReceiverSet=new Set,this._isaStateListenerSet=new Set,this._resultFilterSet=new Set,this._intermediateResultReceiverSet=new Set,this._intermediateResultManager=null,this._templateName="Default",this._bOpenDetectVerify=!1,this._bOpenNormalizeVerify=!1,this._bOpenBarcodeVerify=!1,this._bOpenLabelVerify=!1,this._minImageCaptureInterval=0,this._averageProcessintTimeArray=[],this._averageFetchImageTimeArray=[],this._currentSettings=null,this._averageTime=999,this.captureInParallel=!0,this.bDestroyed=!1,this._singleFrameModeCallbackBind=this._singleFrameModeCallback.bind(this),this._promiseStartScan=null}get maxCvsSideLength(){return this._maxCvsSideLength}set maxCvsSideLength(e){this._maxCvsSideLength=e}get isa(){return this._isa}set isa(e){this._isa=e}get disposed(){return this.bDestroyed}_checkIsDisposed(){if(this.disposed)throw new Error('"CaptureVisionRouter" instance has been disposed')}static async createInstance(){if(!Z.license)throw Error("Module `license` is not existed.");await Z.license.dynamsoft(),await ee(["dip","cvr"]);const e=new vs,t=new Kr;let i=z();return H[i]=async i=>{var n;if(i.success)e._instanceID=i.instanceID,e._currentSettings=await e.outputSettings("*"),ss._version="2.0.31(Worker: ".concat(null===(n=q.cvr)||void 0===n?void 0:n.worker,", Wasm: ").concat(i.version,")"),0===te.bSupportDce4Module&&(e._intermediateResultManager=e.getIntermediateResultManager(!0)),t.resolve(e);else{const e=Error(i.message);i.stack&&(e.stack=i.stack),t.reject(e)}},G.postMessage({type:"cvr_createInstance",id:i}),t}async _singleFrameModeCallback(e){this.isa.getCameraView().setScanLaserVisible(!0);for(let s of this._resultReceiverSet)this._bNeedOutputOriginalImage&&s.onOriginalImageResultReceived&&s.onOriginalImageResultReceived({imageData:e});const t={bytes:new Uint8Array(e.bytes),width:e.width,height:e.height,stride:e.stride,format:e.format,tag:e.tag},i=await this.capture(t,this._templateName,!0);i.originalImageTag=e.tag;for(let s of this._resultReceiverSet)s.isDce&&s.onCapturedResultReceived(i,{isDetectVerifyOpen:!1,isNormalizeVerifyOpen:!1,isBarcodeVerifyOpen:!1,isLabelVerifyOpen:!1});const n={originalImageHashId:i.originalImageHashId,originalImageTag:i.originalImageTag,errorCode:i.errorCode,errorString:i.errorString},r=ds(i);for(let s of this._resultReceiverSet)if(s.onDecodedBarcodesReceived&&r.barcodeResultItems.length&&s.onDecodedBarcodesReceived(Object.assign(Object.assign({},n),{barcodeResultItems:r.barcodeResultItems})),s.onRecognizedTextLinesReceived&&r.textLineResultItems.length&&s.onRecognizedTextLinesReceived(Object.assign(Object.assign({},n),{textLineResultItems:r.textLineResultItems})),s.onDetectedQuadsReceived&&r.quadsResultItems.length&&s.onDetectedQuadsReceived(Object.assign(Object.assign({},n),{quadsResultItems:r.quadsResultItems})),s.onNormalizedImagesReceived&&r.normalizedImageResultItems.length&&s.onNormalizedImagesReceived(Object.assign(Object.assign({},n),{normalizedImageResultItems:r.normalizedImageResultItems})),s.onParsedResultsReceived&&r.parsedResultItems.length&&s.onParsedResultsReceived(Object.assign(Object.assign({},n),{parsedResultItems:r.parsedResultItems})),s.onCapturedResultReceived&&!s.isDce){if(this._bNeedOutputOriginalImage){const t=i.items.findIndex((e=>1===e.type));-1!==t&&(i.items[t].imageData=e)}s.onCapturedResultReceived(i)}}setInput(e){if(this._checkIsDisposed(),e){if(this.isa=e,e.isCameraEnhancer){this._intermediateResultManager&&(this.isa._intermediateResultReceiver.isDce=!0,this._intermediateResultManager.addResultReceiver(this.isa._intermediateResultReceiver));const e=this.isa.getCameraView();if(e){const t=e._capturedResultReceiver;t.isDce=!0,this._resultReceiverSet.add(t)}}}else this.isa=null}getInput(){return this._isa}addImageSourceStateListener(e){if(this._checkIsDisposed(),"object"!=typeof e)return console.warn("Invalid ISA state listener.");e&&Object.keys(e)&&this._isaStateListenerSet.add(e)}removeImageSourceStateListener(e){return this._checkIsDisposed(),this._isaStateListenerSet.delete(e)}addResultReceiver(e){if(this._checkIsDisposed(),"object"!=typeof e)throw new Error("Invalid receiver.");e&&Object.keys(e).length&&(this._resultReceiverSet.add(e),this._setCrrRegistry())}removeResultReceiver(e){this._checkIsDisposed(),this._resultReceiverSet.delete(e),this._setCrrRegistry()}async _setCrrRegistry(){const e={onCapturedResultReceived:!1,onDecodedBarcodesReceived:!1,onRecognizedTextLinesReceived:!1,onDetectedQuadsReceived:!1,onNormalizedImagesReceived:!1,onParsedResultsReceived:!1};for(let n of this._resultReceiverSet)n.isDce||(e.onCapturedResultReceived=!!n.onCapturedResultReceived,e.onDecodedBarcodesReceived=!!n.onDecodedBarcodesReceived,e.onRecognizedTextLinesReceived=!!n.onRecognizedTextLinesReceived,e.onDetectedQuadsReceived=!!n.onDetectedQuadsReceived,e.onNormalizedImagesReceived=!!n.onNormalizedImagesReceived,e.onParsedResultsReceived=!!n.onParsedResultsReceived);const t=new Kr;let i=z();return H[i]=async e=>{if(e.success)t.resolve();else{let i=new Error(e.message);i.stack=e.stack+"\n"+i.stack,t.reject()}},G.postMessage({type:"cvr_setCrrRegistry",id:i,instanceID:this._instanceID,body:{receiver:JSON.stringify(e)}}),t}async addResultFilter(e){if(this._checkIsDisposed(),"object"!=typeof e)return console.warn("Invalid filter.");if(e&&Object.keys(e)){this._resultFilterSet.add(e),this._handleFilterSwitch();for(let e of this._resultFilterSet)await this._enableResultCrossVerification(e.verificationEnabled),await this._enableResultDeduplication(e.duplicateFilterEnabled),await this._setDuplicateForgetTime(e.duplicateForgetTime)}}async removeResultFilter(e){this._checkIsDisposed(),this._resultFilterSet.delete(e),this._handleFilterSwitch();for(let t of this._resultFilterSet)await this._enableResultCrossVerification(t.verificationEnabled),await this._enableResultDeduplication(t.duplicateFilterEnabled),await this._setDuplicateForgetTime(t.duplicateForgetTime)}_handleFilterSwitch(){this._bOpenBarcodeVerify=!1,this._bOpenLabelVerify=!1,this._bOpenDetectVerify=!1,this._bOpenNormalizeVerify=!1;for(let e of this._resultFilterSet)e.isResultCrossVerificationEnabled(ie.CRIT_BARCODE)&&(this._bOpenBarcodeVerify=!0),e.isResultCrossVerificationEnabled(ie.CRIT_TEXT_LINE)&&(this._bOpenLabelVerify=!0),e.isResultCrossVerificationEnabled(ie.CRIT_DETECTED_QUAD)&&(this._bOpenDetectVerify=!0),e.isResultCrossVerificationEnabled(ie.CRIT_NORMALIZED_IMAGE)&&(this._bOpenNormalizeVerify=!0)}async startCapturing(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"Default";if(this._checkIsDisposed(),!this._bPauseScan)return;if(!this.isa)throw new Error("'ImageSourceAdapter' is not set. call 'setInput' before 'startCapturing'");const i=await this.containsTask(e);return await ee(i),this.isa.isCameraEnhancer&&(i.includes("ddn")?this.isa.setPixelFormat(n.IPF_ABGR_8888):this.isa.setPixelFormat(n.IPF_GRAYSCALED)),void 0!==this.isa.singleFrameMode&&"disabled"!==this.isa.singleFrameMode?(this._templateName=e,void this.isa.on("singleFrameAcquired",this._singleFrameModeCallbackBind)):(this.isa.getColourChannelUsageType()===t.CCUT_AUTO&&this.isa.setColourChannelUsageType(i.includes("ddn")?t.CCUT_FULL_CHANNEL:t.CCUT_Y_CHANNEL_ONLY),this._promiseStartScan&&this._promiseStartScan.isPending?this._promiseStartScan:(this._promiseStartScan=new Kr(((t,i)=>{if(this.disposed)return;let n=z();H[n]=async n=>{if(this._promiseStartScan&&!this._promiseStartScan.isFulfilled){if(!n.success){let e=new Error(n.message);return e.stack=n.stack+"\n"+e.stack,i(e)}for(let e of this._resultFilterSet)await this.addResultFilter(e);this._bPauseScan=!1,this._bNeedOutputOriginalImage=n.bNeedOutputOriginalImage,this._loopReadVideoTimeoutId&&clearTimeout(this._loopReadVideoTimeoutId),this._loopReadVideoTimeoutId=setTimeout((async()=>{-1!==this._minImageCaptureInterval&&this.isa.startFetching(),this._loopReadVideo(e),t()}),0),this.isa.isCameraEnhancer&&this.isa.getCameraView().setScanLaserVisible(!0)}},G.postMessage({type:"cvr_startCapturing",id:n,instanceID:this._instanceID,body:{templateName:e}})})),await this._promiseStartScan))}stopCapturing(){this._checkIsDisposed(),this.isa&&(this.isa.isCameraEnhancer&&(this.isa.getCameraView().setScanLaserVisible(!1),void 0!==this.isa.singleFrameMode&&"disabled"!==this.isa.singleFrameMode)?this.isa.off("singleFrameAcquired",this._singleFrameModeCallbackBind):(this.isa.stopFetching(),this._clearVerifyList(),this._averageProcessintTimeArray=[],this._averageTime=999,this._bPauseScan=!0,this._promiseStartScan=null,this.isa.setColourChannelUsageType(t.CCUT_AUTO)))}async _clearVerifyList(){let e=z();const t=new Kr;return H[e]=async e=>{if(e.success)return t.resolve();{let i=new Error(e.message);return i.stack=e.stack+"\n"+i.stack,t.reject(i)}},G.postMessage({type:"cvr_clearVerifyList",id:e,instanceID:this._instanceID}),t}async _getIntermediateResult(){this._checkIsDisposed();let e=z();const t=new Kr;return H[e]=async e=>{if(e.success)t.resolve(e.result);else{let i=new Error(e.message);i.stack=e.stack+"\n"+i.stack,t.reject(i)}},G.postMessage({type:"cvr_getIntermediateResult",id:e,instanceID:this._instanceID}),t}async containsTask(e){return this._checkIsDisposed(),await new Promise(((t,i)=>{let n=z();H[n]=async e=>{if(e.success)return t(JSON.parse(e.tasks));{let t=new Error(e.message);return t.stack=e.stack+"\n"+t.stack,i(t)}},G.postMessage({type:"cvr_containsTask",id:n,instanceID:this._instanceID,body:{templateName:e}})}))}async _loopReadVideo(e){if(this.disposed||this._bPauseScan)return;if(this.isa.isBufferEmpty())if(this.isa.hasNextImageToFetch())for(let n of this._isaStateListenerSet)n.onImageSourceStateReceived&&n.onImageSourceStateReceived(os.ISS_BUFFER_EMPTY);else if(!this.isa.hasNextImageToFetch())for(let n of this._isaStateListenerSet)n.onImageSourceStateReceived&&n.onImageSourceStateReceived(os.ISS_EXHAUSTED);if(-1===this._minImageCaptureInterval||this.isa.isBufferEmpty())try{this.isa.isBufferEmpty()&&vs._onLog&&vs._onLog("buffer is empty so fetch image"),vs._onLog&&vs._onLog("DCE: start fetching a frame: ".concat(Date.now())),this._dsImage=this.isa.fetchImage(),vs._onLog&&vs._onLog("DCE: finish fetching a frame: ".concat(Date.now())),this.isa.setImageFetchInterval(this._averageTime)}catch(t){return void this._reRunCurrnetFunc(e)}else if(this.isa.setImageFetchInterval(this._averageTime-(this._dsImage&&this._dsImage.tag?this._dsImage.tag.timeSpent:0)),this._dsImage=this.isa.getImage(),this._dsImage.tag&&Date.now()-this._dsImage.tag.timeStamp>200)return void this._reRunCurrnetFunc(e);if(!this._dsImage)return void this._reRunCurrnetFunc(e);for(let n of this._resultReceiverSet)this._bNeedOutputOriginalImage&&n.onOriginalImageResultReceived&&n.onOriginalImageResultReceived({imageData:this._dsImage});const t=Date.now();let i=null;this._captureDsimage(this._dsImage,e,!0).then((async n=>{if(vs._onLog&&vs._onLog("no js handle time: "+(Date.now()-t)),i=n,this._bPauseScan)return void this._reRunCurrnetFunc(e);const r=Date.now(),s=i.intermediateResult;if(s){if(s.taskSet)for(let e of s.taskSet.intermediateResultUnits)e.originalImageTag=this._dsImage.tag?this._dsImage.tag:null;for(let e of this._intermediateResultReceiverSet){if(s.taskSet&&e.onTaskResultsReceived&&e.onTaskResultsReceived({intermediateResultUnits:s.taskSet.intermediateResultUnits},s.taskSet.info),s.sectionSet)for(let t in s.sectionSet){for(let i of s.sectionSet[t].asStage)e[t]&&e[t](i.result,i.info);for(let i of s.sectionSet[t].asSection)e[t]&&e[t](i.result,i.info)}if(s.stageSet)for(let t in s.stageSet)for(let i of s.stageSet[t])e[t]&&e[t](i.result,i.info)}}i.originalImageTag=this._dsImage.tag?this._dsImage.tag:null;for(let e of this._resultReceiverSet)if(e.isDce){const t=Date.now();if(e.onCapturedResultReceived(i,{isDetectVerifyOpen:this._bOpenDetectVerify,isNormalizeVerifyOpen:this._bOpenNormalizeVerify,isBarcodeVerifyOpen:this._bOpenBarcodeVerify,isLabelVerifyOpen:this._bOpenLabelVerify}),vs._onLog){const e=Date.now()-t;e>10&&vs._onLog("draw result time: ".concat(e))}}for(let e of this._resultFilterSet)e.onDecodedBarcodesReceived(i.items),e.onRecognizedTextLinesReceived(i.items),e.onDetectedQuadsReceived(i.items),e.onNormalizedImagesReceived(i.items);const o=ds(i),a={originalImageHashId:i.originalImageHashId,originalImageTag:i.originalImageTag,errorCode:i.errorCode,errorString:i.errorString};for(let e of this._resultReceiverSet)e.onDecodedBarcodesReceived&&o.barcodeResultItems.length&&e.onDecodedBarcodesReceived(Object.assign(Object.assign({},a),{barcodeResultItems:o.barcodeResultItems.filter((e=>!e.isFilter))})),e.onRecognizedTextLinesReceived&&o.textLineResultItems.length&&e.onRecognizedTextLinesReceived(Object.assign(Object.assign({},a),{textLineResultItems:o.textLineResultItems.filter((e=>!e.isFilter))})),e.onDetectedQuadsReceived&&o.quadsResultItems.length&&e.onDetectedQuadsReceived(Object.assign(Object.assign({},a),{quadsResultItems:o.quadsResultItems.filter((e=>!e.isFilter))})),e.onNormalizedImagesReceived&&o.normalizedImageResultItems.length&&e.onNormalizedImagesReceived(Object.assign(Object.assign({},a),{normalizedImageResultItems:o.normalizedImageResultItems.filter((e=>!e.isFilter))})),e.onParsedResultsReceived&&o.parsedResultItems.length&&e.onParsedResultsReceived(Object.assign(Object.assign({},a),{parsedResultItems:o.parsedResultItems.filter((e=>!e.isFilter))})),e.onCapturedResultReceived&&!e.isDce&&(i.items=i.items.filter((e=>!e.isFilter)),e.onCapturedResultReceived(i));if(vs._onLog){const e=Date.now()-r;e>10&&vs._onLog("callback dispatch time: ".concat(e))}const l=Date.now();if(this._minImageCaptureInterval>-1&&(5===this._averageProcessintTimeArray.length&&this._averageProcessintTimeArray.shift(),5===this._averageFetchImageTimeArray.length&&this._averageFetchImageTimeArray.shift(),this._averageProcessintTimeArray.push(Date.now()-t),this._averageFetchImageTimeArray.push(this._dsImage&&this._dsImage.tag?this._dsImage.tag.timeSpent:0),this._averageTime=Math.min(...this._averageProcessintTimeArray)-Math.max(...this._averageFetchImageTimeArray),this._averageTime=this._averageTime>0?this._averageTime:0,vs._onLog&&(vs._onLog("minImageCaptureInterval: ".concat(this._minImageCaptureInterval)),vs._onLog("averageProcessintTimeArray: ".concat(this._averageProcessintTimeArray)),vs._onLog("averageFetchImageTimeArray: ".concat(this._averageFetchImageTimeArray)),vs._onLog("averageTime: ".concat(this._averageTime)))),vs._onLog){const e=Date.now()-l;e>10&&vs._onLog("fetch image calculate time: ".concat(e))}vs._onLog&&vs._onLog("time finish decode: ".concat(Date.now())),vs._onLog&&vs._onLog("main time: "+(Date.now()-t)),vs._onLog&&vs._onLog("===================================================="),this._loopReadVideoTimeoutId&&clearTimeout(this._loopReadVideoTimeoutId),this._minImageCaptureInterval>0&&this._minImageCaptureInterval>=this._averageTime?this._loopReadVideoTimeoutId=setTimeout((()=>{this._loopReadVideo(e)}),this._minImageCaptureInterval-this._averageTime):this._loopReadVideoTimeoutId=setTimeout((()=>{this._loopReadVideo(e)}),Math.max(this._minImageCaptureInterval,0))})).catch((t=>{this.isa.stopFetching(),this._loopReadVideoTimeoutId&&clearTimeout(this._loopReadVideoTimeoutId),this._loopReadVideoTimeoutId=setTimeout((()=>{this.isa.startFetching(),this._loopReadVideo(e)}),Math.max(this._minImageCaptureInterval,1e3)),"platform error"!==t.message&&setTimeout((()=>{throw t}),0)})).finally((()=>{i&&i.intermediateResult&&delete i.intermediateResult}))}_reRunCurrnetFunc(e){this._loopReadVideoTimeoutId&&clearTimeout(this._loopReadVideoTimeoutId),this._loopReadVideoTimeoutId=setTimeout((()=>{this._loopReadVideo(e)}),0)}async capture(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"Default",i=arguments.length>2&&void 0!==arguments[2]&&arguments[2];this._checkIsDisposed();const n=await this.containsTask(t);let r;if(await ee(n),(s=e)&&"object"==typeof s&&!Array.isArray(s)&&"bytes"in s&&"width"in s&&"height"in s&&"stride"in s&&"format"in s)r=await this._captureDsimage(e,t,i);else if("string"==typeof e)r="data:image/"==e.substring(0,11)?await this._captureBase64(e,t,i):await this._captureUrl(e,t,i);else if(e instanceof Blob)r=await this._captureBlob(e,t,i);else if(e instanceof HTMLImageElement)r=await this._captureImage(e,t,i);else if(e instanceof HTMLCanvasElement)r=await this._captureCanvas(e,t,i);else if(e instanceof HTMLVideoElement)r=await this._captureVideo(e,t,i);else{if(!(e instanceof Uint8Array||e instanceof ArrayBuffer||e instanceof Uint8ClampedArray))throw new TypeError("'capture(imageOrFile, templateName)': Type of 'imageOrFile' should be 'DSImageData', 'Url', 'Base64', 'Blob', 'Uint8Array', 'ArrayBuffer', 'Uint8ClampedArray', 'HTMLImageElement', 'HTMLCanvasElement', 'HTMLVideoElement'.");r=await this._captureBlob(new Blob([new Uint8Array(e)],{type:"image/png"}),t,i)}var s;const o=await this._getIntermediateResult();if(o)for(let a of this._intermediateResultReceiverSet){if(o.taskSet&&a.onTaskResultsReceived&&a.onTaskResultsReceived({intermediateResultUnits:o.taskSet.intermediateResultUnits},o.taskSet.info),o.sectionSet)for(let e in o.sectionSet){for(let t of o.sectionSet[e].asStage)a[e]&&a[e](t.result,t.info);for(let t of o.sectionSet[e].asSection)a[e]&&a[e](t.result,t.info)}if(o.stageSet)for(let e in o.stageSet)for(let t of o.stageSet[e])a[e]&&a[e](t.result,t.info)}return r}async _captureDsimage(e,t){let i=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return await this._captureInWorker(e,t,i)}async _captureUrl(e,t){let i=arguments.length>2&&void 0!==arguments[2]&&arguments[2],n=await hs(e,"blob");return await this._captureBlob(n,t,i)}async _captureBase64(e,t){let i=arguments.length>2&&void 0!==arguments[2]&&arguments[2];e=e.substring(e.indexOf(",")+1);let n=atob(e),r=n.length,s=new Uint8Array(r);for(;r--;)s[r]=n.charCodeAt(r);return await this._captureBlob(new Blob([s]),t,i)}async _captureBlob(e,t){let i=arguments.length>2&&void 0!==arguments[2]&&arguments[2],n=null,r=null;if("undefined"!=typeof createImageBitmap)try{n=await createImageBitmap(e)}catch(e){}n||(r=await async function(e){return await new Promise(((t,i)=>{let n=URL.createObjectURL(e),r=new Image;r.src=n,r.onload=()=>{URL.revokeObjectURL(r.dbrObjUrl),t(r)},r.onerror=e=>{i(new Error("Can't convert blob to image : "+(e instanceof Event?e.type:e)))}}))}(e));let s=await this._captureImage(n||r,t,i);return n&&n.close(),s}async _captureImage(e,t){let i,n,r=arguments.length>2&&void 0!==arguments[2]&&arguments[2],s=e instanceof HTMLImageElement?e.naturalWidth:e.width,o=e instanceof HTMLImageElement?e.naturalHeight:e.height,a=Math.max(s,o);if(a>this.maxCvsSideLength){let e=this.maxCvsSideLength/a;i=Math.round(s*e),n=Math.round(o*e)}else i=s,n=o;this._canvas||(this._canvas=document.createElement("canvas"));const l=this._canvas;return l.width===i&&l.height===n||(l.width=i,l.height=n),l.ctx2d||(l.ctx2d=l.getContext("2d",{willReadFrequently:!0})),l.ctx2d.drawImage(e,0,0,s,o,0,0,i,n),e.dbrObjUrl&&URL.revokeObjectURL(e.dbrObjUrl),await this._captureCanvas(l,t,r)}async _captureCanvas(e,t){let i=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(e.crossOrigin&&"anonymous"!=e.crossOrigin)throw"cors";if([e.width,e.height].includes(0))throw Error("The width or height of the 'canvas' is 0.");const n=e.ctx2d||e.getContext("2d",{willReadFrequently:!0}),r={bytes:Uint8Array.from(n.getImageData(0,0,e.width,e.height).data),width:e.width,height:e.height,stride:4*e.width,format:10};return await this._captureInWorker(r,t,i)}async _captureVideo(e,t){let i=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(e.crossOrigin&&"anonymous"!=e.crossOrigin)throw"cors";let n,r,s=e.videoWidth,o=e.videoHeight,a=Math.max(s,o);if(a>this._maxCvsSideLength){let e=this._maxCvsSideLength/a;n=Math.round(s*e),r=Math.round(o*e)}else n=s,r=o;this._canvas||(this._canvas=document.createElement("canvas"));const l=this._canvas;return l.width===n&&l.height===r||(l.width=n,l.height=r),l.ctx2d||(l.ctx2d=l.getContext("2d",{willReadFrequently:!0})),l.ctx2d.drawImage(e,0,0,s,o,0,0,n,r),await this._captureCanvas(l,t,i)}async _captureInWorker(e,t){let i=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const{bytes:n,width:r,height:s,stride:o,format:a}=e;let l=z();const c=new Kr;return H[l]=async t=>{var i;if(!t.success){let e=new Error(t.message);return e.stack=t.stack+"\n"+e.stack,c.reject(e)}{const n=Date.now();vs._onLog&&(vs._onLog("get result time from worker: ".concat(n)),vs._onLog("worker to main time consume: "+(n-t.workerReturnMsgTime)));try{const n=t.captureResult;e.bytes=t.bytes;for(let t=0;t<n.items.length;t++)if(n.items[t].type===ie.CRIT_NORMALIZED_IMAGE){const e=fs(n.items[t].imageData);gs(n.items[t],e)}else n.items[t].type===ie.CRIT_ORIGINAL_IMAGE?n.items[t].imageData=e:n.items[t].type===ie.CRIT_PARSED_RESULT&&(null===(i=Z.dcp)||void 0===i||i.handleParsedResultItem(n.items[t]));return c.resolve(n)}catch(e){return c.reject(e)}}},vs._onLog&&vs._onLog("send buffer to worker: ".concat(Date.now())),G.postMessage({type:"cvr_capture",id:l,instanceID:this._instanceID,body:{bytes:n,width:r,height:s,stride:o,format:a,templateName:t||"",bScanner:i}},[n.buffer]),c}async initSettings(e){return this._checkIsDisposed(),e&&["string","object"].includes(typeof e)?("string"==typeof e&&(/^(https:\/\/www\.|http:\/\/www\.|https:\/\/|http:\/\/)|^[a-zA-Z0-9]{2,}(\.[a-zA-Z0-9]{2,})(\.[a-zA-Z0-9]{2,})?/.test(e)&&(e=await hs(e,"text")),this._currentSettings=JSON.parse(e)),"object"==typeof e&&(this._currentSettings=e,e=JSON.stringify(e)),await new Promise(((t,i)=>{let n=z();H[n]=async n=>{if(n.success){const r=JSON.parse(n.response);if(0!==r.exception){let e=new Error(r.description?r.description:"Init Settings Failed.");return e.errorCode=r.exception,i(e)}let s=[],o=JSON.parse(e).CaptureVisionTemplates;for(let e=0;e<o.length;e++){let t=await this.containsTask(o[e].Name);s=s.concat(t)}return await ee([...new Set(s)]),this._bNeedOutputOriginalImage=1===this._currentSettings.CaptureVisionTemplates[0].OutputOriginalImage,t(r)}{let e=new Error(n.message);return e.stack=n.stack+"\n"+e.stack,i(e)}},G.postMessage({type:"cvr_initSettings",id:n,instanceID:this._instanceID,body:{settings:e}})}))):console.error("Invalid template.")}async outputSettings(e){return this._checkIsDisposed(),await new Promise(((t,i)=>{let n=z();H[n]=async e=>{if(e.success){const n=JSON.parse(e.settings);if(0!==n.errorCode){let e=new Error(n.errorString);return e.errorCode=n.errorCode,i(e)}return delete n.errorCode,delete n.errorString,t(n)}{let t=new Error(e.message);return t.stack=e.stack+"\n"+t.stack,i(t)}},G.postMessage({type:"cvr_outputSettings",id:n,instanceID:this._instanceID,body:{templateName:e||"Default"}})}))}async outputSettingsToFile(e,t,i){const n=await this.outputSettings(e),r=new Blob([JSON.stringify(n,null,2,(function(e,t){return t instanceof Array?JSON.stringify(t):t}),2)],{type:"application/json"});if(i){const e=document.createElement("a");e.href=URL.createObjectURL(r),t.endsWith(".json")&&(t=t.replace(".json","")),e.download="".concat(t,".json"),e.onclick=()=>{setTimeout((()=>{URL.revokeObjectURL(e.href)}),500)},e.click()}return r}async getSimplifiedSettings(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"Default";this._checkIsDisposed();const t=await this.containsTask(e);return await ee(t),await new Promise(((t,i)=>{let n=z();H[n]=async e=>{if(e.success){const n=JSON.parse(e.settings,((e,t)=>_s&&"barcodeFormatIds"===e?BigInt(t):t));if(n.minImageCaptureInterval=this._minImageCaptureInterval,0!==n.code){let e=new Error(n.codeString);return e.errorCode=n.errorCode,i(e)}return delete n.code,delete n.codeString,t(n)}{let t=new Error(e.message);return t.stack=e.stack+"\n"+t.stack,i(t)}},G.postMessage({type:"cvr_getSimplifiedSettings",id:n,instanceID:this._instanceID,body:{templateName:e}})}))}async updateSettings(e,t){this._checkIsDisposed();const i=await this.containsTask(e);return await ee(i),await new Promise(((i,n)=>{let r=z();H[r]=async e=>{if(e.success){const r=JSON.parse(e.response);if(t.minImageCaptureInterval&&t.minImageCaptureInterval>=-1&&(this._minImageCaptureInterval=t.minImageCaptureInterval),this._bNeedOutputOriginalImage=e.bNeedOutputOriginalImage,0!==r.exception){let e=new Error(r.description?r.description:"Update Settings Failed.");return e.errorCode=r.exception,n(e)}return this._currentSettings=await this.outputSettings("*"),i(r)}{let t=new Error(e.message);return t.stack=e.stack+"\n"+t.stack,n(t)}},G.postMessage({type:"cvr_updateSettings",id:r,instanceID:this._instanceID,body:{settings:t,templateName:e}})}))}async resetSettings(){return this._checkIsDisposed(),await new Promise(((e,t)=>{let i=z();H[i]=async i=>{if(i.success){const n=JSON.parse(i.response);if(0!==n.exception){let e=new Error(n.description?n.description:"Reset Settings Failed.");return e.errorCode=n.exception,t(e)}return this._currentSettings=await this.outputSettings("*"),e(n)}{let e=new Error(i.message);return e.stack=i.stack+"\n"+e.stack,t(e)}},G.postMessage({type:"cvr_resetSettings",id:i,instanceID:this._instanceID})}))}getIntermediateResultManager(e){if(this._checkIsDisposed(),!e&&0!==te.bSupportIRTModule)throw new Error("The current license does not support the use of intermediate results.");return this._intermediateResultManager||(this._intermediateResultManager=new Qr,this._intermediateResultManager.addResultReceiver=async e=>{if("object"!=typeof e)throw new Error("Invalid receiver.");return this._intermediateResultReceiverSet.add(e),this._handleIntermediateResultReceiver(),await(async()=>await new Promise(((e,t)=>{let i=z();H[i]=async i=>{if(i.success)return e();{let e=new Error(i.message);return e.stack=i.stack+"\n"+e.stack,t(e)}},G.postMessage({type:"cvr_setIrrRegistry",id:i,instanceID:this._instanceID,body:{receiverObj:this._irrRegistryState}})})))()},this._intermediateResultManager.removeResultReceiver=async e=>(this._intermediateResultReceiverSet.delete(e),this._handleIntermediateResultReceiver(),await new Promise(((e,t)=>{let i=z();H[i]=async i=>{if(i.success)return e();{let e=new Error(i.message);return e.stack=i.stack+"\n"+e.stack,t(e)}},G.postMessage({type:"cvr_setIrrRegistry",id:i,instanceID:this._instanceID,body:{receiverObj:this._irrRegistryState}})}))),this._intermediateResultManager.getOriginalImage=async e=>this._dsImage),this._intermediateResultManager}_handleIntermediateResultReceiver(){for(let e in this._irrRegistryState)this._irrRegistryState[e]=!1;for(let e of this._intermediateResultReceiverSet)if(e.isDce)this._irrRegistryState.onTaskResultsReceivedForDce=!0;else for(let t in e)this._irrRegistryState[t]||(this._irrRegistryState[t]=!!e[t])}async _enableResultCrossVerification(e){return this._checkIsDisposed(),await new Promise(((t,i)=>{let n=z();H[n]=async e=>{if(e.success)return t(e.result);{let t=new Error(e.message);return t.stack=e.stack+"\n"+t.stack,i(t)}},G.postMessage({type:"cvr_enableResultCrossVerification",id:n,instanceID:this._instanceID,body:{verificationEnabled:e}})}))}async _enableResultDeduplication(e){return this._checkIsDisposed(),await new Promise(((t,i)=>{let n=z();H[n]=async e=>{if(e.success)return t(e.result);{let t=new Error(e.message);return t.stack=e.stack+"\n"+t.stack,i(t)}},G.postMessage({type:"cvr_enableResultDeduplication",id:n,instanceID:this._instanceID,body:{duplicateFilterEnabled:e}})}))}async _setDuplicateForgetTime(e){return this._checkIsDisposed(),await new Promise(((t,i)=>{let n=z();H[n]=async e=>{if(e.success)return t(e.result);{let t=new Error(e.message);return t.stack=e.stack+"\n"+t.stack,i(t)}},G.postMessage({type:"cvr_setDuplicateForgetTime",id:n,instanceID:this._instanceID,body:{duplicateForgetTime:e}})}))}async _getDuplicateForgetTime(e){return this._checkIsDisposed(),await new Promise(((t,i)=>{let n=z();H[n]=async e=>{if(e.success)return t(e.time);{let t=new Error(e.message);return t.stack=e.stack+"\n"+t.stack,i(t)}},G.postMessage({type:"cvr_getDuplicateForgetTime",id:n,instanceID:this._instanceID,body:{type:e}})}))}async parseRequiredResources(e){return this._checkIsDisposed(),await new Promise(((t,i)=>{let n=z();H[n]=async e=>{if(e.success)return t(JSON.parse(e.resources));{let t=new Error(e.message);return t.stack=e.stack+"\n"+t.stack,i(t)}},G.postMessage({type:"cvr_parseRequiredResources",id:n,instanceID:this._instanceID,body:{templateName:e}})}))}async _setThresholdValue(e,t,i){return await new Promise(((n,r)=>{let s=z();H[s]=async e=>{if(e.success)return n();{let t=new Error(e.message);return t.stack=e.stack+"\n"+t.stack,r(t)}},G.postMessage({type:"cvr_setThresholdValue",id:s,instanceID:this._instanceID,body:{threshold:e,leftLimit:t,rightLimit:i}})}))}contains(e,t){return function(e,t){let i=t.x,n=t.y,r=e[0].x,s=e[0].y,o=e[1].x,a=e[1].y,l=e[2].x,c=e[2].y,h=e[3].x,u=e[3].y,d=m(i,n,r,s,o,a),f=m(i,n,o,a,l,c),g=m(i,n,l,c,h,u),p=m(i,n,h,u,r,s);function m(e,t,i,n,r,s){return(e-i)*(s-n)-(t-n)*(r-i)}return d>=0&&f>=0&&g>=0&&p>=0||d<=0&&f<=0&&g<=0&&p<=0}(e,t)}async dispose(){this._checkIsDisposed(),this._promiseStartScan&&this.stopCapturing(),this.isa=null,this._resultReceiverSet.clear(),this._isaStateListenerSet.clear(),this._resultFilterSet.clear(),this.bDestroyed=!0;let e=z();H[e]=e=>{if(!e.success){let t=new Error(e.message);throw t.stack=e.stack+"\n"+t.stack,t}},G.postMessage({type:"cvr_dispose",id:e,instanceID:this._instanceID})}}class ys{constructor(){this.onCapturedResultReceived=null,this.onOriginalImageResultReceived=null}}class ws{constructor(){this.verificationEnabled={[ie.CRIT_BARCODE]:!1,[ie.CRIT_TEXT_LINE]:!0,[ie.CRIT_DETECTED_QUAD]:!0,[ie.CRIT_NORMALIZED_IMAGE]:!1},this.duplicateFilterEnabled={[ie.CRIT_BARCODE]:!1,[ie.CRIT_TEXT_LINE]:!1,[ie.CRIT_DETECTED_QUAD]:!1,[ie.CRIT_NORMALIZED_IMAGE]:!1},this.duplicateForgetTime={[ie.CRIT_BARCODE]:3e3,[ie.CRIT_TEXT_LINE]:3e3,[ie.CRIT_DETECTED_QUAD]:3e3,[ie.CRIT_NORMALIZED_IMAGE]:3e3},this._allowType=[2,4,8,16]}enableResultCrossVerification(e,t){this._allowType.includes(e)&&(this.verificationEnabled[e]=t)}isResultCrossVerificationEnabled(e){return this.verificationEnabled[e]}enableResultDeduplication(e,t){this._allowType.includes(e)&&(this.duplicateFilterEnabled[e]=t)}isResultDeduplicationEnabled(e){return this.duplicateFilterEnabled[e]}setDuplicateForgetTime(e,t){t>18e4&&(t=18e4),t<0&&(t=0),this.duplicateForgetTime[e]=t}getDuplicateForgetTime(e){return this.duplicateForgetTime[e]}getFilteredResultItemTypes(){let e=0;const t=[ie.CRIT_BARCODE,ie.CRIT_TEXT_LINE,ie.CRIT_DETECTED_QUAD];for(let i=0;i<t.length;i++)(this.verificationEnabled[t[i]]||this.duplicateFilterEnabled[t[i]])&&(e|=t[i]);return e}onDecodedBarcodesReceived(e){if(this.isResultCrossVerificationEnabled(ie.CRIT_BARCODE))for(let t=0;t<e.length;t++)e[t]&&e[t].type===ie.CRIT_BARCODE&&!e[t].verified&&(e[t].isFilter=!0);if(this.isResultDeduplicationEnabled(ie.CRIT_BARCODE))for(let t=0;t<e.length;t++)e[t]&&e[t].type===ie.CRIT_BARCODE&&e[t].duplicate&&(e[t].isFilter=!0)}onRecognizedTextLinesReceived(e){if(this.isResultCrossVerificationEnabled(ie.CRIT_TEXT_LINE))for(let t=0;t<e.length;t++)e[t]&&e[t].type===ie.CRIT_TEXT_LINE&&!e[t].verified&&(e[t].isFilter=!0);if(this.isResultDeduplicationEnabled(ie.CRIT_TEXT_LINE))for(let t=0;t<e.length;t++)e[t]&&e[t].type===ie.CRIT_TEXT_LINE&&e[t].duplicate&&(e[t].isFilter=!0)}onDetectedQuadsReceived(e){if(this.isResultCrossVerificationEnabled(ie.CRIT_DETECTED_QUAD))for(let t=0;t<e.length;t++)e[t]&&e[t].type===ie.CRIT_DETECTED_QUAD&&!e[t].verified&&(e[t].isFilter=!0);if(this.isResultDeduplicationEnabled(ie.CRIT_DETECTED_QUAD))for(let t=0;t<e.length;t++)e[t]&&e[t].type===ie.CRIT_DETECTED_QUAD&&e[t].duplicate&&(e[t].isFilter=!0)}onNormalizedImagesReceived(e){if(this.isResultCrossVerificationEnabled(ie.CRIT_NORMALIZED_IMAGE))for(let t=0;t<e.length;t++)e[t]&&e[t].type===ie.CRIT_NORMALIZED_IMAGE&&!e[t].verified&&(e[t].isFilter=!0);if(this.isResultDeduplicationEnabled(ie.CRIT_NORMALIZED_IMAGE))for(let t=0;t<e.length;t++)e[t]&&e[t].type===ie.CRIT_NORMALIZED_IMAGE&&e[t].duplicate&&(e[t].isFilter=!0)}}var bs=i(184);class Cs extends r.Component{constructor(){super(...arguments),this.pInit=null,this.pDestroy=null,this.uiContainer=r.createRef(),this.resultsContainer=r.createRef()}async init(){try{const e=await Hi.createInstance(),t=await Wr.createInstance(e);this.uiContainer.current.innerText="",this.uiContainer.current.append(e.getUIElement());const i=await vs.createInstance();i.setInput(t);const n=new ys;n.onDecodedBarcodesReceived=e=>{if(e.barcodeResultItems.length){this.resultsContainer.current.textContent="",console.log(e);for(let t of e.barcodeResultItems)this.resultsContainer.current.append("".concat(t.formatString,": ").concat(t.text),document.createElement("br"),document.createElement("hr"))}},i.addResultReceiver(n);const r=new ws;return r.enableResultCrossVerification(ie.CRIT_BARCODE,!0),r.enableResultDeduplication(ie.CRIT_BARCODE,!0),r.setDuplicateForgetTime(ie.CRIT_BARCODE,3e3),await i.addResultFilter(r),await t.open(),await i.startCapturing("ReadSingleBarcode"),{cameraView:e,cameraEnhancer:t,router:i}}catch(e){let t=e.message||e;throw console.error(t),alert(t),e}}async destroy(){if(this.pInit){const{cameraView:e,cameraEnhancer:t,router:i}=await this.pInit;i.dispose(),t.dispose(),e.dispose()}}async componentDidMount(){this.pDestroy?(await this.pDestroy,this.pInit=this.init()):this.pInit=this.init()}async componentWillUnmount(){await(this.pDestroy=this.destroy()),console.log("VideoCapture Component Unmount")}shouldComponentUpdate(){return!1}render(){return(0,bs.jsxs)("div",{children:[(0,bs.jsx)("div",{ref:this.uiContainer,className:"div-ui-container"}),"Results:",(0,bs.jsx)("br",{}),(0,bs.jsx)("div",{ref:this.resultsContainer,className:"div-results-container"})]})}}const Ss=Cs;class Es extends r.Component{constructor(){super(...arguments),this.pInit=null,this.pDestroy=null,this.decodeImg=async e=>{try{const t=await this.pInit,i=await t.capture(e.target.files[0],"ReadBarcodes_SpeedFirst");let n="";for(let e of i.items)console.log(e.text),n+=e.text+"\n";""!==n&&alert(n),i.items.length||alert("No barcode found")}catch(t){let e=t.message||t;console.error(e),alert(e)}e.target.value=""}}async init(){return await vs.createInstance()}async destroy(){if(this.pInit){(await this.pInit).dispose()}}async componentDidMount(){this.pDestroy?(await this.pDestroy,this.pInit=this.init()):this.pInit=this.init()}async componentWillUnmount(){await(this.pDestroy=this.destroy()),console.log("ImageCapture Component Unmount")}render(){return(0,bs.jsx)("div",{className:"div-image-capture",children:(0,bs.jsx)("input",{type:"file",accept:".jpg,.jpeg,.icon,.gif,.svg,.webp,.png,.bmp",onChange:this.decodeImg})})}}const Ts=Es;class xs extends r.Component{constructor(){super(...arguments),this.state={bShowVideoCapture:!0,bShowImageCapture:!1},this.showVideoCapture=()=>{this.setState({bShowVideoCapture:!0,bShowImageCapture:!1})},this.showImageCapture=()=>{this.setState({bShowVideoCapture:!1,bShowImageCapture:!0})}}render(){return(0,bs.jsxs)("div",{className:"div-hello-world",children:[(0,bs.jsx)("h1",{children:"Hello World for React"}),(0,bs.jsxs)("div",{children:[(0,bs.jsx)("button",{style:{marginRight:"10px",backgroundColor:this.state.bShowVideoCapture?"rgb(255,174,55)":"white"},onClick:this.showVideoCapture,children:"Decode Video"}),(0,bs.jsx)("button",{style:{backgroundColor:this.state.bShowImageCapture?"rgb(255,174,55)":"white"},onClick:this.showImageCapture,children:"Decode Image"})]}),(0,bs.jsxs)("div",{className:"container",children:[this.state.bShowVideoCapture?(0,bs.jsx)(Ss,{}):"",this.state.bShowImageCapture?(0,bs.jsx)(Ts,{}):""]})]})}}const Is=xs;const As=function(){return(0,bs.jsx)("div",{className:"App",children:(0,bs.jsx)(Is,{})})},Os=e=>{e&&e instanceof Function&&i.e(787).then(i.bind(i,787)).then((t=>{let{getCLS:i,getFID:n,getFCP:r,getLCP:s,getTTFB:o}=t;i(e),n(e),r(e),s(e),o(e)}))};s.createRoot(document.getElementById("root")).render((0,bs.jsx)(r.StrictMode,{children:(0,bs.jsx)(As,{})})),Os()})()})();
//# sourceMappingURL=main.2a99cd0a.js.map