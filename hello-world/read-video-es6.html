<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1.0" />
    <meta
      name="description"
      content="Quickly read barcodes with Dynamsoft Barcode Reader from a live camera stream."
    />
    <meta name="keywords" content="barcode, camera, es6" />
    <link
      rel="canonical"
      href="https://demo.dynamsoft.com/Samples/DBR/JS/hello-world/read-video-requirejs.html"
    />
    <title>
      Dynamsoft Barcode Reader Sample - Hello World for ES6 (Decode via Camera)
    </title>
  </head>

  <body>
    <h1>Hello World for ES6 (Decode via Camera)</h1>
    <div id="div-ui-container" style="width: 100%; height: 80vh"></div>
    <div id="div-result-container" style="margin-top: 6px"></div>
    <script>
      if (location.protocol === "file:") {
        const message = `The page is opened via file:// and some SDKs may not work properly. Please open the page via https:// or host it on "http://localhost/".`;
        console.warn(message);
        alert(message);
      }
    </script>
    <script type="importmap">
      {
        "imports": {
          "@dynamsoft/dynamsoft-core": "https://npm.scannerproxy.com/cdn/@dynamsoft/dynamsoft-core@3.0.20-dev-20231010152155/dist/core.mjs",
          "dynamsoft-core": "https://cdn.jsdelivr.net/npm/dynamsoft-core@3.0.10/dist/core.mjs",
          "@dynamsoft/dynamsoft-barcode-reader": "https://npm.scannerproxy.com/cdn/@dynamsoft/dynamsoft-barcode-reader@10.0.20-dev-20231020180049/dist/dbr.mjs",
          "@dynamsoft/dynamsoft-document-normalizer": "https://npm.scannerproxy.com/cdn/@dynamsoft/dynamsoft-document-normalizer@2.0.12-dev-20231019180133/dist/ddn.mjs",
          "@dynamsoft/dynamsoft-capture-vision-router": "https://npm.scannerproxy.com/cdn/@dynamsoft/dynamsoft-capture-vision-router@2.0.20-dev-20231023103654/dist/cvr.mjs",
          "dynamsoft-capture-vision-router": "https://cdn.jsdelivr.net/npm/dynamsoft-capture-vision-router@2.0.11/dist/cvr.mjs",
          "@dynamsoft/dynamsoft-camera-enhancer": "https://npm.scannerproxy.com/cdn/@dynamsoft/dynamsoft-camera-enhancer@4.0.1-dev-20231020132130/dist/dce.mjs"
        }
      }
    </script>
    <script type="module">
      import { BarcodeReaderModule } from "@dynamsoft/dynamsoft-barcode-reader";
      import {
        LicenseManager,
        CaptureVisionRouter,
        CapturedResultReceiver,
      } from "@dynamsoft/dynamsoft-capture-vision-router";
      import {
        CameraView,
        CameraEnhancer,
      } from "@dynamsoft/dynamsoft-camera-enhancer";

      /** LICENSE ALERT - README
       * To use the library, you need to first specify a license key using the API "initLicense" as shown below.
       */

      LicenseManager.initLicense(
        "DLS2eyJoYW5kc2hha2VDb2RlIjoiNjY2Ni03Nzc3IiwibWFpblNlcnZlclVSTCI6Imh0dHBzOi8vMTkyLjE2OC44LjEyMi9kbHMvIiwib3JnYW5pemF0aW9uSUQiOiI2NjY2IiwiY2hlY2tDb2RlIjoxNTEyMTgzMzg3fQ=="
      );

      /**
       * You can visit https://www.dynamsoft.com/customer/license/trialLicense?utm_source=github&product=dbr&package=js to get your own trial license good for 30 days.
       * Note that if you downloaded this sample from Dynamsoft while logged in, the above license key may already be your own 30-day trial license.
       * For more information, see https://www.dynamsoft.com/barcode-reader/programming/javascript/user-guide/?ver=10.0.20&utm_source=github#specify-the-license or contact support@dynamsoft.com.
       * LICENSE ALERT - THE END
       */

      CameraView.engineResourcePath =
        "https://cdn.jsdelivr.net/npm/dynamsoft-camera-enhancer@4.0.0/dist/";
      BarcodeReaderModule.engineResourcePath =
        "https://npm.scannerproxy.com/cdn/@dynamsoft/dynamsoft-barcode-reader@10.0.20-dev-20231019180228/dist/";
      CaptureVisionRouter.engineResourcePath =
        "https://npm.scannerproxy.com/cdn/@dynamsoft/dynamsoft-capture-vision-router@2.0.20-dev-20231019180504/dist/";
      (async function () {
        try {
          // Create a `CameraEnhancer` instance for camera control.
          const cameraView = await CameraView.createInstance();
          const cameraEnhancer = await CameraEnhancer.createInstance(
            cameraView
          );
          document
            .querySelector("#div-ui-container")
            .append(cameraView.getUIElement());

          // Create a `CaptureVisionRouter` instance and set `CameraEnhancer` instance as its image source.
          const router = await CaptureVisionRouter.createInstance();
          router.setInput(cameraEnhancer);

          // Define a callback for results.
          const resultReceiver = new CapturedResultReceiver();
          resultReceiver.onDecodedBarcodesReceived = (result) => {
            const divResultContainer = document.querySelector(
              "#div-result-container"
            );
            divResultContainer.innerText = "Result:\n";
            for (let item of result.barcodesResultItems) {
              divResultContainer.innerText += item.text + "\n";
              console.log(item.text);
            }
          };
          router.addResultReceiver(resultReceiver);

          // Open camera and start scanning.
          await cameraEnhancer.open();
          await router.startCapturing("ReadSingleBarcode");
        } catch (ex) {
          let errMsg;
          if (ex.message.includes("network connection error")) {
            errMsg =
              "Failed to connect to Dynamsoft License Server: network connection error. Check your Internet connection or contact Dynamsoft Support (support@dynamsoft.com) to acquire an offline license.";
          } else {
            errMsg = ex.message || ex;
          }
          console.error(errMsg);
          alert(errMsg);
        }
      })();
    </script>
  </body>
</html>
