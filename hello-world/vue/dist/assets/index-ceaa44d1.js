(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const h of document.querySelectorAll('link[rel="modulepreload"]'))o(h);new MutationObserver(h=>{for(const g of h)if(g.type==="childList")for(const m of g.addedNodes)m.tagName==="LINK"&&m.rel==="modulepreload"&&o(m)}).observe(document,{childList:!0,subtree:!0});function n(h){const g={};return h.integrity&&(g.integrity=h.integrity),h.referrerPolicy&&(g.referrerPolicy=h.referrerPolicy),h.crossOrigin==="use-credentials"?g.credentials="include":h.crossOrigin==="anonymous"?g.credentials="omit":g.credentials="same-origin",g}function o(h){if(h.ep)return;h.ep=!0;const g=n(h);fetch(h.href,g)}})();/**
* @vue/shared v3.4.13
* (c) 2018-present Yuxi (Evan) You and Vue contributors
* @license MIT
**/function la(t,e){const n=new Set(t.split(","));return e?o=>n.has(o.toLowerCase()):o=>n.has(o)}const Qe={},Ln=[],Mt=()=>{},Eh=()=>!1,Us=t=>t.charCodeAt(0)===111&&t.charCodeAt(1)===110&&(t.charCodeAt(2)>122||t.charCodeAt(2)<97),ca=t=>t.startsWith("onUpdate:"),ut=Object.assign,ha=(t,e)=>{const n=t.indexOf(e);n>-1&&t.splice(n,1)},Th=Object.prototype.hasOwnProperty,Ve=(t,e)=>Th.call(t,e),De=Array.isArray,wr=t=>Vs(t)==="[object Map]",bh=t=>Vs(t)==="[object Set]",Me=t=>typeof t=="function",ft=t=>typeof t=="string",Gs=t=>typeof t=="symbol",st=t=>t!==null&&typeof t=="object",ic=t=>(st(t)||Me(t))&&Me(t.then)&&Me(t.catch),Sh=Object.prototype.toString,Vs=t=>Sh.call(t),Ih=t=>Vs(t).slice(8,-1),xh=t=>Vs(t)==="[object Object]",ua=t=>ft(t)&&t!=="NaN"&&t[0]!=="-"&&""+parseInt(t,10)===t,Yr=la(",key,ref,ref_for,ref_key,onVnodeBeforeMount,onVnodeMounted,onVnodeBeforeUpdate,onVnodeUpdated,onVnodeBeforeUnmount,onVnodeUnmounted"),Ws=t=>{const e=Object.create(null);return n=>e[n]||(e[n]=t(n))},Ah=/-(\w)/g,Bn=Ws(t=>t.replace(Ah,(e,n)=>n?n.toUpperCase():"")),Oh=/\B([A-Z])/g,Gn=Ws(t=>t.replace(Oh,"-$1").toLowerCase()),nc=Ws(t=>t.charAt(0).toUpperCase()+t.slice(1)),io=Ws(t=>t?`on${nc(t)}`:""),Mi=(t,e)=>!Object.is(t,e),no=(t,e)=>{for(let n=0;n<t.length;n++)t[n](e)},Cs=(t,e,n)=>{Object.defineProperty(t,e,{configurable:!0,enumerable:!1,value:n})},Rh=t=>{const e=parseFloat(t);return isNaN(e)?t:e};let ja;const rc=()=>ja||(ja=typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:typeof global<"u"?global:{});function Sr(t){if(De(t)){const e={};for(let n=0;n<t.length;n++){const o=t[n],h=ft(o)?Mh(o):Sr(o);if(h)for(const g in h)e[g]=h[g]}return e}else if(ft(t)||st(t))return t}const Dh=/;(?![^(]*\))/g,Lh=/:([^]+)/,Fh=/\/\*[^]*?\*\//g;function Mh(t){const e={};return t.replace(Fh,"").split(Dh).forEach(n=>{if(n){const o=n.split(Lh);o.length>1&&(e[o[0].trim()]=o[1].trim())}}),e}function fa(t){let e="";if(ft(t))e=t;else if(De(t))for(let n=0;n<t.length;n++){const o=fa(t[n]);o&&(e+=o+" ")}else if(st(t))for(const n in t)t[n]&&(e+=n+" ");return e.trim()}const Ph="itemscope,allowfullscreen,formnovalidate,ismap,nomodule,novalidate,readonly",kh=la(Ph);function sc(t){return!!t||t===""}/**
* @vue/reactivity v3.4.13
* (c) 2018-present Yuxi (Evan) You and Vue contributors
* @license MIT
**/let Vt;class Bh{constructor(e=!1){this.detached=e,this._active=!0,this.effects=[],this.cleanups=[],this.parent=Vt,!e&&Vt&&(this.index=(Vt.scopes||(Vt.scopes=[])).push(this)-1)}get active(){return this._active}run(e){if(this._active){const n=Vt;try{return Vt=this,e()}finally{Vt=n}}}on(){Vt=this}off(){Vt=this.parent}stop(e){if(this._active){let n,o;for(n=0,o=this.effects.length;n<o;n++)this.effects[n].stop();for(n=0,o=this.cleanups.length;n<o;n++)this.cleanups[n]();if(this.scopes)for(n=0,o=this.scopes.length;n<o;n++)this.scopes[n].stop(!0);if(!this.detached&&this.parent&&!e){const h=this.parent.scopes.pop();h&&h!==this&&(this.parent.scopes[this.index]=h,h.index=this.index)}this.parent=void 0,this._active=!1}}}function Nh(t,e=Vt){e&&e.active&&e.effects.push(t)}function jh(){return Vt}let Qi;class da{constructor(e,n,o,h){this.fn=e,this.trigger=n,this.scheduler=o,this.active=!0,this.deps=[],this._dirtyLevel=2,this._trackId=0,this._runnings=0,this._shouldSchedule=!1,this._depsLength=0,Nh(this,h)}get dirty(){if(this._dirtyLevel===1){an();for(let e=0;e<this._depsLength;e++){const n=this.deps[e];if(n.computed&&(Uh(n.computed),this._dirtyLevel>=2))break}this._dirtyLevel<2&&(this._dirtyLevel=0),ln()}return this._dirtyLevel>=2}set dirty(e){this._dirtyLevel=e?2:0}run(){if(this._dirtyLevel=0,!this.active)return this.fn();let e=Di,n=Qi;try{return Di=!0,Qi=this,this._runnings++,Ua(this),this.fn()}finally{Ga(this),this._runnings--,Qi=n,Di=e}}stop(){var e;this.active&&(Ua(this),Ga(this),(e=this.onStop)==null||e.call(this),this.active=!1)}}function Uh(t){return t.value}function Ua(t){t._trackId++,t._depsLength=0}function Ga(t){if(t.deps&&t.deps.length>t._depsLength){for(let e=t._depsLength;e<t.deps.length;e++)oc(t.deps[e],t);t.deps.length=t._depsLength}}function oc(t,e){const n=t.get(e);n!==void 0&&e._trackId!==n&&(t.delete(e),t.size===0&&t.cleanup())}let Di=!0,Io=0;const ac=[];function an(){ac.push(Di),Di=!1}function ln(){const t=ac.pop();Di=t===void 0?!0:t}function ga(){Io++}function pa(){for(Io--;!Io&&xo.length;)xo.shift()()}function lc(t,e,n){if(e.get(t)!==t._trackId){e.set(t,t._trackId);const o=t.deps[t._depsLength];o!==e?(o&&oc(o,t),t.deps[t._depsLength++]=e):t._depsLength++}}const xo=[];function cc(t,e,n){ga();for(const o of t.keys())if(t.get(o)===o._trackId){if(o._dirtyLevel<e){const h=o._dirtyLevel;o._dirtyLevel=e,h===0&&(o._shouldSchedule=!0,o.trigger())}o.scheduler&&o._shouldSchedule&&(!o._runnings||o.allowRecurse)&&(o._shouldSchedule=!1,xo.push(o.scheduler))}pa()}const hc=(t,e)=>{const n=new Map;return n.cleanup=t,n.computed=e,n},Ao=new WeakMap,en=Symbol(""),Oo=Symbol("");function St(t,e,n){if(Di&&Qi){let o=Ao.get(t);o||Ao.set(t,o=new Map);let h=o.get(n);h||o.set(n,h=hc(()=>o.delete(n))),lc(Qi,h)}}function mi(t,e,n,o,h,g){const m=Ao.get(t);if(!m)return;let v=[];if(e==="clear")v=[...m.values()];else if(n==="length"&&De(t)){const C=Number(o);m.forEach((E,I)=>{(I==="length"||!Gs(I)&&I>=C)&&v.push(E)})}else switch(n!==void 0&&v.push(m.get(n)),e){case"add":De(t)?ua(n)&&v.push(m.get("length")):(v.push(m.get(en)),wr(t)&&v.push(m.get(Oo)));break;case"delete":De(t)||(v.push(m.get(en)),wr(t)&&v.push(m.get(Oo)));break;case"set":wr(t)&&v.push(m.get(en));break}ga();for(const C of v)C&&cc(C,2);pa()}const Gh=la("__proto__,__v_isRef,__isVue"),uc=new Set(Object.getOwnPropertyNames(Symbol).filter(t=>t!=="arguments"&&t!=="caller").map(t=>Symbol[t]).filter(Gs)),Va=Vh();function Vh(){const t={};return["includes","indexOf","lastIndexOf"].forEach(e=>{t[e]=function(...n){const o=He(this);for(let g=0,m=this.length;g<m;g++)St(o,"get",g+"");const h=o[e](...n);return h===-1||h===!1?o[e](...n.map(He)):h}}),["push","pop","shift","unshift","splice"].forEach(e=>{t[e]=function(...n){an(),ga();const o=He(this)[e].apply(this,n);return pa(),ln(),o}}),t}function Wh(t){const e=He(this);return St(e,"has",t),e.hasOwnProperty(t)}class fc{constructor(e=!1,n=!1){this._isReadonly=e,this._shallow=n}get(e,n,o){const h=this._isReadonly,g=this._shallow;if(n==="__v_isReactive")return!h;if(n==="__v_isReadonly")return h;if(n==="__v_isShallow")return g;if(n==="__v_raw")return o===(h?g?iu:mc:g?pc:gc).get(e)||Object.getPrototypeOf(e)===Object.getPrototypeOf(o)?e:void 0;const m=De(e);if(!h){if(m&&Ve(Va,n))return Reflect.get(Va,n,o);if(n==="hasOwnProperty")return Wh}const v=Reflect.get(e,n,o);return(Gs(n)?uc.has(n):Gh(n))||(h||St(e,"get",n),g)?v:It(v)?m&&ua(n)?v:v.value:st(v)?h?_c(v):va(v):v}}class dc extends fc{constructor(e=!1){super(!1,e)}set(e,n,o,h){let g=e[n];if(!this._shallow){const C=Nn(g);if(!Es(o)&&!Nn(o)&&(g=He(g),o=He(o)),!De(e)&&It(g)&&!It(o))return C?!1:(g.value=o,!0)}const m=De(e)&&ua(n)?Number(n)<e.length:Ve(e,n),v=Reflect.set(e,n,o,h);return e===He(h)&&(m?Mi(o,g)&&mi(e,"set",n,o):mi(e,"add",n,o)),v}deleteProperty(e,n){const o=Ve(e,n);e[n];const h=Reflect.deleteProperty(e,n);return h&&o&&mi(e,"delete",n,void 0),h}has(e,n){const o=Reflect.has(e,n);return(!Gs(n)||!uc.has(n))&&St(e,"has",n),o}ownKeys(e){return St(e,"iterate",De(e)?"length":en),Reflect.ownKeys(e)}}class Yh extends fc{constructor(e=!1){super(!0,e)}set(e,n){return!0}deleteProperty(e,n){return!0}}const Hh=new dc,Xh=new Yh,zh=new dc(!0),ma=t=>t,Ys=t=>Reflect.getPrototypeOf(t);function Fr(t,e,n=!1,o=!1){t=t.__v_raw;const h=He(t),g=He(e);n||(Mi(e,g)&&St(h,"get",e),St(h,"get",g));const{has:m}=Ys(h),v=o?ma:n?wa:Ir;if(m.call(h,e))return v(t.get(e));if(m.call(h,g))return v(t.get(g));t!==h&&t.get(e)}function Mr(t,e=!1){const n=this.__v_raw,o=He(n),h=He(t);return e||(Mi(t,h)&&St(o,"has",t),St(o,"has",h)),t===h?n.has(t):n.has(t)||n.has(h)}function Pr(t,e=!1){return t=t.__v_raw,!e&&St(He(t),"iterate",en),Reflect.get(t,"size",t)}function Wa(t){t=He(t);const e=He(this);return Ys(e).has.call(e,t)||(e.add(t),mi(e,"add",t,t)),this}function Ya(t,e){e=He(e);const n=He(this),{has:o,get:h}=Ys(n);let g=o.call(n,t);g||(t=He(t),g=o.call(n,t));const m=h.call(n,t);return n.set(t,e),g?Mi(e,m)&&mi(n,"set",t,e):mi(n,"add",t,e),this}function Ha(t){const e=He(this),{has:n,get:o}=Ys(e);let h=n.call(e,t);h||(t=He(t),h=n.call(e,t)),o&&o.call(e,t);const g=e.delete(t);return h&&mi(e,"delete",t,void 0),g}function Xa(){const t=He(this),e=t.size!==0,n=t.clear();return e&&mi(t,"clear",void 0,void 0),n}function kr(t,e){return function(o,h){const g=this,m=g.__v_raw,v=He(m),C=e?ma:t?wa:Ir;return!t&&St(v,"iterate",en),m.forEach((E,I)=>o.call(h,C(E),C(I),g))}}function Br(t,e,n){return function(...o){const h=this.__v_raw,g=He(h),m=wr(g),v=t==="entries"||t===Symbol.iterator&&m,C=t==="keys"&&m,E=h[t](...o),I=n?ma:e?wa:Ir;return!e&&St(g,"iterate",C?Oo:en),{next(){const{value:R,done:L}=E.next();return L?{value:R,done:L}:{value:v?[I(R[0]),I(R[1])]:I(R),done:L}},[Symbol.iterator](){return this}}}}function yi(t){return function(...e){return t==="delete"?!1:t==="clear"?void 0:this}}function $h(){const t={get(g){return Fr(this,g)},get size(){return Pr(this)},has:Mr,add:Wa,set:Ya,delete:Ha,clear:Xa,forEach:kr(!1,!1)},e={get(g){return Fr(this,g,!1,!0)},get size(){return Pr(this)},has:Mr,add:Wa,set:Ya,delete:Ha,clear:Xa,forEach:kr(!1,!0)},n={get(g){return Fr(this,g,!0)},get size(){return Pr(this,!0)},has(g){return Mr.call(this,g,!0)},add:yi("add"),set:yi("set"),delete:yi("delete"),clear:yi("clear"),forEach:kr(!0,!1)},o={get(g){return Fr(this,g,!0,!0)},get size(){return Pr(this,!0)},has(g){return Mr.call(this,g,!0)},add:yi("add"),set:yi("set"),delete:yi("delete"),clear:yi("clear"),forEach:kr(!0,!0)};return["keys","values","entries",Symbol.iterator].forEach(g=>{t[g]=Br(g,!1,!1),n[g]=Br(g,!0,!1),e[g]=Br(g,!1,!0),o[g]=Br(g,!0,!0)}),[t,n,e,o]}const[Kh,Zh,qh,Jh]=$h();function _a(t,e){const n=e?t?Jh:qh:t?Zh:Kh;return(o,h,g)=>h==="__v_isReactive"?!t:h==="__v_isReadonly"?t:h==="__v_raw"?o:Reflect.get(Ve(n,h)&&h in o?n:o,h,g)}const Qh={get:_a(!1,!1)},eu={get:_a(!1,!0)},tu={get:_a(!0,!1)},gc=new WeakMap,pc=new WeakMap,mc=new WeakMap,iu=new WeakMap;function nu(t){switch(t){case"Object":case"Array":return 1;case"Map":case"Set":case"WeakMap":case"WeakSet":return 2;default:return 0}}function ru(t){return t.__v_skip||!Object.isExtensible(t)?0:nu(Ih(t))}function va(t){return Nn(t)?t:ya(t,!1,Hh,Qh,gc)}function su(t){return ya(t,!1,zh,eu,pc)}function _c(t){return ya(t,!0,Xh,tu,mc)}function ya(t,e,n,o,h){if(!st(t)||t.__v_raw&&!(e&&t.__v_isReactive))return t;const g=h.get(t);if(g)return g;const m=ru(t);if(m===0)return t;const v=new Proxy(t,m===2?o:n);return h.set(t,v),v}function Fn(t){return Nn(t)?Fn(t.__v_raw):!!(t&&t.__v_isReactive)}function Nn(t){return!!(t&&t.__v_isReadonly)}function Es(t){return!!(t&&t.__v_isShallow)}function vc(t){return Fn(t)||Nn(t)}function He(t){const e=t&&t.__v_raw;return e?He(e):t}function yc(t){return Cs(t,"__v_skip",!0),t}const Ir=t=>st(t)?va(t):t,wa=t=>st(t)?_c(t):t;class wc{constructor(e,n,o,h){this._setter=n,this.dep=void 0,this.__v_isRef=!0,this.__v_isReadonly=!1,this.effect=new da(()=>e(this._value),()=>Ro(this,1)),this.effect.computed=this,this.effect.active=this._cacheable=!h,this.__v_isReadonly=o}get value(){const e=He(this);return(!e._cacheable||e.effect.dirty)&&Mi(e._value,e._value=e.effect.run())&&Ro(e,2),Cc(e),e._value}set value(e){this._setter(e)}get _dirty(){return this.effect.dirty}set _dirty(e){this.effect.dirty=e}}function ou(t,e,n=!1){let o,h;const g=Me(t);return g?(o=t,h=Mt):(o=t.get,h=t.set),new wc(o,h,g||!h,n)}function Cc(t){Di&&Qi&&(t=He(t),lc(Qi,t.dep||(t.dep=hc(()=>t.dep=void 0,t instanceof wc?t:void 0))))}function Ro(t,e=2,n){t=He(t);const o=t.dep;o&&cc(o,e)}function It(t){return!!(t&&t.__v_isRef===!0)}function Mn(t){return au(t,!1)}function au(t,e){return It(t)?t:new lu(t,e)}class lu{constructor(e,n){this.__v_isShallow=n,this.dep=void 0,this.__v_isRef=!0,this._rawValue=n?e:He(e),this._value=n?e:Ir(e)}get value(){return Cc(this),this._value}set value(e){const n=this.__v_isShallow||Es(e)||Nn(e);e=n?e:He(e),Mi(e,this._rawValue)&&(this._rawValue=e,this._value=n?e:Ir(e),Ro(this,2))}}function cu(t){return It(t)?t.value:t}const hu={get:(t,e,n)=>cu(Reflect.get(t,e,n)),set:(t,e,n,o)=>{const h=t[e];return It(h)&&!It(n)?(h.value=n,!0):Reflect.set(t,e,n,o)}};function Ec(t){return Fn(t)?t:new Proxy(t,hu)}/**
* @vue/runtime-core v3.4.13
* (c) 2018-present Yuxi (Evan) You and Vue contributors
* @license MIT
**/function Li(t,e,n,o){let h;try{h=o?t(...o):t()}catch(g){Hs(g,e,n)}return h}function Ht(t,e,n,o){if(Me(t)){const g=Li(t,e,n,o);return g&&ic(g)&&g.catch(m=>{Hs(m,e,n)}),g}const h=[];for(let g=0;g<t.length;g++)h.push(Ht(t[g],e,n,o));return h}function Hs(t,e,n,o=!0){const h=e?e.vnode:null;if(e){let g=e.parent;const m=e.proxy,v=`https://vuejs.org/errors/#runtime-${n}`;for(;g;){const E=g.ec;if(E){for(let I=0;I<E.length;I++)if(E[I](t,m,v)===!1)return}g=g.parent}const C=e.appContext.config.errorHandler;if(C){Li(C,null,10,[t,m,v]);return}}uu(t,n,h,o)}function uu(t,e,n,o=!0){console.error(t)}let xr=!1,Do=!1;const pt=[];let Jt=0;const Pn=[];let Ii=null,Ki=0;const Tc=Promise.resolve();let Ca=null;function fu(t){const e=Ca||Tc;return t?e.then(this?t.bind(this):t):e}function du(t){let e=Jt+1,n=pt.length;for(;e<n;){const o=e+n>>>1,h=pt[o],g=Ar(h);g<t||g===t&&h.pre?e=o+1:n=o}return e}function Ea(t){(!pt.length||!pt.includes(t,xr&&t.allowRecurse?Jt+1:Jt))&&(t.id==null?pt.push(t):pt.splice(du(t.id),0,t),bc())}function bc(){!xr&&!Do&&(Do=!0,Ca=Tc.then(Ic))}function gu(t){const e=pt.indexOf(t);e>Jt&&pt.splice(e,1)}function pu(t){De(t)?Pn.push(...t):(!Ii||!Ii.includes(t,t.allowRecurse?Ki+1:Ki))&&Pn.push(t),bc()}function za(t,e,n=xr?Jt+1:0){for(;n<pt.length;n++){const o=pt[n];if(o&&o.pre){if(t&&o.id!==t.uid)continue;pt.splice(n,1),n--,o()}}}function Sc(t){if(Pn.length){const e=[...new Set(Pn)].sort((n,o)=>Ar(n)-Ar(o));if(Pn.length=0,Ii){Ii.push(...e);return}for(Ii=e,Ki=0;Ki<Ii.length;Ki++)Ii[Ki]();Ii=null,Ki=0}}const Ar=t=>t.id==null?1/0:t.id,mu=(t,e)=>{const n=Ar(t)-Ar(e);if(n===0){if(t.pre&&!e.pre)return-1;if(e.pre&&!t.pre)return 1}return n};function Ic(t){Do=!1,xr=!0,pt.sort(mu);const e=Mt;try{for(Jt=0;Jt<pt.length;Jt++){const n=pt[Jt];n&&n.active!==!1&&Li(n,null,14)}}finally{Jt=0,pt.length=0,Sc(),xr=!1,Ca=null,(pt.length||Pn.length)&&Ic()}}function _u(t,e,...n){if(t.isUnmounted)return;const o=t.vnode.props||Qe;let h=n;const g=e.startsWith("update:"),m=g&&e.slice(7);if(m&&m in o){const I=`${m==="modelValue"?"model":m}Modifiers`,{number:R,trim:L}=o[I]||Qe;L&&(h=n.map(N=>ft(N)?N.trim():N)),R&&(h=n.map(Rh))}let v,C=o[v=io(e)]||o[v=io(Bn(e))];!C&&g&&(C=o[v=io(Gn(e))]),C&&Ht(C,t,6,h);const E=o[v+"Once"];if(E){if(!t.emitted)t.emitted={};else if(t.emitted[v])return;t.emitted[v]=!0,Ht(E,t,6,h)}}function xc(t,e,n=!1){const o=e.emitsCache,h=o.get(t);if(h!==void 0)return h;const g=t.emits;let m={},v=!1;if(!Me(t)){const C=E=>{const I=xc(E,e,!0);I&&(v=!0,ut(m,I))};!n&&e.mixins.length&&e.mixins.forEach(C),t.extends&&C(t.extends),t.mixins&&t.mixins.forEach(C)}return!g&&!v?(st(t)&&o.set(t,null),null):(De(g)?g.forEach(C=>m[C]=null):ut(m,g),st(t)&&o.set(t,m),m)}function Xs(t,e){return!t||!Us(e)?!1:(e=e.slice(2).replace(/Once$/,""),Ve(t,e[0].toLowerCase()+e.slice(1))||Ve(t,Gn(e))||Ve(t,e))}let Qt=null,zs=null;function Ts(t){const e=Qt;return Qt=t,zs=t&&t.type.__scopeId||null,e}function Ac(t){zs=t}function Oc(){zs=null}function vu(t,e=Qt,n){if(!e||t._n)return t;const o=(...h)=>{o._d&&nl(-1);const g=Ts(e);let m;try{m=t(...h)}finally{Ts(g),o._d&&nl(1)}return m};return o._n=!0,o._c=!0,o._d=!0,o}function ro(t){const{type:e,vnode:n,proxy:o,withProxy:h,props:g,propsOptions:[m],slots:v,attrs:C,emit:E,render:I,renderCache:R,data:L,setupState:N,ctx:Y,inheritAttrs:X}=t;let K,J;const te=Ts(t);try{if(n.shapeFlag&4){const pe=h||o,he=pe;K=Zt(I.call(he,pe,R,g,N,L,Y)),J=C}else{const pe=e;K=Zt(pe.length>1?pe(g,{attrs:C,slots:v,emit:E}):pe(g,null)),J=e.props?C:yu(C)}}catch(pe){Er.length=0,Hs(pe,t,1),K=_i(sn)}let ne=K;if(J&&X!==!1){const pe=Object.keys(J),{shapeFlag:he}=ne;pe.length&&he&7&&(m&&pe.some(ca)&&(J=wu(J,m)),ne=jn(ne,J))}return n.dirs&&(ne=jn(ne),ne.dirs=ne.dirs?ne.dirs.concat(n.dirs):n.dirs),n.transition&&(ne.transition=n.transition),K=ne,Ts(te),K}const yu=t=>{let e;for(const n in t)(n==="class"||n==="style"||Us(n))&&((e||(e={}))[n]=t[n]);return e},wu=(t,e)=>{const n={};for(const o in t)(!ca(o)||!(o.slice(9)in e))&&(n[o]=t[o]);return n};function Cu(t,e,n){const{props:o,children:h,component:g}=t,{props:m,children:v,patchFlag:C}=e,E=g.emitsOptions;if(e.dirs||e.transition)return!0;if(n&&C>=0){if(C&1024)return!0;if(C&16)return o?$a(o,m,E):!!m;if(C&8){const I=e.dynamicProps;for(let R=0;R<I.length;R++){const L=I[R];if(m[L]!==o[L]&&!Xs(E,L))return!0}}}else return(h||v)&&(!v||!v.$stable)?!0:o===m?!1:o?m?$a(o,m,E):!0:!!m;return!1}function $a(t,e,n){const o=Object.keys(e);if(o.length!==Object.keys(t).length)return!0;for(let h=0;h<o.length;h++){const g=o[h];if(e[g]!==t[g]&&!Xs(n,g))return!0}return!1}function Eu({vnode:t,parent:e},n){for(;e;){const o=e.subTree;if(o.suspense&&o.suspense.activeBranch===t&&(o.el=t.el),o===t)(t=e.vnode).el=n,e=e.parent;else break}}const Tu=Symbol.for("v-ndc"),bu=t=>t.__isSuspense;function Su(t,e){e&&e.pendingBranch?De(t)?e.effects.push(...t):e.effects.push(t):pu(t)}const Iu=Symbol.for("v-scx"),xu=()=>Xr(Iu),Nr={};function so(t,e,n){return Rc(t,e,n)}function Rc(t,e,{immediate:n,deep:o,flush:h,once:g,onTrack:m,onTrigger:v}=Qe){if(e&&g){const le=e;e=(...be)=>{le(...be),he()}}const C=yt,E=le=>o===!0?le:xn(le,o===!1?1:void 0);let I,R=!1,L=!1;if(It(t)?(I=()=>t.value,R=Es(t)):Fn(t)?(I=()=>E(t),R=!0):De(t)?(L=!0,R=t.some(le=>Fn(le)||Es(le)),I=()=>t.map(le=>{if(It(le))return le.value;if(Fn(le))return E(le);if(Me(le))return Li(le,C,2)})):Me(t)?e?I=()=>Li(t,C,2):I=()=>(N&&N(),Ht(t,C,3,[Y])):I=Mt,e&&o){const le=I;I=()=>xn(le())}let N,Y=le=>{N=ne.onStop=()=>{Li(le,C,4),N=ne.onStop=void 0}},X;if(Js)if(Y=Mt,e?n&&Ht(e,C,3,[I(),L?[]:void 0,Y]):I(),h==="sync"){const le=xu();X=le.__watcherHandles||(le.__watcherHandles=[])}else return Mt;let K=L?new Array(t.length).fill(Nr):Nr;const J=()=>{if(!(!ne.active||!ne.dirty))if(e){const le=ne.run();(o||R||(L?le.some((be,y)=>Mi(be,K[y])):Mi(le,K)))&&(N&&N(),Ht(e,C,3,[le,K===Nr?void 0:L&&K[0]===Nr?[]:K,Y]),K=le)}else ne.run()};J.allowRecurse=!!e;let te;h==="sync"?te=J:h==="post"?te=()=>wt(J,C&&C.suspense):(J.pre=!0,C&&(J.id=C.uid),te=()=>Ea(J));const ne=new da(I,Mt,te),pe=jh(),he=()=>{ne.stop(),pe&&ha(pe.effects,ne)};return e?n?J():K=ne.run():h==="post"?wt(ne.run.bind(ne),C&&C.suspense):ne.run(),X&&X.push(he),he}function Au(t,e,n){const o=this.proxy,h=ft(t)?t.includes(".")?Dc(o,t):()=>o[t]:t.bind(o,o);let g;Me(e)?g=e:(g=e.handler,n=e);const m=Rr(this),v=Rc(h,g.bind(o),n);return m(),v}function Dc(t,e){const n=e.split(".");return()=>{let o=t;for(let h=0;h<n.length&&o;h++)o=o[n[h]];return o}}function xn(t,e,n=0,o){if(!st(t)||t.__v_skip)return t;if(e&&e>0){if(n>=e)return t;n++}if(o=o||new Set,o.has(t))return t;if(o.add(t),It(t))xn(t.value,e,n,o);else if(De(t))for(let h=0;h<t.length;h++)xn(t[h],e,n,o);else if(bh(t)||wr(t))t.forEach(h=>{xn(h,e,n,o)});else if(xh(t))for(const h in t)xn(t[h],e,n,o);return t}function Ni(t,e,n,o){const h=t.dirs,g=e&&e.dirs;for(let m=0;m<h.length;m++){const v=h[m];g&&(v.oldValue=g[m].value);let C=v.dir[o];C&&(an(),Ht(C,n,8,[t.el,v,t,e]),ln())}}/*! #__NO_SIDE_EFFECTS__ */function $s(t,e){return Me(t)?(()=>ut({name:t.name},e,{setup:t}))():t}const Hr=t=>!!t.type.__asyncLoader,Lc=t=>t.type.__isKeepAlive;function Ou(t,e){Fc(t,"a",e)}function Ru(t,e){Fc(t,"da",e)}function Fc(t,e,n=yt){const o=t.__wdc||(t.__wdc=()=>{let h=n;for(;h;){if(h.isDeactivated)return;h=h.parent}return t()});if(Ks(e,o,n),n){let h=n.parent;for(;h&&h.parent;)Lc(h.parent.vnode)&&Du(o,e,n,h),h=h.parent}}function Du(t,e,n,o){const h=Ks(e,t,o,!0);Mc(()=>{ha(o[e],h)},n)}function Ks(t,e,n=yt,o=!1){if(n){const h=n[t]||(n[t]=[]),g=e.__weh||(e.__weh=(...m)=>{if(n.isUnmounted)return;an();const v=Rr(n),C=Ht(e,n,t,m);return v(),ln(),C});return o?h.unshift(g):h.push(g),g}}const vi=t=>(e,n=yt)=>(!Js||t==="sp")&&Ks(t,(...o)=>e(...o),n),Lu=vi("bm"),Ta=vi("m"),Fu=vi("bu"),Mu=vi("u"),ba=vi("bum"),Mc=vi("um"),Pu=vi("sp"),ku=vi("rtg"),Bu=vi("rtc");function Nu(t,e=yt){Ks("ec",t,e)}const Lo=t=>t?zc(t)?Oa(t)||t.proxy:Lo(t.parent):null,Cr=ut(Object.create(null),{$:t=>t,$el:t=>t.vnode.el,$data:t=>t.data,$props:t=>t.props,$attrs:t=>t.attrs,$slots:t=>t.slots,$refs:t=>t.refs,$parent:t=>Lo(t.parent),$root:t=>Lo(t.root),$emit:t=>t.emit,$options:t=>Sa(t),$forceUpdate:t=>t.f||(t.f=()=>{t.effect.dirty=!0,Ea(t.update)}),$nextTick:t=>t.n||(t.n=fu.bind(t.proxy)),$watch:t=>Au.bind(t)}),oo=(t,e)=>t!==Qe&&!t.__isScriptSetup&&Ve(t,e),ju={get({_:t},e){const{ctx:n,setupState:o,data:h,props:g,accessCache:m,type:v,appContext:C}=t;let E;if(e[0]!=="$"){const N=m[e];if(N!==void 0)switch(N){case 1:return o[e];case 2:return h[e];case 4:return n[e];case 3:return g[e]}else{if(oo(o,e))return m[e]=1,o[e];if(h!==Qe&&Ve(h,e))return m[e]=2,h[e];if((E=t.propsOptions[0])&&Ve(E,e))return m[e]=3,g[e];if(n!==Qe&&Ve(n,e))return m[e]=4,n[e];Fo&&(m[e]=0)}}const I=Cr[e];let R,L;if(I)return e==="$attrs"&&St(t,"get",e),I(t);if((R=v.__cssModules)&&(R=R[e]))return R;if(n!==Qe&&Ve(n,e))return m[e]=4,n[e];if(L=C.config.globalProperties,Ve(L,e))return L[e]},set({_:t},e,n){const{data:o,setupState:h,ctx:g}=t;return oo(h,e)?(h[e]=n,!0):o!==Qe&&Ve(o,e)?(o[e]=n,!0):Ve(t.props,e)||e[0]==="$"&&e.slice(1)in t?!1:(g[e]=n,!0)},has({_:{data:t,setupState:e,accessCache:n,ctx:o,appContext:h,propsOptions:g}},m){let v;return!!n[m]||t!==Qe&&Ve(t,m)||oo(e,m)||(v=g[0])&&Ve(v,m)||Ve(o,m)||Ve(Cr,m)||Ve(h.config.globalProperties,m)},defineProperty(t,e,n){return n.get!=null?t._.accessCache[e]=0:Ve(n,"value")&&this.set(t,e,n.value,null),Reflect.defineProperty(t,e,n)}};function Ka(t){return De(t)?t.reduce((e,n)=>(e[n]=null,e),{}):t}let Fo=!0;function Uu(t){const e=Sa(t),n=t.proxy,o=t.ctx;Fo=!1,e.beforeCreate&&Za(e.beforeCreate,t,"bc");const{data:h,computed:g,methods:m,watch:v,provide:C,inject:E,created:I,beforeMount:R,mounted:L,beforeUpdate:N,updated:Y,activated:X,deactivated:K,beforeDestroy:J,beforeUnmount:te,destroyed:ne,unmounted:pe,render:he,renderTracked:le,renderTriggered:be,errorCaptured:y,serverPrefetch:_e,expose:Ce,inheritAttrs:ge,components:l,directives:s,filters:a}=e;if(E&&Gu(E,o,null),m)for(const r in m){const c=m[r];Me(c)&&(o[r]=c.bind(n))}if(h){const r=h.call(n,n);st(r)&&(t.data=va(r))}if(Fo=!0,g)for(const r in g){const c=g[r],p=Me(c)?c.bind(n,n):Me(c.get)?c.get.bind(n,n):Mt,f=!Me(c)&&Me(c.set)?c.set.bind(n):Mt,d=vf({get:p,set:f});Object.defineProperty(o,r,{enumerable:!0,configurable:!0,get:()=>d.value,set:_=>d.value=_})}if(v)for(const r in v)Pc(v[r],o,n,r);if(C){const r=Me(C)?C.call(n):C;Reflect.ownKeys(r).forEach(c=>{zu(c,r[c])})}I&&Za(I,t,"c");function i(r,c){De(c)?c.forEach(p=>r(p.bind(n))):c&&r(c.bind(n))}if(i(Lu,R),i(Ta,L),i(Fu,N),i(Mu,Y),i(Ou,X),i(Ru,K),i(Nu,y),i(Bu,le),i(ku,be),i(ba,te),i(Mc,pe),i(Pu,_e),De(Ce))if(Ce.length){const r=t.exposed||(t.exposed={});Ce.forEach(c=>{Object.defineProperty(r,c,{get:()=>n[c],set:p=>n[c]=p})})}else t.exposed||(t.exposed={});he&&t.render===Mt&&(t.render=he),ge!=null&&(t.inheritAttrs=ge),l&&(t.components=l),s&&(t.directives=s)}function Gu(t,e,n=Mt){De(t)&&(t=Mo(t));for(const o in t){const h=t[o];let g;st(h)?"default"in h?g=Xr(h.from||o,h.default,!0):g=Xr(h.from||o):g=Xr(h),It(g)?Object.defineProperty(e,o,{enumerable:!0,configurable:!0,get:()=>g.value,set:m=>g.value=m}):e[o]=g}}function Za(t,e,n){Ht(De(t)?t.map(o=>o.bind(e.proxy)):t.bind(e.proxy),e,n)}function Pc(t,e,n,o){const h=o.includes(".")?Dc(n,o):()=>n[o];if(ft(t)){const g=e[t];Me(g)&&so(h,g)}else if(Me(t))so(h,t.bind(n));else if(st(t))if(De(t))t.forEach(g=>Pc(g,e,n,o));else{const g=Me(t.handler)?t.handler.bind(n):e[t.handler];Me(g)&&so(h,g,t)}}function Sa(t){const e=t.type,{mixins:n,extends:o}=e,{mixins:h,optionsCache:g,config:{optionMergeStrategies:m}}=t.appContext,v=g.get(e);let C;return v?C=v:!h.length&&!n&&!o?C=e:(C={},h.length&&h.forEach(E=>bs(C,E,m,!0)),bs(C,e,m)),st(e)&&g.set(e,C),C}function bs(t,e,n,o=!1){const{mixins:h,extends:g}=e;g&&bs(t,g,n,!0),h&&h.forEach(m=>bs(t,m,n,!0));for(const m in e)if(!(o&&m==="expose")){const v=Vu[m]||n&&n[m];t[m]=v?v(t[m],e[m]):e[m]}return t}const Vu={data:qa,props:Ja,emits:Ja,methods:Qn,computed:Qn,beforeCreate:vt,created:vt,beforeMount:vt,mounted:vt,beforeUpdate:vt,updated:vt,beforeDestroy:vt,beforeUnmount:vt,destroyed:vt,unmounted:vt,activated:vt,deactivated:vt,errorCaptured:vt,serverPrefetch:vt,components:Qn,directives:Qn,watch:Yu,provide:qa,inject:Wu};function qa(t,e){return e?t?function(){return ut(Me(t)?t.call(this,this):t,Me(e)?e.call(this,this):e)}:e:t}function Wu(t,e){return Qn(Mo(t),Mo(e))}function Mo(t){if(De(t)){const e={};for(let n=0;n<t.length;n++)e[t[n]]=t[n];return e}return t}function vt(t,e){return t?[...new Set([].concat(t,e))]:e}function Qn(t,e){return t?ut(Object.create(null),t,e):e}function Ja(t,e){return t?De(t)&&De(e)?[...new Set([...t,...e])]:ut(Object.create(null),Ka(t),Ka(e??{})):e}function Yu(t,e){if(!t)return e;if(!e)return t;const n=ut(Object.create(null),t);for(const o in e)n[o]=vt(t[o],e[o]);return n}function kc(){return{app:null,config:{isNativeTag:Eh,performance:!1,globalProperties:{},optionMergeStrategies:{},errorHandler:void 0,warnHandler:void 0,compilerOptions:{}},mixins:[],components:{},directives:{},provides:Object.create(null),optionsCache:new WeakMap,propsCache:new WeakMap,emitsCache:new WeakMap}}let Hu=0;function Xu(t,e){return function(o,h=null){Me(o)||(o=ut({},o)),h!=null&&!st(h)&&(h=null);const g=kc(),m=new WeakSet;let v=!1;const C=g.app={_uid:Hu++,_component:o,_props:h,_container:null,_context:g,_instance:null,version:yf,get config(){return g.config},set config(E){},use(E,...I){return m.has(E)||(E&&Me(E.install)?(m.add(E),E.install(C,...I)):Me(E)&&(m.add(E),E(C,...I))),C},mixin(E){return g.mixins.includes(E)||g.mixins.push(E),C},component(E,I){return I?(g.components[E]=I,C):g.components[E]},directive(E,I){return I?(g.directives[E]=I,C):g.directives[E]},mount(E,I,R){if(!v){const L=_i(o,h);return L.appContext=g,R===!0?R="svg":R===!1&&(R=void 0),I&&e?e(L,E):t(L,E,R),v=!0,C._container=E,E.__vue_app__=C,Oa(L.component)||L.component.proxy}},unmount(){v&&(t(null,C._container),delete C._container.__vue_app__)},provide(E,I){return g.provides[E]=I,C},runWithContext(E){Ss=C;try{return E()}finally{Ss=null}}};return C}}let Ss=null;function zu(t,e){if(yt){let n=yt.provides;const o=yt.parent&&yt.parent.provides;o===n&&(n=yt.provides=Object.create(o)),n[t]=e}}function Xr(t,e,n=!1){const o=yt||Qt;if(o||Ss){const h=o?o.parent==null?o.vnode.appContext&&o.vnode.appContext.provides:o.parent.provides:Ss._context.provides;if(h&&t in h)return h[t];if(arguments.length>1)return n&&Me(e)?e.call(o&&o.proxy):e}}function $u(t,e,n,o=!1){const h={},g={};Cs(g,qs,1),t.propsDefaults=Object.create(null),Bc(t,e,h,g);for(const m in t.propsOptions[0])m in h||(h[m]=void 0);n?t.props=o?h:su(h):t.type.props?t.props=h:t.props=g,t.attrs=g}function Ku(t,e,n,o){const{props:h,attrs:g,vnode:{patchFlag:m}}=t,v=He(h),[C]=t.propsOptions;let E=!1;if((o||m>0)&&!(m&16)){if(m&8){const I=t.vnode.dynamicProps;for(let R=0;R<I.length;R++){let L=I[R];if(Xs(t.emitsOptions,L))continue;const N=e[L];if(C)if(Ve(g,L))N!==g[L]&&(g[L]=N,E=!0);else{const Y=Bn(L);h[Y]=Po(C,v,Y,N,t,!1)}else N!==g[L]&&(g[L]=N,E=!0)}}}else{Bc(t,e,h,g)&&(E=!0);let I;for(const R in v)(!e||!Ve(e,R)&&((I=Gn(R))===R||!Ve(e,I)))&&(C?n&&(n[R]!==void 0||n[I]!==void 0)&&(h[R]=Po(C,v,R,void 0,t,!0)):delete h[R]);if(g!==v)for(const R in g)(!e||!Ve(e,R))&&(delete g[R],E=!0)}E&&mi(t,"set","$attrs")}function Bc(t,e,n,o){const[h,g]=t.propsOptions;let m=!1,v;if(e)for(let C in e){if(Yr(C))continue;const E=e[C];let I;h&&Ve(h,I=Bn(C))?!g||!g.includes(I)?n[I]=E:(v||(v={}))[I]=E:Xs(t.emitsOptions,C)||(!(C in o)||E!==o[C])&&(o[C]=E,m=!0)}if(g){const C=He(n),E=v||Qe;for(let I=0;I<g.length;I++){const R=g[I];n[R]=Po(h,C,R,E[R],t,!Ve(E,R))}}return m}function Po(t,e,n,o,h,g){const m=t[n];if(m!=null){const v=Ve(m,"default");if(v&&o===void 0){const C=m.default;if(m.type!==Function&&!m.skipFactory&&Me(C)){const{propsDefaults:E}=h;if(n in E)o=E[n];else{const I=Rr(h);o=E[n]=C.call(null,e),I()}}else o=C}m[0]&&(g&&!v?o=!1:m[1]&&(o===""||o===Gn(n))&&(o=!0))}return o}function Nc(t,e,n=!1){const o=e.propsCache,h=o.get(t);if(h)return h;const g=t.props,m={},v=[];let C=!1;if(!Me(t)){const I=R=>{C=!0;const[L,N]=Nc(R,e,!0);ut(m,L),N&&v.push(...N)};!n&&e.mixins.length&&e.mixins.forEach(I),t.extends&&I(t.extends),t.mixins&&t.mixins.forEach(I)}if(!g&&!C)return st(t)&&o.set(t,Ln),Ln;if(De(g))for(let I=0;I<g.length;I++){const R=Bn(g[I]);Qa(R)&&(m[R]=Qe)}else if(g)for(const I in g){const R=Bn(I);if(Qa(R)){const L=g[I],N=m[R]=De(L)||Me(L)?{type:L}:ut({},L);if(N){const Y=il(Boolean,N.type),X=il(String,N.type);N[0]=Y>-1,N[1]=X<0||Y<X,(Y>-1||Ve(N,"default"))&&v.push(R)}}}const E=[m,v];return st(t)&&o.set(t,E),E}function Qa(t){return t[0]!=="$"}function el(t){const e=t&&t.toString().match(/^\s*(function|class) (\w+)/);return e?e[2]:t===null?"null":""}function tl(t,e){return el(t)===el(e)}function il(t,e){return De(e)?e.findIndex(n=>tl(n,t)):Me(e)&&tl(e,t)?0:-1}const jc=t=>t[0]==="_"||t==="$stable",Ia=t=>De(t)?t.map(Zt):[Zt(t)],Zu=(t,e,n)=>{if(e._n)return e;const o=vu((...h)=>Ia(e(...h)),n);return o._c=!1,o},Uc=(t,e,n)=>{const o=t._ctx;for(const h in t){if(jc(h))continue;const g=t[h];if(Me(g))e[h]=Zu(h,g,o);else if(g!=null){const m=Ia(g);e[h]=()=>m}}},Gc=(t,e)=>{const n=Ia(e);t.slots.default=()=>n},qu=(t,e)=>{if(t.vnode.shapeFlag&32){const n=e._;n?(t.slots=He(e),Cs(e,"_",n)):Uc(e,t.slots={})}else t.slots={},e&&Gc(t,e);Cs(t.slots,qs,1)},Ju=(t,e,n)=>{const{vnode:o,slots:h}=t;let g=!0,m=Qe;if(o.shapeFlag&32){const v=e._;v?n&&v===1?g=!1:(ut(h,e),!n&&v===1&&delete h._):(g=!e.$stable,Uc(e,h)),m=e}else e&&(Gc(t,e),m={default:1});if(g)for(const v in h)!jc(v)&&m[v]==null&&delete h[v]};function ko(t,e,n,o,h=!1){if(De(t)){t.forEach((L,N)=>ko(L,e&&(De(e)?e[N]:e),n,o,h));return}if(Hr(o)&&!h)return;const g=o.shapeFlag&4?Oa(o.component)||o.component.proxy:o.el,m=h?null:g,{i:v,r:C}=t,E=e&&e.r,I=v.refs===Qe?v.refs={}:v.refs,R=v.setupState;if(E!=null&&E!==C&&(ft(E)?(I[E]=null,Ve(R,E)&&(R[E]=null)):It(E)&&(E.value=null)),Me(C))Li(C,v,12,[m,I]);else{const L=ft(C),N=It(C);if(L||N){const Y=()=>{if(t.f){const X=L?Ve(R,C)?R[C]:I[C]:C.value;h?De(X)&&ha(X,g):De(X)?X.includes(g)||X.push(g):L?(I[C]=[g],Ve(R,C)&&(R[C]=I[C])):(C.value=[g],t.k&&(I[t.k]=C.value))}else L?(I[C]=m,Ve(R,C)&&(R[C]=m)):N&&(C.value=m,t.k&&(I[t.k]=m))};m?(Y.id=-1,wt(Y,n)):Y()}}}const wt=Su;function Qu(t){return ef(t)}function ef(t,e){const n=rc();n.__VUE__=!0;const{insert:o,remove:h,patchProp:g,createElement:m,createText:v,createComment:C,setText:E,setElementText:I,parentNode:R,nextSibling:L,setScopeId:N=Mt,insertStaticContent:Y}=t,X=(O,A,D,k=null,G=null,W=null,P=void 0,M=null,U=!!A.dynamicChildren)=>{if(O===A)return;O&&!Hn(O,A)&&(k=F(O),_(O,G,W,!0),O=null),A.patchFlag===-2&&(U=!1,A.dynamicChildren=null);const{type:V,ref:H,shapeFlag:Z}=A;switch(V){case Zs:K(O,A,D,k);break;case sn:J(O,A,D,k);break;case lo:O==null&&te(A,D,k,P);break;case ai:l(O,A,D,k,G,W,P,M,U);break;default:Z&1?he(O,A,D,k,G,W,P,M,U):Z&6?s(O,A,D,k,G,W,P,M,U):(Z&64||Z&128)&&V.process(O,A,D,k,G,W,P,M,U,$)}H!=null&&G&&ko(H,O&&O.ref,W,A||O,!A)},K=(O,A,D,k)=>{if(O==null)o(A.el=v(A.children),D,k);else{const G=A.el=O.el;A.children!==O.children&&E(G,A.children)}},J=(O,A,D,k)=>{O==null?o(A.el=C(A.children||""),D,k):A.el=O.el},te=(O,A,D,k)=>{[O.el,O.anchor]=Y(O.children,A,D,k,O.el,O.anchor)},ne=({el:O,anchor:A},D,k)=>{let G;for(;O&&O!==A;)G=L(O),o(O,D,k),O=G;o(A,D,k)},pe=({el:O,anchor:A})=>{let D;for(;O&&O!==A;)D=L(O),h(O),O=D;h(A)},he=(O,A,D,k,G,W,P,M,U)=>{A.type==="svg"?P="svg":A.type==="math"&&(P="mathml"),O==null?le(A,D,k,G,W,P,M,U):_e(O,A,G,W,P,M,U)},le=(O,A,D,k,G,W,P,M)=>{let U,V;const{props:H,shapeFlag:Z,transition:ee,dirs:re}=O;if(U=O.el=m(O.type,W,H&&H.is,H),Z&8?I(U,O.children):Z&16&&y(O.children,U,null,k,G,ao(O,W),P,M),re&&Ni(O,null,k,"created"),be(U,O,O.scopeId,P,k),H){for(const se in H)se!=="value"&&!Yr(se)&&g(U,se,null,H[se],W,O.children,k,G,b);"value"in H&&g(U,"value",null,H.value,W),(V=H.onVnodeBeforeMount)&&Xt(V,k,O)}re&&Ni(O,null,k,"beforeMount");const ie=tf(G,ee);ie&&ee.beforeEnter(U),o(U,A,D),((V=H&&H.onVnodeMounted)||ie||re)&&wt(()=>{V&&Xt(V,k,O),ie&&ee.enter(U),re&&Ni(O,null,k,"mounted")},G)},be=(O,A,D,k,G)=>{if(D&&N(O,D),k)for(let W=0;W<k.length;W++)N(O,k[W]);if(G){let W=G.subTree;if(A===W){const P=G.vnode;be(O,P,P.scopeId,P.slotScopeIds,G.parent)}}},y=(O,A,D,k,G,W,P,M,U=0)=>{for(let V=U;V<O.length;V++){const H=O[V]=M?xi(O[V]):Zt(O[V]);X(null,H,A,D,k,G,W,P,M)}},_e=(O,A,D,k,G,W,P)=>{const M=A.el=O.el;let{patchFlag:U,dynamicChildren:V,dirs:H}=A;U|=O.patchFlag&16;const Z=O.props||Qe,ee=A.props||Qe;let re;if(D&&ji(D,!1),(re=ee.onVnodeBeforeUpdate)&&Xt(re,D,A,O),H&&Ni(A,O,D,"beforeUpdate"),D&&ji(D,!0),V?Ce(O.dynamicChildren,V,M,D,k,ao(A,G),W):P||c(O,A,M,null,D,k,ao(A,G),W,!1),U>0){if(U&16)ge(M,A,Z,ee,D,k,G);else if(U&2&&Z.class!==ee.class&&g(M,"class",null,ee.class,G),U&4&&g(M,"style",Z.style,ee.style,G),U&8){const ie=A.dynamicProps;for(let se=0;se<ie.length;se++){const oe=ie[se],ce=Z[oe],me=ee[oe];(me!==ce||oe==="value")&&g(M,oe,ce,me,G,O.children,D,k,b)}}U&1&&O.children!==A.children&&I(M,A.children)}else!P&&V==null&&ge(M,A,Z,ee,D,k,G);((re=ee.onVnodeUpdated)||H)&&wt(()=>{re&&Xt(re,D,A,O),H&&Ni(A,O,D,"updated")},k)},Ce=(O,A,D,k,G,W,P)=>{for(let M=0;M<A.length;M++){const U=O[M],V=A[M],H=U.el&&(U.type===ai||!Hn(U,V)||U.shapeFlag&70)?R(U.el):D;X(U,V,H,null,k,G,W,P,!0)}},ge=(O,A,D,k,G,W,P)=>{if(D!==k){if(D!==Qe)for(const M in D)!Yr(M)&&!(M in k)&&g(O,M,D[M],null,P,A.children,G,W,b);for(const M in k){if(Yr(M))continue;const U=k[M],V=D[M];U!==V&&M!=="value"&&g(O,M,V,U,P,A.children,G,W,b)}"value"in k&&g(O,"value",D.value,k.value,P)}},l=(O,A,D,k,G,W,P,M,U)=>{const V=A.el=O?O.el:v(""),H=A.anchor=O?O.anchor:v("");let{patchFlag:Z,dynamicChildren:ee,slotScopeIds:re}=A;re&&(M=M?M.concat(re):re),O==null?(o(V,D,k),o(H,D,k),y(A.children||[],D,H,G,W,P,M,U)):Z>0&&Z&64&&ee&&O.dynamicChildren?(Ce(O.dynamicChildren,ee,D,G,W,P,M),(A.key!=null||G&&A===G.subTree)&&Vc(O,A,!0)):c(O,A,D,H,G,W,P,M,U)},s=(O,A,D,k,G,W,P,M,U)=>{A.slotScopeIds=M,O==null?A.shapeFlag&512?G.ctx.activate(A,D,k,P,U):a(A,D,k,G,W,P,U):u(O,A,U)},a=(O,A,D,k,G,W,P)=>{const M=O.component=ff(O,k,G);if(Lc(O)&&(M.ctx.renderer=$),df(M),M.asyncDep){if(G&&G.registerDep(M,i),!O.el){const U=M.subTree=_i(sn);J(null,U,A,D)}}else i(M,O,A,D,G,W,P)},u=(O,A,D)=>{const k=A.component=O.component;if(Cu(O,A,D))if(k.asyncDep&&!k.asyncResolved){r(k,A,D);return}else k.next=A,gu(k.update),k.effect.dirty=!0,k.update();else A.el=O.el,k.vnode=A},i=(O,A,D,k,G,W,P)=>{const M=()=>{if(O.isMounted){let{next:H,bu:Z,u:ee,parent:re,vnode:ie}=O;{const fe=Wc(O);if(fe){H&&(H.el=ie.el,r(O,H,P)),fe.asyncDep.then(()=>{O.isUnmounted||M()});return}}let se=H,oe;ji(O,!1),H?(H.el=ie.el,r(O,H,P)):H=ie,Z&&no(Z),(oe=H.props&&H.props.onVnodeBeforeUpdate)&&Xt(oe,re,H,ie),ji(O,!0);const ce=ro(O),me=O.subTree;O.subTree=ce,X(me,ce,R(me.el),F(me),O,G,W),H.el=ce.el,se===null&&Eu(O,ce.el),ee&&wt(ee,G),(oe=H.props&&H.props.onVnodeUpdated)&&wt(()=>Xt(oe,re,H,ie),G)}else{let H;const{el:Z,props:ee}=A,{bm:re,m:ie,parent:se}=O,oe=Hr(A);if(ji(O,!1),re&&no(re),!oe&&(H=ee&&ee.onVnodeBeforeMount)&&Xt(H,se,A),ji(O,!0),Z&&q){const ce=()=>{O.subTree=ro(O),q(Z,O.subTree,O,G,null)};oe?A.type.__asyncLoader().then(()=>!O.isUnmounted&&ce()):ce()}else{const ce=O.subTree=ro(O);X(null,ce,D,k,O,G,W),A.el=ce.el}if(ie&&wt(ie,G),!oe&&(H=ee&&ee.onVnodeMounted)){const ce=A;wt(()=>Xt(H,se,ce),G)}(A.shapeFlag&256||se&&Hr(se.vnode)&&se.vnode.shapeFlag&256)&&O.a&&wt(O.a,G),O.isMounted=!0,A=D=k=null}},U=O.effect=new da(M,Mt,()=>Ea(V),O.scope),V=O.update=()=>{U.dirty&&U.run()};V.id=O.uid,ji(O,!0),V()},r=(O,A,D)=>{A.component=O;const k=O.vnode.props;O.vnode=A,O.next=null,Ku(O,A.props,k,D),Ju(O,A.children,D),an(),za(O),ln()},c=(O,A,D,k,G,W,P,M,U=!1)=>{const V=O&&O.children,H=O?O.shapeFlag:0,Z=A.children,{patchFlag:ee,shapeFlag:re}=A;if(ee>0){if(ee&128){f(V,Z,D,k,G,W,P,M,U);return}else if(ee&256){p(V,Z,D,k,G,W,P,M,U);return}}re&8?(H&16&&b(V,G,W),Z!==V&&I(D,Z)):H&16?re&16?f(V,Z,D,k,G,W,P,M,U):b(V,G,W,!0):(H&8&&I(D,""),re&16&&y(Z,D,k,G,W,P,M,U))},p=(O,A,D,k,G,W,P,M,U)=>{O=O||Ln,A=A||Ln;const V=O.length,H=A.length,Z=Math.min(V,H);let ee;for(ee=0;ee<Z;ee++){const re=A[ee]=U?xi(A[ee]):Zt(A[ee]);X(O[ee],re,D,null,G,W,P,M,U)}V>H?b(O,G,W,!0,!1,Z):y(A,D,k,G,W,P,M,U,Z)},f=(O,A,D,k,G,W,P,M,U)=>{let V=0;const H=A.length;let Z=O.length-1,ee=H-1;for(;V<=Z&&V<=ee;){const re=O[V],ie=A[V]=U?xi(A[V]):Zt(A[V]);if(Hn(re,ie))X(re,ie,D,null,G,W,P,M,U);else break;V++}for(;V<=Z&&V<=ee;){const re=O[Z],ie=A[ee]=U?xi(A[ee]):Zt(A[ee]);if(Hn(re,ie))X(re,ie,D,null,G,W,P,M,U);else break;Z--,ee--}if(V>Z){if(V<=ee){const re=ee+1,ie=re<H?A[re].el:k;for(;V<=ee;)X(null,A[V]=U?xi(A[V]):Zt(A[V]),D,ie,G,W,P,M,U),V++}}else if(V>ee)for(;V<=Z;)_(O[V],G,W,!0),V++;else{const re=V,ie=V,se=new Map;for(V=ie;V<=ee;V++){const et=A[V]=U?xi(A[V]):Zt(A[V]);et.key!=null&&se.set(et.key,V)}let oe,ce=0;const me=ee-ie+1;let fe=!1,Ae=0;const Ne=new Array(me);for(V=0;V<me;V++)Ne[V]=0;for(V=re;V<=Z;V++){const et=O[V];if(ce>=me){_(et,G,W,!0);continue}let at;if(et.key!=null)at=se.get(et.key);else for(oe=ie;oe<=ee;oe++)if(Ne[oe-ie]===0&&Hn(et,A[oe])){at=oe;break}at===void 0?_(et,G,W,!0):(Ne[at-ie]=V+1,at>=Ae?Ae=at:fe=!0,X(et,A[at],D,null,G,W,P,M,U),ce++)}const mt=fe?nf(Ne):Ln;for(oe=mt.length-1,V=me-1;V>=0;V--){const et=ie+V,at=A[et],Ke=et+1<H?A[et+1].el:k;Ne[V]===0?X(null,at,D,Ke,G,W,P,M,U):fe&&(oe<0||V!==mt[oe]?d(at,D,Ke,2):oe--)}}},d=(O,A,D,k,G=null)=>{const{el:W,type:P,transition:M,children:U,shapeFlag:V}=O;if(V&6){d(O.component.subTree,A,D,k);return}if(V&128){O.suspense.move(A,D,k);return}if(V&64){P.move(O,A,D,$);return}if(P===ai){o(W,A,D);for(let Z=0;Z<U.length;Z++)d(U[Z],A,D,k);o(O.anchor,A,D);return}if(P===lo){ne(O,A,D);return}if(k!==2&&V&1&&M)if(k===0)M.beforeEnter(W),o(W,A,D),wt(()=>M.enter(W),G);else{const{leave:Z,delayLeave:ee,afterLeave:re}=M,ie=()=>o(W,A,D),se=()=>{Z(W,()=>{ie(),re&&re()})};ee?ee(W,ie,se):se()}else o(W,A,D)},_=(O,A,D,k=!1,G=!1)=>{const{type:W,props:P,ref:M,children:U,dynamicChildren:V,shapeFlag:H,patchFlag:Z,dirs:ee}=O;if(M!=null&&ko(M,null,D,O,!0),H&256){A.ctx.deactivate(O);return}const re=H&1&&ee,ie=!Hr(O);let se;if(ie&&(se=P&&P.onVnodeBeforeUnmount)&&Xt(se,A,O),H&6)x(O.component,D,k);else{if(H&128){O.suspense.unmount(D,k);return}re&&Ni(O,null,A,"beforeUnmount"),H&64?O.type.remove(O,A,D,G,$,k):V&&(W!==ai||Z>0&&Z&64)?b(V,A,D,!1,!0):(W===ai&&Z&384||!G&&H&16)&&b(U,A,D),k&&w(O)}(ie&&(se=P&&P.onVnodeUnmounted)||re)&&wt(()=>{se&&Xt(se,A,O),re&&Ni(O,null,A,"unmounted")},D)},w=O=>{const{type:A,el:D,anchor:k,transition:G}=O;if(A===ai){T(D,k);return}if(A===lo){pe(O);return}const W=()=>{h(D),G&&!G.persisted&&G.afterLeave&&G.afterLeave()};if(O.shapeFlag&1&&G&&!G.persisted){const{leave:P,delayLeave:M}=G,U=()=>P(D,W);M?M(O.el,W,U):U()}else W()},T=(O,A)=>{let D;for(;O!==A;)D=L(O),h(O),O=D;h(A)},x=(O,A,D)=>{const{bum:k,scope:G,update:W,subTree:P,um:M}=O;k&&no(k),G.stop(),W&&(W.active=!1,_(P,O,A,D)),M&&wt(M,A),wt(()=>{O.isUnmounted=!0},A),A&&A.pendingBranch&&!A.isUnmounted&&O.asyncDep&&!O.asyncResolved&&O.suspenseId===A.pendingId&&(A.deps--,A.deps===0&&A.resolve())},b=(O,A,D,k=!1,G=!1,W=0)=>{for(let P=W;P<O.length;P++)_(O[P],A,D,k,G)},F=O=>O.shapeFlag&6?F(O.component.subTree):O.shapeFlag&128?O.suspense.next():L(O.anchor||O.el);let B=!1;const z=(O,A,D)=>{O==null?A._vnode&&_(A._vnode,null,null,!0):X(A._vnode||null,O,A,null,null,null,D),B||(B=!0,za(),Sc(),B=!1),A._vnode=O},$={p:X,um:_,m:d,r:w,mt:a,mc:y,pc:c,pbc:Ce,n:F,o:t};let Q,q;return e&&([Q,q]=e($)),{render:z,hydrate:Q,createApp:Xu(z,Q)}}function ao({type:t,props:e},n){return n==="svg"&&t==="foreignObject"||n==="mathml"&&t==="annotation-xml"&&e&&e.encoding&&e.encoding.includes("html")?void 0:n}function ji({effect:t,update:e},n){t.allowRecurse=e.allowRecurse=n}function tf(t,e){return(!t||t&&!t.pendingBranch)&&e&&!e.persisted}function Vc(t,e,n=!1){const o=t.children,h=e.children;if(De(o)&&De(h))for(let g=0;g<o.length;g++){const m=o[g];let v=h[g];v.shapeFlag&1&&!v.dynamicChildren&&((v.patchFlag<=0||v.patchFlag===32)&&(v=h[g]=xi(h[g]),v.el=m.el),n||Vc(m,v)),v.type===Zs&&(v.el=m.el)}}function nf(t){const e=t.slice(),n=[0];let o,h,g,m,v;const C=t.length;for(o=0;o<C;o++){const E=t[o];if(E!==0){if(h=n[n.length-1],t[h]<E){e[o]=h,n.push(o);continue}for(g=0,m=n.length-1;g<m;)v=g+m>>1,t[n[v]]<E?g=v+1:m=v;E<t[n[g]]&&(g>0&&(e[o]=n[g-1]),n[g]=o)}}for(g=n.length,m=n[g-1];g-- >0;)n[g]=m,m=e[m];return n}function Wc(t){const e=t.subTree.component;if(e)return e.asyncDep&&!e.asyncResolved?e:Wc(e)}const rf=t=>t.__isTeleport,ai=Symbol.for("v-fgt"),Zs=Symbol.for("v-txt"),sn=Symbol.for("v-cmt"),lo=Symbol.for("v-stc"),Er=[];let Wt=null;function tn(t=!1){Er.push(Wt=t?null:[])}function sf(){Er.pop(),Wt=Er[Er.length-1]||null}let Or=1;function nl(t){Or+=t}function Yc(t){return t.dynamicChildren=Or>0?Wt||Ln:null,sf(),Or>0&&Wt&&Wt.push(t),t}function xa(t,e,n,o,h,g){return Yc(Yt(t,e,n,o,h,g,!0))}function Is(t,e,n,o,h){return Yc(_i(t,e,n,o,h,!0))}function of(t){return t?t.__v_isVNode===!0:!1}function Hn(t,e){return t.type===e.type&&t.key===e.key}const qs="__vInternal",Hc=({key:t})=>t??null,zr=({ref:t,ref_key:e,ref_for:n})=>(typeof t=="number"&&(t=""+t),t!=null?ft(t)||It(t)||Me(t)?{i:Qt,r:t,k:e,f:!!n}:t:null);function Yt(t,e=null,n=null,o=0,h=null,g=t===ai?0:1,m=!1,v=!1){const C={__v_isVNode:!0,__v_skip:!0,type:t,props:e,key:e&&Hc(e),ref:e&&zr(e),scopeId:zs,slotScopeIds:null,children:n,component:null,suspense:null,ssContent:null,ssFallback:null,dirs:null,transition:null,el:null,anchor:null,target:null,targetAnchor:null,staticCount:0,shapeFlag:g,patchFlag:o,dynamicProps:h,dynamicChildren:null,appContext:null,ctx:Qt};return v?(Aa(C,n),g&128&&t.normalize(C)):n&&(C.shapeFlag|=ft(n)?8:16),Or>0&&!m&&Wt&&(C.patchFlag>0||g&6)&&C.patchFlag!==32&&Wt.push(C),C}const _i=af;function af(t,e=null,n=null,o=0,h=null,g=!1){if((!t||t===Tu)&&(t=sn),of(t)){const v=jn(t,e,!0);return n&&Aa(v,n),Or>0&&!g&&Wt&&(v.shapeFlag&6?Wt[Wt.indexOf(t)]=v:Wt.push(v)),v.patchFlag|=-2,v}if(_f(t)&&(t=t.__vccOpts),e){e=lf(e);let{class:v,style:C}=e;v&&!ft(v)&&(e.class=fa(v)),st(C)&&(vc(C)&&!De(C)&&(C=ut({},C)),e.style=Sr(C))}const m=ft(t)?1:bu(t)?128:rf(t)?64:st(t)?4:Me(t)?2:0;return Yt(t,e,n,o,h,m,g,!0)}function lf(t){return t?vc(t)||qs in t?ut({},t):t:null}function jn(t,e,n=!1){const{props:o,ref:h,patchFlag:g,children:m}=t,v=e?cf(o||{},e):o;return{__v_isVNode:!0,__v_skip:!0,type:t.type,props:v,key:v&&Hc(v),ref:e&&e.ref?n&&h?De(h)?h.concat(zr(e)):[h,zr(e)]:zr(e):h,scopeId:t.scopeId,slotScopeIds:t.slotScopeIds,children:m,target:t.target,targetAnchor:t.targetAnchor,staticCount:t.staticCount,shapeFlag:t.shapeFlag,patchFlag:e&&t.type!==ai?g===-1?16:g|16:g,dynamicProps:t.dynamicProps,dynamicChildren:t.dynamicChildren,appContext:t.appContext,dirs:t.dirs,transition:t.transition,component:t.component,suspense:t.suspense,ssContent:t.ssContent&&jn(t.ssContent),ssFallback:t.ssFallback&&jn(t.ssFallback),el:t.el,anchor:t.anchor,ctx:t.ctx,ce:t.ce}}function Xc(t=" ",e=0){return _i(Zs,null,t,e)}function rl(t="",e=!1){return e?(tn(),Is(sn,null,t)):_i(sn,null,t)}function Zt(t){return t==null||typeof t=="boolean"?_i(sn):De(t)?_i(ai,null,t.slice()):typeof t=="object"?xi(t):_i(Zs,null,String(t))}function xi(t){return t.el===null&&t.patchFlag!==-1||t.memo?t:jn(t)}function Aa(t,e){let n=0;const{shapeFlag:o}=t;if(e==null)e=null;else if(De(e))n=16;else if(typeof e=="object")if(o&65){const h=e.default;h&&(h._c&&(h._d=!1),Aa(t,h()),h._c&&(h._d=!0));return}else{n=32;const h=e._;!h&&!(qs in e)?e._ctx=Qt:h===3&&Qt&&(Qt.slots._===1?e._=1:(e._=2,t.patchFlag|=1024))}else Me(e)?(e={default:e,_ctx:Qt},n=32):(e=String(e),o&64?(n=16,e=[Xc(e)]):n=8);t.children=e,t.shapeFlag|=n}function cf(...t){const e={};for(let n=0;n<t.length;n++){const o=t[n];for(const h in o)if(h==="class")e.class!==o.class&&(e.class=fa([e.class,o.class]));else if(h==="style")e.style=Sr([e.style,o.style]);else if(Us(h)){const g=e[h],m=o[h];m&&g!==m&&!(De(g)&&g.includes(m))&&(e[h]=g?[].concat(g,m):m)}else h!==""&&(e[h]=o[h])}return e}function Xt(t,e,n,o=null){Ht(t,e,7,[n,o])}const hf=kc();let uf=0;function ff(t,e,n){const o=t.type,h=(e?e.appContext:t.appContext)||hf,g={uid:uf++,vnode:t,type:o,parent:e,appContext:h,root:null,next:null,subTree:null,effect:null,update:null,scope:new Bh(!0),render:null,proxy:null,exposed:null,exposeProxy:null,withProxy:null,provides:e?e.provides:Object.create(h.provides),accessCache:null,renderCache:[],components:null,directives:null,propsOptions:Nc(o,h),emitsOptions:xc(o,h),emit:null,emitted:null,propsDefaults:Qe,inheritAttrs:o.inheritAttrs,ctx:Qe,data:Qe,props:Qe,attrs:Qe,slots:Qe,refs:Qe,setupState:Qe,setupContext:null,attrsProxy:null,slotsProxy:null,suspense:n,suspenseId:n?n.pendingId:0,asyncDep:null,asyncResolved:!1,isMounted:!1,isUnmounted:!1,isDeactivated:!1,bc:null,c:null,bm:null,m:null,bu:null,u:null,um:null,bum:null,da:null,a:null,rtg:null,rtc:null,ec:null,sp:null};return g.ctx={_:g},g.root=e?e.root:g,g.emit=_u.bind(null,g),t.ce&&t.ce(g),g}let yt=null,xs,Bo;{const t=rc(),e=(n,o)=>{let h;return(h=t[n])||(h=t[n]=[]),h.push(o),g=>{h.length>1?h.forEach(m=>m(g)):h[0](g)}};xs=e("__VUE_INSTANCE_SETTERS__",n=>yt=n),Bo=e("__VUE_SSR_SETTERS__",n=>Js=n)}const Rr=t=>{const e=yt;return xs(t),t.scope.on(),()=>{t.scope.off(),xs(e)}},sl=()=>{yt&&yt.scope.off(),xs(null)};function zc(t){return t.vnode.shapeFlag&4}let Js=!1;function df(t,e=!1){e&&Bo(e);const{props:n,children:o}=t.vnode,h=zc(t);$u(t,n,h,e),qu(t,o);const g=h?gf(t,e):void 0;return e&&Bo(!1),g}function gf(t,e){const n=t.type;t.accessCache=Object.create(null),t.proxy=yc(new Proxy(t.ctx,ju));const{setup:o}=n;if(o){const h=t.setupContext=o.length>1?mf(t):null,g=Rr(t);an();const m=Li(o,t,0,[t.props,h]);if(ln(),g(),ic(m)){if(m.then(sl,sl),e)return m.then(v=>{ol(t,v,e)}).catch(v=>{Hs(v,t,0)});t.asyncDep=m}else ol(t,m,e)}else $c(t,e)}function ol(t,e,n){Me(e)?t.type.__ssrInlineRender?t.ssrRender=e:t.render=e:st(e)&&(t.setupState=Ec(e)),$c(t,n)}let al;function $c(t,e,n){const o=t.type;if(!t.render){if(!e&&al&&!o.render){const h=o.template||Sa(t).template;if(h){const{isCustomElement:g,compilerOptions:m}=t.appContext.config,{delimiters:v,compilerOptions:C}=o,E=ut(ut({isCustomElement:g,delimiters:v},m),C);o.render=al(h,E)}}t.render=o.render||Mt}{const h=Rr(t);an();try{Uu(t)}finally{ln(),h()}}}function pf(t){return t.attrsProxy||(t.attrsProxy=new Proxy(t.attrs,{get(e,n){return St(t,"get","$attrs"),e[n]}}))}function mf(t){const e=n=>{t.exposed=n||{}};return{get attrs(){return pf(t)},slots:t.slots,emit:t.emit,expose:e}}function Oa(t){if(t.exposed)return t.exposeProxy||(t.exposeProxy=new Proxy(Ec(yc(t.exposed)),{get(e,n){if(n in e)return e[n];if(n in Cr)return Cr[n](t)},has(e,n){return n in e||n in Cr}}))}function _f(t){return Me(t)&&"__vccOpts"in t}const vf=(t,e)=>ou(t,e,Js),yf="3.4.13";/**
* @vue/runtime-dom v3.4.13
* (c) 2018-present Yuxi (Evan) You and Vue contributors
* @license MIT
**/const wf="http://www.w3.org/2000/svg",Cf="http://www.w3.org/1998/Math/MathML",Ai=typeof document<"u"?document:null,ll=Ai&&Ai.createElement("template"),Ef={insert:(t,e,n)=>{e.insertBefore(t,n||null)},remove:t=>{const e=t.parentNode;e&&e.removeChild(t)},createElement:(t,e,n,o)=>{const h=e==="svg"?Ai.createElementNS(wf,t):e==="mathml"?Ai.createElementNS(Cf,t):Ai.createElement(t,n?{is:n}:void 0);return t==="select"&&o&&o.multiple!=null&&h.setAttribute("multiple",o.multiple),h},createText:t=>Ai.createTextNode(t),createComment:t=>Ai.createComment(t),setText:(t,e)=>{t.nodeValue=e},setElementText:(t,e)=>{t.textContent=e},parentNode:t=>t.parentNode,nextSibling:t=>t.nextSibling,querySelector:t=>Ai.querySelector(t),setScopeId(t,e){t.setAttribute(e,"")},insertStaticContent(t,e,n,o,h,g){const m=n?n.previousSibling:e.lastChild;if(h&&(h===g||h.nextSibling))for(;e.insertBefore(h.cloneNode(!0),n),!(h===g||!(h=h.nextSibling)););else{ll.innerHTML=o==="svg"?`<svg>${t}</svg>`:o==="mathml"?`<math>${t}</math>`:t;const v=ll.content;if(o==="svg"||o==="mathml"){const C=v.firstChild;for(;C.firstChild;)v.appendChild(C.firstChild);v.removeChild(C)}e.insertBefore(v,n)}return[m?m.nextSibling:e.firstChild,n?n.previousSibling:e.lastChild]}},Tf=Symbol("_vtc");function bf(t,e,n){const o=t[Tf];o&&(e=(e?[e,...o]:[...o]).join(" ")),e==null?t.removeAttribute("class"):n?t.setAttribute("class",e):t.className=e}const Sf=Symbol("_vod"),If=Symbol("");function xf(t,e,n){const o=t.style,h=o.display,g=ft(n);if(n&&!g){if(e&&!ft(e))for(const m in e)n[m]==null&&No(o,m,"");for(const m in n)No(o,m,n[m])}else if(g){if(e!==n){const m=o[If];m&&(n+=";"+m),o.cssText=n}}else e&&t.removeAttribute("style");Sf in t&&(o.display=h)}const cl=/\s*!important$/;function No(t,e,n){if(De(n))n.forEach(o=>No(t,e,o));else if(n==null&&(n=""),e.startsWith("--"))t.setProperty(e,n);else{const o=Af(t,e);cl.test(n)?t.setProperty(Gn(o),n.replace(cl,""),"important"):t[o]=n}}const hl=["Webkit","Moz","ms"],co={};function Af(t,e){const n=co[e];if(n)return n;let o=Bn(e);if(o!=="filter"&&o in t)return co[e]=o;o=nc(o);for(let h=0;h<hl.length;h++){const g=hl[h]+o;if(g in t)return co[e]=g}return e}const ul="http://www.w3.org/1999/xlink";function Of(t,e,n,o,h){if(o&&e.startsWith("xlink:"))n==null?t.removeAttributeNS(ul,e.slice(6,e.length)):t.setAttributeNS(ul,e,n);else{const g=kh(e);n==null||g&&!sc(n)?t.removeAttribute(e):t.setAttribute(e,g?"":n)}}function Rf(t,e,n,o,h,g,m){if(e==="innerHTML"||e==="textContent"){o&&m(o,h,g),t[e]=n??"";return}const v=t.tagName;if(e==="value"&&v!=="PROGRESS"&&!v.includes("-")){t._value=n;const E=v==="OPTION"?t.getAttribute("value"):t.value,I=n??"";E!==I&&(t.value=I),n==null&&t.removeAttribute(e);return}let C=!1;if(n===""||n==null){const E=typeof t[e];E==="boolean"?n=sc(n):n==null&&E==="string"?(n="",C=!0):E==="number"&&(n=0,C=!0)}try{t[e]=n}catch{}C&&t.removeAttribute(e)}function Df(t,e,n,o){t.addEventListener(e,n,o)}function Lf(t,e,n,o){t.removeEventListener(e,n,o)}const fl=Symbol("_vei");function Ff(t,e,n,o,h=null){const g=t[fl]||(t[fl]={}),m=g[e];if(o&&m)m.value=o;else{const[v,C]=Mf(e);if(o){const E=g[e]=Bf(o,h);Df(t,v,E,C)}else m&&(Lf(t,v,m,C),g[e]=void 0)}}const dl=/(?:Once|Passive|Capture)$/;function Mf(t){let e;if(dl.test(t)){e={};let o;for(;o=t.match(dl);)t=t.slice(0,t.length-o[0].length),e[o[0].toLowerCase()]=!0}return[t[2]===":"?t.slice(3):Gn(t.slice(2)),e]}let ho=0;const Pf=Promise.resolve(),kf=()=>ho||(Pf.then(()=>ho=0),ho=Date.now());function Bf(t,e){const n=o=>{if(!o._vts)o._vts=Date.now();else if(o._vts<=n.attached)return;Ht(Nf(o,n.value),e,5,[o])};return n.value=t,n.attached=kf(),n}function Nf(t,e){if(De(e)){const n=t.stopImmediatePropagation;return t.stopImmediatePropagation=()=>{n.call(t),t._stopped=!0},e.map(o=>h=>!h._stopped&&o&&o(h))}else return e}const gl=t=>t.charCodeAt(0)===111&&t.charCodeAt(1)===110&&t.charCodeAt(2)>96&&t.charCodeAt(2)<123,jf=(t,e,n,o,h,g,m,v,C)=>{const E=h==="svg";e==="class"?bf(t,o,E):e==="style"?xf(t,n,o):Us(e)?ca(e)||Ff(t,e,n,o,m):(e[0]==="."?(e=e.slice(1),!0):e[0]==="^"?(e=e.slice(1),!1):Uf(t,e,o,E))?Rf(t,e,o,g,m,v,C):(e==="true-value"?t._trueValue=o:e==="false-value"&&(t._falseValue=o),Of(t,e,o,E))};function Uf(t,e,n,o){if(o)return!!(e==="innerHTML"||e==="textContent"||e in t&&gl(e)&&Me(n));if(e==="spellcheck"||e==="draggable"||e==="translate"||e==="form"||e==="list"&&t.tagName==="INPUT"||e==="type"&&t.tagName==="TEXTAREA")return!1;if(e==="width"||e==="height"){const h=t.tagName;if(h==="IMG"||h==="VIDEO"||h==="CANVAS"||h==="SOURCE")return!1}return gl(e)&&ft(n)?!1:e in t}const Gf=ut({patchProp:jf},Ef);let pl;function Vf(){return pl||(pl=Qu(Gf))}const Wf=(...t)=>{const e=Vf().createApp(...t),{mount:n}=e;return e.mount=o=>{const h=Hf(o);if(!h)return;const g=e._component;!Me(g)&&!g.render&&!g.template&&(g.template=h.innerHTML),h.innerHTML="";const m=n(h,!1,Yf(h));return h instanceof Element&&(h.removeAttribute("v-cloak"),h.setAttribute("data-v-app","")),m},e};function Yf(t){if(t instanceof SVGElement)return"svg";if(typeof MathMLElement=="function"&&t instanceof MathMLElement)return"mathml"}function Hf(t){return ft(t)?document.querySelector(t):t}/*!
 * Dynamsoft JavaScript Library
 * @product Dynamsoft Core JS Edition
 * @website https://www.dynamsoft.com
 * @copyright Copyright 2024, Dynamsoft Corporation
 * @author Dynamsoft
 * @version 3.0.32
 * @fileoverview Dynamsoft JavaScript Library for Core
 * More info on Dynamsoft Core JS: https://www.dynamsoft.com/capture-vision/docs/web/programming/javascript/api-reference/core/core-module.html
 */function Le(t,e,n,o){if(n==="a"&&!o)throw new TypeError("Private accessor was defined without a getter");if(typeof e=="function"?t!==e||!o:!e.has(t))throw new TypeError("Cannot read private member from an object whose class did not declare it");return n==="m"?o:n==="a"?o.call(t):o?o.value:e.get(t)}function Ui(t,e,n,o,h){if(o==="m")throw new TypeError("Private method is not writable");if(o==="a"&&!h)throw new TypeError("Private accessor was defined without a setter");if(typeof e=="function"?t!==e||!h:!e.has(t))throw new TypeError("Cannot write private member to an object whose class did not declare it");return o==="a"?h.call(t,n):h?h.value=n:e.set(t,n),n}var nn,ei,Te;typeof SuppressedError=="function"&&SuppressedError,function(t){t[t.BOPM_BLOCK=0]="BOPM_BLOCK",t[t.BOPM_UPDATE=1]="BOPM_UPDATE"}(nn||(nn={})),function(t){t[t.CCUT_AUTO=0]="CCUT_AUTO",t[t.CCUT_FULL_CHANNEL=1]="CCUT_FULL_CHANNEL",t[t.CCUT_Y_CHANNEL_ONLY=2]="CCUT_Y_CHANNEL_ONLY",t[t.CCUT_RGB_R_CHANNEL_ONLY=3]="CCUT_RGB_R_CHANNEL_ONLY",t[t.CCUT_RGB_G_CHANNEL_ONLY=4]="CCUT_RGB_G_CHANNEL_ONLY",t[t.CCUT_RGB_B_CHANNEL_ONLY=5]="CCUT_RGB_B_CHANNEL_ONLY"}(ei||(ei={})),function(t){t[t.IPF_BINARY=0]="IPF_BINARY",t[t.IPF_BINARYINVERTED=1]="IPF_BINARYINVERTED",t[t.IPF_GRAYSCALED=2]="IPF_GRAYSCALED",t[t.IPF_NV21=3]="IPF_NV21",t[t.IPF_RGB_565=4]="IPF_RGB_565",t[t.IPF_RGB_555=5]="IPF_RGB_555",t[t.IPF_RGB_888=6]="IPF_RGB_888",t[t.IPF_ARGB_8888=7]="IPF_ARGB_8888",t[t.IPF_RGB_161616=8]="IPF_RGB_161616",t[t.IPF_ARGB_16161616=9]="IPF_ARGB_16161616",t[t.IPF_ABGR_8888=10]="IPF_ABGR_8888",t[t.IPF_ABGR_16161616=11]="IPF_ABGR_16161616",t[t.IPF_BGR_888=12]="IPF_BGR_888",t[t.IPF_BINARY_8=13]="IPF_BINARY_8",t[t.IPF_NV12=14]="IPF_NV12"}(Te||(Te={}));const Kc=t=>Object.prototype.toString.call(t),Zc=t=>Array.isArray?Array.isArray(t):Kc(t)==="[object Array]",Ra=t=>Kc(t)==="[object Boolean]",ht=t=>typeof t=="number"&&!Number.isNaN(t),ki=t=>t!==null&&typeof t=="object"&&!Array.isArray(t),Xf=t=>!!ki(t)&&t.bytes instanceof Uint8Array&&!!ht(t.width)&&!(t.width<=0)&&!!ht(t.height)&&!(t.height<=0)&&!!ht(t.stride)&&!(t.stride<=0)&&"format"in t&&!("tag"in t&&!$f(t.tag)),zf=t=>!!ki(t)&&!!ht(t.left)&&!(t.left<0)&&!!ht(t.top)&&!(t.top<0)&&!!ht(t.right)&&!(t.right<0)&&!!ht(t.bottom)&&!(t.bottom<0)&&!(t.left>=t.right)&&!(t.top>=t.bottom)&&!!Ra(t.isMeasuredInPercentage),$f=t=>!!ki(t)&&!!ht(t.imageId)&&"type"in t,Da=t=>!!ki(t)&&!!ht(t.x)&&!!ht(t.y),Kf=t=>!!ki(t)&&!!Zc(t.points)&&t.points.length!=0&&!t.points.some(e=>!Da(e)),Zf=t=>!!ki(t)&&!!Zc(t.points)&&t.points.length!=0&&t.points.length==4&&!t.points.some(e=>!Da(e)),qf=t=>!!ki(t)&&!!ht(t.x)&&!!ht(t.y)&&!!ht(t.width)&&!(t.width<0)&&!!ht(t.height)&&!(t.height<0)&&!("isMeasuredInPercentage"in t&&!Ra(t.isMeasuredInPercentage)),Dr=(t,e)=>{let n=t.split("."),o=e.split(".");for(let h=0;h<n.length&&h<o.length;++h){let g=n[h],m=o[h];if(g===m)continue;let v=parseInt(n[h]),C=parseInt(o[h]);return v===C||Number.isNaN(v)&&Number.isNaN(C)?g<m?-1:1:v<C||Number.isNaN(v)&&Number.isInteger(C)?-1:1}return n.length===o.length?0:n.length<o.length?-1:1};var $r,nt,Gi,er,tr,kt,Vi,jo;let Uo=class ti{get _isFetchingStarted(){return Le(this,tr,"f")}constructor(){$r.add(this),nt.set(this,[]),Gi.set(this,1),er.set(this,nn.BOPM_BLOCK),tr.set(this,!1),kt.set(this,void 0),Vi.set(this,ei.CCUT_AUTO)}setErrorListener(e){}addImageToBuffer(e){var n;if(!Xf(e))throw new TypeError("Invalid 'image'.");if(!((n=e.tag)===null||n===void 0)&&n.hasOwnProperty("imageId")&&typeof e.tag.imageId=="number"&&this.hasImage(e.tag.imageId))throw new Error("Existed imageId.");if(Le(this,nt,"f").length>=Le(this,Gi,"f"))switch(Le(this,er,"f")){case nn.BOPM_BLOCK:break;case nn.BOPM_UPDATE:if(Le(this,nt,"f").push(e),ki(Le(this,kt,"f"))&&ht(Le(this,kt,"f").imageId)&&Le(this,kt,"f").keepInBuffer==1)for(;Le(this,nt,"f").length>Le(this,Gi,"f");){const o=Le(this,nt,"f").findIndex(h=>{var g;return((g=h.tag)===null||g===void 0?void 0:g.imageId)!==Le(this,kt,"f").imageId});Le(this,nt,"f").splice(o,1)}else Le(this,nt,"f").splice(0,Le(this,nt,"f").length-Le(this,Gi,"f"))}else Le(this,nt,"f").push(e)}getImage(){if(Le(this,nt,"f").length===0)return null;let e;if(Le(this,kt,"f")&&ht(Le(this,kt,"f").imageId)){const n=Le(this,$r,"m",jo).call(this,Le(this,kt,"f").imageId);if(n<0)throw new Error(`Image with id ${Le(this,kt,"f").imageId} doesn't exist.`);e=Le(this,nt,"f").slice(n,n+1)[0]}else e=Le(this,nt,"f").pop();if([Te.IPF_RGB_565,Te.IPF_RGB_555,Te.IPF_RGB_888,Te.IPF_ARGB_8888,Te.IPF_RGB_161616,Te.IPF_ARGB_16161616,Te.IPF_ABGR_8888,Te.IPF_ABGR_16161616,Te.IPF_BGR_888].includes(e.format)){if(Le(this,Vi,"f")===ei.CCUT_RGB_R_CHANNEL_ONLY){ti._onLog&&ti._onLog("only get R channel data.");const n=new Uint8Array(e.width*e.height);for(let o=0;o<n.length;o++)switch(e.format){case Te.IPF_RGB_565:case Te.IPF_RGB_555:case Te.IPF_RGB_888:case Te.IPF_RGB_161616:n[o]=e.bytes[3*o+2];break;case Te.IPF_ARGB_8888:case Te.IPF_ARGB_16161616:n[o]=e.bytes[4*o+2];break;case Te.IPF_BGR_888:n[o]=e.bytes[3*o];break;case Te.IPF_ABGR_8888:case Te.IPF_ABGR_16161616:n[o]=e.bytes[4*o]}e.bytes=n,e.stride=e.width,e.format=Te.IPF_GRAYSCALED}else if(Le(this,Vi,"f")===ei.CCUT_RGB_G_CHANNEL_ONLY){ti._onLog&&ti._onLog("only get G channel data.");const n=new Uint8Array(e.width*e.height);for(let o=0;o<n.length;o++)switch(e.format){case Te.IPF_RGB_565:case Te.IPF_RGB_555:case Te.IPF_RGB_888:case Te.IPF_RGB_161616:case Te.IPF_BGR_888:n[o]=e.bytes[3*o+1];break;case Te.IPF_ARGB_8888:case Te.IPF_ARGB_16161616:case Te.IPF_ABGR_8888:case Te.IPF_ABGR_16161616:n[o]=e.bytes[4*o+1]}e.bytes=n,e.stride=e.width,e.format=Te.IPF_GRAYSCALED}else if(Le(this,Vi,"f")===ei.CCUT_RGB_B_CHANNEL_ONLY){ti._onLog&&ti._onLog("only get B channel data.");const n=new Uint8Array(e.width*e.height);for(let o=0;o<n.length;o++)switch(e.format){case Te.IPF_RGB_565:case Te.IPF_RGB_555:case Te.IPF_RGB_888:case Te.IPF_RGB_161616:n[o]=e.bytes[3*o];break;case Te.IPF_ARGB_8888:case Te.IPF_ARGB_16161616:n[o]=e.bytes[4*o];break;case Te.IPF_BGR_888:n[o]=e.bytes[3*o+2];break;case Te.IPF_ABGR_8888:case Te.IPF_ABGR_16161616:n[o]=e.bytes[4*o+2]}e.bytes=n,e.stride=e.width,e.format=Te.IPF_GRAYSCALED}}else[Te.IPF_NV21,Te.IPF_NV12].includes(e.format)&&ti._onLog&&ti._onLog("NV21 or NV12 is not supported.");return e}setNextImageToReturn(e,n){if(!((...o)=>o.length!==0&&o.every(h=>ht(h)))(e))throw new TypeError("Invalid 'imageId'.");if(n!==void 0&&!Ra(n))throw new TypeError("Invalid 'keepInBuffer'.");Ui(this,kt,{imageId:e,keepInBuffer:n},"f")}_resetNextReturnedImage(){Ui(this,kt,null,"f")}hasImage(e){return Le(this,$r,"m",jo).call(this,e)>=0}startFetching(){Ui(this,tr,!0,"f")}stopFetching(){Ui(this,tr,!1,"f")}setMaxImageCount(e){if(typeof e!="number")throw new TypeError("Invalid 'count'.");if(e<1||Math.round(e)!==e)throw new Error("Invalid 'count'.");for(Ui(this,Gi,e,"f");Le(this,nt,"f")&&Le(this,nt,"f").length>e;)Le(this,nt,"f").shift()}getMaxImageCount(){return Le(this,Gi,"f")}getImageCount(){return Le(this,nt,"f").length}clearBuffer(){Le(this,nt,"f").length=0}isBufferEmpty(){return Le(this,nt,"f").length===0}setBufferOverflowProtectionMode(e){Ui(this,er,e,"f")}getBufferOverflowProtectionMode(){return Le(this,er,"f")}setColourChannelUsageType(e){Ui(this,Vi,e,"f")}getColourChannelUsageType(){return Le(this,Vi,"f")}};nt=new WeakMap,Gi=new WeakMap,er=new WeakMap,tr=new WeakMap,kt=new WeakMap,Vi=new WeakMap,$r=new WeakSet,jo=function(t){if(typeof t!="number")throw new TypeError("Invalid 'imageId'.");return Le(this,nt,"f").findIndex(e=>{var n;return((n=e.tag)===null||n===void 0?void 0:n.imageId)===t})};const As=typeof self>"u",Kr=(()=>{if(!As&&document.currentScript){let t=document.currentScript.src,e=t.indexOf("?");if(e!=-1)t=t.substring(0,e);else{let n=t.indexOf("#");n!=-1&&(t=t.substring(0,n))}return t.substring(0,t.lastIndexOf("/")+1)}return"./"})(),Zr=t=>{if(t==null&&(t="./"),!As){let e=document.createElement("a");e.href=t,t=e.href}return t.endsWith("/")||(t+="/"),t};let Xn,fi,jr,Os,Et;typeof navigator<"u"&&(Xn=navigator,fi=Xn.userAgent,jr=Xn.platform,Os=Xn.mediaDevices),function(){if(!As){const t={Edge:{search:"Edg",verSearch:"Edg"},OPR:null,Chrome:null,Safari:{str:Xn.vendor,search:"Apple",verSearch:["Version","iPhone OS","CPU OS"]},Firefox:null,Explorer:{search:"MSIE",verSearch:"MSIE"}},e={HarmonyOS:null,Android:null,iPhone:null,iPad:null,Windows:{str:jr,search:"Win"},Mac:{str:jr},Linux:{str:jr}};let n="unknownBrowser",o=0,h="unknownOS";for(let g in t){const m=t[g]||{};let v=m.str||fi,C=m.search||g,E=m.verStr||fi,I=m.verSearch||g;if(I instanceof Array||(I=[I]),v.indexOf(C)!=-1){n=g;for(let R of I){let L=E.indexOf(R);if(L!=-1){o=parseFloat(E.substring(L+R.length+1));break}}break}}for(let g in e){const m=e[g]||{};let v=m.str||fi,C=m.search||g;if(v.indexOf(C)!=-1){h=g;break}}h=="Linux"&&fi.indexOf("Windows NT")!=-1&&(h="HarmonyOS"),Et={browser:n,version:o,OS:h}}As&&(Et={browser:"ssr",version:0,OS:"ssr"})}();const Jf=typeof WebAssembly<"u"&&fi&&!(/Safari/.test(fi)&&!/Chrome/.test(fi)&&/\(.+\s11_2_([2-6]).*\)/.test(fi)),Qf=!(typeof Worker>"u"),qc=!(!Os||!Os.getUserMedia),ed=async()=>{let t=!1;if(qc)try{(await Os.getUserMedia({video:!0})).getTracks().forEach(e=>{e.stop()}),t=!0}catch{}return t};Et.browser==="Chrome"&&Et.version>66||Et.browser==="Safari"&&Et.version>13||Et.browser==="OPR"&&Et.version>43||Et.browser==="Edge"&&Et.version;const ml=t=>t&&typeof t=="object"&&typeof t.then=="function";let td=class extends Promise{constructor(e){let n,o;super((h,g)=>{n=h,o=g}),this._s="pending",this.resolve=h=>{this.isPending&&(ml(h)?this.task=h:(this._s="fulfilled",n(h)))},this.reject=h=>{this.isPending&&(this._s="rejected",o(h))},this.task=e}get status(){return this._s}get isPending(){return this._s==="pending"}get isFulfilled(){return this._s==="fulfilled"}get isRejected(){return this._s==="rejected"}get task(){return this._task}set task(e){let n;this._task=e,ml(e)?n=e:typeof e=="function"&&(n=new Promise(e)),n&&(async()=>{try{const o=await n;e===this._task&&this.resolve(o)}catch(o){e===this._task&&this.reject(o)}})()}get isEmpty(){return this._task==null}};const Rs={},Ds=t=>{let e=Rs[t],n=!1;return e?e.isEmpty?e.task=()=>{}:n=!0:e=Rs[t]=new td(()=>{}),{p:e,justWait:n}};let Ue,Jc=0;const qe=()=>Jc++,Ye={};let Fi;const id=t=>{Fi=t,Ue&&Ue.postMessage({type:"setBLog",body:{value:!!t}})};let La=!1;const nd=t=>{La=t,Ue&&Ue.postMessage({type:"setBDebug",body:{value:!!t}})},Zi={},bt={},uo=t=>t==="std"?Zr(Kr+"../../dynamsoft-capture-vision-std@1.0.0/dist/"):t==="dip"?Zr(Kr+"../../dynamsoft-image-processing@2.0.30/dist/"):t==="dcm"?Zr(Kr+"../../dynamsoft-label-recognizer-data@1.0.0/dist/"):void 0,We={std:{version:"1.0.0",path:uo("std")},core:{version:"3.0.32",path:Kr},dip:{version:"2.0.30",path:uo("dip")},dcm:uo("dcm")},ir=new Proxy(We,{get(t,e,n){let o=Reflect.get(t,e,n);return o&&o.path&&(o=o.path),o}}),Un={core:{js:!0,wasm:!0},dip:{wasm:!0}},li=async t=>{t instanceof Array||(t=t?[t]:[]),t=t.map(v=>v.toLowerCase()).filter(v=>v!="core"&&v!="std");for(let v of t)if(!Un[v]&&v!=="dedicator")throw Error("Module '"+v+"' not existed.");t.some(v=>["dbr","dlr","ddn"].includes(v))&&(t.unshift("dip"),t=[...new Set(t)]);let e=!1;const n=[];{const{p:v,justWait:C}=Ds("core");C?await v:(n.push(v),e=!0)}const o={};for(let v of t){const{p:C,justWait:E}=Ds(v);E?await C:n.push(C),o[v]=Un[v]}if(n.length==0)return;const h={};for(let v in ir){if(v=="rootDirectory")continue;let C=ir[v];ir.rootDirectory&&(C=ir.rootDirectory+"/"+C),h[v]=Zr(C)}const g={engineResourcePaths:h,autoResources:o,names:t};if(e){g.needLoadCore=!0;let v=h.core+ot._workerName;h.rootDirectory&&(v=h.rootDirectory+v),v.startsWith(location.origin)||(v=await fetch(v).then(C=>C.blob()).then(C=>URL.createObjectURL(C))),Ue=new Worker(v),Ue.onerror=C=>{let E=new Error(C.message);for(let I of n)I.reject(E)},Ue.addEventListener("message",C=>{let E=C.data?C.data:C;switch(E.type){case"log":Fi&&Fi(E.message);break;case"task":{let I=E.id,R=E.body;try{Ye[I](R),delete Ye[I]}catch(L){throw delete Ye[I],L}break}case"event":{let I=E.id,R=E.body;try{Ye[I](R)}catch(L){throw L}break}default:console.log(C)}}),g.bLog=!!Fi,g.bd=La,g.dm=location.origin.startsWith("http")?location.origin:"https://localhost"}let m=Jc++;return Ye[m]=v=>{if(v.success){Object.assign(Zi,v.versions),JSON.stringify(v.versions)!=="{}"&&(ot._versions=v.versions);for(let C of n)C.resolve(void 0)}else{const C=Error(v.message);v.stack&&(C.stack=v.stack);for(let E of n)E.reject(C)}},Ue.postMessage({type:"loadWasm",body:g,id:m}),n[0]};class ot{static get engineResourcePaths(){return ir}static set engineResourcePaths(e){Object.assign(We,e)}static get bSupportDce4Module(){return this._bSupportDce4Module}static get bSupportIRTModule(){return this._bSupportIRTModule}static get versions(){return this._versions}static get onLog(){return Fi}static set onLog(e){id(e)}static get _bDebug(){return La}static set _bDebug(e){nd(e)}static isModuleLoaded(e){return e=(e=e||"core").toLowerCase(),!!Rs[e]&&Rs[e].isFulfilled}static async loadWasm(e){return await li(e)}static async detectEnvironment(){return await(async()=>({wasm:Jf,worker:Qf,getUserMedia:qc,camera:await ed(),browser:Et.browser,version:Et.version,OS:Et.OS}))()}static async getModuleVersion(){return await new Promise((e,n)=>{let o=qe();Ye[o]=async h=>{if(h.success)return e(h.versions);{let g=new Error(h.message);return g.stack=h.stack+`
`+g.stack,n(g)}},Ue.postMessage({type:"getModuleVersion",id:o})})}static getVersion(){const e=Zi.core&&Zi.core.worker,n=Zi.core&&Zi.core.wasm;return`3.0.32(Worker: ${e||"Not Loaded"}, Wasm: ${n||"Not Loaded"})`}static enableLogging(){Uo._onLog=console.log}static disableLogging(){Uo._onLog=null}static async cfd(e){return await new Promise((n,o)=>{let h=qe();Ye[h]=async g=>{if(g.success)return n();{let m=new Error(g.message);return m.stack=g.stack+`
`+m.stack,o(m)}},Ue.postMessage({type:"cfd",id:h,body:{count:e}})})}}var Se,_l,Go,vl,yl,Ls,wl,Cl,An,El,Tl;ot._bSupportDce4Module=-1,ot._bSupportIRTModule=-1,ot._versions=null,ot._workerName="core.worker.js",ot.browserInfo=Et,function(t){t[t.CRIT_ORIGINAL_IMAGE=1]="CRIT_ORIGINAL_IMAGE",t[t.CRIT_BARCODE=2]="CRIT_BARCODE",t[t.CRIT_TEXT_LINE=4]="CRIT_TEXT_LINE",t[t.CRIT_DETECTED_QUAD=8]="CRIT_DETECTED_QUAD",t[t.CRIT_NORMALIZED_IMAGE=16]="CRIT_NORMALIZED_IMAGE",t[t.CRIT_PARSED_RESULT=32]="CRIT_PARSED_RESULT"}(Se||(Se={})),function(t){t[t.CT_NORMAL_INTERSECTED=0]="CT_NORMAL_INTERSECTED",t[t.CT_T_INTERSECTED=1]="CT_T_INTERSECTED",t[t.CT_CROSS_INTERSECTED=2]="CT_CROSS_INTERSECTED",t[t.CT_NOT_INTERSECTED=3]="CT_NOT_INTERSECTED"}(_l||(_l={})),function(t){t[t.EC_OK=0]="EC_OK",t[t.EC_UNKNOWN=-1e4]="EC_UNKNOWN",t[t.EC_NO_MEMORY=-10001]="EC_NO_MEMORY",t[t.EC_NULL_POINTER=-10002]="EC_NULL_POINTER",t[t.EC_LICENSE_INVALID=-10003]="EC_LICENSE_INVALID",t[t.EC_LICENSE_EXPIRED=-10004]="EC_LICENSE_EXPIRED",t[t.EC_FILE_NOT_FOUND=-10005]="EC_FILE_NOT_FOUND",t[t.EC_FILE_TYPE_NOT_SUPPORTED=-10006]="EC_FILE_TYPE_NOT_SUPPORTED",t[t.EC_BPP_NOT_SUPPORTED=-10007]="EC_BPP_NOT_SUPPORTED",t[t.EC_INDEX_INVALID=-10008]="EC_INDEX_INVALID",t[t.EC_CUSTOM_REGION_INVALID=-10010]="EC_CUSTOM_REGION_INVALID",t[t.EC_IMAGE_READ_FAILED=-10012]="EC_IMAGE_READ_FAILED",t[t.EC_TIFF_READ_FAILED=-10013]="EC_TIFF_READ_FAILED",t[t.EC_DIB_BUFFER_INVALID=-10018]="EC_DIB_BUFFER_INVALID",t[t.EC_PDF_READ_FAILED=-10021]="EC_PDF_READ_FAILED",t[t.EC_PDF_DLL_MISSING=-10022]="EC_PDF_DLL_MISSING",t[t.EC_PAGE_NUMBER_INVALID=-10023]="EC_PAGE_NUMBER_INVALID",t[t.EC_CUSTOM_SIZE_INVALID=-10024]="EC_CUSTOM_SIZE_INVALID",t[t.EC_TIMEOUT=-10026]="EC_TIMEOUT",t[t.EC_JSON_PARSE_FAILED=-10030]="EC_JSON_PARSE_FAILED",t[t.EC_JSON_TYPE_INVALID=-10031]="EC_JSON_TYPE_INVALID",t[t.EC_JSON_KEY_INVALID=-10032]="EC_JSON_KEY_INVALID",t[t.EC_JSON_VALUE_INVALID=-10033]="EC_JSON_VALUE_INVALID",t[t.EC_JSON_NAME_KEY_MISSING=-10034]="EC_JSON_NAME_KEY_MISSING",t[t.EC_JSON_NAME_VALUE_DUPLICATED=-10035]="EC_JSON_NAME_VALUE_DUPLICATED",t[t.EC_TEMPLATE_NAME_INVALID=-10036]="EC_TEMPLATE_NAME_INVALID",t[t.EC_JSON_NAME_REFERENCE_INVALID=-10037]="EC_JSON_NAME_REFERENCE_INVALID",t[t.EC_PARAMETER_VALUE_INVALID=-10038]="EC_PARAMETER_VALUE_INVALID",t[t.EC_DOMAIN_NOT_MATCH=-10039]="EC_DOMAIN_NOT_MATCH",t[t.EC_RESERVED_INFO_NOT_MATCH=-10040]="EC_RESERVED_INFO_NOT_MATCH",t[t.EC_LICENSE_KEY_NOT_MATCH=-10043]="EC_LICENSE_KEY_NOT_MATCH",t[t.EC_REQUEST_FAILED=-10044]="EC_REQUEST_FAILED",t[t.EC_LICENSE_INIT_FAILED=-10045]="EC_LICENSE_INIT_FAILED",t[t.EC_SET_MODE_ARGUMENT_ERROR=-10051]="EC_SET_MODE_ARGUMENT_ERROR",t[t.EC_LICENSE_CONTENT_INVALID=-10052]="EC_LICENSE_CONTENT_INVALID",t[t.EC_LICENSE_KEY_INVALID=-10053]="EC_LICENSE_KEY_INVALID",t[t.EC_LICENSE_DEVICE_RUNS_OUT=-10054]="EC_LICENSE_DEVICE_RUNS_OUT",t[t.EC_GET_MODE_ARGUMENT_ERROR=-10055]="EC_GET_MODE_ARGUMENT_ERROR",t[t.EC_IRT_LICENSE_INVALID=-10056]="EC_IRT_LICENSE_INVALID",t[t.EC_FILE_SAVE_FAILED=-10058]="EC_FILE_SAVE_FAILED",t[t.EC_STAGE_TYPE_INVALID=-10059]="EC_STAGE_TYPE_INVALID",t[t.EC_IMAGE_ORIENTATION_INVALID=-10060]="EC_IMAGE_ORIENTATION_INVALID",t[t.EC_CONVERT_COMPLEX_TEMPLATE_ERROR=-10061]="EC_CONVERT_COMPLEX_TEMPLATE_ERROR",t[t.EC_CALL_REJECTED_WHEN_CAPTURING=-10062]="EC_CALL_REJECTED_WHEN_CAPTURING",t[t.EC_NO_IMAGE_SOURCE=-10063]="EC_NO_IMAGE_SOURCE",t[t.EC_READ_DIRECTORY_FAILED=-10064]="EC_READ_DIRECTORY_FAILED",t[t.EC_MODULE_NOT_FOUND=-10065]="EC_MODULE_NOT_FOUND",t[t.EC_MULTI_PAGES_NOT_SUPPORTED=-10066]="EC_MULTI_PAGES_NOT_SUPPORTED",t[t.EC_FILE_ALREADY_EXISTS=-10067]="EC_FILE_ALREADY_EXISTS",t[t.EC_CREATE_FILE_FAILED=-10068]="EC_CREATE_FILE_FAILED",t[t.EC_IMAGE_DATA_INVALID=-10069]="EC_IMAGE_DATA_INVALID",t[t.EC_NO_LICENSE=-2e4]="EC_NO_LICENSE",t[t.EC_HANDSHAKE_CODE_INVALID=-20001]="EC_HANDSHAKE_CODE_INVALID",t[t.EC_LICENSE_BUFFER_FAILED=-20002]="EC_LICENSE_BUFFER_FAILED",t[t.EC_LICENSE_SYNC_FAILED=-20003]="EC_LICENSE_SYNC_FAILED",t[t.EC_DEVICE_NOT_MATCH=-20004]="EC_DEVICE_NOT_MATCH",t[t.EC_BIND_DEVICE_FAILED=-20005]="EC_BIND_DEVICE_FAILED",t[t.EC_INSTANCE_COUNT_OVER_LIMIT=-20008]="EC_INSTANCE_COUNT_OVER_LIMIT",t[t.EC_TRIAL_LICENSE=-20010]="EC_TRIAL_LICENSE",t[t.EC_LICENSE_VERSION_NOT_MATCH=-20011]="EC_LICENSE_VERSION_NOT_MATCH",t[t.EC_FAILED_TO_REACH_DLS=-20200]="EC_FAILED_TO_REACH_DLS",t[t.EC_BARCODE_FORMAT_INVALID=-30009]="EC_BARCODE_FORMAT_INVALID",t[t.EC_QR_LICENSE_INVALID=-30016]="EC_QR_LICENSE_INVALID",t[t.EC_1D_LICENSE_INVALID=-30017]="EC_1D_LICENSE_INVALID",t[t.EC_PDF417_LICENSE_INVALID=-30019]="EC_PDF417_LICENSE_INVALID",t[t.EC_DATAMATRIX_LICENSE_INVALID=-30020]="EC_DATAMATRIX_LICENSE_INVALID",t[t.EC_CUSTOM_MODULESIZE_INVALID=-30025]="EC_CUSTOM_MODULESIZE_INVALID",t[t.EC_AZTEC_LICENSE_INVALID=-30041]="EC_AZTEC_LICENSE_INVALID",t[t.EC_PATCHCODE_LICENSE_INVALID=-30046]="EC_PATCHCODE_LICENSE_INVALID",t[t.EC_POSTALCODE_LICENSE_INVALID=-30047]="EC_POSTALCODE_LICENSE_INVALID",t[t.EC_DPM_LICENSE_INVALID=-30048]="EC_DPM_LICENSE_INVALID",t[t.EC_FRAME_DECODING_THREAD_EXISTS=-30049]="EC_FRAME_DECODING_THREAD_EXISTS",t[t.EC_STOP_DECODING_THREAD_FAILED=-30050]="EC_STOP_DECODING_THREAD_FAILED",t[t.EC_MAXICODE_LICENSE_INVALID=-30057]="EC_MAXICODE_LICENSE_INVALID",t[t.EC_GS1_DATABAR_LICENSE_INVALID=-30058]="EC_GS1_DATABAR_LICENSE_INVALID",t[t.EC_GS1_COMPOSITE_LICENSE_INVALID=-30059]="EC_GS1_COMPOSITE_LICENSE_INVALID",t[t.EC_DOTCODE_LICENSE_INVALID=-30061]="EC_DOTCODE_LICENSE_INVALID",t[t.EC_PHARMACODE_LICENSE_INVALID=-30062]="EC_PHARMACODE_LICENSE_INVALID",t[t.EC_CHARACTER_MODEL_FILE_NOT_FOUND=-40100]="EC_CHARACTER_MODEL_FILE_NOT_FOUND",t[t.EC_QUADRILATERAL_INVALID=-50057]="EC_QUADRILATERAL_INVALID",t[t.EC_PANORAMA_LICENSE_INVALID=-70060]="EC_PANORAMA_LICENSE_INVALID",t[t.EC_RESOURCE_PATH_NOT_EXIST=-90001]="EC_RESOURCE_PATH_NOT_EXIST",t[t.EC_RESOURCE_LOAD_FAILED=-90002]="EC_RESOURCE_LOAD_FAILED",t[t.EC_CODE_SPECIFICATION_NOT_FOUND=-90003]="EC_CODE_SPECIFICATION_NOT_FOUND",t[t.EC_FULL_CODE_EMPTY=-90004]="EC_FULL_CODE_EMPTY",t[t.EC_FULL_CODE_PREPROCESS_FAILED=-90005]="EC_FULL_CODE_PREPROCESS_FAILED",t[t.EC_ZA_DL_LICENSE_INVALID=-90006]="EC_ZA_DL_LICENSE_INVALID",t[t.EC_AAMVA_DL_ID_LICENSE_INVALID=-90007]="EC_AAMVA_DL_ID_LICENSE_INVALID",t[t.EC_AADHAAR_LICENSE_INVALID=-90008]="EC_AADHAAR_LICENSE_INVALID",t[t.EC_MRTD_LICENSE_INVALID=-90009]="EC_MRTD_LICENSE_INVALID",t[t.EC_VIN_LICENSE_INVALID=-90010]="EC_VIN_LICENSE_INVALID",t[t.EC_CUSTOMIZED_CODE_TYPE_LICENSE_INVALID=-90011]="EC_CUSTOMIZED_CODE_TYPE_LICENSE_INVALID"}(Go||(Go={})),function(t){t[t.GEM_SKIP=0]="GEM_SKIP",t[t.GEM_AUTO=1]="GEM_AUTO",t[t.GEM_GENERAL=2]="GEM_GENERAL",t[t.GEM_GRAY_EQUALIZE=4]="GEM_GRAY_EQUALIZE",t[t.GEM_GRAY_SMOOTH=8]="GEM_GRAY_SMOOTH",t[t.GEM_SHARPEN_SMOOTH=16]="GEM_SHARPEN_SMOOTH",t[t.GEM_REV=-2147483648]="GEM_REV"}(vl||(vl={})),function(t){t[t.GTM_SKIP=0]="GTM_SKIP",t[t.GTM_INVERTED=1]="GTM_INVERTED",t[t.GTM_ORIGINAL=2]="GTM_ORIGINAL",t[t.GTM_AUTO=4]="GTM_AUTO",t[t.GTM_REV=-2147483648]="GTM_REV"}(yl||(yl={})),function(t){t[t.ITT_FILE_IMAGE=0]="ITT_FILE_IMAGE",t[t.ITT_VIDEO_FRAME=1]="ITT_VIDEO_FRAME"}(Ls||(Ls={})),function(t){t[t.PDFRM_VECTOR=1]="PDFRM_VECTOR",t[t.PDFRM_RASTER=2]="PDFRM_RASTER",t[t.PDFRM_REV=-2147483648]="PDFRM_REV"}(wl||(wl={})),function(t){t[t.RDS_RASTERIZED_PAGES=0]="RDS_RASTERIZED_PAGES",t[t.RDS_EXTRACTED_IMAGES=1]="RDS_EXTRACTED_IMAGES"}(Cl||(Cl={})),function(t){t[t.IRUT_NULL=0]="IRUT_NULL",t[t.IRUT_COLOUR_IMAGE=1]="IRUT_COLOUR_IMAGE",t[t.IRUT_SCALED_DOWN_COLOUR_IMAGE=2]="IRUT_SCALED_DOWN_COLOUR_IMAGE",t[t.IRUT_GRAYSCALE_IMAGE=4]="IRUT_GRAYSCALE_IMAGE",t[t.IRUT_TRANSOFORMED_GRAYSCALE_IMAGE=8]="IRUT_TRANSOFORMED_GRAYSCALE_IMAGE",t[t.IRUT_ENHANCED_GRAYSCALE_IMAGE=16]="IRUT_ENHANCED_GRAYSCALE_IMAGE",t[t.IRUT_PREDETECTED_REGIONS=32]="IRUT_PREDETECTED_REGIONS",t[t.IRUT_BINARY_IMAGE=64]="IRUT_BINARY_IMAGE",t[t.IRUT_TEXTURE_DETECTION_RESULT=128]="IRUT_TEXTURE_DETECTION_RESULT",t[t.IRUT_TEXTURE_REMOVED_GRAYSCALE_IMAGE=256]="IRUT_TEXTURE_REMOVED_GRAYSCALE_IMAGE",t[t.IRUT_TEXTURE_REMOVED_BINARY_IMAGE=512]="IRUT_TEXTURE_REMOVED_BINARY_IMAGE",t[t.IRUT_CONTOURS=1024]="IRUT_CONTOURS",t[t.IRUT_LINE_SEGMENTS=2048]="IRUT_LINE_SEGMENTS",t[t.IRUT_TEXT_ZONES=4096]="IRUT_TEXT_ZONES",t[t.IRUT_TEXT_REMOVED_BINARY_IMAGE=8192]="IRUT_TEXT_REMOVED_BINARY_IMAGE",t[t.IRUT_CANDIDATE_BARCODE_ZONES=16384]="IRUT_CANDIDATE_BARCODE_ZONES",t[t.IRUT_LOCALIZED_BARCODES=32768]="IRUT_LOCALIZED_BARCODES",t[t.IRUT_SCALED_UP_BARCODE_IMAGE=65536]="IRUT_SCALED_UP_BARCODE_IMAGE",t[t.IRUT_DEFORMATION_RESISTED_BARCODE_IMAGE=131072]="IRUT_DEFORMATION_RESISTED_BARCODE_IMAGE",t[t.IRUT_COMPLEMENTED_BARCODE_IMAGE=262144]="IRUT_COMPLEMENTED_BARCODE_IMAGE",t[t.IRUT_DECODED_BARCODES=524288]="IRUT_DECODED_BARCODES",t[t.IRUT_LONG_LINES=1048576]="IRUT_LONG_LINES",t[t.IRUT_CORNERS=2097152]="IRUT_CORNERS",t[t.IRUT_CANDIDATE_QUAD_EDGES=4194304]="IRUT_CANDIDATE_QUAD_EDGES",t[t.IRUT_DETECTED_QUADS=8388608]="IRUT_DETECTED_QUADS",t[t.IRUT_LOCALIZED_TEXT_LINES=16777216]="IRUT_LOCALIZED_TEXT_LINES",t[t.IRUT_RECOGNIZED_TEXT_LINES=33554432]="IRUT_RECOGNIZED_TEXT_LINES",t[t.IRUT_NORMALIZED_IMAGES=67108864]="IRUT_NORMALIZED_IMAGES",t[t.IRUT_ALL=134217727]="IRUT_ALL"}(An||(An={})),function(t){t[t.ROET_PREDETECTED_REGION=0]="ROET_PREDETECTED_REGION",t[t.ROET_LOCALIZED_BARCODE=1]="ROET_LOCALIZED_BARCODE",t[t.ROET_DECODED_BARCODE=2]="ROET_DECODED_BARCODE",t[t.ROET_LOCALIZED_TEXT_LINE=3]="ROET_LOCALIZED_TEXT_LINE",t[t.ROET_RECOGNIZED_TEXT_LINE=4]="ROET_RECOGNIZED_TEXT_LINE",t[t.ROET_DETECTED_QUAD=5]="ROET_DETECTED_QUAD",t[t.ROET_NORMALIZED_IMAGE=6]="ROET_NORMALIZED_IMAGE",t[t.ROET_SOURCE_IMAGE=7]="ROET_SOURCE_IMAGE",t[t.ROET_TARGET_ROI=8]="ROET_TARGET_ROI"}(El||(El={})),function(t){t[t.ST_NULL=0]="ST_NULL",t[t.ST_REGION_PREDETECTION=1]="ST_REGION_PREDETECTION",t[t.ST_BARCODE_LOCALIZATION=2]="ST_BARCODE_LOCALIZATION",t[t.ST_BARCODE_DECODING=3]="ST_BARCODE_DECODING",t[t.ST_TEXT_LINE_LOCALIZATION=4]="ST_TEXT_LINE_LOCALIZATION",t[t.ST_TEXT_LINE_RECOGNITION=5]="ST_TEXT_LINE_RECOGNITION",t[t.ST_DOCUMENT_DETECTION=6]="ST_DOCUMENT_DETECTION",t[t.ST_DOCUMENT_NORMALIZATION=7]="ST_DOCUMENT_NORMALIZATION"}(Tl||(Tl={}));/*!
 * Dynamsoft JavaScript Library
 * @product Dynamsoft License JS Edition
 * @website https://www.dynamsoft.com
 * @copyright Copyright 2024, Dynamsoft Corporation
 * @author Dynamsoft
 * @version 3.0.20
 * @fileoverview Dynamsoft JavaScript Library for Core
 * More info DL JS: https://www.dynamsoft.com/capture-vision/docs/web/programming/javascript/api-reference/license/license-module.html
 */const Pi=typeof self>"u",bl=Pi?{}:self,Sl=(()=>{if(!Pi&&document.currentScript){let t=document.currentScript.src,e=t.indexOf("?");if(e!=-1)t=t.substring(0,e);else{let n=t.indexOf("#");n!=-1&&(t=t.substring(0,n))}return t.substring(0,t.lastIndexOf("/")+1)}return"./"})(),Il=t=>t&&typeof t=="object"&&typeof t.then=="function",Qs=" is not allowed to change after `createInstance` or `loadWasm` is called.",rd=!Pi&&document.currentScript&&(document.currentScript.getAttribute("data-license")||document.currentScript.getAttribute("data-productKeys")||document.currentScript.getAttribute("data-licenseKey")||document.currentScript.getAttribute("data-handshakeCode")||document.currentScript.getAttribute("data-organizationID"))||"",xl=(t,e)=>{const n=t;if(!n._pLoad.isEmpty)throw new Error("`license`"+Qs);n._license=e};!Pi&&document.currentScript&&document.currentScript.getAttribute("data-sessionPassword");const Qc=t=>{if(t==null)t=[];else{t=t instanceof Array?[...t]:[t];for(let e=0;e<t.length;++e){if(!Pi){let n=document.createElement("a");n.href=t[e],t[e]=n.href}t[e].endsWith("/")||(t[e]+="/")}}return t},Al=(t,e)=>{const n=t;if(!n._pLoad.isEmpty)throw new Error("`licenseServer`"+Qs);n._licenseServer=Qc(e)},Ol=(t,e)=>{const n=t;if(!n._pLoad.isEmpty)throw new Error("`deviceFriendlyName`"+Qs);n._deviceFriendlyName=e||""};let zn,$n,Ur,fo,jt,Vo,On;typeof navigator<"u"&&(zn=navigator,$n=zn.userAgent,Ur=zn.platform,fo=zn.mediaDevices),function(){if(!Pi){const t={Edge:{search:"Edg",verSearch:"Edg"},OPR:null,Chrome:null,Safari:{str:zn.vendor,search:"Apple",verSearch:["Version","iPhone OS","CPU OS"]},Firefox:null,Explorer:{search:"MSIE",verSearch:"MSIE"}},e={HarmonyOS:null,Android:null,iPhone:null,iPad:null,Windows:{str:Ur,search:"Win"},Mac:{str:Ur},Linux:{str:Ur}};let n="unknownBrowser",o=0,h="unknownOS";for(let g in t){const m=t[g]||{};let v=m.str||$n,C=m.search||g,E=m.verStr||$n,I=m.verSearch||g;if(I instanceof Array||(I=[I]),v.indexOf(C)!=-1){n=g;for(let R of I){let L=E.indexOf(R);if(L!=-1){o=parseFloat(E.substring(L+R.length+1));break}}break}}for(let g in e){const m=e[g]||{};let v=m.str||$n,C=m.search||g;if(v.indexOf(C)!=-1){h=g;break}}h=="Linux"&&$n.indexOf("Windows NT")!=-1&&(h="HarmonyOS"),jt={browser:n,version:o,OS:h}}Pi&&(jt={browser:"ssr",version:0,OS:"ssr"})}(),fo&&fo.getUserMedia,jt.browser==="Chrome"&&jt.version>66||jt.browser==="Safari"&&jt.version>13||jt.browser==="OPR"&&jt.version>43||jt.browser==="Edge"&&jt.version;const eh=async()=>{await li("license");const{p:t,justWait:e}=Ds("dynamsoft_inited");if(e)return t;try{let{lt:n,l:o,ls:h,sp:g,rmk:m,cv:v}=((E,I=!1)=>{const R=E;if(R._pLoad.isEmpty){let L,N,Y,X=R._license||"",K=JSON.parse(JSON.stringify(R._licenseServer)),J=R._sessionPassword,te=0;if(X.startsWith("t")||X.startsWith("f"))te=0;else if(X.length===0||X.startsWith("P")||X.startsWith("L")||X.startsWith("Y")||X.startsWith("A"))te=1;else{te=2;const ne=X.indexOf(":");ne!=-1&&(X=X.substring(ne+1));const pe=X.indexOf("?");if(pe!=-1&&(N=X.substring(pe+1),X=X.substring(0,pe)),X.startsWith("DLC2"))te=0;else{if(X.startsWith("DLS2")){let he;try{let le=X.substring(4);le=atob(le),he=JSON.parse(le)}catch{throw new Error("Format Error: The license string you specified is invalid, please check to make sure it is correct.")}if(X=he.handshakeCode?he.handshakeCode:he.organizationID?he.organizationID:"",typeof X=="number"&&(X=JSON.stringify(X)),K.length===0){let le=[];he.mainServerURL&&(le[0]=he.mainServerURL),he.standbyServerURL&&(le[1]=he.standbyServerURL),K=Qc(le)}!J&&he.sessionPassword&&(J=he.sessionPassword),L=he.remark}(X==="200001"||X.startsWith("200001-"))&&(K&&K.length||(X="")),X||(te=1)}}if(te&&(I||(bl.crypto||(Y="Please upgrade your browser to support online key."),bl.crypto.subtle||(Y="Require https to use online key in this browser."))),Y){if(te!==1)throw new Error(Y);te=0,console.warn(Y),R._lastErrorCode=-1,R._lastErrorString=Y}return te===1&&(X="",console.warn("Applying for a public trial license ...")),{lt:te,l:X,ls:K,sp:J,rmk:L,cv:N}}throw new Error("Can't preprocess license again"+Qs)})(dt);dt._pLoad.task=t;let C=qe();return Ye[C]=E=>{if(E.message&&dt._onAuthMessage){let R=dt._onAuthMessage(E.message);R!=null&&(E.message=R)}let I=!1;if(n===1&&(I=!0),E.success?(Fi&&Fi("init license success"),E.message&&console.warn(E.message),ot._bSupportIRTModule=E.bSupportIRTModule,ot._bSupportDce4Module=E.bSupportDce4Module,dt.bPassValidation=!0):(On=Error(E.message),E.stack&&(On.stack=E.stack),I||E.ltsErrorCode==111&&E.message.toLowerCase().indexOf("trial license")!=-1&&(I=!0)),I){let R=We.license;We.rootDirectory&&(R=We.rootDirectory+"/"+R),R=(L=>{if(L==null&&(L="./"),!Pi){let N=document.createElement("a");N.href=L,L=N.href}return L.endsWith("/")||(L+="/"),L})(R),(async(L,N,Y)=>{if(!L._bNeverShowDialog)try{let X=await fetch(L.engineResourcePath+"dls.license.dialog.html");if(!X.ok)throw Error("Get license dialog fail. Network Error: "+X.statusText);let K=await X.text();if(!K.trim().startsWith("<"))throw Error("Get license dialog fail. Can't get valid HTMLElement.");let J=document.createElement("div");J.innerHTML=K;let te=[];for(let ge=0;ge<J.childElementCount;++ge){let l=J.children[ge];l instanceof HTMLStyleElement&&(te.push(l),document.head.append(l))}let ne=J.childElementCount==1?J.children[0]:J;ne.remove();let pe,he,le,be,y,_e=[ne],Ce=ne.children;for(let ge of Ce)_e.push(ge);for(let ge=0;ge<_e.length;++ge)for(let l of _e[ge].children)_e.push(l);for(let ge of _e)if(!pe&&ge.classList.contains("dls-license-mask"))pe=ge,ge.addEventListener("click",l=>{if(ge==l.target){ne.remove();for(let s of te)s.remove()}});else if(!he&&ge.classList.contains("dls-license-icon-close"))he=ge,ge.addEventListener("click",()=>{ne.remove();for(let l of te)l.remove()});else if(!le&&ge.classList.contains("dls-license-icon-error"))le=ge,N!="error"&&ge.remove();else if(!be&&ge.classList.contains("dls-license-icon-warn"))be=ge,N!="warn"&&ge.remove();else if(!y&&ge.classList.contains("dls-license-msg-content")){y=ge;let l=Y;for(;l;){let s=l.indexOf("["),a=l.indexOf("]",s),u=l.indexOf("(",a),i=l.indexOf(")",u);if(s==-1||a==-1||u==-1||i==-1){ge.appendChild(new Text(l));break}s>0&&ge.appendChild(new Text(l.substring(0,s)));let r=document.createElement("a"),c=l.substring(s+1,a);r.innerText=c;let p=l.substring(u+1,i);r.setAttribute("href",p),r.setAttribute("target","_blank"),ge.appendChild(r),l=l.substring(i+1)}}document.body.appendChild(ne)}catch(X){L._onLog&&L._onLog(X.message||X)}})({_bNeverShowDialog:dt._bNeverShowDialog,engineResourcePath:R,_onLog:Fi},E.success?"warn":"error",E.message)}E.success?t.resolve(void 0):t.reject(On)},o&&(o.startsWith("t")||o.startsWith("f"))&&(Vo=o),Ue.postMessage({type:"dynamsoft",body:{v:"3.0.20",brtk:!!n,bptk:n===1,l:o,os:jt,fn:dt.deviceFriendlyName,ls:h,sp:g,rmk:m,cv:v},id:C}),dt.bCallInitLicense=!0,t}catch(n){throw On=n,t.reject(n),n}};bt.license={},bt.license.dynamsoft=eh,bt.license.getAR=async()=>{if(On)throw On;return Ue?new Promise((t,e)=>{let n=qe();Ye[n]=async o=>{if(o.success)if(delete o.success,Vo&&(o.pk=Vo),Object.keys(o).length){if(o.lem){let h=Error(o.lem);h.ltsErrorCode=o.lec,delete o.lem,delete o.lec,o.ae=h}t(o)}else t(null);else{let h=Error(o.message);o.stack&&(h.stack=o.stack),e(h)}},Ue.postMessage({type:"getAR",id:n})}):null};let dt=class ii{static setLicenseServer(e){Al(ii,e)}static get license(){return this._license}static set license(e){xl(ii,e)}static get licenseServer(){return this._licenseServer}static set licenseServer(e){Al(ii,e)}static get deviceFriendlyName(){return this._deviceFriendlyName}static set deviceFriendlyName(e){Ol(ii,e)}static initLicense(e,n){if(xl(ii,e),ii.bCallInitLicense=!0,n)return(async()=>{try{await eh()}catch(o){return{isSuccess:!1,error:o.message||o}}return{isSuccess:!0,error:"Successful."}})()}static setDeviceFriendlyName(e){Ol(ii,e)}static getDeviceFriendlyName(){return ii._deviceFriendlyName}static getDeviceUUID(){return(async()=>{const{p:e,justWait:n}=Ds("license_uuid");if(n)return e;await li();let o=qe();return Ye[o]=h=>{if(h.success)e.resolve(h.uuid);else{const g=Error(h.message);h.stack&&(g.stack=h.stack),e.reject(g)}},Ue.postMessage({type:"getDeviceUUID",id:o}),e})()}};if(dt._pLoad=new class extends Promise{constructor(t){let e,n;super((o,h)=>{e=o,n=h}),this._s="pending",this.resolve=o=>{this.isPending&&(Il(o)?this.task=o:(this._s="fulfilled",e(o)))},this.reject=o=>{this.isPending&&(this._s="rejected",n(o))},this.task=t}get status(){return this._s}get isPending(){return this._s==="pending"}get isFulfilled(){return this._s==="fulfilled"}get isRejected(){return this._s==="rejected"}get task(){return this._task}set task(t){let e;this._task=t,Il(t)?e=t:typeof t=="function"&&(e=new Promise(t)),e&&(async()=>{try{const n=await e;t===this._task&&this.resolve(n)}catch(n){t===this._task&&this.reject(n)}})()}get isEmpty(){return this._task==null}},dt.bPassValidation=!1,dt.bCallInitLicense=!1,dt._license=rd,dt._licenseServer=[],dt._deviceFriendlyName="",We.license==null&&(We.license=Sl),Un.license={wasm:!0},bt.license.LicenseManager=dt,We.std.version&&Dr(We.std.version,"1.0.0")<0){const t="1.0.0";We.std.version=t,We.std.path=Sl+`../../dynamsoft-capture-vision-std@${t}/dist/`}/*!
* Dynamsoft JavaScript Library
* @product Dynamsoft Barcode Reader JS Edition
* @website http://www.dynamsoft.com
* @copyright Copyright 2024, Dynamsoft Corporation
* @author Dynamsoft
* @version 10.0.20
* @fileoverview Dynamsoft JavaScript Library for Barcode Reader
* More info on dbr JS: https://www.dynamsoft.com/barcode-reader/docs/web/programming/javascript/
*/const th=typeof self>"u",Fa=(()=>{if(!th&&document.currentScript){let t=document.currentScript.src,e=t.indexOf("?");if(e!=-1)t=t.substring(0,e);else{let n=t.indexOf("#");n!=-1&&(t=t.substring(0,n))}return t.substring(0,t.lastIndexOf("/")+1)}return"./"})(),ih=t=>{if(t==null&&(t="./"),!th){let e=document.createElement("a");e.href=t,t=e.href}return t.endsWith("/")||(t+="/"),t};We.dbr==null&&(We.dbr=Fa),Un.dbr={js:!1,wasm:!0},bt.dbr={};const go="1.0.0";We.std.version&&Dr(We.std.version,go)<0&&(We.std.version=go,We.std.path=ih(Fa+`../../dynamsoft-capture-vision-std@${go}/dist/`));const po="2.0.30";We.dip.version&&Dr(We.dip.version,po)<0&&(We.dip.version=po,We.dip.path=ih(Fa+`../../dynamsoft-image-processing@${po}/dist/`));typeof BigInt=="function"&&(BigInt(0),BigInt(18446744073709552e3),BigInt(4265345023),BigInt(3147775),BigInt(260096),BigInt(1),BigInt(2),BigInt(4),BigInt(8),BigInt(16),BigInt(32),BigInt(64),BigInt(128),BigInt(256),BigInt(512),BigInt(1024),BigInt(2048),BigInt(4096),BigInt(8192),BigInt(16384),BigInt(32768),BigInt(65536),BigInt(131072),BigInt(262144),BigInt(16777216),BigInt(33554432),BigInt(67108864),BigInt(134217728),BigInt(268435456),BigInt(536870912),BigInt(1073741824),BigInt(524288),BigInt(2147483648),BigInt(1048576),BigInt(2097152),BigInt(4194304),BigInt(8388608),BigInt(68719476736),BigInt(0x3f0000000000000),BigInt(4294967296),BigInt(4503599627370496),BigInt(9007199254740992),BigInt(0x40000000000000),BigInt(0x80000000000000),BigInt(72057594037927940),BigInt(0x200000000000000),BigInt(8589934592),BigInt(17179869184),BigInt(34359738368),BigInt(51539607552));var Rl,Dl,Ll,Fl;(function(t){t[t.EBRT_STANDARD_RESULT=0]="EBRT_STANDARD_RESULT",t[t.EBRT_CANDIDATE_RESULT=1]="EBRT_CANDIDATE_RESULT",t[t.EBRT_PARTIAL_RESULT=2]="EBRT_PARTIAL_RESULT"})(Rl||(Rl={})),function(t){t[t.QRECL_ERROR_CORRECTION_H=0]="QRECL_ERROR_CORRECTION_H",t[t.QRECL_ERROR_CORRECTION_L=1]="QRECL_ERROR_CORRECTION_L",t[t.QRECL_ERROR_CORRECTION_M=2]="QRECL_ERROR_CORRECTION_M",t[t.QRECL_ERROR_CORRECTION_Q=3]="QRECL_ERROR_CORRECTION_Q"}(Dl||(Dl={})),function(t){t[t.LM_AUTO=1]="LM_AUTO",t[t.LM_CONNECTED_BLOCKS=2]="LM_CONNECTED_BLOCKS",t[t.LM_STATISTICS=4]="LM_STATISTICS",t[t.LM_LINES=8]="LM_LINES",t[t.LM_SCAN_DIRECTLY=16]="LM_SCAN_DIRECTLY",t[t.LM_STATISTICS_MARKS=32]="LM_STATISTICS_MARKS",t[t.LM_STATISTICS_POSTAL_CODE=64]="LM_STATISTICS_POSTAL_CODE",t[t.LM_CENTRE=128]="LM_CENTRE",t[t.LM_ONED_FAST_SCAN=256]="LM_ONED_FAST_SCAN",t[t.LM_REV=-2147483648]="LM_REV",t[t.LM_SKIP=0]="LM_SKIP"}(Ll||(Ll={})),function(t){t[t.DM_DIRECT_BINARIZATION=1]="DM_DIRECT_BINARIZATION",t[t.DM_THRESHOLD_BINARIZATION=2]="DM_THRESHOLD_BINARIZATION",t[t.DM_GRAY_EQUALIZATION=4]="DM_GRAY_EQUALIZATION",t[t.DM_SMOOTHING=8]="DM_SMOOTHING",t[t.DM_MORPHING=16]="DM_MORPHING",t[t.DM_DEEP_ANALYSIS=32]="DM_DEEP_ANALYSIS",t[t.DM_SHARPENING=64]="DM_SHARPENING",t[t.DM_BASED_ON_LOC_BIN=128]="DM_BASED_ON_LOC_BIN",t[t.DM_SHARPENING_SMOOTHING=256]="DM_SHARPENING_SMOOTHING",t[t.DM_REV=-2147483648]="DM_REV",t[t.DM_SKIP=0]="DM_SKIP"}(Fl||(Fl={}));dt.initLicense("DLS2eyJoYW5kc2hha2VDb2RlIjoiMjAwMDAwLWRicl9qc19zYW1wbGVzIiwib3JnYW5pemF0aW9uSUQiOiIyMDAwMDAifQ==");ot.engineResourcePaths={std:"https://cdn.jsdelivr.net/npm/dynamsoft-capture-vision-std@1.0.0/dist/",dip:"https://cdn.jsdelivr.net/npm/dynamsoft-image-processing@2.0.30/dist/",core:"https://cdn.jsdelivr.net/npm/dynamsoft-core@3.0.32/dist/",license:"https://cdn.jsdelivr.net/npm/dynamsoft-license@3.0.20/dist/",cvr:"https://cdn.jsdelivr.net/npm/dynamsoft-capture-vision-router@2.0.31/dist/",dbr:"https://cdn.jsdelivr.net/npm/dynamsoft-barcode-reader@10.0.20/dist/",dce:"https://cdn.jsdelivr.net/npm/dynamsoft-camera-enhancer@4.0.1/dist/"};ot.loadWasm(["DBR"]);/*! For license information please see fabric.js.LICENSE.txt */var sd={653:(t,e,n)=>{var o,h,g,m,v,C,E,I,R,L,N,Y,X,K,J,te,ne,pe,he,le,be,y=y||{version:"5.2.1"};if(e.fabric=y,typeof document<"u"&&typeof window<"u")document instanceof(typeof HTMLDocument<"u"?HTMLDocument:Document)?y.document=document:y.document=document.implementation.createHTMLDocument(""),y.window=window;else{var _e=new(n(192)).JSDOM(decodeURIComponent("%3C!DOCTYPE%20html%3E%3Chtml%3E%3Chead%3E%3C%2Fhead%3E%3Cbody%3E%3C%2Fbody%3E%3C%2Fhtml%3E"),{features:{FetchExternalResources:["img"]},resources:"usable"}).window;y.document=_e.document,y.jsdomImplForWrapper=n(898).implForWrapper,y.nodeCanvas=n(245).Canvas,y.window=_e,DOMParser=y.window.DOMParser}function Ce(l,s){var a=l.canvas,u=s.targetCanvas,i=u.getContext("2d");i.translate(0,u.height),i.scale(1,-1);var r=a.height-u.height;i.drawImage(a,0,r,u.width,u.height,0,0,u.width,u.height)}function ge(l,s){var a=s.targetCanvas.getContext("2d"),u=s.destinationWidth,i=s.destinationHeight,r=u*i*4,c=new Uint8Array(this.imageBuffer,0,r),p=new Uint8ClampedArray(this.imageBuffer,0,r);l.readPixels(0,0,u,i,l.RGBA,l.UNSIGNED_BYTE,c);var f=new ImageData(p,u,i);a.putImageData(f,0,0)}y.isTouchSupported="ontouchstart"in y.window||"ontouchstart"in y.document||y.window&&y.window.navigator&&y.window.navigator.maxTouchPoints>0,y.isLikelyNode=typeof Buffer<"u"&&typeof window>"u",y.SHARED_ATTRIBUTES=["display","transform","fill","fill-opacity","fill-rule","opacity","stroke","stroke-dasharray","stroke-linecap","stroke-dashoffset","stroke-linejoin","stroke-miterlimit","stroke-opacity","stroke-width","id","paint-order","vector-effect","instantiated_by_use","clip-path"],y.DPI=96,y.reNum="(?:[-+]?(?:\\d+|\\d*\\.\\d+)(?:[eE][-+]?\\d+)?)",y.commaWsp="(?:\\s+,?\\s*|,\\s*)",y.rePathCommand=/([-+]?((\d+\.\d+)|((\d+)|(\.\d+)))(?:[eE][-+]?\d+)?)/gi,y.reNonWord=/[ \n\.,;!\?\-]/,y.fontPaths={},y.iMatrix=[1,0,0,1,0,0],y.svgNS="http://www.w3.org/2000/svg",y.perfLimitSizeTotal=2097152,y.maxCacheSideLimit=4096,y.minCacheSideLimit=256,y.charWidthsCache={},y.textureSize=2048,y.disableStyleCopyPaste=!1,y.enableGLFiltering=!0,y.devicePixelRatio=y.window.devicePixelRatio||y.window.webkitDevicePixelRatio||y.window.mozDevicePixelRatio||1,y.browserShadowBlurConstant=1,y.arcToSegmentsCache={},y.boundsOfCurveCache={},y.cachesBoundsOfCurve=!0,y.forceGLPutImageData=!1,y.initFilterBackend=function(){return y.enableGLFiltering&&y.isWebglSupported&&y.isWebglSupported(y.textureSize)?(console.log("max texture size: "+y.maxTextureSize),new y.WebglFilterBackend({tileSize:y.textureSize})):y.Canvas2dFilterBackend?new y.Canvas2dFilterBackend:void 0},typeof document<"u"&&typeof window<"u"&&(window.fabric=y),function(){function l(a,u){if(this.__eventListeners[a]){var i=this.__eventListeners[a];u?i[i.indexOf(u)]=!1:y.util.array.fill(i,!1)}}function s(a,u){var i=(function(){u.apply(this,arguments),this.off(a,i)}).bind(this);this.on(a,i)}y.Observable={fire:function(a,u){if(!this.__eventListeners)return this;var i=this.__eventListeners[a];if(!i)return this;for(var r=0,c=i.length;r<c;r++)i[r]&&i[r].call(this,u||{});return this.__eventListeners[a]=i.filter(function(p){return p!==!1}),this},on:function(a,u){if(this.__eventListeners||(this.__eventListeners={}),arguments.length===1)for(var i in a)this.on(i,a[i]);else this.__eventListeners[a]||(this.__eventListeners[a]=[]),this.__eventListeners[a].push(u);return this},once:function(a,u){if(arguments.length===1)for(var i in a)s.call(this,i,a[i]);else s.call(this,a,u);return this},off:function(a,u){if(!this.__eventListeners)return this;if(arguments.length===0)for(a in this.__eventListeners)l.call(this,a);else if(arguments.length===1&&typeof arguments[0]=="object")for(var i in a)l.call(this,i,a[i]);else l.call(this,a,u);return this}}}(),y.Collection={_objects:[],add:function(){if(this._objects.push.apply(this._objects,arguments),this._onObjectAdded)for(var l=0,s=arguments.length;l<s;l++)this._onObjectAdded(arguments[l]);return this.renderOnAddRemove&&this.requestRenderAll(),this},insertAt:function(l,s,a){var u=this._objects;return a?u[s]=l:u.splice(s,0,l),this._onObjectAdded&&this._onObjectAdded(l),this.renderOnAddRemove&&this.requestRenderAll(),this},remove:function(){for(var l,s=this._objects,a=!1,u=0,i=arguments.length;u<i;u++)(l=s.indexOf(arguments[u]))!==-1&&(a=!0,s.splice(l,1),this._onObjectRemoved&&this._onObjectRemoved(arguments[u]));return this.renderOnAddRemove&&a&&this.requestRenderAll(),this},forEachObject:function(l,s){for(var a=this.getObjects(),u=0,i=a.length;u<i;u++)l.call(s,a[u],u,a);return this},getObjects:function(l){return l===void 0?this._objects.concat():this._objects.filter(function(s){return s.type===l})},item:function(l){return this._objects[l]},isEmpty:function(){return this._objects.length===0},size:function(){return this._objects.length},contains:function(l,s){return this._objects.indexOf(l)>-1||!!s&&this._objects.some(function(a){return typeof a.contains=="function"&&a.contains(l,!0)})},complexity:function(){return this._objects.reduce(function(l,s){return l+(s.complexity?s.complexity():0)},0)}},y.CommonMethods={_setOptions:function(l){for(var s in l)this.set(s,l[s])},_initGradient:function(l,s){!l||!l.colorStops||l instanceof y.Gradient||this.set(s,new y.Gradient(l))},_initPattern:function(l,s,a){!l||!l.source||l instanceof y.Pattern?a&&a():this.set(s,new y.Pattern(l,a))},_setObject:function(l){for(var s in l)this._set(s,l[s])},set:function(l,s){return typeof l=="object"?this._setObject(l):this._set(l,s),this},_set:function(l,s){this[l]=s},toggle:function(l){var s=this.get(l);return typeof s=="boolean"&&this.set(l,!s),this},get:function(l){return this[l]}},o=e,h=Math.sqrt,g=Math.atan2,m=Math.pow,v=Math.PI/180,C=Math.PI/2,y.util={cos:function(l){if(l===0)return 1;switch(l<0&&(l=-l),l/C){case 1:case 3:return 0;case 2:return-1}return Math.cos(l)},sin:function(l){if(l===0)return 0;var s=1;switch(l<0&&(s=-1),l/C){case 1:return s;case 2:return 0;case 3:return-s}return Math.sin(l)},removeFromArray:function(l,s){var a=l.indexOf(s);return a!==-1&&l.splice(a,1),l},getRandomInt:function(l,s){return Math.floor(Math.random()*(s-l+1))+l},degreesToRadians:function(l){return l*v},radiansToDegrees:function(l){return l/v},rotatePoint:function(l,s,a){var u=new y.Point(l.x-s.x,l.y-s.y),i=y.util.rotateVector(u,a);return new y.Point(i.x,i.y).addEquals(s)},rotateVector:function(l,s){var a=y.util.sin(s),u=y.util.cos(s);return{x:l.x*u-l.y*a,y:l.x*a+l.y*u}},createVector:function(l,s){return new y.Point(s.x-l.x,s.y-l.y)},calcAngleBetweenVectors:function(l,s){return Math.acos((l.x*s.x+l.y*s.y)/(Math.hypot(l.x,l.y)*Math.hypot(s.x,s.y)))},getHatVector:function(l){return new y.Point(l.x,l.y).multiply(1/Math.hypot(l.x,l.y))},getBisector:function(l,s,a){var u=y.util.createVector(l,s),i=y.util.createVector(l,a),r=y.util.calcAngleBetweenVectors(u,i),c=r*(y.util.calcAngleBetweenVectors(y.util.rotateVector(u,r),i)===0?1:-1)/2;return{vector:y.util.getHatVector(y.util.rotateVector(u,c)),angle:r}},projectStrokeOnPoints:function(l,s,a){var u=[],i=s.strokeWidth/2,r=s.strokeUniform?new y.Point(1/s.scaleX,1/s.scaleY):new y.Point(1,1),c=function(p){var f=i/Math.hypot(p.x,p.y);return new y.Point(p.x*f*r.x,p.y*f*r.y)};return l.length<=1||l.forEach(function(p,f){var d,_,w=new y.Point(p.x,p.y);f===0?(_=l[f+1],d=a?c(y.util.createVector(_,w)).addEquals(w):l[l.length-1]):f===l.length-1?(d=l[f-1],_=a?c(y.util.createVector(d,w)).addEquals(w):l[0]):(d=l[f-1],_=l[f+1]);var T,x,b=y.util.getBisector(w,d,_),F=b.vector,B=b.angle;if(s.strokeLineJoin==="miter"&&(T=-i/Math.sin(B/2),x=new y.Point(F.x*T*r.x,F.y*T*r.y),Math.hypot(x.x,x.y)/i<=s.strokeMiterLimit))return u.push(w.add(x)),void u.push(w.subtract(x));T=-i*Math.SQRT2,x=new y.Point(F.x*T*r.x,F.y*T*r.y),u.push(w.add(x)),u.push(w.subtract(x))}),u},transformPoint:function(l,s,a){return a?new y.Point(s[0]*l.x+s[2]*l.y,s[1]*l.x+s[3]*l.y):new y.Point(s[0]*l.x+s[2]*l.y+s[4],s[1]*l.x+s[3]*l.y+s[5])},makeBoundingBoxFromPoints:function(l,s){if(s)for(var a=0;a<l.length;a++)l[a]=y.util.transformPoint(l[a],s);var u=[l[0].x,l[1].x,l[2].x,l[3].x],i=y.util.array.min(u),r=y.util.array.max(u)-i,c=[l[0].y,l[1].y,l[2].y,l[3].y],p=y.util.array.min(c);return{left:i,top:p,width:r,height:y.util.array.max(c)-p}},invertTransform:function(l){var s=1/(l[0]*l[3]-l[1]*l[2]),a=[s*l[3],-s*l[1],-s*l[2],s*l[0]],u=y.util.transformPoint({x:l[4],y:l[5]},a,!0);return a[4]=-u.x,a[5]=-u.y,a},toFixed:function(l,s){return parseFloat(Number(l).toFixed(s))},parseUnit:function(l,s){var a=/\D{0,2}$/.exec(l),u=parseFloat(l);switch(s||(s=y.Text.DEFAULT_SVG_FONT_SIZE),a[0]){case"mm":return u*y.DPI/25.4;case"cm":return u*y.DPI/2.54;case"in":return u*y.DPI;case"pt":return u*y.DPI/72;case"pc":return u*y.DPI/72*12;case"em":return u*s;default:return u}},falseFunction:function(){return!1},getKlass:function(l,s){return l=y.util.string.camelize(l.charAt(0).toUpperCase()+l.slice(1)),y.util.resolveNamespace(s)[l]},getSvgAttributes:function(l){var s=["instantiated_by_use","style","id","class"];switch(l){case"linearGradient":s=s.concat(["x1","y1","x2","y2","gradientUnits","gradientTransform"]);break;case"radialGradient":s=s.concat(["gradientUnits","gradientTransform","cx","cy","r","fx","fy","fr"]);break;case"stop":s=s.concat(["offset","stop-color","stop-opacity"])}return s},resolveNamespace:function(l){if(!l)return y;var s,a=l.split("."),u=a.length,i=o||y.window;for(s=0;s<u;++s)i=i[a[s]];return i},loadImage:function(l,s,a,u){if(l){var i=y.util.createImage(),r=function(){s&&s.call(a,i,!1),i=i.onload=i.onerror=null};i.onload=r,i.onerror=function(){y.log("Error loading "+i.src),s&&s.call(a,null,!0),i=i.onload=i.onerror=null},l.indexOf("data")!==0&&u!=null&&(i.crossOrigin=u),l.substring(0,14)==="data:image/svg"&&(i.onload=null,y.util.loadImageInDom(i,r)),i.src=l}else s&&s.call(a,l)},loadImageInDom:function(l,s){var a=y.document.createElement("div");a.style.width=a.style.height="1px",a.style.left=a.style.top="-100%",a.style.position="absolute",a.appendChild(l),y.document.querySelector("body").appendChild(a),l.onload=function(){s(),a.parentNode.removeChild(a),a=null}},enlivenObjects:function(l,s,a,u){var i=[],r=0,c=(l=l||[]).length;function p(){++r===c&&s&&s(i.filter(function(f){return f}))}c?l.forEach(function(f,d){f&&f.type?y.util.getKlass(f.type,a).fromObject(f,function(_,w){w||(i[d]=_),u&&u(f,_,w),p()}):p()}):s&&s(i)},enlivenObjectEnlivables:function(l,s,a){var u=y.Object.ENLIVEN_PROPS.filter(function(i){return!!l[i]});y.util.enlivenObjects(u.map(function(i){return l[i]}),function(i){var r={};u.forEach(function(c,p){r[c]=i[p],s&&(s[c]=i[p])}),a&&a(r)})},enlivenPatterns:function(l,s){function a(){++i===r&&s&&s(u)}var u=[],i=0,r=(l=l||[]).length;r?l.forEach(function(c,p){c&&c.source?new y.Pattern(c,function(f){u[p]=f,a()}):(u[p]=c,a())}):s&&s(u)},groupSVGElements:function(l,s,a){var u;return l&&l.length===1?l[0]:(s&&(s.width&&s.height?s.centerPoint={x:s.width/2,y:s.height/2}:(delete s.width,delete s.height)),u=new y.Group(l,s),a!==void 0&&(u.sourcePath=a),u)},populateWithProperties:function(l,s,a){if(a&&Array.isArray(a))for(var u=0,i=a.length;u<i;u++)a[u]in l&&(s[a[u]]=l[a[u]])},createCanvasElement:function(){return y.document.createElement("canvas")},copyCanvasElement:function(l){var s=y.util.createCanvasElement();return s.width=l.width,s.height=l.height,s.getContext("2d").drawImage(l,0,0),s},toDataURL:function(l,s,a){return l.toDataURL("image/"+s,a)},createImage:function(){return y.document.createElement("img")},multiplyTransformMatrices:function(l,s,a){return[l[0]*s[0]+l[2]*s[1],l[1]*s[0]+l[3]*s[1],l[0]*s[2]+l[2]*s[3],l[1]*s[2]+l[3]*s[3],a?0:l[0]*s[4]+l[2]*s[5]+l[4],a?0:l[1]*s[4]+l[3]*s[5]+l[5]]},qrDecompose:function(l){var s=g(l[1],l[0]),a=m(l[0],2)+m(l[1],2),u=h(a),i=(l[0]*l[3]-l[2]*l[1])/u,r=g(l[0]*l[2]+l[1]*l[3],a);return{angle:s/v,scaleX:u,scaleY:i,skewX:r/v,skewY:0,translateX:l[4],translateY:l[5]}},calcRotateMatrix:function(l){if(!l.angle)return y.iMatrix.concat();var s=y.util.degreesToRadians(l.angle),a=y.util.cos(s),u=y.util.sin(s);return[a,u,-u,a,0,0]},calcDimensionsMatrix:function(l){var s=l.scaleX===void 0?1:l.scaleX,a=l.scaleY===void 0?1:l.scaleY,u=[l.flipX?-s:s,0,0,l.flipY?-a:a,0,0],i=y.util.multiplyTransformMatrices,r=y.util.degreesToRadians;return l.skewX&&(u=i(u,[1,0,Math.tan(r(l.skewX)),1],!0)),l.skewY&&(u=i(u,[1,Math.tan(r(l.skewY)),0,1],!0)),u},composeMatrix:function(l){var s=[1,0,0,1,l.translateX||0,l.translateY||0],a=y.util.multiplyTransformMatrices;return l.angle&&(s=a(s,y.util.calcRotateMatrix(l))),(l.scaleX!==1||l.scaleY!==1||l.skewX||l.skewY||l.flipX||l.flipY)&&(s=a(s,y.util.calcDimensionsMatrix(l))),s},resetObjectTransform:function(l){l.scaleX=1,l.scaleY=1,l.skewX=0,l.skewY=0,l.flipX=!1,l.flipY=!1,l.rotate(0)},saveObjectTransform:function(l){return{scaleX:l.scaleX,scaleY:l.scaleY,skewX:l.skewX,skewY:l.skewY,angle:l.angle,left:l.left,flipX:l.flipX,flipY:l.flipY,top:l.top}},isTransparent:function(l,s,a,u){u>0&&(s>u?s-=u:s=0,a>u?a-=u:a=0);var i,r=!0,c=l.getImageData(s,a,2*u||1,2*u||1),p=c.data.length;for(i=3;i<p&&(r=c.data[i]<=0)!=0;i+=4);return c=null,r},parsePreserveAspectRatioAttribute:function(l){var s,a="meet",u=l.split(" ");return u&&u.length&&((a=u.pop())!=="meet"&&a!=="slice"?(s=a,a="meet"):u.length&&(s=u.pop())),{meetOrSlice:a,alignX:s!=="none"?s.slice(1,4):"none",alignY:s!=="none"?s.slice(5,8):"none"}},clearFabricFontCache:function(l){(l=(l||"").toLowerCase())?y.charWidthsCache[l]&&delete y.charWidthsCache[l]:y.charWidthsCache={}},limitDimsByArea:function(l,s){var a=Math.sqrt(s*l),u=Math.floor(s/a);return{x:Math.floor(a),y:u}},capValue:function(l,s,a){return Math.max(l,Math.min(s,a))},findScaleToFit:function(l,s){return Math.min(s.width/l.width,s.height/l.height)},findScaleToCover:function(l,s){return Math.max(s.width/l.width,s.height/l.height)},matrixToSVG:function(l){return"matrix("+l.map(function(s){return y.util.toFixed(s,y.Object.NUM_FRACTION_DIGITS)}).join(" ")+")"},removeTransformFromObject:function(l,s){var a=y.util.invertTransform(s),u=y.util.multiplyTransformMatrices(a,l.calcOwnMatrix());y.util.applyTransformToObject(l,u)},addTransformToObject:function(l,s){y.util.applyTransformToObject(l,y.util.multiplyTransformMatrices(s,l.calcOwnMatrix()))},applyTransformToObject:function(l,s){var a=y.util.qrDecompose(s),u=new y.Point(a.translateX,a.translateY);l.flipX=!1,l.flipY=!1,l.set("scaleX",a.scaleX),l.set("scaleY",a.scaleY),l.skewX=a.skewX,l.skewY=a.skewY,l.angle=a.angle,l.setPositionByOrigin(u,"center","center")},sizeAfterTransform:function(l,s,a){var u=l/2,i=s/2,r=[{x:-u,y:-i},{x:u,y:-i},{x:-u,y:i},{x:u,y:i}],c=y.util.calcDimensionsMatrix(a),p=y.util.makeBoundingBoxFromPoints(r,c);return{x:p.width,y:p.height}},mergeClipPaths:function(l,s){var a=l,u=s;a.inverted&&!u.inverted&&(a=s,u=l),y.util.applyTransformToObject(u,y.util.multiplyTransformMatrices(y.util.invertTransform(a.calcTransformMatrix()),u.calcTransformMatrix()));var i=a.inverted&&u.inverted;return i&&(a.inverted=u.inverted=!1),new y.Group([a],{clipPath:u,inverted:i})}},function(){var l=Array.prototype.join,s={m:2,l:2,h:1,v:1,c:6,s:4,q:4,t:2,a:7},a={m:"l",M:"L"};function u(x,b,F,B,z,$,Q,q,O,A,D){var k=y.util.cos(x),G=y.util.sin(x),W=y.util.cos(b),P=y.util.sin(b),M=F*z*W-B*$*P+Q,U=B*z*W+F*$*P+q;return["C",A+O*(-F*z*G-B*$*k),D+O*(-B*z*G+F*$*k),M+O*(F*z*P+B*$*W),U+O*(B*z*P-F*$*W),M,U]}function i(x,b,F,B){var z=Math.atan2(b,x),$=Math.atan2(B,F);return $>=z?$-z:2*Math.PI-(z-$)}function r(x,b,F){for(var B=F[1],z=F[2],$=F[3],Q=F[4],q=F[5],O=function(k,G,W,P,M,U,V){var H=Math.PI,Z=V*H/180,ee=y.util.sin(Z),re=y.util.cos(Z),ie=0,se=0,oe=-re*k*.5-ee*G*.5,ce=-re*G*.5+ee*k*.5,me=(W=Math.abs(W))*W,fe=(P=Math.abs(P))*P,Ae=ce*ce,Ne=oe*oe,mt=me*fe-me*Ae-fe*Ne,et=0;if(mt<0){var at=Math.sqrt(1-mt/(me*fe));W*=at,P*=at}else et=(M===U?-1:1)*Math.sqrt(mt/(me*Ae+fe*Ne));var Ke=et*W*ce/P,Pt=-et*P*oe/W,Vn=re*Ke-ee*Pt+.5*k,cn=ee*Ke+re*Pt+.5*G,Bi=i(1,0,(oe-Ke)/W,(ce-Pt)/P),hn=i((oe-Ke)/W,(ce-Pt)/P,(-oe-Ke)/W,(-ce-Pt)/P);U===0&&hn>0?hn-=2*H:U===1&&hn<0&&(hn+=2*H);for(var Na=Math.ceil(Math.abs(hn/H*2)),Lr=[],Wn=hn/Na,Ch=8/3*Math.sin(Wn/4)*Math.sin(Wn/4)/Math.sin(Wn/2),to=Bi+Wn,Yn=0;Yn<Na;Yn++)Lr[Yn]=u(Bi,to,re,ee,W,P,Vn,cn,Ch,ie,se),ie=Lr[Yn][5],se=Lr[Yn][6],Bi=to,to+=Wn;return Lr}(F[6]-x,F[7]-b,B,z,Q,q,$),A=0,D=O.length;A<D;A++)O[A][1]+=x,O[A][2]+=b,O[A][3]+=x,O[A][4]+=b,O[A][5]+=x,O[A][6]+=b;return O}function c(x,b,F,B){return Math.sqrt((F-x)*(F-x)+(B-b)*(B-b))}function p(x,b,F,B,z,$,Q,q){return function(O){var A,D=(A=O)*A*A,k=function(P){return 3*P*P*(1-P)}(O),G=function(P){return 3*P*(1-P)*(1-P)}(O),W=function(P){return(1-P)*(1-P)*(1-P)}(O);return{x:Q*D+z*k+F*G+x*W,y:q*D+$*k+B*G+b*W}}}function f(x,b,F,B,z,$,Q,q){return function(O){var A=1-O,D=3*A*A*(F-x)+6*A*O*(z-F)+3*O*O*(Q-z),k=3*A*A*(B-b)+6*A*O*($-B)+3*O*O*(q-$);return Math.atan2(k,D)}}function d(x,b,F,B,z,$){return function(Q){var q,O=(q=Q)*q,A=function(k){return 2*k*(1-k)}(Q),D=function(k){return(1-k)*(1-k)}(Q);return{x:z*O+F*A+x*D,y:$*O+B*A+b*D}}}function _(x,b,F,B,z,$){return function(Q){var q=1-Q,O=2*q*(F-x)+2*Q*(z-F),A=2*q*(B-b)+2*Q*($-B);return Math.atan2(A,O)}}function w(x,b,F){var B,z,$={x:b,y:F},Q=0;for(z=1;z<=100;z+=1)B=x(z/100),Q+=c($.x,$.y,B.x,B.y),$=B;return Q}function T(x){for(var b,F,B,z,$=0,Q=x.length,q=0,O=0,A=0,D=0,k=[],G=0;G<Q;G++){switch(B={x:q,y:O,command:(b=x[G])[0]},b[0]){case"M":B.length=0,A=q=b[1],D=O=b[2];break;case"L":B.length=c(q,O,b[1],b[2]),q=b[1],O=b[2];break;case"C":F=p(q,O,b[1],b[2],b[3],b[4],b[5],b[6]),z=f(q,O,b[1],b[2],b[3],b[4],b[5],b[6]),B.iterator=F,B.angleFinder=z,B.length=w(F,q,O),q=b[5],O=b[6];break;case"Q":F=d(q,O,b[1],b[2],b[3],b[4]),z=_(q,O,b[1],b[2],b[3],b[4]),B.iterator=F,B.angleFinder=z,B.length=w(F,q,O),q=b[3],O=b[4];break;case"Z":case"z":B.destX=A,B.destY=D,B.length=c(q,O,A,D),q=A,O=D}$+=B.length,k.push(B)}return k.push({length:$,x:q,y:O}),k}y.util.joinPath=function(x){return x.map(function(b){return b.join(" ")}).join(" ")},y.util.parsePath=function(x){var b,F,B,z,$,Q=[],q=[],O=y.rePathCommand,A="[-+]?(?:\\d*\\.\\d+|\\d+\\.?)(?:[eE][-+]?\\d+)?\\s*",D="("+A+")"+y.commaWsp,k="([01])"+y.commaWsp+"?",G=new RegExp(D+"?"+D+"?"+D+k+k+D+"?("+A+")","g");if(!x||!x.match)return Q;for(var W,P=0,M=($=x.match(/[mzlhvcsqta][^mzlhvcsqta]*/gi)).length;P<M;P++){z=(b=$[P]).slice(1).trim(),q.length=0;var U=b.charAt(0);if(W=[U],U.toLowerCase()==="a")for(var V;V=G.exec(z);)for(var H=1;H<V.length;H++)q.push(V[H]);else for(;B=O.exec(z);)q.push(B[0]);H=0;for(var Z=q.length;H<Z;H++)F=parseFloat(q[H]),isNaN(F)||W.push(F);var ee=s[U.toLowerCase()],re=a[U]||U;if(W.length-1>ee)for(var ie=1,se=W.length;ie<se;ie+=ee)Q.push([U].concat(W.slice(ie,ie+ee))),U=re;else Q.push(W)}return Q},y.util.makePathSimpler=function(x){var b,F,B,z,$,Q,q=0,O=0,A=x.length,D=0,k=0,G=[];for(F=0;F<A;++F){switch(B=!1,(b=x[F].slice(0))[0]){case"l":b[0]="L",b[1]+=q,b[2]+=O;case"L":q=b[1],O=b[2];break;case"h":b[1]+=q;case"H":b[0]="L",b[2]=O,q=b[1];break;case"v":b[1]+=O;case"V":b[0]="L",O=b[1],b[1]=q,b[2]=O;break;case"m":b[0]="M",b[1]+=q,b[2]+=O;case"M":q=b[1],O=b[2],D=b[1],k=b[2];break;case"c":b[0]="C",b[1]+=q,b[2]+=O,b[3]+=q,b[4]+=O,b[5]+=q,b[6]+=O;case"C":$=b[3],Q=b[4],q=b[5],O=b[6];break;case"s":b[0]="S",b[1]+=q,b[2]+=O,b[3]+=q,b[4]+=O;case"S":z==="C"?($=2*q-$,Q=2*O-Q):($=q,Q=O),q=b[3],O=b[4],b[0]="C",b[5]=b[3],b[6]=b[4],b[3]=b[1],b[4]=b[2],b[1]=$,b[2]=Q,$=b[3],Q=b[4];break;case"q":b[0]="Q",b[1]+=q,b[2]+=O,b[3]+=q,b[4]+=O;case"Q":$=b[1],Q=b[2],q=b[3],O=b[4];break;case"t":b[0]="T",b[1]+=q,b[2]+=O;case"T":z==="Q"?($=2*q-$,Q=2*O-Q):($=q,Q=O),b[0]="Q",q=b[1],O=b[2],b[1]=$,b[2]=Q,b[3]=q,b[4]=O;break;case"a":b[0]="A",b[6]+=q,b[7]+=O;case"A":B=!0,G=G.concat(r(q,O,b)),q=b[6],O=b[7];break;case"z":case"Z":q=D,O=k}B||G.push(b),z=b[0]}return G},y.util.getSmoothPathFromPoints=function(x,b){var F,B=[],z=new y.Point(x[0].x,x[0].y),$=new y.Point(x[1].x,x[1].y),Q=x.length,q=1,O=0,A=Q>2;for(b=b||0,A&&(q=x[2].x<$.x?-1:x[2].x===$.x?0:1,O=x[2].y<$.y?-1:x[2].y===$.y?0:1),B.push(["M",z.x-q*b,z.y-O*b]),F=1;F<Q;F++){if(!z.eq($)){var D=z.midPointFrom($);B.push(["Q",z.x,z.y,D.x,D.y])}z=x[F],F+1<x.length&&($=x[F+1])}return A&&(q=z.x>x[F-2].x?1:z.x===x[F-2].x?0:-1,O=z.y>x[F-2].y?1:z.y===x[F-2].y?0:-1),B.push(["L",z.x+q*b,z.y+O*b]),B},y.util.getPathSegmentsInfo=T,y.util.getBoundsOfCurve=function(x,b,F,B,z,$,Q,q){var O;if(y.cachesBoundsOfCurve&&(O=l.call(arguments),y.boundsOfCurveCache[O]))return y.boundsOfCurveCache[O];var A,D,k,G,W,P,M,U,V=Math.sqrt,H=Math.min,Z=Math.max,ee=Math.abs,re=[],ie=[[],[]];D=6*x-12*F+6*z,A=-3*x+9*F-9*z+3*Q,k=3*F-3*x;for(var se=0;se<2;++se)if(se>0&&(D=6*b-12*B+6*$,A=-3*b+9*B-9*$+3*q,k=3*B-3*b),ee(A)<1e-12){if(ee(D)<1e-12)continue;0<(G=-k/D)&&G<1&&re.push(G)}else(M=D*D-4*k*A)<0||(0<(W=(-D+(U=V(M)))/(2*A))&&W<1&&re.push(W),0<(P=(-D-U)/(2*A))&&P<1&&re.push(P));for(var oe,ce,me,fe=re.length,Ae=fe;fe--;)oe=(me=1-(G=re[fe]))*me*me*x+3*me*me*G*F+3*me*G*G*z+G*G*G*Q,ie[0][fe]=oe,ce=me*me*me*b+3*me*me*G*B+3*me*G*G*$+G*G*G*q,ie[1][fe]=ce;ie[0][Ae]=x,ie[1][Ae]=b,ie[0][Ae+1]=Q,ie[1][Ae+1]=q;var Ne=[{x:H.apply(null,ie[0]),y:H.apply(null,ie[1])},{x:Z.apply(null,ie[0]),y:Z.apply(null,ie[1])}];return y.cachesBoundsOfCurve&&(y.boundsOfCurveCache[O]=Ne),Ne},y.util.getPointOnPath=function(x,b,F){F||(F=T(x));for(var B=0;b-F[B].length>0&&B<F.length-2;)b-=F[B].length,B++;var z,$=F[B],Q=b/$.length,q=$.command,O=x[B];switch(q){case"M":return{x:$.x,y:$.y,angle:0};case"Z":case"z":return(z=new y.Point($.x,$.y).lerp(new y.Point($.destX,$.destY),Q)).angle=Math.atan2($.destY-$.y,$.destX-$.x),z;case"L":return(z=new y.Point($.x,$.y).lerp(new y.Point(O[1],O[2]),Q)).angle=Math.atan2(O[2]-$.y,O[1]-$.x),z;case"C":case"Q":return function(A,D){for(var k,G,W,P=0,M=0,U=A.iterator,V={x:A.x,y:A.y},H=.01,Z=A.angleFinder;M<D&&H>1e-4;)k=U(P),W=P,(G=c(V.x,V.y,k.x,k.y))+M>D?(P-=H,H/=2):(V=k,P+=H,M+=G);return k.angle=Z(W),k}($,b)}},y.util.transformPath=function(x,b,F){return F&&(b=y.util.multiplyTransformMatrices(b,[1,0,0,1,-F.x,-F.y])),x.map(function(B){for(var z=B.slice(0),$={},Q=1;Q<B.length-1;Q+=2)$.x=B[Q],$.y=B[Q+1],$=y.util.transformPoint($,b),z[Q]=$.x,z[Q+1]=$.y;return z})}}(),function(){var l=Array.prototype.slice;function s(a,u,i){if(a&&a.length!==0){var r=a.length-1,c=u?a[r][u]:a[r];if(u)for(;r--;)i(a[r][u],c)&&(c=a[r][u]);else for(;r--;)i(a[r],c)&&(c=a[r]);return c}}y.util.array={fill:function(a,u){for(var i=a.length;i--;)a[i]=u;return a},invoke:function(a,u){for(var i=l.call(arguments,2),r=[],c=0,p=a.length;c<p;c++)r[c]=i.length?a[c][u].apply(a[c],i):a[c][u].call(a[c]);return r},min:function(a,u){return s(a,u,function(i,r){return i<r})},max:function(a,u){return s(a,u,function(i,r){return i>=r})}}}(),function(){function l(s,a,u){if(u)if(!y.isLikelyNode&&a instanceof Element)s=a;else if(a instanceof Array){s=[];for(var i=0,r=a.length;i<r;i++)s[i]=l({},a[i],u)}else if(a&&typeof a=="object")for(var c in a)c==="canvas"||c==="group"?s[c]=null:a.hasOwnProperty(c)&&(s[c]=l({},a[c],u));else s=a;else for(var c in a)s[c]=a[c];return s}y.util.object={extend:l,clone:function(s,a){return l({},s,a)}},y.util.object.extend(y.util,y.Observable)}(),function(){function l(s,a){var u=s.charCodeAt(a);if(isNaN(u))return"";if(u<55296||u>57343)return s.charAt(a);if(55296<=u&&u<=56319){if(s.length<=a+1)throw"High surrogate without following low surrogate";var i=s.charCodeAt(a+1);if(56320>i||i>57343)throw"High surrogate without following low surrogate";return s.charAt(a)+s.charAt(a+1)}if(a===0)throw"Low surrogate without preceding high surrogate";var r=s.charCodeAt(a-1);if(55296>r||r>56319)throw"Low surrogate without preceding high surrogate";return!1}y.util.string={camelize:function(s){return s.replace(/-+(.)?/g,function(a,u){return u?u.toUpperCase():""})},capitalize:function(s,a){return s.charAt(0).toUpperCase()+(a?s.slice(1):s.slice(1).toLowerCase())},escapeXml:function(s){return s.replace(/&/g,"&amp;").replace(/"/g,"&quot;").replace(/'/g,"&apos;").replace(/</g,"&lt;").replace(/>/g,"&gt;")},graphemeSplit:function(s){var a,u=0,i=[];for(u=0;u<s.length;u++)(a=l(s,u))!==!1&&i.push(a);return i}}}(),function(){var l=Array.prototype.slice,s=function(){},a=function(){for(var c in{toString:1})if(c==="toString")return!1;return!0}(),u=function(c,p,f){for(var d in p)d in c.prototype&&typeof c.prototype[d]=="function"&&(p[d]+"").indexOf("callSuper")>-1?c.prototype[d]=function(_){return function(){var w=this.constructor.superclass;this.constructor.superclass=f;var T=p[_].apply(this,arguments);if(this.constructor.superclass=w,_!=="initialize")return T}}(d):c.prototype[d]=p[d],a&&(p.toString!==Object.prototype.toString&&(c.prototype.toString=p.toString),p.valueOf!==Object.prototype.valueOf&&(c.prototype.valueOf=p.valueOf))};function i(){}function r(c){for(var p=null,f=this;f.constructor.superclass;){var d=f.constructor.superclass.prototype[c];if(f[c]!==d){p=d;break}f=f.constructor.superclass.prototype}return p?arguments.length>1?p.apply(this,l.call(arguments,1)):p.call(this):console.log("tried to callSuper "+c+", method not found in prototype chain",this)}y.util.createClass=function(){var c=null,p=l.call(arguments,0);function f(){this.initialize.apply(this,arguments)}typeof p[0]=="function"&&(c=p.shift()),f.superclass=c,f.subclasses=[],c&&(i.prototype=c.prototype,f.prototype=new i,c.subclasses.push(f));for(var d=0,_=p.length;d<_;d++)u(f,p[d],c);return f.prototype.initialize||(f.prototype.initialize=s),f.prototype.constructor=f,f.prototype.callSuper=r,f}}(),E=!!y.document.createElement("div").attachEvent,I=["touchstart","touchmove","touchend"],y.util.addListener=function(l,s,a,u){l&&l.addEventListener(s,a,!E&&u)},y.util.removeListener=function(l,s,a,u){l&&l.removeEventListener(s,a,!E&&u)},y.util.getPointer=function(l){var s=l.target,a=y.util.getScrollLeftTop(s),u=function(i){var r=i.changedTouches;return r&&r[0]?r[0]:i}(l);return{x:u.clientX+a.left,y:u.clientY+a.top}},y.util.isTouchEvent=function(l){return I.indexOf(l.type)>-1||l.pointerType==="touch"},L=typeof(R=y.document.createElement("div")).style.opacity=="string",N=typeof R.style.filter=="string",Y=/alpha\s*\(\s*opacity\s*=\s*([^\)]+)\)/,X=function(l){return l},L?X=function(l,s){return l.style.opacity=s,l}:N&&(X=function(l,s){var a=l.style;return l.currentStyle&&!l.currentStyle.hasLayout&&(a.zoom=1),Y.test(a.filter)?(s=s>=.9999?"":"alpha(opacity="+100*s+")",a.filter=a.filter.replace(Y,s)):a.filter+=" alpha(opacity="+100*s+")",l}),y.util.setStyle=function(l,s){var a=l.style;if(!a)return l;if(typeof s=="string")return l.style.cssText+=";"+s,s.indexOf("opacity")>-1?X(l,s.match(/opacity:\s*(\d?\.?\d*)/)[1]):l;for(var u in s)u==="opacity"?X(l,s[u]):a[u==="float"||u==="cssFloat"?a.styleFloat===void 0?"cssFloat":"styleFloat":u]=s[u];return l},function(){var l,s,a,u,i=Array.prototype.slice,r=function(f){return i.call(f,0)};try{l=r(y.document.childNodes)instanceof Array}catch{}function c(f,d){var _=y.document.createElement(f);for(var w in d)w==="class"?_.className=d[w]:w==="for"?_.htmlFor=d[w]:_.setAttribute(w,d[w]);return _}function p(f){for(var d=0,_=0,w=y.document.documentElement,T=y.document.body||{scrollLeft:0,scrollTop:0};f&&(f.parentNode||f.host)&&((f=f.parentNode||f.host)===y.document?(d=T.scrollLeft||w.scrollLeft||0,_=T.scrollTop||w.scrollTop||0):(d+=f.scrollLeft||0,_+=f.scrollTop||0),f.nodeType!==1||f.style.position!=="fixed"););return{left:d,top:_}}l||(r=function(f){for(var d=new Array(f.length),_=f.length;_--;)d[_]=f[_];return d}),s=y.document.defaultView&&y.document.defaultView.getComputedStyle?function(f,d){var _=y.document.defaultView.getComputedStyle(f,null);return _?_[d]:void 0}:function(f,d){var _=f.style[d];return!_&&f.currentStyle&&(_=f.currentStyle[d]),_},a=y.document.documentElement.style,u="userSelect"in a?"userSelect":"MozUserSelect"in a?"MozUserSelect":"WebkitUserSelect"in a?"WebkitUserSelect":"KhtmlUserSelect"in a?"KhtmlUserSelect":"",y.util.makeElementUnselectable=function(f){return f.onselectstart!==void 0&&(f.onselectstart=y.util.falseFunction),u?f.style[u]="none":typeof f.unselectable=="string"&&(f.unselectable="on"),f},y.util.makeElementSelectable=function(f){return f.onselectstart!==void 0&&(f.onselectstart=null),u?f.style[u]="":typeof f.unselectable=="string"&&(f.unselectable=""),f},y.util.setImageSmoothing=function(f,d){f.imageSmoothingEnabled=f.imageSmoothingEnabled||f.webkitImageSmoothingEnabled||f.mozImageSmoothingEnabled||f.msImageSmoothingEnabled||f.oImageSmoothingEnabled,f.imageSmoothingEnabled=d},y.util.getById=function(f){return typeof f=="string"?y.document.getElementById(f):f},y.util.toArray=r,y.util.addClass=function(f,d){f&&(" "+f.className+" ").indexOf(" "+d+" ")===-1&&(f.className+=(f.className?" ":"")+d)},y.util.makeElement=c,y.util.wrapElement=function(f,d,_){return typeof d=="string"&&(d=c(d,_)),f.parentNode&&f.parentNode.replaceChild(d,f),d.appendChild(f),d},y.util.getScrollLeftTop=p,y.util.getElementOffset=function(f){var d,_,w=f&&f.ownerDocument,T={left:0,top:0},x={left:0,top:0},b={borderLeftWidth:"left",borderTopWidth:"top",paddingLeft:"left",paddingTop:"top"};if(!w)return x;for(var F in b)x[b[F]]+=parseInt(s(f,F),10)||0;return d=w.documentElement,f.getBoundingClientRect!==void 0&&(T=f.getBoundingClientRect()),_=p(f),{left:T.left+_.left-(d.clientLeft||0)+x.left,top:T.top+_.top-(d.clientTop||0)+x.top}},y.util.getNodeCanvas=function(f){var d=y.jsdomImplForWrapper(f);return d._canvas||d._image},y.util.cleanUpJsdomNode=function(f){if(y.isLikelyNode){var d=y.jsdomImplForWrapper(f);d&&(d._image=null,d._canvas=null,d._currentSrc=null,d._attributes=null,d._classList=null)}}}(),function(){function l(){}y.util.request=function(s,a){a||(a={});var u=a.method?a.method.toUpperCase():"GET",i=a.onComplete||function(){},r=new y.window.XMLHttpRequest,c=a.body||a.parameters;return r.onreadystatechange=function(){r.readyState===4&&(i(r),r.onreadystatechange=l)},u==="GET"&&(c=null,typeof a.parameters=="string"&&(s=function(p,f){return p+(/\?/.test(p)?"&":"?")+f}(s,a.parameters))),r.open(u,s,!0),u!=="POST"&&u!=="PUT"||r.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),r.send(c),r}}(),y.log=console.log,y.warn=console.warn,function(){var l=y.util.object.extend,s=y.util.object.clone,a=[];function u(){return!1}function i(f,d,_,w){return-_*Math.cos(f/w*(Math.PI/2))+_+d}y.util.object.extend(a,{cancelAll:function(){var f=this.splice(0);return f.forEach(function(d){d.cancel()}),f},cancelByCanvas:function(f){if(!f)return[];var d=this.filter(function(_){return typeof _.target=="object"&&_.target.canvas===f});return d.forEach(function(_){_.cancel()}),d},cancelByTarget:function(f){var d=this.findAnimationsByTarget(f);return d.forEach(function(_){_.cancel()}),d},findAnimationIndex:function(f){return this.indexOf(this.findAnimation(f))},findAnimation:function(f){return this.find(function(d){return d.cancel===f})},findAnimationsByTarget:function(f){return f?this.filter(function(d){return d.target===f}):[]}});var r=y.window.requestAnimationFrame||y.window.webkitRequestAnimationFrame||y.window.mozRequestAnimationFrame||y.window.oRequestAnimationFrame||y.window.msRequestAnimationFrame||function(f){return y.window.setTimeout(f,1e3/60)},c=y.window.cancelAnimationFrame||y.window.clearTimeout;function p(){return r.apply(y.window,arguments)}y.util.animate=function(f){f||(f={});var d,_=!1,w=function(){var T=y.runningAnimations.indexOf(d);return T>-1&&y.runningAnimations.splice(T,1)[0]};return d=l(s(f),{cancel:function(){return _=!0,w()},currentValue:"startValue"in f?f.startValue:0,completionRate:0,durationRate:0}),y.runningAnimations.push(d),p(function(T){var x,b=T||+new Date,F=f.duration||500,B=b+F,z=f.onChange||u,$=f.abort||u,Q=f.onComplete||u,q=f.easing||i,O="startValue"in f&&f.startValue.length>0,A="startValue"in f?f.startValue:0,D="endValue"in f?f.endValue:100,k=f.byValue||(O?A.map(function(G,W){return D[W]-A[W]}):D-A);f.onStart&&f.onStart(),function G(W){var P=(x=W||+new Date)>B?F:x-b,M=P/F,U=O?A.map(function(H,Z){return q(P,A[Z],k[Z],F)}):q(P,A,k,F),V=Math.abs(O?(U[0]-A[0])/k[0]:(U-A)/k);if(d.currentValue=O?U.slice():U,d.completionRate=V,d.durationRate=M,!_){if(!$(U,V,M))return x>B?(d.currentValue=O?D.slice():D,d.completionRate=1,d.durationRate=1,z(O?D.slice():D,1,1),Q(D,1,1),void w()):(z(U,V,M),void p(G));w()}}(b)}),d.cancel},y.util.requestAnimFrame=p,y.util.cancelAnimFrame=function(){return c.apply(y.window,arguments)},y.runningAnimations=a}(),function(){function l(s,a,u){var i="rgba("+parseInt(s[0]+u*(a[0]-s[0]),10)+","+parseInt(s[1]+u*(a[1]-s[1]),10)+","+parseInt(s[2]+u*(a[2]-s[2]),10);return(i+=","+(s&&a?parseFloat(s[3]+u*(a[3]-s[3])):1))+")"}y.util.animateColor=function(s,a,u,i){var r=new y.Color(s).getSource(),c=new y.Color(a).getSource(),p=i.onComplete,f=i.onChange;return i=i||{},y.util.animate(y.util.object.extend(i,{duration:u||500,startValue:r,endValue:c,byValue:c,easing:function(d,_,w,T){return l(_,w,i.colorEasing?i.colorEasing(d,T):1-Math.cos(d/T*(Math.PI/2)))},onComplete:function(d,_,w){if(p)return p(l(c,c,0),_,w)},onChange:function(d,_,w){if(f){if(Array.isArray(d))return f(l(d,d,0),_,w);f(d,_,w)}}}))}}(),function(){function l(i,r,c,p){return i<Math.abs(r)?(i=r,p=c/4):p=r===0&&i===0?c/(2*Math.PI)*Math.asin(1):c/(2*Math.PI)*Math.asin(r/i),{a:i,c:r,p:c,s:p}}function s(i,r,c){return i.a*Math.pow(2,10*(r-=1))*Math.sin((r*c-i.s)*(2*Math.PI)/i.p)}function a(i,r,c,p){return c-u(p-i,0,c,p)+r}function u(i,r,c,p){return(i/=p)<1/2.75?c*(7.5625*i*i)+r:i<2/2.75?c*(7.5625*(i-=1.5/2.75)*i+.75)+r:i<2.5/2.75?c*(7.5625*(i-=2.25/2.75)*i+.9375)+r:c*(7.5625*(i-=2.625/2.75)*i+.984375)+r}y.util.ease={easeInQuad:function(i,r,c,p){return c*(i/=p)*i+r},easeOutQuad:function(i,r,c,p){return-c*(i/=p)*(i-2)+r},easeInOutQuad:function(i,r,c,p){return(i/=p/2)<1?c/2*i*i+r:-c/2*(--i*(i-2)-1)+r},easeInCubic:function(i,r,c,p){return c*(i/=p)*i*i+r},easeOutCubic:function(i,r,c,p){return c*((i=i/p-1)*i*i+1)+r},easeInOutCubic:function(i,r,c,p){return(i/=p/2)<1?c/2*i*i*i+r:c/2*((i-=2)*i*i+2)+r},easeInQuart:function(i,r,c,p){return c*(i/=p)*i*i*i+r},easeOutQuart:function(i,r,c,p){return-c*((i=i/p-1)*i*i*i-1)+r},easeInOutQuart:function(i,r,c,p){return(i/=p/2)<1?c/2*i*i*i*i+r:-c/2*((i-=2)*i*i*i-2)+r},easeInQuint:function(i,r,c,p){return c*(i/=p)*i*i*i*i+r},easeOutQuint:function(i,r,c,p){return c*((i=i/p-1)*i*i*i*i+1)+r},easeInOutQuint:function(i,r,c,p){return(i/=p/2)<1?c/2*i*i*i*i*i+r:c/2*((i-=2)*i*i*i*i+2)+r},easeInSine:function(i,r,c,p){return-c*Math.cos(i/p*(Math.PI/2))+c+r},easeOutSine:function(i,r,c,p){return c*Math.sin(i/p*(Math.PI/2))+r},easeInOutSine:function(i,r,c,p){return-c/2*(Math.cos(Math.PI*i/p)-1)+r},easeInExpo:function(i,r,c,p){return i===0?r:c*Math.pow(2,10*(i/p-1))+r},easeOutExpo:function(i,r,c,p){return i===p?r+c:c*(1-Math.pow(2,-10*i/p))+r},easeInOutExpo:function(i,r,c,p){return i===0?r:i===p?r+c:(i/=p/2)<1?c/2*Math.pow(2,10*(i-1))+r:c/2*(2-Math.pow(2,-10*--i))+r},easeInCirc:function(i,r,c,p){return-c*(Math.sqrt(1-(i/=p)*i)-1)+r},easeOutCirc:function(i,r,c,p){return c*Math.sqrt(1-(i=i/p-1)*i)+r},easeInOutCirc:function(i,r,c,p){return(i/=p/2)<1?-c/2*(Math.sqrt(1-i*i)-1)+r:c/2*(Math.sqrt(1-(i-=2)*i)+1)+r},easeInElastic:function(i,r,c,p){var f=0;return i===0?r:(i/=p)==1?r+c:(f||(f=.3*p),-s(l(c,c,f,1.70158),i,p)+r)},easeOutElastic:function(i,r,c,p){var f=0;if(i===0)return r;if((i/=p)==1)return r+c;f||(f=.3*p);var d=l(c,c,f,1.70158);return d.a*Math.pow(2,-10*i)*Math.sin((i*p-d.s)*(2*Math.PI)/d.p)+d.c+r},easeInOutElastic:function(i,r,c,p){var f=0;if(i===0)return r;if((i/=p/2)==2)return r+c;f||(f=p*(.3*1.5));var d=l(c,c,f,1.70158);return i<1?-.5*s(d,i,p)+r:d.a*Math.pow(2,-10*(i-=1))*Math.sin((i*p-d.s)*(2*Math.PI)/d.p)*.5+d.c+r},easeInBack:function(i,r,c,p,f){return f===void 0&&(f=1.70158),c*(i/=p)*i*((f+1)*i-f)+r},easeOutBack:function(i,r,c,p,f){return f===void 0&&(f=1.70158),c*((i=i/p-1)*i*((f+1)*i+f)+1)+r},easeInOutBack:function(i,r,c,p,f){return f===void 0&&(f=1.70158),(i/=p/2)<1?c/2*(i*i*((1+(f*=1.525))*i-f))+r:c/2*((i-=2)*i*((1+(f*=1.525))*i+f)+2)+r},easeInBounce:a,easeOutBounce:u,easeInOutBounce:function(i,r,c,p){return i<p/2?.5*a(2*i,0,c,p)+r:.5*u(2*i-p,0,c,p)+.5*c+r}}}(),function(l){var s=l.fabric||(l.fabric={}),a=s.util.object.extend,u=s.util.object.clone,i=s.util.toFixed,r=s.util.parseUnit,c=s.util.multiplyTransformMatrices,p={cx:"left",x:"left",r:"radius",cy:"top",y:"top",display:"visible",visibility:"visible",transform:"transformMatrix","fill-opacity":"fillOpacity","fill-rule":"fillRule","font-family":"fontFamily","font-size":"fontSize","font-style":"fontStyle","font-weight":"fontWeight","letter-spacing":"charSpacing","paint-order":"paintFirst","stroke-dasharray":"strokeDashArray","stroke-dashoffset":"strokeDashOffset","stroke-linecap":"strokeLineCap","stroke-linejoin":"strokeLineJoin","stroke-miterlimit":"strokeMiterLimit","stroke-opacity":"strokeOpacity","stroke-width":"strokeWidth","text-decoration":"textDecoration","text-anchor":"textAnchor",opacity:"opacity","clip-path":"clipPath","clip-rule":"clipRule","vector-effect":"strokeUniform","image-rendering":"imageSmoothing"},f={stroke:"strokeOpacity",fill:"fillOpacity"},d="font-size",_="clip-path";function w(A){return A in p?p[A]:A}function T(A,D,k,G){var W,P=Array.isArray(D);if(A!=="fill"&&A!=="stroke"||D!=="none"){if(A==="strokeUniform")return D==="non-scaling-stroke";if(A==="strokeDashArray")D=D==="none"?null:D.replace(/,/g," ").split(/\s+/).map(parseFloat);else if(A==="transformMatrix")D=k&&k.transformMatrix?c(k.transformMatrix,s.parseTransformAttribute(D)):s.parseTransformAttribute(D);else if(A==="visible")D=D!=="none"&&D!=="hidden",k&&k.visible===!1&&(D=!1);else if(A==="opacity")D=parseFloat(D),k&&k.opacity!==void 0&&(D*=k.opacity);else if(A==="textAnchor")D=D==="start"?"left":D==="end"?"right":"center";else if(A==="charSpacing")W=r(D,G)/G*1e3;else if(A==="paintFirst"){var M=D.indexOf("fill"),U=D.indexOf("stroke");D="fill",(M>-1&&U>-1&&U<M||M===-1&&U>-1)&&(D="stroke")}else{if(A==="href"||A==="xlink:href"||A==="font")return D;if(A==="imageSmoothing")return D==="optimizeQuality";W=P?D.map(r):r(D,G)}}else D="";return!P&&isNaN(W)?D:W}function x(A){return new RegExp("^("+A.join("|")+")\\b","i")}function b(A,D){var k,G,W,P,M=[];for(W=0,P=D.length;W<P;W++)k=D[W],G=A.getElementsByTagName(k),M=M.concat(Array.prototype.slice.call(G));return M}function F(A,D){var k,G=!0;return(k=B(A,D.pop()))&&D.length&&(G=function(W,P){for(var M,U=!0;W.parentNode&&W.parentNode.nodeType===1&&P.length;)U&&(M=P.pop()),U=B(W=W.parentNode,M);return P.length===0}(A,D)),k&&G&&D.length===0}function B(A,D){var k,G,W=A.nodeName,P=A.getAttribute("class"),M=A.getAttribute("id");if(k=new RegExp("^"+W,"i"),D=D.replace(k,""),M&&D.length&&(k=new RegExp("#"+M+"(?![a-zA-Z\\-]+)","i"),D=D.replace(k,"")),P&&D.length)for(G=(P=P.split(" ")).length;G--;)k=new RegExp("\\."+P[G]+"(?![a-zA-Z\\-]+)","i"),D=D.replace(k,"");return D.length===0}function z(A,D){var k;if(A.getElementById&&(k=A.getElementById(D)),k)return k;var G,W,P,M=A.getElementsByTagName("*");for(W=0,P=M.length;W<P;W++)if(D===(G=M[W]).getAttribute("id"))return G}s.svgValidTagNamesRegEx=x(["path","circle","polygon","polyline","ellipse","rect","line","image","text"]),s.svgViewBoxElementsRegEx=x(["symbol","image","marker","pattern","view","svg"]),s.svgInvalidAncestorsRegEx=x(["pattern","defs","symbol","metadata","clipPath","mask","desc"]),s.svgValidParentsRegEx=x(["symbol","g","a","svg","clipPath","defs"]),s.cssRules={},s.gradientDefs={},s.clipPaths={},s.parseTransformAttribute=function(){function A(U,V,H){U[H]=Math.tan(s.util.degreesToRadians(V[0]))}var D=s.iMatrix,k=s.reNum,G=s.commaWsp,W="(?:(?:(matrix)\\s*\\(\\s*("+k+")"+G+"("+k+")"+G+"("+k+")"+G+"("+k+")"+G+"("+k+")"+G+"("+k+")\\s*\\))|(?:(translate)\\s*\\(\\s*("+k+")(?:"+G+"("+k+"))?\\s*\\))|(?:(scale)\\s*\\(\\s*("+k+")(?:"+G+"("+k+"))?\\s*\\))|(?:(rotate)\\s*\\(\\s*("+k+")(?:"+G+"("+k+")"+G+"("+k+"))?\\s*\\))|(?:(skewX)\\s*\\(\\s*("+k+")\\s*\\))|(?:(skewY)\\s*\\(\\s*("+k+")\\s*\\)))",P=new RegExp("^\\s*(?:(?:"+W+"(?:"+G+"*"+W+")*)?)\\s*$"),M=new RegExp(W,"g");return function(U){var V=D.concat(),H=[];if(!U||U&&!P.test(U))return V;U.replace(M,function(ee){var re=new RegExp(W).exec(ee).filter(function(oe){return!!oe}),ie=re[1],se=re.slice(2).map(parseFloat);switch(ie){case"translate":(function(oe,ce){oe[4]=ce[0],ce.length===2&&(oe[5]=ce[1])})(V,se);break;case"rotate":se[0]=s.util.degreesToRadians(se[0]),function(oe,ce){var me=s.util.cos(ce[0]),fe=s.util.sin(ce[0]),Ae=0,Ne=0;ce.length===3&&(Ae=ce[1],Ne=ce[2]),oe[0]=me,oe[1]=fe,oe[2]=-fe,oe[3]=me,oe[4]=Ae-(me*Ae-fe*Ne),oe[5]=Ne-(fe*Ae+me*Ne)}(V,se);break;case"scale":(function(oe,ce){var me=ce[0],fe=ce.length===2?ce[1]:ce[0];oe[0]=me,oe[3]=fe})(V,se);break;case"skewX":A(V,se,2);break;case"skewY":A(V,se,1);break;case"matrix":V=se}H.push(V.concat()),V=D.concat()});for(var Z=H[0];H.length>1;)H.shift(),Z=s.util.multiplyTransformMatrices(Z,H[0]);return Z}}();var $=new RegExp("^\\s*("+s.reNum+"+)\\s*,?\\s*("+s.reNum+"+)\\s*,?\\s*("+s.reNum+"+)\\s*,?\\s*("+s.reNum+"+)\\s*$");function Q(A){if(!s.svgViewBoxElementsRegEx.test(A.nodeName))return{};var D,k,G,W,P,M,U=A.getAttribute("viewBox"),V=1,H=1,Z=A.getAttribute("width"),ee=A.getAttribute("height"),re=A.getAttribute("x")||0,ie=A.getAttribute("y")||0,se=A.getAttribute("preserveAspectRatio")||"",oe=!U||!(U=U.match($)),ce=!Z||!ee||Z==="100%"||ee==="100%",me=oe&&ce,fe={},Ae="",Ne=0,mt=0;if(fe.width=0,fe.height=0,fe.toBeParsed=me,oe&&(re||ie)&&A.parentNode&&A.parentNode.nodeName!=="#document"&&(Ae=" translate("+r(re)+" "+r(ie)+") ",P=(A.getAttribute("transform")||"")+Ae,A.setAttribute("transform",P),A.removeAttribute("x"),A.removeAttribute("y")),me)return fe;if(oe)return fe.width=r(Z),fe.height=r(ee),fe;if(D=-parseFloat(U[1]),k=-parseFloat(U[2]),G=parseFloat(U[3]),W=parseFloat(U[4]),fe.minX=D,fe.minY=k,fe.viewBoxWidth=G,fe.viewBoxHeight=W,ce?(fe.width=G,fe.height=W):(fe.width=r(Z),fe.height=r(ee),V=fe.width/G,H=fe.height/W),(se=s.util.parsePreserveAspectRatioAttribute(se)).alignX!=="none"&&(se.meetOrSlice==="meet"&&(H=V=V>H?H:V),se.meetOrSlice==="slice"&&(H=V=V>H?V:H),Ne=fe.width-G*V,mt=fe.height-W*V,se.alignX==="Mid"&&(Ne/=2),se.alignY==="Mid"&&(mt/=2),se.alignX==="Min"&&(Ne=0),se.alignY==="Min"&&(mt=0)),V===1&&H===1&&D===0&&k===0&&re===0&&ie===0)return fe;if((re||ie)&&A.parentNode.nodeName!=="#document"&&(Ae=" translate("+r(re)+" "+r(ie)+") "),P=Ae+" matrix("+V+" 0 0 "+H+" "+(D*V+Ne)+" "+(k*H+mt)+") ",A.nodeName==="svg"){for(M=A.ownerDocument.createElementNS(s.svgNS,"g");A.firstChild;)M.appendChild(A.firstChild);A.appendChild(M)}else(M=A).removeAttribute("x"),M.removeAttribute("y"),P=M.getAttribute("transform")+P;return M.setAttribute("transform",P),fe}function q(A,D){var k="xlink:href",G=z(A,D.getAttribute(k).slice(1));if(G&&G.getAttribute(k)&&q(A,G),["gradientTransform","x1","x2","y1","y2","gradientUnits","cx","cy","r","fx","fy"].forEach(function(P){G&&!D.hasAttribute(P)&&G.hasAttribute(P)&&D.setAttribute(P,G.getAttribute(P))}),!D.children.length)for(var W=G.cloneNode(!0);W.firstChild;)D.appendChild(W.firstChild);D.removeAttribute(k)}s.parseSVGDocument=function(A,D,k,G){if(A){(function(re){for(var ie=b(re,["use","svg:use"]),se=0;ie.length&&se<ie.length;){var oe=ie[se],ce=oe.getAttribute("xlink:href")||oe.getAttribute("href");if(ce===null)return;var me,fe,Ae,Ne,mt=ce.slice(1),et=oe.getAttribute("x")||0,at=oe.getAttribute("y")||0,Ke=z(re,mt).cloneNode(!0),Pt=(Ke.getAttribute("transform")||"")+" translate("+et+", "+at+")",Vn=ie.length,cn=s.svgNS;if(Q(Ke),/^svg$/i.test(Ke.nodeName)){var Bi=Ke.ownerDocument.createElementNS(cn,"g");for(fe=0,Ne=(Ae=Ke.attributes).length;fe<Ne;fe++)me=Ae.item(fe),Bi.setAttributeNS(cn,me.nodeName,me.nodeValue);for(;Ke.firstChild;)Bi.appendChild(Ke.firstChild);Ke=Bi}for(fe=0,Ne=(Ae=oe.attributes).length;fe<Ne;fe++)(me=Ae.item(fe)).nodeName!=="x"&&me.nodeName!=="y"&&me.nodeName!=="xlink:href"&&me.nodeName!=="href"&&(me.nodeName==="transform"?Pt=me.nodeValue+" "+Pt:Ke.setAttribute(me.nodeName,me.nodeValue));Ke.setAttribute("transform",Pt),Ke.setAttribute("instantiated_by_use","1"),Ke.removeAttribute("id"),oe.parentNode.replaceChild(Ke,oe),ie.length===Vn&&se++}})(A);var W,P,M=s.Object.__uid++,U=Q(A),V=s.util.toArray(A.getElementsByTagName("*"));if(U.crossOrigin=G&&G.crossOrigin,U.svgUid=M,V.length===0&&s.isLikelyNode){var H=[];for(W=0,P=(V=A.selectNodes('//*[name(.)!="svg"]')).length;W<P;W++)H[W]=V[W];V=H}var Z=V.filter(function(re){return Q(re),s.svgValidTagNamesRegEx.test(re.nodeName.replace("svg:",""))&&!function(ie,se){for(;ie&&(ie=ie.parentNode);)if(ie.nodeName&&se.test(ie.nodeName.replace("svg:",""))&&!ie.getAttribute("instantiated_by_use"))return!0;return!1}(re,s.svgInvalidAncestorsRegEx)});if(!Z||Z&&!Z.length)D&&D([],{});else{var ee={};V.filter(function(re){return re.nodeName.replace("svg:","")==="clipPath"}).forEach(function(re){var ie=re.getAttribute("id");ee[ie]=s.util.toArray(re.getElementsByTagName("*")).filter(function(se){return s.svgValidTagNamesRegEx.test(se.nodeName.replace("svg:",""))})}),s.gradientDefs[M]=s.getGradientDefs(A),s.cssRules[M]=s.getCSSRules(A),s.clipPaths[M]=ee,s.parseElements(Z,function(re,ie){D&&(D(re,U,ie,V),delete s.gradientDefs[M],delete s.cssRules[M],delete s.clipPaths[M])},u(U),k,G)}}};var O=new RegExp("(normal|italic)?\\s*(normal|small-caps)?\\s*(normal|bold|bolder|lighter|100|200|300|400|500|600|700|800|900)?\\s*("+s.reNum+"(?:px|cm|mm|em|pt|pc|in)*)(?:\\/(normal|"+s.reNum+"))?\\s+(.*)");a(s,{parseFontDeclaration:function(A,D){var k=A.match(O);if(k){var G=k[1],W=k[3],P=k[4],M=k[5],U=k[6];G&&(D.fontStyle=G),W&&(D.fontWeight=isNaN(parseFloat(W))?W:parseFloat(W)),P&&(D.fontSize=r(P)),U&&(D.fontFamily=U),M&&(D.lineHeight=M==="normal"?1:M)}},getGradientDefs:function(A){var D,k=b(A,["linearGradient","radialGradient","svg:linearGradient","svg:radialGradient"]),G=0,W={};for(G=k.length;G--;)(D=k[G]).getAttribute("xlink:href")&&q(A,D),W[D.getAttribute("id")]=D;return W},parseAttributes:function(A,D,k){if(A){var G,W,P,M={};k===void 0&&(k=A.getAttribute("svgUid")),A.parentNode&&s.svgValidParentsRegEx.test(A.parentNode.nodeName)&&(M=s.parseAttributes(A.parentNode,D,k));var U=D.reduce(function(se,oe){return(G=A.getAttribute(oe))&&(se[oe]=G),se},{}),V=a(function(se,oe){var ce={};for(var me in s.cssRules[oe])if(F(se,me.split(" ")))for(var fe in s.cssRules[oe][me])ce[fe]=s.cssRules[oe][me][fe];return ce}(A,k),s.parseStyleAttribute(A));U=a(U,V),V[_]&&A.setAttribute(_,V[_]),W=P=M.fontSize||s.Text.DEFAULT_SVG_FONT_SIZE,U[d]&&(U[d]=W=r(U[d],P));var H,Z,ee={};for(var re in U)Z=T(H=w(re),U[re],M,W),ee[H]=Z;ee&&ee.font&&s.parseFontDeclaration(ee.font,ee);var ie=a(M,ee);return s.svgValidParentsRegEx.test(A.nodeName)?ie:function(se){for(var oe in f)if(se[f[oe]]!==void 0&&se[oe]!==""){if(se[oe]===void 0){if(!s.Object.prototype[oe])continue;se[oe]=s.Object.prototype[oe]}if(se[oe].indexOf("url(")!==0){var ce=new s.Color(se[oe]);se[oe]=ce.setAlpha(i(ce.getAlpha()*se[f[oe]],2)).toRgba()}}return se}(ie)}},parseElements:function(A,D,k,G,W){new s.ElementsParser(A,D,k,G,W).parse()},parseStyleAttribute:function(A){var D={},k=A.getAttribute("style");return k&&(typeof k=="string"?function(G,W){var P,M;G.replace(/;\s*$/,"").split(";").forEach(function(U){var V=U.split(":");P=V[0].trim().toLowerCase(),M=V[1].trim(),W[P]=M})}(k,D):function(G,W){var P,M;for(var U in G)G[U]!==void 0&&(P=U.toLowerCase(),M=G[U],W[P]=M)}(k,D)),D},parsePointsAttribute:function(A){if(!A)return null;var D,k,G=[];for(D=0,k=(A=(A=A.replace(/,/g," ").trim()).split(/\s+/)).length;D<k;D+=2)G.push({x:parseFloat(A[D]),y:parseFloat(A[D+1])});return G},getCSSRules:function(A){var D,k,G=A.getElementsByTagName("style"),W={};for(D=0,k=G.length;D<k;D++){var P=G[D].textContent;(P=P.replace(/\/\*[\s\S]*?\*\//g,"")).trim()!==""&&P.split("}").filter(function(M){return M.trim()}).forEach(function(M){var U=M.split("{"),V={},H=U[1].trim().split(";").filter(function(ie){return ie.trim()});for(D=0,k=H.length;D<k;D++){var Z=H[D].split(":"),ee=Z[0].trim(),re=Z[1].trim();V[ee]=re}(M=U[0].trim()).split(",").forEach(function(ie){(ie=ie.replace(/^svg/i,"").trim())!==""&&(W[ie]?s.util.object.extend(W[ie],V):W[ie]=s.util.object.clone(V))})})}return W},loadSVGFromURL:function(A,D,k,G){A=A.replace(/^\n\s*/,"").trim(),new s.util.request(A,{method:"get",onComplete:function(W){var P=W.responseXML;if(!P||!P.documentElement)return D&&D(null),!1;s.parseSVGDocument(P.documentElement,function(M,U,V,H){D&&D(M,U,V,H)},k,G)}})},loadSVGFromString:function(A,D,k,G){var W=new s.window.DOMParser().parseFromString(A.trim(),"text/xml");s.parseSVGDocument(W.documentElement,function(P,M,U,V){D(P,M,U,V)},k,G)}})}(e),y.ElementsParser=function(l,s,a,u,i,r){this.elements=l,this.callback=s,this.options=a,this.reviver=u,this.svgUid=a&&a.svgUid||0,this.parsingOptions=i,this.regexUrl=/^url\(['"]?#([^'"]+)['"]?\)/g,this.doc=r},(K=y.ElementsParser.prototype).parse=function(){this.instances=new Array(this.elements.length),this.numElements=this.elements.length,this.createObjects()},K.createObjects=function(){var l=this;this.elements.forEach(function(s,a){s.setAttribute("svgUid",l.svgUid),l.createObject(s,a)})},K.findTag=function(l){return y[y.util.string.capitalize(l.tagName.replace("svg:",""))]},K.createObject=function(l,s){var a=this.findTag(l);if(a&&a.fromElement)try{a.fromElement(l,this.createCallback(s,l),this.options)}catch(u){y.log(u)}else this.checkIfDone()},K.createCallback=function(l,s){var a=this;return function(u){var i;a.resolveGradient(u,s,"fill"),a.resolveGradient(u,s,"stroke"),u instanceof y.Image&&u._originalElement&&(i=u.parsePreserveAspectRatioAttribute(s)),u._removeTransformMatrix(i),a.resolveClipPath(u,s),a.reviver&&a.reviver(s,u),a.instances[l]=u,a.checkIfDone()}},K.extractPropertyDefinition=function(l,s,a){var u=l[s],i=this.regexUrl;if(i.test(u)){i.lastIndex=0;var r=i.exec(u)[1];return i.lastIndex=0,y[a][this.svgUid][r]}},K.resolveGradient=function(l,s,a){var u=this.extractPropertyDefinition(l,a,"gradientDefs");if(u){var i=s.getAttribute(a+"-opacity"),r=y.Gradient.fromElement(u,l,i,this.options);l.set(a,r)}},K.createClipPathCallback=function(l,s){return function(a){a._removeTransformMatrix(),a.fillRule=a.clipRule,s.push(a)}},K.resolveClipPath=function(l,s){var a,u,i,r,c=this.extractPropertyDefinition(l,"clipPath","clipPaths");if(c){i=[],u=y.util.invertTransform(l.calcTransformMatrix());for(var p=c[0].parentNode,f=s;f.parentNode&&f.getAttribute("clip-path")!==l.clipPath;)f=f.parentNode;f.parentNode.appendChild(p);for(var d=0;d<c.length;d++)a=c[d],this.findTag(a).fromElement(a,this.createClipPathCallback(l,i),this.options);c=i.length===1?i[0]:new y.Group(i),r=y.util.multiplyTransformMatrices(u,c.calcTransformMatrix()),c.clipPath&&this.resolveClipPath(c,f);var _=y.util.qrDecompose(r);c.flipX=!1,c.flipY=!1,c.set("scaleX",_.scaleX),c.set("scaleY",_.scaleY),c.angle=_.angle,c.skewX=_.skewX,c.skewY=0,c.setPositionByOrigin({x:_.translateX,y:_.translateY},"center","center"),l.clipPath=c}else delete l.clipPath},K.checkIfDone=function(){--this.numElements==0&&(this.instances=this.instances.filter(function(l){return l!=null}),this.callback(this.instances,this.elements))},function(l){var s=l.fabric||(l.fabric={});function a(u,i){this.x=u,this.y=i}s.Point?s.warn("fabric.Point is already defined"):(s.Point=a,a.prototype={type:"point",constructor:a,add:function(u){return new a(this.x+u.x,this.y+u.y)},addEquals:function(u){return this.x+=u.x,this.y+=u.y,this},scalarAdd:function(u){return new a(this.x+u,this.y+u)},scalarAddEquals:function(u){return this.x+=u,this.y+=u,this},subtract:function(u){return new a(this.x-u.x,this.y-u.y)},subtractEquals:function(u){return this.x-=u.x,this.y-=u.y,this},scalarSubtract:function(u){return new a(this.x-u,this.y-u)},scalarSubtractEquals:function(u){return this.x-=u,this.y-=u,this},multiply:function(u){return new a(this.x*u,this.y*u)},multiplyEquals:function(u){return this.x*=u,this.y*=u,this},divide:function(u){return new a(this.x/u,this.y/u)},divideEquals:function(u){return this.x/=u,this.y/=u,this},eq:function(u){return this.x===u.x&&this.y===u.y},lt:function(u){return this.x<u.x&&this.y<u.y},lte:function(u){return this.x<=u.x&&this.y<=u.y},gt:function(u){return this.x>u.x&&this.y>u.y},gte:function(u){return this.x>=u.x&&this.y>=u.y},lerp:function(u,i){return i===void 0&&(i=.5),i=Math.max(Math.min(1,i),0),new a(this.x+(u.x-this.x)*i,this.y+(u.y-this.y)*i)},distanceFrom:function(u){var i=this.x-u.x,r=this.y-u.y;return Math.sqrt(i*i+r*r)},midPointFrom:function(u){return this.lerp(u)},min:function(u){return new a(Math.min(this.x,u.x),Math.min(this.y,u.y))},max:function(u){return new a(Math.max(this.x,u.x),Math.max(this.y,u.y))},toString:function(){return this.x+","+this.y},setXY:function(u,i){return this.x=u,this.y=i,this},setX:function(u){return this.x=u,this},setY:function(u){return this.y=u,this},setFromPoint:function(u){return this.x=u.x,this.y=u.y,this},swap:function(u){var i=this.x,r=this.y;this.x=u.x,this.y=u.y,u.x=i,u.y=r},clone:function(){return new a(this.x,this.y)}})}(e),function(l){var s=l.fabric||(l.fabric={});function a(u){this.status=u,this.points=[]}s.Intersection?s.warn("fabric.Intersection is already defined"):(s.Intersection=a,s.Intersection.prototype={constructor:a,appendPoint:function(u){return this.points.push(u),this},appendPoints:function(u){return this.points=this.points.concat(u),this}},s.Intersection.intersectLineLine=function(u,i,r,c){var p,f=(c.x-r.x)*(u.y-r.y)-(c.y-r.y)*(u.x-r.x),d=(i.x-u.x)*(u.y-r.y)-(i.y-u.y)*(u.x-r.x),_=(c.y-r.y)*(i.x-u.x)-(c.x-r.x)*(i.y-u.y);if(_!==0){var w=f/_,T=d/_;0<=w&&w<=1&&0<=T&&T<=1?(p=new a("Intersection")).appendPoint(new s.Point(u.x+w*(i.x-u.x),u.y+w*(i.y-u.y))):p=new a}else p=new a(f===0||d===0?"Coincident":"Parallel");return p},s.Intersection.intersectLinePolygon=function(u,i,r){var c,p,f,d,_=new a,w=r.length;for(d=0;d<w;d++)c=r[d],p=r[(d+1)%w],f=a.intersectLineLine(u,i,c,p),_.appendPoints(f.points);return _.points.length>0&&(_.status="Intersection"),_},s.Intersection.intersectPolygonPolygon=function(u,i){var r,c=new a,p=u.length;for(r=0;r<p;r++){var f=u[r],d=u[(r+1)%p],_=a.intersectLinePolygon(f,d,i);c.appendPoints(_.points)}return c.points.length>0&&(c.status="Intersection"),c},s.Intersection.intersectPolygonRectangle=function(u,i,r){var c=i.min(r),p=i.max(r),f=new s.Point(p.x,c.y),d=new s.Point(c.x,p.y),_=a.intersectLinePolygon(c,f,u),w=a.intersectLinePolygon(f,p,u),T=a.intersectLinePolygon(p,d,u),x=a.intersectLinePolygon(d,c,u),b=new a;return b.appendPoints(_.points),b.appendPoints(w.points),b.appendPoints(T.points),b.appendPoints(x.points),b.points.length>0&&(b.status="Intersection"),b})}(e),function(l){var s=l.fabric||(l.fabric={});function a(i){i?this._tryParsingColor(i):this.setSource([0,0,0,1])}function u(i,r,c){return c<0&&(c+=1),c>1&&(c-=1),c<1/6?i+6*(r-i)*c:c<.5?r:c<2/3?i+(r-i)*(2/3-c)*6:i}s.Color?s.warn("fabric.Color is already defined."):(s.Color=a,s.Color.prototype={_tryParsingColor:function(i){var r;i in a.colorNameMap&&(i=a.colorNameMap[i]),i==="transparent"&&(r=[255,255,255,0]),r||(r=a.sourceFromHex(i)),r||(r=a.sourceFromRgb(i)),r||(r=a.sourceFromHsl(i)),r||(r=[0,0,0,1]),r&&this.setSource(r)},_rgbToHsl:function(i,r,c){i/=255,r/=255,c/=255;var p,f,d,_=s.util.array.max([i,r,c]),w=s.util.array.min([i,r,c]);if(d=(_+w)/2,_===w)p=f=0;else{var T=_-w;switch(f=d>.5?T/(2-_-w):T/(_+w),_){case i:p=(r-c)/T+(r<c?6:0);break;case r:p=(c-i)/T+2;break;case c:p=(i-r)/T+4}p/=6}return[Math.round(360*p),Math.round(100*f),Math.round(100*d)]},getSource:function(){return this._source},setSource:function(i){this._source=i},toRgb:function(){var i=this.getSource();return"rgb("+i[0]+","+i[1]+","+i[2]+")"},toRgba:function(){var i=this.getSource();return"rgba("+i[0]+","+i[1]+","+i[2]+","+i[3]+")"},toHsl:function(){var i=this.getSource(),r=this._rgbToHsl(i[0],i[1],i[2]);return"hsl("+r[0]+","+r[1]+"%,"+r[2]+"%)"},toHsla:function(){var i=this.getSource(),r=this._rgbToHsl(i[0],i[1],i[2]);return"hsla("+r[0]+","+r[1]+"%,"+r[2]+"%,"+i[3]+")"},toHex:function(){var i,r,c,p=this.getSource();return i=(i=p[0].toString(16)).length===1?"0"+i:i,r=(r=p[1].toString(16)).length===1?"0"+r:r,c=(c=p[2].toString(16)).length===1?"0"+c:c,i.toUpperCase()+r.toUpperCase()+c.toUpperCase()},toHexa:function(){var i,r=this.getSource();return i=(i=(i=Math.round(255*r[3])).toString(16)).length===1?"0"+i:i,this.toHex()+i.toUpperCase()},getAlpha:function(){return this.getSource()[3]},setAlpha:function(i){var r=this.getSource();return r[3]=i,this.setSource(r),this},toGrayscale:function(){var i=this.getSource(),r=parseInt((.3*i[0]+.59*i[1]+.11*i[2]).toFixed(0),10),c=i[3];return this.setSource([r,r,r,c]),this},toBlackWhite:function(i){var r=this.getSource(),c=(.3*r[0]+.59*r[1]+.11*r[2]).toFixed(0),p=r[3];return i=i||127,c=Number(c)<Number(i)?0:255,this.setSource([c,c,c,p]),this},overlayWith:function(i){i instanceof a||(i=new a(i));var r,c=[],p=this.getAlpha(),f=this.getSource(),d=i.getSource();for(r=0;r<3;r++)c.push(Math.round(.5*f[r]+.5*d[r]));return c[3]=p,this.setSource(c),this}},s.Color.reRGBa=/^rgba?\(\s*(\d{1,3}(?:\.\d+)?\%?)\s*,\s*(\d{1,3}(?:\.\d+)?\%?)\s*,\s*(\d{1,3}(?:\.\d+)?\%?)\s*(?:\s*,\s*((?:\d*\.?\d+)?)\s*)?\)$/i,s.Color.reHSLa=/^hsla?\(\s*(\d{1,3})\s*,\s*(\d{1,3}\%)\s*,\s*(\d{1,3}\%)\s*(?:\s*,\s*(\d+(?:\.\d+)?)\s*)?\)$/i,s.Color.reHex=/^#?([0-9a-f]{8}|[0-9a-f]{6}|[0-9a-f]{4}|[0-9a-f]{3})$/i,s.Color.colorNameMap={aliceblue:"#F0F8FF",antiquewhite:"#FAEBD7",aqua:"#00FFFF",aquamarine:"#7FFFD4",azure:"#F0FFFF",beige:"#F5F5DC",bisque:"#FFE4C4",black:"#000000",blanchedalmond:"#FFEBCD",blue:"#0000FF",blueviolet:"#8A2BE2",brown:"#A52A2A",burlywood:"#DEB887",cadetblue:"#5F9EA0",chartreuse:"#7FFF00",chocolate:"#D2691E",coral:"#FF7F50",cornflowerblue:"#6495ED",cornsilk:"#FFF8DC",crimson:"#DC143C",cyan:"#00FFFF",darkblue:"#00008B",darkcyan:"#008B8B",darkgoldenrod:"#B8860B",darkgray:"#A9A9A9",darkgrey:"#A9A9A9",darkgreen:"#006400",darkkhaki:"#BDB76B",darkmagenta:"#8B008B",darkolivegreen:"#556B2F",darkorange:"#FF8C00",darkorchid:"#9932CC",darkred:"#8B0000",darksalmon:"#E9967A",darkseagreen:"#8FBC8F",darkslateblue:"#483D8B",darkslategray:"#2F4F4F",darkslategrey:"#2F4F4F",darkturquoise:"#00CED1",darkviolet:"#9400D3",deeppink:"#FF1493",deepskyblue:"#00BFFF",dimgray:"#696969",dimgrey:"#696969",dodgerblue:"#1E90FF",firebrick:"#B22222",floralwhite:"#FFFAF0",forestgreen:"#228B22",fuchsia:"#FF00FF",gainsboro:"#DCDCDC",ghostwhite:"#F8F8FF",gold:"#FFD700",goldenrod:"#DAA520",gray:"#808080",grey:"#808080",green:"#008000",greenyellow:"#ADFF2F",honeydew:"#F0FFF0",hotpink:"#FF69B4",indianred:"#CD5C5C",indigo:"#4B0082",ivory:"#FFFFF0",khaki:"#F0E68C",lavender:"#E6E6FA",lavenderblush:"#FFF0F5",lawngreen:"#7CFC00",lemonchiffon:"#FFFACD",lightblue:"#ADD8E6",lightcoral:"#F08080",lightcyan:"#E0FFFF",lightgoldenrodyellow:"#FAFAD2",lightgray:"#D3D3D3",lightgrey:"#D3D3D3",lightgreen:"#90EE90",lightpink:"#FFB6C1",lightsalmon:"#FFA07A",lightseagreen:"#20B2AA",lightskyblue:"#87CEFA",lightslategray:"#778899",lightslategrey:"#778899",lightsteelblue:"#B0C4DE",lightyellow:"#FFFFE0",lime:"#00FF00",limegreen:"#32CD32",linen:"#FAF0E6",magenta:"#FF00FF",maroon:"#800000",mediumaquamarine:"#66CDAA",mediumblue:"#0000CD",mediumorchid:"#BA55D3",mediumpurple:"#9370DB",mediumseagreen:"#3CB371",mediumslateblue:"#7B68EE",mediumspringgreen:"#00FA9A",mediumturquoise:"#48D1CC",mediumvioletred:"#C71585",midnightblue:"#191970",mintcream:"#F5FFFA",mistyrose:"#FFE4E1",moccasin:"#FFE4B5",navajowhite:"#FFDEAD",navy:"#000080",oldlace:"#FDF5E6",olive:"#808000",olivedrab:"#6B8E23",orange:"#FFA500",orangered:"#FF4500",orchid:"#DA70D6",palegoldenrod:"#EEE8AA",palegreen:"#98FB98",paleturquoise:"#AFEEEE",palevioletred:"#DB7093",papayawhip:"#FFEFD5",peachpuff:"#FFDAB9",peru:"#CD853F",pink:"#FFC0CB",plum:"#DDA0DD",powderblue:"#B0E0E6",purple:"#800080",rebeccapurple:"#663399",red:"#FF0000",rosybrown:"#BC8F8F",royalblue:"#4169E1",saddlebrown:"#8B4513",salmon:"#FA8072",sandybrown:"#F4A460",seagreen:"#2E8B57",seashell:"#FFF5EE",sienna:"#A0522D",silver:"#C0C0C0",skyblue:"#87CEEB",slateblue:"#6A5ACD",slategray:"#708090",slategrey:"#708090",snow:"#FFFAFA",springgreen:"#00FF7F",steelblue:"#4682B4",tan:"#D2B48C",teal:"#008080",thistle:"#D8BFD8",tomato:"#FF6347",turquoise:"#40E0D0",violet:"#EE82EE",wheat:"#F5DEB3",white:"#FFFFFF",whitesmoke:"#F5F5F5",yellow:"#FFFF00",yellowgreen:"#9ACD32"},s.Color.fromRgb=function(i){return a.fromSource(a.sourceFromRgb(i))},s.Color.sourceFromRgb=function(i){var r=i.match(a.reRGBa);if(r){var c=parseInt(r[1],10)/(/%$/.test(r[1])?100:1)*(/%$/.test(r[1])?255:1),p=parseInt(r[2],10)/(/%$/.test(r[2])?100:1)*(/%$/.test(r[2])?255:1),f=parseInt(r[3],10)/(/%$/.test(r[3])?100:1)*(/%$/.test(r[3])?255:1);return[parseInt(c,10),parseInt(p,10),parseInt(f,10),r[4]?parseFloat(r[4]):1]}},s.Color.fromRgba=a.fromRgb,s.Color.fromHsl=function(i){return a.fromSource(a.sourceFromHsl(i))},s.Color.sourceFromHsl=function(i){var r=i.match(a.reHSLa);if(r){var c,p,f,d=(parseFloat(r[1])%360+360)%360/360,_=parseFloat(r[2])/(/%$/.test(r[2])?100:1),w=parseFloat(r[3])/(/%$/.test(r[3])?100:1);if(_===0)c=p=f=w;else{var T=w<=.5?w*(_+1):w+_-w*_,x=2*w-T;c=u(x,T,d+1/3),p=u(x,T,d),f=u(x,T,d-1/3)}return[Math.round(255*c),Math.round(255*p),Math.round(255*f),r[4]?parseFloat(r[4]):1]}},s.Color.fromHsla=a.fromHsl,s.Color.fromHex=function(i){return a.fromSource(a.sourceFromHex(i))},s.Color.sourceFromHex=function(i){if(i.match(a.reHex)){var r=i.slice(i.indexOf("#")+1),c=r.length===3||r.length===4,p=r.length===8||r.length===4,f=c?r.charAt(0)+r.charAt(0):r.substring(0,2),d=c?r.charAt(1)+r.charAt(1):r.substring(2,4),_=c?r.charAt(2)+r.charAt(2):r.substring(4,6),w=p?c?r.charAt(3)+r.charAt(3):r.substring(6,8):"FF";return[parseInt(f,16),parseInt(d,16),parseInt(_,16),parseFloat((parseInt(w,16)/255).toFixed(2))]}},s.Color.fromSource=function(i){var r=new a;return r.setSource(i),r})}(e),function(l){var s=l.fabric||(l.fabric={}),a=["e","se","s","sw","w","nw","n","ne","e"],u=["ns","nesw","ew","nwse"],i={},r="left",c="top",p="right",f="bottom",d="center",_={top:f,bottom:c,left:p,right:r,center:d},w=s.util.radiansToDegrees,T=Math.sign||function(P){return(P>0)-(P<0)||+P};function x(P,M){var U=P.angle+w(Math.atan2(M.y,M.x))+360;return Math.round(U%360/45)}function b(P,M){var U=M.transform.target,V=U.canvas,H=s.util.object.clone(M);H.target=U,V&&V.fire("object:"+P,H),U.fire(P,M)}function F(P,M){var U=M.canvas,V=P[U.uniScaleKey];return U.uniformScaling&&!V||!U.uniformScaling&&V}function B(P){return P.originX===d&&P.originY===d}function z(P,M,U){var V=P.lockScalingX,H=P.lockScalingY;return!((!V||!H)&&(M||!V&&!H||!U)&&(!V||M!=="x")&&(!H||M!=="y"))}function $(P,M,U,V){return{e:P,transform:M,pointer:{x:U,y:V}}}function Q(P){return function(M,U,V,H){var Z=U.target,ee=Z.getCenterPoint(),re=Z.translateToOriginPoint(ee,U.originX,U.originY),ie=P(M,U,V,H);return Z.setPositionByOrigin(re,U.originX,U.originY),ie}}function q(P,M){return function(U,V,H,Z){var ee=M(U,V,H,Z);return ee&&b(P,$(U,V,H,Z)),ee}}function O(P,M,U,V,H){var Z=P.target,ee=Z.controls[P.corner],re=Z.canvas.getZoom(),ie=Z.padding/re,se=Z.toLocalPoint(new s.Point(V,H),M,U);return se.x>=ie&&(se.x-=ie),se.x<=-ie&&(se.x+=ie),se.y>=ie&&(se.y-=ie),se.y<=ie&&(se.y+=ie),se.x-=ee.offsetX,se.y-=ee.offsetY,se}function A(P){return P.flipX!==P.flipY}function D(P,M,U,V,H){if(P[M]!==0){var Z=H/P._getTransformedDimensions()[V]*P[U];P.set(U,Z)}}function k(P,M,U,V){var H,Z=M.target,ee=Z._getTransformedDimensions(0,Z.skewY),re=O(M,M.originX,M.originY,U,V),ie=Math.abs(2*re.x)-ee.x,se=Z.skewX;ie<2?H=0:(H=w(Math.atan2(ie/Z.scaleX,ee.y/Z.scaleY)),M.originX===r&&M.originY===f&&(H=-H),M.originX===p&&M.originY===c&&(H=-H),A(Z)&&(H=-H));var oe=se!==H;if(oe){var ce=Z._getTransformedDimensions().y;Z.set("skewX",H),D(Z,"skewY","scaleY","y",ce)}return oe}function G(P,M,U,V){var H,Z=M.target,ee=Z._getTransformedDimensions(Z.skewX,0),re=O(M,M.originX,M.originY,U,V),ie=Math.abs(2*re.y)-ee.y,se=Z.skewY;ie<2?H=0:(H=w(Math.atan2(ie/Z.scaleY,ee.x/Z.scaleX)),M.originX===r&&M.originY===f&&(H=-H),M.originX===p&&M.originY===c&&(H=-H),A(Z)&&(H=-H));var oe=se!==H;if(oe){var ce=Z._getTransformedDimensions().x;Z.set("skewY",H),D(Z,"skewX","scaleX","x",ce)}return oe}function W(P,M,U,V,H){H=H||{};var Z,ee,re,ie,se,oe,ce=M.target,me=ce.lockScalingX,fe=ce.lockScalingY,Ae=H.by,Ne=F(P,ce),mt=z(ce,Ae,Ne),et=M.gestureScale;if(mt)return!1;if(et)ee=M.scaleX*et,re=M.scaleY*et;else{if(Z=O(M,M.originX,M.originY,U,V),se=Ae!=="y"?T(Z.x):1,oe=Ae!=="x"?T(Z.y):1,M.signX||(M.signX=se),M.signY||(M.signY=oe),ce.lockScalingFlip&&(M.signX!==se||M.signY!==oe))return!1;if(ie=ce._getTransformedDimensions(),Ne&&!Ae){var at=Math.abs(Z.x)+Math.abs(Z.y),Ke=M.original,Pt=at/(Math.abs(ie.x*Ke.scaleX/ce.scaleX)+Math.abs(ie.y*Ke.scaleY/ce.scaleY));ee=Ke.scaleX*Pt,re=Ke.scaleY*Pt}else ee=Math.abs(Z.x*ce.scaleX/ie.x),re=Math.abs(Z.y*ce.scaleY/ie.y);B(M)&&(ee*=2,re*=2),M.signX!==se&&Ae!=="y"&&(M.originX=_[M.originX],ee*=-1,M.signX=se),M.signY!==oe&&Ae!=="x"&&(M.originY=_[M.originY],re*=-1,M.signY=oe)}var Vn=ce.scaleX,cn=ce.scaleY;return Ae?(Ae==="x"&&ce.set("scaleX",ee),Ae==="y"&&ce.set("scaleY",re)):(!me&&ce.set("scaleX",ee),!fe&&ce.set("scaleY",re)),Vn!==ce.scaleX||cn!==ce.scaleY}i.scaleCursorStyleHandler=function(P,M,U){var V=F(P,U),H="";if(M.x!==0&&M.y===0?H="x":M.x===0&&M.y!==0&&(H="y"),z(U,H,V))return"not-allowed";var Z=x(U,M);return a[Z]+"-resize"},i.skewCursorStyleHandler=function(P,M,U){var V="not-allowed";if(M.x!==0&&U.lockSkewingY||M.y!==0&&U.lockSkewingX)return V;var H=x(U,M)%4;return u[H]+"-resize"},i.scaleSkewCursorStyleHandler=function(P,M,U){return P[U.canvas.altActionKey]?i.skewCursorStyleHandler(P,M,U):i.scaleCursorStyleHandler(P,M,U)},i.rotationWithSnapping=q("rotating",Q(function(P,M,U,V){var H=M,Z=H.target,ee=Z.translateToOriginPoint(Z.getCenterPoint(),H.originX,H.originY);if(Z.lockRotation)return!1;var re,ie=Math.atan2(H.ey-ee.y,H.ex-ee.x),se=Math.atan2(V-ee.y,U-ee.x),oe=w(se-ie+H.theta);if(Z.snapAngle>0){var ce=Z.snapAngle,me=Z.snapThreshold||ce,fe=Math.ceil(oe/ce)*ce,Ae=Math.floor(oe/ce)*ce;Math.abs(oe-Ae)<me?oe=Ae:Math.abs(oe-fe)<me&&(oe=fe)}return oe<0&&(oe=360+oe),oe%=360,re=Z.angle!==oe,Z.angle=oe,re})),i.scalingEqually=q("scaling",Q(function(P,M,U,V){return W(P,M,U,V)})),i.scalingX=q("scaling",Q(function(P,M,U,V){return W(P,M,U,V,{by:"x"})})),i.scalingY=q("scaling",Q(function(P,M,U,V){return W(P,M,U,V,{by:"y"})})),i.scalingYOrSkewingX=function(P,M,U,V){return P[M.target.canvas.altActionKey]?i.skewHandlerX(P,M,U,V):i.scalingY(P,M,U,V)},i.scalingXOrSkewingY=function(P,M,U,V){return P[M.target.canvas.altActionKey]?i.skewHandlerY(P,M,U,V):i.scalingX(P,M,U,V)},i.changeWidth=q("resizing",Q(function(P,M,U,V){var H=M.target,Z=O(M,M.originX,M.originY,U,V),ee=H.strokeWidth/(H.strokeUniform?H.scaleX:1),re=B(M)?2:1,ie=H.width,se=Math.abs(Z.x*re/H.scaleX)-ee;return H.set("width",Math.max(se,0)),ie!==se})),i.skewHandlerX=function(P,M,U,V){var H,Z=M.target,ee=Z.skewX,re=M.originY;return!Z.lockSkewingX&&(ee===0?H=O(M,d,d,U,V).x>0?r:p:(ee>0&&(H=re===c?r:p),ee<0&&(H=re===c?p:r),A(Z)&&(H=H===r?p:r)),M.originX=H,q("skewing",Q(k))(P,M,U,V))},i.skewHandlerY=function(P,M,U,V){var H,Z=M.target,ee=Z.skewY,re=M.originX;return!Z.lockSkewingY&&(ee===0?H=O(M,d,d,U,V).y>0?c:f:(ee>0&&(H=re===r?c:f),ee<0&&(H=re===r?f:c),A(Z)&&(H=H===c?f:c)),M.originY=H,q("skewing",Q(G))(P,M,U,V))},i.dragHandler=function(P,M,U,V){var H=M.target,Z=U-M.offsetX,ee=V-M.offsetY,re=!H.get("lockMovementX")&&H.left!==Z,ie=!H.get("lockMovementY")&&H.top!==ee;return re&&H.set("left",Z),ie&&H.set("top",ee),(re||ie)&&b("moving",$(P,M,U,V)),re||ie},i.scaleOrSkewActionName=function(P,M,U){var V=P[U.canvas.altActionKey];return M.x===0?V?"skewX":"scaleY":M.y===0?V?"skewY":"scaleX":void 0},i.rotationStyleHandler=function(P,M,U){return U.lockRotation?"not-allowed":M.cursorStyle},i.fireEvent=b,i.wrapWithFixedAnchor=Q,i.wrapWithFireEvent=q,i.getLocalPoint=O,s.controlsUtils=i}(e),function(l){var s=l.fabric||(l.fabric={}),a=s.util.degreesToRadians,u=s.controlsUtils;u.renderCircleControl=function(i,r,c,p,f){p=p||{};var d,_=this.sizeX||p.cornerSize||f.cornerSize,w=this.sizeY||p.cornerSize||f.cornerSize,T=p.transparentCorners!==void 0?p.transparentCorners:f.transparentCorners,x=T?"stroke":"fill",b=!T&&(p.cornerStrokeColor||f.cornerStrokeColor),F=r,B=c;i.save(),i.fillStyle=p.cornerColor||f.cornerColor,i.strokeStyle=p.cornerStrokeColor||f.cornerStrokeColor,_>w?(d=_,i.scale(1,w/_),B=c*_/w):w>_?(d=w,i.scale(_/w,1),F=r*w/_):d=_,i.lineWidth=1,i.beginPath(),i.arc(F,B,d/2,0,2*Math.PI,!1),i[x](),b&&i.stroke(),i.restore()},u.renderSquareControl=function(i,r,c,p,f){p=p||{};var d=this.sizeX||p.cornerSize||f.cornerSize,_=this.sizeY||p.cornerSize||f.cornerSize,w=p.transparentCorners!==void 0?p.transparentCorners:f.transparentCorners,T=w?"stroke":"fill",x=!w&&(p.cornerStrokeColor||f.cornerStrokeColor),b=d/2,F=_/2;i.save(),i.fillStyle=p.cornerColor||f.cornerColor,i.strokeStyle=p.cornerStrokeColor||f.cornerStrokeColor,i.lineWidth=1,i.translate(r,c),i.rotate(a(f.angle)),i[T+"Rect"](-b,-F,d,_),x&&i.strokeRect(-b,-F,d,_),i.restore()}}(e),function(l){var s=l.fabric||(l.fabric={});s.Control=function(a){for(var u in a)this[u]=a[u]},s.Control.prototype={visible:!0,actionName:"scale",angle:0,x:0,y:0,offsetX:0,offsetY:0,sizeX:null,sizeY:null,touchSizeX:null,touchSizeY:null,cursorStyle:"crosshair",withConnection:!1,actionHandler:function(){},mouseDownHandler:function(){},mouseUpHandler:function(){},getActionHandler:function(){return this.actionHandler},getMouseDownHandler:function(){return this.mouseDownHandler},getMouseUpHandler:function(){return this.mouseUpHandler},cursorStyleHandler:function(a,u){return u.cursorStyle},getActionName:function(a,u){return u.actionName},getVisibility:function(a,u){var i=a._controlsVisibility;return i&&i[u]!==void 0?i[u]:this.visible},setVisibility:function(a){this.visible=a},positionHandler:function(a,u){return s.util.transformPoint({x:this.x*a.x+this.offsetX,y:this.y*a.y+this.offsetY},u)},calcCornerCoords:function(a,u,i,r,c){var p,f,d,_,w=c?this.touchSizeX:this.sizeX,T=c?this.touchSizeY:this.sizeY;if(w&&T&&w!==T){var x=Math.atan2(T,w),b=Math.sqrt(w*w+T*T)/2,F=x-s.util.degreesToRadians(a),B=Math.PI/2-x-s.util.degreesToRadians(a);p=b*s.util.cos(F),f=b*s.util.sin(F),d=b*s.util.cos(B),_=b*s.util.sin(B)}else b=.7071067812*(w&&T?w:u),F=s.util.degreesToRadians(45-a),p=d=b*s.util.cos(F),f=_=b*s.util.sin(F);return{tl:{x:i-_,y:r-d},tr:{x:i+p,y:r-f},bl:{x:i-p,y:r+f},br:{x:i+_,y:r+d}}},render:function(a,u,i,r,c){((r=r||{}).cornerStyle||c.cornerStyle)==="circle"?s.controlsUtils.renderCircleControl.call(this,a,u,i,r,c):s.controlsUtils.renderSquareControl.call(this,a,u,i,r,c)}}}(e),function(){function l(a,u){var i,r,c,p,f=a.getAttribute("style"),d=a.getAttribute("offset")||0;if(d=(d=parseFloat(d)/(/%$/.test(d)?100:1))<0?0:d>1?1:d,f){var _=f.split(/\s*;\s*/);for(_[_.length-1]===""&&_.pop(),p=_.length;p--;){var w=_[p].split(/\s*:\s*/),T=w[0].trim(),x=w[1].trim();T==="stop-color"?i=x:T==="stop-opacity"&&(c=x)}}return i||(i=a.getAttribute("stop-color")||"rgb(0,0,0)"),c||(c=a.getAttribute("stop-opacity")),r=(i=new y.Color(i)).getAlpha(),c=isNaN(parseFloat(c))?1:parseFloat(c),c*=r*u,{offset:d,color:i.toRgb(),opacity:c}}var s=y.util.object.clone;y.Gradient=y.util.createClass({offsetX:0,offsetY:0,gradientTransform:null,gradientUnits:"pixels",type:"linear",initialize:function(a){a||(a={}),a.coords||(a.coords={});var u,i=this;Object.keys(a).forEach(function(r){i[r]=a[r]}),this.id?this.id+="_"+y.Object.__uid++:this.id=y.Object.__uid++,u={x1:a.coords.x1||0,y1:a.coords.y1||0,x2:a.coords.x2||0,y2:a.coords.y2||0},this.type==="radial"&&(u.r1=a.coords.r1||0,u.r2=a.coords.r2||0),this.coords=u,this.colorStops=a.colorStops.slice()},addColorStop:function(a){for(var u in a){var i=new y.Color(a[u]);this.colorStops.push({offset:parseFloat(u),color:i.toRgb(),opacity:i.getAlpha()})}return this},toObject:function(a){var u={type:this.type,coords:this.coords,colorStops:this.colorStops,offsetX:this.offsetX,offsetY:this.offsetY,gradientUnits:this.gradientUnits,gradientTransform:this.gradientTransform?this.gradientTransform.concat():this.gradientTransform};return y.util.populateWithProperties(this,u,a),u},toSVG:function(a,u){var i,r,c,p,f=s(this.coords,!0),d=(u=u||{},s(this.colorStops,!0)),_=f.r1>f.r2,w=this.gradientTransform?this.gradientTransform.concat():y.iMatrix.concat(),T=-this.offsetX,x=-this.offsetY,b=!!u.additionalTransform,F=this.gradientUnits==="pixels"?"userSpaceOnUse":"objectBoundingBox";if(d.sort(function(Q,q){return Q.offset-q.offset}),F==="objectBoundingBox"?(T/=a.width,x/=a.height):(T+=a.width/2,x+=a.height/2),a.type==="path"&&this.gradientUnits!=="percentage"&&(T-=a.pathOffset.x,x-=a.pathOffset.y),w[4]-=T,w[5]-=x,p='id="SVGID_'+this.id+'" gradientUnits="'+F+'"',p+=' gradientTransform="'+(b?u.additionalTransform+" ":"")+y.util.matrixToSVG(w)+'" ',this.type==="linear"?c=["<linearGradient ",p,' x1="',f.x1,'" y1="',f.y1,'" x2="',f.x2,'" y2="',f.y2,`">
`]:this.type==="radial"&&(c=["<radialGradient ",p,' cx="',_?f.x1:f.x2,'" cy="',_?f.y1:f.y2,'" r="',_?f.r1:f.r2,'" fx="',_?f.x2:f.x1,'" fy="',_?f.y2:f.y1,`">
`]),this.type==="radial"){if(_)for((d=d.concat()).reverse(),i=0,r=d.length;i<r;i++)d[i].offset=1-d[i].offset;var B=Math.min(f.r1,f.r2);if(B>0){var z=B/Math.max(f.r1,f.r2);for(i=0,r=d.length;i<r;i++)d[i].offset+=z*(1-d[i].offset)}}for(i=0,r=d.length;i<r;i++){var $=d[i];c.push("<stop ",'offset="',100*$.offset+"%",'" style="stop-color:',$.color,$.opacity!==void 0?";stop-opacity: "+$.opacity:";",`"/>
`)}return c.push(this.type==="linear"?`</linearGradient>
`:`</radialGradient>
`),c.join("")},toLive:function(a){var u,i,r,c=y.util.object.clone(this.coords);if(this.type){for(this.type==="linear"?u=a.createLinearGradient(c.x1,c.y1,c.x2,c.y2):this.type==="radial"&&(u=a.createRadialGradient(c.x1,c.y1,c.r1,c.x2,c.y2,c.r2)),i=0,r=this.colorStops.length;i<r;i++){var p=this.colorStops[i].color,f=this.colorStops[i].opacity,d=this.colorStops[i].offset;f!==void 0&&(p=new y.Color(p).setAlpha(f).toRgba()),u.addColorStop(d,p)}return u}}}),y.util.object.extend(y.Gradient,{fromElement:function(a,u,i,r){var c=parseFloat(i)/(/%$/.test(i)?100:1);c=c<0?0:c>1?1:c,isNaN(c)&&(c=1);var p,f,d,_,w=a.getElementsByTagName("stop"),T=a.getAttribute("gradientUnits")==="userSpaceOnUse"?"pixels":"percentage",x=a.getAttribute("gradientTransform")||"",b=[],F=0,B=0;for(a.nodeName==="linearGradient"||a.nodeName==="LINEARGRADIENT"?(p="linear",f=function(z){return{x1:z.getAttribute("x1")||0,y1:z.getAttribute("y1")||0,x2:z.getAttribute("x2")||"100%",y2:z.getAttribute("y2")||0}}(a)):(p="radial",f=function(z){return{x1:z.getAttribute("fx")||z.getAttribute("cx")||"50%",y1:z.getAttribute("fy")||z.getAttribute("cy")||"50%",r1:0,x2:z.getAttribute("cx")||"50%",y2:z.getAttribute("cy")||"50%",r2:z.getAttribute("r")||"50%"}}(a)),d=w.length;d--;)b.push(l(w[d],c));return _=y.parseTransformAttribute(x),function(z,$,Q,q){var O,A;Object.keys($).forEach(function(D){(O=$[D])==="Infinity"?A=1:O==="-Infinity"?A=0:(A=parseFloat($[D],10),typeof O=="string"&&/^(\d+\.\d+)%|(\d+)%$/.test(O)&&(A*=.01,q==="pixels"&&(D!=="x1"&&D!=="x2"&&D!=="r2"||(A*=Q.viewBoxWidth||Q.width),D!=="y1"&&D!=="y2"||(A*=Q.viewBoxHeight||Q.height)))),$[D]=A})}(0,f,r,T),T==="pixels"&&(F=-u.left,B=-u.top),new y.Gradient({id:a.getAttribute("id"),type:p,coords:f,colorStops:b,gradientUnits:T,gradientTransform:_,offsetX:F,offsetY:B})}})}(),J=y.util.toFixed,y.Pattern=y.util.createClass({repeat:"repeat",offsetX:0,offsetY:0,crossOrigin:"",patternTransform:null,initialize:function(l,s){if(l||(l={}),this.id=y.Object.__uid++,this.setOptions(l),!l.source||l.source&&typeof l.source!="string")s&&s(this);else{var a=this;this.source=y.util.createImage(),y.util.loadImage(l.source,function(u,i){a.source=u,s&&s(a,i)},null,this.crossOrigin)}},toObject:function(l){var s,a,u=y.Object.NUM_FRACTION_DIGITS;return typeof this.source.src=="string"?s=this.source.src:typeof this.source=="object"&&this.source.toDataURL&&(s=this.source.toDataURL()),a={type:"pattern",source:s,repeat:this.repeat,crossOrigin:this.crossOrigin,offsetX:J(this.offsetX,u),offsetY:J(this.offsetY,u),patternTransform:this.patternTransform?this.patternTransform.concat():null},y.util.populateWithProperties(this,a,l),a},toSVG:function(l){var s=typeof this.source=="function"?this.source():this.source,a=s.width/l.width,u=s.height/l.height,i=this.offsetX/l.width,r=this.offsetY/l.height,c="";return this.repeat!=="repeat-x"&&this.repeat!=="no-repeat"||(u=1,r&&(u+=Math.abs(r))),this.repeat!=="repeat-y"&&this.repeat!=="no-repeat"||(a=1,i&&(a+=Math.abs(i))),s.src?c=s.src:s.toDataURL&&(c=s.toDataURL()),'<pattern id="SVGID_'+this.id+'" x="'+i+'" y="'+r+'" width="'+a+'" height="'+u+`">
<image x="0" y="0" width="`+s.width+'" height="'+s.height+'" xlink:href="'+c+`"></image>
</pattern>
`},setOptions:function(l){for(var s in l)this[s]=l[s]},toLive:function(l){var s=this.source;return!s||s.src!==void 0&&(!s.complete||s.naturalWidth===0||s.naturalHeight===0)?"":l.createPattern(s,this.repeat)}}),function(l){var s=l.fabric||(l.fabric={}),a=s.util.toFixed;s.Shadow?s.warn("fabric.Shadow is already defined."):(s.Shadow=s.util.createClass({color:"rgb(0,0,0)",blur:0,offsetX:0,offsetY:0,affectStroke:!1,includeDefaultValues:!0,nonScaling:!1,initialize:function(u){for(var i in typeof u=="string"&&(u=this._parseShadow(u)),u)this[i]=u[i];this.id=s.Object.__uid++},_parseShadow:function(u){var i=u.trim(),r=s.Shadow.reOffsetsAndBlur.exec(i)||[];return{color:(i.replace(s.Shadow.reOffsetsAndBlur,"")||"rgb(0,0,0)").trim(),offsetX:parseFloat(r[1],10)||0,offsetY:parseFloat(r[2],10)||0,blur:parseFloat(r[3],10)||0}},toString:function(){return[this.offsetX,this.offsetY,this.blur,this.color].join("px ")},toSVG:function(u){var i=40,r=40,c=s.Object.NUM_FRACTION_DIGITS,p=s.util.rotateVector({x:this.offsetX,y:this.offsetY},s.util.degreesToRadians(-u.angle)),f=new s.Color(this.color);return u.width&&u.height&&(i=100*a((Math.abs(p.x)+this.blur)/u.width,c)+20,r=100*a((Math.abs(p.y)+this.blur)/u.height,c)+20),u.flipX&&(p.x*=-1),u.flipY&&(p.y*=-1),'<filter id="SVGID_'+this.id+'" y="-'+r+'%" height="'+(100+2*r)+'%" x="-'+i+'%" width="'+(100+2*i)+`%" >
	<feGaussianBlur in="SourceAlpha" stdDeviation="`+a(this.blur?this.blur/2:0,c)+`"></feGaussianBlur>
	<feOffset dx="`+a(p.x,c)+'" dy="'+a(p.y,c)+`" result="oBlur" ></feOffset>
	<feFlood flood-color="`+f.toRgb()+'" flood-opacity="'+f.getAlpha()+`"/>
	<feComposite in2="oBlur" operator="in" />
	<feMerge>
		<feMergeNode></feMergeNode>
		<feMergeNode in="SourceGraphic"></feMergeNode>
	</feMerge>
</filter>
`},toObject:function(){if(this.includeDefaultValues)return{color:this.color,blur:this.blur,offsetX:this.offsetX,offsetY:this.offsetY,affectStroke:this.affectStroke,nonScaling:this.nonScaling};var u={},i=s.Shadow.prototype;return["color","blur","offsetX","offsetY","affectStroke","nonScaling"].forEach(function(r){this[r]!==i[r]&&(u[r]=this[r])},this),u}}),s.Shadow.reOffsetsAndBlur=/(?:\s|^)(-?\d+(?:\.\d*)?(?:px)?(?:\s?|$))?(-?\d+(?:\.\d*)?(?:px)?(?:\s?|$))?(\d+(?:\.\d*)?(?:px)?)?(?:\s?|$)(?:$|\s)/)}(e),function(){if(y.StaticCanvas)y.warn("fabric.StaticCanvas is already defined.");else{var l=y.util.object.extend,s=y.util.getElementOffset,a=y.util.removeFromArray,u=y.util.toFixed,i=y.util.transformPoint,r=y.util.invertTransform,c=y.util.getNodeCanvas,p=y.util.createCanvasElement,f=new Error("Could not initialize `canvas` element");y.StaticCanvas=y.util.createClass(y.CommonMethods,{initialize:function(d,_){_||(_={}),this.renderAndResetBound=this.renderAndReset.bind(this),this.requestRenderAllBound=this.requestRenderAll.bind(this),this._initStatic(d,_)},backgroundColor:"",backgroundImage:null,overlayColor:"",overlayImage:null,includeDefaultValues:!0,stateful:!1,renderOnAddRemove:!0,controlsAboveOverlay:!1,allowTouchScrolling:!1,imageSmoothingEnabled:!0,viewportTransform:y.iMatrix.concat(),backgroundVpt:!0,overlayVpt:!0,enableRetinaScaling:!0,vptCoords:{},skipOffscreen:!0,clipPath:void 0,_initStatic:function(d,_){var w=this.requestRenderAllBound;this._objects=[],this._createLowerCanvas(d),this._initOptions(_),this.interactive||this._initRetinaScaling(),_.overlayImage&&this.setOverlayImage(_.overlayImage,w),_.backgroundImage&&this.setBackgroundImage(_.backgroundImage,w),_.backgroundColor&&this.setBackgroundColor(_.backgroundColor,w),_.overlayColor&&this.setOverlayColor(_.overlayColor,w),this.calcOffset()},_isRetinaScaling:function(){return y.devicePixelRatio>1&&this.enableRetinaScaling},getRetinaScaling:function(){return this._isRetinaScaling()?Math.max(1,y.devicePixelRatio):1},_initRetinaScaling:function(){if(this._isRetinaScaling()){var d=y.devicePixelRatio;this.__initRetinaScaling(d,this.lowerCanvasEl,this.contextContainer),this.upperCanvasEl&&this.__initRetinaScaling(d,this.upperCanvasEl,this.contextTop)}},__initRetinaScaling:function(d,_,w){_.setAttribute("width",this.width*d),_.setAttribute("height",this.height*d),w.scale(d,d)},calcOffset:function(){return this._offset=s(this.lowerCanvasEl),this},setOverlayImage:function(d,_,w){return this.__setBgOverlayImage("overlayImage",d,_,w)},setBackgroundImage:function(d,_,w){return this.__setBgOverlayImage("backgroundImage",d,_,w)},setOverlayColor:function(d,_){return this.__setBgOverlayColor("overlayColor",d,_)},setBackgroundColor:function(d,_){return this.__setBgOverlayColor("backgroundColor",d,_)},__setBgOverlayImage:function(d,_,w,T){return typeof _=="string"?y.util.loadImage(_,function(x,b){if(x){var F=new y.Image(x,T);this[d]=F,F.canvas=this}w&&w(x,b)},this,T&&T.crossOrigin):(T&&_.setOptions(T),this[d]=_,_&&(_.canvas=this),w&&w(_,!1)),this},__setBgOverlayColor:function(d,_,w){return this[d]=_,this._initGradient(_,d),this._initPattern(_,d,w),this},_createCanvasElement:function(){var d=p();if(!d||(d.style||(d.style={}),d.getContext===void 0))throw f;return d},_initOptions:function(d){var _=this.lowerCanvasEl;this._setOptions(d),this.width=this.width||parseInt(_.width,10)||0,this.height=this.height||parseInt(_.height,10)||0,this.lowerCanvasEl.style&&(_.width=this.width,_.height=this.height,_.style.width=this.width+"px",_.style.height=this.height+"px",this.viewportTransform=this.viewportTransform.slice())},_createLowerCanvas:function(d){d&&d.getContext?this.lowerCanvasEl=d:this.lowerCanvasEl=y.util.getById(d)||this._createCanvasElement(),y.util.addClass(this.lowerCanvasEl,"lower-canvas"),this._originalCanvasStyle=this.lowerCanvasEl.style,this.interactive&&this._applyCanvasStyle(this.lowerCanvasEl),this.contextContainer=this.lowerCanvasEl.getContext("2d")},getWidth:function(){return this.width},getHeight:function(){return this.height},setWidth:function(d,_){return this.setDimensions({width:d},_)},setHeight:function(d,_){return this.setDimensions({height:d},_)},setDimensions:function(d,_){var w;for(var T in _=_||{},d)w=d[T],_.cssOnly||(this._setBackstoreDimension(T,d[T]),w+="px",this.hasLostContext=!0),_.backstoreOnly||this._setCssDimension(T,w);return this._isCurrentlyDrawing&&this.freeDrawingBrush&&this.freeDrawingBrush._setBrushStyles(this.contextTop),this._initRetinaScaling(),this.calcOffset(),_.cssOnly||this.requestRenderAll(),this},_setBackstoreDimension:function(d,_){return this.lowerCanvasEl[d]=_,this.upperCanvasEl&&(this.upperCanvasEl[d]=_),this.cacheCanvasEl&&(this.cacheCanvasEl[d]=_),this[d]=_,this},_setCssDimension:function(d,_){return this.lowerCanvasEl.style[d]=_,this.upperCanvasEl&&(this.upperCanvasEl.style[d]=_),this.wrapperEl&&(this.wrapperEl.style[d]=_),this},getZoom:function(){return this.viewportTransform[0]},setViewportTransform:function(d){var _,w,T,x=this._activeObject,b=this.backgroundImage,F=this.overlayImage;for(this.viewportTransform=d,w=0,T=this._objects.length;w<T;w++)(_=this._objects[w]).group||_.setCoords(!0);return x&&x.setCoords(),b&&b.setCoords(!0),F&&F.setCoords(!0),this.calcViewportBoundaries(),this.renderOnAddRemove&&this.requestRenderAll(),this},zoomToPoint:function(d,_){var w=d,T=this.viewportTransform.slice(0);d=i(d,r(this.viewportTransform)),T[0]=_,T[3]=_;var x=i(d,T);return T[4]+=w.x-x.x,T[5]+=w.y-x.y,this.setViewportTransform(T)},setZoom:function(d){return this.zoomToPoint(new y.Point(0,0),d),this},absolutePan:function(d){var _=this.viewportTransform.slice(0);return _[4]=-d.x,_[5]=-d.y,this.setViewportTransform(_)},relativePan:function(d){return this.absolutePan(new y.Point(-d.x-this.viewportTransform[4],-d.y-this.viewportTransform[5]))},getElement:function(){return this.lowerCanvasEl},_onObjectAdded:function(d){this.stateful&&d.setupState(),d._set("canvas",this),d.setCoords(),this.fire("object:added",{target:d}),d.fire("added")},_onObjectRemoved:function(d){this.fire("object:removed",{target:d}),d.fire("removed"),delete d.canvas},clearContext:function(d){return d.clearRect(0,0,this.width,this.height),this},getContext:function(){return this.contextContainer},clear:function(){return this.remove.apply(this,this.getObjects()),this.backgroundImage=null,this.overlayImage=null,this.backgroundColor="",this.overlayColor="",this._hasITextHandlers&&(this.off("mouse:up",this._mouseUpITextHandler),this._iTextInstances=null,this._hasITextHandlers=!1),this.clearContext(this.contextContainer),this.fire("canvas:cleared"),this.renderOnAddRemove&&this.requestRenderAll(),this},renderAll:function(){var d=this.contextContainer;return this.renderCanvas(d,this._objects),this},renderAndReset:function(){this.isRendering=0,this.renderAll()},requestRenderAll:function(){return this.isRendering||(this.isRendering=y.util.requestAnimFrame(this.renderAndResetBound)),this},calcViewportBoundaries:function(){var d={},_=this.width,w=this.height,T=r(this.viewportTransform);return d.tl=i({x:0,y:0},T),d.br=i({x:_,y:w},T),d.tr=new y.Point(d.br.x,d.tl.y),d.bl=new y.Point(d.tl.x,d.br.y),this.vptCoords=d,d},cancelRequestedRender:function(){this.isRendering&&(y.util.cancelAnimFrame(this.isRendering),this.isRendering=0)},renderCanvas:function(d,_){var w=this.viewportTransform,T=this.clipPath;this.cancelRequestedRender(),this.calcViewportBoundaries(),this.clearContext(d),y.util.setImageSmoothing(d,this.imageSmoothingEnabled),this.fire("before:render",{ctx:d}),this._renderBackground(d),d.save(),d.transform(w[0],w[1],w[2],w[3],w[4],w[5]),this._renderObjects(d,_),d.restore(),!this.controlsAboveOverlay&&this.interactive&&this.drawControls(d),T&&(T.canvas=this,T.shouldCache(),T._transformDone=!0,T.renderCache({forClipping:!0}),this.drawClipPathOnCanvas(d)),this._renderOverlay(d),this.controlsAboveOverlay&&this.interactive&&this.drawControls(d),this.fire("after:render",{ctx:d})},drawClipPathOnCanvas:function(d){var _=this.viewportTransform,w=this.clipPath;d.save(),d.transform(_[0],_[1],_[2],_[3],_[4],_[5]),d.globalCompositeOperation="destination-in",w.transform(d),d.scale(1/w.zoomX,1/w.zoomY),d.drawImage(w._cacheCanvas,-w.cacheTranslationX,-w.cacheTranslationY),d.restore()},_renderObjects:function(d,_){var w,T;for(w=0,T=_.length;w<T;++w)_[w]&&_[w].render(d)},_renderBackgroundOrOverlay:function(d,_){var w=this[_+"Color"],T=this[_+"Image"],x=this.viewportTransform,b=this[_+"Vpt"];if(w||T){if(w){d.save(),d.beginPath(),d.moveTo(0,0),d.lineTo(this.width,0),d.lineTo(this.width,this.height),d.lineTo(0,this.height),d.closePath(),d.fillStyle=w.toLive?w.toLive(d,this):w,b&&d.transform(x[0],x[1],x[2],x[3],x[4],x[5]),d.transform(1,0,0,1,w.offsetX||0,w.offsetY||0);var F=w.gradientTransform||w.patternTransform;F&&d.transform(F[0],F[1],F[2],F[3],F[4],F[5]),d.fill(),d.restore()}T&&(d.save(),b&&d.transform(x[0],x[1],x[2],x[3],x[4],x[5]),T.render(d),d.restore())}},_renderBackground:function(d){this._renderBackgroundOrOverlay(d,"background")},_renderOverlay:function(d){this._renderBackgroundOrOverlay(d,"overlay")},getCenter:function(){return{top:this.height/2,left:this.width/2}},getCenterPoint:function(){return new y.Point(this.width/2,this.height/2)},centerObjectH:function(d){return this._centerObject(d,new y.Point(this.getCenterPoint().x,d.getCenterPoint().y))},centerObjectV:function(d){return this._centerObject(d,new y.Point(d.getCenterPoint().x,this.getCenterPoint().y))},centerObject:function(d){var _=this.getCenterPoint();return this._centerObject(d,_)},viewportCenterObject:function(d){var _=this.getVpCenter();return this._centerObject(d,_)},viewportCenterObjectH:function(d){var _=this.getVpCenter();return this._centerObject(d,new y.Point(_.x,d.getCenterPoint().y)),this},viewportCenterObjectV:function(d){var _=this.getVpCenter();return this._centerObject(d,new y.Point(d.getCenterPoint().x,_.y))},getVpCenter:function(){var d=this.getCenterPoint(),_=r(this.viewportTransform);return i(d,_)},_centerObject:function(d,_){return d.setPositionByOrigin(_,"center","center"),d.setCoords(),this.renderOnAddRemove&&this.requestRenderAll(),this},toDatalessJSON:function(d){return this.toDatalessObject(d)},toObject:function(d){return this._toObjectMethod("toObject",d)},toDatalessObject:function(d){return this._toObjectMethod("toDatalessObject",d)},_toObjectMethod:function(d,_){var w=this.clipPath,T={version:y.version,objects:this._toObjects(d,_)};return w&&!w.excludeFromExport&&(T.clipPath=this._toObject(this.clipPath,d,_)),l(T,this.__serializeBgOverlay(d,_)),y.util.populateWithProperties(this,T,_),T},_toObjects:function(d,_){return this._objects.filter(function(w){return!w.excludeFromExport}).map(function(w){return this._toObject(w,d,_)},this)},_toObject:function(d,_,w){var T;this.includeDefaultValues||(T=d.includeDefaultValues,d.includeDefaultValues=!1);var x=d[_](w);return this.includeDefaultValues||(d.includeDefaultValues=T),x},__serializeBgOverlay:function(d,_){var w={},T=this.backgroundImage,x=this.overlayImage,b=this.backgroundColor,F=this.overlayColor;return b&&b.toObject?b.excludeFromExport||(w.background=b.toObject(_)):b&&(w.background=b),F&&F.toObject?F.excludeFromExport||(w.overlay=F.toObject(_)):F&&(w.overlay=F),T&&!T.excludeFromExport&&(w.backgroundImage=this._toObject(T,d,_)),x&&!x.excludeFromExport&&(w.overlayImage=this._toObject(x,d,_)),w},svgViewportTransformation:!0,toSVG:function(d,_){d||(d={}),d.reviver=_;var w=[];return this._setSVGPreamble(w,d),this._setSVGHeader(w,d),this.clipPath&&w.push('<g clip-path="url(#'+this.clipPath.clipPathId+`)" >
`),this._setSVGBgOverlayColor(w,"background"),this._setSVGBgOverlayImage(w,"backgroundImage",_),this._setSVGObjects(w,_),this.clipPath&&w.push(`</g>
`),this._setSVGBgOverlayColor(w,"overlay"),this._setSVGBgOverlayImage(w,"overlayImage",_),w.push("</svg>"),w.join("")},_setSVGPreamble:function(d,_){_.suppressPreamble||d.push('<?xml version="1.0" encoding="',_.encoding||"UTF-8",`" standalone="no" ?>
`,'<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN" ',`"http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
`)},_setSVGHeader:function(d,_){var w,T=_.width||this.width,x=_.height||this.height,b='viewBox="0 0 '+this.width+" "+this.height+'" ',F=y.Object.NUM_FRACTION_DIGITS;_.viewBox?b='viewBox="'+_.viewBox.x+" "+_.viewBox.y+" "+_.viewBox.width+" "+_.viewBox.height+'" ':this.svgViewportTransformation&&(w=this.viewportTransform,b='viewBox="'+u(-w[4]/w[0],F)+" "+u(-w[5]/w[3],F)+" "+u(this.width/w[0],F)+" "+u(this.height/w[3],F)+'" '),d.push("<svg ",'xmlns="http://www.w3.org/2000/svg" ','xmlns:xlink="http://www.w3.org/1999/xlink" ','version="1.1" ','width="',T,'" ','height="',x,'" ',b,`xml:space="preserve">
`,"<desc>Created with Fabric.js ",y.version,`</desc>
`,`<defs>
`,this.createSVGFontFacesMarkup(),this.createSVGRefElementsMarkup(),this.createSVGClipPathMarkup(_),`</defs>
`)},createSVGClipPathMarkup:function(d){var _=this.clipPath;return _?(_.clipPathId="CLIPPATH_"+y.Object.__uid++,'<clipPath id="'+_.clipPathId+`" >
`+this.clipPath.toClipPathSVG(d.reviver)+`</clipPath>
`):""},createSVGRefElementsMarkup:function(){var d=this;return["background","overlay"].map(function(_){var w=d[_+"Color"];if(w&&w.toLive){var T=d[_+"Vpt"],x=d.viewportTransform,b={width:d.width/(T?x[0]:1),height:d.height/(T?x[3]:1)};return w.toSVG(b,{additionalTransform:T?y.util.matrixToSVG(x):""})}}).join("")},createSVGFontFacesMarkup:function(){var d,_,w,T,x,b,F,B,z="",$={},Q=y.fontPaths,q=[];for(this._objects.forEach(function A(D){q.push(D),D._objects&&D._objects.forEach(A)}),F=0,B=q.length;F<B;F++)if(_=(d=q[F]).fontFamily,d.type.indexOf("text")!==-1&&!$[_]&&Q[_]&&($[_]=!0,d.styles))for(x in w=d.styles)for(b in T=w[x])!$[_=T[b].fontFamily]&&Q[_]&&($[_]=!0);for(var O in $)z+=[`		@font-face {
`,"			font-family: '",O,`';
`,"			src: url('",Q[O],`');
`,`		}
`].join("");return z&&(z=['	<style type="text/css">',`<![CDATA[
`,z,"]]>",`</style>
`].join("")),z},_setSVGObjects:function(d,_){var w,T,x,b=this._objects;for(T=0,x=b.length;T<x;T++)(w=b[T]).excludeFromExport||this._setSVGObject(d,w,_)},_setSVGObject:function(d,_,w){d.push(_.toSVG(w))},_setSVGBgOverlayImage:function(d,_,w){this[_]&&!this[_].excludeFromExport&&this[_].toSVG&&d.push(this[_].toSVG(w))},_setSVGBgOverlayColor:function(d,_){var w=this[_+"Color"],T=this.viewportTransform,x=this.width,b=this.height;if(w)if(w.toLive){var F=w.repeat,B=y.util.invertTransform(T),z=this[_+"Vpt"]?y.util.matrixToSVG(B):"";d.push('<rect transform="'+z+" translate(",x/2,",",b/2,')"',' x="',w.offsetX-x/2,'" y="',w.offsetY-b/2,'" ','width="',F==="repeat-y"||F==="no-repeat"?w.source.width:x,'" height="',F==="repeat-x"||F==="no-repeat"?w.source.height:b,'" fill="url(#SVGID_'+w.id+')"',`></rect>
`)}else d.push('<rect x="0" y="0" width="100%" height="100%" ','fill="',w,'"',`></rect>
`)},sendToBack:function(d){if(!d)return this;var _,w,T,x=this._activeObject;if(d===x&&d.type==="activeSelection")for(_=(T=x._objects).length;_--;)w=T[_],a(this._objects,w),this._objects.unshift(w);else a(this._objects,d),this._objects.unshift(d);return this.renderOnAddRemove&&this.requestRenderAll(),this},bringToFront:function(d){if(!d)return this;var _,w,T,x=this._activeObject;if(d===x&&d.type==="activeSelection")for(T=x._objects,_=0;_<T.length;_++)w=T[_],a(this._objects,w),this._objects.push(w);else a(this._objects,d),this._objects.push(d);return this.renderOnAddRemove&&this.requestRenderAll(),this},sendBackwards:function(d,_){if(!d)return this;var w,T,x,b,F,B=this._activeObject,z=0;if(d===B&&d.type==="activeSelection")for(F=B._objects,w=0;w<F.length;w++)T=F[w],(x=this._objects.indexOf(T))>0+z&&(b=x-1,a(this._objects,T),this._objects.splice(b,0,T)),z++;else(x=this._objects.indexOf(d))!==0&&(b=this._findNewLowerIndex(d,x,_),a(this._objects,d),this._objects.splice(b,0,d));return this.renderOnAddRemove&&this.requestRenderAll(),this},_findNewLowerIndex:function(d,_,w){var T,x;if(w){for(T=_,x=_-1;x>=0;--x)if(d.intersectsWithObject(this._objects[x])||d.isContainedWithinObject(this._objects[x])||this._objects[x].isContainedWithinObject(d)){T=x;break}}else T=_-1;return T},bringForward:function(d,_){if(!d)return this;var w,T,x,b,F,B=this._activeObject,z=0;if(d===B&&d.type==="activeSelection")for(w=(F=B._objects).length;w--;)T=F[w],(x=this._objects.indexOf(T))<this._objects.length-1-z&&(b=x+1,a(this._objects,T),this._objects.splice(b,0,T)),z++;else(x=this._objects.indexOf(d))!==this._objects.length-1&&(b=this._findNewUpperIndex(d,x,_),a(this._objects,d),this._objects.splice(b,0,d));return this.renderOnAddRemove&&this.requestRenderAll(),this},_findNewUpperIndex:function(d,_,w){var T,x,b;if(w){for(T=_,x=_+1,b=this._objects.length;x<b;++x)if(d.intersectsWithObject(this._objects[x])||d.isContainedWithinObject(this._objects[x])||this._objects[x].isContainedWithinObject(d)){T=x;break}}else T=_+1;return T},moveTo:function(d,_){return a(this._objects,d),this._objects.splice(_,0,d),this.renderOnAddRemove&&this.requestRenderAll()},dispose:function(){return this.isRendering&&(y.util.cancelAnimFrame(this.isRendering),this.isRendering=0),this.forEachObject(function(d){d.dispose&&d.dispose()}),this._objects=[],this.backgroundImage&&this.backgroundImage.dispose&&this.backgroundImage.dispose(),this.backgroundImage=null,this.overlayImage&&this.overlayImage.dispose&&this.overlayImage.dispose(),this.overlayImage=null,this._iTextInstances=null,this.contextContainer=null,this.lowerCanvasEl.classList.remove("lower-canvas"),y.util.setStyle(this.lowerCanvasEl,this._originalCanvasStyle),delete this._originalCanvasStyle,this.lowerCanvasEl.setAttribute("width",this.width),this.lowerCanvasEl.setAttribute("height",this.height),y.util.cleanUpJsdomNode(this.lowerCanvasEl),this.lowerCanvasEl=void 0,this},toString:function(){return"#<fabric.Canvas ("+this.complexity()+"): { objects: "+this._objects.length+" }>"}}),l(y.StaticCanvas.prototype,y.Observable),l(y.StaticCanvas.prototype,y.Collection),l(y.StaticCanvas.prototype,y.DataURLExporter),l(y.StaticCanvas,{EMPTY_JSON:'{"objects": [], "background": "white"}',supports:function(d){var _=p();if(!_||!_.getContext)return null;var w=_.getContext("2d");return w&&d==="setLineDash"?w.setLineDash!==void 0:null}}),y.StaticCanvas.prototype.toJSON=y.StaticCanvas.prototype.toObject,y.isLikelyNode&&(y.StaticCanvas.prototype.createPNGStream=function(){var d=c(this.lowerCanvasEl);return d&&d.createPNGStream()},y.StaticCanvas.prototype.createJPEGStream=function(d){var _=c(this.lowerCanvasEl);return _&&_.createJPEGStream(d)})}}(),y.BaseBrush=y.util.createClass({color:"rgb(0, 0, 0)",width:1,shadow:null,strokeLineCap:"round",strokeLineJoin:"round",strokeMiterLimit:10,strokeDashArray:null,limitedToCanvasSize:!1,_setBrushStyles:function(l){l.strokeStyle=this.color,l.lineWidth=this.width,l.lineCap=this.strokeLineCap,l.miterLimit=this.strokeMiterLimit,l.lineJoin=this.strokeLineJoin,l.setLineDash(this.strokeDashArray||[])},_saveAndTransform:function(l){var s=this.canvas.viewportTransform;l.save(),l.transform(s[0],s[1],s[2],s[3],s[4],s[5])},_setShadow:function(){if(this.shadow){var l=this.canvas,s=this.shadow,a=l.contextTop,u=l.getZoom();l&&l._isRetinaScaling()&&(u*=y.devicePixelRatio),a.shadowColor=s.color,a.shadowBlur=s.blur*u,a.shadowOffsetX=s.offsetX*u,a.shadowOffsetY=s.offsetY*u}},needsFullRender:function(){return new y.Color(this.color).getAlpha()<1||!!this.shadow},_resetShadow:function(){var l=this.canvas.contextTop;l.shadowColor="",l.shadowBlur=l.shadowOffsetX=l.shadowOffsetY=0},_isOutSideCanvas:function(l){return l.x<0||l.x>this.canvas.getWidth()||l.y<0||l.y>this.canvas.getHeight()}}),y.PencilBrush=y.util.createClass(y.BaseBrush,{decimate:.4,drawStraightLine:!1,straightLineKey:"shiftKey",initialize:function(l){this.canvas=l,this._points=[]},needsFullRender:function(){return this.callSuper("needsFullRender")||this._hasStraightLine},_drawSegment:function(l,s,a){var u=s.midPointFrom(a);return l.quadraticCurveTo(s.x,s.y,u.x,u.y),u},onMouseDown:function(l,s){this.canvas._isMainEvent(s.e)&&(this.drawStraightLine=s.e[this.straightLineKey],this._prepareForDrawing(l),this._captureDrawingPath(l),this._render())},onMouseMove:function(l,s){if(this.canvas._isMainEvent(s.e)&&(this.drawStraightLine=s.e[this.straightLineKey],(this.limitedToCanvasSize!==!0||!this._isOutSideCanvas(l))&&this._captureDrawingPath(l)&&this._points.length>1))if(this.needsFullRender())this.canvas.clearContext(this.canvas.contextTop),this._render();else{var a=this._points,u=a.length,i=this.canvas.contextTop;this._saveAndTransform(i),this.oldEnd&&(i.beginPath(),i.moveTo(this.oldEnd.x,this.oldEnd.y)),this.oldEnd=this._drawSegment(i,a[u-2],a[u-1],!0),i.stroke(),i.restore()}},onMouseUp:function(l){return!this.canvas._isMainEvent(l.e)||(this.drawStraightLine=!1,this.oldEnd=void 0,this._finalizeAndAddPath(),!1)},_prepareForDrawing:function(l){var s=new y.Point(l.x,l.y);this._reset(),this._addPoint(s),this.canvas.contextTop.moveTo(s.x,s.y)},_addPoint:function(l){return!(this._points.length>1&&l.eq(this._points[this._points.length-1])||(this.drawStraightLine&&this._points.length>1&&(this._hasStraightLine=!0,this._points.pop()),this._points.push(l),0))},_reset:function(){this._points=[],this._setBrushStyles(this.canvas.contextTop),this._setShadow(),this._hasStraightLine=!1},_captureDrawingPath:function(l){var s=new y.Point(l.x,l.y);return this._addPoint(s)},_render:function(l){var s,a,u=this._points[0],i=this._points[1];if(l=l||this.canvas.contextTop,this._saveAndTransform(l),l.beginPath(),this._points.length===2&&u.x===i.x&&u.y===i.y){var r=this.width/1e3;u=new y.Point(u.x,u.y),i=new y.Point(i.x,i.y),u.x-=r,i.x+=r}for(l.moveTo(u.x,u.y),s=1,a=this._points.length;s<a;s++)this._drawSegment(l,u,i),u=this._points[s],i=this._points[s+1];l.lineTo(u.x,u.y),l.stroke(),l.restore()},convertPointsToSVGPath:function(l){var s=this.width/1e3;return y.util.getSmoothPathFromPoints(l,s)},_isEmptySVGPath:function(l){return y.util.joinPath(l)==="M 0 0 Q 0 0 0 0 L 0 0"},createPath:function(l){var s=new y.Path(l,{fill:null,stroke:this.color,strokeWidth:this.width,strokeLineCap:this.strokeLineCap,strokeMiterLimit:this.strokeMiterLimit,strokeLineJoin:this.strokeLineJoin,strokeDashArray:this.strokeDashArray});return this.shadow&&(this.shadow.affectStroke=!0,s.shadow=new y.Shadow(this.shadow)),s},decimatePoints:function(l,s){if(l.length<=2)return l;var a,u=this.canvas.getZoom(),i=Math.pow(s/u,2),r=l.length-1,c=l[0],p=[c];for(a=1;a<r-1;a++)Math.pow(c.x-l[a].x,2)+Math.pow(c.y-l[a].y,2)>=i&&(c=l[a],p.push(c));return p.push(l[r]),p},_finalizeAndAddPath:function(){this.canvas.contextTop.closePath(),this.decimate&&(this._points=this.decimatePoints(this._points,this.decimate));var l=this.convertPointsToSVGPath(this._points);if(this._isEmptySVGPath(l))this.canvas.requestRenderAll();else{var s=this.createPath(l);this.canvas.clearContext(this.canvas.contextTop),this.canvas.fire("before:path:created",{path:s}),this.canvas.add(s),this.canvas.requestRenderAll(),s.setCoords(),this._resetShadow(),this.canvas.fire("path:created",{path:s})}}}),y.CircleBrush=y.util.createClass(y.BaseBrush,{width:10,initialize:function(l){this.canvas=l,this.points=[]},drawDot:function(l){var s=this.addPoint(l),a=this.canvas.contextTop;this._saveAndTransform(a),this.dot(a,s),a.restore()},dot:function(l,s){l.fillStyle=s.fill,l.beginPath(),l.arc(s.x,s.y,s.radius,0,2*Math.PI,!1),l.closePath(),l.fill()},onMouseDown:function(l){this.points.length=0,this.canvas.clearContext(this.canvas.contextTop),this._setShadow(),this.drawDot(l)},_render:function(){var l,s,a=this.canvas.contextTop,u=this.points;for(this._saveAndTransform(a),l=0,s=u.length;l<s;l++)this.dot(a,u[l]);a.restore()},onMouseMove:function(l){this.limitedToCanvasSize===!0&&this._isOutSideCanvas(l)||(this.needsFullRender()?(this.canvas.clearContext(this.canvas.contextTop),this.addPoint(l),this._render()):this.drawDot(l))},onMouseUp:function(){var l,s,a=this.canvas.renderOnAddRemove;this.canvas.renderOnAddRemove=!1;var u=[];for(l=0,s=this.points.length;l<s;l++){var i=this.points[l],r=new y.Circle({radius:i.radius,left:i.x,top:i.y,originX:"center",originY:"center",fill:i.fill});this.shadow&&(r.shadow=new y.Shadow(this.shadow)),u.push(r)}var c=new y.Group(u);c.canvas=this.canvas,this.canvas.fire("before:path:created",{path:c}),this.canvas.add(c),this.canvas.fire("path:created",{path:c}),this.canvas.clearContext(this.canvas.contextTop),this._resetShadow(),this.canvas.renderOnAddRemove=a,this.canvas.requestRenderAll()},addPoint:function(l){var s=new y.Point(l.x,l.y),a=y.util.getRandomInt(Math.max(0,this.width-20),this.width+20)/2,u=new y.Color(this.color).setAlpha(y.util.getRandomInt(0,100)/100).toRgba();return s.radius=a,s.fill=u,this.points.push(s),s}}),y.SprayBrush=y.util.createClass(y.BaseBrush,{width:10,density:20,dotWidth:1,dotWidthVariance:1,randomOpacity:!1,optimizeOverlapping:!0,initialize:function(l){this.canvas=l,this.sprayChunks=[]},onMouseDown:function(l){this.sprayChunks.length=0,this.canvas.clearContext(this.canvas.contextTop),this._setShadow(),this.addSprayChunk(l),this.render(this.sprayChunkPoints)},onMouseMove:function(l){this.limitedToCanvasSize===!0&&this._isOutSideCanvas(l)||(this.addSprayChunk(l),this.render(this.sprayChunkPoints))},onMouseUp:function(){var l=this.canvas.renderOnAddRemove;this.canvas.renderOnAddRemove=!1;for(var s=[],a=0,u=this.sprayChunks.length;a<u;a++)for(var i=this.sprayChunks[a],r=0,c=i.length;r<c;r++){var p=new y.Rect({width:i[r].width,height:i[r].width,left:i[r].x+1,top:i[r].y+1,originX:"center",originY:"center",fill:this.color});s.push(p)}this.optimizeOverlapping&&(s=this._getOptimizedRects(s));var f=new y.Group(s);this.shadow&&f.set("shadow",new y.Shadow(this.shadow)),this.canvas.fire("before:path:created",{path:f}),this.canvas.add(f),this.canvas.fire("path:created",{path:f}),this.canvas.clearContext(this.canvas.contextTop),this._resetShadow(),this.canvas.renderOnAddRemove=l,this.canvas.requestRenderAll()},_getOptimizedRects:function(l){var s,a,u,i={};for(a=0,u=l.length;a<u;a++)i[s=l[a].left+""+l[a].top]||(i[s]=l[a]);var r=[];for(s in i)r.push(i[s]);return r},render:function(l){var s,a,u=this.canvas.contextTop;for(u.fillStyle=this.color,this._saveAndTransform(u),s=0,a=l.length;s<a;s++){var i=l[s];i.opacity!==void 0&&(u.globalAlpha=i.opacity),u.fillRect(i.x,i.y,i.width,i.width)}u.restore()},_render:function(){var l,s,a=this.canvas.contextTop;for(a.fillStyle=this.color,this._saveAndTransform(a),l=0,s=this.sprayChunks.length;l<s;l++)this.render(this.sprayChunks[l]);a.restore()},addSprayChunk:function(l){this.sprayChunkPoints=[];var s,a,u,i,r=this.width/2;for(i=0;i<this.density;i++){s=y.util.getRandomInt(l.x-r,l.x+r),a=y.util.getRandomInt(l.y-r,l.y+r),u=this.dotWidthVariance?y.util.getRandomInt(Math.max(1,this.dotWidth-this.dotWidthVariance),this.dotWidth+this.dotWidthVariance):this.dotWidth;var c=new y.Point(s,a);c.width=u,this.randomOpacity&&(c.opacity=y.util.getRandomInt(0,100)/100),this.sprayChunkPoints.push(c)}this.sprayChunks.push(this.sprayChunkPoints)}}),y.PatternBrush=y.util.createClass(y.PencilBrush,{getPatternSrc:function(){var l=y.util.createCanvasElement(),s=l.getContext("2d");return l.width=l.height=25,s.fillStyle=this.color,s.beginPath(),s.arc(10,10,10,0,2*Math.PI,!1),s.closePath(),s.fill(),l},getPatternSrcFunction:function(){return String(this.getPatternSrc).replace("this.color",'"'+this.color+'"')},getPattern:function(l){return l.createPattern(this.source||this.getPatternSrc(),"repeat")},_setBrushStyles:function(l){this.callSuper("_setBrushStyles",l),l.strokeStyle=this.getPattern(l)},createPath:function(l){var s=this.callSuper("createPath",l),a=s._getLeftTopCoords().scalarAdd(s.strokeWidth/2);return s.stroke=new y.Pattern({source:this.source||this.getPatternSrcFunction(),offsetX:-a.x,offsetY:-a.y}),s}}),function(){var l=y.util.getPointer,s=y.util.degreesToRadians,a=y.util.isTouchEvent;for(var u in y.Canvas=y.util.createClass(y.StaticCanvas,{initialize:function(i,r){r||(r={}),this.renderAndResetBound=this.renderAndReset.bind(this),this.requestRenderAllBound=this.requestRenderAll.bind(this),this._initStatic(i,r),this._initInteractive(),this._createCacheCanvas()},uniformScaling:!0,uniScaleKey:"shiftKey",centeredScaling:!1,centeredRotation:!1,centeredKey:"altKey",altActionKey:"shiftKey",interactive:!0,selection:!0,selectionKey:"shiftKey",altSelectionKey:null,selectionColor:"rgba(100, 100, 255, 0.3)",selectionDashArray:[],selectionBorderColor:"rgba(255, 255, 255, 0.3)",selectionLineWidth:1,selectionFullyContained:!1,hoverCursor:"move",moveCursor:"move",defaultCursor:"default",freeDrawingCursor:"crosshair",notAllowedCursor:"not-allowed",containerClass:"canvas-container",perPixelTargetFind:!1,targetFindTolerance:0,skipTargetFind:!1,isDrawingMode:!1,preserveObjectStacking:!1,snapAngle:0,snapThreshold:null,stopContextMenu:!1,fireRightClick:!1,fireMiddleClick:!1,targets:[],enablePointerEvents:!1,_hoveredTarget:null,_hoveredTargets:[],_initInteractive:function(){this._currentTransform=null,this._groupSelector=null,this._initWrapperElement(),this._createUpperCanvas(),this._initEventListeners(),this._initRetinaScaling(),this.freeDrawingBrush=y.PencilBrush&&new y.PencilBrush(this),this.calcOffset()},_chooseObjectsToRender:function(){var i,r,c,p=this.getActiveObjects();if(p.length>0&&!this.preserveObjectStacking){r=[],c=[];for(var f=0,d=this._objects.length;f<d;f++)i=this._objects[f],p.indexOf(i)===-1?r.push(i):c.push(i);p.length>1&&(this._activeObject._objects=c),r.push.apply(r,c)}else r=this._objects;return r},renderAll:function(){!this.contextTopDirty||this._groupSelector||this.isDrawingMode||(this.clearContext(this.contextTop),this.contextTopDirty=!1),this.hasLostContext&&(this.renderTopLayer(this.contextTop),this.hasLostContext=!1);var i=this.contextContainer;return this.renderCanvas(i,this._chooseObjectsToRender()),this},renderTopLayer:function(i){i.save(),this.isDrawingMode&&this._isCurrentlyDrawing&&(this.freeDrawingBrush&&this.freeDrawingBrush._render(),this.contextTopDirty=!0),this.selection&&this._groupSelector&&(this._drawSelection(i),this.contextTopDirty=!0),i.restore()},renderTop:function(){var i=this.contextTop;return this.clearContext(i),this.renderTopLayer(i),this.fire("after:render"),this},_normalizePointer:function(i,r){var c=i.calcTransformMatrix(),p=y.util.invertTransform(c),f=this.restorePointerVpt(r);return y.util.transformPoint(f,p)},isTargetTransparent:function(i,r,c){if(i.shouldCache()&&i._cacheCanvas&&i!==this._activeObject){var p=this._normalizePointer(i,{x:r,y:c}),f=Math.max(i.cacheTranslationX+p.x*i.zoomX,0),d=Math.max(i.cacheTranslationY+p.y*i.zoomY,0);return y.util.isTransparent(i._cacheContext,Math.round(f),Math.round(d),this.targetFindTolerance)}var _=this.contextCache,w=i.selectionBackgroundColor,T=this.viewportTransform;return i.selectionBackgroundColor="",this.clearContext(_),_.save(),_.transform(T[0],T[1],T[2],T[3],T[4],T[5]),i.render(_),_.restore(),i.selectionBackgroundColor=w,y.util.isTransparent(_,r,c,this.targetFindTolerance)},_isSelectionKeyPressed:function(i){return Array.isArray(this.selectionKey)?!!this.selectionKey.find(function(r){return i[r]===!0}):i[this.selectionKey]},_shouldClearSelection:function(i,r){var c=this.getActiveObjects(),p=this._activeObject;return!r||r&&p&&c.length>1&&c.indexOf(r)===-1&&p!==r&&!this._isSelectionKeyPressed(i)||r&&!r.evented||r&&!r.selectable&&p&&p!==r},_shouldCenterTransform:function(i,r,c){var p;if(i)return r==="scale"||r==="scaleX"||r==="scaleY"||r==="resizing"?p=this.centeredScaling||i.centeredScaling:r==="rotate"&&(p=this.centeredRotation||i.centeredRotation),p?!c:c},_getOriginFromCorner:function(i,r){var c={x:i.originX,y:i.originY};return r==="ml"||r==="tl"||r==="bl"?c.x="right":r!=="mr"&&r!=="tr"&&r!=="br"||(c.x="left"),r==="tl"||r==="mt"||r==="tr"?c.y="bottom":r!=="bl"&&r!=="mb"&&r!=="br"||(c.y="top"),c},_getActionFromCorner:function(i,r,c,p){if(!r||!i)return"drag";var f=p.controls[r];return f.getActionName(c,f,p)},_setupCurrentTransform:function(i,r,c){if(r){var p=this.getPointer(i),f=r.__corner,d=r.controls[f],_=c&&f?d.getActionHandler(i,r,d):y.controlsUtils.dragHandler,w=this._getActionFromCorner(c,f,i,r),T=this._getOriginFromCorner(r,f),x=i[this.centeredKey],b={target:r,action:w,actionHandler:_,corner:f,scaleX:r.scaleX,scaleY:r.scaleY,skewX:r.skewX,skewY:r.skewY,offsetX:p.x-r.left,offsetY:p.y-r.top,originX:T.x,originY:T.y,ex:p.x,ey:p.y,lastX:p.x,lastY:p.y,theta:s(r.angle),width:r.width*r.scaleX,shiftKey:i.shiftKey,altKey:x,original:y.util.saveObjectTransform(r)};this._shouldCenterTransform(r,w,x)&&(b.originX="center",b.originY="center"),b.original.originX=T.x,b.original.originY=T.y,this._currentTransform=b,this._beforeTransform(i)}},setCursor:function(i){this.upperCanvasEl.style.cursor=i},_drawSelection:function(i){var r=this._groupSelector,c=new y.Point(r.ex,r.ey),p=y.util.transformPoint(c,this.viewportTransform),f=new y.Point(r.ex+r.left,r.ey+r.top),d=y.util.transformPoint(f,this.viewportTransform),_=Math.min(p.x,d.x),w=Math.min(p.y,d.y),T=Math.max(p.x,d.x),x=Math.max(p.y,d.y),b=this.selectionLineWidth/2;this.selectionColor&&(i.fillStyle=this.selectionColor,i.fillRect(_,w,T-_,x-w)),this.selectionLineWidth&&this.selectionBorderColor&&(i.lineWidth=this.selectionLineWidth,i.strokeStyle=this.selectionBorderColor,_+=b,w+=b,T-=b,x-=b,y.Object.prototype._setLineDash.call(this,i,this.selectionDashArray),i.strokeRect(_,w,T-_,x-w))},findTarget:function(i,r){if(!this.skipTargetFind){var c,p,f=this.getPointer(i,!0),d=this._activeObject,_=this.getActiveObjects(),w=a(i),T=_.length>1&&!r||_.length===1;if(this.targets=[],T&&d._findTargetCorner(f,w)||_.length>1&&!r&&d===this._searchPossibleTargets([d],f))return d;if(_.length===1&&d===this._searchPossibleTargets([d],f)){if(!this.preserveObjectStacking)return d;c=d,p=this.targets,this.targets=[]}var x=this._searchPossibleTargets(this._objects,f);return i[this.altSelectionKey]&&x&&c&&x!==c&&(x=c,this.targets=p),x}},_checkTarget:function(i,r,c){if(r&&r.visible&&r.evented&&r.containsPoint(i)&&(!this.perPixelTargetFind&&!r.perPixelTargetFind||r.isEditing||!this.isTargetTransparent(r,c.x,c.y)))return!0},_searchPossibleTargets:function(i,r){for(var c,p,f=i.length;f--;){var d=i[f],_=d.group?this._normalizePointer(d.group,r):r;if(this._checkTarget(_,d,r)){(c=i[f]).subTargetCheck&&c instanceof y.Group&&(p=this._searchPossibleTargets(c._objects,r))&&this.targets.push(p);break}}return c},restorePointerVpt:function(i){return y.util.transformPoint(i,y.util.invertTransform(this.viewportTransform))},getPointer:function(i,r){if(this._absolutePointer&&!r)return this._absolutePointer;if(this._pointer&&r)return this._pointer;var c,p=l(i),f=this.upperCanvasEl,d=f.getBoundingClientRect(),_=d.width||0,w=d.height||0;_&&w||("top"in d&&"bottom"in d&&(w=Math.abs(d.top-d.bottom)),"right"in d&&"left"in d&&(_=Math.abs(d.right-d.left))),this.calcOffset(),p.x=p.x-this._offset.left,p.y=p.y-this._offset.top,r||(p=this.restorePointerVpt(p));var T=this.getRetinaScaling();return T!==1&&(p.x/=T,p.y/=T),c=_===0||w===0?{width:1,height:1}:{width:f.width/_,height:f.height/w},{x:p.x*c.width,y:p.y*c.height}},_createUpperCanvas:function(){var i=this.lowerCanvasEl.className.replace(/\s*lower-canvas\s*/,""),r=this.lowerCanvasEl,c=this.upperCanvasEl;c?c.className="":(c=this._createCanvasElement(),this.upperCanvasEl=c),y.util.addClass(c,"upper-canvas "+i),this.wrapperEl.appendChild(c),this._copyCanvasStyle(r,c),this._applyCanvasStyle(c),this.contextTop=c.getContext("2d")},getTopContext:function(){return this.contextTop},_createCacheCanvas:function(){this.cacheCanvasEl=this._createCanvasElement(),this.cacheCanvasEl.setAttribute("width",this.width),this.cacheCanvasEl.setAttribute("height",this.height),this.contextCache=this.cacheCanvasEl.getContext("2d")},_initWrapperElement:function(){this.wrapperEl=y.util.wrapElement(this.lowerCanvasEl,"div",{class:this.containerClass}),y.util.setStyle(this.wrapperEl,{width:this.width+"px",height:this.height+"px",position:"relative"}),y.util.makeElementUnselectable(this.wrapperEl)},_applyCanvasStyle:function(i){var r=this.width||i.width,c=this.height||i.height;y.util.setStyle(i,{position:"absolute",width:r+"px",height:c+"px",left:0,top:0,"touch-action":this.allowTouchScrolling?"manipulation":"none","-ms-touch-action":this.allowTouchScrolling?"manipulation":"none"}),i.width=r,i.height=c,y.util.makeElementUnselectable(i)},_copyCanvasStyle:function(i,r){r.style.cssText=i.style.cssText},getSelectionContext:function(){return this.contextTop},getSelectionElement:function(){return this.upperCanvasEl},getActiveObject:function(){return this._activeObject},getActiveObjects:function(){var i=this._activeObject;return i?i.type==="activeSelection"&&i._objects?i._objects.slice(0):[i]:[]},_onObjectRemoved:function(i){i===this._activeObject&&(this.fire("before:selection:cleared",{target:i}),this._discardActiveObject(),this.fire("selection:cleared",{target:i}),i.fire("deselected")),i===this._hoveredTarget&&(this._hoveredTarget=null,this._hoveredTargets=[]),this.callSuper("_onObjectRemoved",i)},_fireSelectionEvents:function(i,r){var c=!1,p=this.getActiveObjects(),f=[],d=[];i.forEach(function(_){p.indexOf(_)===-1&&(c=!0,_.fire("deselected",{e:r,target:_}),d.push(_))}),p.forEach(function(_){i.indexOf(_)===-1&&(c=!0,_.fire("selected",{e:r,target:_}),f.push(_))}),i.length>0&&p.length>0?c&&this.fire("selection:updated",{e:r,selected:f,deselected:d}):p.length>0?this.fire("selection:created",{e:r,selected:f}):i.length>0&&this.fire("selection:cleared",{e:r,deselected:d})},setActiveObject:function(i,r){var c=this.getActiveObjects();return this._setActiveObject(i,r),this._fireSelectionEvents(c,r),this},_setActiveObject:function(i,r){return this._activeObject!==i&&!!this._discardActiveObject(r,i)&&!i.onSelect({e:r})&&(this._activeObject=i,!0)},_discardActiveObject:function(i,r){var c=this._activeObject;if(c){if(c.onDeselect({e:i,object:r}))return!1;this._activeObject=null}return!0},discardActiveObject:function(i){var r=this.getActiveObjects(),c=this.getActiveObject();return r.length&&this.fire("before:selection:cleared",{target:c,e:i}),this._discardActiveObject(i),this._fireSelectionEvents(r,i),this},dispose:function(){var i=this.wrapperEl;return this.removeListeners(),i.removeChild(this.upperCanvasEl),i.removeChild(this.lowerCanvasEl),this.contextCache=null,this.contextTop=null,["upperCanvasEl","cacheCanvasEl"].forEach((function(r){y.util.cleanUpJsdomNode(this[r]),this[r]=void 0}).bind(this)),i.parentNode&&i.parentNode.replaceChild(this.lowerCanvasEl,this.wrapperEl),delete this.wrapperEl,y.StaticCanvas.prototype.dispose.call(this),this},clear:function(){return this.discardActiveObject(),this.clearContext(this.contextTop),this.callSuper("clear")},drawControls:function(i){var r=this._activeObject;r&&r._renderControls(i)},_toObject:function(i,r,c){var p=this._realizeGroupTransformOnObject(i),f=this.callSuper("_toObject",i,r,c);return this._unwindGroupTransformOnObject(i,p),f},_realizeGroupTransformOnObject:function(i){if(i.group&&i.group.type==="activeSelection"&&this._activeObject===i.group){var r={};return["angle","flipX","flipY","left","scaleX","scaleY","skewX","skewY","top"].forEach(function(c){r[c]=i[c]}),y.util.addTransformToObject(i,this._activeObject.calcOwnMatrix()),r}return null},_unwindGroupTransformOnObject:function(i,r){r&&i.set(r)},_setSVGObject:function(i,r,c){var p=this._realizeGroupTransformOnObject(r);this.callSuper("_setSVGObject",i,r,c),this._unwindGroupTransformOnObject(r,p)},setViewportTransform:function(i){this.renderOnAddRemove&&this._activeObject&&this._activeObject.isEditing&&this._activeObject.clearContextTop(),y.StaticCanvas.prototype.setViewportTransform.call(this,i)}}),y.StaticCanvas)u!=="prototype"&&(y.Canvas[u]=y.StaticCanvas[u])}(),function(){var l=y.util.addListener,s=y.util.removeListener,a={passive:!1};function u(i,r){return i.button&&i.button===r-1}y.util.object.extend(y.Canvas.prototype,{mainTouchId:null,_initEventListeners:function(){this.removeListeners(),this._bindEvents(),this.addOrRemove(l,"add")},_getEventPrefix:function(){return this.enablePointerEvents?"pointer":"mouse"},addOrRemove:function(i,r){var c=this.upperCanvasEl,p=this._getEventPrefix();i(y.window,"resize",this._onResize),i(c,p+"down",this._onMouseDown),i(c,p+"move",this._onMouseMove,a),i(c,p+"out",this._onMouseOut),i(c,p+"enter",this._onMouseEnter),i(c,"wheel",this._onMouseWheel),i(c,"contextmenu",this._onContextMenu),i(c,"dblclick",this._onDoubleClick),i(c,"dragover",this._onDragOver),i(c,"dragenter",this._onDragEnter),i(c,"dragleave",this._onDragLeave),i(c,"drop",this._onDrop),this.enablePointerEvents||i(c,"touchstart",this._onTouchStart,a),typeof eventjs<"u"&&r in eventjs&&(eventjs[r](c,"gesture",this._onGesture),eventjs[r](c,"drag",this._onDrag),eventjs[r](c,"orientation",this._onOrientationChange),eventjs[r](c,"shake",this._onShake),eventjs[r](c,"longpress",this._onLongPress))},removeListeners:function(){this.addOrRemove(s,"remove");var i=this._getEventPrefix();s(y.document,i+"up",this._onMouseUp),s(y.document,"touchend",this._onTouchEnd,a),s(y.document,i+"move",this._onMouseMove,a),s(y.document,"touchmove",this._onMouseMove,a)},_bindEvents:function(){this.eventsBound||(this._onMouseDown=this._onMouseDown.bind(this),this._onTouchStart=this._onTouchStart.bind(this),this._onMouseMove=this._onMouseMove.bind(this),this._onMouseUp=this._onMouseUp.bind(this),this._onTouchEnd=this._onTouchEnd.bind(this),this._onResize=this._onResize.bind(this),this._onGesture=this._onGesture.bind(this),this._onDrag=this._onDrag.bind(this),this._onShake=this._onShake.bind(this),this._onLongPress=this._onLongPress.bind(this),this._onOrientationChange=this._onOrientationChange.bind(this),this._onMouseWheel=this._onMouseWheel.bind(this),this._onMouseOut=this._onMouseOut.bind(this),this._onMouseEnter=this._onMouseEnter.bind(this),this._onContextMenu=this._onContextMenu.bind(this),this._onDoubleClick=this._onDoubleClick.bind(this),this._onDragOver=this._onDragOver.bind(this),this._onDragEnter=this._simpleEventHandler.bind(this,"dragenter"),this._onDragLeave=this._simpleEventHandler.bind(this,"dragleave"),this._onDrop=this._onDrop.bind(this),this.eventsBound=!0)},_onGesture:function(i,r){this.__onTransformGesture&&this.__onTransformGesture(i,r)},_onDrag:function(i,r){this.__onDrag&&this.__onDrag(i,r)},_onMouseWheel:function(i){this.__onMouseWheel(i)},_onMouseOut:function(i){var r=this._hoveredTarget;this.fire("mouse:out",{target:r,e:i}),this._hoveredTarget=null,r&&r.fire("mouseout",{e:i});var c=this;this._hoveredTargets.forEach(function(p){c.fire("mouse:out",{target:r,e:i}),p&&r.fire("mouseout",{e:i})}),this._hoveredTargets=[],this._iTextInstances&&this._iTextInstances.forEach(function(p){p.isEditing&&p.hiddenTextarea.focus()})},_onMouseEnter:function(i){this._currentTransform||this.findTarget(i)||(this.fire("mouse:over",{target:null,e:i}),this._hoveredTarget=null,this._hoveredTargets=[])},_onOrientationChange:function(i,r){this.__onOrientationChange&&this.__onOrientationChange(i,r)},_onShake:function(i,r){this.__onShake&&this.__onShake(i,r)},_onLongPress:function(i,r){this.__onLongPress&&this.__onLongPress(i,r)},_onDragOver:function(i){i.preventDefault();var r=this._simpleEventHandler("dragover",i);this._fireEnterLeaveEvents(r,i)},_onDrop:function(i){return this._simpleEventHandler("drop:before",i),this._simpleEventHandler("drop",i)},_onContextMenu:function(i){return this.stopContextMenu&&(i.stopPropagation(),i.preventDefault()),!1},_onDoubleClick:function(i){this._cacheTransformEventData(i),this._handleEvent(i,"dblclick"),this._resetTransformEventData(i)},getPointerId:function(i){var r=i.changedTouches;return r?r[0]&&r[0].identifier:this.enablePointerEvents?i.pointerId:-1},_isMainEvent:function(i){return i.isPrimary===!0||i.isPrimary!==!1&&(i.type==="touchend"&&i.touches.length===0||!i.changedTouches||i.changedTouches[0].identifier===this.mainTouchId)},_onTouchStart:function(i){i.preventDefault(),this.mainTouchId===null&&(this.mainTouchId=this.getPointerId(i)),this.__onMouseDown(i),this._resetTransformEventData();var r=this.upperCanvasEl,c=this._getEventPrefix();l(y.document,"touchend",this._onTouchEnd,a),l(y.document,"touchmove",this._onMouseMove,a),s(r,c+"down",this._onMouseDown)},_onMouseDown:function(i){this.__onMouseDown(i),this._resetTransformEventData();var r=this.upperCanvasEl,c=this._getEventPrefix();s(r,c+"move",this._onMouseMove,a),l(y.document,c+"up",this._onMouseUp),l(y.document,c+"move",this._onMouseMove,a)},_onTouchEnd:function(i){if(!(i.touches.length>0)){this.__onMouseUp(i),this._resetTransformEventData(),this.mainTouchId=null;var r=this._getEventPrefix();s(y.document,"touchend",this._onTouchEnd,a),s(y.document,"touchmove",this._onMouseMove,a);var c=this;this._willAddMouseDown&&clearTimeout(this._willAddMouseDown),this._willAddMouseDown=setTimeout(function(){l(c.upperCanvasEl,r+"down",c._onMouseDown),c._willAddMouseDown=0},400)}},_onMouseUp:function(i){this.__onMouseUp(i),this._resetTransformEventData();var r=this.upperCanvasEl,c=this._getEventPrefix();this._isMainEvent(i)&&(s(y.document,c+"up",this._onMouseUp),s(y.document,c+"move",this._onMouseMove,a),l(r,c+"move",this._onMouseMove,a))},_onMouseMove:function(i){!this.allowTouchScrolling&&i.preventDefault&&i.preventDefault(),this.__onMouseMove(i)},_onResize:function(){this.calcOffset()},_shouldRender:function(i){var r=this._activeObject;return!!(!!r!=!!i||r&&i&&r!==i)||(r&&r.isEditing,!1)},__onMouseUp:function(i){var r,c=this._currentTransform,p=this._groupSelector,f=!1,d=!p||p.left===0&&p.top===0;if(this._cacheTransformEventData(i),r=this._target,this._handleEvent(i,"up:before"),u(i,3))this.fireRightClick&&this._handleEvent(i,"up",3,d);else{if(u(i,2))return this.fireMiddleClick&&this._handleEvent(i,"up",2,d),void this._resetTransformEventData();if(this.isDrawingMode&&this._isCurrentlyDrawing)this._onMouseUpInDrawingMode(i);else if(this._isMainEvent(i)){if(c&&(this._finalizeCurrentTransform(i),f=c.actionPerformed),!d){var _=r===this._activeObject;this._maybeGroupObjects(i),f||(f=this._shouldRender(r)||!_&&r===this._activeObject)}var w,T;if(r){if(w=r._findTargetCorner(this.getPointer(i,!0),y.util.isTouchEvent(i)),r.selectable&&r!==this._activeObject&&r.activeOn==="up")this.setActiveObject(r,i),f=!0;else{var x=r.controls[w],b=x&&x.getMouseUpHandler(i,r,x);b&&b(i,c,(T=this.getPointer(i)).x,T.y)}r.isMoving=!1}if(c&&(c.target!==r||c.corner!==w)){var F=c.target&&c.target.controls[c.corner],B=F&&F.getMouseUpHandler(i,r,x);T=T||this.getPointer(i),B&&B(i,c,T.x,T.y)}this._setCursorFromEvent(i,r),this._handleEvent(i,"up",1,d),this._groupSelector=null,this._currentTransform=null,r&&(r.__corner=0),f?this.requestRenderAll():d||this.renderTop()}}},_simpleEventHandler:function(i,r){var c=this.findTarget(r),p=this.targets,f={e:r,target:c,subTargets:p};if(this.fire(i,f),c&&c.fire(i,f),!p)return c;for(var d=0;d<p.length;d++)p[d].fire(i,f);return c},_handleEvent:function(i,r,c,p){var f=this._target,d=this.targets||[],_={e:i,target:f,subTargets:d,button:c||1,isClick:p||!1,pointer:this._pointer,absolutePointer:this._absolutePointer,transform:this._currentTransform};r==="up"&&(_.currentTarget=this.findTarget(i),_.currentSubTargets=this.targets),this.fire("mouse:"+r,_),f&&f.fire("mouse"+r,_);for(var w=0;w<d.length;w++)d[w].fire("mouse"+r,_)},_finalizeCurrentTransform:function(i){var r=this._currentTransform,c=r.target,p={e:i,target:c,transform:r,action:r.action};c._scaling&&(c._scaling=!1),c.setCoords(),(r.actionPerformed||this.stateful&&c.hasStateChanged())&&this._fire("modified",p)},_onMouseDownInDrawingMode:function(i){this._isCurrentlyDrawing=!0,this.getActiveObject()&&this.discardActiveObject(i).requestRenderAll();var r=this.getPointer(i);this.freeDrawingBrush.onMouseDown(r,{e:i,pointer:r}),this._handleEvent(i,"down")},_onMouseMoveInDrawingMode:function(i){if(this._isCurrentlyDrawing){var r=this.getPointer(i);this.freeDrawingBrush.onMouseMove(r,{e:i,pointer:r})}this.setCursor(this.freeDrawingCursor),this._handleEvent(i,"move")},_onMouseUpInDrawingMode:function(i){var r=this.getPointer(i);this._isCurrentlyDrawing=this.freeDrawingBrush.onMouseUp({e:i,pointer:r}),this._handleEvent(i,"up")},__onMouseDown:function(i){this._cacheTransformEventData(i),this._handleEvent(i,"down:before");var r=this._target;if(u(i,3))this.fireRightClick&&this._handleEvent(i,"down",3);else if(u(i,2))this.fireMiddleClick&&this._handleEvent(i,"down",2);else if(this.isDrawingMode)this._onMouseDownInDrawingMode(i);else if(this._isMainEvent(i)&&!this._currentTransform){var c=this._pointer;this._previousPointer=c;var p=this._shouldRender(r),f=this._shouldGroup(i,r);if(this._shouldClearSelection(i,r)?this.discardActiveObject(i):f&&(this._handleGrouping(i,r),r=this._activeObject),!this.selection||r&&(r.selectable||r.isEditing||r===this._activeObject)||(this._groupSelector={ex:this._absolutePointer.x,ey:this._absolutePointer.y,top:0,left:0}),r){var d=r===this._activeObject;r.selectable&&r.activeOn==="down"&&this.setActiveObject(r,i);var _=r._findTargetCorner(this.getPointer(i,!0),y.util.isTouchEvent(i));if(r.__corner=_,r===this._activeObject&&(_||!f)){this._setupCurrentTransform(i,r,d);var w=r.controls[_],T=(c=this.getPointer(i),w&&w.getMouseDownHandler(i,r,w));T&&T(i,this._currentTransform,c.x,c.y)}}this._handleEvent(i,"down"),(p||f)&&this.requestRenderAll()}},_resetTransformEventData:function(){this._target=null,this._pointer=null,this._absolutePointer=null},_cacheTransformEventData:function(i){this._resetTransformEventData(),this._pointer=this.getPointer(i,!0),this._absolutePointer=this.restorePointerVpt(this._pointer),this._target=this._currentTransform?this._currentTransform.target:this.findTarget(i)||null},_beforeTransform:function(i){var r=this._currentTransform;this.stateful&&r.target.saveState(),this.fire("before:transform",{e:i,transform:r})},__onMouseMove:function(i){var r,c;if(this._handleEvent(i,"move:before"),this._cacheTransformEventData(i),this.isDrawingMode)this._onMouseMoveInDrawingMode(i);else if(this._isMainEvent(i)){var p=this._groupSelector;p?(c=this._absolutePointer,p.left=c.x-p.ex,p.top=c.y-p.ey,this.renderTop()):this._currentTransform?this._transformObject(i):(r=this.findTarget(i)||null,this._setCursorFromEvent(i,r),this._fireOverOutEvents(r,i)),this._handleEvent(i,"move"),this._resetTransformEventData()}},_fireOverOutEvents:function(i,r){var c=this._hoveredTarget,p=this._hoveredTargets,f=this.targets,d=Math.max(p.length,f.length);this.fireSyntheticInOutEvents(i,r,{oldTarget:c,evtOut:"mouseout",canvasEvtOut:"mouse:out",evtIn:"mouseover",canvasEvtIn:"mouse:over"});for(var _=0;_<d;_++)this.fireSyntheticInOutEvents(f[_],r,{oldTarget:p[_],evtOut:"mouseout",evtIn:"mouseover"});this._hoveredTarget=i,this._hoveredTargets=this.targets.concat()},_fireEnterLeaveEvents:function(i,r){var c=this._draggedoverTarget,p=this._hoveredTargets,f=this.targets,d=Math.max(p.length,f.length);this.fireSyntheticInOutEvents(i,r,{oldTarget:c,evtOut:"dragleave",evtIn:"dragenter"});for(var _=0;_<d;_++)this.fireSyntheticInOutEvents(f[_],r,{oldTarget:p[_],evtOut:"dragleave",evtIn:"dragenter"});this._draggedoverTarget=i},fireSyntheticInOutEvents:function(i,r,c){var p,f,d,_=c.oldTarget,w=_!==i,T=c.canvasEvtIn,x=c.canvasEvtOut;w&&(p={e:r,target:i,previousTarget:_},f={e:r,target:_,nextTarget:i}),d=i&&w,_&&w&&(x&&this.fire(x,f),_.fire(c.evtOut,f)),d&&(T&&this.fire(T,p),i.fire(c.evtIn,p))},__onMouseWheel:function(i){this._cacheTransformEventData(i),this._handleEvent(i,"wheel"),this._resetTransformEventData()},_transformObject:function(i){var r=this.getPointer(i),c=this._currentTransform;c.reset=!1,c.shiftKey=i.shiftKey,c.altKey=i[this.centeredKey],this._performTransformAction(i,c,r),c.actionPerformed&&this.requestRenderAll()},_performTransformAction:function(i,r,c){var p=c.x,f=c.y,d=r.action,_=!1,w=r.actionHandler;w&&(_=w(i,r,p,f)),d==="drag"&&_&&(r.target.isMoving=!0,this.setCursor(r.target.moveCursor||this.moveCursor)),r.actionPerformed=r.actionPerformed||_},_fire:y.controlsUtils.fireEvent,_setCursorFromEvent:function(i,r){if(!r)return this.setCursor(this.defaultCursor),!1;var c=r.hoverCursor||this.hoverCursor,p=this._activeObject&&this._activeObject.type==="activeSelection"?this._activeObject:null,f=(!p||!p.contains(r))&&r._findTargetCorner(this.getPointer(i,!0));f?this.setCursor(this.getCornerCursor(f,r,i)):(r.subTargetCheck&&this.targets.concat().reverse().map(function(d){c=d.hoverCursor||c}),this.setCursor(c))},getCornerCursor:function(i,r,c){var p=r.controls[i];return p.cursorStyleHandler(c,p,r)}})}(),te=Math.min,ne=Math.max,y.util.object.extend(y.Canvas.prototype,{_shouldGroup:function(l,s){var a=this._activeObject;return a&&this._isSelectionKeyPressed(l)&&s&&s.selectable&&this.selection&&(a!==s||a.type==="activeSelection")&&!s.onSelect({e:l})},_handleGrouping:function(l,s){var a=this._activeObject;a.__corner||(s!==a||(s=this.findTarget(l,!0))&&s.selectable)&&(a&&a.type==="activeSelection"?this._updateActiveSelection(s,l):this._createActiveSelection(s,l))},_updateActiveSelection:function(l,s){var a=this._activeObject,u=a._objects.slice(0);a.contains(l)?(a.removeWithUpdate(l),this._hoveredTarget=l,this._hoveredTargets=this.targets.concat(),a.size()===1&&this._setActiveObject(a.item(0),s)):(a.addWithUpdate(l),this._hoveredTarget=a,this._hoveredTargets=this.targets.concat()),this._fireSelectionEvents(u,s)},_createActiveSelection:function(l,s){var a=this.getActiveObjects(),u=this._createGroup(l);this._hoveredTarget=u,this._setActiveObject(u,s),this._fireSelectionEvents(a,s)},_createGroup:function(l){var s=this._objects,a=s.indexOf(this._activeObject)<s.indexOf(l)?[this._activeObject,l]:[l,this._activeObject];return this._activeObject.isEditing&&this._activeObject.exitEditing(),new y.ActiveSelection(a,{canvas:this})},_groupSelectedObjects:function(l){var s,a=this._collectObjects(l);a.length===1?this.setActiveObject(a[0],l):a.length>1&&(s=new y.ActiveSelection(a.reverse(),{canvas:this}),this.setActiveObject(s,l))},_collectObjects:function(l){for(var s,a=[],u=this._groupSelector.ex,i=this._groupSelector.ey,r=u+this._groupSelector.left,c=i+this._groupSelector.top,p=new y.Point(te(u,r),te(i,c)),f=new y.Point(ne(u,r),ne(i,c)),d=!this.selectionFullyContained,_=u===r&&i===c,w=this._objects.length;w--&&!((s=this._objects[w])&&s.selectable&&s.visible&&(d&&s.intersectsWithRect(p,f,!0)||s.isContainedWithinRect(p,f,!0)||d&&s.containsPoint(p,null,!0)||d&&s.containsPoint(f,null,!0))&&(a.push(s),_)););return a.length>1&&(a=a.filter(function(T){return!T.onSelect({e:l})})),a},_maybeGroupObjects:function(l){this.selection&&this._groupSelector&&this._groupSelectedObjects(l),this.setCursor(this.defaultCursor),this._groupSelector=null}}),y.util.object.extend(y.StaticCanvas.prototype,{toDataURL:function(l){l||(l={});var s=l.format||"png",a=l.quality||1,u=(l.multiplier||1)*(l.enableRetinaScaling?this.getRetinaScaling():1),i=this.toCanvasElement(u,l);return y.util.toDataURL(i,s,a)},toCanvasElement:function(l,s){l=l||1;var a=((s=s||{}).width||this.width)*l,u=(s.height||this.height)*l,i=this.getZoom(),r=this.width,c=this.height,p=i*l,f=this.viewportTransform,d=(f[4]-(s.left||0))*l,_=(f[5]-(s.top||0))*l,w=this.interactive,T=[p,0,0,p,d,_],x=this.enableRetinaScaling,b=y.util.createCanvasElement(),F=this.contextTop;return b.width=a,b.height=u,this.contextTop=null,this.enableRetinaScaling=!1,this.interactive=!1,this.viewportTransform=T,this.width=a,this.height=u,this.calcViewportBoundaries(),this.renderCanvas(b.getContext("2d"),this._objects),this.viewportTransform=f,this.width=r,this.height=c,this.calcViewportBoundaries(),this.interactive=w,this.enableRetinaScaling=x,this.contextTop=F,b}}),y.util.object.extend(y.StaticCanvas.prototype,{loadFromJSON:function(l,s,a){if(l){var u=typeof l=="string"?JSON.parse(l):y.util.object.clone(l),i=this,r=u.clipPath,c=this.renderOnAddRemove;return this.renderOnAddRemove=!1,delete u.clipPath,this._enlivenObjects(u.objects,function(p){i.clear(),i._setBgOverlay(u,function(){r?i._enlivenObjects([r],function(f){i.clipPath=f[0],i.__setupCanvas.call(i,u,p,c,s)}):i.__setupCanvas.call(i,u,p,c,s)})},a),this}},__setupCanvas:function(l,s,a,u){var i=this;s.forEach(function(r,c){i.insertAt(r,c)}),this.renderOnAddRemove=a,delete l.objects,delete l.backgroundImage,delete l.overlayImage,delete l.background,delete l.overlay,this._setOptions(l),this.renderAll(),u&&u()},_setBgOverlay:function(l,s){var a={backgroundColor:!1,overlayColor:!1,backgroundImage:!1,overlayImage:!1};if(l.backgroundImage||l.overlayImage||l.background||l.overlay){var u=function(){a.backgroundImage&&a.overlayImage&&a.backgroundColor&&a.overlayColor&&s&&s()};this.__setBgOverlay("backgroundImage",l.backgroundImage,a,u),this.__setBgOverlay("overlayImage",l.overlayImage,a,u),this.__setBgOverlay("backgroundColor",l.background,a,u),this.__setBgOverlay("overlayColor",l.overlay,a,u)}else s&&s()},__setBgOverlay:function(l,s,a,u){var i=this;if(!s)return a[l]=!0,void(u&&u());l==="backgroundImage"||l==="overlayImage"?y.util.enlivenObjects([s],function(r){i[l]=r[0],a[l]=!0,u&&u()}):this["set"+y.util.string.capitalize(l,!0)](s,function(){a[l]=!0,u&&u()})},_enlivenObjects:function(l,s,a){l&&l.length!==0?y.util.enlivenObjects(l,function(u){s&&s(u)},null,a):s&&s([])},_toDataURL:function(l,s){this.clone(function(a){s(a.toDataURL(l))})},_toDataURLWithMultiplier:function(l,s,a){this.clone(function(u){a(u.toDataURLWithMultiplier(l,s))})},clone:function(l,s){var a=JSON.stringify(this.toJSON(s));this.cloneWithoutData(function(u){u.loadFromJSON(a,function(){l&&l(u)})})},cloneWithoutData:function(l){var s=y.util.createCanvasElement();s.width=this.width,s.height=this.height;var a=new y.Canvas(s);this.backgroundImage?(a.setBackgroundImage(this.backgroundImage.src,function(){a.renderAll(),l&&l(a)}),a.backgroundImageOpacity=this.backgroundImageOpacity,a.backgroundImageStretch=this.backgroundImageStretch):l&&l(a)}}),function(l){var s=l.fabric||(l.fabric={}),a=s.util.object.extend,u=s.util.object.clone,i=s.util.toFixed,r=s.util.string.capitalize,c=s.util.degreesToRadians,p=!s.isLikelyNode;s.Object||(s.Object=s.util.createClass(s.CommonMethods,{type:"object",originX:"left",originY:"top",top:0,left:0,width:0,height:0,scaleX:1,scaleY:1,flipX:!1,flipY:!1,opacity:1,angle:0,skewX:0,skewY:0,cornerSize:13,touchCornerSize:24,transparentCorners:!0,hoverCursor:null,moveCursor:null,padding:0,borderColor:"rgb(178,204,255)",borderDashArray:null,cornerColor:"rgb(178,204,255)",cornerStrokeColor:null,cornerStyle:"rect",cornerDashArray:null,centeredScaling:!1,centeredRotation:!0,fill:"rgb(0,0,0)",fillRule:"nonzero",globalCompositeOperation:"source-over",backgroundColor:"",selectionBackgroundColor:"",stroke:null,strokeWidth:1,strokeDashArray:null,strokeDashOffset:0,strokeLineCap:"butt",strokeLineJoin:"miter",strokeMiterLimit:4,shadow:null,borderOpacityWhenMoving:.4,borderScaleFactor:1,minScaleLimit:0,selectable:!0,evented:!0,visible:!0,hasControls:!0,hasBorders:!0,perPixelTargetFind:!1,includeDefaultValues:!0,lockMovementX:!1,lockMovementY:!1,lockRotation:!1,lockScalingX:!1,lockScalingY:!1,lockSkewingX:!1,lockSkewingY:!1,lockScalingFlip:!1,excludeFromExport:!1,objectCaching:p,statefullCache:!1,noScaleCache:!0,strokeUniform:!1,dirty:!0,__corner:0,paintFirst:"fill",activeOn:"down",stateProperties:"top left width height scaleX scaleY flipX flipY originX originY transformMatrix stroke strokeWidth strokeDashArray strokeLineCap strokeDashOffset strokeLineJoin strokeMiterLimit angle opacity fill globalCompositeOperation shadow visible backgroundColor skewX skewY fillRule paintFirst clipPath strokeUniform".split(" "),cacheProperties:"fill stroke strokeWidth strokeDashArray width height paintFirst strokeUniform strokeLineCap strokeDashOffset strokeLineJoin strokeMiterLimit backgroundColor clipPath".split(" "),colorProperties:"fill stroke backgroundColor".split(" "),clipPath:void 0,inverted:!1,absolutePositioned:!1,initialize:function(f){f&&this.setOptions(f)},_createCacheCanvas:function(){this._cacheProperties={},this._cacheCanvas=s.util.createCanvasElement(),this._cacheContext=this._cacheCanvas.getContext("2d"),this._updateCacheCanvas(),this.dirty=!0},_limitCacheSize:function(f){var d=s.perfLimitSizeTotal,_=f.width,w=f.height,T=s.maxCacheSideLimit,x=s.minCacheSideLimit;if(_<=T&&w<=T&&_*w<=d)return _<x&&(f.width=x),w<x&&(f.height=x),f;var b=_/w,F=s.util.limitDimsByArea(b,d),B=s.util.capValue,z=B(x,F.x,T),$=B(x,F.y,T);return _>z&&(f.zoomX/=_/z,f.width=z,f.capped=!0),w>$&&(f.zoomY/=w/$,f.height=$,f.capped=!0),f},_getCacheCanvasDimensions:function(){var f=this.getTotalObjectScaling(),d=this._getTransformedDimensions(0,0),_=d.x*f.scaleX/this.scaleX,w=d.y*f.scaleY/this.scaleY;return{width:_+2,height:w+2,zoomX:f.scaleX,zoomY:f.scaleY,x:_,y:w}},_updateCacheCanvas:function(){var f=this.canvas;if(this.noScaleCache&&f&&f._currentTransform){var d=f._currentTransform.target,_=f._currentTransform.action;if(this===d&&_.slice&&_.slice(0,5)==="scale")return!1}var w,T,x=this._cacheCanvas,b=this._limitCacheSize(this._getCacheCanvasDimensions()),F=s.minCacheSideLimit,B=b.width,z=b.height,$=b.zoomX,Q=b.zoomY,q=B!==this.cacheWidth||z!==this.cacheHeight,O=this.zoomX!==$||this.zoomY!==Q,A=q||O,D=0,k=0,G=!1;if(q){var W=this._cacheCanvas.width,P=this._cacheCanvas.height,M=B>W||z>P;G=M||(B<.9*W||z<.9*P)&&W>F&&P>F,M&&!b.capped&&(B>F||z>F)&&(D=.1*B,k=.1*z)}return this instanceof s.Text&&this.path&&(A=!0,G=!0,D+=this.getHeightOfLine(0)*this.zoomX,k+=this.getHeightOfLine(0)*this.zoomY),!!A&&(G?(x.width=Math.ceil(B+D),x.height=Math.ceil(z+k)):(this._cacheContext.setTransform(1,0,0,1,0,0),this._cacheContext.clearRect(0,0,x.width,x.height)),w=b.x/2,T=b.y/2,this.cacheTranslationX=Math.round(x.width/2-w)+w,this.cacheTranslationY=Math.round(x.height/2-T)+T,this.cacheWidth=B,this.cacheHeight=z,this._cacheContext.translate(this.cacheTranslationX,this.cacheTranslationY),this._cacheContext.scale($,Q),this.zoomX=$,this.zoomY=Q,!0)},setOptions:function(f){this._setOptions(f),this._initGradient(f.fill,"fill"),this._initGradient(f.stroke,"stroke"),this._initPattern(f.fill,"fill"),this._initPattern(f.stroke,"stroke")},transform:function(f){var d=this.group&&!this.group._transformDone||this.group&&this.canvas&&f===this.canvas.contextTop,_=this.calcTransformMatrix(!d);f.transform(_[0],_[1],_[2],_[3],_[4],_[5])},toObject:function(f){var d=s.Object.NUM_FRACTION_DIGITS,_={type:this.type,version:s.version,originX:this.originX,originY:this.originY,left:i(this.left,d),top:i(this.top,d),width:i(this.width,d),height:i(this.height,d),fill:this.fill&&this.fill.toObject?this.fill.toObject():this.fill,stroke:this.stroke&&this.stroke.toObject?this.stroke.toObject():this.stroke,strokeWidth:i(this.strokeWidth,d),strokeDashArray:this.strokeDashArray?this.strokeDashArray.concat():this.strokeDashArray,strokeLineCap:this.strokeLineCap,strokeDashOffset:this.strokeDashOffset,strokeLineJoin:this.strokeLineJoin,strokeUniform:this.strokeUniform,strokeMiterLimit:i(this.strokeMiterLimit,d),scaleX:i(this.scaleX,d),scaleY:i(this.scaleY,d),angle:i(this.angle,d),flipX:this.flipX,flipY:this.flipY,opacity:i(this.opacity,d),shadow:this.shadow&&this.shadow.toObject?this.shadow.toObject():this.shadow,visible:this.visible,backgroundColor:this.backgroundColor,fillRule:this.fillRule,paintFirst:this.paintFirst,globalCompositeOperation:this.globalCompositeOperation,skewX:i(this.skewX,d),skewY:i(this.skewY,d)};return this.clipPath&&!this.clipPath.excludeFromExport&&(_.clipPath=this.clipPath.toObject(f),_.clipPath.inverted=this.clipPath.inverted,_.clipPath.absolutePositioned=this.clipPath.absolutePositioned),s.util.populateWithProperties(this,_,f),this.includeDefaultValues||(_=this._removeDefaultValues(_)),_},toDatalessObject:function(f){return this.toObject(f)},_removeDefaultValues:function(f){var d=s.util.getKlass(f.type).prototype;return d.stateProperties.forEach(function(_){_!=="left"&&_!=="top"&&(f[_]===d[_]&&delete f[_],Array.isArray(f[_])&&Array.isArray(d[_])&&f[_].length===0&&d[_].length===0&&delete f[_])}),f},toString:function(){return"#<fabric."+r(this.type)+">"},getObjectScaling:function(){if(!this.group)return{scaleX:this.scaleX,scaleY:this.scaleY};var f=s.util.qrDecompose(this.calcTransformMatrix());return{scaleX:Math.abs(f.scaleX),scaleY:Math.abs(f.scaleY)}},getTotalObjectScaling:function(){var f=this.getObjectScaling(),d=f.scaleX,_=f.scaleY;if(this.canvas){var w=this.canvas.getZoom(),T=this.canvas.getRetinaScaling();d*=w*T,_*=w*T}return{scaleX:d,scaleY:_}},getObjectOpacity:function(){var f=this.opacity;return this.group&&(f*=this.group.getObjectOpacity()),f},_set:function(f,d){var _=f==="scaleX"||f==="scaleY",w=this[f]!==d,T=!1;return _&&(d=this._constrainScale(d)),f==="scaleX"&&d<0?(this.flipX=!this.flipX,d*=-1):f==="scaleY"&&d<0?(this.flipY=!this.flipY,d*=-1):f!=="shadow"||!d||d instanceof s.Shadow?f==="dirty"&&this.group&&this.group.set("dirty",d):d=new s.Shadow(d),this[f]=d,w&&(T=this.group&&this.group.isOnACache(),this.cacheProperties.indexOf(f)>-1?(this.dirty=!0,T&&this.group.set("dirty",!0)):T&&this.stateProperties.indexOf(f)>-1&&this.group.set("dirty",!0)),this},setOnGroup:function(){},getViewportTransform:function(){return this.canvas&&this.canvas.viewportTransform?this.canvas.viewportTransform:s.iMatrix.concat()},isNotVisible:function(){return this.opacity===0||!this.width&&!this.height&&this.strokeWidth===0||!this.visible},render:function(f){this.isNotVisible()||this.canvas&&this.canvas.skipOffscreen&&!this.group&&!this.isOnScreen()||(f.save(),this._setupCompositeOperation(f),this.drawSelectionBackground(f),this.transform(f),this._setOpacity(f),this._setShadow(f,this),this.shouldCache()?(this.renderCache(),this.drawCacheOnCanvas(f)):(this._removeCacheCanvas(),this.dirty=!1,this.drawObject(f),this.objectCaching&&this.statefullCache&&this.saveState({propertySet:"cacheProperties"})),f.restore())},renderCache:function(f){f=f||{},this._cacheCanvas&&this._cacheContext||this._createCacheCanvas(),this.isCacheDirty()&&(this.statefullCache&&this.saveState({propertySet:"cacheProperties"}),this.drawObject(this._cacheContext,f.forClipping),this.dirty=!1)},_removeCacheCanvas:function(){this._cacheCanvas=null,this._cacheContext=null,this.cacheWidth=0,this.cacheHeight=0},hasStroke:function(){return this.stroke&&this.stroke!=="transparent"&&this.strokeWidth!==0},hasFill:function(){return this.fill&&this.fill!=="transparent"},needsItsOwnCache:function(){return!(this.paintFirst!=="stroke"||!this.hasFill()||!this.hasStroke()||typeof this.shadow!="object")||!!this.clipPath},shouldCache:function(){return this.ownCaching=this.needsItsOwnCache()||this.objectCaching&&(!this.group||!this.group.isOnACache()),this.ownCaching},willDrawShadow:function(){return!!this.shadow&&(this.shadow.offsetX!==0||this.shadow.offsetY!==0)},drawClipPathOnCache:function(f,d){if(f.save(),d.inverted?f.globalCompositeOperation="destination-out":f.globalCompositeOperation="destination-in",d.absolutePositioned){var _=s.util.invertTransform(this.calcTransformMatrix());f.transform(_[0],_[1],_[2],_[3],_[4],_[5])}d.transform(f),f.scale(1/d.zoomX,1/d.zoomY),f.drawImage(d._cacheCanvas,-d.cacheTranslationX,-d.cacheTranslationY),f.restore()},drawObject:function(f,d){var _=this.fill,w=this.stroke;d?(this.fill="black",this.stroke="",this._setClippingProperties(f)):this._renderBackground(f),this._render(f),this._drawClipPath(f,this.clipPath),this.fill=_,this.stroke=w},_drawClipPath:function(f,d){d&&(d.canvas=this.canvas,d.shouldCache(),d._transformDone=!0,d.renderCache({forClipping:!0}),this.drawClipPathOnCache(f,d))},drawCacheOnCanvas:function(f){f.scale(1/this.zoomX,1/this.zoomY),f.drawImage(this._cacheCanvas,-this.cacheTranslationX,-this.cacheTranslationY)},isCacheDirty:function(f){if(this.isNotVisible())return!1;if(this._cacheCanvas&&this._cacheContext&&!f&&this._updateCacheCanvas())return!0;if(this.dirty||this.clipPath&&this.clipPath.absolutePositioned||this.statefullCache&&this.hasStateChanged("cacheProperties")){if(this._cacheCanvas&&this._cacheContext&&!f){var d=this.cacheWidth/this.zoomX,_=this.cacheHeight/this.zoomY;this._cacheContext.clearRect(-d/2,-_/2,d,_)}return!0}return!1},_renderBackground:function(f){if(this.backgroundColor){var d=this._getNonTransformedDimensions();f.fillStyle=this.backgroundColor,f.fillRect(-d.x/2,-d.y/2,d.x,d.y),this._removeShadow(f)}},_setOpacity:function(f){this.group&&!this.group._transformDone?f.globalAlpha=this.getObjectOpacity():f.globalAlpha*=this.opacity},_setStrokeStyles:function(f,d){var _=d.stroke;_&&(f.lineWidth=d.strokeWidth,f.lineCap=d.strokeLineCap,f.lineDashOffset=d.strokeDashOffset,f.lineJoin=d.strokeLineJoin,f.miterLimit=d.strokeMiterLimit,_.toLive?_.gradientUnits==="percentage"||_.gradientTransform||_.patternTransform?this._applyPatternForTransformedGradient(f,_):(f.strokeStyle=_.toLive(f,this),this._applyPatternGradientTransform(f,_)):f.strokeStyle=d.stroke)},_setFillStyles:function(f,d){var _=d.fill;_&&(_.toLive?(f.fillStyle=_.toLive(f,this),this._applyPatternGradientTransform(f,d.fill)):f.fillStyle=_)},_setClippingProperties:function(f){f.globalAlpha=1,f.strokeStyle="transparent",f.fillStyle="#000000"},_setLineDash:function(f,d){d&&d.length!==0&&(1&d.length&&d.push.apply(d,d),f.setLineDash(d))},_renderControls:function(f,d){var _,w,T,x=this.getViewportTransform(),b=this.calcTransformMatrix();w=(d=d||{}).hasBorders!==void 0?d.hasBorders:this.hasBorders,T=d.hasControls!==void 0?d.hasControls:this.hasControls,b=s.util.multiplyTransformMatrices(x,b),_=s.util.qrDecompose(b),f.save(),f.translate(_.translateX,_.translateY),f.lineWidth=1*this.borderScaleFactor,this.group||(f.globalAlpha=this.isMoving?this.borderOpacityWhenMoving:1),this.flipX&&(_.angle-=180),f.rotate(c(this.group?_.angle:this.angle)),d.forActiveSelection||this.group?w&&this.drawBordersInGroup(f,_,d):w&&this.drawBorders(f,d),T&&this.drawControls(f,d),f.restore()},_setShadow:function(f){if(this.shadow){var d,_=this.shadow,w=this.canvas,T=w&&w.viewportTransform[0]||1,x=w&&w.viewportTransform[3]||1;d=_.nonScaling?{scaleX:1,scaleY:1}:this.getObjectScaling(),w&&w._isRetinaScaling()&&(T*=s.devicePixelRatio,x*=s.devicePixelRatio),f.shadowColor=_.color,f.shadowBlur=_.blur*s.browserShadowBlurConstant*(T+x)*(d.scaleX+d.scaleY)/4,f.shadowOffsetX=_.offsetX*T*d.scaleX,f.shadowOffsetY=_.offsetY*x*d.scaleY}},_removeShadow:function(f){this.shadow&&(f.shadowColor="",f.shadowBlur=f.shadowOffsetX=f.shadowOffsetY=0)},_applyPatternGradientTransform:function(f,d){if(!d||!d.toLive)return{offsetX:0,offsetY:0};var _=d.gradientTransform||d.patternTransform,w=-this.width/2+d.offsetX||0,T=-this.height/2+d.offsetY||0;return d.gradientUnits==="percentage"?f.transform(this.width,0,0,this.height,w,T):f.transform(1,0,0,1,w,T),_&&f.transform(_[0],_[1],_[2],_[3],_[4],_[5]),{offsetX:w,offsetY:T}},_renderPaintInOrder:function(f){this.paintFirst==="stroke"?(this._renderStroke(f),this._renderFill(f)):(this._renderFill(f),this._renderStroke(f))},_render:function(){},_renderFill:function(f){this.fill&&(f.save(),this._setFillStyles(f,this),this.fillRule==="evenodd"?f.fill("evenodd"):f.fill(),f.restore())},_renderStroke:function(f){if(this.stroke&&this.strokeWidth!==0){if(this.shadow&&!this.shadow.affectStroke&&this._removeShadow(f),f.save(),this.strokeUniform&&this.group){var d=this.getObjectScaling();f.scale(1/d.scaleX,1/d.scaleY)}else this.strokeUniform&&f.scale(1/this.scaleX,1/this.scaleY);this._setLineDash(f,this.strokeDashArray),this._setStrokeStyles(f,this),f.stroke(),f.restore()}},_applyPatternForTransformedGradient:function(f,d){var _,w=this._limitCacheSize(this._getCacheCanvasDimensions()),T=s.util.createCanvasElement(),x=this.canvas.getRetinaScaling(),b=w.x/this.scaleX/x,F=w.y/this.scaleY/x;T.width=b,T.height=F,(_=T.getContext("2d")).beginPath(),_.moveTo(0,0),_.lineTo(b,0),_.lineTo(b,F),_.lineTo(0,F),_.closePath(),_.translate(b/2,F/2),_.scale(w.zoomX/this.scaleX/x,w.zoomY/this.scaleY/x),this._applyPatternGradientTransform(_,d),_.fillStyle=d.toLive(f),_.fill(),f.translate(-this.width/2-this.strokeWidth/2,-this.height/2-this.strokeWidth/2),f.scale(x*this.scaleX/w.zoomX,x*this.scaleY/w.zoomY),f.strokeStyle=_.createPattern(T,"no-repeat")},_findCenterFromElement:function(){return{x:this.left+this.width/2,y:this.top+this.height/2}},_assignTransformMatrixProps:function(){if(this.transformMatrix){var f=s.util.qrDecompose(this.transformMatrix);this.flipX=!1,this.flipY=!1,this.set("scaleX",f.scaleX),this.set("scaleY",f.scaleY),this.angle=f.angle,this.skewX=f.skewX,this.skewY=0}},_removeTransformMatrix:function(f){var d=this._findCenterFromElement();this.transformMatrix&&(this._assignTransformMatrixProps(),d=s.util.transformPoint(d,this.transformMatrix)),this.transformMatrix=null,f&&(this.scaleX*=f.scaleX,this.scaleY*=f.scaleY,this.cropX=f.cropX,this.cropY=f.cropY,d.x+=f.offsetLeft,d.y+=f.offsetTop,this.width=f.width,this.height=f.height),this.setPositionByOrigin(d,"center","center")},clone:function(f,d){var _=this.toObject(d);this.constructor.fromObject?this.constructor.fromObject(_,f):s.Object._fromObject("Object",_,f)},cloneAsImage:function(f,d){var _=this.toCanvasElement(d);return f&&f(new s.Image(_)),this},toCanvasElement:function(f){f||(f={});var d=s.util,_=d.saveObjectTransform(this),w=this.group,T=this.shadow,x=Math.abs,b=(f.multiplier||1)*(f.enableRetinaScaling?s.devicePixelRatio:1);delete this.group,f.withoutTransform&&d.resetObjectTransform(this),f.withoutShadow&&(this.shadow=null);var F,B,z,$,Q=s.util.createCanvasElement(),q=this.getBoundingRect(!0,!0),O=this.shadow,A={x:0,y:0};O&&(B=O.blur,F=O.nonScaling?{scaleX:1,scaleY:1}:this.getObjectScaling(),A.x=2*Math.round(x(O.offsetX)+B)*x(F.scaleX),A.y=2*Math.round(x(O.offsetY)+B)*x(F.scaleY)),z=q.width+A.x,$=q.height+A.y,Q.width=Math.ceil(z),Q.height=Math.ceil($);var D=new s.StaticCanvas(Q,{enableRetinaScaling:!1,renderOnAddRemove:!1,skipOffscreen:!1});f.format==="jpeg"&&(D.backgroundColor="#fff"),this.setPositionByOrigin(new s.Point(D.width/2,D.height/2),"center","center");var k=this.canvas;D.add(this);var G=D.toCanvasElement(b||1,f);return this.shadow=T,this.set("canvas",k),w&&(this.group=w),this.set(_).setCoords(),D._objects=[],D.dispose(),D=null,G},toDataURL:function(f){return f||(f={}),s.util.toDataURL(this.toCanvasElement(f),f.format||"png",f.quality||1)},isType:function(f){return arguments.length>1?Array.from(arguments).includes(this.type):this.type===f},complexity:function(){return 1},toJSON:function(f){return this.toObject(f)},rotate:function(f){var d=(this.originX!=="center"||this.originY!=="center")&&this.centeredRotation;return d&&this._setOriginToCenter(),this.set("angle",f),d&&this._resetOrigin(),this},centerH:function(){return this.canvas&&this.canvas.centerObjectH(this),this},viewportCenterH:function(){return this.canvas&&this.canvas.viewportCenterObjectH(this),this},centerV:function(){return this.canvas&&this.canvas.centerObjectV(this),this},viewportCenterV:function(){return this.canvas&&this.canvas.viewportCenterObjectV(this),this},center:function(){return this.canvas&&this.canvas.centerObject(this),this},viewportCenter:function(){return this.canvas&&this.canvas.viewportCenterObject(this),this},getLocalPointer:function(f,d){d=d||this.canvas.getPointer(f);var _=new s.Point(d.x,d.y),w=this._getLeftTopCoords();return this.angle&&(_=s.util.rotatePoint(_,w,c(-this.angle))),{x:_.x-w.x,y:_.y-w.y}},_setupCompositeOperation:function(f){this.globalCompositeOperation&&(f.globalCompositeOperation=this.globalCompositeOperation)},dispose:function(){s.runningAnimations&&s.runningAnimations.cancelByTarget(this)}}),s.util.createAccessors&&s.util.createAccessors(s.Object),a(s.Object.prototype,s.Observable),s.Object.NUM_FRACTION_DIGITS=2,s.Object.ENLIVEN_PROPS=["clipPath"],s.Object._fromObject=function(f,d,_,w){var T=s[f];d=u(d,!0),s.util.enlivenPatterns([d.fill,d.stroke],function(x){x[0]!==void 0&&(d.fill=x[0]),x[1]!==void 0&&(d.stroke=x[1]),s.util.enlivenObjectEnlivables(d,d,function(){var b=w?new T(d[w],d):new T(d);_&&_(b)})})},s.Object.__uid=0)}(e),pe=y.util.degreesToRadians,he={left:-.5,center:0,right:.5},le={top:-.5,center:0,bottom:.5},y.util.object.extend(y.Object.prototype,{translateToGivenOrigin:function(l,s,a,u,i){var r,c,p,f=l.x,d=l.y;return typeof s=="string"?s=he[s]:s-=.5,typeof u=="string"?u=he[u]:u-=.5,typeof a=="string"?a=le[a]:a-=.5,typeof i=="string"?i=le[i]:i-=.5,c=i-a,((r=u-s)||c)&&(p=this._getTransformedDimensions(),f=l.x+r*p.x,d=l.y+c*p.y),new y.Point(f,d)},translateToCenterPoint:function(l,s,a){var u=this.translateToGivenOrigin(l,s,a,"center","center");return this.angle?y.util.rotatePoint(u,l,pe(this.angle)):u},translateToOriginPoint:function(l,s,a){var u=this.translateToGivenOrigin(l,"center","center",s,a);return this.angle?y.util.rotatePoint(u,l,pe(this.angle)):u},getCenterPoint:function(){var l=new y.Point(this.left,this.top);return this.translateToCenterPoint(l,this.originX,this.originY)},getPointByOrigin:function(l,s){var a=this.getCenterPoint();return this.translateToOriginPoint(a,l,s)},toLocalPoint:function(l,s,a){var u,i,r=this.getCenterPoint();return u=s!==void 0&&a!==void 0?this.translateToGivenOrigin(r,"center","center",s,a):new y.Point(this.left,this.top),i=new y.Point(l.x,l.y),this.angle&&(i=y.util.rotatePoint(i,r,-pe(this.angle))),i.subtractEquals(u)},setPositionByOrigin:function(l,s,a){var u=this.translateToCenterPoint(l,s,a),i=this.translateToOriginPoint(u,this.originX,this.originY);this.set("left",i.x),this.set("top",i.y)},adjustPosition:function(l){var s,a,u=pe(this.angle),i=this.getScaledWidth(),r=y.util.cos(u)*i,c=y.util.sin(u)*i;s=typeof this.originX=="string"?he[this.originX]:this.originX-.5,a=typeof l=="string"?he[l]:l-.5,this.left+=r*(a-s),this.top+=c*(a-s),this.setCoords(),this.originX=l},_setOriginToCenter:function(){this._originalOriginX=this.originX,this._originalOriginY=this.originY;var l=this.getCenterPoint();this.originX="center",this.originY="center",this.left=l.x,this.top=l.y},_resetOrigin:function(){var l=this.translateToOriginPoint(this.getCenterPoint(),this._originalOriginX,this._originalOriginY);this.originX=this._originalOriginX,this.originY=this._originalOriginY,this.left=l.x,this.top=l.y,this._originalOriginX=null,this._originalOriginY=null},_getLeftTopCoords:function(){return this.translateToOriginPoint(this.getCenterPoint(),"left","top")}}),function(){var l=y.util,s=l.degreesToRadians,a=l.multiplyTransformMatrices,u=l.transformPoint;l.object.extend(y.Object.prototype,{oCoords:null,aCoords:null,lineCoords:null,ownMatrixCache:null,matrixCache:null,controls:{},_getCoords:function(i,r){return r?i?this.calcACoords():this.calcLineCoords():(this.aCoords&&this.lineCoords||this.setCoords(!0),i?this.aCoords:this.lineCoords)},getCoords:function(i,r){return c=this._getCoords(i,r),[new y.Point(c.tl.x,c.tl.y),new y.Point(c.tr.x,c.tr.y),new y.Point(c.br.x,c.br.y),new y.Point(c.bl.x,c.bl.y)];var c},intersectsWithRect:function(i,r,c,p){var f=this.getCoords(c,p);return y.Intersection.intersectPolygonRectangle(f,i,r).status==="Intersection"},intersectsWithObject:function(i,r,c){return y.Intersection.intersectPolygonPolygon(this.getCoords(r,c),i.getCoords(r,c)).status==="Intersection"||i.isContainedWithinObject(this,r,c)||this.isContainedWithinObject(i,r,c)},isContainedWithinObject:function(i,r,c){for(var p=this.getCoords(r,c),f=r?i.aCoords:i.lineCoords,d=0,_=i._getImageLines(f);d<4;d++)if(!i.containsPoint(p[d],_))return!1;return!0},isContainedWithinRect:function(i,r,c,p){var f=this.getBoundingRect(c,p);return f.left>=i.x&&f.left+f.width<=r.x&&f.top>=i.y&&f.top+f.height<=r.y},containsPoint:function(i,r,c,p){var f=this._getCoords(c,p),d=(r=r||this._getImageLines(f),this._findCrossPoints(i,r));return d!==0&&d%2==1},isOnScreen:function(i){if(!this.canvas)return!1;var r=this.canvas.vptCoords.tl,c=this.canvas.vptCoords.br;return!!this.getCoords(!0,i).some(function(p){return p.x<=c.x&&p.x>=r.x&&p.y<=c.y&&p.y>=r.y})||!!this.intersectsWithRect(r,c,!0,i)||this._containsCenterOfCanvas(r,c,i)},_containsCenterOfCanvas:function(i,r,c){var p={x:(i.x+r.x)/2,y:(i.y+r.y)/2};return!!this.containsPoint(p,null,!0,c)},isPartiallyOnScreen:function(i){if(!this.canvas)return!1;var r=this.canvas.vptCoords.tl,c=this.canvas.vptCoords.br;return!!this.intersectsWithRect(r,c,!0,i)||this.getCoords(!0,i).every(function(p){return(p.x>=c.x||p.x<=r.x)&&(p.y>=c.y||p.y<=r.y)})&&this._containsCenterOfCanvas(r,c,i)},_getImageLines:function(i){return{topline:{o:i.tl,d:i.tr},rightline:{o:i.tr,d:i.br},bottomline:{o:i.br,d:i.bl},leftline:{o:i.bl,d:i.tl}}},_findCrossPoints:function(i,r){var c,p,f,d=0;for(var _ in r)if(!((f=r[_]).o.y<i.y&&f.d.y<i.y||f.o.y>=i.y&&f.d.y>=i.y||(f.o.x===f.d.x&&f.o.x>=i.x?p=f.o.x:(c=(f.d.y-f.o.y)/(f.d.x-f.o.x),p=-(i.y-0*i.x-(f.o.y-c*f.o.x))/(0-c)),p>=i.x&&(d+=1),d!==2)))break;return d},getBoundingRect:function(i,r){var c=this.getCoords(i,r);return l.makeBoundingBoxFromPoints(c)},getScaledWidth:function(){return this._getTransformedDimensions().x},getScaledHeight:function(){return this._getTransformedDimensions().y},_constrainScale:function(i){return Math.abs(i)<this.minScaleLimit?i<0?-this.minScaleLimit:this.minScaleLimit:i===0?1e-4:i},scale:function(i){return this._set("scaleX",i),this._set("scaleY",i),this.setCoords()},scaleToWidth:function(i,r){var c=this.getBoundingRect(r).width/this.getScaledWidth();return this.scale(i/this.width/c)},scaleToHeight:function(i,r){var c=this.getBoundingRect(r).height/this.getScaledHeight();return this.scale(i/this.height/c)},calcLineCoords:function(){var i=this.getViewportTransform(),r=this.padding,c=s(this.angle),p=l.cos(c)*r,f=l.sin(c)*r,d=p+f,_=p-f,w=this.calcACoords(),T={tl:u(w.tl,i),tr:u(w.tr,i),bl:u(w.bl,i),br:u(w.br,i)};return r&&(T.tl.x-=_,T.tl.y-=d,T.tr.x+=d,T.tr.y-=_,T.bl.x-=d,T.bl.y+=_,T.br.x+=_,T.br.y+=d),T},calcOCoords:function(){var i=this._calcRotateMatrix(),r=this._calcTranslateMatrix(),c=this.getViewportTransform(),p=a(c,r),f=a(p,i),d=(f=a(f,[1/c[0],0,0,1/c[3],0,0]),this._calculateCurrentDimensions()),_={};return this.forEachControl(function(w,T,x){_[T]=w.positionHandler(d,f,x)}),_},calcACoords:function(){var i=this._calcRotateMatrix(),r=this._calcTranslateMatrix(),c=a(r,i),p=this._getTransformedDimensions(),f=p.x/2,d=p.y/2;return{tl:u({x:-f,y:-d},c),tr:u({x:f,y:-d},c),bl:u({x:-f,y:d},c),br:u({x:f,y:d},c)}},setCoords:function(i){return this.aCoords=this.calcACoords(),this.lineCoords=this.group?this.aCoords:this.calcLineCoords(),i||(this.oCoords=this.calcOCoords(),this._setCornerCoords&&this._setCornerCoords()),this},_calcRotateMatrix:function(){return l.calcRotateMatrix(this)},_calcTranslateMatrix:function(){var i=this.getCenterPoint();return[1,0,0,1,i.x,i.y]},transformMatrixKey:function(i){var r="_",c="";return!i&&this.group&&(c=this.group.transformMatrixKey(i)+r),c+this.top+r+this.left+r+this.scaleX+r+this.scaleY+r+this.skewX+r+this.skewY+r+this.angle+r+this.originX+r+this.originY+r+this.width+r+this.height+r+this.strokeWidth+this.flipX+this.flipY},calcTransformMatrix:function(i){var r=this.calcOwnMatrix();if(i||!this.group)return r;var c=this.transformMatrixKey(i),p=this.matrixCache||(this.matrixCache={});return p.key===c?p.value:(this.group&&(r=a(this.group.calcTransformMatrix(!1),r)),p.key=c,p.value=r,r)},calcOwnMatrix:function(){var i=this.transformMatrixKey(!0),r=this.ownMatrixCache||(this.ownMatrixCache={});if(r.key===i)return r.value;var c=this._calcTranslateMatrix(),p={angle:this.angle,translateX:c[4],translateY:c[5],scaleX:this.scaleX,scaleY:this.scaleY,skewX:this.skewX,skewY:this.skewY,flipX:this.flipX,flipY:this.flipY};return r.key=i,r.value=l.composeMatrix(p),r.value},_getNonTransformedDimensions:function(){var i=this.strokeWidth;return{x:this.width+i,y:this.height+i}},_getTransformedDimensions:function(i,r){i===void 0&&(i=this.skewX),r===void 0&&(r=this.skewY);var c,p,f,d=i===0&&r===0;if(this.strokeUniform?(p=this.width,f=this.height):(p=(c=this._getNonTransformedDimensions()).x,f=c.y),d)return this._finalizeDimensions(p*this.scaleX,f*this.scaleY);var _=l.sizeAfterTransform(p,f,{scaleX:this.scaleX,scaleY:this.scaleY,skewX:i,skewY:r});return this._finalizeDimensions(_.x,_.y)},_finalizeDimensions:function(i,r){return this.strokeUniform?{x:i+this.strokeWidth,y:r+this.strokeWidth}:{x:i,y:r}},_calculateCurrentDimensions:function(){var i=this.getViewportTransform(),r=this._getTransformedDimensions();return u(r,i,!0).scalarAdd(2*this.padding)}})}(),y.util.object.extend(y.Object.prototype,{sendToBack:function(){return this.group?y.StaticCanvas.prototype.sendToBack.call(this.group,this):this.canvas&&this.canvas.sendToBack(this),this},bringToFront:function(){return this.group?y.StaticCanvas.prototype.bringToFront.call(this.group,this):this.canvas&&this.canvas.bringToFront(this),this},sendBackwards:function(l){return this.group?y.StaticCanvas.prototype.sendBackwards.call(this.group,this,l):this.canvas&&this.canvas.sendBackwards(this,l),this},bringForward:function(l){return this.group?y.StaticCanvas.prototype.bringForward.call(this.group,this,l):this.canvas&&this.canvas.bringForward(this,l),this},moveTo:function(l){return this.group&&this.group.type!=="activeSelection"?y.StaticCanvas.prototype.moveTo.call(this.group,this,l):this.canvas&&this.canvas.moveTo(this,l),this}}),function(){function l(a,u){if(u){if(u.toLive)return a+": url(#SVGID_"+u.id+"); ";var i=new y.Color(u),r=a+": "+i.toRgb()+"; ",c=i.getAlpha();return c!==1&&(r+=a+"-opacity: "+c.toString()+"; "),r}return a+": none; "}var s=y.util.toFixed;y.util.object.extend(y.Object.prototype,{getSvgStyles:function(a){var u=this.fillRule?this.fillRule:"nonzero",i=this.strokeWidth?this.strokeWidth:"0",r=this.strokeDashArray?this.strokeDashArray.join(" "):"none",c=this.strokeDashOffset?this.strokeDashOffset:"0",p=this.strokeLineCap?this.strokeLineCap:"butt",f=this.strokeLineJoin?this.strokeLineJoin:"miter",d=this.strokeMiterLimit?this.strokeMiterLimit:"4",_=this.opacity!==void 0?this.opacity:"1",w=this.visible?"":" visibility: hidden;",T=a?"":this.getSvgFilter(),x=l("fill",this.fill);return[l("stroke",this.stroke),"stroke-width: ",i,"; ","stroke-dasharray: ",r,"; ","stroke-linecap: ",p,"; ","stroke-dashoffset: ",c,"; ","stroke-linejoin: ",f,"; ","stroke-miterlimit: ",d,"; ",x,"fill-rule: ",u,"; ","opacity: ",_,";",T,w].join("")},getSvgSpanStyles:function(a,u){var i="; ",r=a.fontFamily?"font-family: "+(a.fontFamily.indexOf("'")===-1&&a.fontFamily.indexOf('"')===-1?"'"+a.fontFamily+"'":a.fontFamily)+i:"",c=a.strokeWidth?"stroke-width: "+a.strokeWidth+i:"",p=a.fontSize?"font-size: "+a.fontSize+"px"+i:"",f=a.fontStyle?"font-style: "+a.fontStyle+i:"",d=a.fontWeight?"font-weight: "+a.fontWeight+i:"",_=a.fill?l("fill",a.fill):"",w=a.stroke?l("stroke",a.stroke):"",T=this.getSvgTextDecoration(a);return T&&(T="text-decoration: "+T+i),[w,c,r,p,f,d,T,_,a.deltaY?"baseline-shift: "+-a.deltaY+"; ":"",u?"white-space: pre; ":""].join("")},getSvgTextDecoration:function(a){return["overline","underline","line-through"].filter(function(u){return a[u.replace("-","")]}).join(" ")},getSvgFilter:function(){return this.shadow?"filter: url(#SVGID_"+this.shadow.id+");":""},getSvgCommons:function(){return[this.id?'id="'+this.id+'" ':"",this.clipPath?'clip-path="url(#'+this.clipPath.clipPathId+')" ':""].join("")},getSvgTransform:function(a,u){var i=a?this.calcTransformMatrix():this.calcOwnMatrix();return'transform="'+y.util.matrixToSVG(i)+(u||"")+'" '},_setSVGBg:function(a){if(this.backgroundColor){var u=y.Object.NUM_FRACTION_DIGITS;a.push("		<rect ",this._getFillAttributes(this.backgroundColor),' x="',s(-this.width/2,u),'" y="',s(-this.height/2,u),'" width="',s(this.width,u),'" height="',s(this.height,u),`"></rect>
`)}},toSVG:function(a){return this._createBaseSVGMarkup(this._toSVG(a),{reviver:a})},toClipPathSVG:function(a){return"	"+this._createBaseClipPathSVGMarkup(this._toSVG(a),{reviver:a})},_createBaseClipPathSVGMarkup:function(a,u){var i=(u=u||{}).reviver,r=u.additionalTransform||"",c=[this.getSvgTransform(!0,r),this.getSvgCommons()].join(""),p=a.indexOf("COMMON_PARTS");return a[p]=c,i?i(a.join("")):a.join("")},_createBaseSVGMarkup:function(a,u){var i,r,c=(u=u||{}).noStyle,p=u.reviver,f=c?"":'style="'+this.getSvgStyles()+'" ',d=u.withShadow?'style="'+this.getSvgFilter()+'" ':"",_=this.clipPath,w=this.strokeUniform?'vector-effect="non-scaling-stroke" ':"",T=_&&_.absolutePositioned,x=this.stroke,b=this.fill,F=this.shadow,B=[],z=a.indexOf("COMMON_PARTS"),$=u.additionalTransform;return _&&(_.clipPathId="CLIPPATH_"+y.Object.__uid++,r='<clipPath id="'+_.clipPathId+`" >
`+_.toClipPathSVG(p)+`</clipPath>
`),T&&B.push("<g ",d,this.getSvgCommons(),` >
`),B.push("<g ",this.getSvgTransform(!1),T?"":d+this.getSvgCommons(),` >
`),i=[f,w,c?"":this.addPaintOrder()," ",$?'transform="'+$+'" ':""].join(""),a[z]=i,b&&b.toLive&&B.push(b.toSVG(this)),x&&x.toLive&&B.push(x.toSVG(this)),F&&B.push(F.toSVG(this)),_&&B.push(r),B.push(a.join("")),B.push(`</g>
`),T&&B.push(`</g>
`),p?p(B.join("")):B.join("")},addPaintOrder:function(){return this.paintFirst!=="fill"?' paint-order="'+this.paintFirst+'" ':""}})}(),function(){var l=y.util.object.extend,s="stateProperties";function a(i,r,c){var p={};c.forEach(function(f){p[f]=i[f]}),l(i[r],p,!0)}function u(i,r,c){if(i===r)return!0;if(Array.isArray(i)){if(!Array.isArray(r)||i.length!==r.length)return!1;for(var p=0,f=i.length;p<f;p++)if(!u(i[p],r[p]))return!1;return!0}if(i&&typeof i=="object"){var d,_=Object.keys(i);if(!r||typeof r!="object"||!c&&_.length!==Object.keys(r).length)return!1;for(p=0,f=_.length;p<f;p++)if((d=_[p])!=="canvas"&&d!=="group"&&!u(i[d],r[d]))return!1;return!0}}y.util.object.extend(y.Object.prototype,{hasStateChanged:function(i){var r="_"+(i=i||s);return Object.keys(this[r]).length<this[i].length||!u(this[r],this,!0)},saveState:function(i){var r=i&&i.propertySet||s,c="_"+r;return this[c]?(a(this,c,this[r]),i&&i.stateProperties&&a(this,c,i.stateProperties),this):this.setupState(i)},setupState:function(i){var r=(i=i||{}).propertySet||s;return i.propertySet=r,this["_"+r]={},this.saveState(i),this}})}(),function(){var l=y.util.degreesToRadians;y.util.object.extend(y.Object.prototype,{_findTargetCorner:function(s,a){if(!this.hasControls||this.group||!this.canvas||this.canvas._activeObject!==this)return!1;var u,i,r,c=s.x,p=s.y,f=Object.keys(this.oCoords),d=f.length-1;for(this.__corner=0;d>=0;d--)if(r=f[d],this.isControlVisible(r)&&(i=this._getImageLines(a?this.oCoords[r].touchCorner:this.oCoords[r].corner),(u=this._findCrossPoints({x:c,y:p},i))!==0&&u%2==1))return this.__corner=r,r;return!1},forEachControl:function(s){for(var a in this.controls)s(this.controls[a],a,this)},_setCornerCoords:function(){var s=this.oCoords;for(var a in s){var u=this.controls[a];s[a].corner=u.calcCornerCoords(this.angle,this.cornerSize,s[a].x,s[a].y,!1),s[a].touchCorner=u.calcCornerCoords(this.angle,this.touchCornerSize,s[a].x,s[a].y,!0)}},drawSelectionBackground:function(s){if(!this.selectionBackgroundColor||this.canvas&&!this.canvas.interactive||this.canvas&&this.canvas._activeObject!==this)return this;s.save();var a=this.getCenterPoint(),u=this._calculateCurrentDimensions(),i=this.canvas.viewportTransform;return s.translate(a.x,a.y),s.scale(1/i[0],1/i[3]),s.rotate(l(this.angle)),s.fillStyle=this.selectionBackgroundColor,s.fillRect(-u.x/2,-u.y/2,u.x,u.y),s.restore(),this},drawBorders:function(s,a){a=a||{};var u=this._calculateCurrentDimensions(),i=this.borderScaleFactor,r=u.x+i,c=u.y+i,p=a.hasControls!==void 0?a.hasControls:this.hasControls,f=!1;return s.save(),s.strokeStyle=a.borderColor||this.borderColor,this._setLineDash(s,a.borderDashArray||this.borderDashArray),s.strokeRect(-r/2,-c/2,r,c),p&&(s.beginPath(),this.forEachControl(function(d,_,w){d.withConnection&&d.getVisibility(w,_)&&(f=!0,s.moveTo(d.x*r,d.y*c),s.lineTo(d.x*r+d.offsetX,d.y*c+d.offsetY))}),f&&s.stroke()),s.restore(),this},drawBordersInGroup:function(s,a,u){u=u||{};var i=y.util.sizeAfterTransform(this.width,this.height,a),r=this.strokeWidth,c=this.strokeUniform,p=this.borderScaleFactor,f=i.x+r*(c?this.canvas.getZoom():a.scaleX)+p,d=i.y+r*(c?this.canvas.getZoom():a.scaleY)+p;return s.save(),this._setLineDash(s,u.borderDashArray||this.borderDashArray),s.strokeStyle=u.borderColor||this.borderColor,s.strokeRect(-f/2,-d/2,f,d),s.restore(),this},drawControls:function(s,a){a=a||{},s.save();var u,i,r=this.canvas.getRetinaScaling();return s.setTransform(r,0,0,r,0,0),s.strokeStyle=s.fillStyle=a.cornerColor||this.cornerColor,this.transparentCorners||(s.strokeStyle=a.cornerStrokeColor||this.cornerStrokeColor),this._setLineDash(s,a.cornerDashArray||this.cornerDashArray),this.setCoords(),this.group&&(u=this.group.calcTransformMatrix()),this.forEachControl(function(c,p,f){i=f.oCoords[p],c.getVisibility(f,p)&&(u&&(i=y.util.transformPoint(i,u)),c.render(s,i.x,i.y,a,f))}),s.restore(),this},isControlVisible:function(s){return this.controls[s]&&this.controls[s].getVisibility(this,s)},setControlVisible:function(s,a){return this._controlsVisibility||(this._controlsVisibility={}),this._controlsVisibility[s]=a,this},setControlsVisibility:function(s){for(var a in s||(s={}),s)this.setControlVisible(a,s[a]);return this},onDeselect:function(){},onSelect:function(){}})}(),y.util.object.extend(y.StaticCanvas.prototype,{FX_DURATION:500,fxCenterObjectH:function(l,s){var a=function(){},u=(s=s||{}).onComplete||a,i=s.onChange||a,r=this;return y.util.animate({target:this,startValue:l.left,endValue:this.getCenterPoint().x,duration:this.FX_DURATION,onChange:function(c){l.set("left",c),r.requestRenderAll(),i()},onComplete:function(){l.setCoords(),u()}})},fxCenterObjectV:function(l,s){var a=function(){},u=(s=s||{}).onComplete||a,i=s.onChange||a,r=this;return y.util.animate({target:this,startValue:l.top,endValue:this.getCenterPoint().y,duration:this.FX_DURATION,onChange:function(c){l.set("top",c),r.requestRenderAll(),i()},onComplete:function(){l.setCoords(),u()}})},fxRemove:function(l,s){var a=function(){},u=(s=s||{}).onComplete||a,i=s.onChange||a,r=this;return y.util.animate({target:this,startValue:l.opacity,endValue:0,duration:this.FX_DURATION,onChange:function(c){l.set("opacity",c),r.requestRenderAll(),i()},onComplete:function(){r.remove(l),u()}})}}),y.util.object.extend(y.Object.prototype,{animate:function(){if(arguments[0]&&typeof arguments[0]=="object"){var l,s,a=[],u=[];for(l in arguments[0])a.push(l);for(var i=0,r=a.length;i<r;i++)l=a[i],s=i!==r-1,u.push(this._animate(l,arguments[0][l],arguments[1],s));return u}return this._animate.apply(this,arguments)},_animate:function(l,s,a,u){var i,r=this;s=s.toString(),a=a?y.util.object.clone(a):{},~l.indexOf(".")&&(i=l.split("."));var c=r.colorProperties.indexOf(l)>-1||i&&r.colorProperties.indexOf(i[1])>-1,p=i?this.get(i[0])[i[1]]:this.get(l);"from"in a||(a.from=p),c||(s=~s.indexOf("=")?p+parseFloat(s.replace("=","")):parseFloat(s));var f={target:this,startValue:a.from,endValue:s,byValue:a.by,easing:a.easing,duration:a.duration,abort:a.abort&&function(d,_,w){return a.abort.call(r,d,_,w)},onChange:function(d,_,w){i?r[i[0]][i[1]]=d:r.set(l,d),u||a.onChange&&a.onChange(d,_,w)},onComplete:function(d,_,w){u||(r.setCoords(),a.onComplete&&a.onComplete(d,_,w))}};return c?y.util.animateColor(f.startValue,f.endValue,f.duration,f):y.util.animate(f)}}),function(l){var s=l.fabric||(l.fabric={}),a=s.util.object.extend,u=s.util.object.clone,i={x1:1,x2:1,y1:1,y2:1};function r(c,p){var f=c.origin,d=c.axis1,_=c.axis2,w=c.dimension,T=p.nearest,x=p.center,b=p.farthest;return function(){switch(this.get(f)){case T:return Math.min(this.get(d),this.get(_));case x:return Math.min(this.get(d),this.get(_))+.5*this.get(w);case b:return Math.max(this.get(d),this.get(_))}}}s.Line?s.warn("fabric.Line is already defined"):(s.Line=s.util.createClass(s.Object,{type:"line",x1:0,y1:0,x2:0,y2:0,cacheProperties:s.Object.prototype.cacheProperties.concat("x1","x2","y1","y2"),initialize:function(c,p){c||(c=[0,0,0,0]),this.callSuper("initialize",p),this.set("x1",c[0]),this.set("y1",c[1]),this.set("x2",c[2]),this.set("y2",c[3]),this._setWidthHeight(p)},_setWidthHeight:function(c){c||(c={}),this.width=Math.abs(this.x2-this.x1),this.height=Math.abs(this.y2-this.y1),this.left="left"in c?c.left:this._getLeftToOriginX(),this.top="top"in c?c.top:this._getTopToOriginY()},_set:function(c,p){return this.callSuper("_set",c,p),i[c]!==void 0&&this._setWidthHeight(),this},_getLeftToOriginX:r({origin:"originX",axis1:"x1",axis2:"x2",dimension:"width"},{nearest:"left",center:"center",farthest:"right"}),_getTopToOriginY:r({origin:"originY",axis1:"y1",axis2:"y2",dimension:"height"},{nearest:"top",center:"center",farthest:"bottom"}),_render:function(c){c.beginPath();var p=this.calcLinePoints();c.moveTo(p.x1,p.y1),c.lineTo(p.x2,p.y2),c.lineWidth=this.strokeWidth;var f=c.strokeStyle;c.strokeStyle=this.stroke||c.fillStyle,this.stroke&&this._renderStroke(c),c.strokeStyle=f},_findCenterFromElement:function(){return{x:(this.x1+this.x2)/2,y:(this.y1+this.y2)/2}},toObject:function(c){return a(this.callSuper("toObject",c),this.calcLinePoints())},_getNonTransformedDimensions:function(){var c=this.callSuper("_getNonTransformedDimensions");return this.strokeLineCap==="butt"&&(this.width===0&&(c.y-=this.strokeWidth),this.height===0&&(c.x-=this.strokeWidth)),c},calcLinePoints:function(){var c=this.x1<=this.x2?-1:1,p=this.y1<=this.y2?-1:1,f=c*this.width*.5,d=p*this.height*.5;return{x1:f,x2:c*this.width*-.5,y1:d,y2:p*this.height*-.5}},_toSVG:function(){var c=this.calcLinePoints();return["<line ","COMMON_PARTS",'x1="',c.x1,'" y1="',c.y1,'" x2="',c.x2,'" y2="',c.y2,`" />
`]}}),s.Line.ATTRIBUTE_NAMES=s.SHARED_ATTRIBUTES.concat("x1 y1 x2 y2".split(" ")),s.Line.fromElement=function(c,p,f){f=f||{};var d=s.parseAttributes(c,s.Line.ATTRIBUTE_NAMES),_=[d.x1||0,d.y1||0,d.x2||0,d.y2||0];p(new s.Line(_,a(d,f)))},s.Line.fromObject=function(c,p){var f=u(c,!0);f.points=[c.x1,c.y1,c.x2,c.y2],s.Object._fromObject("Line",f,function(d){delete d.points,p&&p(d)},"points")})}(e),function(l){var s=l.fabric||(l.fabric={}),a=s.util.degreesToRadians;s.Circle?s.warn("fabric.Circle is already defined."):(s.Circle=s.util.createClass(s.Object,{type:"circle",radius:0,startAngle:0,endAngle:360,cacheProperties:s.Object.prototype.cacheProperties.concat("radius","startAngle","endAngle"),_set:function(u,i){return this.callSuper("_set",u,i),u==="radius"&&this.setRadius(i),this},toObject:function(u){return this.callSuper("toObject",["radius","startAngle","endAngle"].concat(u))},_toSVG:function(){var u,i=(this.endAngle-this.startAngle)%360;if(i===0)u=["<circle ","COMMON_PARTS",'cx="0" cy="0" ','r="',this.radius,`" />
`];else{var r=a(this.startAngle),c=a(this.endAngle),p=this.radius;u=['<path d="M '+s.util.cos(r)*p+" "+s.util.sin(r)*p," A "+p+" "+p," 0 ",+(i>180?"1":"0")+" 1"," "+s.util.cos(c)*p+" "+s.util.sin(c)*p,'" ',"COMMON_PARTS",` />
`]}return u},_render:function(u){u.beginPath(),u.arc(0,0,this.radius,a(this.startAngle),a(this.endAngle),!1),this._renderPaintInOrder(u)},getRadiusX:function(){return this.get("radius")*this.get("scaleX")},getRadiusY:function(){return this.get("radius")*this.get("scaleY")},setRadius:function(u){return this.radius=u,this.set("width",2*u).set("height",2*u)}}),s.Circle.ATTRIBUTE_NAMES=s.SHARED_ATTRIBUTES.concat("cx cy r".split(" ")),s.Circle.fromElement=function(u,i){var r,c=s.parseAttributes(u,s.Circle.ATTRIBUTE_NAMES);if(!("radius"in(r=c)&&r.radius>=0))throw new Error("value of `r` attribute is required and can not be negative");c.left=(c.left||0)-c.radius,c.top=(c.top||0)-c.radius,i(new s.Circle(c))},s.Circle.fromObject=function(u,i){s.Object._fromObject("Circle",u,i)})}(e),function(l){var s=l.fabric||(l.fabric={});s.Triangle?s.warn("fabric.Triangle is already defined"):(s.Triangle=s.util.createClass(s.Object,{type:"triangle",width:100,height:100,_render:function(a){var u=this.width/2,i=this.height/2;a.beginPath(),a.moveTo(-u,i),a.lineTo(0,-i),a.lineTo(u,i),a.closePath(),this._renderPaintInOrder(a)},_toSVG:function(){var a=this.width/2,u=this.height/2;return["<polygon ","COMMON_PARTS",'points="',[-a+" "+u,"0 "+-u,a+" "+u].join(","),'" />']}}),s.Triangle.fromObject=function(a,u){return s.Object._fromObject("Triangle",a,u)})}(e),function(l){var s=l.fabric||(l.fabric={}),a=2*Math.PI;s.Ellipse?s.warn("fabric.Ellipse is already defined."):(s.Ellipse=s.util.createClass(s.Object,{type:"ellipse",rx:0,ry:0,cacheProperties:s.Object.prototype.cacheProperties.concat("rx","ry"),initialize:function(u){this.callSuper("initialize",u),this.set("rx",u&&u.rx||0),this.set("ry",u&&u.ry||0)},_set:function(u,i){switch(this.callSuper("_set",u,i),u){case"rx":this.rx=i,this.set("width",2*i);break;case"ry":this.ry=i,this.set("height",2*i)}return this},getRx:function(){return this.get("rx")*this.get("scaleX")},getRy:function(){return this.get("ry")*this.get("scaleY")},toObject:function(u){return this.callSuper("toObject",["rx","ry"].concat(u))},_toSVG:function(){return["<ellipse ","COMMON_PARTS",'cx="0" cy="0" ','rx="',this.rx,'" ry="',this.ry,`" />
`]},_render:function(u){u.beginPath(),u.save(),u.transform(1,0,0,this.ry/this.rx,0,0),u.arc(0,0,this.rx,0,a,!1),u.restore(),this._renderPaintInOrder(u)}}),s.Ellipse.ATTRIBUTE_NAMES=s.SHARED_ATTRIBUTES.concat("cx cy rx ry".split(" ")),s.Ellipse.fromElement=function(u,i){var r=s.parseAttributes(u,s.Ellipse.ATTRIBUTE_NAMES);r.left=(r.left||0)-r.rx,r.top=(r.top||0)-r.ry,i(new s.Ellipse(r))},s.Ellipse.fromObject=function(u,i){s.Object._fromObject("Ellipse",u,i)})}(e),function(l){var s=l.fabric||(l.fabric={}),a=s.util.object.extend;s.Rect?s.warn("fabric.Rect is already defined"):(s.Rect=s.util.createClass(s.Object,{stateProperties:s.Object.prototype.stateProperties.concat("rx","ry"),type:"rect",rx:0,ry:0,cacheProperties:s.Object.prototype.cacheProperties.concat("rx","ry"),initialize:function(u){this.callSuper("initialize",u),this._initRxRy()},_initRxRy:function(){this.rx&&!this.ry?this.ry=this.rx:this.ry&&!this.rx&&(this.rx=this.ry)},_render:function(u){var i=this.rx?Math.min(this.rx,this.width/2):0,r=this.ry?Math.min(this.ry,this.height/2):0,c=this.width,p=this.height,f=-this.width/2,d=-this.height/2,_=i!==0||r!==0,w=.4477152502;u.beginPath(),u.moveTo(f+i,d),u.lineTo(f+c-i,d),_&&u.bezierCurveTo(f+c-w*i,d,f+c,d+w*r,f+c,d+r),u.lineTo(f+c,d+p-r),_&&u.bezierCurveTo(f+c,d+p-w*r,f+c-w*i,d+p,f+c-i,d+p),u.lineTo(f+i,d+p),_&&u.bezierCurveTo(f+w*i,d+p,f,d+p-w*r,f,d+p-r),u.lineTo(f,d+r),_&&u.bezierCurveTo(f,d+w*r,f+w*i,d,f+i,d),u.closePath(),this._renderPaintInOrder(u)},toObject:function(u){return this.callSuper("toObject",["rx","ry"].concat(u))},_toSVG:function(){return["<rect ","COMMON_PARTS",'x="',-this.width/2,'" y="',-this.height/2,'" rx="',this.rx,'" ry="',this.ry,'" width="',this.width,'" height="',this.height,`" />
`]}}),s.Rect.ATTRIBUTE_NAMES=s.SHARED_ATTRIBUTES.concat("x y rx ry width height".split(" ")),s.Rect.fromElement=function(u,i,r){if(!u)return i(null);r=r||{};var c=s.parseAttributes(u,s.Rect.ATTRIBUTE_NAMES);c.left=c.left||0,c.top=c.top||0,c.height=c.height||0,c.width=c.width||0;var p=new s.Rect(a(r?s.util.object.clone(r):{},c));p.visible=p.visible&&p.width>0&&p.height>0,i(p)},s.Rect.fromObject=function(u,i){return s.Object._fromObject("Rect",u,i)})}(e),function(l){var s=l.fabric||(l.fabric={}),a=s.util.object.extend,u=s.util.array.min,i=s.util.array.max,r=s.util.toFixed,c=s.util.projectStrokeOnPoints;s.Polyline?s.warn("fabric.Polyline is already defined"):(s.Polyline=s.util.createClass(s.Object,{type:"polyline",points:null,exactBoundingBox:!1,cacheProperties:s.Object.prototype.cacheProperties.concat("points"),initialize:function(p,f){f=f||{},this.points=p||[],this.callSuper("initialize",f),this._setPositionDimensions(f)},_projectStrokeOnPoints:function(){return c(this.points,this,!0)},_setPositionDimensions:function(p){var f,d=this._calcDimensions(p),_=this.exactBoundingBox?this.strokeWidth:0;this.width=d.width-_,this.height=d.height-_,p.fromSVG||(f=this.translateToGivenOrigin({x:d.left-this.strokeWidth/2+_/2,y:d.top-this.strokeWidth/2+_/2},"left","top",this.originX,this.originY)),p.left===void 0&&(this.left=p.fromSVG?d.left:f.x),p.top===void 0&&(this.top=p.fromSVG?d.top:f.y),this.pathOffset={x:d.left+this.width/2+_/2,y:d.top+this.height/2+_/2}},_calcDimensions:function(){var p=this.exactBoundingBox?this._projectStrokeOnPoints():this.points,f=u(p,"x")||0,d=u(p,"y")||0;return{left:f,top:d,width:(i(p,"x")||0)-f,height:(i(p,"y")||0)-d}},toObject:function(p){return a(this.callSuper("toObject",p),{points:this.points.concat()})},_toSVG:function(){for(var p=[],f=this.pathOffset.x,d=this.pathOffset.y,_=s.Object.NUM_FRACTION_DIGITS,w=0,T=this.points.length;w<T;w++)p.push(r(this.points[w].x-f,_),",",r(this.points[w].y-d,_)," ");return["<"+this.type+" ","COMMON_PARTS",'points="',p.join(""),`" />
`]},commonRender:function(p){var f,d=this.points.length,_=this.pathOffset.x,w=this.pathOffset.y;if(!d||isNaN(this.points[d-1].y))return!1;p.beginPath(),p.moveTo(this.points[0].x-_,this.points[0].y-w);for(var T=0;T<d;T++)f=this.points[T],p.lineTo(f.x-_,f.y-w);return!0},_render:function(p){this.commonRender(p)&&this._renderPaintInOrder(p)},complexity:function(){return this.get("points").length}}),s.Polyline.ATTRIBUTE_NAMES=s.SHARED_ATTRIBUTES.concat(),s.Polyline.fromElementGenerator=function(p){return function(f,d,_){if(!f)return d(null);_||(_={});var w=s.parsePointsAttribute(f.getAttribute("points")),T=s.parseAttributes(f,s[p].ATTRIBUTE_NAMES);T.fromSVG=!0,d(new s[p](w,a(T,_)))}},s.Polyline.fromElement=s.Polyline.fromElementGenerator("Polyline"),s.Polyline.fromObject=function(p,f){return s.Object._fromObject("Polyline",p,f,"points")})}(e),function(l){var s=l.fabric||(l.fabric={}),a=s.util.projectStrokeOnPoints;s.Polygon?s.warn("fabric.Polygon is already defined"):(s.Polygon=s.util.createClass(s.Polyline,{type:"polygon",_projectStrokeOnPoints:function(){return a(this.points,this)},_render:function(u){this.commonRender(u)&&(u.closePath(),this._renderPaintInOrder(u))}}),s.Polygon.ATTRIBUTE_NAMES=s.SHARED_ATTRIBUTES.concat(),s.Polygon.fromElement=s.Polyline.fromElementGenerator("Polygon"),s.Polygon.fromObject=function(u,i){s.Object._fromObject("Polygon",u,i,"points")})}(e),function(l){var s=l.fabric||(l.fabric={}),a=s.util.array.min,u=s.util.array.max,i=s.util.object.extend,r=s.util.object.clone,c=s.util.toFixed;s.Path?s.warn("fabric.Path is already defined"):(s.Path=s.util.createClass(s.Object,{type:"path",path:null,cacheProperties:s.Object.prototype.cacheProperties.concat("path","fillRule"),stateProperties:s.Object.prototype.stateProperties.concat("path"),initialize:function(p,f){delete(f=r(f||{})).path,this.callSuper("initialize",f),this._setPath(p||[],f)},_setPath:function(p,f){this.path=s.util.makePathSimpler(Array.isArray(p)?p:s.util.parsePath(p)),s.Polyline.prototype._setPositionDimensions.call(this,f||{})},_renderPathCommands:function(p){var f,d=0,_=0,w=0,T=0,x=0,b=0,F=-this.pathOffset.x,B=-this.pathOffset.y;p.beginPath();for(var z=0,$=this.path.length;z<$;++z)switch((f=this.path[z])[0]){case"L":w=f[1],T=f[2],p.lineTo(w+F,T+B);break;case"M":d=w=f[1],_=T=f[2],p.moveTo(w+F,T+B);break;case"C":w=f[5],T=f[6],x=f[3],b=f[4],p.bezierCurveTo(f[1]+F,f[2]+B,x+F,b+B,w+F,T+B);break;case"Q":p.quadraticCurveTo(f[1]+F,f[2]+B,f[3]+F,f[4]+B),w=f[3],T=f[4],x=f[1],b=f[2];break;case"z":case"Z":w=d,T=_,p.closePath()}},_render:function(p){this._renderPathCommands(p),this._renderPaintInOrder(p)},toString:function(){return"#<fabric.Path ("+this.complexity()+'): { "top": '+this.top+', "left": '+this.left+" }>"},toObject:function(p){return i(this.callSuper("toObject",p),{path:this.path.map(function(f){return f.slice()})})},toDatalessObject:function(p){var f=this.toObject(["sourcePath"].concat(p));return f.sourcePath&&delete f.path,f},_toSVG:function(){return["<path ","COMMON_PARTS",'d="',s.util.joinPath(this.path),'" stroke-linecap="round" ',`/>
`]},_getOffsetTransform:function(){var p=s.Object.NUM_FRACTION_DIGITS;return" translate("+c(-this.pathOffset.x,p)+", "+c(-this.pathOffset.y,p)+")"},toClipPathSVG:function(p){var f=this._getOffsetTransform();return"	"+this._createBaseClipPathSVGMarkup(this._toSVG(),{reviver:p,additionalTransform:f})},toSVG:function(p){var f=this._getOffsetTransform();return this._createBaseSVGMarkup(this._toSVG(),{reviver:p,additionalTransform:f})},complexity:function(){return this.path.length},_calcDimensions:function(){for(var p,f,d=[],_=[],w=0,T=0,x=0,b=0,F=0,B=this.path.length;F<B;++F){switch((p=this.path[F])[0]){case"L":x=p[1],b=p[2],f=[];break;case"M":w=x=p[1],T=b=p[2],f=[];break;case"C":f=s.util.getBoundsOfCurve(x,b,p[1],p[2],p[3],p[4],p[5],p[6]),x=p[5],b=p[6];break;case"Q":f=s.util.getBoundsOfCurve(x,b,p[1],p[2],p[1],p[2],p[3],p[4]),x=p[3],b=p[4];break;case"z":case"Z":x=w,b=T}f.forEach(function(Q){d.push(Q.x),_.push(Q.y)}),d.push(x),_.push(b)}var z=a(d)||0,$=a(_)||0;return{left:z,top:$,width:(u(d)||0)-z,height:(u(_)||0)-$}}}),s.Path.fromObject=function(p,f){if(typeof p.sourcePath=="string"){var d=p.sourcePath;s.loadSVGFromURL(d,function(_){var w=_[0];w.setOptions(p),f&&f(w)})}else s.Object._fromObject("Path",p,f,"path")},s.Path.ATTRIBUTE_NAMES=s.SHARED_ATTRIBUTES.concat(["d"]),s.Path.fromElement=function(p,f,d){var _=s.parseAttributes(p,s.Path.ATTRIBUTE_NAMES);_.fromSVG=!0,f(new s.Path(_.d,i(_,d)))})}(e),function(l){var s=l.fabric||(l.fabric={}),a=s.util.array.min,u=s.util.array.max;s.Group||(s.Group=s.util.createClass(s.Object,s.Collection,{type:"group",strokeWidth:0,subTargetCheck:!1,cacheProperties:[],useSetOnGroup:!1,initialize:function(i,r,c){r=r||{},this._objects=[],c&&this.callSuper("initialize",r),this._objects=i||[];for(var p=this._objects.length;p--;)this._objects[p].group=this;if(c)this._updateObjectsACoords();else{var f=r&&r.centerPoint;r.originX!==void 0&&(this.originX=r.originX),r.originY!==void 0&&(this.originY=r.originY),f||this._calcBounds(),this._updateObjectsCoords(f),delete r.centerPoint,this.callSuper("initialize",r)}this.setCoords()},_updateObjectsACoords:function(){for(var i=this._objects.length;i--;)this._objects[i].setCoords(!0)},_updateObjectsCoords:function(i){i=i||this.getCenterPoint();for(var r=this._objects.length;r--;)this._updateObjectCoords(this._objects[r],i)},_updateObjectCoords:function(i,r){var c=i.left,p=i.top;i.set({left:c-r.x,top:p-r.y}),i.group=this,i.setCoords(!0)},toString:function(){return"#<fabric.Group: ("+this.complexity()+")>"},addWithUpdate:function(i){var r=!!this.group;return this._restoreObjectsState(),s.util.resetObjectTransform(this),i&&(r&&s.util.removeTransformFromObject(i,this.group.calcTransformMatrix()),this._objects.push(i),i.group=this,i._set("canvas",this.canvas)),this._calcBounds(),this._updateObjectsCoords(),this.dirty=!0,r?this.group.addWithUpdate():this.setCoords(),this},removeWithUpdate:function(i){return this._restoreObjectsState(),s.util.resetObjectTransform(this),this.remove(i),this._calcBounds(),this._updateObjectsCoords(),this.setCoords(),this.dirty=!0,this},_onObjectAdded:function(i){this.dirty=!0,i.group=this,i._set("canvas",this.canvas)},_onObjectRemoved:function(i){this.dirty=!0,delete i.group},_set:function(i,r){var c=this._objects.length;if(this.useSetOnGroup)for(;c--;)this._objects[c].setOnGroup(i,r);if(i==="canvas")for(;c--;)this._objects[c]._set(i,r);s.Object.prototype._set.call(this,i,r)},toObject:function(i){var r=this.includeDefaultValues,c=this._objects.filter(function(f){return!f.excludeFromExport}).map(function(f){var d=f.includeDefaultValues;f.includeDefaultValues=r;var _=f.toObject(i);return f.includeDefaultValues=d,_}),p=s.Object.prototype.toObject.call(this,i);return p.objects=c,p},toDatalessObject:function(i){var r,c=this.sourcePath;if(c)r=c;else{var p=this.includeDefaultValues;r=this._objects.map(function(d){var _=d.includeDefaultValues;d.includeDefaultValues=p;var w=d.toDatalessObject(i);return d.includeDefaultValues=_,w})}var f=s.Object.prototype.toDatalessObject.call(this,i);return f.objects=r,f},render:function(i){this._transformDone=!0,this.callSuper("render",i),this._transformDone=!1},shouldCache:function(){var i=s.Object.prototype.shouldCache.call(this);if(i){for(var r=0,c=this._objects.length;r<c;r++)if(this._objects[r].willDrawShadow())return this.ownCaching=!1,!1}return i},willDrawShadow:function(){if(s.Object.prototype.willDrawShadow.call(this))return!0;for(var i=0,r=this._objects.length;i<r;i++)if(this._objects[i].willDrawShadow())return!0;return!1},isOnACache:function(){return this.ownCaching||this.group&&this.group.isOnACache()},drawObject:function(i){for(var r=0,c=this._objects.length;r<c;r++)this._objects[r].render(i);this._drawClipPath(i,this.clipPath)},isCacheDirty:function(i){if(this.callSuper("isCacheDirty",i))return!0;if(!this.statefullCache)return!1;for(var r=0,c=this._objects.length;r<c;r++)if(this._objects[r].isCacheDirty(!0)){if(this._cacheCanvas){var p=this.cacheWidth/this.zoomX,f=this.cacheHeight/this.zoomY;this._cacheContext.clearRect(-p/2,-f/2,p,f)}return!0}return!1},_restoreObjectsState:function(){var i=this.calcOwnMatrix();return this._objects.forEach(function(r){s.util.addTransformToObject(r,i),delete r.group,r.setCoords()}),this},destroy:function(){return this._objects.forEach(function(i){i.set("dirty",!0)}),this._restoreObjectsState()},dispose:function(){this.callSuper("dispose"),this.forEachObject(function(i){i.dispose&&i.dispose()}),this._objects=[]},toActiveSelection:function(){if(this.canvas){var i=this._objects,r=this.canvas;this._objects=[];var c=this.toObject();delete c.objects;var p=new s.ActiveSelection([]);return p.set(c),p.type="activeSelection",r.remove(this),i.forEach(function(f){f.group=p,f.dirty=!0,r.add(f)}),p.canvas=r,p._objects=i,r._activeObject=p,p.setCoords(),p}},ungroupOnCanvas:function(){return this._restoreObjectsState()},setObjectsCoords:function(){return this.forEachObject(function(i){i.setCoords(!0)}),this},_calcBounds:function(i){for(var r,c,p,f,d=[],_=[],w=["tr","br","bl","tl"],T=0,x=this._objects.length,b=w.length;T<x;++T){for(p=(r=this._objects[T]).calcACoords(),f=0;f<b;f++)c=w[f],d.push(p[c].x),_.push(p[c].y);r.aCoords=p}this._getBounds(d,_,i)},_getBounds:function(i,r,c){var p=new s.Point(a(i),a(r)),f=new s.Point(u(i),u(r)),d=p.y||0,_=p.x||0,w=f.x-p.x||0,T=f.y-p.y||0;this.width=w,this.height=T,c||this.setPositionByOrigin({x:_,y:d},"left","top")},_toSVG:function(i){for(var r=["<g ","COMMON_PARTS",` >
`],c=0,p=this._objects.length;c<p;c++)r.push("		",this._objects[c].toSVG(i));return r.push(`</g>
`),r},getSvgStyles:function(){var i=this.opacity!==void 0&&this.opacity!==1?"opacity: "+this.opacity+";":"",r=this.visible?"":" visibility: hidden;";return[i,this.getSvgFilter(),r].join("")},toClipPathSVG:function(i){for(var r=[],c=0,p=this._objects.length;c<p;c++)r.push("	",this._objects[c].toClipPathSVG(i));return this._createBaseClipPathSVGMarkup(r,{reviver:i})}}),s.Group.fromObject=function(i,r){var c=i.objects,p=s.util.object.clone(i,!0);delete p.objects,typeof c!="string"?s.util.enlivenObjects(c,function(f){var d=s.util.object.clone(i,!0);delete d.objects,s.util.enlivenObjectEnlivables(i,d,function(){r&&r(new s.Group(f,d,!0))})}):s.loadSVGFromURL(c,function(f){var d=s.util.groupSVGElements(f,i,c);d.set(p),r&&r(d)})})}(e),function(l){var s=l.fabric||(l.fabric={});s.ActiveSelection||(s.ActiveSelection=s.util.createClass(s.Group,{type:"activeSelection",initialize:function(a,u){u=u||{},this._objects=a||[];for(var i=this._objects.length;i--;)this._objects[i].group=this;u.originX&&(this.originX=u.originX),u.originY&&(this.originY=u.originY),this._calcBounds(),this._updateObjectsCoords(),s.Object.prototype.initialize.call(this,u),this.setCoords()},toGroup:function(){var a=this._objects.concat();this._objects=[];var u=s.Object.prototype.toObject.call(this),i=new s.Group([]);if(delete u.type,i.set(u),a.forEach(function(c){c.canvas.remove(c),c.group=i}),i._objects=a,!this.canvas)return i;var r=this.canvas;return r.add(i),r._activeObject=i,i.setCoords(),i},onDeselect:function(){return this.destroy(),!1},toString:function(){return"#<fabric.ActiveSelection: ("+this.complexity()+")>"},shouldCache:function(){return!1},isOnACache:function(){return!1},_renderControls:function(a,u,i){a.save(),a.globalAlpha=this.isMoving?this.borderOpacityWhenMoving:1,this.callSuper("_renderControls",a,u),(i=i||{}).hasControls===void 0&&(i.hasControls=!1),i.forActiveSelection=!0;for(var r=0,c=this._objects.length;r<c;r++)this._objects[r]._renderControls(a,i);a.restore()}}),s.ActiveSelection.fromObject=function(a,u){s.util.enlivenObjects(a.objects,function(i){delete a.objects,u&&u(new s.ActiveSelection(i,a,!0))})})}(e),function(l){var s=y.util.object.extend;l.fabric||(l.fabric={}),l.fabric.Image?y.warn("fabric.Image is already defined."):(y.Image=y.util.createClass(y.Object,{type:"image",strokeWidth:0,srcFromAttribute:!1,_lastScaleX:1,_lastScaleY:1,_filterScalingX:1,_filterScalingY:1,minimumScaleTrigger:.5,stateProperties:y.Object.prototype.stateProperties.concat("cropX","cropY"),cacheProperties:y.Object.prototype.cacheProperties.concat("cropX","cropY"),cacheKey:"",cropX:0,cropY:0,imageSmoothing:!0,initialize:function(a,u){u||(u={}),this.filters=[],this.cacheKey="texture"+y.Object.__uid++,this.callSuper("initialize",u),this._initElement(a,u)},getElement:function(){return this._element||{}},setElement:function(a,u){return this.removeTexture(this.cacheKey),this.removeTexture(this.cacheKey+"_filtered"),this._element=a,this._originalElement=a,this._initConfig(u),this.filters.length!==0&&this.applyFilters(),this.resizeFilter&&this.applyResizeFilters(),this},removeTexture:function(a){var u=y.filterBackend;u&&u.evictCachesForKey&&u.evictCachesForKey(a)},dispose:function(){this.callSuper("dispose"),this.removeTexture(this.cacheKey),this.removeTexture(this.cacheKey+"_filtered"),this._cacheContext=void 0,["_originalElement","_element","_filteredEl","_cacheCanvas"].forEach((function(a){y.util.cleanUpJsdomNode(this[a]),this[a]=void 0}).bind(this))},getCrossOrigin:function(){return this._originalElement&&(this._originalElement.crossOrigin||null)},getOriginalSize:function(){var a=this.getElement();return{width:a.naturalWidth||a.width,height:a.naturalHeight||a.height}},_stroke:function(a){if(this.stroke&&this.strokeWidth!==0){var u=this.width/2,i=this.height/2;a.beginPath(),a.moveTo(-u,-i),a.lineTo(u,-i),a.lineTo(u,i),a.lineTo(-u,i),a.lineTo(-u,-i),a.closePath()}},toObject:function(a){var u=[];this.filters.forEach(function(r){r&&u.push(r.toObject())});var i=s(this.callSuper("toObject",["cropX","cropY"].concat(a)),{src:this.getSrc(),crossOrigin:this.getCrossOrigin(),filters:u});return this.resizeFilter&&(i.resizeFilter=this.resizeFilter.toObject()),i},hasCrop:function(){return this.cropX||this.cropY||this.width<this._element.width||this.height<this._element.height},_toSVG:function(){var a,u=[],i=[],r=this._element,c=-this.width/2,p=-this.height/2,f="",d="";if(!r)return[];if(this.hasCrop()){var _=y.Object.__uid++;u.push('<clipPath id="imageCrop_'+_+`">
`,'	<rect x="'+c+'" y="'+p+'" width="'+this.width+'" height="'+this.height+`" />
`,`</clipPath>
`),f=' clip-path="url(#imageCrop_'+_+')" '}if(this.imageSmoothing||(d='" image-rendering="optimizeSpeed'),i.push("	<image ","COMMON_PARTS",'xlink:href="',this.getSvgSrc(!0),'" x="',c-this.cropX,'" y="',p-this.cropY,'" width="',r.width||r.naturalWidth,'" height="',r.height||r.height,d,'"',f,`></image>
`),this.stroke||this.strokeDashArray){var w=this.fill;this.fill=null,a=["	<rect ",'x="',c,'" y="',p,'" width="',this.width,'" height="',this.height,'" style="',this.getSvgStyles(),`"/>
`],this.fill=w}return this.paintFirst!=="fill"?u.concat(a,i):u.concat(i,a)},getSrc:function(a){var u=a?this._element:this._originalElement;return u?u.toDataURL?u.toDataURL():this.srcFromAttribute?u.getAttribute("src"):u.src:this.src||""},setSrc:function(a,u,i){return y.util.loadImage(a,function(r,c){this.setElement(r,i),this._setWidthHeight(),u&&u(this,c)},this,i&&i.crossOrigin),this},toString:function(){return'#<fabric.Image: { src: "'+this.getSrc()+'" }>'},applyResizeFilters:function(){var a=this.resizeFilter,u=this.minimumScaleTrigger,i=this.getTotalObjectScaling(),r=i.scaleX,c=i.scaleY,p=this._filteredEl||this._originalElement;if(this.group&&this.set("dirty",!0),!a||r>u&&c>u)return this._element=p,this._filterScalingX=1,this._filterScalingY=1,this._lastScaleX=r,void(this._lastScaleY=c);y.filterBackend||(y.filterBackend=y.initFilterBackend());var f=y.util.createCanvasElement(),d=this._filteredEl?this.cacheKey+"_filtered":this.cacheKey,_=p.width,w=p.height;f.width=_,f.height=w,this._element=f,this._lastScaleX=a.scaleX=r,this._lastScaleY=a.scaleY=c,y.filterBackend.applyFilters([a],p,_,w,this._element,d),this._filterScalingX=f.width/this._originalElement.width,this._filterScalingY=f.height/this._originalElement.height},applyFilters:function(a){if(a=(a=a||this.filters||[]).filter(function(p){return p&&!p.isNeutralState()}),this.set("dirty",!0),this.removeTexture(this.cacheKey+"_filtered"),a.length===0)return this._element=this._originalElement,this._filteredEl=null,this._filterScalingX=1,this._filterScalingY=1,this;var u=this._originalElement,i=u.naturalWidth||u.width,r=u.naturalHeight||u.height;if(this._element===this._originalElement){var c=y.util.createCanvasElement();c.width=i,c.height=r,this._element=c,this._filteredEl=c}else this._element=this._filteredEl,this._filteredEl.getContext("2d").clearRect(0,0,i,r),this._lastScaleX=1,this._lastScaleY=1;return y.filterBackend||(y.filterBackend=y.initFilterBackend()),y.filterBackend.applyFilters(a,this._originalElement,i,r,this._element,this.cacheKey),this._originalElement.width===this._element.width&&this._originalElement.height===this._element.height||(this._filterScalingX=this._element.width/this._originalElement.width,this._filterScalingY=this._element.height/this._originalElement.height),this},_render:function(a){y.util.setImageSmoothing(a,this.imageSmoothing),this.isMoving!==!0&&this.resizeFilter&&this._needsResize()&&this.applyResizeFilters(),this._stroke(a),this._renderPaintInOrder(a)},drawCacheOnCanvas:function(a){y.util.setImageSmoothing(a,this.imageSmoothing),y.Object.prototype.drawCacheOnCanvas.call(this,a)},shouldCache:function(){return this.needsItsOwnCache()},_renderFill:function(a){var u=this._element;if(u){var i=this._filterScalingX,r=this._filterScalingY,c=this.width,p=this.height,f=Math.min,d=Math.max,_=d(this.cropX,0),w=d(this.cropY,0),T=u.naturalWidth||u.width,x=u.naturalHeight||u.height,b=_*i,F=w*r,B=f(c*i,T-b),z=f(p*r,x-F),$=-c/2,Q=-p/2,q=f(c,T/i-_),O=f(p,x/r-w);u&&a.drawImage(u,b,F,B,z,$,Q,q,O)}},_needsResize:function(){var a=this.getTotalObjectScaling();return a.scaleX!==this._lastScaleX||a.scaleY!==this._lastScaleY},_resetWidthHeight:function(){this.set(this.getOriginalSize())},_initElement:function(a,u){this.setElement(y.util.getById(a),u),y.util.addClass(this.getElement(),y.Image.CSS_CANVAS)},_initConfig:function(a){a||(a={}),this.setOptions(a),this._setWidthHeight(a)},_initFilters:function(a,u){a&&a.length?y.util.enlivenObjects(a,function(i){u&&u(i)},"fabric.Image.filters"):u&&u()},_setWidthHeight:function(a){a||(a={});var u=this.getElement();this.width=a.width||u.naturalWidth||u.width||0,this.height=a.height||u.naturalHeight||u.height||0},parsePreserveAspectRatioAttribute:function(){var a,u=y.util.parsePreserveAspectRatioAttribute(this.preserveAspectRatio||""),i=this._element.width,r=this._element.height,c=1,p=1,f=0,d=0,_=0,w=0,T=this.width,x=this.height,b={width:T,height:x};return!u||u.alignX==="none"&&u.alignY==="none"?(c=T/i,p=x/r):(u.meetOrSlice==="meet"&&(a=(T-i*(c=p=y.util.findScaleToFit(this._element,b)))/2,u.alignX==="Min"&&(f=-a),u.alignX==="Max"&&(f=a),a=(x-r*p)/2,u.alignY==="Min"&&(d=-a),u.alignY==="Max"&&(d=a)),u.meetOrSlice==="slice"&&(a=i-T/(c=p=y.util.findScaleToCover(this._element,b)),u.alignX==="Mid"&&(_=a/2),u.alignX==="Max"&&(_=a),a=r-x/p,u.alignY==="Mid"&&(w=a/2),u.alignY==="Max"&&(w=a),i=T/c,r=x/p)),{width:i,height:r,scaleX:c,scaleY:p,offsetLeft:f,offsetTop:d,cropX:_,cropY:w}}}),y.Image.CSS_CANVAS="canvas-img",y.Image.prototype.getSvgSrc=y.Image.prototype.getSrc,y.Image.fromObject=function(a,u){var i=y.util.object.clone(a);y.util.loadImage(i.src,function(r,c){c?u&&u(null,!0):y.Image.prototype._initFilters.call(i,i.filters,function(p){i.filters=p||[],y.Image.prototype._initFilters.call(i,[i.resizeFilter],function(f){i.resizeFilter=f[0],y.util.enlivenObjectEnlivables(i,i,function(){var d=new y.Image(r,i);u(d,!1)})})})},null,i.crossOrigin)},y.Image.fromURL=function(a,u,i){y.util.loadImage(a,function(r,c){u&&u(new y.Image(r,i),c)},null,i&&i.crossOrigin)},y.Image.ATTRIBUTE_NAMES=y.SHARED_ATTRIBUTES.concat("x y width height preserveAspectRatio xlink:href crossOrigin image-rendering".split(" ")),y.Image.fromElement=function(a,u,i){var r=y.parseAttributes(a,y.Image.ATTRIBUTE_NAMES);y.Image.fromURL(r["xlink:href"],u,s(i?y.util.object.clone(i):{},r))})}(e),y.util.object.extend(y.Object.prototype,{_getAngleValueForStraighten:function(){var l=this.angle%360;return l>0?90*Math.round((l-1)/90):90*Math.round(l/90)},straighten:function(){return this.rotate(this._getAngleValueForStraighten())},fxStraighten:function(l){var s=function(){},a=(l=l||{}).onComplete||s,u=l.onChange||s,i=this;return y.util.animate({target:this,startValue:this.get("angle"),endValue:this._getAngleValueForStraighten(),duration:this.FX_DURATION,onChange:function(r){i.rotate(r),u()},onComplete:function(){i.setCoords(),a()}})}}),y.util.object.extend(y.StaticCanvas.prototype,{straightenObject:function(l){return l.straighten(),this.requestRenderAll(),this},fxStraightenObject:function(l){return l.fxStraighten({onChange:this.requestRenderAllBound})}}),function(){function l(a,u){var i="precision "+u+` float;
void main(){}`,r=a.createShader(a.FRAGMENT_SHADER);return a.shaderSource(r,i),a.compileShader(r),!!a.getShaderParameter(r,a.COMPILE_STATUS)}function s(a){a&&a.tileSize&&(this.tileSize=a.tileSize),this.setupGLContext(this.tileSize,this.tileSize),this.captureGPUInfo()}y.isWebglSupported=function(a){if(y.isLikelyNode)return!1;a=a||y.WebglFilterBackend.prototype.tileSize;var u=document.createElement("canvas"),i=u.getContext("webgl")||u.getContext("experimental-webgl"),r=!1;if(i){y.maxTextureSize=i.getParameter(i.MAX_TEXTURE_SIZE),r=y.maxTextureSize>=a;for(var c=["highp","mediump","lowp"],p=0;p<3;p++)if(l(i,c[p])){y.webGlPrecision=c[p];break}}return this.isSupported=r,r},y.WebglFilterBackend=s,s.prototype={tileSize:2048,resources:{},setupGLContext:function(a,u){this.dispose(),this.createWebGLCanvas(a,u),this.aPosition=new Float32Array([0,0,0,1,1,0,1,1]),this.chooseFastestCopyGLTo2DMethod(a,u)},chooseFastestCopyGLTo2DMethod:function(a,u){var i,r=window.performance!==void 0;try{new ImageData(1,1),i=!0}catch{i=!1}var c=typeof ArrayBuffer<"u",p=typeof Uint8ClampedArray<"u";if(r&&i&&c&&p){var f=y.util.createCanvasElement(),d=new ArrayBuffer(a*u*4);if(y.forceGLPutImageData)return this.imageBuffer=d,void(this.copyGLTo2D=ge);var _,w,T={imageBuffer:d,destinationWidth:a,destinationHeight:u,targetCanvas:f};f.width=a,f.height=u,_=window.performance.now(),Ce.call(T,this.gl,T),w=window.performance.now()-_,_=window.performance.now(),ge.call(T,this.gl,T),w>window.performance.now()-_?(this.imageBuffer=d,this.copyGLTo2D=ge):this.copyGLTo2D=Ce}},createWebGLCanvas:function(a,u){var i=y.util.createCanvasElement();i.width=a,i.height=u;var r={alpha:!0,premultipliedAlpha:!1,depth:!1,stencil:!1,antialias:!1},c=i.getContext("webgl",r);c||(c=i.getContext("experimental-webgl",r)),c&&(c.clearColor(0,0,0,0),this.canvas=i,this.gl=c)},applyFilters:function(a,u,i,r,c,p){var f,d=this.gl;p&&(f=this.getCachedTexture(p,u));var _={originalWidth:u.width||u.originalWidth,originalHeight:u.height||u.originalHeight,sourceWidth:i,sourceHeight:r,destinationWidth:i,destinationHeight:r,context:d,sourceTexture:this.createTexture(d,i,r,!f&&u),targetTexture:this.createTexture(d,i,r),originalTexture:f||this.createTexture(d,i,r,!f&&u),passes:a.length,webgl:!0,aPosition:this.aPosition,programCache:this.programCache,pass:0,filterBackend:this,targetCanvas:c},w=d.createFramebuffer();return d.bindFramebuffer(d.FRAMEBUFFER,w),a.forEach(function(T){T&&T.applyTo(_)}),function(T){var x=T.targetCanvas,b=x.width,F=x.height,B=T.destinationWidth,z=T.destinationHeight;b===B&&F===z||(x.width=B,x.height=z)}(_),this.copyGLTo2D(d,_),d.bindTexture(d.TEXTURE_2D,null),d.deleteTexture(_.sourceTexture),d.deleteTexture(_.targetTexture),d.deleteFramebuffer(w),c.getContext("2d").setTransform(1,0,0,1,0,0),_},dispose:function(){this.canvas&&(this.canvas=null,this.gl=null),this.clearWebGLCaches()},clearWebGLCaches:function(){this.programCache={},this.textureCache={}},createTexture:function(a,u,i,r){var c=a.createTexture();return a.bindTexture(a.TEXTURE_2D,c),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MAG_FILTER,a.NEAREST),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MIN_FILTER,a.NEAREST),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_WRAP_S,a.CLAMP_TO_EDGE),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_WRAP_T,a.CLAMP_TO_EDGE),r?a.texImage2D(a.TEXTURE_2D,0,a.RGBA,a.RGBA,a.UNSIGNED_BYTE,r):a.texImage2D(a.TEXTURE_2D,0,a.RGBA,u,i,0,a.RGBA,a.UNSIGNED_BYTE,null),c},getCachedTexture:function(a,u){if(this.textureCache[a])return this.textureCache[a];var i=this.createTexture(this.gl,u.width,u.height,u);return this.textureCache[a]=i,i},evictCachesForKey:function(a){this.textureCache[a]&&(this.gl.deleteTexture(this.textureCache[a]),delete this.textureCache[a])},copyGLTo2D:Ce,captureGPUInfo:function(){if(this.gpuInfo)return this.gpuInfo;var a=this.gl,u={renderer:"",vendor:""};if(!a)return u;var i=a.getExtension("WEBGL_debug_renderer_info");if(i){var r=a.getParameter(i.UNMASKED_RENDERER_WEBGL),c=a.getParameter(i.UNMASKED_VENDOR_WEBGL);r&&(u.renderer=r.toLowerCase()),c&&(u.vendor=c.toLowerCase())}return this.gpuInfo=u,u}}}(),function(){var l=function(){};function s(){}y.Canvas2dFilterBackend=s,s.prototype={evictCachesForKey:l,dispose:l,clearWebGLCaches:l,resources:{},applyFilters:function(a,u,i,r,c){var p=c.getContext("2d");p.drawImage(u,0,0,i,r);var f={sourceWidth:i,sourceHeight:r,imageData:p.getImageData(0,0,i,r),originalEl:u,originalImageData:p.getImageData(0,0,i,r),canvasEl:c,ctx:p,filterBackend:this};return a.forEach(function(d){d.applyTo(f)}),f.imageData.width===i&&f.imageData.height===r||(c.width=f.imageData.width,c.height=f.imageData.height),p.putImageData(f.imageData,0,0),f}}}(),y.Image=y.Image||{},y.Image.filters=y.Image.filters||{},y.Image.filters.BaseFilter=y.util.createClass({type:"BaseFilter",vertexSource:`attribute vec2 aPosition;
varying vec2 vTexCoord;
void main() {
vTexCoord = aPosition;
gl_Position = vec4(aPosition * 2.0 - 1.0, 0.0, 1.0);
}`,fragmentSource:`precision highp float;
varying vec2 vTexCoord;
uniform sampler2D uTexture;
void main() {
gl_FragColor = texture2D(uTexture, vTexCoord);
}`,initialize:function(l){l&&this.setOptions(l)},setOptions:function(l){for(var s in l)this[s]=l[s]},createProgram:function(l,s,a){s=s||this.fragmentSource,a=a||this.vertexSource,y.webGlPrecision!=="highp"&&(s=s.replace(/precision highp float/g,"precision "+y.webGlPrecision+" float"));var u=l.createShader(l.VERTEX_SHADER);if(l.shaderSource(u,a),l.compileShader(u),!l.getShaderParameter(u,l.COMPILE_STATUS))throw new Error("Vertex shader compile error for "+this.type+": "+l.getShaderInfoLog(u));var i=l.createShader(l.FRAGMENT_SHADER);if(l.shaderSource(i,s),l.compileShader(i),!l.getShaderParameter(i,l.COMPILE_STATUS))throw new Error("Fragment shader compile error for "+this.type+": "+l.getShaderInfoLog(i));var r=l.createProgram();if(l.attachShader(r,u),l.attachShader(r,i),l.linkProgram(r),!l.getProgramParameter(r,l.LINK_STATUS))throw new Error('Shader link error for "${this.type}" '+l.getProgramInfoLog(r));var c=this.getAttributeLocations(l,r),p=this.getUniformLocations(l,r)||{};return p.uStepW=l.getUniformLocation(r,"uStepW"),p.uStepH=l.getUniformLocation(r,"uStepH"),{program:r,attributeLocations:c,uniformLocations:p}},getAttributeLocations:function(l,s){return{aPosition:l.getAttribLocation(s,"aPosition")}},getUniformLocations:function(){return{}},sendAttributeData:function(l,s,a){var u=s.aPosition,i=l.createBuffer();l.bindBuffer(l.ARRAY_BUFFER,i),l.enableVertexAttribArray(u),l.vertexAttribPointer(u,2,l.FLOAT,!1,0,0),l.bufferData(l.ARRAY_BUFFER,a,l.STATIC_DRAW)},_setupFrameBuffer:function(l){var s,a,u=l.context;l.passes>1?(s=l.destinationWidth,a=l.destinationHeight,l.sourceWidth===s&&l.sourceHeight===a||(u.deleteTexture(l.targetTexture),l.targetTexture=l.filterBackend.createTexture(u,s,a)),u.framebufferTexture2D(u.FRAMEBUFFER,u.COLOR_ATTACHMENT0,u.TEXTURE_2D,l.targetTexture,0)):(u.bindFramebuffer(u.FRAMEBUFFER,null),u.finish())},_swapTextures:function(l){l.passes--,l.pass++;var s=l.targetTexture;l.targetTexture=l.sourceTexture,l.sourceTexture=s},isNeutralState:function(){var l=this.mainParameter,s=y.Image.filters[this.type].prototype;if(l){if(Array.isArray(s[l])){for(var a=s[l].length;a--;)if(this[l][a]!==s[l][a])return!1;return!0}return s[l]===this[l]}return!1},applyTo:function(l){l.webgl?(this._setupFrameBuffer(l),this.applyToWebGL(l),this._swapTextures(l)):this.applyTo2d(l)},retrieveShader:function(l){return l.programCache.hasOwnProperty(this.type)||(l.programCache[this.type]=this.createProgram(l.context)),l.programCache[this.type]},applyToWebGL:function(l){var s=l.context,a=this.retrieveShader(l);l.pass===0&&l.originalTexture?s.bindTexture(s.TEXTURE_2D,l.originalTexture):s.bindTexture(s.TEXTURE_2D,l.sourceTexture),s.useProgram(a.program),this.sendAttributeData(s,a.attributeLocations,l.aPosition),s.uniform1f(a.uniformLocations.uStepW,1/l.sourceWidth),s.uniform1f(a.uniformLocations.uStepH,1/l.sourceHeight),this.sendUniformData(s,a.uniformLocations),s.viewport(0,0,l.destinationWidth,l.destinationHeight),s.drawArrays(s.TRIANGLE_STRIP,0,4)},bindAdditionalTexture:function(l,s,a){l.activeTexture(a),l.bindTexture(l.TEXTURE_2D,s),l.activeTexture(l.TEXTURE0)},unbindAdditionalTexture:function(l,s){l.activeTexture(s),l.bindTexture(l.TEXTURE_2D,null),l.activeTexture(l.TEXTURE0)},getMainParameter:function(){return this[this.mainParameter]},setMainParameter:function(l){this[this.mainParameter]=l},sendUniformData:function(){},createHelpLayer:function(l){if(!l.helpLayer){var s=document.createElement("canvas");s.width=l.sourceWidth,s.height=l.sourceHeight,l.helpLayer=s}},toObject:function(){var l={type:this.type},s=this.mainParameter;return s&&(l[s]=this[s]),l},toJSON:function(){return this.toObject()}}),y.Image.filters.BaseFilter.fromObject=function(l,s){var a=new y.Image.filters[l.type](l);return s&&s(a),a},function(l){var s=l.fabric||(l.fabric={}),a=s.Image.filters,u=s.util.createClass;a.ColorMatrix=u(a.BaseFilter,{type:"ColorMatrix",fragmentSource:`precision highp float;
uniform sampler2D uTexture;
varying vec2 vTexCoord;
uniform mat4 uColorMatrix;
uniform vec4 uConstants;
void main() {
vec4 color = texture2D(uTexture, vTexCoord);
color *= uColorMatrix;
color += uConstants;
gl_FragColor = color;
}`,matrix:[1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0],mainParameter:"matrix",colorsOnly:!0,initialize:function(i){this.callSuper("initialize",i),this.matrix=this.matrix.slice(0)},applyTo2d:function(i){var r,c,p,f,d,_=i.imageData.data,w=_.length,T=this.matrix,x=this.colorsOnly;for(d=0;d<w;d+=4)r=_[d],c=_[d+1],p=_[d+2],x?(_[d]=r*T[0]+c*T[1]+p*T[2]+255*T[4],_[d+1]=r*T[5]+c*T[6]+p*T[7]+255*T[9],_[d+2]=r*T[10]+c*T[11]+p*T[12]+255*T[14]):(f=_[d+3],_[d]=r*T[0]+c*T[1]+p*T[2]+f*T[3]+255*T[4],_[d+1]=r*T[5]+c*T[6]+p*T[7]+f*T[8]+255*T[9],_[d+2]=r*T[10]+c*T[11]+p*T[12]+f*T[13]+255*T[14],_[d+3]=r*T[15]+c*T[16]+p*T[17]+f*T[18]+255*T[19])},getUniformLocations:function(i,r){return{uColorMatrix:i.getUniformLocation(r,"uColorMatrix"),uConstants:i.getUniformLocation(r,"uConstants")}},sendUniformData:function(i,r){var c=this.matrix,p=[c[0],c[1],c[2],c[3],c[5],c[6],c[7],c[8],c[10],c[11],c[12],c[13],c[15],c[16],c[17],c[18]],f=[c[4],c[9],c[14],c[19]];i.uniformMatrix4fv(r.uColorMatrix,!1,p),i.uniform4fv(r.uConstants,f)}}),s.Image.filters.ColorMatrix.fromObject=s.Image.filters.BaseFilter.fromObject}(e),function(l){var s=l.fabric||(l.fabric={}),a=s.Image.filters,u=s.util.createClass;a.Brightness=u(a.BaseFilter,{type:"Brightness",fragmentSource:`precision highp float;
uniform sampler2D uTexture;
uniform float uBrightness;
varying vec2 vTexCoord;
void main() {
vec4 color = texture2D(uTexture, vTexCoord);
color.rgb += uBrightness;
gl_FragColor = color;
}`,brightness:0,mainParameter:"brightness",applyTo2d:function(i){if(this.brightness!==0){var r,c=i.imageData.data,p=c.length,f=Math.round(255*this.brightness);for(r=0;r<p;r+=4)c[r]=c[r]+f,c[r+1]=c[r+1]+f,c[r+2]=c[r+2]+f}},getUniformLocations:function(i,r){return{uBrightness:i.getUniformLocation(r,"uBrightness")}},sendUniformData:function(i,r){i.uniform1f(r.uBrightness,this.brightness)}}),s.Image.filters.Brightness.fromObject=s.Image.filters.BaseFilter.fromObject}(e),function(l){var s=l.fabric||(l.fabric={}),a=s.util.object.extend,u=s.Image.filters,i=s.util.createClass;u.Convolute=i(u.BaseFilter,{type:"Convolute",opaque:!1,matrix:[0,0,0,0,1,0,0,0,0],fragmentSource:{Convolute_3_1:`precision highp float;
uniform sampler2D uTexture;
uniform float uMatrix[9];
uniform float uStepW;
uniform float uStepH;
varying vec2 vTexCoord;
void main() {
vec4 color = vec4(0, 0, 0, 0);
for (float h = 0.0; h < 3.0; h+=1.0) {
for (float w = 0.0; w < 3.0; w+=1.0) {
vec2 matrixPos = vec2(uStepW * (w - 1), uStepH * (h - 1));
color += texture2D(uTexture, vTexCoord + matrixPos) * uMatrix[int(h * 3.0 + w)];
}
}
gl_FragColor = color;
}`,Convolute_3_0:`precision highp float;
uniform sampler2D uTexture;
uniform float uMatrix[9];
uniform float uStepW;
uniform float uStepH;
varying vec2 vTexCoord;
void main() {
vec4 color = vec4(0, 0, 0, 1);
for (float h = 0.0; h < 3.0; h+=1.0) {
for (float w = 0.0; w < 3.0; w+=1.0) {
vec2 matrixPos = vec2(uStepW * (w - 1.0), uStepH * (h - 1.0));
color.rgb += texture2D(uTexture, vTexCoord + matrixPos).rgb * uMatrix[int(h * 3.0 + w)];
}
}
float alpha = texture2D(uTexture, vTexCoord).a;
gl_FragColor = color;
gl_FragColor.a = alpha;
}`,Convolute_5_1:`precision highp float;
uniform sampler2D uTexture;
uniform float uMatrix[25];
uniform float uStepW;
uniform float uStepH;
varying vec2 vTexCoord;
void main() {
vec4 color = vec4(0, 0, 0, 0);
for (float h = 0.0; h < 5.0; h+=1.0) {
for (float w = 0.0; w < 5.0; w+=1.0) {
vec2 matrixPos = vec2(uStepW * (w - 2.0), uStepH * (h - 2.0));
color += texture2D(uTexture, vTexCoord + matrixPos) * uMatrix[int(h * 5.0 + w)];
}
}
gl_FragColor = color;
}`,Convolute_5_0:`precision highp float;
uniform sampler2D uTexture;
uniform float uMatrix[25];
uniform float uStepW;
uniform float uStepH;
varying vec2 vTexCoord;
void main() {
vec4 color = vec4(0, 0, 0, 1);
for (float h = 0.0; h < 5.0; h+=1.0) {
for (float w = 0.0; w < 5.0; w+=1.0) {
vec2 matrixPos = vec2(uStepW * (w - 2.0), uStepH * (h - 2.0));
color.rgb += texture2D(uTexture, vTexCoord + matrixPos).rgb * uMatrix[int(h * 5.0 + w)];
}
}
float alpha = texture2D(uTexture, vTexCoord).a;
gl_FragColor = color;
gl_FragColor.a = alpha;
}`,Convolute_7_1:`precision highp float;
uniform sampler2D uTexture;
uniform float uMatrix[49];
uniform float uStepW;
uniform float uStepH;
varying vec2 vTexCoord;
void main() {
vec4 color = vec4(0, 0, 0, 0);
for (float h = 0.0; h < 7.0; h+=1.0) {
for (float w = 0.0; w < 7.0; w+=1.0) {
vec2 matrixPos = vec2(uStepW * (w - 3.0), uStepH * (h - 3.0));
color += texture2D(uTexture, vTexCoord + matrixPos) * uMatrix[int(h * 7.0 + w)];
}
}
gl_FragColor = color;
}`,Convolute_7_0:`precision highp float;
uniform sampler2D uTexture;
uniform float uMatrix[49];
uniform float uStepW;
uniform float uStepH;
varying vec2 vTexCoord;
void main() {
vec4 color = vec4(0, 0, 0, 1);
for (float h = 0.0; h < 7.0; h+=1.0) {
for (float w = 0.0; w < 7.0; w+=1.0) {
vec2 matrixPos = vec2(uStepW * (w - 3.0), uStepH * (h - 3.0));
color.rgb += texture2D(uTexture, vTexCoord + matrixPos).rgb * uMatrix[int(h * 7.0 + w)];
}
}
float alpha = texture2D(uTexture, vTexCoord).a;
gl_FragColor = color;
gl_FragColor.a = alpha;
}`,Convolute_9_1:`precision highp float;
uniform sampler2D uTexture;
uniform float uMatrix[81];
uniform float uStepW;
uniform float uStepH;
varying vec2 vTexCoord;
void main() {
vec4 color = vec4(0, 0, 0, 0);
for (float h = 0.0; h < 9.0; h+=1.0) {
for (float w = 0.0; w < 9.0; w+=1.0) {
vec2 matrixPos = vec2(uStepW * (w - 4.0), uStepH * (h - 4.0));
color += texture2D(uTexture, vTexCoord + matrixPos) * uMatrix[int(h * 9.0 + w)];
}
}
gl_FragColor = color;
}`,Convolute_9_0:`precision highp float;
uniform sampler2D uTexture;
uniform float uMatrix[81];
uniform float uStepW;
uniform float uStepH;
varying vec2 vTexCoord;
void main() {
vec4 color = vec4(0, 0, 0, 1);
for (float h = 0.0; h < 9.0; h+=1.0) {
for (float w = 0.0; w < 9.0; w+=1.0) {
vec2 matrixPos = vec2(uStepW * (w - 4.0), uStepH * (h - 4.0));
color.rgb += texture2D(uTexture, vTexCoord + matrixPos).rgb * uMatrix[int(h * 9.0 + w)];
}
}
float alpha = texture2D(uTexture, vTexCoord).a;
gl_FragColor = color;
gl_FragColor.a = alpha;
}`},retrieveShader:function(r){var c=Math.sqrt(this.matrix.length),p=this.type+"_"+c+"_"+(this.opaque?1:0),f=this.fragmentSource[p];return r.programCache.hasOwnProperty(p)||(r.programCache[p]=this.createProgram(r.context,f)),r.programCache[p]},applyTo2d:function(r){var c,p,f,d,_,w,T,x,b,F,B,z,$,Q=r.imageData,q=Q.data,O=this.matrix,A=Math.round(Math.sqrt(O.length)),D=Math.floor(A/2),k=Q.width,G=Q.height,W=r.ctx.createImageData(k,G),P=W.data,M=this.opaque?1:0;for(B=0;B<G;B++)for(F=0;F<k;F++){for(_=4*(B*k+F),c=0,p=0,f=0,d=0,$=0;$<A;$++)for(z=0;z<A;z++)w=F+z-D,(T=B+$-D)<0||T>=G||w<0||w>=k||(x=4*(T*k+w),b=O[$*A+z],c+=q[x]*b,p+=q[x+1]*b,f+=q[x+2]*b,M||(d+=q[x+3]*b));P[_]=c,P[_+1]=p,P[_+2]=f,P[_+3]=M?q[_+3]:d}r.imageData=W},getUniformLocations:function(r,c){return{uMatrix:r.getUniformLocation(c,"uMatrix"),uOpaque:r.getUniformLocation(c,"uOpaque"),uHalfSize:r.getUniformLocation(c,"uHalfSize"),uSize:r.getUniformLocation(c,"uSize")}},sendUniformData:function(r,c){r.uniform1fv(c.uMatrix,this.matrix)},toObject:function(){return a(this.callSuper("toObject"),{opaque:this.opaque,matrix:this.matrix})}}),s.Image.filters.Convolute.fromObject=s.Image.filters.BaseFilter.fromObject}(e),function(l){var s=l.fabric||(l.fabric={}),a=s.Image.filters,u=s.util.createClass;a.Grayscale=u(a.BaseFilter,{type:"Grayscale",fragmentSource:{average:`precision highp float;
uniform sampler2D uTexture;
varying vec2 vTexCoord;
void main() {
vec4 color = texture2D(uTexture, vTexCoord);
float average = (color.r + color.b + color.g) / 3.0;
gl_FragColor = vec4(average, average, average, color.a);
}`,lightness:`precision highp float;
uniform sampler2D uTexture;
uniform int uMode;
varying vec2 vTexCoord;
void main() {
vec4 col = texture2D(uTexture, vTexCoord);
float average = (max(max(col.r, col.g),col.b) + min(min(col.r, col.g),col.b)) / 2.0;
gl_FragColor = vec4(average, average, average, col.a);
}`,luminosity:`precision highp float;
uniform sampler2D uTexture;
uniform int uMode;
varying vec2 vTexCoord;
void main() {
vec4 col = texture2D(uTexture, vTexCoord);
float average = 0.21 * col.r + 0.72 * col.g + 0.07 * col.b;
gl_FragColor = vec4(average, average, average, col.a);
}`},mode:"average",mainParameter:"mode",applyTo2d:function(i){var r,c,p=i.imageData.data,f=p.length,d=this.mode;for(r=0;r<f;r+=4)d==="average"?c=(p[r]+p[r+1]+p[r+2])/3:d==="lightness"?c=(Math.min(p[r],p[r+1],p[r+2])+Math.max(p[r],p[r+1],p[r+2]))/2:d==="luminosity"&&(c=.21*p[r]+.72*p[r+1]+.07*p[r+2]),p[r]=c,p[r+1]=c,p[r+2]=c},retrieveShader:function(i){var r=this.type+"_"+this.mode;if(!i.programCache.hasOwnProperty(r)){var c=this.fragmentSource[this.mode];i.programCache[r]=this.createProgram(i.context,c)}return i.programCache[r]},getUniformLocations:function(i,r){return{uMode:i.getUniformLocation(r,"uMode")}},sendUniformData:function(i,r){i.uniform1i(r.uMode,1)},isNeutralState:function(){return!1}}),s.Image.filters.Grayscale.fromObject=s.Image.filters.BaseFilter.fromObject}(e),function(l){var s=l.fabric||(l.fabric={}),a=s.Image.filters,u=s.util.createClass;a.Invert=u(a.BaseFilter,{type:"Invert",fragmentSource:`precision highp float;
uniform sampler2D uTexture;
uniform int uInvert;
varying vec2 vTexCoord;
void main() {
vec4 color = texture2D(uTexture, vTexCoord);
if (uInvert == 1) {
gl_FragColor = vec4(1.0 - color.r,1.0 -color.g,1.0 -color.b,color.a);
} else {
gl_FragColor = color;
}
}`,invert:!0,mainParameter:"invert",applyTo2d:function(i){var r,c=i.imageData.data,p=c.length;for(r=0;r<p;r+=4)c[r]=255-c[r],c[r+1]=255-c[r+1],c[r+2]=255-c[r+2]},isNeutralState:function(){return!this.invert},getUniformLocations:function(i,r){return{uInvert:i.getUniformLocation(r,"uInvert")}},sendUniformData:function(i,r){i.uniform1i(r.uInvert,this.invert)}}),s.Image.filters.Invert.fromObject=s.Image.filters.BaseFilter.fromObject}(e),function(l){var s=l.fabric||(l.fabric={}),a=s.util.object.extend,u=s.Image.filters,i=s.util.createClass;u.Noise=i(u.BaseFilter,{type:"Noise",fragmentSource:`precision highp float;
uniform sampler2D uTexture;
uniform float uStepH;
uniform float uNoise;
uniform float uSeed;
varying vec2 vTexCoord;
float rand(vec2 co, float seed, float vScale) {
return fract(sin(dot(co.xy * vScale ,vec2(12.9898 , 78.233))) * 43758.5453 * (seed + 0.01) / 2.0);
}
void main() {
vec4 color = texture2D(uTexture, vTexCoord);
color.rgb += (0.5 - rand(vTexCoord, uSeed, 0.1 / uStepH)) * uNoise;
gl_FragColor = color;
}`,mainParameter:"noise",noise:0,applyTo2d:function(r){if(this.noise!==0){var c,p,f=r.imageData.data,d=f.length,_=this.noise;for(c=0,d=f.length;c<d;c+=4)p=(.5-Math.random())*_,f[c]+=p,f[c+1]+=p,f[c+2]+=p}},getUniformLocations:function(r,c){return{uNoise:r.getUniformLocation(c,"uNoise"),uSeed:r.getUniformLocation(c,"uSeed")}},sendUniformData:function(r,c){r.uniform1f(c.uNoise,this.noise/255),r.uniform1f(c.uSeed,Math.random())},toObject:function(){return a(this.callSuper("toObject"),{noise:this.noise})}}),s.Image.filters.Noise.fromObject=s.Image.filters.BaseFilter.fromObject}(e),function(l){var s=l.fabric||(l.fabric={}),a=s.Image.filters,u=s.util.createClass;a.Pixelate=u(a.BaseFilter,{type:"Pixelate",blocksize:4,mainParameter:"blocksize",fragmentSource:`precision highp float;
uniform sampler2D uTexture;
uniform float uBlocksize;
uniform float uStepW;
uniform float uStepH;
varying vec2 vTexCoord;
void main() {
float blockW = uBlocksize * uStepW;
float blockH = uBlocksize * uStepW;
int posX = int(vTexCoord.x / blockW);
int posY = int(vTexCoord.y / blockH);
float fposX = float(posX);
float fposY = float(posY);
vec2 squareCoords = vec2(fposX * blockW, fposY * blockH);
vec4 color = texture2D(uTexture, squareCoords);
gl_FragColor = color;
}`,applyTo2d:function(i){var r,c,p,f,d,_,w,T,x,b,F,B=i.imageData,z=B.data,$=B.height,Q=B.width;for(c=0;c<$;c+=this.blocksize)for(p=0;p<Q;p+=this.blocksize)for(f=z[r=4*c*Q+4*p],d=z[r+1],_=z[r+2],w=z[r+3],b=Math.min(c+this.blocksize,$),F=Math.min(p+this.blocksize,Q),T=c;T<b;T++)for(x=p;x<F;x++)z[r=4*T*Q+4*x]=f,z[r+1]=d,z[r+2]=_,z[r+3]=w},isNeutralState:function(){return this.blocksize===1},getUniformLocations:function(i,r){return{uBlocksize:i.getUniformLocation(r,"uBlocksize"),uStepW:i.getUniformLocation(r,"uStepW"),uStepH:i.getUniformLocation(r,"uStepH")}},sendUniformData:function(i,r){i.uniform1f(r.uBlocksize,this.blocksize)}}),s.Image.filters.Pixelate.fromObject=s.Image.filters.BaseFilter.fromObject}(e),function(l){var s=l.fabric||(l.fabric={}),a=s.util.object.extend,u=s.Image.filters,i=s.util.createClass;u.RemoveColor=i(u.BaseFilter,{type:"RemoveColor",color:"#FFFFFF",fragmentSource:`precision highp float;
uniform sampler2D uTexture;
uniform vec4 uLow;
uniform vec4 uHigh;
varying vec2 vTexCoord;
void main() {
gl_FragColor = texture2D(uTexture, vTexCoord);
if(all(greaterThan(gl_FragColor.rgb,uLow.rgb)) && all(greaterThan(uHigh.rgb,gl_FragColor.rgb))) {
gl_FragColor.a = 0.0;
}
}`,distance:.02,useAlpha:!1,applyTo2d:function(r){var c,p,f,d,_=r.imageData.data,w=255*this.distance,T=new s.Color(this.color).getSource(),x=[T[0]-w,T[1]-w,T[2]-w],b=[T[0]+w,T[1]+w,T[2]+w];for(c=0;c<_.length;c+=4)p=_[c],f=_[c+1],d=_[c+2],p>x[0]&&f>x[1]&&d>x[2]&&p<b[0]&&f<b[1]&&d<b[2]&&(_[c+3]=0)},getUniformLocations:function(r,c){return{uLow:r.getUniformLocation(c,"uLow"),uHigh:r.getUniformLocation(c,"uHigh")}},sendUniformData:function(r,c){var p=new s.Color(this.color).getSource(),f=parseFloat(this.distance),d=[0+p[0]/255-f,0+p[1]/255-f,0+p[2]/255-f,1],_=[p[0]/255+f,p[1]/255+f,p[2]/255+f,1];r.uniform4fv(c.uLow,d),r.uniform4fv(c.uHigh,_)},toObject:function(){return a(this.callSuper("toObject"),{color:this.color,distance:this.distance})}}),s.Image.filters.RemoveColor.fromObject=s.Image.filters.BaseFilter.fromObject}(e),function(l){var s=l.fabric||(l.fabric={}),a=s.Image.filters,u=s.util.createClass,i={Brownie:[.5997,.34553,-.27082,0,.186,-.0377,.86095,.15059,0,-.1449,.24113,-.07441,.44972,0,-.02965,0,0,0,1,0],Vintage:[.62793,.32021,-.03965,0,.03784,.02578,.64411,.03259,0,.02926,.0466,-.08512,.52416,0,.02023,0,0,0,1,0],Kodachrome:[1.12855,-.39673,-.03992,0,.24991,-.16404,1.08352,-.05498,0,.09698,-.16786,-.56034,1.60148,0,.13972,0,0,0,1,0],Technicolor:[1.91252,-.85453,-.09155,0,.04624,-.30878,1.76589,-.10601,0,-.27589,-.2311,-.75018,1.84759,0,.12137,0,0,0,1,0],Polaroid:[1.438,-.062,-.062,0,0,-.122,1.378,-.122,0,0,-.016,-.016,1.483,0,0,0,0,0,1,0],Sepia:[.393,.769,.189,0,0,.349,.686,.168,0,0,.272,.534,.131,0,0,0,0,0,1,0],BlackWhite:[1.5,1.5,1.5,0,-1,1.5,1.5,1.5,0,-1,1.5,1.5,1.5,0,-1,0,0,0,1,0]};for(var r in i)a[r]=u(a.ColorMatrix,{type:r,matrix:i[r],mainParameter:!1,colorsOnly:!0}),s.Image.filters[r].fromObject=s.Image.filters.BaseFilter.fromObject}(e),function(l){var s=l.fabric,a=s.Image.filters,u=s.util.createClass;a.BlendColor=u(a.BaseFilter,{type:"BlendColor",color:"#F95C63",mode:"multiply",alpha:1,fragmentSource:{multiply:`gl_FragColor.rgb *= uColor.rgb;
`,screen:`gl_FragColor.rgb = 1.0 - (1.0 - gl_FragColor.rgb) * (1.0 - uColor.rgb);
`,add:`gl_FragColor.rgb += uColor.rgb;
`,diff:`gl_FragColor.rgb = abs(gl_FragColor.rgb - uColor.rgb);
`,subtract:`gl_FragColor.rgb -= uColor.rgb;
`,lighten:`gl_FragColor.rgb = max(gl_FragColor.rgb, uColor.rgb);
`,darken:`gl_FragColor.rgb = min(gl_FragColor.rgb, uColor.rgb);
`,exclusion:`gl_FragColor.rgb += uColor.rgb - 2.0 * (uColor.rgb * gl_FragColor.rgb);
`,overlay:`if (uColor.r < 0.5) {
gl_FragColor.r *= 2.0 * uColor.r;
} else {
gl_FragColor.r = 1.0 - 2.0 * (1.0 - gl_FragColor.r) * (1.0 - uColor.r);
}
if (uColor.g < 0.5) {
gl_FragColor.g *= 2.0 * uColor.g;
} else {
gl_FragColor.g = 1.0 - 2.0 * (1.0 - gl_FragColor.g) * (1.0 - uColor.g);
}
if (uColor.b < 0.5) {
gl_FragColor.b *= 2.0 * uColor.b;
} else {
gl_FragColor.b = 1.0 - 2.0 * (1.0 - gl_FragColor.b) * (1.0 - uColor.b);
}
`,tint:`gl_FragColor.rgb *= (1.0 - uColor.a);
gl_FragColor.rgb += uColor.rgb;
`},buildSource:function(i){return`precision highp float;
uniform sampler2D uTexture;
uniform vec4 uColor;
varying vec2 vTexCoord;
void main() {
vec4 color = texture2D(uTexture, vTexCoord);
gl_FragColor = color;
if (color.a > 0.0) {
`+this.fragmentSource[i]+`}
}`},retrieveShader:function(i){var r,c=this.type+"_"+this.mode;return i.programCache.hasOwnProperty(c)||(r=this.buildSource(this.mode),i.programCache[c]=this.createProgram(i.context,r)),i.programCache[c]},applyTo2d:function(i){var r,c,p,f,d,_,w,T=i.imageData.data,x=T.length,b=1-this.alpha;r=(w=new s.Color(this.color).getSource())[0]*this.alpha,c=w[1]*this.alpha,p=w[2]*this.alpha;for(var F=0;F<x;F+=4)switch(f=T[F],d=T[F+1],_=T[F+2],this.mode){case"multiply":T[F]=f*r/255,T[F+1]=d*c/255,T[F+2]=_*p/255;break;case"screen":T[F]=255-(255-f)*(255-r)/255,T[F+1]=255-(255-d)*(255-c)/255,T[F+2]=255-(255-_)*(255-p)/255;break;case"add":T[F]=f+r,T[F+1]=d+c,T[F+2]=_+p;break;case"diff":case"difference":T[F]=Math.abs(f-r),T[F+1]=Math.abs(d-c),T[F+2]=Math.abs(_-p);break;case"subtract":T[F]=f-r,T[F+1]=d-c,T[F+2]=_-p;break;case"darken":T[F]=Math.min(f,r),T[F+1]=Math.min(d,c),T[F+2]=Math.min(_,p);break;case"lighten":T[F]=Math.max(f,r),T[F+1]=Math.max(d,c),T[F+2]=Math.max(_,p);break;case"overlay":T[F]=r<128?2*f*r/255:255-2*(255-f)*(255-r)/255,T[F+1]=c<128?2*d*c/255:255-2*(255-d)*(255-c)/255,T[F+2]=p<128?2*_*p/255:255-2*(255-_)*(255-p)/255;break;case"exclusion":T[F]=r+f-2*r*f/255,T[F+1]=c+d-2*c*d/255,T[F+2]=p+_-2*p*_/255;break;case"tint":T[F]=r+f*b,T[F+1]=c+d*b,T[F+2]=p+_*b}},getUniformLocations:function(i,r){return{uColor:i.getUniformLocation(r,"uColor")}},sendUniformData:function(i,r){var c=new s.Color(this.color).getSource();c[0]=this.alpha*c[0]/255,c[1]=this.alpha*c[1]/255,c[2]=this.alpha*c[2]/255,c[3]=this.alpha,i.uniform4fv(r.uColor,c)},toObject:function(){return{type:this.type,color:this.color,mode:this.mode,alpha:this.alpha}}}),s.Image.filters.BlendColor.fromObject=s.Image.filters.BaseFilter.fromObject}(e),function(l){var s=l.fabric,a=s.Image.filters,u=s.util.createClass;a.BlendImage=u(a.BaseFilter,{type:"BlendImage",image:null,mode:"multiply",alpha:1,vertexSource:`attribute vec2 aPosition;
varying vec2 vTexCoord;
varying vec2 vTexCoord2;
uniform mat3 uTransformMatrix;
void main() {
vTexCoord = aPosition;
vTexCoord2 = (uTransformMatrix * vec3(aPosition, 1.0)).xy;
gl_Position = vec4(aPosition * 2.0 - 1.0, 0.0, 1.0);
}`,fragmentSource:{multiply:`precision highp float;
uniform sampler2D uTexture;
uniform sampler2D uImage;
uniform vec4 uColor;
varying vec2 vTexCoord;
varying vec2 vTexCoord2;
void main() {
vec4 color = texture2D(uTexture, vTexCoord);
vec4 color2 = texture2D(uImage, vTexCoord2);
color.rgba *= color2.rgba;
gl_FragColor = color;
}`,mask:`precision highp float;
uniform sampler2D uTexture;
uniform sampler2D uImage;
uniform vec4 uColor;
varying vec2 vTexCoord;
varying vec2 vTexCoord2;
void main() {
vec4 color = texture2D(uTexture, vTexCoord);
vec4 color2 = texture2D(uImage, vTexCoord2);
color.a = color2.a;
gl_FragColor = color;
}`},retrieveShader:function(i){var r=this.type+"_"+this.mode,c=this.fragmentSource[this.mode];return i.programCache.hasOwnProperty(r)||(i.programCache[r]=this.createProgram(i.context,c)),i.programCache[r]},applyToWebGL:function(i){var r=i.context,c=this.createTexture(i.filterBackend,this.image);this.bindAdditionalTexture(r,c,r.TEXTURE1),this.callSuper("applyToWebGL",i),this.unbindAdditionalTexture(r,r.TEXTURE1)},createTexture:function(i,r){return i.getCachedTexture(r.cacheKey,r._element)},calculateMatrix:function(){var i=this.image,r=i._element.width,c=i._element.height;return[1/i.scaleX,0,0,0,1/i.scaleY,0,-i.left/r,-i.top/c,1]},applyTo2d:function(i){var r,c,p,f,d,_,w,T,x,b,F,B=i.imageData,z=i.filterBackend.resources,$=B.data,Q=$.length,q=B.width,O=B.height,A=this.image;z.blendImage||(z.blendImage=s.util.createCanvasElement()),b=(x=z.blendImage).getContext("2d"),x.width!==q||x.height!==O?(x.width=q,x.height=O):b.clearRect(0,0,q,O),b.setTransform(A.scaleX,0,0,A.scaleY,A.left,A.top),b.drawImage(A._element,0,0,q,O),F=b.getImageData(0,0,q,O).data;for(var D=0;D<Q;D+=4)switch(d=$[D],_=$[D+1],w=$[D+2],T=$[D+3],r=F[D],c=F[D+1],p=F[D+2],f=F[D+3],this.mode){case"multiply":$[D]=d*r/255,$[D+1]=_*c/255,$[D+2]=w*p/255,$[D+3]=T*f/255;break;case"mask":$[D+3]=f}},getUniformLocations:function(i,r){return{uTransformMatrix:i.getUniformLocation(r,"uTransformMatrix"),uImage:i.getUniformLocation(r,"uImage")}},sendUniformData:function(i,r){var c=this.calculateMatrix();i.uniform1i(r.uImage,1),i.uniformMatrix3fv(r.uTransformMatrix,!1,c)},toObject:function(){return{type:this.type,image:this.image&&this.image.toObject(),mode:this.mode,alpha:this.alpha}}}),s.Image.filters.BlendImage.fromObject=function(i,r){s.Image.fromObject(i.image,function(c){var p=s.util.object.clone(i);p.image=c,r(new s.Image.filters.BlendImage(p))})}}(e),function(l){var s=l.fabric||(l.fabric={}),a=Math.pow,u=Math.floor,i=Math.sqrt,r=Math.abs,c=Math.round,p=Math.sin,f=Math.ceil,d=s.Image.filters,_=s.util.createClass;d.Resize=_(d.BaseFilter,{type:"Resize",resizeType:"hermite",scaleX:1,scaleY:1,lanczosLobes:3,getUniformLocations:function(w,T){return{uDelta:w.getUniformLocation(T,"uDelta"),uTaps:w.getUniformLocation(T,"uTaps")}},sendUniformData:function(w,T){w.uniform2fv(T.uDelta,this.horizontal?[1/this.width,0]:[0,1/this.height]),w.uniform1fv(T.uTaps,this.taps)},retrieveShader:function(w){var T=this.getFilterWindow(),x=this.type+"_"+T;if(!w.programCache.hasOwnProperty(x)){var b=this.generateShader(T);w.programCache[x]=this.createProgram(w.context,b)}return w.programCache[x]},getFilterWindow:function(){var w=this.tempScale;return Math.ceil(this.lanczosLobes/w)},getTaps:function(){for(var w=this.lanczosCreate(this.lanczosLobes),T=this.tempScale,x=this.getFilterWindow(),b=new Array(x),F=1;F<=x;F++)b[F-1]=w(F*T);return b},generateShader:function(w){for(var T=new Array(w),x=this.fragmentSourceTOP,b=1;b<=w;b++)T[b-1]=b+".0 * uDelta";return x+="uniform float uTaps["+w+`];
`,x+=`void main() {
`,x+=`  vec4 color = texture2D(uTexture, vTexCoord);
`,x+=`  float sum = 1.0;
`,T.forEach(function(F,B){x+="  color += texture2D(uTexture, vTexCoord + "+F+") * uTaps["+B+`];
`,x+="  color += texture2D(uTexture, vTexCoord - "+F+") * uTaps["+B+`];
`,x+="  sum += 2.0 * uTaps["+B+`];
`}),x+=`  gl_FragColor = color / sum;
`,x+="}"},fragmentSourceTOP:`precision highp float;
uniform sampler2D uTexture;
uniform vec2 uDelta;
varying vec2 vTexCoord;
`,applyTo:function(w){w.webgl?(w.passes++,this.width=w.sourceWidth,this.horizontal=!0,this.dW=Math.round(this.width*this.scaleX),this.dH=w.sourceHeight,this.tempScale=this.dW/this.width,this.taps=this.getTaps(),w.destinationWidth=this.dW,this._setupFrameBuffer(w),this.applyToWebGL(w),this._swapTextures(w),w.sourceWidth=w.destinationWidth,this.height=w.sourceHeight,this.horizontal=!1,this.dH=Math.round(this.height*this.scaleY),this.tempScale=this.dH/this.height,this.taps=this.getTaps(),w.destinationHeight=this.dH,this._setupFrameBuffer(w),this.applyToWebGL(w),this._swapTextures(w),w.sourceHeight=w.destinationHeight):this.applyTo2d(w)},isNeutralState:function(){return this.scaleX===1&&this.scaleY===1},lanczosCreate:function(w){return function(T){if(T>=w||T<=-w)return 0;if(T<11920929e-14&&T>-11920929e-14)return 1;var x=(T*=Math.PI)/w;return p(T)/T*p(x)/x}},applyTo2d:function(w){var T=w.imageData,x=this.scaleX,b=this.scaleY;this.rcpScaleX=1/x,this.rcpScaleY=1/b;var F,B=T.width,z=T.height,$=c(B*x),Q=c(z*b);this.resizeType==="sliceHack"?F=this.sliceByTwo(w,B,z,$,Q):this.resizeType==="hermite"?F=this.hermiteFastResize(w,B,z,$,Q):this.resizeType==="bilinear"?F=this.bilinearFiltering(w,B,z,$,Q):this.resizeType==="lanczos"&&(F=this.lanczosResize(w,B,z,$,Q)),w.imageData=F},sliceByTwo:function(w,T,x,b,F){var B,z,$=w.imageData,Q=.5,q=!1,O=!1,A=T*Q,D=x*Q,k=s.filterBackend.resources,G=0,W=0,P=T,M=0;for(k.sliceByTwo||(k.sliceByTwo=document.createElement("canvas")),((B=k.sliceByTwo).width<1.5*T||B.height<x)&&(B.width=1.5*T,B.height=x),(z=B.getContext("2d")).clearRect(0,0,1.5*T,x),z.putImageData($,0,0),b=u(b),F=u(F);!q||!O;)T=A,x=D,b<u(A*Q)?A=u(A*Q):(A=b,q=!0),F<u(D*Q)?D=u(D*Q):(D=F,O=!0),z.drawImage(B,G,W,T,x,P,M,A,D),G=P,W=M,M+=D;return z.getImageData(G,W,b,F)},lanczosResize:function(w,T,x,b,F){var B=w.imageData.data,z=w.ctx.createImageData(b,F),$=z.data,Q=this.lanczosCreate(this.lanczosLobes),q=this.rcpScaleX,O=this.rcpScaleY,A=2/this.rcpScaleX,D=2/this.rcpScaleY,k=f(q*this.lanczosLobes/2),G=f(O*this.lanczosLobes/2),W={},P={},M={};return function U(V){var H,Z,ee,re,ie,se,oe,ce,me,fe,Ae;for(P.x=(V+.5)*q,M.x=u(P.x),H=0;H<F;H++){for(P.y=(H+.5)*O,M.y=u(P.y),ie=0,se=0,oe=0,ce=0,me=0,Z=M.x-k;Z<=M.x+k;Z++)if(!(Z<0||Z>=T)){fe=u(1e3*r(Z-P.x)),W[fe]||(W[fe]={});for(var Ne=M.y-G;Ne<=M.y+G;Ne++)Ne<0||Ne>=x||(Ae=u(1e3*r(Ne-P.y)),W[fe][Ae]||(W[fe][Ae]=Q(i(a(fe*A,2)+a(Ae*D,2))/1e3)),(ee=W[fe][Ae])>0&&(ie+=ee,se+=ee*B[re=4*(Ne*T+Z)],oe+=ee*B[re+1],ce+=ee*B[re+2],me+=ee*B[re+3]))}$[re=4*(H*b+V)]=se/ie,$[re+1]=oe/ie,$[re+2]=ce/ie,$[re+3]=me/ie}return++V<b?U(V):z}(0)},bilinearFiltering:function(w,T,x,b,F){var B,z,$,Q,q,O,A,D,k,G=0,W=this.rcpScaleX,P=this.rcpScaleY,M=4*(T-1),U=w.imageData.data,V=w.ctx.createImageData(b,F),H=V.data;for($=0;$<F;$++)for(Q=0;Q<b;Q++)for(q=W*Q-(B=u(W*Q)),O=P*$-(z=u(P*$)),k=4*(z*T+B),A=0;A<4;A++)D=U[k+A]*(1-q)*(1-O)+U[k+4+A]*q*(1-O)+U[k+M+A]*O*(1-q)+U[k+M+4+A]*q*O,H[G++]=D;return V},hermiteFastResize:function(w,T,x,b,F){for(var B=this.rcpScaleX,z=this.rcpScaleY,$=f(B/2),Q=f(z/2),q=w.imageData.data,O=w.ctx.createImageData(b,F),A=O.data,D=0;D<F;D++)for(var k=0;k<b;k++){for(var G=4*(k+D*b),W=0,P=0,M=0,U=0,V=0,H=0,Z=0,ee=(D+.5)*z,re=u(D*z);re<(D+1)*z;re++)for(var ie=r(ee-(re+.5))/Q,se=(k+.5)*B,oe=ie*ie,ce=u(k*B);ce<(k+1)*B;ce++){var me=r(se-(ce+.5))/$,fe=i(oe+me*me);fe>1&&fe<-1||(W=2*fe*fe*fe-3*fe*fe+1)>0&&(Z+=W*q[3+(me=4*(ce+re*T))],M+=W,q[me+3]<255&&(W=W*q[me+3]/250),U+=W*q[me],V+=W*q[me+1],H+=W*q[me+2],P+=W)}A[G]=U/P,A[G+1]=V/P,A[G+2]=H/P,A[G+3]=Z/M}return O},toObject:function(){return{type:this.type,scaleX:this.scaleX,scaleY:this.scaleY,resizeType:this.resizeType,lanczosLobes:this.lanczosLobes}}}),s.Image.filters.Resize.fromObject=s.Image.filters.BaseFilter.fromObject}(e),function(l){var s=l.fabric||(l.fabric={}),a=s.Image.filters,u=s.util.createClass;a.Contrast=u(a.BaseFilter,{type:"Contrast",fragmentSource:`precision highp float;
uniform sampler2D uTexture;
uniform float uContrast;
varying vec2 vTexCoord;
void main() {
vec4 color = texture2D(uTexture, vTexCoord);
float contrastF = 1.015 * (uContrast + 1.0) / (1.0 * (1.015 - uContrast));
color.rgb = contrastF * (color.rgb - 0.5) + 0.5;
gl_FragColor = color;
}`,contrast:0,mainParameter:"contrast",applyTo2d:function(i){if(this.contrast!==0){var r,c=i.imageData.data,p=c.length,f=Math.floor(255*this.contrast),d=259*(f+255)/(255*(259-f));for(r=0;r<p;r+=4)c[r]=d*(c[r]-128)+128,c[r+1]=d*(c[r+1]-128)+128,c[r+2]=d*(c[r+2]-128)+128}},getUniformLocations:function(i,r){return{uContrast:i.getUniformLocation(r,"uContrast")}},sendUniformData:function(i,r){i.uniform1f(r.uContrast,this.contrast)}}),s.Image.filters.Contrast.fromObject=s.Image.filters.BaseFilter.fromObject}(e),function(l){var s=l.fabric||(l.fabric={}),a=s.Image.filters,u=s.util.createClass;a.Saturation=u(a.BaseFilter,{type:"Saturation",fragmentSource:`precision highp float;
uniform sampler2D uTexture;
uniform float uSaturation;
varying vec2 vTexCoord;
void main() {
vec4 color = texture2D(uTexture, vTexCoord);
float rgMax = max(color.r, color.g);
float rgbMax = max(rgMax, color.b);
color.r += rgbMax != color.r ? (rgbMax - color.r) * uSaturation : 0.00;
color.g += rgbMax != color.g ? (rgbMax - color.g) * uSaturation : 0.00;
color.b += rgbMax != color.b ? (rgbMax - color.b) * uSaturation : 0.00;
gl_FragColor = color;
}`,saturation:0,mainParameter:"saturation",applyTo2d:function(i){if(this.saturation!==0){var r,c,p=i.imageData.data,f=p.length,d=-this.saturation;for(r=0;r<f;r+=4)c=Math.max(p[r],p[r+1],p[r+2]),p[r]+=c!==p[r]?(c-p[r])*d:0,p[r+1]+=c!==p[r+1]?(c-p[r+1])*d:0,p[r+2]+=c!==p[r+2]?(c-p[r+2])*d:0}},getUniformLocations:function(i,r){return{uSaturation:i.getUniformLocation(r,"uSaturation")}},sendUniformData:function(i,r){i.uniform1f(r.uSaturation,-this.saturation)}}),s.Image.filters.Saturation.fromObject=s.Image.filters.BaseFilter.fromObject}(e),function(l){var s=l.fabric||(l.fabric={}),a=s.Image.filters,u=s.util.createClass;a.Vibrance=u(a.BaseFilter,{type:"Vibrance",fragmentSource:`precision highp float;
uniform sampler2D uTexture;
uniform float uVibrance;
varying vec2 vTexCoord;
void main() {
vec4 color = texture2D(uTexture, vTexCoord);
float max = max(color.r, max(color.g, color.b));
float avg = (color.r + color.g + color.b) / 3.0;
float amt = (abs(max - avg) * 2.0) * uVibrance;
color.r += max != color.r ? (max - color.r) * amt : 0.00;
color.g += max != color.g ? (max - color.g) * amt : 0.00;
color.b += max != color.b ? (max - color.b) * amt : 0.00;
gl_FragColor = color;
}`,vibrance:0,mainParameter:"vibrance",applyTo2d:function(i){if(this.vibrance!==0){var r,c,p,f,d=i.imageData.data,_=d.length,w=-this.vibrance;for(r=0;r<_;r+=4)c=Math.max(d[r],d[r+1],d[r+2]),p=(d[r]+d[r+1]+d[r+2])/3,f=2*Math.abs(c-p)/255*w,d[r]+=c!==d[r]?(c-d[r])*f:0,d[r+1]+=c!==d[r+1]?(c-d[r+1])*f:0,d[r+2]+=c!==d[r+2]?(c-d[r+2])*f:0}},getUniformLocations:function(i,r){return{uVibrance:i.getUniformLocation(r,"uVibrance")}},sendUniformData:function(i,r){i.uniform1f(r.uVibrance,-this.vibrance)}}),s.Image.filters.Vibrance.fromObject=s.Image.filters.BaseFilter.fromObject}(e),function(l){var s=l.fabric||(l.fabric={}),a=s.Image.filters,u=s.util.createClass;a.Blur=u(a.BaseFilter,{type:"Blur",fragmentSource:`precision highp float;
uniform sampler2D uTexture;
uniform vec2 uDelta;
varying vec2 vTexCoord;
const float nSamples = 15.0;
vec3 v3offset = vec3(12.9898, 78.233, 151.7182);
float random(vec3 scale) {
return fract(sin(dot(gl_FragCoord.xyz, scale)) * 43758.5453);
}
void main() {
vec4 color = vec4(0.0);
float total = 0.0;
float offset = random(v3offset);
for (float t = -nSamples; t <= nSamples; t++) {
float percent = (t + offset - 0.5) / nSamples;
float weight = 1.0 - abs(percent);
color += texture2D(uTexture, vTexCoord + uDelta * percent) * weight;
total += weight;
}
gl_FragColor = color / total;
}`,blur:0,mainParameter:"blur",applyTo:function(i){i.webgl?(this.aspectRatio=i.sourceWidth/i.sourceHeight,i.passes++,this._setupFrameBuffer(i),this.horizontal=!0,this.applyToWebGL(i),this._swapTextures(i),this._setupFrameBuffer(i),this.horizontal=!1,this.applyToWebGL(i),this._swapTextures(i)):this.applyTo2d(i)},applyTo2d:function(i){i.imageData=this.simpleBlur(i)},simpleBlur:function(i){var r,c,p=i.filterBackend.resources,f=i.imageData.width,d=i.imageData.height;p.blurLayer1||(p.blurLayer1=s.util.createCanvasElement(),p.blurLayer2=s.util.createCanvasElement()),r=p.blurLayer1,c=p.blurLayer2,r.width===f&&r.height===d||(c.width=r.width=f,c.height=r.height=d);var _,w,T,x,b=r.getContext("2d"),F=c.getContext("2d"),B=.06*this.blur*.5;for(b.putImageData(i.imageData,0,0),F.clearRect(0,0,f,d),x=-15;x<=15;x++)T=B*(w=x/15)*f+(_=(Math.random()-.5)/4),F.globalAlpha=1-Math.abs(w),F.drawImage(r,T,_),b.drawImage(c,0,0),F.globalAlpha=1,F.clearRect(0,0,c.width,c.height);for(x=-15;x<=15;x++)T=B*(w=x/15)*d+(_=(Math.random()-.5)/4),F.globalAlpha=1-Math.abs(w),F.drawImage(r,_,T),b.drawImage(c,0,0),F.globalAlpha=1,F.clearRect(0,0,c.width,c.height);i.ctx.drawImage(r,0,0);var z=i.ctx.getImageData(0,0,r.width,r.height);return b.globalAlpha=1,b.clearRect(0,0,r.width,r.height),z},getUniformLocations:function(i,r){return{delta:i.getUniformLocation(r,"uDelta")}},sendUniformData:function(i,r){var c=this.chooseRightDelta();i.uniform2fv(r.delta,c)},chooseRightDelta:function(){var i,r=1,c=[0,0];return this.horizontal?this.aspectRatio>1&&(r=1/this.aspectRatio):this.aspectRatio<1&&(r=this.aspectRatio),i=r*this.blur*.12,this.horizontal?c[0]=i:c[1]=i,c}}),a.Blur.fromObject=s.Image.filters.BaseFilter.fromObject}(e),function(l){var s=l.fabric||(l.fabric={}),a=s.Image.filters,u=s.util.createClass;a.Gamma=u(a.BaseFilter,{type:"Gamma",fragmentSource:`precision highp float;
uniform sampler2D uTexture;
uniform vec3 uGamma;
varying vec2 vTexCoord;
void main() {
vec4 color = texture2D(uTexture, vTexCoord);
vec3 correction = (1.0 / uGamma);
color.r = pow(color.r, correction.r);
color.g = pow(color.g, correction.g);
color.b = pow(color.b, correction.b);
gl_FragColor = color;
gl_FragColor.rgb *= color.a;
}`,gamma:[1,1,1],mainParameter:"gamma",initialize:function(i){this.gamma=[1,1,1],a.BaseFilter.prototype.initialize.call(this,i)},applyTo2d:function(i){var r,c=i.imageData.data,p=this.gamma,f=c.length,d=1/p[0],_=1/p[1],w=1/p[2];for(this.rVals||(this.rVals=new Uint8Array(256),this.gVals=new Uint8Array(256),this.bVals=new Uint8Array(256)),r=0,f=256;r<f;r++)this.rVals[r]=255*Math.pow(r/255,d),this.gVals[r]=255*Math.pow(r/255,_),this.bVals[r]=255*Math.pow(r/255,w);for(r=0,f=c.length;r<f;r+=4)c[r]=this.rVals[c[r]],c[r+1]=this.gVals[c[r+1]],c[r+2]=this.bVals[c[r+2]]},getUniformLocations:function(i,r){return{uGamma:i.getUniformLocation(r,"uGamma")}},sendUniformData:function(i,r){i.uniform3fv(r.uGamma,this.gamma)}}),s.Image.filters.Gamma.fromObject=s.Image.filters.BaseFilter.fromObject}(e),function(l){var s=l.fabric||(l.fabric={}),a=s.Image.filters,u=s.util.createClass;a.Composed=u(a.BaseFilter,{type:"Composed",subFilters:[],initialize:function(i){this.callSuper("initialize",i),this.subFilters=this.subFilters.slice(0)},applyTo:function(i){i.passes+=this.subFilters.length-1,this.subFilters.forEach(function(r){r.applyTo(i)})},toObject:function(){return s.util.object.extend(this.callSuper("toObject"),{subFilters:this.subFilters.map(function(i){return i.toObject()})})},isNeutralState:function(){return!this.subFilters.some(function(i){return!i.isNeutralState()})}}),s.Image.filters.Composed.fromObject=function(i,r){var c=(i.subFilters||[]).map(function(f){return new s.Image.filters[f.type](f)}),p=new s.Image.filters.Composed({subFilters:c});return r&&r(p),p}}(e),function(l){var s=l.fabric||(l.fabric={}),a=s.Image.filters,u=s.util.createClass;a.HueRotation=u(a.ColorMatrix,{type:"HueRotation",rotation:0,mainParameter:"rotation",calculateMatrix:function(){var i=this.rotation*Math.PI,r=s.util.cos(i),c=s.util.sin(i),p=1/3,f=Math.sqrt(p)*c,d=1-r;this.matrix=[1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0],this.matrix[0]=r+d/3,this.matrix[1]=p*d-f,this.matrix[2]=p*d+f,this.matrix[5]=p*d+f,this.matrix[6]=r+p*d,this.matrix[7]=p*d-f,this.matrix[10]=p*d-f,this.matrix[11]=p*d+f,this.matrix[12]=r+p*d},isNeutralState:function(i){return this.calculateMatrix(),a.BaseFilter.prototype.isNeutralState.call(this,i)},applyTo:function(i){this.calculateMatrix(),a.BaseFilter.prototype.applyTo.call(this,i)}}),s.Image.filters.HueRotation.fromObject=s.Image.filters.BaseFilter.fromObject}(e),function(l){var s=l.fabric||(l.fabric={}),a=s.util.object.clone;if(s.Text)s.warn("fabric.Text is already defined");else{var u="fontFamily fontWeight fontSize text underline overline linethrough textAlign fontStyle lineHeight textBackgroundColor charSpacing styles direction path pathStartOffset pathSide pathAlign".split(" ");s.Text=s.util.createClass(s.Object,{_dimensionAffectingProps:["fontSize","fontWeight","fontFamily","fontStyle","lineHeight","text","charSpacing","textAlign","styles","path","pathStartOffset","pathSide","pathAlign"],_reNewline:/\r?\n/,_reSpacesAndTabs:/[ \t\r]/g,_reSpaceAndTab:/[ \t\r]/,_reWords:/\S+/g,type:"text",fontSize:40,fontWeight:"normal",fontFamily:"Times New Roman",underline:!1,overline:!1,linethrough:!1,textAlign:"left",fontStyle:"normal",lineHeight:1.16,superscript:{size:.6,baseline:-.35},subscript:{size:.6,baseline:.11},textBackgroundColor:"",stateProperties:s.Object.prototype.stateProperties.concat(u),cacheProperties:s.Object.prototype.cacheProperties.concat(u),stroke:null,shadow:null,path:null,pathStartOffset:0,pathSide:"left",pathAlign:"baseline",_fontSizeFraction:.222,offsets:{underline:.1,linethrough:-.315,overline:-.88},_fontSizeMult:1.13,charSpacing:0,styles:null,_measuringContext:null,deltaY:0,direction:"ltr",_styleProperties:["stroke","strokeWidth","fill","fontFamily","fontSize","fontWeight","fontStyle","underline","overline","linethrough","deltaY","textBackgroundColor"],__charBounds:[],CACHE_FONT_SIZE:400,MIN_TEXT_WIDTH:2,initialize:function(i,r){this.styles=r&&r.styles||{},this.text=i,this.__skipDimension=!0,this.callSuper("initialize",r),this.path&&this.setPathInfo(),this.__skipDimension=!1,this.initDimensions(),this.setCoords(),this.setupState({propertySet:"_dimensionAffectingProps"})},setPathInfo:function(){var i=this.path;i&&(i.segmentsInfo=s.util.getPathSegmentsInfo(i.path))},getMeasuringContext:function(){return s._measuringContext||(s._measuringContext=this.canvas&&this.canvas.contextCache||s.util.createCanvasElement().getContext("2d")),s._measuringContext},_splitText:function(){var i=this._splitTextIntoLines(this.text);return this.textLines=i.lines,this._textLines=i.graphemeLines,this._unwrappedTextLines=i._unwrappedLines,this._text=i.graphemeText,i},initDimensions:function(){this.__skipDimension||(this._splitText(),this._clearCache(),this.path?(this.width=this.path.width,this.height=this.path.height):(this.width=this.calcTextWidth()||this.cursorWidth||this.MIN_TEXT_WIDTH,this.height=this.calcTextHeight()),this.textAlign.indexOf("justify")!==-1&&this.enlargeSpaces(),this.saveState({propertySet:"_dimensionAffectingProps"}))},enlargeSpaces:function(){for(var i,r,c,p,f,d,_,w=0,T=this._textLines.length;w<T;w++)if((this.textAlign==="justify"||w!==T-1&&!this.isEndOfWrapping(w))&&(p=0,f=this._textLines[w],(r=this.getLineWidth(w))<this.width&&(_=this.textLines[w].match(this._reSpacesAndTabs)))){c=_.length,i=(this.width-r)/c;for(var x=0,b=f.length;x<=b;x++)d=this.__charBounds[w][x],this._reSpaceAndTab.test(f[x])?(d.width+=i,d.kernedWidth+=i,d.left+=p,p+=i):d.left+=p}},isEndOfWrapping:function(i){return i===this._textLines.length-1},missingNewlineOffset:function(){return 1},toString:function(){return"#<fabric.Text ("+this.complexity()+'): { "text": "'+this.text+'", "fontFamily": "'+this.fontFamily+'" }>'},_getCacheCanvasDimensions:function(){var i=this.callSuper("_getCacheCanvasDimensions"),r=this.fontSize;return i.width+=r*i.zoomX,i.height+=r*i.zoomY,i},_render:function(i){var r=this.path;r&&!r.isNotVisible()&&r._render(i),this._setTextStyles(i),this._renderTextLinesBackground(i),this._renderTextDecoration(i,"underline"),this._renderText(i),this._renderTextDecoration(i,"overline"),this._renderTextDecoration(i,"linethrough")},_renderText:function(i){this.paintFirst==="stroke"?(this._renderTextStroke(i),this._renderTextFill(i)):(this._renderTextFill(i),this._renderTextStroke(i))},_setTextStyles:function(i,r,c){if(i.textBaseline="alphabetical",this.path)switch(this.pathAlign){case"center":i.textBaseline="middle";break;case"ascender":i.textBaseline="top";break;case"descender":i.textBaseline="bottom"}i.font=this._getFontDeclaration(r,c)},calcTextWidth:function(){for(var i=this.getLineWidth(0),r=1,c=this._textLines.length;r<c;r++){var p=this.getLineWidth(r);p>i&&(i=p)}return i},_renderTextLine:function(i,r,c,p,f,d){this._renderChars(i,r,c,p,f,d)},_renderTextLinesBackground:function(i){if(this.textBackgroundColor||this.styleHas("textBackgroundColor")){for(var r,c,p,f,d,_,w,T=i.fillStyle,x=this._getLeftOffset(),b=this._getTopOffset(),F=0,B=0,z=this.path,$=0,Q=this._textLines.length;$<Q;$++)if(r=this.getHeightOfLine($),this.textBackgroundColor||this.styleHas("textBackgroundColor",$)){p=this._textLines[$],c=this._getLineLeftOffset($),B=0,F=0,f=this.getValueOfPropertyAt($,0,"textBackgroundColor");for(var q=0,O=p.length;q<O;q++)d=this.__charBounds[$][q],_=this.getValueOfPropertyAt($,q,"textBackgroundColor"),z?(i.save(),i.translate(d.renderLeft,d.renderTop),i.rotate(d.angle),i.fillStyle=_,_&&i.fillRect(-d.width/2,-r/this.lineHeight*(1-this._fontSizeFraction),d.width,r/this.lineHeight),i.restore()):_!==f?(w=x+c+F,this.direction==="rtl"&&(w=this.width-w-B),i.fillStyle=f,f&&i.fillRect(w,b,B,r/this.lineHeight),F=d.left,B=d.width,f=_):B+=d.kernedWidth;_&&!z&&(w=x+c+F,this.direction==="rtl"&&(w=this.width-w-B),i.fillStyle=_,i.fillRect(w,b,B,r/this.lineHeight)),b+=r}else b+=r;i.fillStyle=T,this._removeShadow(i)}},getFontCache:function(i){var r=i.fontFamily.toLowerCase();s.charWidthsCache[r]||(s.charWidthsCache[r]={});var c=s.charWidthsCache[r],p=i.fontStyle.toLowerCase()+"_"+(i.fontWeight+"").toLowerCase();return c[p]||(c[p]={}),c[p]},_measureChar:function(i,r,c,p){var f,d,_,w,T=this.getFontCache(r),x=c+i,b=this._getFontDeclaration(r)===this._getFontDeclaration(p),F=r.fontSize/this.CACHE_FONT_SIZE;if(c&&T[c]!==void 0&&(_=T[c]),T[i]!==void 0&&(w=f=T[i]),b&&T[x]!==void 0&&(w=(d=T[x])-_),f===void 0||_===void 0||d===void 0){var B=this.getMeasuringContext();this._setTextStyles(B,r,!0)}return f===void 0&&(w=f=B.measureText(i).width,T[i]=f),_===void 0&&b&&c&&(_=B.measureText(c).width,T[c]=_),b&&d===void 0&&(d=B.measureText(x).width,T[x]=d,w=d-_),{width:f*F,kernedWidth:w*F}},getHeightOfChar:function(i,r){return this.getValueOfPropertyAt(i,r,"fontSize")},measureLine:function(i){var r=this._measureLine(i);return this.charSpacing!==0&&(r.width-=this._getWidthOfCharSpacing()),r.width<0&&(r.width=0),r},_measureLine:function(i){var r,c,p,f,d,_,w=0,T=this._textLines[i],x=new Array(T.length),b=0,F=this.path,B=this.pathSide==="right";for(this.__charBounds[i]=x,r=0;r<T.length;r++)c=T[r],f=this._getGraphemeBox(c,i,r,p),x[r]=f,w+=f.kernedWidth,p=c;if(x[r]={left:f?f.left+f.width:0,width:0,kernedWidth:0,height:this.fontSize},F){switch(_=F.segmentsInfo[F.segmentsInfo.length-1].length,(d=s.util.getPointOnPath(F.path,0,F.segmentsInfo)).x+=F.pathOffset.x,d.y+=F.pathOffset.y,this.textAlign){case"left":b=B?_-w:0;break;case"center":b=(_-w)/2;break;case"right":b=B?0:_-w}for(b+=this.pathStartOffset*(B?-1:1),r=B?T.length-1:0;B?r>=0:r<T.length;B?r--:r++)f=x[r],b>_?b%=_:b<0&&(b+=_),this._setGraphemeOnPath(b,f,d),b+=f.kernedWidth}return{width:w,numOfSpaces:0}},_setGraphemeOnPath:function(i,r,c){var p=i+r.kernedWidth/2,f=this.path,d=s.util.getPointOnPath(f.path,p,f.segmentsInfo);r.renderLeft=d.x-c.x,r.renderTop=d.y-c.y,r.angle=d.angle+(this.pathSide==="right"?Math.PI:0)},_getGraphemeBox:function(i,r,c,p,f){var d,_=this.getCompleteStyleDeclaration(r,c),w=p?this.getCompleteStyleDeclaration(r,c-1):{},T=this._measureChar(i,_,p,w),x=T.kernedWidth,b=T.width;this.charSpacing!==0&&(b+=d=this._getWidthOfCharSpacing(),x+=d);var F={width:b,left:0,height:_.fontSize,kernedWidth:x,deltaY:_.deltaY};if(c>0&&!f){var B=this.__charBounds[r][c-1];F.left=B.left+B.width+T.kernedWidth-T.width}return F},getHeightOfLine:function(i){if(this.__lineHeights[i])return this.__lineHeights[i];for(var r=this._textLines[i],c=this.getHeightOfChar(i,0),p=1,f=r.length;p<f;p++)c=Math.max(this.getHeightOfChar(i,p),c);return this.__lineHeights[i]=c*this.lineHeight*this._fontSizeMult},calcTextHeight:function(){for(var i,r=0,c=0,p=this._textLines.length;c<p;c++)i=this.getHeightOfLine(c),r+=c===p-1?i/this.lineHeight:i;return r},_getLeftOffset:function(){return this.direction==="ltr"?-this.width/2:this.width/2},_getTopOffset:function(){return-this.height/2},_renderTextCommon:function(i,r){i.save();for(var c=0,p=this._getLeftOffset(),f=this._getTopOffset(),d=0,_=this._textLines.length;d<_;d++){var w=this.getHeightOfLine(d),T=w/this.lineHeight,x=this._getLineLeftOffset(d);this._renderTextLine(r,i,this._textLines[d],p+x,f+c+T,d),c+=w}i.restore()},_renderTextFill:function(i){(this.fill||this.styleHas("fill"))&&this._renderTextCommon(i,"fillText")},_renderTextStroke:function(i){(this.stroke&&this.strokeWidth!==0||!this.isEmptyStyles())&&(this.shadow&&!this.shadow.affectStroke&&this._removeShadow(i),i.save(),this._setLineDash(i,this.strokeDashArray),i.beginPath(),this._renderTextCommon(i,"strokeText"),i.closePath(),i.restore())},_renderChars:function(i,r,c,p,f,d){var _,w,T,x,b,F=this.getHeightOfLine(d),B=this.textAlign.indexOf("justify")!==-1,z="",$=0,Q=this.path,q=!B&&this.charSpacing===0&&this.isEmptyStyles(d)&&!Q,O=this.direction==="ltr",A=this.direction==="ltr"?1:-1,D=r.canvas.getAttribute("dir");if(r.save(),D!==this.direction&&(r.canvas.setAttribute("dir",O?"ltr":"rtl"),r.direction=O?"ltr":"rtl",r.textAlign=O?"left":"right"),f-=F*this._fontSizeFraction/this.lineHeight,q)return this._renderChar(i,r,d,0,c.join(""),p,f,F),void r.restore();for(var k=0,G=c.length-1;k<=G;k++)x=k===G||this.charSpacing||Q,z+=c[k],T=this.__charBounds[d][k],$===0?(p+=A*(T.kernedWidth-T.width),$+=T.width):$+=T.kernedWidth,B&&!x&&this._reSpaceAndTab.test(c[k])&&(x=!0),x||(_=_||this.getCompleteStyleDeclaration(d,k),w=this.getCompleteStyleDeclaration(d,k+1),x=this._hasStyleChanged(_,w)),x&&(Q?(r.save(),r.translate(T.renderLeft,T.renderTop),r.rotate(T.angle),this._renderChar(i,r,d,k,z,-$/2,0,F),r.restore()):(b=p,this._renderChar(i,r,d,k,z,b,f,F)),z="",_=w,p+=A*$,$=0);r.restore()},_applyPatternGradientTransformText:function(i){var r,c=s.util.createCanvasElement(),p=this.width+this.strokeWidth,f=this.height+this.strokeWidth;return c.width=p,c.height=f,(r=c.getContext("2d")).beginPath(),r.moveTo(0,0),r.lineTo(p,0),r.lineTo(p,f),r.lineTo(0,f),r.closePath(),r.translate(p/2,f/2),r.fillStyle=i.toLive(r),this._applyPatternGradientTransform(r,i),r.fill(),r.createPattern(c,"no-repeat")},handleFiller:function(i,r,c){var p,f;return c.toLive?c.gradientUnits==="percentage"||c.gradientTransform||c.patternTransform?(p=-this.width/2,f=-this.height/2,i.translate(p,f),i[r]=this._applyPatternGradientTransformText(c),{offsetX:p,offsetY:f}):(i[r]=c.toLive(i,this),this._applyPatternGradientTransform(i,c)):(i[r]=c,{offsetX:0,offsetY:0})},_setStrokeStyles:function(i,r){return i.lineWidth=r.strokeWidth,i.lineCap=this.strokeLineCap,i.lineDashOffset=this.strokeDashOffset,i.lineJoin=this.strokeLineJoin,i.miterLimit=this.strokeMiterLimit,this.handleFiller(i,"strokeStyle",r.stroke)},_setFillStyles:function(i,r){return this.handleFiller(i,"fillStyle",r.fill)},_renderChar:function(i,r,c,p,f,d,_){var w,T,x=this._getStyleDeclaration(c,p),b=this.getCompleteStyleDeclaration(c,p),F=i==="fillText"&&b.fill,B=i==="strokeText"&&b.stroke&&b.strokeWidth;(B||F)&&(r.save(),F&&(w=this._setFillStyles(r,b)),B&&(T=this._setStrokeStyles(r,b)),r.font=this._getFontDeclaration(b),x&&x.textBackgroundColor&&this._removeShadow(r),x&&x.deltaY&&(_+=x.deltaY),F&&r.fillText(f,d-w.offsetX,_-w.offsetY),B&&r.strokeText(f,d-T.offsetX,_-T.offsetY),r.restore())},setSuperscript:function(i,r){return this._setScript(i,r,this.superscript)},setSubscript:function(i,r){return this._setScript(i,r,this.subscript)},_setScript:function(i,r,c){var p=this.get2DCursorLocation(i,!0),f=this.getValueOfPropertyAt(p.lineIndex,p.charIndex,"fontSize"),d=this.getValueOfPropertyAt(p.lineIndex,p.charIndex,"deltaY"),_={fontSize:f*c.size,deltaY:d+f*c.baseline};return this.setSelectionStyles(_,i,r),this},_hasStyleChanged:function(i,r){return i.fill!==r.fill||i.stroke!==r.stroke||i.strokeWidth!==r.strokeWidth||i.fontSize!==r.fontSize||i.fontFamily!==r.fontFamily||i.fontWeight!==r.fontWeight||i.fontStyle!==r.fontStyle||i.deltaY!==r.deltaY},_hasStyleChangedForSvg:function(i,r){return this._hasStyleChanged(i,r)||i.overline!==r.overline||i.underline!==r.underline||i.linethrough!==r.linethrough},_getLineLeftOffset:function(i){var r=this.getLineWidth(i),c=this.width-r,p=this.textAlign,f=this.direction,d=0,_=this.isEndOfWrapping(i);return p==="justify"||p==="justify-center"&&!_||p==="justify-right"&&!_||p==="justify-left"&&!_?0:(p==="center"&&(d=c/2),p==="right"&&(d=c),p==="justify-center"&&(d=c/2),p==="justify-right"&&(d=c),f==="rtl"&&(d-=c),d)},_clearCache:function(){this.__lineWidths=[],this.__lineHeights=[],this.__charBounds=[]},_shouldClearDimensionCache:function(){var i=this._forceClearCache;return i||(i=this.hasStateChanged("_dimensionAffectingProps")),i&&(this.dirty=!0,this._forceClearCache=!1),i},getLineWidth:function(i){if(this.__lineWidths[i]!==void 0)return this.__lineWidths[i];var r=this.measureLine(i).width;return this.__lineWidths[i]=r,r},_getWidthOfCharSpacing:function(){return this.charSpacing!==0?this.fontSize*this.charSpacing/1e3:0},getValueOfPropertyAt:function(i,r,c){var p=this._getStyleDeclaration(i,r);return p&&p[c]!==void 0?p[c]:this[c]},_renderTextDecoration:function(i,r){if(this[r]||this.styleHas(r)){for(var c,p,f,d,_,w,T,x,b,F,B,z,$,Q,q,O,A=this._getLeftOffset(),D=this._getTopOffset(),k=this.path,G=this._getWidthOfCharSpacing(),W=this.offsets[r],P=0,M=this._textLines.length;P<M;P++)if(c=this.getHeightOfLine(P),this[r]||this.styleHas(r,P)){T=this._textLines[P],Q=c/this.lineHeight,d=this._getLineLeftOffset(P),F=0,B=0,x=this.getValueOfPropertyAt(P,0,r),O=this.getValueOfPropertyAt(P,0,"fill"),b=D+Q*(1-this._fontSizeFraction),p=this.getHeightOfChar(P,0),_=this.getValueOfPropertyAt(P,0,"deltaY");for(var U=0,V=T.length;U<V;U++)if(z=this.__charBounds[P][U],$=this.getValueOfPropertyAt(P,U,r),q=this.getValueOfPropertyAt(P,U,"fill"),f=this.getHeightOfChar(P,U),w=this.getValueOfPropertyAt(P,U,"deltaY"),k&&$&&q)i.save(),i.fillStyle=O,i.translate(z.renderLeft,z.renderTop),i.rotate(z.angle),i.fillRect(-z.kernedWidth/2,W*f+w,z.kernedWidth,this.fontSize/15),i.restore();else if(($!==x||q!==O||f!==p||w!==_)&&B>0){var H=A+d+F;this.direction==="rtl"&&(H=this.width-H-B),x&&O&&(i.fillStyle=O,i.fillRect(H,b+W*p+_,B,this.fontSize/15)),F=z.left,B=z.width,x=$,O=q,p=f,_=w}else B+=z.kernedWidth;H=A+d+F,this.direction==="rtl"&&(H=this.width-H-B),i.fillStyle=q,$&&q&&i.fillRect(H,b+W*p+_,B-G,this.fontSize/15),D+=c}else D+=c;this._removeShadow(i)}},_getFontDeclaration:function(i,r){var c=i||this,p=this.fontFamily,f=s.Text.genericFonts.indexOf(p.toLowerCase())>-1,d=p===void 0||p.indexOf("'")>-1||p.indexOf(",")>-1||p.indexOf('"')>-1||f?c.fontFamily:'"'+c.fontFamily+'"';return[s.isLikelyNode?c.fontWeight:c.fontStyle,s.isLikelyNode?c.fontStyle:c.fontWeight,r?this.CACHE_FONT_SIZE+"px":c.fontSize+"px",d].join(" ")},render:function(i){this.visible&&(this.canvas&&this.canvas.skipOffscreen&&!this.group&&!this.isOnScreen()||(this._shouldClearDimensionCache()&&this.initDimensions(),this.callSuper("render",i)))},_splitTextIntoLines:function(i){for(var r=i.split(this._reNewline),c=new Array(r.length),p=[`
`],f=[],d=0;d<r.length;d++)c[d]=s.util.string.graphemeSplit(r[d]),f=f.concat(c[d],p);return f.pop(),{_unwrappedLines:c,lines:r,graphemeText:f,graphemeLines:c}},toObject:function(i){var r=u.concat(i),c=this.callSuper("toObject",r);return c.styles=a(this.styles,!0),c.path&&(c.path=this.path.toObject()),c},set:function(i,r){this.callSuper("set",i,r);var c=!1,p=!1;if(typeof i=="object")for(var f in i)f==="path"&&this.setPathInfo(),c=c||this._dimensionAffectingProps.indexOf(f)!==-1,p=p||f==="path";else c=this._dimensionAffectingProps.indexOf(i)!==-1,p=i==="path";return p&&this.setPathInfo(),c&&(this.initDimensions(),this.setCoords()),this},complexity:function(){return 1}}),s.Text.ATTRIBUTE_NAMES=s.SHARED_ATTRIBUTES.concat("x y dx dy font-family font-style font-weight font-size letter-spacing text-decoration text-anchor".split(" ")),s.Text.DEFAULT_SVG_FONT_SIZE=16,s.Text.fromElement=function(i,r,c){if(!i)return r(null);var p=s.parseAttributes(i,s.Text.ATTRIBUTE_NAMES),f=p.textAnchor||"left";if((c=s.util.object.extend(c?a(c):{},p)).top=c.top||0,c.left=c.left||0,p.textDecoration){var d=p.textDecoration;d.indexOf("underline")!==-1&&(c.underline=!0),d.indexOf("overline")!==-1&&(c.overline=!0),d.indexOf("line-through")!==-1&&(c.linethrough=!0),delete c.textDecoration}"dx"in p&&(c.left+=p.dx),"dy"in p&&(c.top+=p.dy),"fontSize"in c||(c.fontSize=s.Text.DEFAULT_SVG_FONT_SIZE);var _="";"textContent"in i?_=i.textContent:"firstChild"in i&&i.firstChild!==null&&"data"in i.firstChild&&i.firstChild.data!==null&&(_=i.firstChild.data),_=_.replace(/^\s+|\s+$|\n+/g,"").replace(/\s+/g," ");var w=c.strokeWidth;c.strokeWidth=0;var T=new s.Text(_,c),x=T.getScaledHeight()/T.height,b=((T.height+T.strokeWidth)*T.lineHeight-T.height)*x,F=T.getScaledHeight()+b,B=0;f==="center"&&(B=T.getScaledWidth()/2),f==="right"&&(B=T.getScaledWidth()),T.set({left:T.left-B,top:T.top-(F-T.fontSize*(.07+T._fontSizeFraction))/T.lineHeight,strokeWidth:w!==void 0?w:1}),r(T)},s.Text.fromObject=function(i,r){var c=a(i),p=i.path;return delete c.path,s.Object._fromObject("Text",c,function(f){p?s.Object._fromObject("Path",p,function(d){f.set("path",d),r(f)},"path"):r(f)},"text")},s.Text.genericFonts=["sans-serif","serif","cursive","fantasy","monospace"],s.util.createAccessors&&s.util.createAccessors(s.Text)}}(e),y.util.object.extend(y.Text.prototype,{isEmptyStyles:function(l){if(!this.styles||l!==void 0&&!this.styles[l])return!0;var s=l===void 0?this.styles:{line:this.styles[l]};for(var a in s)for(var u in s[a])for(var i in s[a][u])return!1;return!0},styleHas:function(l,s){if(!this.styles||!l||l===""||s!==void 0&&!this.styles[s])return!1;var a=s===void 0?this.styles:{0:this.styles[s]};for(var u in a)for(var i in a[u])if(a[u][i][l]!==void 0)return!0;return!1},cleanStyle:function(l){if(!this.styles||!l||l==="")return!1;var s,a,u=this.styles,i=0,r=!0,c=0;for(var p in u){for(var f in s=0,u[p]){var d;i++,(d=u[p][f]).hasOwnProperty(l)?(a?d[l]!==a&&(r=!1):a=d[l],d[l]===this[l]&&delete d[l]):r=!1,Object.keys(d).length!==0?s++:delete u[p][f]}s===0&&delete u[p]}for(var _=0;_<this._textLines.length;_++)c+=this._textLines[_].length;r&&i===c&&(this[l]=a,this.removeStyle(l))},removeStyle:function(l){if(this.styles&&l&&l!==""){var s,a,u,i=this.styles;for(a in i){for(u in s=i[a])delete s[u][l],Object.keys(s[u]).length===0&&delete s[u];Object.keys(s).length===0&&delete i[a]}}},_extendStyles:function(l,s){var a=this.get2DCursorLocation(l);this._getLineStyle(a.lineIndex)||this._setLineStyle(a.lineIndex),this._getStyleDeclaration(a.lineIndex,a.charIndex)||this._setStyleDeclaration(a.lineIndex,a.charIndex,{}),y.util.object.extend(this._getStyleDeclaration(a.lineIndex,a.charIndex),s)},get2DCursorLocation:function(l,s){l===void 0&&(l=this.selectionStart);for(var a=s?this._unwrappedTextLines:this._textLines,u=a.length,i=0;i<u;i++){if(l<=a[i].length)return{lineIndex:i,charIndex:l};l-=a[i].length+this.missingNewlineOffset(i)}return{lineIndex:i-1,charIndex:a[i-1].length<l?a[i-1].length:l}},getSelectionStyles:function(l,s,a){l===void 0&&(l=this.selectionStart||0),s===void 0&&(s=this.selectionEnd||l);for(var u=[],i=l;i<s;i++)u.push(this.getStyleAtPosition(i,a));return u},getStyleAtPosition:function(l,s){var a=this.get2DCursorLocation(l);return(s?this.getCompleteStyleDeclaration(a.lineIndex,a.charIndex):this._getStyleDeclaration(a.lineIndex,a.charIndex))||{}},setSelectionStyles:function(l,s,a){s===void 0&&(s=this.selectionStart||0),a===void 0&&(a=this.selectionEnd||s);for(var u=s;u<a;u++)this._extendStyles(u,l);return this._forceClearCache=!0,this},_getStyleDeclaration:function(l,s){var a=this.styles&&this.styles[l];return a?a[s]:null},getCompleteStyleDeclaration:function(l,s){for(var a,u=this._getStyleDeclaration(l,s)||{},i={},r=0;r<this._styleProperties.length;r++)i[a=this._styleProperties[r]]=u[a]===void 0?this[a]:u[a];return i},_setStyleDeclaration:function(l,s,a){this.styles[l][s]=a},_deleteStyleDeclaration:function(l,s){delete this.styles[l][s]},_getLineStyle:function(l){return!!this.styles[l]},_setLineStyle:function(l){this.styles[l]={}},_deleteLineStyle:function(l){delete this.styles[l]}}),function(){function l(s){s.textDecoration&&(s.textDecoration.indexOf("underline")>-1&&(s.underline=!0),s.textDecoration.indexOf("line-through")>-1&&(s.linethrough=!0),s.textDecoration.indexOf("overline")>-1&&(s.overline=!0),delete s.textDecoration)}y.IText=y.util.createClass(y.Text,y.Observable,{type:"i-text",selectionStart:0,selectionEnd:0,selectionColor:"rgba(17,119,255,0.3)",isEditing:!1,editable:!0,editingBorderColor:"rgba(102,153,255,0.25)",cursorWidth:2,cursorColor:"",cursorDelay:1e3,cursorDuration:600,caching:!0,hiddenTextareaContainer:null,_reSpace:/\s|\n/,_currentCursorOpacity:0,_selectionDirection:null,_abortCursorAnimation:!1,__widthOfSpace:[],inCompositionMode:!1,initialize:function(s,a){this.callSuper("initialize",s,a),this.initBehavior()},setSelectionStart:function(s){s=Math.max(s,0),this._updateAndFire("selectionStart",s)},setSelectionEnd:function(s){s=Math.min(s,this.text.length),this._updateAndFire("selectionEnd",s)},_updateAndFire:function(s,a){this[s]!==a&&(this._fireSelectionChanged(),this[s]=a),this._updateTextarea()},_fireSelectionChanged:function(){this.fire("selection:changed"),this.canvas&&this.canvas.fire("text:selection:changed",{target:this})},initDimensions:function(){this.isEditing&&this.initDelayedCursor(),this.clearContextTop(),this.callSuper("initDimensions")},render:function(s){this.clearContextTop(),this.callSuper("render",s),this.cursorOffsetCache={},this.renderCursorOrSelection()},_render:function(s){this.callSuper("_render",s)},clearContextTop:function(s){if(this.isEditing&&this.canvas&&this.canvas.contextTop){var a=this.canvas.contextTop,u=this.canvas.viewportTransform;a.save(),a.transform(u[0],u[1],u[2],u[3],u[4],u[5]),this.transform(a),this._clearTextArea(a),s||a.restore()}},renderCursorOrSelection:function(){if(this.isEditing&&this.canvas&&this.canvas.contextTop){var s=this._getCursorBoundaries(),a=this.canvas.contextTop;this.clearContextTop(!0),this.selectionStart===this.selectionEnd?this.renderCursor(s,a):this.renderSelection(s,a),a.restore()}},_clearTextArea:function(s){var a=this.width+4,u=this.height+4;s.clearRect(-a/2,-u/2,a,u)},_getCursorBoundaries:function(s){s===void 0&&(s=this.selectionStart);var a=this._getLeftOffset(),u=this._getTopOffset(),i=this._getCursorBoundariesOffsets(s);return{left:a,top:u,leftOffset:i.left,topOffset:i.top}},_getCursorBoundariesOffsets:function(s){if(this.cursorOffsetCache&&"top"in this.cursorOffsetCache)return this.cursorOffsetCache;var a,u,i,r,c=0,p=0,f=this.get2DCursorLocation(s);i=f.charIndex,u=f.lineIndex;for(var d=0;d<u;d++)c+=this.getHeightOfLine(d);a=this._getLineLeftOffset(u);var _=this.__charBounds[u][i];return _&&(p=_.left),this.charSpacing!==0&&i===this._textLines[u].length&&(p-=this._getWidthOfCharSpacing()),r={top:c,left:a+(p>0?p:0)},this.direction==="rtl"&&(r.left*=-1),this.cursorOffsetCache=r,this.cursorOffsetCache},renderCursor:function(s,a){var u=this.get2DCursorLocation(),i=u.lineIndex,r=u.charIndex>0?u.charIndex-1:0,c=this.getValueOfPropertyAt(i,r,"fontSize"),p=this.scaleX*this.canvas.getZoom(),f=this.cursorWidth/p,d=s.topOffset,_=this.getValueOfPropertyAt(i,r,"deltaY");d+=(1-this._fontSizeFraction)*this.getHeightOfLine(i)/this.lineHeight-c*(1-this._fontSizeFraction),this.inCompositionMode&&this.renderSelection(s,a),a.fillStyle=this.cursorColor||this.getValueOfPropertyAt(i,r,"fill"),a.globalAlpha=this.__isMousedown?1:this._currentCursorOpacity,a.fillRect(s.left+s.leftOffset-f/2,d+s.top+_,f,c)},renderSelection:function(s,a){for(var u=this.inCompositionMode?this.hiddenTextarea.selectionStart:this.selectionStart,i=this.inCompositionMode?this.hiddenTextarea.selectionEnd:this.selectionEnd,r=this.textAlign.indexOf("justify")!==-1,c=this.get2DCursorLocation(u),p=this.get2DCursorLocation(i),f=c.lineIndex,d=p.lineIndex,_=c.charIndex<0?0:c.charIndex,w=p.charIndex<0?0:p.charIndex,T=f;T<=d;T++){var x,b=this._getLineLeftOffset(T)||0,F=this.getHeightOfLine(T),B=0,z=0;if(T===f&&(B=this.__charBounds[f][_].left),T>=f&&T<d)z=r&&!this.isEndOfWrapping(T)?this.width:this.getLineWidth(T)||5;else if(T===d)if(w===0)z=this.__charBounds[d][w].left;else{var $=this._getWidthOfCharSpacing();z=this.__charBounds[d][w-1].left+this.__charBounds[d][w-1].width-$}x=F,(this.lineHeight<1||T===d&&this.lineHeight>1)&&(F/=this.lineHeight);var Q=s.left+b+B,q=z-B,O=F,A=0;this.inCompositionMode?(a.fillStyle=this.compositionColor||"black",O=1,A=F):a.fillStyle=this.selectionColor,this.direction==="rtl"&&(Q=this.width-Q-q),a.fillRect(Q,s.top+s.topOffset+A,q,O),s.topOffset+=x}},getCurrentCharFontSize:function(){var s=this._getCurrentCharIndex();return this.getValueOfPropertyAt(s.l,s.c,"fontSize")},getCurrentCharColor:function(){var s=this._getCurrentCharIndex();return this.getValueOfPropertyAt(s.l,s.c,"fill")},_getCurrentCharIndex:function(){var s=this.get2DCursorLocation(this.selectionStart,!0),a=s.charIndex>0?s.charIndex-1:0;return{l:s.lineIndex,c:a}}}),y.IText.fromObject=function(s,a){if(l(s),s.styles)for(var u in s.styles)for(var i in s.styles[u])l(s.styles[u][i]);y.Object._fromObject("IText",s,a,"text")}}(),be=y.util.object.clone,y.util.object.extend(y.IText.prototype,{initBehavior:function(){this.initAddedHandler(),this.initRemovedHandler(),this.initCursorSelectionHandlers(),this.initDoubleClickSimulation(),this.mouseMoveHandler=this.mouseMoveHandler.bind(this)},onDeselect:function(){this.isEditing&&this.exitEditing(),this.selected=!1},initAddedHandler:function(){var l=this;this.on("added",function(){var s=l.canvas;s&&(s._hasITextHandlers||(s._hasITextHandlers=!0,l._initCanvasHandlers(s)),s._iTextInstances=s._iTextInstances||[],s._iTextInstances.push(l))})},initRemovedHandler:function(){var l=this;this.on("removed",function(){var s=l.canvas;s&&(s._iTextInstances=s._iTextInstances||[],y.util.removeFromArray(s._iTextInstances,l),s._iTextInstances.length===0&&(s._hasITextHandlers=!1,l._removeCanvasHandlers(s)))})},_initCanvasHandlers:function(l){l._mouseUpITextHandler=function(){l._iTextInstances&&l._iTextInstances.forEach(function(s){s.__isMousedown=!1})},l.on("mouse:up",l._mouseUpITextHandler)},_removeCanvasHandlers:function(l){l.off("mouse:up",l._mouseUpITextHandler)},_tick:function(){this._currentTickState=this._animateCursor(this,1,this.cursorDuration,"_onTickComplete")},_animateCursor:function(l,s,a,u){var i;return i={isAborted:!1,abort:function(){this.isAborted=!0}},l.animate("_currentCursorOpacity",s,{duration:a,onComplete:function(){i.isAborted||l[u]()},onChange:function(){l.canvas&&l.selectionStart===l.selectionEnd&&l.renderCursorOrSelection()},abort:function(){return i.isAborted}}),i},_onTickComplete:function(){var l=this;this._cursorTimeout1&&clearTimeout(this._cursorTimeout1),this._cursorTimeout1=setTimeout(function(){l._currentTickCompleteState=l._animateCursor(l,0,this.cursorDuration/2,"_tick")},100)},initDelayedCursor:function(l){var s=this,a=l?0:this.cursorDelay;this.abortCursorAnimation(),this._currentCursorOpacity=1,this._cursorTimeout2=setTimeout(function(){s._tick()},a)},abortCursorAnimation:function(){var l=this._currentTickState||this._currentTickCompleteState,s=this.canvas;this._currentTickState&&this._currentTickState.abort(),this._currentTickCompleteState&&this._currentTickCompleteState.abort(),clearTimeout(this._cursorTimeout1),clearTimeout(this._cursorTimeout2),this._currentCursorOpacity=0,l&&s&&s.clearContext(s.contextTop||s.contextContainer)},selectAll:function(){return this.selectionStart=0,this.selectionEnd=this._text.length,this._fireSelectionChanged(),this._updateTextarea(),this},getSelectedText:function(){return this._text.slice(this.selectionStart,this.selectionEnd).join("")},findWordBoundaryLeft:function(l){var s=0,a=l-1;if(this._reSpace.test(this._text[a]))for(;this._reSpace.test(this._text[a]);)s++,a--;for(;/\S/.test(this._text[a])&&a>-1;)s++,a--;return l-s},findWordBoundaryRight:function(l){var s=0,a=l;if(this._reSpace.test(this._text[a]))for(;this._reSpace.test(this._text[a]);)s++,a++;for(;/\S/.test(this._text[a])&&a<this._text.length;)s++,a++;return l+s},findLineBoundaryLeft:function(l){for(var s=0,a=l-1;!/\n/.test(this._text[a])&&a>-1;)s++,a--;return l-s},findLineBoundaryRight:function(l){for(var s=0,a=l;!/\n/.test(this._text[a])&&a<this._text.length;)s++,a++;return l+s},searchWordBoundary:function(l,s){for(var a=this._text,u=this._reSpace.test(a[l])?l-1:l,i=a[u],r=y.reNonWord;!r.test(i)&&u>0&&u<a.length;)i=a[u+=s];return r.test(i)&&(u+=s===1?0:1),u},selectWord:function(l){l=l||this.selectionStart;var s=this.searchWordBoundary(l,-1),a=this.searchWordBoundary(l,1);this.selectionStart=s,this.selectionEnd=a,this._fireSelectionChanged(),this._updateTextarea(),this.renderCursorOrSelection()},selectLine:function(l){l=l||this.selectionStart;var s=this.findLineBoundaryLeft(l),a=this.findLineBoundaryRight(l);return this.selectionStart=s,this.selectionEnd=a,this._fireSelectionChanged(),this._updateTextarea(),this},enterEditing:function(l){if(!this.isEditing&&this.editable)return this.canvas&&(this.canvas.calcOffset(),this.exitEditingOnOthers(this.canvas)),this.isEditing=!0,this.initHiddenTextarea(l),this.hiddenTextarea.focus(),this.hiddenTextarea.value=this.text,this._updateTextarea(),this._saveEditingProps(),this._setEditingProps(),this._textBeforeEdit=this.text,this._tick(),this.fire("editing:entered"),this._fireSelectionChanged(),this.canvas?(this.canvas.fire("text:editing:entered",{target:this}),this.initMouseMoveHandler(),this.canvas.requestRenderAll(),this):this},exitEditingOnOthers:function(l){l._iTextInstances&&l._iTextInstances.forEach(function(s){s.selected=!1,s.isEditing&&s.exitEditing()})},initMouseMoveHandler:function(){this.canvas.on("mouse:move",this.mouseMoveHandler)},mouseMoveHandler:function(l){if(this.__isMousedown&&this.isEditing){var s=this.getSelectionStartFromPointer(l.e),a=this.selectionStart,u=this.selectionEnd;(s===this.__selectionStartOnMouseDown&&a!==u||a!==s&&u!==s)&&(s>this.__selectionStartOnMouseDown?(this.selectionStart=this.__selectionStartOnMouseDown,this.selectionEnd=s):(this.selectionStart=s,this.selectionEnd=this.__selectionStartOnMouseDown),this.selectionStart===a&&this.selectionEnd===u||(this.restartCursorIfNeeded(),this._fireSelectionChanged(),this._updateTextarea(),this.renderCursorOrSelection()))}},_setEditingProps:function(){this.hoverCursor="text",this.canvas&&(this.canvas.defaultCursor=this.canvas.moveCursor="text"),this.borderColor=this.editingBorderColor,this.hasControls=this.selectable=!1,this.lockMovementX=this.lockMovementY=!0},fromStringToGraphemeSelection:function(l,s,a){var u=a.slice(0,l),i=y.util.string.graphemeSplit(u).length;if(l===s)return{selectionStart:i,selectionEnd:i};var r=a.slice(l,s);return{selectionStart:i,selectionEnd:i+y.util.string.graphemeSplit(r).length}},fromGraphemeToStringSelection:function(l,s,a){var u=a.slice(0,l).join("").length;return l===s?{selectionStart:u,selectionEnd:u}:{selectionStart:u,selectionEnd:u+a.slice(l,s).join("").length}},_updateTextarea:function(){if(this.cursorOffsetCache={},this.hiddenTextarea){if(!this.inCompositionMode){var l=this.fromGraphemeToStringSelection(this.selectionStart,this.selectionEnd,this._text);this.hiddenTextarea.selectionStart=l.selectionStart,this.hiddenTextarea.selectionEnd=l.selectionEnd}this.updateTextareaPosition()}},updateFromTextArea:function(){if(this.hiddenTextarea){this.cursorOffsetCache={},this.text=this.hiddenTextarea.value,this._shouldClearDimensionCache()&&(this.initDimensions(),this.setCoords());var l=this.fromStringToGraphemeSelection(this.hiddenTextarea.selectionStart,this.hiddenTextarea.selectionEnd,this.hiddenTextarea.value);this.selectionEnd=this.selectionStart=l.selectionEnd,this.inCompositionMode||(this.selectionStart=l.selectionStart),this.updateTextareaPosition()}},updateTextareaPosition:function(){if(this.selectionStart===this.selectionEnd){var l=this._calcTextareaPosition();this.hiddenTextarea.style.left=l.left,this.hiddenTextarea.style.top=l.top}},_calcTextareaPosition:function(){if(!this.canvas)return{x:1,y:1};var l=this.inCompositionMode?this.compositionStart:this.selectionStart,s=this._getCursorBoundaries(l),a=this.get2DCursorLocation(l),u=a.lineIndex,i=a.charIndex,r=this.getValueOfPropertyAt(u,i,"fontSize")*this.lineHeight,c=s.leftOffset,p=this.calcTransformMatrix(),f={x:s.left+c,y:s.top+s.topOffset+r},d=this.canvas.getRetinaScaling(),_=this.canvas.upperCanvasEl,w=_.width/d,T=_.height/d,x=w-r,b=T-r,F=_.clientWidth/w,B=_.clientHeight/T;return f=y.util.transformPoint(f,p),(f=y.util.transformPoint(f,this.canvas.viewportTransform)).x*=F,f.y*=B,f.x<0&&(f.x=0),f.x>x&&(f.x=x),f.y<0&&(f.y=0),f.y>b&&(f.y=b),f.x+=this.canvas._offset.left,f.y+=this.canvas._offset.top,{left:f.x+"px",top:f.y+"px",fontSize:r+"px",charHeight:r}},_saveEditingProps:function(){this._savedProps={hasControls:this.hasControls,borderColor:this.borderColor,lockMovementX:this.lockMovementX,lockMovementY:this.lockMovementY,hoverCursor:this.hoverCursor,selectable:this.selectable,defaultCursor:this.canvas&&this.canvas.defaultCursor,moveCursor:this.canvas&&this.canvas.moveCursor}},_restoreEditingProps:function(){this._savedProps&&(this.hoverCursor=this._savedProps.hoverCursor,this.hasControls=this._savedProps.hasControls,this.borderColor=this._savedProps.borderColor,this.selectable=this._savedProps.selectable,this.lockMovementX=this._savedProps.lockMovementX,this.lockMovementY=this._savedProps.lockMovementY,this.canvas&&(this.canvas.defaultCursor=this._savedProps.defaultCursor,this.canvas.moveCursor=this._savedProps.moveCursor))},exitEditing:function(){var l=this._textBeforeEdit!==this.text,s=this.hiddenTextarea;return this.selected=!1,this.isEditing=!1,this.selectionEnd=this.selectionStart,s&&(s.blur&&s.blur(),s.parentNode&&s.parentNode.removeChild(s)),this.hiddenTextarea=null,this.abortCursorAnimation(),this._restoreEditingProps(),this._currentCursorOpacity=0,this._shouldClearDimensionCache()&&(this.initDimensions(),this.setCoords()),this.fire("editing:exited"),l&&this.fire("modified"),this.canvas&&(this.canvas.off("mouse:move",this.mouseMoveHandler),this.canvas.fire("text:editing:exited",{target:this}),l&&this.canvas.fire("object:modified",{target:this})),this},_removeExtraneousStyles:function(){for(var l in this.styles)this._textLines[l]||delete this.styles[l]},removeStyleFromTo:function(l,s){var a,u,i=this.get2DCursorLocation(l,!0),r=this.get2DCursorLocation(s,!0),c=i.lineIndex,p=i.charIndex,f=r.lineIndex,d=r.charIndex;if(c!==f){if(this.styles[c])for(a=p;a<this._unwrappedTextLines[c].length;a++)delete this.styles[c][a];if(this.styles[f])for(a=d;a<this._unwrappedTextLines[f].length;a++)(u=this.styles[f][a])&&(this.styles[c]||(this.styles[c]={}),this.styles[c][p+a-d]=u);for(a=c+1;a<=f;a++)delete this.styles[a];this.shiftLineStyles(f,c-f)}else if(this.styles[c]){u=this.styles[c];var _,w,T=d-p;for(a=p;a<d;a++)delete u[a];for(w in this.styles[c])(_=parseInt(w,10))>=d&&(u[_-T]=u[w],delete u[w])}},shiftLineStyles:function(l,s){var a=be(this.styles);for(var u in this.styles){var i=parseInt(u,10);i>l&&(this.styles[i+s]=a[i],a[i-s]||delete this.styles[i])}},restartCursorIfNeeded:function(){this._currentTickState&&!this._currentTickState.isAborted&&this._currentTickCompleteState&&!this._currentTickCompleteState.isAborted||this.initDelayedCursor()},insertNewlineStyleObject:function(l,s,a,u){var i,r={},c=!1,p=this._unwrappedTextLines[l].length===s;for(var f in a||(a=1),this.shiftLineStyles(l,a),this.styles[l]&&(i=this.styles[l][s===0?s:s-1]),this.styles[l]){var d=parseInt(f,10);d>=s&&(c=!0,r[d-s]=this.styles[l][f],p&&s===0||delete this.styles[l][f])}var _=!1;for(c&&!p&&(this.styles[l+a]=r,_=!0),_&&a--;a>0;)u&&u[a-1]?this.styles[l+a]={0:be(u[a-1])}:i?this.styles[l+a]={0:be(i)}:delete this.styles[l+a],a--;this._forceClearCache=!0},insertCharStyleObject:function(l,s,a,u){this.styles||(this.styles={});var i=this.styles[l],r=i?be(i):{};for(var c in a||(a=1),r){var p=parseInt(c,10);p>=s&&(i[p+a]=r[p],r[p-a]||delete i[p])}if(this._forceClearCache=!0,u)for(;a--;)Object.keys(u[a]).length&&(this.styles[l]||(this.styles[l]={}),this.styles[l][s+a]=be(u[a]));else if(i)for(var f=i[s?s-1:1];f&&a--;)this.styles[l][s+a]=be(f)},insertNewStyleBlock:function(l,s,a){for(var u=this.get2DCursorLocation(s,!0),i=[0],r=0,c=0;c<l.length;c++)l[c]===`
`?i[++r]=0:i[r]++;for(i[0]>0&&(this.insertCharStyleObject(u.lineIndex,u.charIndex,i[0],a),a=a&&a.slice(i[0]+1)),r&&this.insertNewlineStyleObject(u.lineIndex,u.charIndex+i[0],r),c=1;c<r;c++)i[c]>0?this.insertCharStyleObject(u.lineIndex+c,0,i[c],a):a&&this.styles[u.lineIndex+c]&&a[0]&&(this.styles[u.lineIndex+c][0]=a[0]),a=a&&a.slice(i[c]+1);i[c]>0&&this.insertCharStyleObject(u.lineIndex+c,0,i[c],a)},setSelectionStartEndWithShift:function(l,s,a){a<=l?(s===l?this._selectionDirection="left":this._selectionDirection==="right"&&(this._selectionDirection="left",this.selectionEnd=l),this.selectionStart=a):a>l&&a<s?this._selectionDirection==="right"?this.selectionEnd=a:this.selectionStart=a:(s===l?this._selectionDirection="right":this._selectionDirection==="left"&&(this._selectionDirection="right",this.selectionStart=s),this.selectionEnd=a)},setSelectionInBoundaries:function(){var l=this.text.length;this.selectionStart>l?this.selectionStart=l:this.selectionStart<0&&(this.selectionStart=0),this.selectionEnd>l?this.selectionEnd=l:this.selectionEnd<0&&(this.selectionEnd=0)}}),y.util.object.extend(y.IText.prototype,{initDoubleClickSimulation:function(){this.__lastClickTime=+new Date,this.__lastLastClickTime=+new Date,this.__lastPointer={},this.on("mousedown",this.onMouseDown)},onMouseDown:function(l){if(this.canvas){this.__newClickTime=+new Date;var s=l.pointer;this.isTripleClick(s)&&(this.fire("tripleclick",l),this._stopEvent(l.e)),this.__lastLastClickTime=this.__lastClickTime,this.__lastClickTime=this.__newClickTime,this.__lastPointer=s,this.__lastIsEditing=this.isEditing,this.__lastSelected=this.selected}},isTripleClick:function(l){return this.__newClickTime-this.__lastClickTime<500&&this.__lastClickTime-this.__lastLastClickTime<500&&this.__lastPointer.x===l.x&&this.__lastPointer.y===l.y},_stopEvent:function(l){l.preventDefault&&l.preventDefault(),l.stopPropagation&&l.stopPropagation()},initCursorSelectionHandlers:function(){this.initMousedownHandler(),this.initMouseupHandler(),this.initClicks()},doubleClickHandler:function(l){this.isEditing&&this.selectWord(this.getSelectionStartFromPointer(l.e))},tripleClickHandler:function(l){this.isEditing&&this.selectLine(this.getSelectionStartFromPointer(l.e))},initClicks:function(){this.on("mousedblclick",this.doubleClickHandler),this.on("tripleclick",this.tripleClickHandler)},_mouseDownHandler:function(l){!this.canvas||!this.editable||l.e.button&&l.e.button!==1||(this.__isMousedown=!0,this.selected&&(this.inCompositionMode=!1,this.setCursorByClick(l.e)),this.isEditing&&(this.__selectionStartOnMouseDown=this.selectionStart,this.selectionStart===this.selectionEnd&&this.abortCursorAnimation(),this.renderCursorOrSelection()))},_mouseDownHandlerBefore:function(l){!this.canvas||!this.editable||l.e.button&&l.e.button!==1||(this.selected=this===this.canvas._activeObject)},initMousedownHandler:function(){this.on("mousedown",this._mouseDownHandler),this.on("mousedown:before",this._mouseDownHandlerBefore)},initMouseupHandler:function(){this.on("mouseup",this.mouseUpHandler)},mouseUpHandler:function(l){if(this.__isMousedown=!1,!(!this.editable||this.group||l.transform&&l.transform.actionPerformed||l.e.button&&l.e.button!==1)){if(this.canvas){var s=this.canvas._activeObject;if(s&&s!==this)return}this.__lastSelected&&!this.__corner?(this.selected=!1,this.__lastSelected=!1,this.enterEditing(l.e),this.selectionStart===this.selectionEnd?this.initDelayedCursor(!0):this.renderCursorOrSelection()):this.selected=!0}},setCursorByClick:function(l){var s=this.getSelectionStartFromPointer(l),a=this.selectionStart,u=this.selectionEnd;l.shiftKey?this.setSelectionStartEndWithShift(a,u,s):(this.selectionStart=s,this.selectionEnd=s),this.isEditing&&(this._fireSelectionChanged(),this._updateTextarea())},getSelectionStartFromPointer:function(l){for(var s,a=this.getLocalPointer(l),u=0,i=0,r=0,c=0,p=0,f=0,d=this._textLines.length;f<d&&r<=a.y;f++)r+=this.getHeightOfLine(f)*this.scaleY,p=f,f>0&&(c+=this._textLines[f-1].length+this.missingNewlineOffset(f-1));i=this._getLineLeftOffset(p)*this.scaleX,s=this._textLines[p],this.direction==="rtl"&&(a.x=this.width*this.scaleX-a.x+i);for(var _=0,w=s.length;_<w&&(u=i,(i+=this.__charBounds[p][_].kernedWidth*this.scaleX)<=a.x);_++)c++;return this._getNewSelectionStartFromOffset(a,u,i,c,w)},_getNewSelectionStartFromOffset:function(l,s,a,u,i){var r=l.x-s,c=a-l.x,p=u+(c>r||c<0?0:1);return this.flipX&&(p=i-p),p>this._text.length&&(p=this._text.length),p}}),y.util.object.extend(y.IText.prototype,{initHiddenTextarea:function(){this.hiddenTextarea=y.document.createElement("textarea"),this.hiddenTextarea.setAttribute("autocapitalize","off"),this.hiddenTextarea.setAttribute("autocorrect","off"),this.hiddenTextarea.setAttribute("autocomplete","off"),this.hiddenTextarea.setAttribute("spellcheck","false"),this.hiddenTextarea.setAttribute("data-fabric-hiddentextarea",""),this.hiddenTextarea.setAttribute("wrap","off");var l=this._calcTextareaPosition();this.hiddenTextarea.style.cssText="position: absolute; top: "+l.top+"; left: "+l.left+"; z-index: -999; opacity: 0; width: 1px; height: 1px; font-size: 1px; paddingｰtop: "+l.fontSize+";",this.hiddenTextareaContainer?this.hiddenTextareaContainer.appendChild(this.hiddenTextarea):y.document.body.appendChild(this.hiddenTextarea),y.util.addListener(this.hiddenTextarea,"keydown",this.onKeyDown.bind(this)),y.util.addListener(this.hiddenTextarea,"keyup",this.onKeyUp.bind(this)),y.util.addListener(this.hiddenTextarea,"input",this.onInput.bind(this)),y.util.addListener(this.hiddenTextarea,"copy",this.copy.bind(this)),y.util.addListener(this.hiddenTextarea,"cut",this.copy.bind(this)),y.util.addListener(this.hiddenTextarea,"paste",this.paste.bind(this)),y.util.addListener(this.hiddenTextarea,"compositionstart",this.onCompositionStart.bind(this)),y.util.addListener(this.hiddenTextarea,"compositionupdate",this.onCompositionUpdate.bind(this)),y.util.addListener(this.hiddenTextarea,"compositionend",this.onCompositionEnd.bind(this)),!this._clickHandlerInitialized&&this.canvas&&(y.util.addListener(this.canvas.upperCanvasEl,"click",this.onClick.bind(this)),this._clickHandlerInitialized=!0)},keysMap:{9:"exitEditing",27:"exitEditing",33:"moveCursorUp",34:"moveCursorDown",35:"moveCursorRight",36:"moveCursorLeft",37:"moveCursorLeft",38:"moveCursorUp",39:"moveCursorRight",40:"moveCursorDown"},keysMapRtl:{9:"exitEditing",27:"exitEditing",33:"moveCursorUp",34:"moveCursorDown",35:"moveCursorLeft",36:"moveCursorRight",37:"moveCursorRight",38:"moveCursorUp",39:"moveCursorLeft",40:"moveCursorDown"},ctrlKeysMapUp:{67:"copy",88:"cut"},ctrlKeysMapDown:{65:"selectAll"},onClick:function(){this.hiddenTextarea&&this.hiddenTextarea.focus()},onKeyDown:function(l){if(this.isEditing){var s=this.direction==="rtl"?this.keysMapRtl:this.keysMap;if(l.keyCode in s)this[s[l.keyCode]](l);else{if(!(l.keyCode in this.ctrlKeysMapDown)||!l.ctrlKey&&!l.metaKey)return;this[this.ctrlKeysMapDown[l.keyCode]](l)}l.stopImmediatePropagation(),l.preventDefault(),l.keyCode>=33&&l.keyCode<=40?(this.inCompositionMode=!1,this.clearContextTop(),this.renderCursorOrSelection()):this.canvas&&this.canvas.requestRenderAll()}},onKeyUp:function(l){!this.isEditing||this._copyDone||this.inCompositionMode?this._copyDone=!1:l.keyCode in this.ctrlKeysMapUp&&(l.ctrlKey||l.metaKey)&&(this[this.ctrlKeysMapUp[l.keyCode]](l),l.stopImmediatePropagation(),l.preventDefault(),this.canvas&&this.canvas.requestRenderAll())},onInput:function(l){var s=this.fromPaste;if(this.fromPaste=!1,l&&l.stopPropagation(),this.isEditing){var a,u,i,r,c,p=this._splitTextIntoLines(this.hiddenTextarea.value).graphemeText,f=this._text.length,d=p.length,_=d-f,w=this.selectionStart,T=this.selectionEnd,x=w!==T;if(this.hiddenTextarea.value==="")return this.styles={},this.updateFromTextArea(),this.fire("changed"),void(this.canvas&&(this.canvas.fire("text:changed",{target:this}),this.canvas.requestRenderAll()));var b=this.fromStringToGraphemeSelection(this.hiddenTextarea.selectionStart,this.hiddenTextarea.selectionEnd,this.hiddenTextarea.value),F=w>b.selectionStart;x?(a=this._text.slice(w,T),_+=T-w):d<f&&(a=F?this._text.slice(T+_,T):this._text.slice(w,w-_)),u=p.slice(b.selectionEnd-_,b.selectionEnd),a&&a.length&&(u.length&&(i=this.getSelectionStyles(w,w+1,!1),i=u.map(function(){return i[0]})),x?(r=w,c=T):F?(r=T-a.length,c=T):(r=T,c=T+a.length),this.removeStyleFromTo(r,c)),u.length&&(s&&u.join("")===y.copiedText&&!y.disableStyleCopyPaste&&(i=y.copiedTextStyle),this.insertNewStyleBlock(u,w,i)),this.updateFromTextArea(),this.fire("changed"),this.canvas&&(this.canvas.fire("text:changed",{target:this}),this.canvas.requestRenderAll())}},onCompositionStart:function(){this.inCompositionMode=!0},onCompositionEnd:function(){this.inCompositionMode=!1},onCompositionUpdate:function(l){this.compositionStart=l.target.selectionStart,this.compositionEnd=l.target.selectionEnd,this.updateTextareaPosition()},copy:function(){this.selectionStart!==this.selectionEnd&&(y.copiedText=this.getSelectedText(),y.disableStyleCopyPaste?y.copiedTextStyle=null:y.copiedTextStyle=this.getSelectionStyles(this.selectionStart,this.selectionEnd,!0),this._copyDone=!0)},paste:function(){this.fromPaste=!0},_getClipboardData:function(l){return l&&l.clipboardData||y.window.clipboardData},_getWidthBeforeCursor:function(l,s){var a,u=this._getLineLeftOffset(l);return s>0&&(u+=(a=this.__charBounds[l][s-1]).left+a.width),u},getDownCursorOffset:function(l,s){var a=this._getSelectionForOffset(l,s),u=this.get2DCursorLocation(a),i=u.lineIndex;if(i===this._textLines.length-1||l.metaKey||l.keyCode===34)return this._text.length-a;var r=u.charIndex,c=this._getWidthBeforeCursor(i,r),p=this._getIndexOnLine(i+1,c);return this._textLines[i].slice(r).length+p+1+this.missingNewlineOffset(i)},_getSelectionForOffset:function(l,s){return l.shiftKey&&this.selectionStart!==this.selectionEnd&&s?this.selectionEnd:this.selectionStart},getUpCursorOffset:function(l,s){var a=this._getSelectionForOffset(l,s),u=this.get2DCursorLocation(a),i=u.lineIndex;if(i===0||l.metaKey||l.keyCode===33)return-a;var r=u.charIndex,c=this._getWidthBeforeCursor(i,r),p=this._getIndexOnLine(i-1,c),f=this._textLines[i].slice(0,r),d=this.missingNewlineOffset(i-1);return-this._textLines[i-1].length+p-f.length+(1-d)},_getIndexOnLine:function(l,s){for(var a,u,i=this._textLines[l],r=this._getLineLeftOffset(l),c=0,p=0,f=i.length;p<f;p++)if((r+=a=this.__charBounds[l][p].width)>s){u=!0;var d=r-a,_=r,w=Math.abs(d-s);c=Math.abs(_-s)<w?p:p-1;break}return u||(c=i.length-1),c},moveCursorDown:function(l){this.selectionStart>=this._text.length&&this.selectionEnd>=this._text.length||this._moveCursorUpOrDown("Down",l)},moveCursorUp:function(l){this.selectionStart===0&&this.selectionEnd===0||this._moveCursorUpOrDown("Up",l)},_moveCursorUpOrDown:function(l,s){var a=this["get"+l+"CursorOffset"](s,this._selectionDirection==="right");s.shiftKey?this.moveCursorWithShift(a):this.moveCursorWithoutShift(a),a!==0&&(this.setSelectionInBoundaries(),this.abortCursorAnimation(),this._currentCursorOpacity=1,this.initDelayedCursor(),this._fireSelectionChanged(),this._updateTextarea())},moveCursorWithShift:function(l){var s=this._selectionDirection==="left"?this.selectionStart+l:this.selectionEnd+l;return this.setSelectionStartEndWithShift(this.selectionStart,this.selectionEnd,s),l!==0},moveCursorWithoutShift:function(l){return l<0?(this.selectionStart+=l,this.selectionEnd=this.selectionStart):(this.selectionEnd+=l,this.selectionStart=this.selectionEnd),l!==0},moveCursorLeft:function(l){this.selectionStart===0&&this.selectionEnd===0||this._moveCursorLeftOrRight("Left",l)},_move:function(l,s,a){var u;if(l.altKey)u=this["findWordBoundary"+a](this[s]);else{if(!l.metaKey&&l.keyCode!==35&&l.keyCode!==36)return this[s]+=a==="Left"?-1:1,!0;u=this["findLineBoundary"+a](this[s])}if(typeof u!==void 0&&this[s]!==u)return this[s]=u,!0},_moveLeft:function(l,s){return this._move(l,s,"Left")},_moveRight:function(l,s){return this._move(l,s,"Right")},moveCursorLeftWithoutShift:function(l){var s=!0;return this._selectionDirection="left",this.selectionEnd===this.selectionStart&&this.selectionStart!==0&&(s=this._moveLeft(l,"selectionStart")),this.selectionEnd=this.selectionStart,s},moveCursorLeftWithShift:function(l){return this._selectionDirection==="right"&&this.selectionStart!==this.selectionEnd?this._moveLeft(l,"selectionEnd"):this.selectionStart!==0?(this._selectionDirection="left",this._moveLeft(l,"selectionStart")):void 0},moveCursorRight:function(l){this.selectionStart>=this._text.length&&this.selectionEnd>=this._text.length||this._moveCursorLeftOrRight("Right",l)},_moveCursorLeftOrRight:function(l,s){var a="moveCursor"+l+"With";this._currentCursorOpacity=1,s.shiftKey?a+="Shift":a+="outShift",this[a](s)&&(this.abortCursorAnimation(),this.initDelayedCursor(),this._fireSelectionChanged(),this._updateTextarea())},moveCursorRightWithShift:function(l){return this._selectionDirection==="left"&&this.selectionStart!==this.selectionEnd?this._moveRight(l,"selectionStart"):this.selectionEnd!==this._text.length?(this._selectionDirection="right",this._moveRight(l,"selectionEnd")):void 0},moveCursorRightWithoutShift:function(l){var s=!0;return this._selectionDirection="right",this.selectionStart===this.selectionEnd?(s=this._moveRight(l,"selectionStart"),this.selectionEnd=this.selectionStart):this.selectionStart=this.selectionEnd,s},removeChars:function(l,s){s===void 0&&(s=l+1),this.removeStyleFromTo(l,s),this._text.splice(l,s-l),this.text=this._text.join(""),this.set("dirty",!0),this._shouldClearDimensionCache()&&(this.initDimensions(),this.setCoords()),this._removeExtraneousStyles()},insertChars:function(l,s,a,u){u===void 0&&(u=a),u>a&&this.removeStyleFromTo(a,u);var i=y.util.string.graphemeSplit(l);this.insertNewStyleBlock(i,a,s),this._text=[].concat(this._text.slice(0,a),i,this._text.slice(u)),this.text=this._text.join(""),this.set("dirty",!0),this._shouldClearDimensionCache()&&(this.initDimensions(),this.setCoords()),this._removeExtraneousStyles()}}),function(){var l=y.util.toFixed,s=/  +/g;y.util.object.extend(y.Text.prototype,{_toSVG:function(){var a=this._getSVGLeftTopOffsets(),u=this._getSVGTextAndBg(a.textTop,a.textLeft);return this._wrapSVGTextAndBg(u)},toSVG:function(a){return this._createBaseSVGMarkup(this._toSVG(),{reviver:a,noStyle:!0,withShadow:!0})},_getSVGLeftTopOffsets:function(){return{textLeft:-this.width/2,textTop:-this.height/2,lineTop:this.getHeightOfLine(0)}},_wrapSVGTextAndBg:function(a){var u=this.getSvgTextDecoration(this);return[a.textBgRects.join(""),'		<text xml:space="preserve" ',this.fontFamily?'font-family="'+this.fontFamily.replace(/"/g,"'")+'" ':"",this.fontSize?'font-size="'+this.fontSize+'" ':"",this.fontStyle?'font-style="'+this.fontStyle+'" ':"",this.fontWeight?'font-weight="'+this.fontWeight+'" ':"",u?'text-decoration="'+u+'" ':"",'style="',this.getSvgStyles(!0),'"',this.addPaintOrder()," >",a.textSpans.join(""),`</text>
`]},_getSVGTextAndBg:function(a,u){var i,r=[],c=[],p=a;this._setSVGBg(c);for(var f=0,d=this._textLines.length;f<d;f++)i=this._getLineLeftOffset(f),(this.textBackgroundColor||this.styleHas("textBackgroundColor",f))&&this._setSVGTextLineBg(c,f,u+i,p),this._setSVGTextLineText(r,f,u+i,p),p+=this.getHeightOfLine(f);return{textSpans:r,textBgRects:c}},_createTextCharSpan:function(a,u,i,r){var c=a!==a.trim()||a.match(s),p=this.getSvgSpanStyles(u,c),f=p?'style="'+p+'"':"",d=u.deltaY,_="",w=y.Object.NUM_FRACTION_DIGITS;return d&&(_=' dy="'+l(d,w)+'" '),['<tspan x="',l(i,w),'" y="',l(r,w),'" ',_,f,">",y.util.string.escapeXml(a),"</tspan>"].join("")},_setSVGTextLineText:function(a,u,i,r){var c,p,f,d,_,w=this.getHeightOfLine(u),T=this.textAlign.indexOf("justify")!==-1,x="",b=0,F=this._textLines[u];r+=w*(1-this._fontSizeFraction)/this.lineHeight;for(var B=0,z=F.length-1;B<=z;B++)_=B===z||this.charSpacing,x+=F[B],f=this.__charBounds[u][B],b===0?(i+=f.kernedWidth-f.width,b+=f.width):b+=f.kernedWidth,T&&!_&&this._reSpaceAndTab.test(F[B])&&(_=!0),_||(c=c||this.getCompleteStyleDeclaration(u,B),p=this.getCompleteStyleDeclaration(u,B+1),_=this._hasStyleChangedForSvg(c,p)),_&&(d=this._getStyleDeclaration(u,B)||{},a.push(this._createTextCharSpan(x,d,i,r)),x="",c=p,i+=b,b=0)},_pushTextBgRect:function(a,u,i,r,c,p){var f=y.Object.NUM_FRACTION_DIGITS;a.push("		<rect ",this._getFillAttributes(u),' x="',l(i,f),'" y="',l(r,f),'" width="',l(c,f),'" height="',l(p,f),`"></rect>
`)},_setSVGTextLineBg:function(a,u,i,r){for(var c,p,f=this._textLines[u],d=this.getHeightOfLine(u)/this.lineHeight,_=0,w=0,T=this.getValueOfPropertyAt(u,0,"textBackgroundColor"),x=0,b=f.length;x<b;x++)c=this.__charBounds[u][x],(p=this.getValueOfPropertyAt(u,x,"textBackgroundColor"))!==T?(T&&this._pushTextBgRect(a,T,i+w,r,_,d),w=c.left,_=c.width,T=p):_+=c.kernedWidth;p&&this._pushTextBgRect(a,p,i+w,r,_,d)},_getFillAttributes:function(a){var u=a&&typeof a=="string"?new y.Color(a):"";return u&&u.getSource()&&u.getAlpha()!==1?'opacity="'+u.getAlpha()+'" fill="'+u.setAlpha(1).toRgb()+'"':'fill="'+a+'"'},_getSVGLineTopOffset:function(a){for(var u,i=0,r=0;r<a;r++)i+=this.getHeightOfLine(r);return u=this.getHeightOfLine(r),{lineTop:i,offset:(this._fontSizeMult-this._fontSizeFraction)*u/(this.lineHeight*this._fontSizeMult)}},getSvgStyles:function(a){return y.Object.prototype.getSvgStyles.call(this,a)+" white-space: pre;"}})}(),function(l){var s=l.fabric||(l.fabric={});s.Textbox=s.util.createClass(s.IText,s.Observable,{type:"textbox",minWidth:20,dynamicMinWidth:2,__cachedLines:null,lockScalingFlip:!0,noScaleCache:!1,_dimensionAffectingProps:s.Text.prototype._dimensionAffectingProps.concat("width"),_wordJoiners:/[ \t\r]/,splitByGrapheme:!1,initDimensions:function(){this.__skipDimension||(this.isEditing&&this.initDelayedCursor(),this.clearContextTop(),this._clearCache(),this.dynamicMinWidth=0,this._styleMap=this._generateStyleMap(this._splitText()),this.dynamicMinWidth>this.width&&this._set("width",this.dynamicMinWidth),this.textAlign.indexOf("justify")!==-1&&this.enlargeSpaces(),this.height=this.calcTextHeight(),this.saveState({propertySet:"_dimensionAffectingProps"}))},_generateStyleMap:function(a){for(var u=0,i=0,r=0,c={},p=0;p<a.graphemeLines.length;p++)a.graphemeText[r]===`
`&&p>0?(i=0,r++,u++):!this.splitByGrapheme&&this._reSpaceAndTab.test(a.graphemeText[r])&&p>0&&(i++,r++),c[p]={line:u,offset:i},r+=a.graphemeLines[p].length,i+=a.graphemeLines[p].length;return c},styleHas:function(a,u){if(this._styleMap&&!this.isWrapping){var i=this._styleMap[u];i&&(u=i.line)}return s.Text.prototype.styleHas.call(this,a,u)},isEmptyStyles:function(a){if(!this.styles)return!0;var u,i,r=0,c=!1,p=this._styleMap[a],f=this._styleMap[a+1];for(var d in p&&(a=p.line,r=p.offset),f&&(c=f.line===a,u=f.offset),i=a===void 0?this.styles:{line:this.styles[a]})for(var _ in i[d])if(_>=r&&(!c||_<u))for(var w in i[d][_])return!1;return!0},_getStyleDeclaration:function(a,u){if(this._styleMap&&!this.isWrapping){var i=this._styleMap[a];if(!i)return null;a=i.line,u=i.offset+u}return this.callSuper("_getStyleDeclaration",a,u)},_setStyleDeclaration:function(a,u,i){var r=this._styleMap[a];a=r.line,u=r.offset+u,this.styles[a][u]=i},_deleteStyleDeclaration:function(a,u){var i=this._styleMap[a];a=i.line,u=i.offset+u,delete this.styles[a][u]},_getLineStyle:function(a){var u=this._styleMap[a];return!!this.styles[u.line]},_setLineStyle:function(a){var u=this._styleMap[a];this.styles[u.line]={}},_wrapText:function(a,u){var i,r=[];for(this.isWrapping=!0,i=0;i<a.length;i++)r=r.concat(this._wrapLine(a[i],i,u));return this.isWrapping=!1,r},_measureWord:function(a,u,i){var r,c=0;i=i||0;for(var p=0,f=a.length;p<f;p++)c+=this._getGraphemeBox(a[p],u,p+i,r,!0).kernedWidth,r=a[p];return c},_wrapLine:function(a,u,i,r){var c=0,p=this.splitByGrapheme,f=[],d=[],_=p?s.util.string.graphemeSplit(a):a.split(this._wordJoiners),w="",T=0,x=p?"":" ",b=0,F=0,B=0,z=!0,$=this._getWidthOfCharSpacing();r=r||0,_.length===0&&_.push([]),i-=r;for(var Q=0;Q<_.length;Q++)w=p?_[Q]:s.util.string.graphemeSplit(_[Q]),b=this._measureWord(w,u,T),T+=w.length,(c+=F+b-$)>i&&!z?(f.push(d),d=[],c=b,z=!0):c+=$,z||p||d.push(x),d=d.concat(w),F=p?0:this._measureWord([x],u,T),T++,z=!1,b>B&&(B=b);return Q&&f.push(d),B+r>this.dynamicMinWidth&&(this.dynamicMinWidth=B-$+r),f},isEndOfWrapping:function(a){return!this._styleMap[a+1]||this._styleMap[a+1].line!==this._styleMap[a].line},missingNewlineOffset:function(a){return this.splitByGrapheme?this.isEndOfWrapping(a)?1:0:1},_splitTextIntoLines:function(a){for(var u=s.Text.prototype._splitTextIntoLines.call(this,a),i=this._wrapText(u.lines,this.width),r=new Array(i.length),c=0;c<i.length;c++)r[c]=i[c].join("");return u.lines=r,u.graphemeLines=i,u},getMinWidth:function(){return Math.max(this.minWidth,this.dynamicMinWidth)},_removeExtraneousStyles:function(){var a={};for(var u in this._styleMap)this._textLines[u]&&(a[this._styleMap[u].line]=1);for(var u in this.styles)a[u]||delete this.styles[u]},toObject:function(a){return this.callSuper("toObject",["minWidth","splitByGrapheme"].concat(a))}}),s.Textbox.fromObject=function(a,u){return s.Object._fromObject("Textbox",a,u,"text")}}(e),function(){var l=y.controlsUtils,s=l.scaleSkewCursorStyleHandler,a=l.scaleCursorStyleHandler,u=l.scalingEqually,i=l.scalingYOrSkewingX,r=l.scalingXOrSkewingY,c=l.scaleOrSkewActionName,p=y.Object.prototype.controls;if(p.ml=new y.Control({x:-.5,y:0,cursorStyleHandler:s,actionHandler:r,getActionName:c}),p.mr=new y.Control({x:.5,y:0,cursorStyleHandler:s,actionHandler:r,getActionName:c}),p.mb=new y.Control({x:0,y:.5,cursorStyleHandler:s,actionHandler:i,getActionName:c}),p.mt=new y.Control({x:0,y:-.5,cursorStyleHandler:s,actionHandler:i,getActionName:c}),p.tl=new y.Control({x:-.5,y:-.5,cursorStyleHandler:a,actionHandler:u}),p.tr=new y.Control({x:.5,y:-.5,cursorStyleHandler:a,actionHandler:u}),p.bl=new y.Control({x:-.5,y:.5,cursorStyleHandler:a,actionHandler:u}),p.br=new y.Control({x:.5,y:.5,cursorStyleHandler:a,actionHandler:u}),p.mtr=new y.Control({x:0,y:-.5,actionHandler:l.rotationWithSnapping,cursorStyleHandler:l.rotationStyleHandler,offsetY:-40,withConnection:!0,actionName:"rotate"}),y.Textbox){var f=y.Textbox.prototype.controls={};f.mtr=p.mtr,f.tr=p.tr,f.br=p.br,f.tl=p.tl,f.bl=p.bl,f.mt=p.mt,f.mb=p.mb,f.mr=new y.Control({x:.5,y:0,actionHandler:l.changeWidth,cursorStyleHandler:s,actionName:"resizing"}),f.ml=new y.Control({x:-.5,y:0,actionHandler:l.changeWidth,cursorStyleHandler:s,actionName:"resizing"})}}()},192:()=>{},898:()=>{},245:()=>{}},Ml={};function qi(t){var e=Ml[t];if(e!==void 0)return e.exports;var n=Ml[t]={exports:{}};return sd[t](n,n.exports,qi),n.exports}qi.d=(t,e)=>{for(var n in e)qi.o(e,n)&&!qi.o(t,n)&&Object.defineProperty(t,n,{enumerable:!0,get:e[n]})},qi.o=(t,e)=>Object.prototype.hasOwnProperty.call(t,e);var nh={};(()=>{let t;qi.d(nh,{R:()=>t}),t=typeof document<"u"&&typeof window<"u"?qi(653).fabric:{version:"5.2.1"}})();var je=nh.R;/*!
 *  Spatial Plugin - Adds support for stereo and 3D audio where Web Audio is supported.
 *  
 *  howler.js v2.2.3
 *  howlerjs.com
 *
 *  (c) 2013-2020, James Simpson of GoldFire Studios
 *  goldfirestudios.com
 *
 *  MIT License
 */function od(t,e,n,o){t.prototype._pos=[0,0,0],t.prototype._orientation=[0,0,-1,0,1,0],t.prototype.stereo=function(g){var m=this;if(!m.ctx||!m.ctx.listener)return m;for(var v=m._howls.length-1;v>=0;v--)m._howls[v].stereo(g);return m},t.prototype.pos=function(g,m,v){var C=this;if(!C.ctx||!C.ctx.listener)return C;if(m=typeof m!="number"?C._pos[1]:m,v=typeof v!="number"?C._pos[2]:v,typeof g=="number")C._pos=[g,m,v],typeof C.ctx.listener.positionX<"u"?(C.ctx.listener.positionX.setTargetAtTime(C._pos[0],e.ctx.currentTime,.1),C.ctx.listener.positionY.setTargetAtTime(C._pos[1],e.ctx.currentTime,.1),C.ctx.listener.positionZ.setTargetAtTime(C._pos[2],e.ctx.currentTime,.1)):C.ctx.listener.setPosition(C._pos[0],C._pos[1],C._pos[2]);else return C._pos;return C},t.prototype.orientation=function(g,m,v,C,E,I){var R=this;if(!R.ctx||!R.ctx.listener)return R;var L=R._orientation;if(m=typeof m!="number"?L[1]:m,v=typeof v!="number"?L[2]:v,C=typeof C!="number"?L[3]:C,E=typeof E!="number"?L[4]:E,I=typeof I!="number"?L[5]:I,typeof g=="number")R._orientation=[g,m,v,C,E,I],typeof R.ctx.listener.forwardX<"u"?(R.ctx.listener.forwardX.setTargetAtTime(g,e.ctx.currentTime,.1),R.ctx.listener.forwardY.setTargetAtTime(m,e.ctx.currentTime,.1),R.ctx.listener.forwardZ.setTargetAtTime(v,e.ctx.currentTime,.1),R.ctx.listener.upX.setTargetAtTime(C,e.ctx.currentTime,.1),R.ctx.listener.upY.setTargetAtTime(E,e.ctx.currentTime,.1),R.ctx.listener.upZ.setTargetAtTime(I,e.ctx.currentTime,.1)):R.ctx.listener.setOrientation(g,m,v,C,E,I);else return L;return R},n.prototype.init=function(g){return function(m){var v=this;return v._orientation=m.orientation||[1,0,0],v._stereo=m.stereo||null,v._pos=m.pos||null,v._pannerAttr={coneInnerAngle:typeof m.coneInnerAngle<"u"?m.coneInnerAngle:360,coneOuterAngle:typeof m.coneOuterAngle<"u"?m.coneOuterAngle:360,coneOuterGain:typeof m.coneOuterGain<"u"?m.coneOuterGain:0,distanceModel:typeof m.distanceModel<"u"?m.distanceModel:"inverse",maxDistance:typeof m.maxDistance<"u"?m.maxDistance:1e4,panningModel:typeof m.panningModel<"u"?m.panningModel:"HRTF",refDistance:typeof m.refDistance<"u"?m.refDistance:1,rolloffFactor:typeof m.rolloffFactor<"u"?m.rolloffFactor:1},v._onstereo=m.onstereo?[{fn:m.onstereo}]:[],v._onpos=m.onpos?[{fn:m.onpos}]:[],v._onorientation=m.onorientation?[{fn:m.onorientation}]:[],g.call(this,m)}}(n.prototype.init),n.prototype.stereo=function(g,m){var v=this;if(!v._webAudio)return v;if(v._state!=="loaded")return v._queue.push({event:"stereo",action:function(){v.stereo(g,m)}}),v;var C=typeof e.ctx.createStereoPanner>"u"?"spatial":"stereo";if(typeof m>"u")if(typeof g=="number")v._stereo=g,v._pos=[g,0,0];else return v._stereo;for(var E=v._getSoundIds(m),I=0;I<E.length;I++){var R=v._soundById(E[I]);if(R)if(typeof g=="number")R._stereo=g,R._pos=[g,0,0],R._node&&(R._pannerAttr.panningModel="equalpower",(!R._panner||!R._panner.pan)&&h(R,C),C==="spatial"?typeof R._panner.positionX<"u"?(R._panner.positionX.setValueAtTime(g,e.ctx.currentTime),R._panner.positionY.setValueAtTime(0,e.ctx.currentTime),R._panner.positionZ.setValueAtTime(0,e.ctx.currentTime)):R._panner.setPosition(g,0,0):R._panner.pan.setValueAtTime(g,e.ctx.currentTime)),v._emit("stereo",R._id);else return R._stereo}return v},n.prototype.pos=function(g,m,v,C){var E=this;if(!E._webAudio)return E;if(E._state!=="loaded")return E._queue.push({event:"pos",action:function(){E.pos(g,m,v,C)}}),E;if(m=typeof m!="number"?0:m,v=typeof v!="number"?-.5:v,typeof C>"u")if(typeof g=="number")E._pos=[g,m,v];else return E._pos;for(var I=E._getSoundIds(C),R=0;R<I.length;R++){var L=E._soundById(I[R]);if(L)if(typeof g=="number")L._pos=[g,m,v],L._node&&((!L._panner||L._panner.pan)&&h(L,"spatial"),typeof L._panner.positionX<"u"?(L._panner.positionX.setValueAtTime(g,e.ctx.currentTime),L._panner.positionY.setValueAtTime(m,e.ctx.currentTime),L._panner.positionZ.setValueAtTime(v,e.ctx.currentTime)):L._panner.setPosition(g,m,v)),E._emit("pos",L._id);else return L._pos}return E},n.prototype.orientation=function(g,m,v,C){var E=this;if(!E._webAudio)return E;if(E._state!=="loaded")return E._queue.push({event:"orientation",action:function(){E.orientation(g,m,v,C)}}),E;if(m=typeof m!="number"?E._orientation[1]:m,v=typeof v!="number"?E._orientation[2]:v,typeof C>"u")if(typeof g=="number")E._orientation=[g,m,v];else return E._orientation;for(var I=E._getSoundIds(C),R=0;R<I.length;R++){var L=E._soundById(I[R]);if(L)if(typeof g=="number")L._orientation=[g,m,v],L._node&&(L._panner||(L._pos||(L._pos=E._pos||[0,0,-.5]),h(L,"spatial")),typeof L._panner.orientationX<"u"?(L._panner.orientationX.setValueAtTime(g,e.ctx.currentTime),L._panner.orientationY.setValueAtTime(m,e.ctx.currentTime),L._panner.orientationZ.setValueAtTime(v,e.ctx.currentTime)):L._panner.setOrientation(g,m,v)),E._emit("orientation",L._id);else return L._orientation}return E},n.prototype.pannerAttr=function(){var g=this,m=arguments,v,C,E;if(!g._webAudio)return g;if(m.length===0)return g._pannerAttr;if(m.length===1)if(typeof m[0]=="object")v=m[0],typeof C>"u"&&(v.pannerAttr||(v.pannerAttr={coneInnerAngle:v.coneInnerAngle,coneOuterAngle:v.coneOuterAngle,coneOuterGain:v.coneOuterGain,distanceModel:v.distanceModel,maxDistance:v.maxDistance,refDistance:v.refDistance,rolloffFactor:v.rolloffFactor,panningModel:v.panningModel}),g._pannerAttr={coneInnerAngle:typeof v.pannerAttr.coneInnerAngle<"u"?v.pannerAttr.coneInnerAngle:g._coneInnerAngle,coneOuterAngle:typeof v.pannerAttr.coneOuterAngle<"u"?v.pannerAttr.coneOuterAngle:g._coneOuterAngle,coneOuterGain:typeof v.pannerAttr.coneOuterGain<"u"?v.pannerAttr.coneOuterGain:g._coneOuterGain,distanceModel:typeof v.pannerAttr.distanceModel<"u"?v.pannerAttr.distanceModel:g._distanceModel,maxDistance:typeof v.pannerAttr.maxDistance<"u"?v.pannerAttr.maxDistance:g._maxDistance,refDistance:typeof v.pannerAttr.refDistance<"u"?v.pannerAttr.refDistance:g._refDistance,rolloffFactor:typeof v.pannerAttr.rolloffFactor<"u"?v.pannerAttr.rolloffFactor:g._rolloffFactor,panningModel:typeof v.pannerAttr.panningModel<"u"?v.pannerAttr.panningModel:g._panningModel});else return E=g._soundById(parseInt(m[0],10)),E?E._pannerAttr:g._pannerAttr;else m.length===2&&(v=m[0],C=parseInt(m[1],10));for(var I=g._getSoundIds(C),R=0;R<I.length;R++)if(E=g._soundById(I[R]),E){var L=E._pannerAttr;L={coneInnerAngle:typeof v.coneInnerAngle<"u"?v.coneInnerAngle:L.coneInnerAngle,coneOuterAngle:typeof v.coneOuterAngle<"u"?v.coneOuterAngle:L.coneOuterAngle,coneOuterGain:typeof v.coneOuterGain<"u"?v.coneOuterGain:L.coneOuterGain,distanceModel:typeof v.distanceModel<"u"?v.distanceModel:L.distanceModel,maxDistance:typeof v.maxDistance<"u"?v.maxDistance:L.maxDistance,refDistance:typeof v.refDistance<"u"?v.refDistance:L.refDistance,rolloffFactor:typeof v.rolloffFactor<"u"?v.rolloffFactor:L.rolloffFactor,panningModel:typeof v.panningModel<"u"?v.panningModel:L.panningModel};var N=E._panner;N||(E._pos||(E._pos=g._pos||[0,0,-.5]),h(E,"spatial"),N=E._panner),N.coneInnerAngle=L.coneInnerAngle,N.coneOuterAngle=L.coneOuterAngle,N.coneOuterGain=L.coneOuterGain,N.distanceModel=L.distanceModel,N.maxDistance=L.maxDistance,N.refDistance=L.refDistance,N.rolloffFactor=L.rolloffFactor,N.panningModel=L.panningModel}return g},o.prototype.init=function(g){return function(){var m=this,v=m._parent;m._orientation=v._orientation,m._stereo=v._stereo,m._pos=v._pos,m._pannerAttr=v._pannerAttr,g.call(this),m._stereo?v.stereo(m._stereo):m._pos&&v.pos(m._pos[0],m._pos[1],m._pos[2],m._id)}}(o.prototype.init),o.prototype.reset=function(g){return function(){var m=this,v=m._parent;return m._orientation=v._orientation,m._stereo=v._stereo,m._pos=v._pos,m._pannerAttr=v._pannerAttr,m._stereo?v.stereo(m._stereo):m._pos?v.pos(m._pos[0],m._pos[1],m._pos[2],m._id):m._panner&&(m._panner.disconnect(0),m._panner=void 0,v._refreshBuffer(m)),g.call(this)}}(o.prototype.reset);var h=function(g,m){m=m||"spatial",m==="spatial"?(g._panner=e.ctx.createPanner(),g._panner.coneInnerAngle=g._pannerAttr.coneInnerAngle,g._panner.coneOuterAngle=g._pannerAttr.coneOuterAngle,g._panner.coneOuterGain=g._pannerAttr.coneOuterGain,g._panner.distanceModel=g._pannerAttr.distanceModel,g._panner.maxDistance=g._pannerAttr.maxDistance,g._panner.refDistance=g._pannerAttr.refDistance,g._panner.rolloffFactor=g._pannerAttr.rolloffFactor,g._panner.panningModel=g._pannerAttr.panningModel,typeof g._panner.positionX<"u"?(g._panner.positionX.setValueAtTime(g._pos[0],e.ctx.currentTime),g._panner.positionY.setValueAtTime(g._pos[1],e.ctx.currentTime),g._panner.positionZ.setValueAtTime(g._pos[2],e.ctx.currentTime)):g._panner.setPosition(g._pos[0],g._pos[1],g._pos[2]),typeof g._panner.orientationX<"u"?(g._panner.orientationX.setValueAtTime(g._orientation[0],e.ctx.currentTime),g._panner.orientationY.setValueAtTime(g._orientation[1],e.ctx.currentTime),g._panner.orientationZ.setValueAtTime(g._orientation[2],e.ctx.currentTime)):g._panner.setOrientation(g._orientation[0],g._orientation[1],g._orientation[2])):(g._panner=e.ctx.createStereoPanner(),g._panner.pan.setValueAtTime(g._stereo,e.ctx.currentTime)),g._panner.connect(g._node),g._paused||g._parent.pause(g._id,!0).play(g._id,!0)}}/*!
 *  howler.js v2.2.3
 *  howlerjs.com
 *
 *  (c) 2013-2020, James Simpson of GoldFire Studios
 *  goldfirestudios.com
 *
 *  MIT License
 */var Ma=function(){this.init()};Ma.prototype={init:function(){var t=this||ae;return t._counter=1e3,t._html5AudioPool=[],t.html5PoolSize=10,t._codecs={},t._howls=[],t._muted=!1,t._volume=1,t._canPlayEvent="canplaythrough",t._navigator=typeof window<"u"&&window.navigator?window.navigator:null,t.masterGain=null,t.noAudio=!1,t.usingWebAudio=!0,t.autoSuspend=!0,t.ctx=null,t.autoUnlock=!0,t._setup(),t},volume:function(t){var e=this||ae;if(t=parseFloat(t),e.ctx||qr(),typeof t<"u"&&t>=0&&t<=1){if(e._volume=t,e._muted)return e;e.usingWebAudio&&e.masterGain.gain.setValueAtTime(t,ae.ctx.currentTime);for(var n=0;n<e._howls.length;n++)if(!e._howls[n]._webAudio)for(var o=e._howls[n]._getSoundIds(),h=0;h<o.length;h++){var g=e._howls[n]._soundById(o[h]);g&&g._node&&(g._node.volume=g._volume*t)}return e}return e._volume},mute:function(t){var e=this||ae;e.ctx||qr(),e._muted=t,e.usingWebAudio&&e.masterGain.gain.setValueAtTime(t?0:e._volume,ae.ctx.currentTime);for(var n=0;n<e._howls.length;n++)if(!e._howls[n]._webAudio)for(var o=e._howls[n]._getSoundIds(),h=0;h<o.length;h++){var g=e._howls[n]._soundById(o[h]);g&&g._node&&(g._node.muted=t?!0:g._muted)}return e},stop:function(){for(var t=this||ae,e=0;e<t._howls.length;e++)t._howls[e].stop();return t},unload:function(){for(var t=this||ae,e=t._howls.length-1;e>=0;e--)t._howls[e].unload();return t.usingWebAudio&&t.ctx&&typeof t.ctx.close<"u"&&(t.ctx.close(),t.ctx=null,qr()),t},codecs:function(t){return(this||ae)._codecs[t.replace(/^x-/,"")]},_setup:function(){var t=this||ae;if(t.state=t.ctx&&t.ctx.state||"suspended",t._autoSuspend(),!t.usingWebAudio)if(typeof Audio<"u")try{var e=new Audio;typeof e.oncanplaythrough>"u"&&(t._canPlayEvent="canplay")}catch{t.noAudio=!0}else t.noAudio=!0;try{var e=new Audio;e.muted&&(t.noAudio=!0)}catch{}return t.noAudio||t._setupCodecs(),t},_setupCodecs:function(){var t=this||ae,e=null;try{e=typeof Audio<"u"?new Audio:null}catch{return t}if(!e||typeof e.canPlayType!="function")return t;var n=e.canPlayType("audio/mpeg;").replace(/^no$/,""),o=t._navigator?t._navigator.userAgent:"",h=o.match(/OPR\/([0-6].)/g),g=h&&parseInt(h[0].split("/")[1],10)<33,m=o.indexOf("Safari")!==-1&&o.indexOf("Chrome")===-1,v=o.match(/Version\/(.*?) /),C=m&&v&&parseInt(v[1],10)<15;return t._codecs={mp3:!!(!g&&(n||e.canPlayType("audio/mp3;").replace(/^no$/,""))),mpeg:!!n,opus:!!e.canPlayType('audio/ogg; codecs="opus"').replace(/^no$/,""),ogg:!!e.canPlayType('audio/ogg; codecs="vorbis"').replace(/^no$/,""),oga:!!e.canPlayType('audio/ogg; codecs="vorbis"').replace(/^no$/,""),wav:!!(e.canPlayType('audio/wav; codecs="1"')||e.canPlayType("audio/wav")).replace(/^no$/,""),aac:!!e.canPlayType("audio/aac;").replace(/^no$/,""),caf:!!e.canPlayType("audio/x-caf;").replace(/^no$/,""),m4a:!!(e.canPlayType("audio/x-m4a;")||e.canPlayType("audio/m4a;")||e.canPlayType("audio/aac;")).replace(/^no$/,""),m4b:!!(e.canPlayType("audio/x-m4b;")||e.canPlayType("audio/m4b;")||e.canPlayType("audio/aac;")).replace(/^no$/,""),mp4:!!(e.canPlayType("audio/x-mp4;")||e.canPlayType("audio/mp4;")||e.canPlayType("audio/aac;")).replace(/^no$/,""),weba:!!(!C&&e.canPlayType('audio/webm; codecs="vorbis"').replace(/^no$/,"")),webm:!!(!C&&e.canPlayType('audio/webm; codecs="vorbis"').replace(/^no$/,"")),dolby:!!e.canPlayType('audio/mp4; codecs="ec-3"').replace(/^no$/,""),flac:!!(e.canPlayType("audio/x-flac;")||e.canPlayType("audio/flac;")).replace(/^no$/,"")},t},_unlockAudio:function(){var t=this||ae;if(!(t._audioUnlocked||!t.ctx)){t._audioUnlocked=!1,t.autoUnlock=!1,!t._mobileUnloaded&&t.ctx.sampleRate!==44100&&(t._mobileUnloaded=!0,t.unload()),t._scratchBuffer=t.ctx.createBuffer(1,1,22050);var e=function(n){for(;t._html5AudioPool.length<t.html5PoolSize;)try{var o=new Audio;o._unlocked=!0,t._releaseHtml5Audio(o)}catch{t.noAudio=!0;break}for(var h=0;h<t._howls.length;h++)if(!t._howls[h]._webAudio)for(var g=t._howls[h]._getSoundIds(),m=0;m<g.length;m++){var v=t._howls[h]._soundById(g[m]);v&&v._node&&!v._node._unlocked&&(v._node._unlocked=!0,v._node.load())}t._autoResume();var C=t.ctx.createBufferSource();C.buffer=t._scratchBuffer,C.connect(t.ctx.destination),typeof C.start>"u"?C.noteOn(0):C.start(0),typeof t.ctx.resume=="function"&&t.ctx.resume(),C.onended=function(){C.disconnect(0),t._audioUnlocked=!0,document.removeEventListener("touchstart",e,!0),document.removeEventListener("touchend",e,!0),document.removeEventListener("click",e,!0),document.removeEventListener("keydown",e,!0);for(var E=0;E<t._howls.length;E++)t._howls[E]._emit("unlock")}};return document.addEventListener("touchstart",e,!0),document.addEventListener("touchend",e,!0),document.addEventListener("click",e,!0),document.addEventListener("keydown",e,!0),t}},_obtainHtml5Audio:function(){var t=this||ae;if(t._html5AudioPool.length)return t._html5AudioPool.pop();var e=new Audio().play();return e&&typeof Promise<"u"&&(e instanceof Promise||typeof e.then=="function")&&e.catch(function(){console.warn("HTML5 Audio pool exhausted, returning potentially locked audio object.")}),new Audio},_releaseHtml5Audio:function(t){var e=this||ae;return t._unlocked&&e._html5AudioPool.push(t),e},_autoSuspend:function(){var t=this;if(!(!t.autoSuspend||!t.ctx||typeof t.ctx.suspend>"u"||!ae.usingWebAudio)){for(var e=0;e<t._howls.length;e++)if(t._howls[e]._webAudio){for(var n=0;n<t._howls[e]._sounds.length;n++)if(!t._howls[e]._sounds[n]._paused)return t}return t._suspendTimer&&clearTimeout(t._suspendTimer),t._suspendTimer=setTimeout(function(){if(t.autoSuspend){t._suspendTimer=null,t.state="suspending";var o=function(){t.state="suspended",t._resumeAfterSuspend&&(delete t._resumeAfterSuspend,t._autoResume())};t.ctx.suspend().then(o,o)}},3e4),t}},_autoResume:function(){var t=this;if(!(!t.ctx||typeof t.ctx.resume>"u"||!ae.usingWebAudio))return t.state==="running"&&t.ctx.state!=="interrupted"&&t._suspendTimer?(clearTimeout(t._suspendTimer),t._suspendTimer=null):t.state==="suspended"||t.state==="running"&&t.ctx.state==="interrupted"?(t.ctx.resume().then(function(){t.state="running";for(var e=0;e<t._howls.length;e++)t._howls[e]._emit("resume")}),t._suspendTimer&&(clearTimeout(t._suspendTimer),t._suspendTimer=null)):t.state==="suspending"&&(t._resumeAfterSuspend=!0),t}};var ae=new Ma,eo=function(t){var e=this;if(!t.src||t.src.length===0){console.error("An array of source files must be passed with any new Howl.");return}e.init(t)};eo.prototype={init:function(t){var e=this;return ae.ctx||qr(),e._autoplay=t.autoplay||!1,e._format=typeof t.format!="string"?t.format:[t.format],e._html5=t.html5||!1,e._muted=t.mute||!1,e._loop=t.loop||!1,e._pool=t.pool||5,e._preload=typeof t.preload=="boolean"||t.preload==="metadata"?t.preload:!0,e._rate=t.rate||1,e._sprite=t.sprite||{},e._src=typeof t.src!="string"?t.src:[t.src],e._volume=t.volume!==void 0?t.volume:1,e._xhr={method:t.xhr&&t.xhr.method?t.xhr.method:"GET",headers:t.xhr&&t.xhr.headers?t.xhr.headers:null,withCredentials:t.xhr&&t.xhr.withCredentials?t.xhr.withCredentials:!1},e._duration=0,e._state="unloaded",e._sounds=[],e._endTimers={},e._queue=[],e._playLock=!1,e._onend=t.onend?[{fn:t.onend}]:[],e._onfade=t.onfade?[{fn:t.onfade}]:[],e._onload=t.onload?[{fn:t.onload}]:[],e._onloaderror=t.onloaderror?[{fn:t.onloaderror}]:[],e._onplayerror=t.onplayerror?[{fn:t.onplayerror}]:[],e._onpause=t.onpause?[{fn:t.onpause}]:[],e._onplay=t.onplay?[{fn:t.onplay}]:[],e._onstop=t.onstop?[{fn:t.onstop}]:[],e._onmute=t.onmute?[{fn:t.onmute}]:[],e._onvolume=t.onvolume?[{fn:t.onvolume}]:[],e._onrate=t.onrate?[{fn:t.onrate}]:[],e._onseek=t.onseek?[{fn:t.onseek}]:[],e._onunlock=t.onunlock?[{fn:t.onunlock}]:[],e._onresume=[],e._webAudio=ae.usingWebAudio&&!e._html5,typeof ae.ctx<"u"&&ae.ctx&&ae.autoUnlock&&ae._unlockAudio(),ae._howls.push(e),e._autoplay&&e._queue.push({event:"play",action:function(){e.play()}}),e._preload&&e._preload!=="none"&&e.load(),e},load:function(){var t=this,e=null;if(ae.noAudio){t._emit("loaderror",null,"No audio support.");return}typeof t._src=="string"&&(t._src=[t._src]);for(var n=0;n<t._src.length;n++){var o,h;if(t._format&&t._format[n])o=t._format[n];else{if(h=t._src[n],typeof h!="string"){t._emit("loaderror",null,"Non-string found in selected audio sources - ignoring.");continue}o=/^data:audio\/([^;,]+);/i.exec(h),o||(o=/\.([^.]+)$/.exec(h.split("?",1)[0])),o&&(o=o[1].toLowerCase())}if(o||console.warn('No file extension was found. Consider using the "format" property or specify an extension.'),o&&ae.codecs(o)){e=t._src[n];break}}if(!e){t._emit("loaderror",null,"No codec support for selected audio sources.");return}return t._src=e,t._state="loading",window.location.protocol==="https:"&&e.slice(0,5)==="http:"&&(t._html5=!0,t._webAudio=!1),new Fs(t),t._webAudio&&ad(t),t},play:function(t,e){var n=this,o=null;if(typeof t=="number")o=t,t=null;else{if(typeof t=="string"&&n._state==="loaded"&&!n._sprite[t])return null;if(typeof t>"u"&&(t="__default",!n._playLock)){for(var h=0,g=0;g<n._sounds.length;g++)n._sounds[g]._paused&&!n._sounds[g]._ended&&(h++,o=n._sounds[g]._id);h===1?t=null:o=null}}var m=o?n._soundById(o):n._inactiveSound();if(!m)return null;if(o&&!t&&(t=m._sprite||"__default"),n._state!=="loaded"){m._sprite=t,m._ended=!1;var v=m._id;return n._queue.push({event:"play",action:function(){n.play(v)}}),v}if(o&&!m._paused)return e||n._loadQueue("play"),m._id;n._webAudio&&ae._autoResume();var C=Math.max(0,m._seek>0?m._seek:n._sprite[t][0]/1e3),E=Math.max(0,(n._sprite[t][0]+n._sprite[t][1])/1e3-C),I=E*1e3/Math.abs(m._rate),R=n._sprite[t][0]/1e3,L=(n._sprite[t][0]+n._sprite[t][1])/1e3;m._sprite=t,m._ended=!1;var N=function(){m._paused=!1,m._seek=C,m._start=R,m._stop=L,m._loop=!!(m._loop||n._sprite[t][2])};if(C>=L){n._ended(m);return}var Y=m._node;if(n._webAudio){var X=function(){n._playLock=!1,N(),n._refreshBuffer(m);var ne=m._muted||n._muted?0:m._volume;Y.gain.setValueAtTime(ne,ae.ctx.currentTime),m._playStart=ae.ctx.currentTime,typeof Y.bufferSource.start>"u"?m._loop?Y.bufferSource.noteGrainOn(0,C,86400):Y.bufferSource.noteGrainOn(0,C,E):m._loop?Y.bufferSource.start(0,C,86400):Y.bufferSource.start(0,C,E),I!==1/0&&(n._endTimers[m._id]=setTimeout(n._ended.bind(n,m),I)),e||setTimeout(function(){n._emit("play",m._id),n._loadQueue()},0)};ae.state==="running"&&ae.ctx.state!=="interrupted"?X():(n._playLock=!0,n.once("resume",X),n._clearTimer(m._id))}else{var K=function(){Y.currentTime=C,Y.muted=m._muted||n._muted||ae._muted||Y.muted,Y.volume=m._volume*ae.volume(),Y.playbackRate=m._rate;try{var ne=Y.play();if(ne&&typeof Promise<"u"&&(ne instanceof Promise||typeof ne.then=="function")?(n._playLock=!0,N(),ne.then(function(){n._playLock=!1,Y._unlocked=!0,e?n._loadQueue():n._emit("play",m._id)}).catch(function(){n._playLock=!1,n._emit("playerror",m._id,"Playback was unable to start. This is most commonly an issue on mobile devices and Chrome where playback was not within a user interaction."),m._ended=!0,m._paused=!0})):e||(n._playLock=!1,N(),n._emit("play",m._id)),Y.playbackRate=m._rate,Y.paused){n._emit("playerror",m._id,"Playback was unable to start. This is most commonly an issue on mobile devices and Chrome where playback was not within a user interaction.");return}t!=="__default"||m._loop?n._endTimers[m._id]=setTimeout(n._ended.bind(n,m),I):(n._endTimers[m._id]=function(){n._ended(m),Y.removeEventListener("ended",n._endTimers[m._id],!1)},Y.addEventListener("ended",n._endTimers[m._id],!1))}catch(pe){n._emit("playerror",m._id,pe)}};Y.src==="data:audio/wav;base64,UklGRigAAABXQVZFZm10IBIAAAABAAEARKwAAIhYAQACABAAAABkYXRhAgAAAAEA"&&(Y.src=n._src,Y.load());var J=window&&window.ejecta||!Y.readyState&&ae._navigator.isCocoonJS;if(Y.readyState>=3||J)K();else{n._playLock=!0,n._state="loading";var te=function(){n._state="loaded",K(),Y.removeEventListener(ae._canPlayEvent,te,!1)};Y.addEventListener(ae._canPlayEvent,te,!1),n._clearTimer(m._id)}}return m._id},pause:function(t){var e=this;if(e._state!=="loaded"||e._playLock)return e._queue.push({event:"pause",action:function(){e.pause(t)}}),e;for(var n=e._getSoundIds(t),o=0;o<n.length;o++){e._clearTimer(n[o]);var h=e._soundById(n[o]);if(h&&!h._paused&&(h._seek=e.seek(n[o]),h._rateSeek=0,h._paused=!0,e._stopFade(n[o]),h._node))if(e._webAudio){if(!h._node.bufferSource)continue;typeof h._node.bufferSource.stop>"u"?h._node.bufferSource.noteOff(0):h._node.bufferSource.stop(0),e._cleanBuffer(h._node)}else(!isNaN(h._node.duration)||h._node.duration===1/0)&&h._node.pause();arguments[1]||e._emit("pause",h?h._id:null)}return e},stop:function(t,e){var n=this;if(n._state!=="loaded"||n._playLock)return n._queue.push({event:"stop",action:function(){n.stop(t)}}),n;for(var o=n._getSoundIds(t),h=0;h<o.length;h++){n._clearTimer(o[h]);var g=n._soundById(o[h]);g&&(g._seek=g._start||0,g._rateSeek=0,g._paused=!0,g._ended=!0,n._stopFade(o[h]),g._node&&(n._webAudio?g._node.bufferSource&&(typeof g._node.bufferSource.stop>"u"?g._node.bufferSource.noteOff(0):g._node.bufferSource.stop(0),n._cleanBuffer(g._node)):(!isNaN(g._node.duration)||g._node.duration===1/0)&&(g._node.currentTime=g._start||0,g._node.pause(),g._node.duration===1/0&&n._clearSound(g._node))),e||n._emit("stop",g._id))}return n},mute:function(t,e){var n=this;if(n._state!=="loaded"||n._playLock)return n._queue.push({event:"mute",action:function(){n.mute(t,e)}}),n;if(typeof e>"u")if(typeof t=="boolean")n._muted=t;else return n._muted;for(var o=n._getSoundIds(e),h=0;h<o.length;h++){var g=n._soundById(o[h]);g&&(g._muted=t,g._interval&&n._stopFade(g._id),n._webAudio&&g._node?g._node.gain.setValueAtTime(t?0:g._volume,ae.ctx.currentTime):g._node&&(g._node.muted=ae._muted?!0:t),n._emit("mute",g._id))}return n},volume:function(){var t=this,e=arguments,n,o;if(e.length===0)return t._volume;if(e.length===1||e.length===2&&typeof e[1]>"u"){var h=t._getSoundIds(),g=h.indexOf(e[0]);g>=0?o=parseInt(e[0],10):n=parseFloat(e[0])}else e.length>=2&&(n=parseFloat(e[0]),o=parseInt(e[1],10));var m;if(typeof n<"u"&&n>=0&&n<=1){if(t._state!=="loaded"||t._playLock)return t._queue.push({event:"volume",action:function(){t.volume.apply(t,e)}}),t;typeof o>"u"&&(t._volume=n),o=t._getSoundIds(o);for(var v=0;v<o.length;v++)m=t._soundById(o[v]),m&&(m._volume=n,e[2]||t._stopFade(o[v]),t._webAudio&&m._node&&!m._muted?m._node.gain.setValueAtTime(n,ae.ctx.currentTime):m._node&&!m._muted&&(m._node.volume=n*ae.volume()),t._emit("volume",m._id))}else return m=o?t._soundById(o):t._sounds[0],m?m._volume:0;return t},fade:function(t,e,n,o){var h=this;if(h._state!=="loaded"||h._playLock)return h._queue.push({event:"fade",action:function(){h.fade(t,e,n,o)}}),h;t=Math.min(Math.max(0,parseFloat(t)),1),e=Math.min(Math.max(0,parseFloat(e)),1),n=parseFloat(n),h.volume(t,o);for(var g=h._getSoundIds(o),m=0;m<g.length;m++){var v=h._soundById(g[m]);if(v){if(o||h._stopFade(g[m]),h._webAudio&&!v._muted){var C=ae.ctx.currentTime,E=C+n/1e3;v._volume=t,v._node.gain.setValueAtTime(t,C),v._node.gain.linearRampToValueAtTime(e,E)}h._startFadeInterval(v,t,e,n,g[m],typeof o>"u")}}return h},_startFadeInterval:function(t,e,n,o,h,g){var m=this,v=e,C=n-e,E=Math.abs(C/.01),I=Math.max(4,E>0?o/E:o),R=Date.now();t._fadeTo=n,t._interval=setInterval(function(){var L=(Date.now()-R)/o;R=Date.now(),v+=C*L,v=Math.round(v*100)/100,C<0?v=Math.max(n,v):v=Math.min(n,v),m._webAudio?t._volume=v:m.volume(v,t._id,!0),g&&(m._volume=v),(n<e&&v<=n||n>e&&v>=n)&&(clearInterval(t._interval),t._interval=null,t._fadeTo=null,m.volume(n,t._id),m._emit("fade",t._id))},I)},_stopFade:function(t){var e=this,n=e._soundById(t);return n&&n._interval&&(e._webAudio&&n._node.gain.cancelScheduledValues(ae.ctx.currentTime),clearInterval(n._interval),n._interval=null,e.volume(n._fadeTo,t),n._fadeTo=null,e._emit("fade",t)),e},loop:function(){var t=this,e=arguments,n,o,h;if(e.length===0)return t._loop;if(e.length===1)if(typeof e[0]=="boolean")n=e[0],t._loop=n;else return h=t._soundById(parseInt(e[0],10)),h?h._loop:!1;else e.length===2&&(n=e[0],o=parseInt(e[1],10));for(var g=t._getSoundIds(o),m=0;m<g.length;m++)h=t._soundById(g[m]),h&&(h._loop=n,t._webAudio&&h._node&&h._node.bufferSource&&(h._node.bufferSource.loop=n,n&&(h._node.bufferSource.loopStart=h._start||0,h._node.bufferSource.loopEnd=h._stop,t.playing(g[m])&&(t.pause(g[m],!0),t.play(g[m],!0)))));return t},rate:function(){var t=this,e=arguments,n,o;if(e.length===0)o=t._sounds[0]._id;else if(e.length===1){var h=t._getSoundIds(),g=h.indexOf(e[0]);g>=0?o=parseInt(e[0],10):n=parseFloat(e[0])}else e.length===2&&(n=parseFloat(e[0]),o=parseInt(e[1],10));var m;if(typeof n=="number"){if(t._state!=="loaded"||t._playLock)return t._queue.push({event:"rate",action:function(){t.rate.apply(t,e)}}),t;typeof o>"u"&&(t._rate=n),o=t._getSoundIds(o);for(var v=0;v<o.length;v++)if(m=t._soundById(o[v]),m){t.playing(o[v])&&(m._rateSeek=t.seek(o[v]),m._playStart=t._webAudio?ae.ctx.currentTime:m._playStart),m._rate=n,t._webAudio&&m._node&&m._node.bufferSource?m._node.bufferSource.playbackRate.setValueAtTime(n,ae.ctx.currentTime):m._node&&(m._node.playbackRate=n);var C=t.seek(o[v]),E=(t._sprite[m._sprite][0]+t._sprite[m._sprite][1])/1e3-C,I=E*1e3/Math.abs(m._rate);(t._endTimers[o[v]]||!m._paused)&&(t._clearTimer(o[v]),t._endTimers[o[v]]=setTimeout(t._ended.bind(t,m),I)),t._emit("rate",m._id)}}else return m=t._soundById(o),m?m._rate:t._rate;return t},seek:function(){var t=this,e=arguments,n,o;if(e.length===0)t._sounds.length&&(o=t._sounds[0]._id);else if(e.length===1){var h=t._getSoundIds(),g=h.indexOf(e[0]);g>=0?o=parseInt(e[0],10):t._sounds.length&&(o=t._sounds[0]._id,n=parseFloat(e[0]))}else e.length===2&&(n=parseFloat(e[0]),o=parseInt(e[1],10));if(typeof o>"u")return 0;if(typeof n=="number"&&(t._state!=="loaded"||t._playLock))return t._queue.push({event:"seek",action:function(){t.seek.apply(t,e)}}),t;var m=t._soundById(o);if(m)if(typeof n=="number"&&n>=0){var v=t.playing(o);v&&t.pause(o,!0),m._seek=n,m._ended=!1,t._clearTimer(o),!t._webAudio&&m._node&&!isNaN(m._node.duration)&&(m._node.currentTime=n);var C=function(){v&&t.play(o,!0),t._emit("seek",o)};if(v&&!t._webAudio){var E=function(){t._playLock?setTimeout(E,0):C()};setTimeout(E,0)}else C()}else if(t._webAudio){var I=t.playing(o)?ae.ctx.currentTime-m._playStart:0,R=m._rateSeek?m._rateSeek-m._seek:0;return m._seek+(R+I*Math.abs(m._rate))}else return m._node.currentTime;return t},playing:function(t){var e=this;if(typeof t=="number"){var n=e._soundById(t);return n?!n._paused:!1}for(var o=0;o<e._sounds.length;o++)if(!e._sounds[o]._paused)return!0;return!1},duration:function(t){var e=this,n=e._duration,o=e._soundById(t);return o&&(n=e._sprite[o._sprite][1]/1e3),n},state:function(){return this._state},unload:function(){for(var t=this,e=t._sounds,n=0;n<e.length;n++)e[n]._paused||t.stop(e[n]._id),t._webAudio||(t._clearSound(e[n]._node),e[n]._node.removeEventListener("error",e[n]._errorFn,!1),e[n]._node.removeEventListener(ae._canPlayEvent,e[n]._loadFn,!1),e[n]._node.removeEventListener("ended",e[n]._endFn,!1),ae._releaseHtml5Audio(e[n]._node)),delete e[n]._node,t._clearTimer(e[n]._id);var o=ae._howls.indexOf(t);o>=0&&ae._howls.splice(o,1);var h=!0;for(n=0;n<ae._howls.length;n++)if(ae._howls[n]._src===t._src||t._src.indexOf(ae._howls[n]._src)>=0){h=!1;break}return rn&&h&&delete rn[t._src],ae.noAudio=!1,t._state="unloaded",t._sounds=[],t=null,null},on:function(t,e,n,o){var h=this,g=h["_on"+t];return typeof e=="function"&&g.push(o?{id:n,fn:e,once:o}:{id:n,fn:e}),h},off:function(t,e,n){var o=this,h=o["_on"+t],g=0;if(typeof e=="number"&&(n=e,e=null),e||n)for(g=0;g<h.length;g++){var m=n===h[g].id;if(e===h[g].fn&&m||!e&&m){h.splice(g,1);break}}else if(t)o["_on"+t]=[];else{var v=Object.keys(o);for(g=0;g<v.length;g++)v[g].indexOf("_on")===0&&Array.isArray(o[v[g]])&&(o[v[g]]=[])}return o},once:function(t,e,n){var o=this;return o.on(t,e,n,1),o},_emit:function(t,e,n){for(var o=this,h=o["_on"+t],g=h.length-1;g>=0;g--)(!h[g].id||h[g].id===e||t==="load")&&(setTimeout((function(m){m.call(this,e,n)}).bind(o,h[g].fn),0),h[g].once&&o.off(t,h[g].fn,h[g].id));return o._loadQueue(t),o},_loadQueue:function(t){var e=this;if(e._queue.length>0){var n=e._queue[0];n.event===t&&(e._queue.shift(),e._loadQueue()),t||n.action()}return e},_ended:function(t){var e=this,n=t._sprite;if(!e._webAudio&&t._node&&!t._node.paused&&!t._node.ended&&t._node.currentTime<t._stop)return setTimeout(e._ended.bind(e,t),100),e;var o=!!(t._loop||e._sprite[n][2]);if(e._emit("end",t._id),!e._webAudio&&o&&e.stop(t._id,!0).play(t._id),e._webAudio&&o){e._emit("play",t._id),t._seek=t._start||0,t._rateSeek=0,t._playStart=ae.ctx.currentTime;var h=(t._stop-t._start)*1e3/Math.abs(t._rate);e._endTimers[t._id]=setTimeout(e._ended.bind(e,t),h)}return e._webAudio&&!o&&(t._paused=!0,t._ended=!0,t._seek=t._start||0,t._rateSeek=0,e._clearTimer(t._id),e._cleanBuffer(t._node),ae._autoSuspend()),!e._webAudio&&!o&&e.stop(t._id,!0),e},_clearTimer:function(t){var e=this;if(e._endTimers[t]){if(typeof e._endTimers[t]!="function")clearTimeout(e._endTimers[t]);else{var n=e._soundById(t);n&&n._node&&n._node.removeEventListener("ended",e._endTimers[t],!1)}delete e._endTimers[t]}return e},_soundById:function(t){for(var e=this,n=0;n<e._sounds.length;n++)if(t===e._sounds[n]._id)return e._sounds[n];return null},_inactiveSound:function(){var t=this;t._drain();for(var e=0;e<t._sounds.length;e++)if(t._sounds[e]._ended)return t._sounds[e].reset();return new Fs(t)},_drain:function(){var t=this,e=t._pool,n=0,o=0;if(!(t._sounds.length<e)){for(o=0;o<t._sounds.length;o++)t._sounds[o]._ended&&n++;for(o=t._sounds.length-1;o>=0;o--){if(n<=e)return;t._sounds[o]._ended&&(t._webAudio&&t._sounds[o]._node&&t._sounds[o]._node.disconnect(0),t._sounds.splice(o,1),n--)}}},_getSoundIds:function(t){var e=this;if(typeof t>"u"){for(var n=[],o=0;o<e._sounds.length;o++)n.push(e._sounds[o]._id);return n}else return[t]},_refreshBuffer:function(t){var e=this;return t._node.bufferSource=ae.ctx.createBufferSource(),t._node.bufferSource.buffer=rn[e._src],t._panner?t._node.bufferSource.connect(t._panner):t._node.bufferSource.connect(t._node),t._node.bufferSource.loop=t._loop,t._loop&&(t._node.bufferSource.loopStart=t._start||0,t._node.bufferSource.loopEnd=t._stop||0),t._node.bufferSource.playbackRate.setValueAtTime(t._rate,ae.ctx.currentTime),e},_cleanBuffer:function(t){var e=this,n=ae._navigator&&ae._navigator.vendor.indexOf("Apple")>=0;if(!t.bufferSource)return e;if(ae._scratchBuffer&&t.bufferSource&&(t.bufferSource.onended=null,t.bufferSource.disconnect(0),n))try{t.bufferSource.buffer=ae._scratchBuffer}catch{}return t.bufferSource=null,e},_clearSound:function(t){var e=/MSIE |Trident\//.test(ae._navigator&&ae._navigator.userAgent);e||(t.src="data:audio/wav;base64,UklGRigAAABXQVZFZm10IBIAAAABAAEARKwAAIhYAQACABAAAABkYXRhAgAAAAEA")}};var Fs=function(t){this._parent=t,this.init()};Fs.prototype={init:function(){var t=this,e=t._parent;return t._muted=e._muted,t._loop=e._loop,t._volume=e._volume,t._rate=e._rate,t._seek=0,t._paused=!0,t._ended=!0,t._sprite="__default",t._id=++ae._counter,e._sounds.push(t),t.create(),t},create:function(){var t=this,e=t._parent,n=ae._muted||t._muted||t._parent._muted?0:t._volume;return e._webAudio?(t._node=typeof ae.ctx.createGain>"u"?ae.ctx.createGainNode():ae.ctx.createGain(),t._node.gain.setValueAtTime(n,ae.ctx.currentTime),t._node.paused=!0,t._node.connect(ae.masterGain)):ae.noAudio||(t._node=ae._obtainHtml5Audio(),t._errorFn=t._errorListener.bind(t),t._node.addEventListener("error",t._errorFn,!1),t._loadFn=t._loadListener.bind(t),t._node.addEventListener(ae._canPlayEvent,t._loadFn,!1),t._endFn=t._endListener.bind(t),t._node.addEventListener("ended",t._endFn,!1),t._node.src=e._src,t._node.preload=e._preload===!0?"auto":e._preload,t._node.volume=n*ae.volume(),t._node.load()),t},reset:function(){var t=this,e=t._parent;return t._muted=e._muted,t._loop=e._loop,t._volume=e._volume,t._rate=e._rate,t._seek=0,t._rateSeek=0,t._paused=!0,t._ended=!0,t._sprite="__default",t._id=++ae._counter,t},_errorListener:function(){var t=this;t._parent._emit("loaderror",t._id,t._node.error?t._node.error.code:0),t._node.removeEventListener("error",t._errorFn,!1)},_loadListener:function(){var t=this,e=t._parent;e._duration=Math.ceil(t._node.duration*10)/10,Object.keys(e._sprite).length===0&&(e._sprite={__default:[0,e._duration*1e3]}),e._state!=="loaded"&&(e._state="loaded",e._emit("load"),e._loadQueue()),t._node.removeEventListener(ae._canPlayEvent,t._loadFn,!1)},_endListener:function(){var t=this,e=t._parent;e._duration===1/0&&(e._duration=Math.ceil(t._node.duration*10)/10,e._sprite.__default[1]===1/0&&(e._sprite.__default[1]=e._duration*1e3),e._ended(t)),t._node.removeEventListener("ended",t._endFn,!1)}};var rn={},ad=function(t){var e=t._src;if(rn[e]){t._duration=rn[e].duration,rh(t);return}if(/^data:[^;]+;base64,/.test(e)){for(var n=atob(e.split(",")[1]),o=new Uint8Array(n.length),h=0;h<n.length;++h)o[h]=n.charCodeAt(h);Pl(o.buffer,t)}else{var g=new XMLHttpRequest;g.open(t._xhr.method,e,!0),g.withCredentials=t._xhr.withCredentials,g.responseType="arraybuffer",t._xhr.headers&&Object.keys(t._xhr.headers).forEach(function(m){g.setRequestHeader(m,t._xhr.headers[m])}),g.onload=function(){var m=(g.status+"")[0];if(m!=="0"&&m!=="2"&&m!=="3"){t._emit("loaderror",null,"Failed loading audio file with status: "+g.status+".");return}Pl(g.response,t)},g.onerror=function(){t._webAudio&&(t._html5=!0,t._webAudio=!1,t._sounds=[],delete rn[e],t.load())},ld(g)}},ld=function(t){try{t.send()}catch{t.onerror()}},Pl=function(t,e){var n=function(){e._emit("loaderror",null,"Decoding audio data failed.")},o=function(h){h&&e._sounds.length>0?(rn[e._src]=h,rh(e,h)):n()};typeof Promise<"u"&&ae.ctx.decodeAudioData.length===1?ae.ctx.decodeAudioData(t).then(o).catch(n):ae.ctx.decodeAudioData(t,o,n)},rh=function(t,e){e&&!t._duration&&(t._duration=e.duration),Object.keys(t._sprite).length===0&&(t._sprite={__default:[0,t._duration*1e3]}),t._state!=="loaded"&&(t._state="loaded",t._emit("load"),t._loadQueue())},qr=function(){if(ae.usingWebAudio){try{typeof AudioContext<"u"?ae.ctx=new AudioContext:typeof webkitAudioContext<"u"?ae.ctx=new webkitAudioContext:ae.usingWebAudio=!1}catch{ae.usingWebAudio=!1}ae.ctx||(ae.usingWebAudio=!1);var t=/iP(hone|od|ad)/.test(ae._navigator&&ae._navigator.platform),e=ae._navigator&&ae._navigator.appVersion.match(/OS (\d+)_(\d+)_?(\d+)?/),n=e?parseInt(e[1],10):null;if(t&&n&&n<9){var o=/safari/.test(ae._navigator&&ae._navigator.userAgent.toLowerCase());ae._navigator&&!o&&(ae.usingWebAudio=!1)}ae.usingWebAudio&&(ae.masterGain=typeof ae.ctx.createGain>"u"?ae.ctx.createGainNode():ae.ctx.createGain(),ae.masterGain.gain.setValueAtTime(ae._muted?0:ae._volume,ae.ctx.currentTime),ae.masterGain.connect(ae.ctx.destination)),ae._setup()}};od(Ma,ae,eo,Fs);/*!
 * Dynamsoft JavaScript Library
 * @product Dynamsoft Camera Enhancer JS Edition
 * @website https://www.dynamsoft.com
 * @copyright Copyright 2024, Dynamsoft Corporation
 * @author Dynamsoft
 * @version 4.0.1
 * @fileoverview Dynamsoft JavaScript Library for Camera Enhancer
 * More info on DCE JS: https://www.dynamsoft.com/camera-enhancer/docs/programming/javascript/?ver=latest
 */const Wo=typeof self>"u",cd=(()=>{if(!Wo&&document.currentScript){let t=document.currentScript.src,e=t.indexOf("?");if(e!=-1)t=t.substring(0,e);else{let n=t.indexOf("#");n!=-1&&(t=t.substring(0,n))}return t.substring(0,t.lastIndexOf("/")+1)}return"./"})();We.dce==null&&(We.dce=cd),Un.dce={wasm:!1,js:!1},bt.dce={};function S(t,e,n,o){if(n==="a"&&!o)throw new TypeError("Private accessor was defined without a getter");if(typeof e=="function"?t!==e||!o:!e.has(t))throw new TypeError("Cannot read private member from an object whose class did not declare it");return n==="m"?o:n==="a"?o.call(t):o?o.value:e.get(t)}function Ee(t,e,n,o,h){if(o==="m")throw new TypeError("Private method is not writable");if(o==="a"&&!h)throw new TypeError("Private accessor was defined without a setter");if(typeof e=="function"?t!==e||!h:!e.has(t))throw new TypeError("Cannot write private member to an object whose class did not declare it");return o==="a"?h.call(t,n):h?h.value=n:e.set(t,n),n}let Kn,di,Gr,Ms,gt;typeof SuppressedError=="function"&&SuppressedError,typeof navigator<"u"&&(Kn=navigator,di=Kn.userAgent,Gr=Kn.platform,Ms=Kn.mediaDevices),function(){if(!Wo){const t={Edge:{search:"Edg",verSearch:"Edg"},OPR:null,Chrome:null,Safari:{str:Kn.vendor,search:"Apple",verSearch:["Version","iPhone OS","CPU OS"]},Firefox:null,Explorer:{search:"MSIE",verSearch:"MSIE"}},e={HarmonyOS:null,Android:null,iPhone:null,iPad:null,Windows:{str:Gr,search:"Win"},Mac:{str:Gr},Linux:{str:Gr}};let n="unknownBrowser",o=0,h="unknownOS";for(let g in t){const m=t[g]||{};let v=m.str||di,C=m.search||g,E=m.verStr||di,I=m.verSearch||g;if(I instanceof Array||(I=[I]),v.indexOf(C)!=-1){n=g;for(let R of I){let L=E.indexOf(R);if(L!=-1){o=parseFloat(E.substring(L+R.length+1));break}}break}}for(let g in e){const m=e[g]||{};let v=m.str||di,C=m.search||g;if(v.indexOf(C)!=-1){h=g;break}}h=="Linux"&&di.indexOf("Windows NT")!=-1&&(h="HarmonyOS"),gt={browser:n,version:o,OS:h}}Wo&&(gt={browser:"ssr",version:0,OS:"ssr"})}();const hd=typeof WebAssembly<"u"&&di&&!(/Safari/.test(di)&&!/Chrome/.test(di)&&/\(.+\s11_2_([2-6]).*\)/.test(di)),ud=!(typeof Worker>"u"),sh=!(!Ms||!Ms.getUserMedia),fd=async()=>{let t=!1;if(sh)try{(await Ms.getUserMedia({video:!0})).getTracks().forEach(e=>{e.stop()}),t=!0}catch{}return t};var ct,Ft,Oi,kl;gt.browser==="Chrome"&&gt.version>66||gt.browser==="Safari"&&gt.version>13||gt.browser==="OPR"&&gt.version>43||gt.browser==="Edge"&&gt.version,function(t){t[t.DIMT_RECTANGLE=1]="DIMT_RECTANGLE",t[t.DIMT_QUADRILATERAL=2]="DIMT_QUADRILATERAL",t[t.DIMT_TEXT=4]="DIMT_TEXT",t[t.DIMT_ARC=8]="DIMT_ARC",t[t.DIMT_IMAGE=16]="DIMT_IMAGE",t[t.DIMT_POLYGON=32]="DIMT_POLYGON",t[t.DIMT_LINE=64]="DIMT_LINE",t[t.DIMT_GROUP=128]="DIMT_GROUP"}(ct||(ct={})),function(t){t[t.DIS_DEFAULT=1]="DIS_DEFAULT",t[t.DIS_SELECTED=2]="DIS_SELECTED"}(Ft||(Ft={})),function(t){t[t.EF_ENHANCED_FOCUS=4]="EF_ENHANCED_FOCUS",t[t.EF_AUTO_ZOOM=16]="EF_AUTO_ZOOM",t[t.EF_TAP_TO_FOCUS=64]="EF_TAP_TO_FOCUS"}(Oi||(Oi={})),function(t){t.GREY="grey",t.GREY32="grey32",t.RGBA="rgba",t.RBGA="rbga",t.GRBA="grba",t.GBRA="gbra",t.BRGA="brga",t.BGRA="bgra"}(kl||(kl={}));const kn=t=>typeof t=="number"&&!Number.isNaN(t),Yo=t=>typeof t=="string";var Jr,nr,pn,Ho,$t,Ps;(function(t){t.ARC="arc",t.IMAGE="image",t.LINE="line",t.POLYGON="polygon",t.QUAD="quad",t.RECT="rect",t.TEXT="text",t.GROUP="group"})($t||($t={})),function(t){t.DEFAULT="default",t.SELECTED="selected"}(Ps||(Ps={}));class Tt{get mediaType(){return new Map([["rect",ct.DIMT_RECTANGLE],["quad",ct.DIMT_QUADRILATERAL],["text",ct.DIMT_TEXT],["arc",ct.DIMT_ARC],["image",ct.DIMT_IMAGE],["polygon",ct.DIMT_POLYGON],["line",ct.DIMT_LINE],["group",ct.DIMT_GROUP]]).get(this._mediaType)}get styleSelector(){switch(S(this,nr,"f")){case Ft.DIS_DEFAULT:return"default";case Ft.DIS_SELECTED:return"selected"}}set drawingStyleId(e){this.styleId=e}get drawingStyleId(){return this.styleId}set coordinateBase(e){if(!["view","image"].includes(e))throw new Error("Invalid 'coordinateBase'.");this._drawingLayer&&(S(this,pn,"f")==="image"&&e==="view"?this.updateCoordinateBaseFromImageToView():S(this,pn,"f")==="view"&&e==="image"&&this.updateCoordinateBaseFromViewToImage()),Ee(this,pn,e,"f")}get coordinateBase(){return S(this,pn,"f")}get drawingLayerId(){return this._drawingLayerId}constructor(e,n){if(Jr.add(this),nr.set(this,void 0),pn.set(this,"image"),this._zIndex=null,this._drawingLayer=null,this._drawingLayerId=null,this._mapStyle=new Map,this._mapState_StyleId=new Map,this.mapEvent_Callbacks=new Map([["selected",new Map],["deselected",new Map],["mousedown",new Map],["mouseup",new Map],["dblclick",new Map],["mouseover",new Map],["mouseout",new Map]]),this.mapNoteName_Content=new Map([]),this.isDrawingItem=!0,n!=null&&!kn(n))throw new TypeError("Invalid 'drawingStyleId'.");e&&this._setFabricObject(e),this.setState(Ft.DIS_DEFAULT),this.styleId=n}_setFabricObject(e){this._fabricObject=e,this._fabricObject.on("selected",()=>{this.setState(Ft.DIS_SELECTED)}),this._fabricObject.on("deselected",()=>{this._fabricObject.canvas&&this._fabricObject.canvas.getActiveObjects().includes(this._fabricObject)?this.setState(Ft.DIS_SELECTED):this.setState(Ft.DIS_DEFAULT),this._fabricObject.type==="textbox"&&(this._fabricObject.isEditing&&this._fabricObject.exitEditing(),this._fabricObject.selected=!1)}),e.getDrawingItem=()=>this}_getFabricObject(){return this._fabricObject}setState(e){Ee(this,nr,e,"f")}getState(){return S(this,nr,"f")}_on(e,n){if(!n)return;const o=e.toLowerCase(),h=this.mapEvent_Callbacks.get(o);if(!h)throw new Error(`Event '${e}' does not exist.`);let g=h.get(n);g||(g=m=>{const v=m.e;if(!v)return void(n&&n.apply(this,[{targetItem:this,itemClientX:null,itemClientY:null,itemPageX:null,itemPageY:null}]));const C={targetItem:this,itemClientX:null,itemClientY:null,itemPageX:null,itemPageY:null};if(this._drawingLayer){let E,I,R,L;const N=v.target.getBoundingClientRect();E=N.left,I=N.top,R=E+window.scrollX,L=I+window.scrollY;const{width:Y,height:X}=this._drawingLayer.fabricCanvas.lowerCanvasEl.getBoundingClientRect(),K=this._drawingLayer.width,J=this._drawingLayer.height,te=Y/X,ne=K/J,pe=this._drawingLayer._getObjectFit();let he,le,be,y,_e=1;if(pe==="contain")te<ne?(_e=Y/K,he=E+this.get("x")*_e,le=I+this.get("y")*_e+(X-J*_e)/2,be=R+this.get("x")*_e,y=L+this.get("y")*_e+(X-J*_e)/2):(_e=X/J,he=E+this.get("x")*_e+(Y-K*_e)/2,le=I+this.get("y")*_e,be=R+this.get("x")*_e+(Y-K*_e)/2,y=L+this.get("y")*_e);else if(pe==="cover")if(te<ne){_e=X/J;let Ce=this.get("x")*_e-(K*_e-Y)/2;Ce=Math.max(Ce,0),Ce=Math.min(Ce,Y),he=E+Ce,le=I+this.get("y")*_e,be=R+Ce,y=L+this.get("y")*_e}else{_e=Y/K;let Ce=this.get("y")*_e-(J*_e-X)/2;Ce=Math.max(Ce,0),Ce=Math.min(Ce,X),he=E+this.get("x")*_e,le=I+Ce,be=R+this.get("x")*_e,y=L+Ce}C.itemClientX=Math.round(he),C.itemClientY=Math.round(le),C.itemPageX=Math.round(be),C.itemPageY=Math.round(y)}for(let E of Object.getOwnPropertyNames(C))Object.defineProperty(v,E,{value:C[E],writable:!0});n&&n.apply(this,[v])},h.set(n,g),this._fabricObject.on(o==="dblclick"?"mousedblclick":o,g))}on(e,n){this._on(e,n)}_off(e,n){const o=e.toLowerCase(),h=this.mapEvent_Callbacks.get(o);if(!h)throw new Error(`Event '${e}' does not exist.`);let g=h.get(n);g&&(h.delete(n),this._fabricObject.off(o==="dblclick"?"mousedblclick":o,g))}off(e,n){this._off(e,n)}_setEditable(e){const n=this._fabricObject;e?(n.selectable=!0,n.hasControls=!0,n.hoverCursor=null):(n.selectable=!1,n.hasControls=!1,n.hoverCursor="default")}hasNote(e){return this.mapNoteName_Content.has(e)}addNote(e,n){if(this.hasNote(e.name)&&!n)throw new Error("A note with the same name already exists, please use a different name.");const o=e.content?JSON.parse(JSON.stringify(e.content)):e.content;this.mapNoteName_Content.set(e.name,[o])}getNote(e){const n=this.mapNoteName_Content.get(e);return n?n.length===1?{name:e,content:n[0]?JSON.parse(JSON.stringify(n[0])):n[0]}:{name:e,content:JSON.parse(JSON.stringify(n))}:null}getNotes(){const e=[];for(let n of this.mapNoteName_Content){let o=n[1].length===1?n[1][0]:n[1];o=o&&JSON.parse(JSON.stringify(o)),e.push({name:n[0],content:o})}return e}updateNote(e,n,o){const h=this.mapNoteName_Content.get(e);if(!h)throw new Error("The note name does not exist.");o||(h.length=0),n=n&&JSON.parse(JSON.stringify(n)),h.push(n)}deleteNote(e){this.mapNoteName_Content.delete(e)}clearNotes(){this.mapNoteName_Content.clear()}set(e,n){if(!this.extendSet(e,n))if(e==="x"){const o=this._fabricObject.group;o?(this._fabricObject.set("left",n-o.left-o.width/2),o.addWithUpdate()):this._fabricObject.set("left",n)}else if(e==="y"){const o=this._fabricObject.group;o?(this._fabricObject.set("top",n-o.top-o.height/2),o.addWithUpdate()):this._fabricObject.set("top",n)}else e==="styleId"?this.styleId=n:this._fabricObject.set(e,n);["vertices","startPoint","endPoint","x","y","left","top","width","height","scaleX","scaleY","skewX","skewY","padding","angle","strokeWidth"].includes(e)&&this._fabricObject.setCoords()}get(e){let n=this.extendGet(e);if(n===void 0)if(e==="x"){const o=this._fabricObject.group;n=o?this._fabricObject.get("left")+o.left+o.width/2:this._fabricObject.get("left")}else if(e==="y"){const o=this._fabricObject.group;n=o?this._fabricObject.get("top")+o.top+o.height/2:this._fabricObject.get("top")}else n=e==="scaledWidth"?this._fabricObject.getScaledWidth():e==="scaledHeight"?this._fabricObject.getScaledHeight():["type","mediaType"].includes(e)?this.mediaType:e==="state"?this.getState():e==="styleId"?this.styleId:e==="drawingLayerId"?this.drawingLayerId:this._fabricObject.get(e);return n}remove(){this._drawingLayer&&this._drawingLayer.removeDrawingItem(this)}convertPropFromImageToView(e){if(typeof e!="number")throw new TypeError("Invalid value.");return e*S(this,Jr,"m",Ho).call(this)}convertPropFromViewToImage(e){if(typeof e!="number")throw new TypeError("Invalid value.");return e/S(this,Jr,"m",Ho).call(this)}_setLineWidth(e){if(this._drawingLayer)if(this.coordinateBase==="view")this.set("strokeWidth",this.convertPropFromViewToImage(e));else{if(this.coordinateBase!=="image")throw new Error("Invalid 'coordinateBase'.");this.set("strokeWidth",e)}}_getLineWidth(){if(this._drawingLayer){if(this.coordinateBase==="view")return this.convertPropFromImageToView(this.get("strokeWidth"));if(this.coordinateBase==="image")return this.get("strokeWidth");throw new Error("Invalid 'coordinateBase'.")}}_setFontSize(e){if(this._drawingLayer)if(this.coordinateBase==="view")this.set("fontSize",this.convertPropFromViewToImage(e));else{if(this.coordinateBase!=="image")throw new Error("Invalid 'coordinateBase'.");this.set("fontSize",e)}}_getFontSize(){if(this._drawingLayer){if(this.coordinateBase==="view")return this.convertPropFromImageToView(this.get("fontSize"));if(this.coordinateBase==="image")return this.get("fontSize");throw new Error("Invalid 'coordinateBase'.")}}}nr=new WeakMap,pn=new WeakMap,Jr=new WeakSet,Ho=function(){const t=this._drawingLayer;if(!t)return 1;const e=t.width,n=t.height,{width:o,height:h}=t.fabricCanvas.wrapperEl.getBoundingClientRect();if(o<=0||h<=0)throw new Error("Unable to get drawing layer dimensions. Layer may not be rendered on the page.");const g=o/e,m=h/n,v=t._getObjectFit();let C=1;return v==="contain"?g<m?C=o/e:C=h/n:v==="cover"&&(g<m?C=h/n:C=o/e),C},Tt.arrMediaTypes=["rect","arc","polygon","image","text","line","quad"],Tt.mapItemType=new Map([[$t.ARC,"arc"],[$t.IMAGE,"image"],[$t.LINE,"line"],[$t.POLYGON,"polygon"],[$t.QUAD,"quad"],[$t.RECT,"rect"],[$t.TEXT,"text"],[$t.GROUP,"group"]]),Tt.arrStyleSelectors=["default","selected"],Tt.mapItemState=new Map([[Ps.DEFAULT,"default"],[Ps.SELECTED,"selected"]]);const oh=t=>t!==null&&typeof t=="object"&&!Array.isArray(t),mo=t=>!!Yo(t)&&t!=="",Pa=zf,Bl=Kf,dd=Da,Nl=Zf,on=qf,jl=t=>!!oh(t)&&!("id"in t&&!kn(t.id))&&!("lineWidth"in t&&!kn(t.lineWidth))&&!("fillStyle"in t&&!mo(t.fillStyle))&&!("strokeStyle"in t&&!mo(t.strokeStyle))&&!("paintMode"in t&&!["fill","stroke","strokeAndFill"].includes(t.paintMode))&&!("fontFamily"in t&&!mo(t.fontFamily))&&!("fontSize"in t&&!kn(t.fontSize));class Qr{static convert(e,n,o){const h={x:0,y:0,width:n,height:o};if(!e)return h;if(on(e))e.isMeasuredInPercentage?(h.x=e.x/100*n,h.y=e.y/100*o,h.width=e.width/100*n,h.height=e.height/100*o):(h.x=e.x,h.y=e.y,h.width=e.width,h.height=e.height);else{if(!Pa(e))throw TypeError("Invalid region.");e.isMeasuredInPercentage?(h.x=e.left/100*n,h.y=e.top/100*o,h.width=(e.right-e.left)/100*n,h.height=(e.bottom-e.top)/100*o):(h.x=e.left,h.y=e.top,h.width=e.right-e.left,h.height=e.bottom-e.top)}return h.x=Math.round(h.x),h.y=Math.round(h.y),h.width=Math.round(h.width),h.height=Math.round(h.height),h}}var Wi,es;class ah{constructor(){Wi.set(this,new Map),es.set(this,!1)}get disposed(){return S(this,es,"f")}on(e,n){e=e.toLowerCase();const o=S(this,Wi,"f").get(e);if(o){if(o.includes(n))return;o.push(n)}else S(this,Wi,"f").set(e,[n])}off(e,n){e=e.toLowerCase();const o=S(this,Wi,"f").get(e);if(!o)return;const h=o.indexOf(n);h!==-1&&o.splice(h,1)}offAll(e){e=e.toLowerCase();const n=S(this,Wi,"f").get(e);n&&(n.length=0)}async fire(e,n=[],o={async:!1,copy:!0}){n||(n=[]),e=e.toLowerCase();const h=S(this,Wi,"f").get(e);if(h&&h.length){o=Object.assign({async:!1,copy:!0},o);for(let g of h){if(!g)continue;let m=[];if(o.copy)for(let C of n){try{C=JSON.parse(JSON.stringify(C))}catch{}m.push(C)}else m=n;let v=!1;if(o.async)setTimeout(()=>{this.disposed||g.apply(o.target,m)},0);else try{v=await g.apply(o.target,m)}catch{}if(v===!0)break}}}dispose(){Ee(this,es,!0,"f")}}function gd(t,e,n){return(n.x-t.x)*(e.y-t.y)==(e.x-t.x)*(n.y-t.y)&&Math.min(t.x,e.x)<=n.x&&n.x<=Math.max(t.x,e.x)&&Math.min(t.y,e.y)<=n.y&&n.y<=Math.max(t.y,e.y)}function _o(t){return Math.abs(t)<1e-6?0:t<0?-1:1}function Vr(t,e,n,o){let h=t[0]*(n[1]-e[1])+e[0]*(t[1]-n[1])+n[0]*(e[1]-t[1]),g=t[0]*(o[1]-e[1])+e[0]*(t[1]-o[1])+o[0]*(e[1]-t[1]);return!((h^g)>=0&&h!==0&&g!==0)&&(h=n[0]*(t[1]-o[1])+o[0]*(n[1]-t[1])+t[0]*(o[1]-n[1]),g=n[0]*(e[1]-o[1])+o[0]*(n[1]-e[1])+e[0]*(o[1]-n[1]),!((h^g)>=0&&h!==0&&g!==0))}Wi=new WeakMap,es=new WeakMap;const Ul=async t=>{if(typeof t!="string")throw new TypeError("Invalid url.");const e=await fetch(t);if(!e.ok)throw Error("Network Error: "+e.statusText);const n=await e.text();if(!n.trim().startsWith("<"))throw Error("Unable to get valid HTMLElement.");const o=document.createElement("div");o.insertAdjacentHTML("beforeend",n);for(let h=0;h<o.childElementCount;++h){let g=o.children[h];g instanceof HTMLStyleElement&&document.head.append(g)}return o.childElementCount==1?o.children[0]:o};var wi,Ci,Ei;class un extends Tt{constructor(e,n){if(super(null,n),wi.set(this,void 0),!on(e))throw new TypeError("Invalid 'rect'.");this._setFabricObject(new je.Rect({left:e.x,top:e.y,width:e.width,height:e.height})),Ee(this,wi,JSON.parse(JSON.stringify(e)),"f"),this._mediaType="rect"}extendSet(e,n){return!1}extendGet(e){}updateCoordinateBaseFromImageToView(){this.set("left",this.convertPropFromViewToImage(this.get("left"))),this.set("top",this.convertPropFromViewToImage(this.get("top"))),this.set("width",this.convertPropFromViewToImage(this.get("scaledWidth"))),this.set("height",this.convertPropFromViewToImage(this.get("scaledHeight")))}updateCoordinateBaseFromViewToImage(){this.set("left",this.convertPropFromImageToView(this.get("left"))),this.set("top",this.convertPropFromImageToView(this.get("top"))),this.set("width",this.convertPropFromImageToView(this.get("scaledWidth"))),this.set("height",this.convertPropFromImageToView(this.get("scaledHeight")))}setPosition(e){this.setRect(e)}getPosition(){return this.getRect()}updatePosition(){S(this,wi,"f")&&this.setRect(S(this,wi,"f"))}setRect(e){if(!on(e))throw new TypeError("Invalid 'rect'.");if(this._drawingLayer){if(this.coordinateBase==="view")this.set("left",this.convertPropFromViewToImage(e.x)),this.set("top",this.convertPropFromViewToImage(e.y)),this.set("width",this.convertPropFromViewToImage(e.width)),this.set("height",this.convertPropFromViewToImage(e.height));else{if(this.coordinateBase!=="image")throw new Error("Invalid 'coordinateBase'.");this.set("left",e.x),this.set("top",e.y),this.set("width",e.width),this.set("height",e.height)}this._drawingLayer.renderAll()}else Ee(this,wi,JSON.parse(JSON.stringify(e)),"f")}getRect(){if(this._drawingLayer){if(this.coordinateBase==="view")return{x:this.convertPropFromImageToView(this.get("left")),y:this.convertPropFromImageToView(this.get("top")),width:this.convertPropFromImageToView(this.get("scaledWidth")),height:this.convertPropFromImageToView(this.get("scaledHeight"))};if(this.coordinateBase==="image")return{x:this.get("left"),y:this.get("top"),width:this.get("scaledWidth"),height:this.get("scaledHeight")};throw new Error("Invalid 'coordinateBase'.")}return S(this,wi,"f")?JSON.parse(JSON.stringify(S(this,wi,"f"))):null}}function Gl(t,e,n){let o=n.points[this.pointIndex].x-n.pathOffset.x,h=n.points[this.pointIndex].y-n.pathOffset.y;return je.util.transformPoint({x:o,y:h},n.calcTransformMatrix())}function lh(t){let e=new je.Point(t.strokeUniform?1/t.scaleX:1,t.strokeUniform?1/t.scaleY:1).multiply(t.strokeWidth);return new je.Point(t.width+e.x,t.height+e.y)}function Vl(t,e,n,o){let h=e.target,g=h.controls[h.__corner],m=h.toLocalPoint(new je.Point(n,o),"center","center"),v=lh(h),C=h._getTransformedDimensions(0,0),E={x:m.x*v.x/C.x+h.pathOffset.x,y:m.y*v.y/C.y+h.pathOffset.y};return h.points[g.pointIndex]=E,!0}function Wl(t,e){return function(n,o,h,g){let m=o.target,v=je.util.transformPoint({x:m.points[t].x-m.pathOffset.x,y:m.points[t].y-m.pathOffset.y},m.calcTransformMatrix()),C=e(n,o,h,g);m._setPositionDimensions({});let E=lh(m),I=(m.points[t].x-m.pathOffset.x)/E.x,R=(m.points[t].y-m.pathOffset.y)/E.y;return m.setPositionByOrigin(v,I+.5,R+.5),C}}wi=new WeakMap;class Xo extends Tt{constructor(e,n){if(super(null,n),Ci.set(this,void 0),!Bl(e))throw new TypeError("Invalid 'polygon'.");this._setFabricObject(new je.Polygon(e.points,{objectCaching:!1}));const o=this._fabricObject;let h=o.points.length-1;o.controls=o.points.reduce(function(g,m,v){return g["p"+v]=new je.Control({positionHandler:Gl,actionHandler:Wl(v>0?v-1:h,Vl),actionName:"modifyPolygon",pointIndex:v}),g},{}),Ee(this,Ci,JSON.parse(JSON.stringify(e)),"f"),this._mediaType="polygon"}extendSet(e,n){if(e==="vertices"){const o=this._fabricObject;if(o.group){const g=o.group;o.points=n.map(m=>({x:m.x-g.left-g.width/2,y:m.y-g.top-g.height/2})),g.addWithUpdate()}else o.points=n;const h=o.points.length-1;return o.controls=o.points.reduce(function(g,m,v){return g["p"+v]=new je.Control({positionHandler:Gl,actionHandler:Wl(v>0?v-1:h,Vl),actionName:"modifyPolygon",pointIndex:v}),g},{}),o._setPositionDimensions({}),!0}}extendGet(e){if(e==="vertices"){const n=[],o=this._fabricObject;if(o.selectable&&!o.group)for(let h in o.oCoords)n.push({x:o.oCoords[h].x,y:o.oCoords[h].y});else for(let h of o.points){let g=h.x-o.pathOffset.x,m=h.y-o.pathOffset.y;const v=je.util.transformPoint({x:g,y:m},o.calcTransformMatrix());n.push({x:v.x,y:v.y})}return n}}updateCoordinateBaseFromImageToView(){const e=this.get("vertices").map(n=>({x:this.convertPropFromViewToImage(n.x),y:this.convertPropFromViewToImage(n.y)}));this.set("vertices",e)}updateCoordinateBaseFromViewToImage(){const e=this.get("vertices").map(n=>({x:this.convertPropFromImageToView(n.x),y:this.convertPropFromImageToView(n.y)}));this.set("vertices",e)}setPosition(e){this.setPolygon(e)}getPosition(){return this.getPolygon()}updatePosition(){S(this,Ci,"f")&&this.setPolygon(S(this,Ci,"f"))}setPolygon(e){if(!Bl(e))throw new TypeError("Invalid 'polygon'.");if(this._drawingLayer){if(this.coordinateBase==="view"){const n=e.points.map(o=>({x:this.convertPropFromViewToImage(o.x),y:this.convertPropFromViewToImage(o.y)}));this.set("vertices",n)}else{if(this.coordinateBase!=="image")throw new Error("Invalid 'coordinateBase'.");this.set("vertices",e.points)}this._drawingLayer.renderAll()}else Ee(this,Ci,JSON.parse(JSON.stringify(e)),"f")}getPolygon(){if(this._drawingLayer){if(this.coordinateBase==="view")return{points:this.get("vertices").map(e=>({x:this.convertPropFromImageToView(e.x),y:this.convertPropFromImageToView(e.y)}))};if(this.coordinateBase==="image")return{points:this.get("vertices")};throw new Error("Invalid 'coordinateBase'.")}return S(this,Ci,"f")?JSON.parse(JSON.stringify(S(this,Ci,"f"))):null}}Ci=new WeakMap;const Yl=t=>{let e=(n=>n.split(`
`).map(o=>o.split("	")))(t);return(n=>{for(let o=0;;o++){let h=-1;for(let g=0;g<n.length;g++){let m=n[g][o];m!==void 0&&m.length>h&&(h=m.length)}if(h===-1)break;for(let g=0;g<n.length;g++){if(o>=n[g].length-1)continue;let m=" ".repeat(h+2-n[g][o].length);n[g][o]=n[g][o].concat(m)}}})(e),(n=>{let o="";for(let h=0;h<n.length;h++)o=o.concat(...n[h],h===n.length-1?"":`
`);return o})(e)};class pd extends Tt{constructor(e,n,o){if(super(null,o),Ei.set(this,void 0),!Yo(e))throw new TypeError("Invalid 'text'.");if(!on(n))throw new TypeError("Invalid 'rect'.");this._setFabricObject(new je.Textbox(Yl(e),{left:n.x,top:n.y,width:n.width})),this._text=e,Ee(this,Ei,JSON.parse(JSON.stringify(n)),"f"),this._mediaType="text"}extendSet(e,n){if(e==="text")return this._text=n,this._fabricObject.set("text",Yl(n)),!0}extendGet(e){if(e==="text")return this._text}updateCoordinateBaseFromImageToView(){this.set("left",this.convertPropFromViewToImage(this.get("left"))),this.set("top",this.convertPropFromViewToImage(this.get("top"))),this.set("width",this.convertPropFromViewToImage(this.get("scaledWidth")))}updateCoordinateBaseFromViewToImage(){this.set("left",this.convertPropFromImageToView(this.get("left"))),this.set("top",this.convertPropFromImageToView(this.get("top"))),this.set("width",this.convertPropFromImageToView(this.get("scaledWidth")))}setPosition(e){this.setTextRect(e)}getPosition(){return this.getTextRect()}updatePosition(){S(this,Ei,"f")&&this.setTextRect(S(this,Ei,"f"))}setText(e){if(!Yo(e))throw new TypeError("Invalid 'text'.");this.set("text",e)}getText(){return this.get("text")}setTextRect(e){if(!on(e))throw new TypeError("Invalid 'rect'.");if(this._drawingLayer){if(this.coordinateBase==="view")this.set("left",this.convertPropFromViewToImage(e.x)),this.set("top",this.convertPropFromViewToImage(e.y)),this.set("width",this.convertPropFromViewToImage(e.width));else{if(this.coordinateBase!=="image")throw new Error("Invalid 'coordinateBase'.");this.set("left",e.x),this.set("top",e.y),this.set("width",e.width)}this._drawingLayer.renderAll()}else Ee(this,Ei,JSON.parse(JSON.stringify(e)),"f")}getTextRect(){if(this._drawingLayer){if(this.coordinateBase==="view")return{x:this.convertPropFromImageToView(this.get("left")),y:this.convertPropFromImageToView(this.get("top")),width:this.convertPropFromImageToView(this.get("scaledWidth")),height:this.convertPropFromImageToView(this.get("scaledHeight"))};if(this.coordinateBase==="image")return{x:this.get("left"),y:this.get("top"),width:this.get("scaledWidth"),height:this.get("scaledHeight")};throw new Error("Invalid 'coordinateBase'.")}return S(this,Ei,"f")?JSON.parse(JSON.stringify(S(this,Ei,"f"))):null}}var Ti,bi,mn,zo,_n,rr,vn,At,sr,or,ar,ch,hh,uh,fh,ts,Ze,lr,cr,hr,lt,is,ns,rs,Si,ur,fr,$o,Ut,ss,dh,Ko,Zo,dr,os;Ei=new WeakMap;class md extends Xo{constructor(e,n){if(super({points:e==null?void 0:e.points},n),Ti.set(this,void 0),!Nl(e))throw new TypeError("Invalid 'quad'.");Ee(this,Ti,JSON.parse(JSON.stringify(e)),"f"),this._mediaType="quad"}setPosition(e){this.setQuad(e)}getPosition(){return this.getQuad()}updatePosition(){S(this,Ti,"f")&&this.setQuad(S(this,Ti,"f"))}setPolygon(){}getPolygon(){return null}setQuad(e){if(!Nl(e))throw new TypeError("Invalid 'quad'.");if(this._drawingLayer){if(this.coordinateBase==="view"){const n=e.points.map(o=>({x:this.convertPropFromViewToImage(o.x),y:this.convertPropFromViewToImage(o.y)}));this.set("vertices",n)}else{if(this.coordinateBase!=="image")throw new Error("Invalid 'coordinateBase'.");this.set("vertices",e.points)}this._drawingLayer.renderAll()}else Ee(this,Ti,JSON.parse(JSON.stringify(e)),"f")}getQuad(){if(this._drawingLayer){if(this.coordinateBase==="view")return{points:this.get("vertices").map(e=>({x:this.convertPropFromImageToView(e.x),y:this.convertPropFromImageToView(e.y)}))};if(this.coordinateBase==="image")return{points:this.get("vertices")};throw new Error("Invalid 'coordinateBase'.")}return S(this,Ti,"f")?JSON.parse(JSON.stringify(S(this,Ti,"f"))):null}}Ti=new WeakMap;class _d extends Tt{constructor(e){super(new je.Group(e.map(n=>n._getFabricObject()))),this._fabricObject.on("selected",()=>{this.setState(Ft.DIS_SELECTED);const n=this._fabricObject._objects;for(let o of n)setTimeout(()=>{o&&o.fire("selected")},0);setTimeout(()=>{this._fabricObject&&this._fabricObject.canvas&&(this._fabricObject.dirty=!0,this._fabricObject.canvas.renderAll())},0)}),this._fabricObject.on("deselected",()=>{this.setState(Ft.DIS_DEFAULT);const n=this._fabricObject._objects;for(let o of n)setTimeout(()=>{o&&o.fire("deselected")},0);setTimeout(()=>{this._fabricObject&&this._fabricObject.canvas&&(this._fabricObject.dirty=!0,this._fabricObject.canvas.renderAll())},0)}),this._mediaType="group"}extendSet(e,n){return!1}extendGet(e){}updateCoordinateBaseFromImageToView(){}updateCoordinateBaseFromViewToImage(){}setPosition(){}getPosition(){}updatePosition(){}getChildDrawingItems(){return this._fabricObject._objects.map(e=>e.getDrawingItem())}setChildDrawingItems(e){if(!e||!e.isDrawingItem)throw TypeError("Illegal drawing item.");this._drawingLayer?this._drawingLayer._updateGroupItem(this,e,"add"):this._fabricObject.addWithUpdate(e._getFabricObject())}removeChildItem(e){e&&e.isDrawingItem&&(this._drawingLayer?this._drawingLayer._updateGroupItem(this,e,"remove"):this._fabricObject.removeWithUpdate(e._getFabricObject()))}}class ue{static createDrawingStyle(e){if(!jl(e))throw new Error("Invalid style definition.");let n,o=ue.USER_START_STYLE_ID;for(;S(ue,bi,"f",mn).has(o);)o++;n=o;const h=JSON.parse(JSON.stringify(e));h.id=n;for(let g in S(ue,bi,"f",zo))h.hasOwnProperty(g)||(h[g]=S(ue,bi,"f",zo)[g]);return S(ue,bi,"f",mn).set(n,h),h.id}static _getDrawingStyle(e,n){if(typeof e!="number")throw new Error("Invalid style id.");const o=S(ue,bi,"f",mn).get(e);return o?n?JSON.parse(JSON.stringify(o)):o:null}static getDrawingStyle(e){return this._getDrawingStyle(e,!0)}static getDrawingStyles(){return JSON.parse(JSON.stringify(Array.from(S(ue,bi,"f",mn).values())))}static _updateDrawingStyle(e,n){if(!jl(n))throw new Error("Invalid style definition.");const o=S(ue,bi,"f",mn).get(e);if(o)for(let h in n)o.hasOwnProperty(h)&&(o[h]=n[h])}static updateDrawingStyle(e,n){this._updateDrawingStyle(e,n)}}bi=ue,ue.STYLE_BLUE_STROKE=1,ue.STYLE_GREEN_STROKE=2,ue.STYLE_ORANGE_STROKE=3,ue.STYLE_YELLOW_STROKE=4,ue.STYLE_BLUE_STROKE_FILL=5,ue.STYLE_GREEN_STROKE_FILL=6,ue.STYLE_ORANGE_STROKE_FILL=7,ue.STYLE_YELLOW_STROKE_FILL=8,ue.STYLE_BLUE_STROKE_TRANSPARENT=9,ue.STYLE_GREEN_STROKE_TRANSPARENT=10,ue.STYLE_ORANGE_STROKE_TRANSPARENT=11,ue.USER_START_STYLE_ID=1024,mn={value:new Map([[ue.STYLE_BLUE_STROKE,{id:ue.STYLE_BLUE_STROKE,lineWidth:4,fillStyle:"rgba(73, 173, 245, 0.3)",strokeStyle:"rgba(73, 173, 245, 1)",paintMode:"stroke",fontFamily:"consolas",fontSize:40}],[ue.STYLE_GREEN_STROKE,{id:ue.STYLE_GREEN_STROKE,lineWidth:2,fillStyle:"rgba(73, 245, 73, 0.3)",strokeStyle:"rgba(73, 245, 73, 0.9)",paintMode:"strokeAndFill",fontFamily:"consolas",fontSize:40}],[ue.STYLE_ORANGE_STROKE,{id:ue.STYLE_ORANGE_STROKE,lineWidth:2,fillStyle:"rgba(254, 180, 32, 0.3)",strokeStyle:"rgba(254, 180, 32, 0.9)",paintMode:"strokeAndFill",fontFamily:"consolas",fontSize:40}],[ue.STYLE_YELLOW_STROKE,{id:ue.STYLE_YELLOW_STROKE,lineWidth:2,fillStyle:"rgba(245, 236, 73, 0.3)",strokeStyle:"rgba(245, 236, 73, 1)",paintMode:"stroke",fontFamily:"consolas",fontSize:40}],[ue.STYLE_BLUE_STROKE_FILL,{id:ue.STYLE_BLUE_STROKE_FILL,lineWidth:4,fillStyle:"rgba(73, 173, 245, 0.3)",strokeStyle:"rgba(73, 173, 245, 1)",paintMode:"strokeAndFill",fontFamily:"consolas",fontSize:40}],[ue.STYLE_GREEN_STROKE_FILL,{id:ue.STYLE_GREEN_STROKE_FILL,lineWidth:2,fillStyle:"rgba(73, 245, 73, 0.3)",strokeStyle:"rgba(73, 245, 73, 0.9)",paintMode:"strokeAndFill",fontFamily:"consolas",fontSize:40}],[ue.STYLE_ORANGE_STROKE_FILL,{id:ue.STYLE_ORANGE_STROKE_FILL,lineWidth:2,fillStyle:"rgba(254, 180, 32, 0.3)",strokeStyle:"rgba(254, 180, 32, 1)",paintMode:"strokeAndFill",fontFamily:"consolas",fontSize:40}],[ue.STYLE_YELLOW_STROKE_FILL,{id:ue.STYLE_YELLOW_STROKE_FILL,lineWidth:2,fillStyle:"rgba(245, 236, 73, 0.3)",strokeStyle:"rgba(245, 236, 73, 1)",paintMode:"strokeAndFill",fontFamily:"consolas",fontSize:40}],[ue.STYLE_BLUE_STROKE_TRANSPARENT,{id:ue.STYLE_BLUE_STROKE_TRANSPARENT,lineWidth:4,fillStyle:"rgba(73, 245, 73, 0.2)",strokeStyle:"transparent",paintMode:"strokeAndFill",fontFamily:"consolas",fontSize:40}],[ue.STYLE_GREEN_STROKE_TRANSPARENT,{id:ue.STYLE_GREEN_STROKE_TRANSPARENT,lineWidth:2,fillStyle:"rgba(73, 245, 73, 0.2)",strokeStyle:"transparent",paintMode:"strokeAndFill",fontFamily:"consolas",fontSize:40}],[ue.STYLE_ORANGE_STROKE_TRANSPARENT,{id:ue.STYLE_ORANGE_STROKE_TRANSPARENT,lineWidth:2,fillStyle:"rgba(254, 180, 32, 0.2)",strokeStyle:"transparent",paintMode:"strokeAndFill",fontFamily:"consolas",fontSize:40}]])},zo={value:{lineWidth:2,fillStyle:"rgba(245, 236, 73, 0.3)",strokeStyle:"rgba(245, 236, 73, 1)",paintMode:"stroke",fontFamily:"consolas",fontSize:40}},typeof document<"u"&&typeof window<"u"&&(je.StaticCanvas.prototype.dispose=function(){return this.isRendering&&(je.util.cancelAnimFrame(this.isRendering),this.isRendering=0),this.forEachObject(function(t){t.dispose&&t.dispose()}),this._objects=[],this.backgroundImage&&this.backgroundImage.dispose&&this.backgroundImage.dispose(),this.backgroundImage=null,this.overlayImage&&this.overlayImage.dispose&&this.overlayImage.dispose(),this.overlayImage=null,this._iTextInstances=null,this.contextContainer=null,this.lowerCanvasEl.classList.remove("lower-canvas"),delete this._originalCanvasStyle,this.lowerCanvasEl.setAttribute("width",this.width),this.lowerCanvasEl.setAttribute("height",this.height),je.util.cleanUpJsdomNode(this.lowerCanvasEl),this.lowerCanvasEl=void 0,this},je.Object.prototype.transparentCorners=!1,je.Object.prototype.cornerSize=20,je.Object.prototype.touchCornerSize=100,je.Object.prototype.cornerColor="rgb(254,142,20)",je.Object.prototype.cornerStyle="circle",je.Object.prototype.strokeUniform=!0,je.Object.prototype.hasBorders=!1,je.Canvas.prototype.containerClass="",je.Canvas.prototype.getPointer=function(t,e){if(this._absolutePointer&&!e)return this._absolutePointer;if(this._pointer&&e)return this._pointer;var n,o=this.upperCanvasEl,h=je.util.getPointer(t,o),g=o.getBoundingClientRect(),m=g.width||0,v=g.height||0;m&&v||("top"in g&&"bottom"in g&&(v=Math.abs(g.top-g.bottom)),"right"in g&&"left"in g&&(m=Math.abs(g.right-g.left))),this.calcOffset(),h.x=h.x-this._offset.left,h.y=h.y-this._offset.top,e||(h=this.restorePointerVpt(h));var C=this.getRetinaScaling();if(C!==1&&(h.x/=C,h.y/=C),m!==0&&v!==0){var E=window.getComputedStyle(o).objectFit,I=o.width,R=o.height,L=m,N=v;n={width:I/L,height:R/N};var Y,X,K=I/R,J=L/N;return E==="contain"?K>J?(Y=L,X=L/K,{x:h.x*n.width,y:(h.y-(N-X)/2)*n.width}):(Y=N*K,X=N,{x:(h.x-(L-Y)/2)*n.height,y:h.y*n.height}):E==="cover"?K>J?{x:(I-n.height*L)/2+h.x*n.height,y:h.y*n.height}:{x:h.x*n.width,y:(R-n.width*N)/2+h.y*n.width}:{x:h.x*n.width,y:h.y*n.height}}return n={width:1,height:1},{x:h.x*n.width,y:h.y*n.height}},je.Canvas.prototype._onTouchStart=function(t){var e=this.findTarget(t);!this.allowTouchScrolling&&t.cancelable&&t.preventDefault&&t.preventDefault(),e&&t.cancelable&&t.preventDefault&&t.preventDefault(),this.mainTouchId===null&&(this.mainTouchId=this.getPointerId(t)),this.__onMouseDown(t),this._resetTransformEventData();var n=this.upperCanvasEl,o=this._getEventPrefix();je.util.addListener(je.document,"touchend",this._onTouchEnd,{passive:!1}),je.util.addListener(je.document,"touchmove",this._onMouseMove,{passive:!1}),je.util.removeListener(n,o+"down",this._onMouseDown)},je.Textbox.prototype._wrapLine=function(t,e,n,o){const h=t.match(/[\u3040-\u30ff\u3400-\u4dbf\u4e00-\u9fff\uf900-\ufaff\uff66-\uff9f]/g),g=!(!h||!h.length);var m=0,v=this.splitByGrapheme||g,C=[],E=[],I=v?je.util.string.graphemeSplit(t):t.split(this._wordJoiners),R="",L=0,N=v?"":" ",Y=0,X=0,K=0,J=!0,te=this._getWidthOfCharSpacing();o=o||0,I.length===0&&I.push([]),n-=o;for(var ne=0;ne<I.length;ne++)R=v?I[ne]:je.util.string.graphemeSplit(I[ne]),Y=this._measureWord(R,e,L),L+=R.length,(m+=X+Y-te)>n&&!J?(C.push(E),E=[],m=Y,J=!0):m+=te,J||v||E.push(N),E=E.concat(R),X=v?0:this._measureWord([N],e,L),L++,J=!1,Y>K&&(K=Y);return ne&&C.push(E),K+o>this.dynamicMinWidth&&(this.dynamicMinWidth=K-te+o),C});class Je{get width(){return this.fabricCanvas.width}get height(){return this.fabricCanvas.height}set _allowMultiSelect(e){this.fabricCanvas.selection=e,this.fabricCanvas.renderAll()}get _allowMultiSelect(){return this.fabricCanvas.selection}constructor(e,n,o){let h,g;switch(this.mapMediaType_Style=new Map,this.mapType_StateAndStyleId=new Map,this.mode="viewer",this.onSelectionChanged=null,this._arrDrwaingItem=[],this._arrFabricObject=[],this._visible=!0,e.hasOwnProperty("getFabricCanvas")?this.fabricCanvas=e.getFabricCanvas():(this.fabricCanvas=new je.Canvas(e,Object.assign(o,{allowTouchScrolling:!0,selection:!1})),this.fabricCanvas.setDimensions({width:"100%",height:"100%"},{cssOnly:!0}),this.fabricCanvas.lowerCanvasEl.className="",this.fabricCanvas.upperCanvasEl.className="",this.fabricCanvas.on("selection:created",function(m){const v=m.selected,C=[];for(let E of v){const I=E.getDrawingItem()._drawingLayer;I&&!C.includes(I)&&C.push(I)}for(let E of C){const I=[];for(let R of v){const L=R.getDrawingItem();L._drawingLayer===E&&I.push(L)}setTimeout(()=>{E.onSelectionChanged&&E.onSelectionChanged(I,[])},0)}}),this.fabricCanvas.on("before:selection:cleared",function(m){const v=this.getActiveObjects(),C=[];for(let E of v){const I=E.getDrawingItem()._drawingLayer;I&&!C.includes(I)&&C.push(I)}for(let E of C){const I=[];for(let R of v){const L=R.getDrawingItem();L._drawingLayer===E&&I.push(L)}setTimeout(()=>{const R=[];for(let L of I)E.hasDrawingItem(L)&&R.push(L);R.length>0&&E.onSelectionChanged&&E.onSelectionChanged([],R)},0)}}),this.fabricCanvas.on("selection:updated",function(m){const v=m.selected,C=m.deselected,E=[];for(let I of v){const R=I.getDrawingItem()._drawingLayer;R&&!E.includes(R)&&E.push(R)}for(let I of C){const R=I.getDrawingItem()._drawingLayer;R&&!E.includes(R)&&E.push(R)}for(let I of E){const R=[],L=[];for(let N of v){const Y=N.getDrawingItem();Y._drawingLayer===I&&R.push(Y)}for(let N of C){const Y=N.getDrawingItem();Y._drawingLayer===I&&L.push(Y)}setTimeout(()=>{I.onSelectionChanged&&I.onSelectionChanged(R,L)},0)}}),this.fabricCanvas.wrapperEl.style.position="absolute",e.getFabricCanvas=()=>this.fabricCanvas),this.id=n,n){case Je.DDN_LAYER_ID:h=ue.getDrawingStyle(ue.STYLE_BLUE_STROKE),g=ue.getDrawingStyle(ue.STYLE_BLUE_STROKE_FILL);break;case Je.DBR_LAYER_ID:h=ue.getDrawingStyle(ue.STYLE_ORANGE_STROKE),g=ue.getDrawingStyle(ue.STYLE_ORANGE_STROKE_FILL);break;case Je.DLR_LAYER_ID:h=ue.getDrawingStyle(ue.STYLE_GREEN_STROKE),g=ue.getDrawingStyle(ue.STYLE_GREEN_STROKE_FILL);break;default:h=ue.getDrawingStyle(ue.STYLE_YELLOW_STROKE),g=ue.getDrawingStyle(ue.STYLE_YELLOW_STROKE_FILL)}for(let m of Tt.arrMediaTypes)this.mapType_StateAndStyleId.set(m,{default:h.id,selected:g.id})}getId(){return this.id}setVisible(e){if(e){for(let n of this._arrFabricObject)n.visible=!0,n.hasControls=!0;this._visible=!0}else{for(let n of this._arrFabricObject)n.visible=!1,n.hasControls=!1;this._visible=!1}this.fabricCanvas.renderAll()}isVisible(){return this._visible}_getItemCurrentStyleId(e){return e.styleId?e.styleId:this.mapType_StateAndStyleId.get(e._mediaType)[e.styleSelector]}_getItemCurrentStyle(e){return e.styleId?ue.getDrawingStyle(e.styleId):ue.getDrawingStyle(e._mapState_StyleId.get(e.styleSelector))||null}_changeMediaTypeCurStyleInStyleSelector(e,n,o,h){const g=this.getDrawingItems(m=>m._mediaType===e);for(let m of g)m.styleSelector===n&&this._changeItemStyle(m,o,!0);h||this.fabricCanvas.renderAll()}_changeItemStyle(e,n,o){if(!e||!n)return;const h=e._getFabricObject();typeof e.styleId=="number"&&(n=ue.getDrawingStyle(e.styleId)),h.strokeWidth=n.lineWidth,n.paintMode==="fill"?(h.fill=n.fillStyle,h.stroke=n.fillStyle):n.paintMode==="stroke"?(h.fill="transparent",h.stroke=n.strokeStyle):n.paintMode==="strokeAndFill"&&(h.fill=n.fillStyle,h.stroke=n.strokeStyle),h.fontFamily&&(h.fontFamily=n.fontFamily),h.fontSize&&(h.fontSize=n.fontSize),h.group||(h.dirty=!0),o||this.fabricCanvas.renderAll()}_updateGroupItem(e,n,o){if(!e||!n)return;const h=e.getChildDrawingItems();if(o==="add"){if(h.includes(n))return;const g=n._getFabricObject();if(this.fabricCanvas.getObjects().includes(g)){if(!this._arrFabricObject.includes(g))throw new Error("Existed in other drawing layers.");n._zIndex=null}else{let m;if(n.styleId)m=ue.getDrawingStyle(n.styleId);else{const v=this.mapType_StateAndStyleId.get(n._mediaType);m=ue.getDrawingStyle(v[e.styleSelector]);const C=()=>{this._changeItemStyle(n,ue.getDrawingStyle(this.mapType_StateAndStyleId.get(n._mediaType).selected),!0)},E=()=>{this._changeItemStyle(n,ue.getDrawingStyle(this.mapType_StateAndStyleId.get(n._mediaType).default),!0)};n._on("selected",C),n._on("deselected",E),n._funcChangeStyleToSelected=C,n._funcChangeStyleToDefault=E}n._drawingLayer=this,n._drawingLayerId=this.id,this._changeItemStyle(n,m,!0)}e._fabricObject.addWithUpdate(n._getFabricObject())}else{if(o!=="remove"||!h.includes(n))return;n._zIndex=null,n._drawingLayer=null,n._drawingLayerId=null,n._off("selected",n._funcChangeStyleToSelected),n._off("deselected",n._funcChangeStyleToDefault),n._funcChangeStyleToSelected=null,n._funcChangeStyleToDefault=null,e._fabricObject.removeWithUpdate(n._getFabricObject())}this.fabricCanvas.renderAll()}_addDrawingItem(e,n){if(!(e instanceof Tt))throw new TypeError("Invalid 'drawingItem'.");if(e._drawingLayer){if(e._drawingLayer==this)return;throw new Error("This drawing item has existed in other layer.")}let o=e._getFabricObject();const h=this.fabricCanvas.getObjects();let g,m;if(h.includes(o)){if(this._arrFabricObject.includes(o))return;throw new Error("Existed in other drawing layers.")}if(e._mediaType==="group"){g=e.getChildDrawingItems();for(let E of g)if(E._drawingLayer&&E._drawingLayer!==this)throw new Error("The childItems of DT_Group have existed in other drawing layers.")}if(n&&typeof n=="object"&&!Array.isArray(n))for(let E in n)o.set(E,n[E]);if(g){for(let E of g){const I=this.mapType_StateAndStyleId.get(E._mediaType);for(let R of Tt.arrStyleSelectors)E._mapState_StyleId.set(R,I[R]);if(E.styleId)m=ue.getDrawingStyle(E.styleId);else{m=ue.getDrawingStyle(I.default);const R=()=>{this._changeItemStyle(E,ue.getDrawingStyle(this.mapType_StateAndStyleId.get(E._mediaType).selected),!0)},L=()=>{this._changeItemStyle(E,ue.getDrawingStyle(this.mapType_StateAndStyleId.get(E._mediaType).default),!0)};E._on("selected",R),E._on("deselected",L),E._funcChangeStyleToSelected=R,E._funcChangeStyleToDefault=L}E._drawingLayer=this,E._drawingLayerId=this.id,this._changeItemStyle(E,m,!0)}o.dirty=!0,this.fabricCanvas.renderAll()}else{const E=this.mapType_StateAndStyleId.get(e._mediaType);for(let I of Tt.arrStyleSelectors)e._mapState_StyleId.set(I,E[I]);if(e.styleId)m=ue.getDrawingStyle(e.styleId);else{m=ue.getDrawingStyle(E.default);const I=()=>{this._changeItemStyle(e,ue.getDrawingStyle(this.mapType_StateAndStyleId.get(e._mediaType).selected))},R=()=>{this._changeItemStyle(e,ue.getDrawingStyle(this.mapType_StateAndStyleId.get(e._mediaType).default))};e._on("selected",I),e._on("deselected",R),e._funcChangeStyleToSelected=I,e._funcChangeStyleToDefault=R}this._changeItemStyle(e,m)}e._zIndex=this.id,e._drawingLayer=this,e._drawingLayerId=this.id;const v=this._arrFabricObject.length;let C=h.length;if(v)C=h.indexOf(this._arrFabricObject[v-1])+1;else for(let E=0;E<h.length;E++)if(e._zIndex<h[E].getDrawingItem()._zIndex){C=E;break}this._arrDrwaingItem.push(e),this._arrFabricObject.push(o),this._visible?o.visible=!0:o.visible=!1,this.fabricCanvas.insertAt(o,C,!1)}addDrawingItem(e){if(!e||!e.isDrawingItem)throw TypeError("Illegal drawing item.");if(this.mode==="viewer")e._setEditable(!1);else{if(this.mode!=="editor")throw new Error("Illegal 'mode'.");e._setEditable(!0)}this._addDrawingItem(e),e.updatePosition()}addDrawingItems(e){for(let n of e)this.addDrawingItem(n)}removeDrawingItem(e){if(!e||!e.isDrawingItem)throw TypeError("Illegal drawing item.");if(!this.hasDrawingItem(e))return;if(e._zIndex=null,e._drawingLayer=null,e._drawingLayerId=null,e._mediaType==="group"){const o=e.getChildDrawingItems();for(let h of o)h._zIndex=null,h._drawingLayer=null,h._drawingLayerId=null,h._off("selected",h._funcChangeStyleToSelected),h._off("deselected",h._funcChangeStyleToDefault),h._funcChangeStyleToSelected=null,h._funcChangeStyleToDefault=null,h._mapState_StyleId.clear()}else e._off("selected",e._funcChangeStyleToSelected),e._off("deselected",e._funcChangeStyleToDefault),e._funcChangeStyleToSelected=null,e._funcChangeStyleToDefault=null,e._mapState_StyleId.clear();const n=e._getFabricObject();e.styleSelector==="selected"&&(n.group?n.group.removeWithUpdate(n):this.fabricCanvas._activeObject=null,e.setState(Ft.DIS_DEFAULT)),this.fabricCanvas.remove(n),this._arrDrwaingItem.splice(this._arrDrwaingItem.indexOf(e),1),this._arrFabricObject.splice(this._arrFabricObject.indexOf(n),1)}removeDrawingItems(e){for(let n of e)this.removeDrawingItem(n)}setDrawingItems(e){this.clearDrawingItems(),this.addDrawingItems(e)}getDrawingItems(e){return e&&typeof e=="function"?this._arrDrwaingItem.filter(e):Array.from(this._arrDrwaingItem)}getSelectedDrawingItems(){const e=this.fabricCanvas.getActiveObjects(),n=[];for(let o of e)this._arrFabricObject.includes(o)&&n.push(o.getDrawingItem());return n}hasDrawingItem(e){if(!e||!e.isDrawingItem)throw TypeError("Illegal drawing item.");return this._arrDrwaingItem.includes(e)}clearDrawingItems(){this.removeDrawingItems(Array.from(this._arrDrwaingItem))}_setDefaultStyle(e,n,o){n?n.forEach(m=>m.toLowerCase()):n=Tt.arrMediaTypes,o?o.forEach(m=>m.toLowerCase()):o=Tt.arrStyleSelectors;const h=ue.getDrawingStyle(e);if(!h)throw new Error(`The 'drawingStyle' with id '${e}' doesn't exist.`);let g;for(let m of n)if(g=this.mapType_StateAndStyleId.get(m),g)for(let v of o){this._changeMediaTypeCurStyleInStyleSelector(m,v,h,!0),g[v]=e;for(let C of this._arrDrwaingItem)C._mediaType===m&&C._mapState_StyleId.set(v,e)}this.fabricCanvas.renderAll()}setDefaultStyle(e,n,o){const h=[];o&ct.DIMT_RECTANGLE&&h.push("rect"),o&ct.DIMT_QUADRILATERAL&&h.push("quad"),o&ct.DIMT_TEXT&&h.push("text"),o&ct.DIMT_ARC&&h.push("arc"),o&ct.DIMT_IMAGE&&h.push("image"),o&ct.DIMT_POLYGON&&h.push("polygon"),o&ct.DIMT_LINE&&h.push("line");const g=[];n&Ft.DIS_DEFAULT&&g.push("default"),n&Ft.DIS_SELECTED&&g.push("selected"),this._setDefaultStyle(e,h.length?h:null,g.length?g:null)}setMode(e){if((e=e.toLowerCase())==="viewer"){for(let n of this._arrDrwaingItem)n._setEditable(!1);this.fabricCanvas.discardActiveObject(),this.fabricCanvas.renderAll(),this.mode="viewer"}else{if(e!=="editor")throw new RangeError("Invalid value.");for(let n of this._arrDrwaingItem)n._setEditable(!0);this.mode="editor"}this._manager._switchPointerEvent()}getMode(){return this.mode}_setDimensions(e,n){this.fabricCanvas.setDimensions(e,n)}_setObjectFit(e){if(e=e.toLowerCase(),!["contain","cover"].includes(e))throw new Error(`Unsupported value '${e}'.`);this.fabricCanvas.lowerCanvasEl.style.objectFit=e,this.fabricCanvas.upperCanvasEl.style.objectFit=e}_getObjectFit(){return this.fabricCanvas.lowerCanvasEl.style.objectFit}renderAll(){for(let e of this._arrDrwaingItem){const n=this._getItemCurrentStyle(e);this._changeItemStyle(e,n,!0)}this.fabricCanvas.renderAll()}dispose(){this.clearDrawingItems(),this._manager._arrDrawingLayer.length===1&&(this.fabricCanvas.wrapperEl.style.pointerEvents="none",this.fabricCanvas.dispose(),this._arrDrwaingItem.length=0,this._arrFabricObject.length=0)}}Je.DDN_LAYER_ID=1,Je.DBR_LAYER_ID=2,Je.DLR_LAYER_ID=3,Je.USER_DEFINED_LAYER_BASE_ID=100,Je.TIP_LAYER_ID=999;class vd{constructor(){this._arrDrawingLayer=[]}createDrawingLayer(e,n){if(this.getDrawingLayer(n))throw new Error("Existed drawing layer id.");const o=new Je(e,n,{enableRetinaScaling:!1});return o._manager=this,this._arrDrawingLayer.push(o),this._switchPointerEvent(),o}deleteDrawingLayer(e){const n=this.getDrawingLayer(e);if(!n)return;const o=this._arrDrawingLayer;n.dispose(),o.splice(o.indexOf(n),1),this._switchPointerEvent()}clearDrawingLayers(){for(let e of this._arrDrawingLayer)e.dispose();this._arrDrawingLayer.length=0}getDrawingLayer(e){for(let n of this._arrDrawingLayer)if(n.getId()===e)return n;return null}getAllDrawingLayers(){return Array.from(this._arrDrawingLayer)}getSelectedDrawingItems(){if(!this._arrDrawingLayer.length)return;const e=this._arrDrawingLayer[0].fabricCanvas.getActiveObjects(),n=[];for(let o of e)n.push(o.getDrawingItem());return n}setDimensions(e,n){this._arrDrawingLayer.length&&this._arrDrawingLayer[0]._setDimensions(e,n)}setObjectFit(e){for(let n of this._arrDrawingLayer)n&&n._setObjectFit(e)}getObjectFit(){return this._arrDrawingLayer.length?this._arrDrawingLayer[0]._getObjectFit():null}setVisible(e){this._arrDrawingLayer.length&&(this._arrDrawingLayer[0].fabricCanvas.wrapperEl.style.display=e?"block":"none")}_switchPointerEvent(){if(this._arrDrawingLayer.length)for(let e of this._arrDrawingLayer)e.getMode()}}class yd extends pd{constructor(e,n,o,h,g){super(e,{x:n,y:o,width:h,height:0},g),_n.set(this,void 0),rr.set(this,void 0),this._fabricObject.paddingTop=15,this._fabricObject.calcTextHeight=function(){for(var m=0,v=0,C=this._textLines.length;v<C;v++)m+=this.getHeightOfLine(v);return m+=2*this.paddingTop},this._fabricObject._getTopOffset=function(){return-this.height/2+this.getHeightOfLine(0)*(1-1/this.lineHeight)/2+this.paddingTop},this.set("backgroundColor","rgba(50, 50, 52, .8)"),this.set("lineHeight",1.3),this.set("textAlign","center")}setDuration(e){Ee(this,_n,e,"f"),S(this,rr,"f")&&clearTimeout(S(this,rr,"f")),S(this,_n,"f")>=0&&Ee(this,rr,setTimeout(()=>{this.set("visible",!1),this._drawingLayer&&this._drawingLayer.renderAll()},S(this,_n,"f")),"f")}getDuration(){return S(this,_n,"f")}}_n=new WeakMap,rr=new WeakMap;class wd{constructor(){vn.add(this),At.set(this,void 0),sr.set(this,void 0),or.set(this,void 0),ar.set(this,!0),this._drawingLayersManager=new vd}createDrawingLayerBaseCvs(e,n,o="contain"){if(typeof e!="number"||e<=1)throw new Error("Invalid 'width'.");if(typeof n!="number"||n<=1)throw new Error("Invalid 'height'.");if(!["contain","cover"].includes(o))throw new Error("Unsupported 'objectFit'.");const h=document.createElement("canvas");return h.width==e&&h.height==n||(h.width=e,h.height=n),h.style.objectFit=o,h}_createDrawingLayer(e,n,o,h){if(!this._layerBaseCvs){let v;try{v=this.getContentDimensions()}catch(C){if((C.message||C)!=="Invalid content dimensions.")throw C}n||(n=(v==null?void 0:v.width)||1280),o||(o=(v==null?void 0:v.height)||720),h||(h=(v==null?void 0:v.objectFit)||"contain"),this._layerBaseCvs=this.createDrawingLayerBaseCvs(n,o,h)}const g=this._layerBaseCvs,m=this._drawingLayersManager.createDrawingLayer(g,e);return this._innerComponent.getElement("drawing-layer")||this._innerComponent.setElement("drawing-layer",g.parentElement),m}createDrawingLayer(){let e;for(let n=Je.USER_DEFINED_LAYER_BASE_ID;;n++)if(!this._drawingLayersManager.getDrawingLayer(n)&&n!==Je.TIP_LAYER_ID){e=n;break}return this._createDrawingLayer(e)}deleteDrawingLayer(e){var n;this._drawingLayersManager.deleteDrawingLayer(e),this._drawingLayersManager.getAllDrawingLayers().length||((n=this._innerComponent)===null||n===void 0||n.removeElement("drawing-layer"),this._layerBaseCvs=null)}deleteUserDefinedDrawingLayer(e){if(typeof e!="number")throw new TypeError("Invalid id.");if(e<Je.USER_DEFINED_LAYER_BASE_ID)throw new Error(`The drawing layer with id ${e} is not defined by users.`);this.deleteDrawingLayer(e)}_clearDrawingLayers(){const e=this.getAllDrawingLayers();for(let n of e)this.deleteDrawingLayer(n.getId())}clearUserDefinedDrawingLayers(){const e=this.getAllDrawingLayers();for(let n of e){const o=n.getId();o<Je.USER_DEFINED_LAYER_BASE_ID||this.deleteUserDefinedDrawingLayer(o)}}getDrawingLayer(e){return e==Je.TIP_LAYER_ID?null:this._drawingLayersManager.getDrawingLayer(e)||([Je.DDN_LAYER_ID,Je.DBR_LAYER_ID,Je.DLR_LAYER_ID].includes(e)?this._createDrawingLayer(e):null)}getAllDrawingLayers(){return this._drawingLayersManager.getAllDrawingLayers().filter(e=>e.getId()>=0&&e.getId()!==Je.TIP_LAYER_ID)}updateDrawingLayers(e){((n,o,h)=>{if(!(n<=1||o<=1)){if(!["contain","cover"].includes(h))throw new Error("Unsupported 'objectFit'.");this._drawingLayersManager.setDimensions({width:n,height:o},{backstoreOnly:!0}),this._drawingLayersManager.setObjectFit(h)}})(e.width,e.height,e.objectFit)}getSelectedDrawingItems(){return this._drawingLayersManager.getSelectedDrawingItems()}setTipConfig(e){if(!(oh(n=e)&&dd(n.topLeftPoint)&&kn(n.width))||n.width<=0||!kn(n.duration)||"coordinateBase"in n&&!["view","image"].includes(n.coordinateBase))throw new Error("Invalid tip config.");var n;Ee(this,At,JSON.parse(JSON.stringify(e)),"f"),S(this,At,"f").coordinateBase||(S(this,At,"f").coordinateBase="view"),Ee(this,or,e.duration,"f"),S(this,vn,"m",fh).call(this)}getTipConfig(){return S(this,At,"f")?S(this,At,"f"):null}setTipVisible(e){if(typeof e!="boolean")throw new TypeError("Invalid value.");this._tip&&(this._tip.set("visible",e),this._drawingLayerOfTip&&this._drawingLayerOfTip.renderAll()),Ee(this,ar,e,"f")}isTipVisible(){return S(this,ar,"f")}updateTipMessage(e){if(!S(this,At,"f"))throw new Error("Tip config is not set.");this._tipStyleId||(this._tipStyleId=ue.createDrawingStyle({fillStyle:"#FFFFFF",paintMode:"fill",fontFamily:"Open Sans",fontSize:40})),this._drawingLayerOfTip||(this._drawingLayerOfTip=this._drawingLayersManager.getDrawingLayer(Je.TIP_LAYER_ID)||this._createDrawingLayer(Je.TIP_LAYER_ID)),this._tip?this._tip.set("text",e):this._tip=S(this,vn,"m",ch).call(this,e,S(this,At,"f").topLeftPoint.x,S(this,At,"f").topLeftPoint.y,S(this,At,"f").width,S(this,At,"f").coordinateBase,this._tipStyleId),S(this,vn,"m",hh).call(this,this._tip,this._drawingLayerOfTip),this._tip.set("visible",S(this,ar,"f")),this._drawingLayerOfTip&&this._drawingLayerOfTip.renderAll(),S(this,sr,"f")&&clearTimeout(S(this,sr,"f")),S(this,or,"f")>=0&&Ee(this,sr,setTimeout(()=>{S(this,vn,"m",uh).call(this)},S(this,or,"f")),"f")}}At=new WeakMap,sr=new WeakMap,or=new WeakMap,ar=new WeakMap,vn=new WeakSet,ch=function(t,e,n,o,h,g){const m=new yd(t,e,n,o,g);return m.coordinateBase=h,m},hh=function(t,e){e.hasDrawingItem(t)||e.addDrawingItems([t])},uh=function(){this._tip&&this._drawingLayerOfTip.removeDrawingItems([this._tip])},fh=function(){if(!this._tip)return;const t=S(this,At,"f");this._tip.coordinateBase=t.coordinateBase,this._tip.setTextRect({x:t.topLeftPoint.x,y:t.topLeftPoint.y,width:t.width,height:0}),this._tip.set("width",this._tip.get("width")),this._tip._drawingLayer&&this._tip._drawingLayer.renderAll()};class gh extends HTMLElement{constructor(){super(),ts.set(this,void 0);const e=document.createElement("template").content,n=document.createElement("div");n.setAttribute("class","wrapper"),e.appendChild(n),Ee(this,ts,n,"f");const o=document.createElement("slot");o.setAttribute("name","single-frame-input-container"),n.append(o);const h=document.createElement("slot");h.setAttribute("name","content"),n.append(h);const g=document.createElement("slot");g.setAttribute("name","drawing-layer"),n.append(g);const m=document.createElement("style");m.textContent=`
.wrapper {
  position: relative;
  width: 100%;
  height: 100%;
}
::slotted(canvas[slot="content"]) {
  object-fit: contain;
  pointer-events: none;
}
::slotted(div[slot="single-frame-input-container"]) {
  width: 1px;
  height: 1px;
  overflow: hidden;
  pointer-events: none;
}
::slotted(*) {
  position: absolute;
  left: 0;
  top: 0;
  width: 100%;
  height: 100%;
}
    `,e.appendChild(m),this.attachShadow({mode:"open"}).appendChild(e.cloneNode(!0))}getWrapper(){return S(this,ts,"f")}setElement(e,n){if(!(n instanceof HTMLElement))throw new TypeError("Invalid 'el'.");if(!["content","single-frame-input-container","drawing-layer"].includes(e))throw new TypeError("Invalid 'slot'.");this.removeElement(e),n.setAttribute("slot",e),this.appendChild(n)}getElement(e){if(!["content","single-frame-input-container","drawing-layer"].includes(e))throw new TypeError("Invalid 'slot'.");return this.querySelector(`[slot="${e}"]`)}removeElement(e){var n;if(!["content","single-frame-input-container","drawing-layer"].includes(e))throw new TypeError("Invalid 'slot'.");(n=this.querySelectorAll(`[slot="${e}"]`))===null||n===void 0||n.forEach(o=>o.remove())}}ts=new WeakMap,customElements.get("dce-component")||customElements.define("dce-component",gh);class fn extends HTMLElement{constructor(){super();const e=window._dce_default_template.content;this.attachShadow({mode:"open"}).appendChild(e.cloneNode(!0))}showScanLaser(){const e=this.shadowRoot.querySelector(".dce-scanlight");e&&(e.style.display="")}hideScanLaser(){const e=this.shadowRoot.querySelector(".dce-scanlight");e&&(e.style.display="none")}getElement(e){return this.shadowRoot.querySelector(e)}getVideoContainer(){return this.shadowRoot.querySelector(".dce-video-container")}getScanAreaEl(){return this.shadowRoot.querySelector(".dce-scanarea")}getScanLightEl(){return this.shadowRoot.querySelector(".dce-scanlight")}getLoadingBackgroundEl(){return this.shadowRoot.querySelector(".dce-bg-loading")}getCameraBackgroundEl(){return this.shadowRoot.querySelector(".dce-bg-camera")}getCameraSelectEl(){return this.shadowRoot.querySelector(".dce-sel-camera")}getResolutionSelectEl(){return this.shadowRoot.querySelector(".dce-sel-resolution")}getResolutionOptionEl(){return this.shadowRoot.querySelector(".dce-opt-gotResolution")}getCloseBtnEl(){return this.shadowRoot.querySelector(".dce-btn-close")}getDLRSelectEl(){return this.shadowRoot.querySelector(".dlr-sel-minletter")}getDLROptionEl(){return this.shadowRoot.querySelector(".dlr-opt-gotMinLtr")}}class it extends wd{static get engineResourcePath(){return ot.engineResourcePaths.dce}static set defaultUIElementURL(e){it._defaultUIElementURL=e}static get defaultUIElementURL(){var e;return(e=it._defaultUIElementURL)===null||e===void 0?void 0:e.replace("@engineResourcePath/",it.engineResourcePath)}static async createInstance(e){customElements.get(it.uiComponentName)||customElements.define(it.uiComponentName,fn);const n=new it;return await n.setUIElement(e||it.defaultUIElementURL),n}static _transformCoordinates(e,n,o,h,g,m,v){const C=m/h,E=v/g;e.x=Math.round(e.x/C+n),e.y=Math.round(e.y/E+o)}set _singleFrameMode(e){if(!["disabled","image","camera"].includes(e))throw new Error("Invalid value.");e!==S(this,ur,"f")&&(this._unbindUI(),Ee(this,ur,e,"f"),this._bindUI())}get _singleFrameMode(){return S(this,ur,"f")}get disposed(){return S(this,$o,"f")}constructor(){super(),Ze.add(this),lr.set(this,void 0),cr.set(this,void 0),hr.set(this,void 0),this.containerClassName="dce-video-container",lt.set(this,void 0),this.videoFit="contain",this._hideDefaultSelection=!1,this._divScanArea=null,this._divScanLight=null,this._bgLoading=null,this._selCam=null,this._bgCamera=null,this._selRsl=null,this._optGotRsl=null,this._btnClose=null,this._selMinLtr=null,this._optGotMinLtr=null,is.set(this,null),this.regionMaskFillStyle="rgba(0,0,0,0.5)",this.regionMaskStrokeStyle="rgb(254,142,20)",this.regionMaskLineWidth=6,ns.set(this,!1),rs.set(this,!1),Si.set(this,{width:0,height:0}),this._updateLayersTimeout=500,this._videoResizeListener=()=>{S(this,Ze,"m",dr).call(this),this._updateLayersTimeoutId&&clearTimeout(this._updateLayersTimeoutId),this._updateLayersTimeoutId=setTimeout(()=>{this.disposed||(this.eventHandler.fire("videoEl:resized",null,{async:!1}),this.eventHandler.fire("content:updated",null,{async:!1}),this.isScanLaserVisible()&&S(this,Ze,"m",Zo).call(this))},this._updateLayersTimeout)},this._windowResizeListener=()=>{it._onLog&&it._onLog("window resize event triggered."),S(this,Si,"f").width===document.documentElement.clientWidth&&S(this,Si,"f").height===document.documentElement.clientHeight||(S(this,Si,"f").width=document.documentElement.clientWidth,S(this,Si,"f").height=document.documentElement.clientHeight,this._videoResizeListener())},ur.set(this,"disabled"),this._clickIptSingleFrameMode=()=>{if(!S(this,Ze,"m",Ut).call(this))return;let e;if(this._singleFrameInputContainer)e=this._singleFrameInputContainer.firstElementChild;else{e=document.createElement("input"),e.setAttribute("type","file"),this._singleFrameMode==="camera"?(e.setAttribute("capture",""),e.setAttribute("accept","image/*")):this._singleFrameMode==="image"&&(e.removeAttribute("capture"),e.setAttribute("accept",".jpg,.jpeg,.icon,.gif,.svg,.webp,.png,.bmp")),e.addEventListener("change",async()=>{const o=e.files[0];e.value="";{const h=async L=>{let N=null,Y=null;if(typeof createImageBitmap<"u")try{if(N=await createImageBitmap(L),N)return N}catch{}var X;return N||(Y=await(X=L,new Promise((K,J)=>{let te=URL.createObjectURL(X),ne=new Image;ne.src=te,ne.onload=()=>{URL.revokeObjectURL(ne.src),K(ne)},ne.onerror=pe=>{J(new Error("Can't convert blob to image : "+(pe instanceof Event?pe.type:pe)))}}))),Y},g=(L,N,Y,X)=>{L.width==Y&&L.height==X||(L.width=Y,L.height=X);const K=L.getContext("2d");K.clearRect(0,0,L.width,L.height),K.drawImage(N,0,0)},m=await h(o),v=m instanceof HTMLImageElement?m.naturalWidth:m.width,C=m instanceof HTMLImageElement?m.naturalHeight:m.height;let E=this._cvsSingleFrameMode;const I=E==null?void 0:E.width,R=E==null?void 0:E.height;E||(E=document.createElement("canvas"),this._cvsSingleFrameMode=E),g(E,m,v,C),this._innerComponent.setElement("content",E),I===E.width&&R===E.height||this.eventHandler.fire("content:updated",null,{async:!1})}this._onSingleFrameAcquired&&setTimeout(()=>{this._onSingleFrameAcquired(this._cvsSingleFrameMode)},0)}),e.style.position="absolute",e.style.top="-9999px",e.style.backgroundColor="transparent",e.style.color="transparent";const n=document.createElement("div");n.append(e),this._innerComponent.setElement("single-frame-input-container",n),this._singleFrameInputContainer=n}e==null||e.click()},this.extraBindings=[],fr.set(this,[]),this._capturedResultReceiver={onCapturedResultReceived:(e,n)=>{var o,h,g,m;if(this.disposed||(this.clearAllInnerDrawingItems(),!e))return;const v=e.originalImageTag;if(!v)return;const C=e.items;if(!(C!=null&&C.length))return;const E=((o=v.cropRegion)===null||o===void 0?void 0:o.left)||0,I=((h=v.cropRegion)===null||h===void 0?void 0:h.top)||0,R=!((g=v.cropRegion)===null||g===void 0)&&g.right?v.cropRegion.right-E:v.originalWidth,L=!((m=v.cropRegion)===null||m===void 0)&&m.bottom?v.cropRegion.bottom-I:v.originalHeight,N=v.currentWidth,Y=v.currentHeight,X=(te,ne,pe,he,le,be,y,_e,Ce=[],ge)=>{ne.forEach(s=>it._transformCoordinates(s,pe,he,le,be,y,_e));const l=new md({points:[{x:ne[0].x,y:ne[0].y},{x:ne[1].x,y:ne[1].y},{x:ne[2].x,y:ne[2].y},{x:ne[3].x,y:ne[3].y}]},ge);for(let s of Ce)l.addNote(s);te.addDrawingItems([l]),S(this,fr,"f").push(l)};let K,J;for(let te of C)switch(te.type){case Se.CRIT_ORIGINAL_IMAGE:break;case Se.CRIT_BARCODE:K=this.getDrawingLayer(Je.DBR_LAYER_ID),J=[{name:"format",content:te.formatString},{name:"text",content:te.text}],n!=null&&n.isBarcodeVerifyOpen?te.verified?X(K,te.location.points,E,I,R,L,N,Y,J):X(K,te.location.points,E,I,R,L,N,Y,J,ue.STYLE_ORANGE_STROKE_TRANSPARENT):X(K,te.location.points,E,I,R,L,N,Y,J);break;case Se.CRIT_TEXT_LINE:K=this.getDrawingLayer(Je.DLR_LAYER_ID),J=[{name:"text",content:te.text}],n.isLabelVerifyOpen?te.verified?X(K,te.location.points,E,I,R,L,N,Y,J):X(K,te.location.points,E,I,R,L,N,Y,J,ue.STYLE_GREEN_STROKE_TRANSPARENT):X(K,te.location.points,E,I,R,L,N,Y,J);break;case Se.CRIT_DETECTED_QUAD:K=this.getDrawingLayer(Je.DDN_LAYER_ID),n!=null&&n.isDetectVerifyOpen?te.verified?X(K,te.location.points,E,I,R,L,N,Y,[]):X(K,te.location.points,E,I,R,L,N,Y,[],ue.STYLE_BLUE_STROKE_TRANSPARENT):X(K,te.location.points,E,I,R,L,N,Y,[]);break;case Se.CRIT_NORMALIZED_IMAGE:K=this.getDrawingLayer(Je.DDN_LAYER_ID),n!=null&&n.isNormalizeVerifyOpen?te.verified?X(K,te.location.points,E,I,R,L,N,Y,[]):X(K,te.location.points,E,I,R,L,N,Y,[],ue.STYLE_BLUE_STROKE_TRANSPARENT):X(K,te.location.points,E,I,R,L,N,Y,[]);break;case Se.CRIT_PARSED_RESULT:break;default:throw new Error("Illegal item type.")}}},$o.set(this,!1),this.eventHandler=new ah,this.eventHandler.on("content:updated",()=>{S(this,lr,"f")&&clearTimeout(S(this,lr,"f")),Ee(this,lr,setTimeout(()=>{if(this.disposed)return;let e;this._updateVideoContainer();try{e=this.getContentDimensions()}catch(n){if((n.message||n)==="Invalid content dimensions.")return;throw n}this.updateDrawingLayers(e),this.updateConvertedRegion(e)},0),"f")}),this.eventHandler.on("videoEl:resized",()=>{S(this,cr,"f")&&clearTimeout(S(this,cr,"f")),Ee(this,cr,setTimeout(()=>{this.disposed||this._updateVideoContainer()},0),"f")})}_setUIElement(e){e instanceof HTMLTemplateElement?(window._dce_default_template=e,this.UIElement=new fn):this.UIElement=e,this._unbindUI(),this._bindUI()}async setUIElement(e){let n;if(n=typeof e=="string"?await Ul(e):e,n instanceof HTMLDivElement&&n.childElementCount==0){const o=await Ul(it.defaultUIElementURL);o instanceof HTMLTemplateElement?(window._dce_default_template=o,n.append(new fn)):n.append(o),this._setUIElement(n)}else this._setUIElement(n)}getUIElement(){return this.UIElement}_bindUI(){var e;if(!this.UIElement)throw new Error("Need to set 'UIElement'.");if(this._innerComponent)return;let n,o=this.UIElement;if(o instanceof fn?n=o.getElement(`.${this.containerClassName}`):o instanceof HTMLDivElement&&o.childElementCount===1&&o.firstElementChild instanceof fn?(n=o.firstElementChild.getElement(`.${this.containerClassName}`),o=o.firstElementChild):n=o.classList.contains(this.containerClassName)?o:o.querySelector(`.${this.containerClassName}`),!n)throw Error(`Can not find the element with class '${this.containerClassName}'.`);if(this._innerComponent=new gh,n.appendChild(this._innerComponent),!S(this,Ze,"m",Ut).call(this)){const h=document.createElement("video");h.style.position="absolute",h.style.left="0",h.style.top="0",h.style.width="100%",h.style.height="100%",h.style.objectFit=this.getVideoFit(),h.setAttribute("autoplay","true"),h.setAttribute("playsinline","true"),h.setAttribute("muted","true"),["iPhone","iPad","Mac"].includes(gt.OS)&&h.setAttribute("poster","data:image/gif;base64,R0lGODlhAQABAIEAAAAAAAAAAAAAAAAAACH5BAEAAAAALAAAAAABAAEAAAgEAAEEBAA7"),Ee(this,lt,h,"f");const g=document.createElement("div");g.append(h),g.style.overflow="hidden",this._videoContainer=g,this._innerComponent.setElement("content",g)}if(o instanceof fn?(this._selRsl=o.getElement(".dce-sel-resolution"),this._selMinLtr=o.getElement(".dlr-sel-minletter"),this._divScanArea=o.getElement(".dce-scanarea"),this._divScanLight=o.getElement(".dce-scanlight"),this._bgLoading=o.getElement(".dce-bg-loading"),this._bgCamera=o.getElement(".dce-bg-camera"),this._selCam=o.getElement(".dce-sel-camera"),this._optGotRsl=o.getElement(".dce-opt-gotResolution"),this._btnClose=o.getElement(".dce-btn-close"),this._optGotMinLtr=o.getElement(".dlr-opt-gotMinLtr")):(this._selRsl=o.querySelector(".dce-sel-resolution"),this._selMinLtr=o.querySelector(".dlr-sel-minletter"),this._divScanArea=o.querySelector(".dce-scanarea"),this._divScanLight=o.querySelector(".dce-scanlight"),this._bgLoading=o.querySelector(".dce-bg-loading"),this._bgCamera=o.querySelector(".dce-bg-camera"),this._selCam=o.querySelector(".dce-sel-camera"),this._optGotRsl=o.querySelector(".dce-opt-gotResolution"),this._btnClose=o.querySelector(".dce-btn-close"),this._optGotMinLtr=o.querySelector(".dlr-opt-gotMinLtr")),this._selRsl&&(this._hideDefaultSelection||S(this,Ze,"m",Ut).call(this)||this._selRsl.options.length||(this._selRsl.innerHTML=['<option class="dce-opt-gotResolution" value="got"></option>','<option data-width="1920" data-height="1080">ask 1920x1080</option>','<option data-width="1280" data-height="720">ask 1280x720</option>','<option data-width="640" data-height="480">ask 640x480</option>'].join(""),this._optGotRsl=this._selRsl.options[0])),this._selMinLtr&&(this._hideDefaultSelection||S(this,Ze,"m",Ut).call(this)||this._selMinLtr.options.length||(this._selMinLtr.innerHTML=['<option class="dlr-opt-gotMinLtr" value="got"></option>','<option value="0" selected>any letter</option>','<option value="3">3+ letters</option>','<option value="5">5+ letters</option>','<option value="8">8+ letters</option>','<option value="12">12+ letters</option>','<option value="17">17+ letters</option>','<option value="30">30+ letters</option>','<option value="50">50+ letters</option>','<option value="80">80+ letters</option>','<option value="120">120+ letters</option>'].join(""),this._optGotMinLtr=this._selMinLtr.options[0])),this.isScanLaserVisible()||S(this,Ze,"m",dr).call(this),S(this,Ze,"m",Ut).call(this)||this._hideDefaultSelection?(S(this,Ze,"m",Ut).call(this)&&(this._innerComponent&&(this._innerComponent.addEventListener("click",this._clickIptSingleFrameMode),this._innerComponent.setAttribute("title","Take a photo")),this._bgCamera&&(this._bgCamera.style.display="block")),this._selCam&&(this._selCam.style.display="none"),this._selRsl&&(this._selRsl.style.display="none"),this._selMinLtr&&(this._selMinLtr.style.display="none")):(this._selCam&&(this._selCam.style.display="block"),this._selRsl&&(this._selRsl.style.display="block"),this._selMinLtr&&(this._selMinLtr.style.display="block"),this._stopLoading()),window.ResizeObserver){this._resizeObserver||(this._resizeObserver=new ResizeObserver(g=>{var m;it._onLog&&it._onLog("resize observer triggered.");for(let v of g)v.target===((m=this._innerComponent)===null||m===void 0?void 0:m.getWrapper())&&this._videoResizeListener()}));const h=(e=this._innerComponent)===null||e===void 0?void 0:e.getWrapper();h&&this._resizeObserver.observe(h)}S(this,Si,"f").width=document.documentElement.clientWidth,S(this,Si,"f").height=document.documentElement.clientHeight,window.addEventListener("resize",this._windowResizeListener)}_unbindUI(){var e,n,o,h;S(this,Ze,"m",Ut).call(this)?(this._innerComponent&&(this._innerComponent.removeEventListener("click",this._clickIptSingleFrameMode),this._innerComponent.removeAttribute("title")),this._bgCamera&&(this._bgCamera.style.display="none")):this._stopLoading(),S(this,Ze,"m",dr).call(this),(e=this._drawingLayersManager)===null||e===void 0||e.clearDrawingLayers(),(n=this._innerComponent)===null||n===void 0||n.removeElement("drawing-layer"),this._layerBaseCvs=null,this._drawingLayerOfMask=null,this._drawingLayerOfTip=null,(o=this._innerComponent)===null||o===void 0||o.remove(),this._innerComponent=null,Ee(this,lt,null,"f"),(h=this._videoContainer)===null||h===void 0||h.remove(),this._videoContainer=null,this._selCam=null,this._selRsl=null,this._optGotRsl=null,this._btnClose=null,this._selMinLtr=null,this._optGotMinLtr=null,this._divScanArea=null,this._divScanLight=null,this._singleFrameInputContainer&&(this._singleFrameInputContainer.remove(),this._singleFrameInputContainer=null),window.ResizeObserver&&this._resizeObserver&&this._resizeObserver.disconnect(),window.removeEventListener("resize",this._windowResizeListener)}_startLoading(){this._bgLoading&&(this._bgLoading.style.display="",this._bgLoading.style.animationPlayState="")}_stopLoading(){this._bgLoading&&(this._bgLoading.style.display="none",this._bgLoading.style.animationPlayState="paused")}_renderCamerasInfo(e,n){if(!this._selCam)return;let o;this._selCam.textContent="";for(let h of n){const g=document.createElement("option");g.value=h.deviceId,g.innerText=h.label,this._selCam.append(g),h.deviceId&&e&&e.deviceId==h.deviceId&&(o=g)}this._selCam.value=o?o.value:""}_renderResolutionInfo(e){this._optGotRsl&&(this._optGotRsl.setAttribute("data-width",e.width),this._optGotRsl.setAttribute("data-height",e.height),this._optGotRsl.innerText="got "+e.width+"x"+e.height,this._selRsl&&this._optGotRsl.parentNode==this._selRsl&&(this._selRsl.value="got"))}getVideoElement(){return S(this,lt,"f")}isVideoLoaded(){return!!S(this,lt,"f")&&S(this,lt,"f").readyState==4}setVideoFit(e){if(e=e.toLowerCase(),!["contain","cover"].includes(e))throw new Error(`Unsupported value '${e}'.`);if(this.videoFit=e,!S(this,lt,"f")||(S(this,lt,"f").style.objectFit=e,S(this,Ze,"m",Ut).call(this)))return;let n;this._updateVideoContainer();try{n=this.getContentDimensions()}catch(o){if((o.message||o)==="Invalid content dimensions.")return;throw o}S(this,Ze,"m",os).call(this,n,this.getConvertedRegion()),this.updateDrawingLayers(n)}getVideoFit(){return this.videoFit}getContentDimensions(){var e,n,o,h;let g,m,v;if(S(this,Ze,"m",Ut).call(this)?(g=(o=this._cvsSingleFrameMode)===null||o===void 0?void 0:o.width,m=(h=this._cvsSingleFrameMode)===null||h===void 0?void 0:h.height,v="contain"):(g=(e=S(this,lt,"f"))===null||e===void 0?void 0:e.videoWidth,m=(n=S(this,lt,"f"))===null||n===void 0?void 0:n.videoHeight,v=this.getVideoFit()),!g||!m)throw new Error("Invalid content dimensions.");return{width:g,height:m,objectFit:v}}updateConvertedRegion(e){const n=Qr.convert(this.scanRegion,e.width,e.height);Ee(this,is,n,"f"),S(this,hr,"f")&&clearTimeout(S(this,hr,"f")),Ee(this,hr,setTimeout(()=>{let o;try{o=this.getContentDimensions()}catch(h){if((h.message||h)==="Invalid content dimensions.")return;throw h}S(this,Ze,"m",ss).call(this,o,n),S(this,Ze,"m",os).call(this,o,n)},0),"f")}getConvertedRegion(){return S(this,is,"f")}setScanRegion(e){if(e!=null&&!Pa(e)&&!on(e))throw TypeError("Invalid 'region'.");let n;this.scanRegion=e?JSON.parse(JSON.stringify(e)):null;try{n=this.getContentDimensions()}catch(o){if((o.message||o)==="Invalid content dimensions.")return;throw o}this.updateConvertedRegion(n)}getScanRegion(){return JSON.parse(JSON.stringify(this.scanRegion))}getVisibleRegionOfVideo(e){if(!this.isVideoLoaded())throw new Error("The video is not loaded.");const n=S(this,lt,"f").videoWidth,o=S(this,lt,"f").videoHeight,h=this.getVideoFit(),{width:g,height:m}=this._innerComponent.getBoundingClientRect();if(g<=0||m<=0)throw new Error("Unable to get video dimensions. Video may not be rendered on the page.");let v;const C={x:0,y:0,width:n,height:o,isMeasuredInPercentage:!1};if(h==="cover"&&(g/m<n/o?(v=m/o,C.x=Math.floor((n-g/v)/2),C.y=0,C.width=Math.ceil(g/v),C.height=o):(v=g/n,C.x=0,C.y=Math.floor((o-m/v)/2),C.width=n,C.height=Math.ceil(m/v))),e==null?void 0:e.inPixels)return C;const E=C;return E.x=Math.ceil(E.x/o*100),E.y=Math.ceil(E.y/n*100),E.width=Math.floor(E.width/n*100),E.height=Math.floor(E.height/o*100),E.isMeasuredInPercentage=!0,C}setScanRegionMask(e,n,o,h){this._drawingLayerOfMask||(this._drawingLayerOfMask=this._createDrawingLayer(-2),this.isScanRegionMaskVisible()||S(this,Ze,"m",Ko).call(this)),this.clearScanRegionMask(),this._maskBackRectStyleId||(this._maskBackRectStyleId=ue.createDrawingStyle({paintMode:"fill",fillStyle:this.regionMaskFillStyle,lineWidth:0})),this._maskCenterRectStyleId||(this._maskCenterRectStyleId=ue.createDrawingStyle({paintMode:"stroke",strokeStyle:this.regionMaskStrokeStyle,lineWidth:this.regionMaskLineWidth}));const g=this._drawingLayerOfMask.width,m=this._drawingLayerOfMask.height,v=new un({x:0,y:0,width:g,height:m},this._maskBackRectStyleId),C=new un({x:-g/2,y:-m/2+n,width:e,height:h}),E=new un({x:-g/2+e+o,y:-m/2+n,width:g-e-o<0?0:g-e-o,height:h}),I=new un({x:-g/2,y:-m/2,width:g,height:n}),R=new un({x:-g/2,y:-m/2+n+h,width:g,height:m-n-h<0?0:m-n-h});C.set("strokeWidth",0),E.set("strokeWidth",0),I.set("strokeWidth",0),R.set("strokeWidth",0);const L=new _d([C,E,I,R])._getFabricObject();v.set("clipPath",L);const N=new un({x:e,y:n,width:o,height:h},this._maskCenterRectStyleId);this._drawingLayerOfMask.addDrawingItems([v,N])}clearScanRegionMask(){this._drawingLayerOfMask&&this._drawingLayerOfMask.clearDrawingItems()}deleteScanRegionMask(){this._drawingLayerOfMask&&this.deleteDrawingLayer(this._drawingLayerOfMask.getId())}_setScanRegionMaskVisible(e){Ee(this,ns,e,"f"),e?S(this,Ze,"m",dh).call(this):S(this,Ze,"m",Ko).call(this)}setScanRegionMaskVisible(e){this._setScanRegionMaskVisible(e),this._userSetMaskVisible=e}isScanRegionMaskVisible(){return S(this,ns,"f")}setScanRegionMaskStyle(e){if(!e)return;let n;e.fillStyle&&(this.regionMaskFillStyle=e.fillStyle),e.strokeStyle&&(this.regionMaskStrokeStyle=e.strokeStyle),e.lineWidth&&(this.regionMaskLineWidth=e.lineWidth),this._maskBackRectStyleId&&ue.updateDrawingStyle(this._maskBackRectStyleId,{fillStyle:this.regionMaskFillStyle}),this._maskCenterRectStyleId&&ue.updateDrawingStyle(this._maskCenterRectStyleId,{strokeStyle:this.regionMaskStrokeStyle,lineWidth:this.regionMaskLineWidth});try{n=this.getContentDimensions()}catch(o){if((o.message||o)==="Invalid content dimensions.")return;throw o}S(this,Ze,"m",ss).call(this,n,this.getConvertedRegion())}getScanRegionMaskStyle(){return{fillStyle:this.regionMaskFillStyle,strokeStyle:this.regionMaskStrokeStyle,lineWidth:this.regionMaskLineWidth}}_setScanLaserVisible(e){Ee(this,rs,e,"f"),e?S(this,Ze,"m",Zo).call(this):S(this,Ze,"m",dr).call(this)}setScanLaserVisible(e){this._setScanLaserVisible(e),this._userSetLaserVisible=e}isScanLaserVisible(){return S(this,rs,"f")}_updateVideoContainer(){if(!S(this,lt,"f")||S(this,Ze,"m",Ut).call(this))return;let e=1;const n=S(this,lt,"f").style.transform.match(/scale\((.+)\)/);n&&(e=parseFloat(n[1]));const o=this._videoContainer;if(this.videoFit==="contain"&&e>1){const h=S(this,lt,"f").videoWidth,g=S(this,lt,"f").videoHeight,{width:m,height:v}=this._innerComponent.getBoundingClientRect(),C=h/g;if(m/v<C){let E=m/C;o.style.left="0",o.style.top=(v-E)/2/v*100+"%",o.style.width="100%",o.style.height=E/v*100+"%"}else{let E=v*C;o.style.left=(m-E)/2/m*100+"%",o.style.top="0",o.style.width=E/m*100+"%",o.style.height="100%"}}else o.style.left="0",o.style.top="0",o.style.width="100%",o.style.height="100%"}updateLayers(){let e;this._updateVideoContainer();try{e=this.getContentDimensions()}catch(o){if((o.message||o)==="Invalid content dimensions.")return;throw o}const n=this.getConvertedRegion();S(this,Ze,"m",os).call(this,e,n),this.updateDrawingLayers(e),S(this,Ze,"m",ss).call(this,e,n)}clearAllInnerDrawingItems(){S(this,fr,"f").forEach(e=>e.remove()),S(this,fr,"f").length=0}dispose(){this._unbindUI(),delete window._dce_default_template,this.__proto__=null;for(let e in this)delete this[e];Object.defineProperty(this,"disposed",{value:!0})}}lr=new WeakMap,cr=new WeakMap,hr=new WeakMap,lt=new WeakMap,is=new WeakMap,ns=new WeakMap,rs=new WeakMap,Si=new WeakMap,ur=new WeakMap,fr=new WeakMap,$o=new WeakMap,Ze=new WeakSet,Ut=function(){return this._singleFrameMode!=="disabled"},ss=function(t,e){e&&(e.x!==0||e.y!==0||e.width!==t.width||e.height!==t.height)?this.setScanRegionMask(e.x,e.y,e.width,e.height):this.clearScanRegionMask()},dh=function(){this._drawingLayerOfMask&&this._drawingLayerOfMask.setVisible(!0)},Ko=function(){this._drawingLayerOfMask&&this._drawingLayerOfMask.setVisible(!1)},Zo=function(){this._divScanLight&&this._divScanLight.style.display=="none"&&(this._divScanLight.style.display="block")},dr=function(){this._divScanLight&&(this._divScanLight.style.display="none")},os=function(t,e){if(!this._divScanArea||!this._innerComponent.getElement("content"))return;const{width:n,height:o,objectFit:h}=t;e||(e={x:0,y:0,width:n,height:o});const{width:g,height:m}=this._innerComponent.getBoundingClientRect();if(g<=0||m<=0)return;const v=g/m,C=n/o;let E,I,R,L,N=1;if(h==="contain")v<C?(N=g/n,E=0,I=(m-o*N)/2):(N=m/o,E=(g-n*N)/2,I=0),E+=e.x*N,I+=e.y*N,R=e.width*N,L=e.height*N;else if(h==="cover")if(v<C){N=m/o,E=e.x*N-(n*N-g)/2,E=Math.max(E,0),E=Math.min(E,g),I=e.y*N;let Y=(e.x+e.width)*N-(n*N-g)/2;Y=Math.max(Y,0),Y=Math.min(Y,g),R=Y-E,L=e.height*N}else{N=g/n,E=e.x*N,I=e.y*N-(o*N-m)/2,I=Math.max(I,0),I=Math.min(I,m);let Y=(e.y+e.height)*N-(o*N-m)/2;Y=Math.max(Y,0),Y=Math.min(Y,m),R=e.width*N,L=Y-I}else E=0,I=0,R=0,L=0;this._divScanArea.style.left=E+"px",this._divScanArea.style.top=I+"px",this._divScanArea.style.width=R+"px",this._divScanArea.style.height=L+"px"},it.uiComponentName="default-camera-view",it._defaultUIElementURL="@engineResourcePath/dce.ui.html";function j(t,e,n,o){if(n==="a"&&!o)throw new TypeError("Private accessor was defined without a getter");if(typeof e=="function"?t!==e||!o:!e.has(t))throw new TypeError("Cannot read private member from an object whose class did not declare it");return n==="m"?o:n==="a"?o.call(t):o?o.value:e.get(t)}function Fe(t,e,n,o,h){if(o==="m")throw new TypeError("Private method is not writable");if(o==="a"&&!h)throw new TypeError("Private accessor was defined without a setter");if(typeof e=="function"?t!==e||!h:!e.has(t))throw new TypeError("Cannot write private member to an object whose class did not declare it");return o==="a"?h.call(t,n):h?h.value=n:e.set(t,n),n}const Hl=typeof self>"u";let Zn,qn,Wr,vo,tt;function _t(t,e,n,o){if(n==="a"&&!o)throw new TypeError("Private accessor was defined without a getter");if(typeof e=="function"?t!==e||!o:!e.has(t))throw new TypeError("Cannot read private member from an object whose class did not declare it");return n==="m"?o:n==="a"?o.call(t):o?o.value:e.get(t)}function Nt(t,e,n,o,h){if(o==="m")throw new TypeError("Private method is not writable");if(o==="a"&&!h)throw new TypeError("Private accessor was defined without a setter");if(typeof e=="function"?t!==e||!h:!e.has(t))throw new TypeError("Cannot write private member to an object whose class did not declare it");return o==="a"?h.call(t,n):h?h.value=n:e.set(t,n),n}typeof navigator<"u"&&(Zn=navigator,qn=Zn.userAgent,Wr=Zn.platform,vo=Zn.mediaDevices),function(){if(!Hl){const t={Edge:{search:"Edg",verSearch:"Edg"},OPR:null,Chrome:null,Safari:{str:Zn.vendor,search:"Apple",verSearch:["Version","iPhone OS","CPU OS"]},Firefox:null,Explorer:{search:"MSIE",verSearch:"MSIE"}},e={HarmonyOS:null,Android:null,iPhone:null,iPad:null,Windows:{str:Wr,search:"Win"},Mac:{str:Wr},Linux:{str:Wr}};let n="unknownBrowser",o=0,h="unknownOS";for(let g in t){const m=t[g]||{};let v=m.str||qn,C=m.search||g,E=m.verStr||qn,I=m.verSearch||g;if(I instanceof Array||(I=[I]),v.indexOf(C)!=-1){n=g;for(let R of I){let L=E.indexOf(R);if(L!=-1){o=parseFloat(E.substring(L+R.length+1));break}}break}}for(let g in e){const m=e[g]||{};let v=m.str||qn,C=m.search||g;if(v.indexOf(C)!=-1){h=g;break}}h=="Linux"&&qn.indexOf("Windows NT")!=-1&&(h="HarmonyOS"),tt={browser:n,version:o,OS:h}}Hl&&(tt={browser:"ssr",version:0,OS:"ssr"})}(),vo&&vo.getUserMedia,tt.browser==="Chrome"&&tt.version>66||tt.browser==="Safari"&&tt.version>13||tt.browser==="OPR"&&tt.version>43||tt.browser==="Edge"&&tt.version,typeof SuppressedError=="function"&&SuppressedError;class Ot{static multiply(e,n){const o=[];for(let h=0;h<3;h++){const g=n.slice(3*h,3*h+3);for(let m=0;m<3;m++){const v=[e[m],e[m+3],e[m+6]].reduce((C,E,I)=>C+E*g[I],0);o.push(v)}}return o}static identity(){return[1,0,0,0,1,0,0,0,1]}static translate(e,n,o){return Ot.multiply(e,[1,0,0,0,1,0,n,o,1])}static rotate(e,n){var o=Math.cos(n),h=Math.sin(n);return Ot.multiply(e,[o,-h,0,h,o,0,0,0,1])}static scale(e,n,o){return Ot.multiply(e,[n,0,0,0,o,0,0,0,1])}}var Be,ni,ri,as,yn,gr,pr,wn,ls;(function(t){t.GREY="grey",t.GREY32="grey32",t.RGBA="rgba",t.RBGA="rbga",t.GRBA="grba",t.GBRA="gbra",t.BRGA="brga",t.BGRA="bgra"})(Be||(Be={}));class Ie{static get version(){return"1.1.1-0"}static checkWebGLSupport(){return document.createElement("canvas").getContext("webgl")===null?(Nt(Ie,ni,!1,"f",ri),!1):(Nt(Ie,ni,!0,"f",ri),!0)}get disposed(){return _t(this,ls,"f")}constructor(){as.set(this,Be.RGBA),yn.set(this,null),gr.set(this,null),pr.set(this,null),this.useWebGLByDefault=!0,this._reusedCvs=null,this._reusedWebGLCvs=null,wn.set(this,null),ls.set(this,!1)}drawImage(e,n,o,h,g,m){if(this.disposed)throw Error("The 'ImageDataGetter' instance has been disposed.");if(!o||!h)throw new Error("Invalid 'sourceWidth' or 'sourceHeight'.");if(_t(Ie,ni,"f",ri)==null&&Ie.checkWebGLSupport(),(m==null?void 0:m.bUseWebGL)&&!_t(Ie,ni,"f",ri))throw new Error("Your browser or machine may not support WebGL.");if(n instanceof HTMLVideoElement&&n.readyState!==4||n instanceof HTMLImageElement&&!n.complete)throw new Error("The source is not loaded.");let v;Ie._onLog&&(v=Date.now(),Ie._onLog("drawImage(), START: "+v));let C=0,E=0,I=o,R=h,L=0,N=0,Y=o,X=h;g&&(g.sx&&(C=Math.round(g.sx)),g.sy&&(E=Math.round(g.sy)),g.sWidth&&(I=Math.round(g.sWidth)),g.sHeight&&(R=Math.round(g.sHeight)),g.dx&&(L=Math.round(g.dx)),g.dy&&(N=Math.round(g.dy)),g.dWidth&&(Y=Math.round(g.dWidth)),g.dHeight&&(X=Math.round(g.dHeight)));let K,J=Be.RGBA;if(m!=null&&m.pixelFormat&&(J=m.pixelFormat),(m==null?void 0:m.bufferContainer)&&(K=m.bufferContainer,K.length<4*Y*X))throw new Error("Unexpected size of the 'bufferContainer'.");const te=e;if(!_t(Ie,ni,"f",ri)||!(this.useWebGLByDefault&&(m==null?void 0:m.bUseWebGL)==null||m!=null&&m.bUseWebGL)){Ie._onLog&&Ie._onLog("drawImage() in context2d."),te.ctx2d||(te.ctx2d=te.getContext("2d",{willReadFrequently:!0}));const ne=te.ctx2d;if(!ne)throw new Error("Unable to get 'CanvasRenderingContext2D' from canvas.");return(te.width<L+Y||te.height<N+X)&&(te.width=L+Y,te.height=N+X),ne.drawImage(n,C,E,I,R,L,N,Y,X),Ie._onLog&&Ie._onLog("drawImage() in context2d end. Costs: "+(Date.now()-v)),{context:ne,pixelFormat:Be.RGBA,bUseWebGL:!1}}Ie._onLog&&Ie._onLog("drawImage() in WebGL.");try{(te.width<L+Y||te.height<N+X)&&(te.width=L+Y,te.height=N+X,te.ctxWebGL&&te.ctxWebGL.viewport(0,0,L+Y,N+X));const ne=te.ctxWebGL||te.getContext("webgl",{antialias:!1})||te.getContext("experimental-webgl",{antialias:!1});if(!ne){Ie._onLog&&Ie._onLog("Browser or machine may not support WebGL, or the canvas has already been set to a different context mode.");const y=new Error("Unable to get 'WebGLRenderingContext'. Your browser or machine may not support WebGL, or the canvas has already been set to a different context mode.");throw y.name="WebGLError",y}if(!te.ctxWebGL||J!==_t(this,as,"f")){te.ctxWebGL=ne;const y=i=>{const r=i.createBuffer();i.bindBuffer(i.ARRAY_BUFFER,r),i.bufferData(i.ARRAY_BUFFER,new Float32Array([0,0,0,1,1,0,1,0,0,1,1,1]),i.STATIC_DRAW);const c=i.createBuffer();return i.bindBuffer(i.ARRAY_BUFFER,c),i.bufferData(i.ARRAY_BUFFER,new Float32Array([0,0,0,1,1,0,1,0,0,1,1,1]),i.STATIC_DRAW),{positions:r,texCoords:c}},_e=i=>{const r=i.createTexture();return i.bindTexture(i.TEXTURE_2D,r),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MAG_FILTER,i.LINEAR),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MIN_FILTER,i.LINEAR),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_WRAP_S,i.CLAMP_TO_EDGE),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_WRAP_T,i.CLAMP_TO_EDGE),r},Ce=(i,r)=>{const c=i.createProgram();if(r.forEach(p=>i.attachShader(c,p)),i.linkProgram(c),!i.getProgramParameter(c,i.LINK_STATUS)){const p=new Error(`An error occured linking the program: ${i.getProgramInfoLog(c)}.`);throw p.name="WebGLError",p}return i.useProgram(c),c},ge=(i,r,c)=>{const p=i.createShader(r);if(i.shaderSource(p,c),i.compileShader(p),!i.getShaderParameter(p,i.COMPILE_STATUS)){const f=new Error(`An error occured compiling the shader: ${i.getShaderInfoLog(p)}.`);throw f.name="WebGLError",f}return p},l=`
                  attribute vec2 a_position;
                  attribute vec2 a_texCoord;
  
                  uniform mat3 u_matrix;
                  uniform mat3 u_textureMatrix;
  
                  varying vec2 v_texCoord;
                  void main(void) {
                  gl_Position = vec4((u_matrix * vec3(a_position, 1)).xy, 0, 1.0);
                  v_texCoord = vec4((u_textureMatrix * vec3(a_texCoord, 1)).xy, 0, 1.0).xy;
                  }
              `;let s="rgb";["rgba","rbga","grba","gbra","brga","bgra"].includes(J)&&(s=J.slice(0,3));const a=`
                  precision mediump float;
                  varying vec2 v_texCoord;
                  uniform sampler2D u_image;
                  uniform float uColorFactor;
  
                  void main() {
                      vec4 sample = texture2D(u_image, v_texCoord);
                      float grey = 0.21 * sample.r + 0.71 * sample.g + 0.07 * sample.b;
                      gl_FragColor = vec4(sample.${s} * (1.0 - uColorFactor) + (grey * uColorFactor), sample.a);
                  }
              `,u=Ce(ne,[ge(ne,ne.VERTEX_SHADER,l),ge(ne,ne.FRAGMENT_SHADER,a)]);Nt(this,gr,{program:u,attribLocations:{vertexPosition:ne.getAttribLocation(u,"a_position"),texPosition:ne.getAttribLocation(u,"a_texCoord")},uniformLocations:{uSampler:ne.getUniformLocation(u,"u_image"),uColorFactor:ne.getUniformLocation(u,"uColorFactor"),uMatrix:ne.getUniformLocation(u,"u_matrix"),uTextureMatrix:ne.getUniformLocation(u,"u_textureMatrix")}},"f"),Nt(this,pr,y(ne),"f"),Nt(this,yn,_e(ne),"f"),Nt(this,as,J,"f")}const pe=(y,_e,Ce)=>{y.bindBuffer(y.ARRAY_BUFFER,_e),y.enableVertexAttribArray(Ce),y.vertexAttribPointer(Ce,2,y.FLOAT,!1,0,0)},he=(y,_e,Ce)=>{const ge=y.RGBA,l=y.RGBA,s=y.UNSIGNED_BYTE;y.bindTexture(y.TEXTURE_2D,_e),y.texImage2D(y.TEXTURE_2D,0,ge,l,s,Ce)},le=(y,_e,Ce,ge)=>{y.clearColor(0,0,0,1),y.clearDepth(1),y.enable(y.DEPTH_TEST),y.depthFunc(y.LEQUAL),y.clear(y.COLOR_BUFFER_BIT|y.DEPTH_BUFFER_BIT),pe(y,Ce.positions,_e.attribLocations.vertexPosition),pe(y,Ce.texCoords,_e.attribLocations.texPosition),y.activeTexture(y.TEXTURE0),y.bindTexture(y.TEXTURE_2D,ge),y.uniform1i(_e.uniformLocations.uSampler,0),y.uniform1f(_e.uniformLocations.uColorFactor,[Be.GREY,Be.GREY32].includes(J)?1:0);let l,s,a=Ot.translate(Ot.identity(),-1,-1);a=Ot.scale(a,2,2),a=Ot.scale(a,1/y.canvas.width,1/y.canvas.height),l=Ot.translate(a,L,N),l=Ot.scale(l,Y,X),y.uniformMatrix3fv(_e.uniformLocations.uMatrix,!1,l),s=Ot.translate(Ot.identity(),C/o,E/h),s=Ot.scale(s,I/o,R/h),y.uniformMatrix3fv(_e.uniformLocations.uTextureMatrix,!1,s),y.drawArrays(y.TRIANGLES,0,6)};he(ne,_t(this,yn,"f"),n),le(ne,_t(this,gr,"f"),_t(this,pr,"f"),_t(this,yn,"f"));const be=K||new Uint8Array(4*Y*X);if(ne.readPixels(L,N,Y,X,ne.RGBA,ne.UNSIGNED_BYTE,be),be[3]!==255){Ie._onLog&&Ie._onLog("Incorrect WebGL drawing .");const y=new Error("WebGL error: incorrect drawing.");throw y.name="WebGLError",y}return Ie._onLog&&Ie._onLog("drawImage() in WebGL end. Costs: "+(Date.now()-v)),{context:ne,pixelFormat:J===Be.GREY?Be.GREY32:J,bUseWebGL:!0}}catch(ne){if(this.forceLoseContext(),console.log(ne),(m==null?void 0:m.bUseWebGL)==null)return Ie._onLog&&Ie._onLog("'drawImage()' in WebGL failed, try again in context2d."),this.useWebGLByDefault=!1,this.drawImage(e,n,o,h,g,Object.assign({},m,{bUseWebGL:!1}));throw ne.name="WebGLError",ne}}readCvsData(e,n,o){if(!(e instanceof CanvasRenderingContext2D||e instanceof WebGLRenderingContext))throw new Error("Invalid 'context'.");let h,g=0,m=0,v=e.canvas.width,C=e.canvas.height;if(n&&(n.x&&(g=n.x),n.y&&(m=n.y),n.width&&(v=n.width),n.height&&(C=n.height)),(o==null?void 0:o.length)<4*v*C)throw new Error("Unexpected size of the 'bufferContainer'.");if(e instanceof WebGLRenderingContext){const E=e;o?(E.readPixels(g,m,v,C,E.RGBA,E.UNSIGNED_BYTE,o),h=new Uint8Array(o.buffer,0,4*v*C)):(h=new Uint8Array(4*v*C),E.readPixels(g,m,v,C,E.RGBA,E.UNSIGNED_BYTE,h))}else if(e instanceof CanvasRenderingContext2D){let E;E=e.getImageData(g,m,v,C),h=new Uint8Array(E.data.buffer),o==null||o.set(h)}return h}transformPixelFormat(e,n,o,h){let g,m;if(Ie._onLog&&(g=Date.now(),Ie._onLog("transformPixelFormat(), START: "+g)),n===o)return Ie._onLog&&Ie._onLog("transformPixelFormat() end. Costs: "+(Date.now()-g)),h?new Uint8Array(e):e;const v=[Be.RGBA,Be.RBGA,Be.GRBA,Be.GBRA,Be.BRGA,Be.BGRA];if(v.includes(n))if(o===Be.GREY){m=new Uint8Array(e.length/4);for(let C=0;C<e.length;C+=4){const E=.21*e[C]+.71*e[C+1]+.07*e[C+2];m[C/4]=E}}else if(o===Be.GREY32){m=h?new Uint8Array(e):e;for(let C=0;C<e.length;C+=4){const E=.21*e[C]+.71*e[C+1]+.07*e[C+2];m[C]=E,m[C+1]=E,m[C+2]=E}}else{if(!v.includes(o))throw new Error("Unable to transform.");if(h){m=new Uint8Array(e);const C=n.indexOf("r"),E=n.indexOf("g"),I=n.indexOf("b"),R=o.indexOf("r"),L=o.indexOf("g"),N=o.indexOf("b");for(let Y=0;Y<e.length;Y+=4)m[Y+R]=e[Y+C],m[Y+L]=e[Y+E],m[Y+N]=e[Y+I]}else{m=e;const C=n.indexOf("r"),E=n.indexOf("g"),I=n.indexOf("b"),R=o.indexOf("r"),L=o.indexOf("g"),N=o.indexOf("b");for(let Y=0;Y<e.length;Y+=4){let X=[e[Y],e[Y+1],e[Y+2]];m[Y+R]=X[C],m[Y+L]=X[E],m[Y+N]=X[I]}}}else if(n===Be.GREY){if(o!==Be.GREY32)throw new Error("Unable to transform.");m=new Uint8Array(4*e.length);for(let C=0;C<e.length;C++)m[4*C]=e[C],m[4*C+1]=e[C],m[4*C+2]=e[C],m[4*C+3]=255}else{if(n!==Be.GREY32)throw new Error("Unable to transform.");if(o!==Be.GREY)throw new Error("Unable to transform.");m=new Uint8Array(e.length/4);for(let C=0;C<e.length;C+=4)m[C/4]=e[C]}return Ie._onLog&&Ie._onLog("transformPixelFormat() end. Costs: "+(Date.now()-g)),m}getImageData(e,n,o,h,g){if(this.disposed)throw Error("The 'ImageDataGetter' instance has been disposed.");if(!n||!o)throw new Error("Invalid 'sourceWidth' or 'sourceHeight'.");if(_t(Ie,ni,"f",ri)==null&&Ie.checkWebGLSupport(),(g==null?void 0:g.bUseWebGL)&&!_t(Ie,ni,"f",ri))throw new Error("Your browser or machine may not support WebGL.");if(h.sx>n||h.sy>o||h.sx+h.sWidth>n||h.sy+h.sHeight>o)throw new Error("Invalid position.");if(e instanceof HTMLVideoElement&&e.readyState!==4||e instanceof HTMLImageElement&&!e.complete)throw new Error("The source is not loaded.");let m;Ie._onLog&&(m=Date.now(),Ie._onLog("getImageData(), START: "+m));const v=Math.round(h.sx),C=Math.round(h.sy),E=Math.round(h.sWidth),I=Math.round(h.sHeight),R=Math.round(h.dWidth),L=Math.round(h.dHeight);let N=Be.RGBA;g!=null&&g.pixelFormat&&(N=g.pixelFormat);let Y,X,K,J=null;if(g!=null&&g.bufferContainer&&(J=g.bufferContainer),_t(Ie,ni,"f",ri)&&(this.useWebGLByDefault&&(g==null?void 0:g.bUseWebGL)==null||(g==null?void 0:g.bUseWebGL))){Ie._onLog&&Ie._onLog("getImageData() in WebGL."),this._reusedWebGLCvs||(this._reusedWebGLCvs=document.createElement("canvas")),Y=this._reusedWebGLCvs;try{if(J)if(N===Be.GREY){if(K=new Uint8Array(4*R*L),X=this.drawImage(Y,e,n,o,{sx:v,sy:C,sWidth:E,sHeight:I,dWidth:R,dHeight:L},{pixelFormat:N,bUseWebGL:!0,bufferContainer:K}),K=this.transformPixelFormat(K,X.pixelFormat,N),J){if(J.length<K.length)throw new Error("Unexpected size of the 'bufferContainer'.");J.set(K)}}else X=this.drawImage(Y,e,n,o,{sx:v,sy:C,sWidth:E,sHeight:I,dWidth:R,dHeight:L},{pixelFormat:N,bUseWebGL:!0,bufferContainer:J}),K=new Uint8Array(J.buffer,0,4*R*L),K=this.transformPixelFormat(K,X.pixelFormat,N);else N===Be.GREY?((!_t(this,wn,"f")||_t(this,wn,"f").length<4*R*L)&&Nt(this,wn,new Uint8Array(4*R*L),"f"),K=new Uint8Array(_t(this,wn,"f").buffer,0,4*R*L)):K=new Uint8Array(4*R*L),X=this.drawImage(Y,e,n,o,{sx:v,sy:C,sWidth:E,sHeight:I,dWidth:R,dHeight:L},{pixelFormat:N,bUseWebGL:!0,bufferContainer:K}),K=this.transformPixelFormat(K,X.pixelFormat,N)}catch(te){if(te.name==="WebGLError"&&(this.forceLoseContext(),(g==null?void 0:g.bUseWebGL)==null))return Ie._onLog&&Ie._onLog("getImageData() in WebGL failed, try again in context2d."),this.useWebGLByDefault=!1,this.getImageData(e,n,o,{sx:v,sy:C,sWidth:E,sHeight:I,dWidth:R,dHeight:L},Object.assign({},g,{bUseWebGL:!1}));throw te}}else if(Ie._onLog&&Ie._onLog("getImageData() in context2d."),this._reusedCvs||(this._reusedCvs=document.createElement("canvas")),Y=this._reusedCvs,X=this.drawImage(Y,e,n,o,{sx:v,sy:C,sWidth:E,sHeight:I,dWidth:R,dHeight:L},{pixelFormat:Be.RGBA,bUseWebGL:!1}),K=this.readCvsData(X.context,{width:R,height:L},null),K=this.transformPixelFormat(K,X.pixelFormat,N),J){if(J.length<K.length)throw new Error("Unexpected size of the 'bufferContainer'.");J.set(K)}return Ie._onLog&&Ie._onLog("getImageData() end. Costs: "+(Date.now()-m)),{data:K,pixelFormat:N,width:R,height:L,bUseWebGL:X.bUseWebGL}}convertDataToCvs(e,n,o,h){if(!(e instanceof Uint8Array||e instanceof Uint8ClampedArray))throw new TypeError("Invalid 'data'.");if(typeof n!="number"||n<=0)throw new Error("Invalid 'width'.");if(typeof o!="number"||o<=0)throw new Error("Invalid 'height'.");const g=document.createElement("canvas");let m;if(g.width=n,g.height=o,h===Be.GREY){m=new Uint8ClampedArray(4*n*o);for(let C=0;C<m.length;C+=4)m[C]=e[C/4],m[C+1]=e[C/4],m[C+2]=e[C/4],m[C+3]=255}else m=new Uint8ClampedArray(e.buffer);const v=new ImageData(m,n,o);return g.getContext("2d").putImageData(v,0,0),g}forceLoseContext(){if(!this._reusedWebGLCvs)return;const e=this._reusedWebGLCvs.ctxWebGL;e&&!e.isContextLost()&&e.getExtension("WEBGL_lose_context")&&e.getExtension("WEBGL_lose_context").loseContext(),Nt(this,yn,null,"f"),Nt(this,gr,null,"f"),Nt(this,pr,null,"f"),this._reusedWebGLCvs=null}dispose(){this.forceLoseContext(),Nt(this,ls,!0,"f")}}ni=Ie,as=new WeakMap,yn=new WeakMap,gr=new WeakMap,pr=new WeakMap,wn=new WeakMap,ls=new WeakMap,ri={value:void 0};var Yi,cs,yo,ye,Oe,ke,hs,us,Xe,Bt,ci,Cn,fs,qt,gi,Rt,En,Tn,mr,ds,bn,Hi,hi,ui,qo,rt,Jo,Xi,Sn,gs,ps,Xl,Gt,wo,Co,Rn,_r,ks,xt,dn,Qo,ea,ph;class Cd{constructor(){Yi.set(this,new Map),cs.set(this,!1)}get disposed(){return j(this,cs,"f")}on(e,n){e=e.toLowerCase();const o=j(this,Yi,"f").get(e);if(o){if(o.includes(n))return;o.push(n)}else j(this,Yi,"f").set(e,[n])}off(e,n){e=e.toLowerCase();const o=j(this,Yi,"f").get(e);if(!o)return;const h=o.indexOf(n);h!==-1&&o.splice(h,1)}offAll(e){e=e.toLowerCase();const n=j(this,Yi,"f").get(e);n&&(n.length=0)}async fire(e,n=[],o={async:!1,copy:!0}){n||(n=[]),e=e.toLowerCase();const h=j(this,Yi,"f").get(e);if(h&&h.length){o=Object.assign({async:!1,copy:!0},o);for(let g of h){if(!g)continue;let m=[];if(o.copy)for(let C of n){try{C=JSON.parse(JSON.stringify(C))}catch{}m.push(C)}else m=n;let v=!1;if(o.async)setTimeout(()=>{this.disposed||g.apply(o.target,m)},0);else try{v=await g.apply(o.target,m)}catch{}if(v===!0)break}}}dispose(){Fe(this,cs,!0,"f")}}Yi=new WeakMap,cs=new WeakMap;const Ct=(t,e,n,o)=>{if(!n)return t;let h=e+Math.round((t-e)/n)*n;return o&&(h=Math.min(h,o)),h};class xe{static get version(){return"2.0.0"}static isStorageAvailable(e){let n;try{n=window[e];const o="__storage_test__";return n.setItem(o,o),n.removeItem(o),!0}catch(o){return o instanceof DOMException&&(o.code===22||o.code===1014||o.name==="QuotaExceededError"||o.name==="NS_ERROR_DOM_QUOTA_REACHED")&&n&&n.length!==0}}static findBestRearCameraInIOS(e,n){if(!e||!e.length)return null;let o=!1;if(n!=null&&n.getMainCamera&&(o=!0),o){const h=["후면 카메라","背面カメラ","後置鏡頭","后置相机","กล้องด้านหลัง","बैक कैमरा","الكاميرا الخلفية","מצלמה אחורית","камера на задней панели","задня камера","задна камера","артқы камера","πίσω κάμερα","zadní fotoaparát","zadná kamera","tylny aparat","takakamera","stražnja kamera","rückkamera","kamera på baksidan","kamera belakang","kamera bak","hátsó kamera","fotocamera (posteriore)","câmera traseira","câmara traseira","cámara trasera","càmera posterior","caméra arrière","cameră spate","camera mặt sau","camera aan achterzijde","bagsidekamera","back camera","arka kamera"],g=e.find(m=>h.includes(m.label.toLowerCase()));return g==null?void 0:g.deviceId}{const h=["후면","背面","後置","后置","านหลัง","बैक","خلفية","אחורית","задняя","задней","задна","πίσω","zadní","zadná","tylny","trasera","traseira","taka","stražnja","spate","sau","rück","posteriore","posterior","hátsó","belakang","baksidan","bakre","bak","bagside","back","aртқы","arrière","arka","achterzijde"],g=["트리플","三镜头","三鏡頭","トリプル","สาม","ट्रिपल","ثلاثية","משולשת","үштік","тройная","тройна","потроєна","τριπλή","üçlü","trójobiektywowy","trostruka","trojný","trojitá","trippelt","trippel","triplă","triple","tripla","tiga","kolmois","ba camera"],m=["듀얼 와이드","雙廣角","双广角","デュアル広角","คู่ด้านหลังมุมกว้าง","ड्युअल वाइड","مزدوجة عريضة","כפולה רחבה","қос кең бұрышты","здвоєна ширококутна","двойная широкоугольная","двойна широкоъгълна","διπλή ευρεία","çift geniş","laajakulmainen kaksois","kép rộng mặt sau","kettős, széles látószögű","grande angular dupla","ganda","dwuobiektywowy","dwikamera","dvostruka široka","duální širokoúhlý","duálna širokouhlá","dupla grande-angular","dublă","dubbel vidvinkel","dual-weitwinkel","dual wide","dual con gran angular","dual","double","doppia con grandangolo","doble","dobbelt vidvinkelkamera"],v=e.filter(I=>{const R=I.label.toLowerCase();return h.some(L=>R.includes(L))});if(!v.length)return null;const C=v.find(I=>{const R=I.label.toLowerCase();return g.some(L=>R.includes(L))});if(C)return C.deviceId;const E=v.find(I=>{const R=I.label.toLowerCase();return m.some(L=>R.includes(L))});return E?E.deviceId:v[0].deviceId}}static findBestRearCamera(e,n){if(!e||!e.length)return null;if(["iPhone","iPad","Mac"].includes(tt.OS))return xe.findBestRearCameraInIOS(e,{getMainCamera:n==null?void 0:n.getMainCameraInIOS});const o=["후","背面","背置","後面","後置","后面","后置","านหลัง","หลัง","बैक","خلفية","אחורית","задняя","задня","задней","задна","πίσω","zadní","zadná","tylny","trás","trasera","traseira","taka","stražnja","spate","sau","rück","rear","posteriore","posterior","hátsó","darrere","belakang","baksidan","bakre","bak","bagside","back","aртқы","arrière","arka","achterzijde"];for(let h of e){const g=h.label.toLowerCase();if(g&&o.some(m=>g.includes(m))&&/\b0(\b)?/.test(g))return h.deviceId}return["Android","HarmonyOS"].includes(tt.OS)?e[e.length-1].deviceId:null}static findBestCamera(e,n,o){return e&&e.length?n==="environment"?this.findBestRearCamera(e,o):n==="user"?null:n?void 0:null:null}static async playVideo(e,n,o){if(!e)throw new Error("Invalid 'videoEl'.");if(!n)throw new Error("Invalid 'source'.");return typeof n=="string"||n instanceof String?e.src=n:e.srcObject=n,new Promise((h,g)=>{let m;const v=()=>{e.removeEventListener("loadstart",I),e.removeEventListener("abort",R),e.removeEventListener("play",L),e.removeEventListener("error",N)},C=()=>{m&&clearTimeout(m),v(),h(e)},E=Y=>{m&&clearTimeout(m),v(),g(Y)},I=()=>{e.addEventListener("abort",R,{once:!0})},R=()=>{const Y=new Error("Video playing was interrupted.");Y.name="AbortError",E(Y)},L=()=>{C()},N=()=>{E(new Error(`Video error ${e.error.code}: ${e.error.message}.`))};e.addEventListener("loadstart",I,{once:!0}),e.autoplay&&["iPhone","iPad","Mac"].includes(tt.OS)&&tt.version>=17?(e.addEventListener("play",L,{once:!0}),e.addEventListener("error",N,{once:!0})):(e.load(),e.play().then(()=>{C()}).catch(Y=>{E(Y)})),o&&(m=setTimeout(()=>{v(),g(new Error("Failed to play video. Timeout."))},o))})}static async testCameraAccess(e){var n,o;if(!(!((o=(n=window==null?void 0:window.navigator)===null||n===void 0?void 0:n.mediaDevices)===null||o===void 0)&&o.getUserMedia))return{ok:!1,errorName:"InsecureContext",errorMessage:"Insecure context."};let h;try{h=e?await navigator.mediaDevices.getUserMedia(e):await navigator.mediaDevices.getUserMedia({video:!0})}catch(g){return{ok:!1,errorName:g.name,errorMessage:g.message}}finally{h==null||h.getTracks().forEach(g=>{g.stop()})}return{ok:!0}}get state(){if(!j(this,Rt,"f"))return"closed";if(j(this,Rt,"f")==="pending")return"opening";if(j(this,Rt,"f")==="fulfilled")return"opened";throw new Error("Unknown state.")}set ifSaveLastUsedCamera(e){e?xe.isStorageAvailable("localStorage")?Fe(this,Cn,!0,"f"):(Fe(this,Cn,!1,"f"),console.warn("Local storage is unavailable")):Fe(this,Cn,!1,"f")}get ifSaveLastUsedCamera(){return j(this,Cn,"f")}get isVideoPlaying(){return!(!j(this,Oe,"f")||j(this,Oe,"f").paused)&&this.state==="opened"}set tapFocusEventBoundEl(e){var n,o,h;if(!(e instanceof HTMLElement)&&e!=null)throw new TypeError("Invalid 'element'.");(n=j(this,Hi,"f"))===null||n===void 0||n.removeEventListener("click",j(this,bn,"f")),(o=j(this,Hi,"f"))===null||o===void 0||o.removeEventListener("touchend",j(this,bn,"f")),(h=j(this,Hi,"f"))===null||h===void 0||h.removeEventListener("touchmove",j(this,ds,"f")),Fe(this,Hi,e,"f"),e&&(window.TouchEvent&&["Android","HarmonyOS","iPhone","iPad"].includes(tt.OS)?(e.addEventListener("touchend",j(this,bn,"f")),e.addEventListener("touchmove",j(this,ds,"f"))):e.addEventListener("click",j(this,bn,"f")))}get tapFocusEventBoundEl(){return j(this,Hi,"f")}get disposed(){return j(this,ps,"f")}constructor(e){var n,o;ye.add(this),Oe.set(this,null),ke.set(this,void 0),hs.set(this,()=>{this.state==="opened"&&j(this,rt,"f").fire("resumed",null,{target:this,async:!0})}),us.set(this,()=>{j(this,rt,"f").fire("paused",null,{target:this,async:!1})}),Xe.set(this,void 0),Bt.set(this,void 0),this.cameraOpenTimeout=4e3,this._arrCameras=[],ci.set(this,void 0),Cn.set(this,!1),this.ifSkipCameraInspection=!1,this.selectIOSRearMainCameraAsDefault=!1,fs.set(this,void 0),qt.set(this,!0),gi.set(this,void 0),Rt.set(this,void 0),En.set(this,!1),this._focusParameters={maxTimeout:400,minTimeout:300,kTimeout:void 0,oldDistance:null,fds:null,isDoingFocus:0,taskBackToContinous:null,curFocusTaskId:0,focusCancelableTime:1500,defaultFocusAreaSizeRatio:6,focusBackToContinousTime:5e3,tapFocusMinDistance:null,tapFocusMaxDistance:null,focusArea:null,tempBufferContainer:null,defaultTempBufferContainerLenRatio:1/4},Tn.set(this,!1),this._focusSupported=!0,this.calculateCoordInVideo=(h,g)=>{let m,v;const C=window.getComputedStyle(j(this,Oe,"f")).objectFit,E=this.getResolution(),I=j(this,Oe,"f").getBoundingClientRect(),R=I.left,L=I.top,{width:N,height:Y}=j(this,Oe,"f").getBoundingClientRect();if(N<=0||Y<=0)throw new Error("Unable to get video dimensions. Video may not be rendered on the page.");const X=N/Y,K=E.width/E.height;let J=1;if(C==="contain")K>X?(J=N/E.width,m=(h-R)/J,v=(g-L-(Y-N/K)/2)/J):(J=Y/E.height,v=(g-L)/J,m=(h-R-(N-Y*K)/2)/J);else{if(C!=="cover")throw new Error("Unsupported object-fit.");K>X?(J=Y/E.height,v=(g-L)/J,m=(h-R+(Y*K-N)/2)/J):(J=N/E.width,m=(h-R)/J,v=(g-L+(N/K-Y)/2)/J)}return{x:m,y:v}},mr.set(this,!1),ds.set(this,()=>{Fe(this,mr,!0,"f")}),bn.set(this,async h=>{var g;if(j(this,mr,"f"))return void Fe(this,mr,!1,"f");if(!j(this,Tn,"f")||!this.isVideoPlaying||!j(this,ke,"f")||!this._focusSupported)return;if(!this._focusParameters.fds&&(this._focusParameters.fds=(g=this.getCameraCapabilities())===null||g===void 0?void 0:g.focusDistance,!this._focusParameters.fds))return void(this._focusSupported=!1);if(this._focusParameters.kTimeout==null&&(this._focusParameters.kTimeout=(this._focusParameters.maxTimeout-this._focusParameters.minTimeout)/(1/this._focusParameters.fds.min-1/this._focusParameters.fds.max)),this._focusParameters.isDoingFocus==1)return;let m,v;if(this._focusParameters.taskBackToContinous&&(clearTimeout(this._focusParameters.taskBackToContinous),this._focusParameters.taskBackToContinous=null),h instanceof MouseEvent)m=h.clientX,v=h.clientY;else{if(!(h instanceof TouchEvent))throw new Error("Unknown event type.");if(!h.changedTouches.length)return;m=h.changedTouches[0].clientX,v=h.changedTouches[0].clientY}const C=this.getResolution(),E=2*Math.round(Math.min(C.width,C.height)/this._focusParameters.defaultFocusAreaSizeRatio/2);let I;try{I=this.calculateCoordInVideo(m,v)}catch{}if(I.x<0||I.x>C.width||I.y<0||I.y>C.height)return;const R={x:I.x+"px",y:I.y+"px"},L=E+"px",N=L;let Y;xe._onLog&&(Y=Date.now());try{await j(this,ye,"m",Qo).call(this,R,L,N,this._focusParameters.tapFocusMinDistance,this._focusParameters.tapFocusMaxDistance)}catch(X){if(xe._onLog)throw xe._onLog(X),X}xe._onLog&&xe._onLog(`Tap focus costs: ${Date.now()-Y} ms`),this._focusParameters.taskBackToContinous=setTimeout(()=>{var X;xe._onLog&&xe._onLog("Back to continuous focus."),(X=j(this,ke,"f"))===null||X===void 0||X.applyConstraints({advanced:[{focusMode:"continuous"}]}).catch(()=>{})},this._focusParameters.focusBackToContinousTime),j(this,rt,"f").fire("tapfocus",null,{target:this,async:!0})}),Hi.set(this,null),hi.set(this,1),ui.set(this,{x:0,y:0}),this.updateVideoElWhenSoftwareScaled=()=>{if(!j(this,Oe,"f"))return;const h=j(this,hi,"f");if(h<1)throw new RangeError("Invalid scale value.");if(h===1)j(this,Oe,"f").style.transform="";else{const g=window.getComputedStyle(j(this,Oe,"f")).objectFit,m=j(this,Oe,"f").videoWidth,v=j(this,Oe,"f").videoHeight,{width:C,height:E}=j(this,Oe,"f").getBoundingClientRect();if(C<=0||E<=0)throw new Error("Unable to get video dimensions. Video may not be rendered on the page.");const I=C/E,R=m/v;let L=1;g==="contain"?L=I<R?C/(m/h):E/(v/h):g==="cover"&&(L=R>I?E/(m/h):C/(v/h));const N=L*(1-1/h)*(m/2-j(this,ui,"f").x),Y=L*(1-1/h)*(v/2-j(this,ui,"f").y);j(this,Oe,"f").style.transform=`translate(${N}px, ${Y}px) scale(${h})`}},qo.set(this,function(){if(!(this.data instanceof Uint8Array||this.data instanceof Uint8ClampedArray))throw new TypeError("Invalid data.");if(typeof this.width!="number"||this.width<=0)throw new Error("Invalid width.");if(typeof this.height!="number"||this.height<=0)throw new Error("Invalid height.");const h=document.createElement("canvas");let g;if(h.width=this.width,h.height=this.height,this.pixelFormat===Be.GREY){g=new Uint8ClampedArray(this.width*this.height*4);for(let v=0;v<g.length;v+=4)g[v]=this.data[v/4],g[v+1]=this.data[v/4],g[v+2]=this.data[v/4],g[v+3]=255}else g=new Uint8ClampedArray(this.data.buffer);const m=new ImageData(g,this.width,this.height);return h.getContext("2d").putImageData(m,0,0),h}),rt.set(this,void 0),Jo.set(this,["before:open","opened","before:close","closed","before:camera:change","camera:changed","before:resolution:change","resolution:changed","played","paused","resumed","tapfocus"]),this.detectedResolutions=[{width:160,height:120},{width:320,height:240},{width:480,height:360},{width:640,height:480},{width:800,height:600},{width:960,height:720},{width:1280,height:720},{width:1920,height:1080},{width:2560,height:1440},{width:3840,height:2160}],Xi.set(this,new Map),Sn.set(this,!1),gs.set(this,async()=>{var h,g;if(document.visibilityState==="visible"){if(xe._onLog&&xe._onLog("document visible. video paused: "+((h=j(this,Oe,"f"))===null||h===void 0?void 0:h.paused)),j(this,Sn,"f")&&j(this,Oe,"f")&&this.videoSrc&&this.state==="opened")return void this.resume().catch(()=>{});if(!this._mediaStream)return;if(this._mediaStream.active&&j(this,ke,"f"))if(j(this,ke,"f").muted&&["iPhone","iPad","Mac"].includes(tt.OS)){if(tt.version>=17)return;await j(this,ye,"m",Rn).call(this)}else j(this,Sn,"f")&&this.resume().catch(()=>{});else await j(this,ye,"m",Rn).call(this)}else if(document.visibilityState==="hidden"&&(xe._onLog&&xe._onLog("document hidden. video paused: "+((g=j(this,Oe,"f"))===null||g===void 0?void 0:g.paused)),["iPhone","iPad","Mac"].includes(tt.OS)?Fe(this,Sn,!0,"f"):Fe(this,Sn,this.isVideoPlaying,"f"),this.isVideoLoaded()&&this.state=="opened")){if(["iPhone","iPad","Mac"].includes(tt.OS)&&tt.version>=17)return;this.pause()}}),ps.set(this,!1),!((o=(n=window==null?void 0:window.navigator)===null||n===void 0?void 0:n.mediaDevices)===null||o===void 0)&&o.getUserMedia||setTimeout(()=>{xe.onWarning&&xe.onWarning("The browser is too old or the page is loaded from an insecure origin.")},0),this.defaultConstraints={video:{facingMode:{ideal:"environment"}}},this.resetMediaStreamConstraints(),e instanceof HTMLVideoElement&&this.setVideoEl(e),Fe(this,rt,new Cd,"f"),this.imageDataGetter=new Ie,document.addEventListener("visibilitychange",j(this,gs,"f"))}setVideoEl(e){if(!(e&&e instanceof HTMLVideoElement))throw new Error("Invalid 'videoEl'.");e.addEventListener("play",j(this,hs,"f")),e.addEventListener("pause",j(this,us,"f")),Fe(this,Oe,e,"f")}getVideoEl(){return j(this,Oe,"f")}releaseVideoEl(){var e,n;(e=j(this,Oe,"f"))===null||e===void 0||e.removeEventListener("play",j(this,hs,"f")),(n=j(this,Oe,"f"))===null||n===void 0||n.removeEventListener("pause",j(this,us,"f")),Fe(this,Oe,null,"f")}isVideoLoaded(){return!!j(this,Oe,"f")&&j(this,Oe,"f").readyState==4}async open(){if(j(this,gi,"f")&&!j(this,qt,"f")){if(j(this,Rt,"f")==="pending")return j(this,gi,"f");if(j(this,Rt,"f")==="fulfilled")return}j(this,rt,"f").fire("before:open",null,{target:this}),await j(this,ye,"m",Rn).call(this),j(this,rt,"f").fire("opened",null,{target:this,async:!0}),j(this,rt,"f").fire("played",null,{target:this,async:!0})}async close(){if(this.state==="closed")return;j(this,rt,"f").fire("before:close",null,{target:this});const e=j(this,gi,"f");if(j(this,ye,"m",ks).call(this),e&&j(this,Rt,"f")==="pending"){try{await e}catch{}if(j(this,qt,"f")===!1){const n=new Error("'close()' was interrupted.");throw n.name="AbortError",n}}Fe(this,gi,null,"f"),Fe(this,Rt,null,"f"),j(this,rt,"f").fire("closed",null,{target:this,async:!0})}pause(){if(!this.isVideoLoaded())throw new Error("Video is not loaded.");if(this.state!=="opened")throw new Error("Camera or video is not open.");j(this,Oe,"f").pause()}async resume(){if(!this.isVideoLoaded())throw new Error("Video is not loaded.");if(this.state!=="opened")throw new Error("Camera or video is not open.");await j(this,Oe,"f").play()}async setCamera(e){if(typeof e!="string")throw new TypeError("Invalid 'deviceId'.");if(typeof j(this,Xe,"f").video!="object"&&(j(this,Xe,"f").video={}),delete j(this,Xe,"f").video.facingMode,j(this,Xe,"f").video.deviceId={exact:e},!(this.state==="closed"||this.videoSrc||this.state==="opening"&&j(this,qt,"f"))){j(this,rt,"f").fire("before:camera:change",[],{target:this,async:!1}),await j(this,ye,"m",_r).call(this);try{this.resetSoftwareScale()}catch{}return j(this,Bt,"f")}}async switchToFrontCamera(e){if(typeof j(this,Xe,"f").video!="object"&&(j(this,Xe,"f").video={}),e!=null&&e.resolution&&(j(this,Xe,"f").video.width={ideal:e.resolution.width},j(this,Xe,"f").video.height={ideal:e.resolution.height}),delete j(this,Xe,"f").video.deviceId,j(this,Xe,"f").video.facingMode={exact:"user"},Fe(this,ci,null,"f"),!(this.state==="closed"||this.videoSrc||this.state==="opening"&&j(this,qt,"f"))){j(this,rt,"f").fire("before:camera:change",[],{target:this,async:!1}),j(this,ye,"m",_r).call(this);try{this.resetSoftwareScale()}catch{}return j(this,Bt,"f")}}getCamera(){var e;if(j(this,Bt,"f"))return j(this,Bt,"f");{let n=((e=j(this,Xe,"f").video)===null||e===void 0?void 0:e.deviceId)||"";if(n){n=n.exact||n.ideal||n;for(let o of this._arrCameras)if(o.deviceId===n)return JSON.parse(JSON.stringify(o))}return{deviceId:"",label:"",_checked:!1}}}async _getCameras(e){var n,o;if(!(!((o=(n=window==null?void 0:window.navigator)===null||n===void 0?void 0:n.mediaDevices)===null||o===void 0)&&o.getUserMedia))throw new Error("Failed to access the camera because the browser is too old or the page is loaded from an insecure origin.");let h;if(e){let v=await navigator.mediaDevices.getUserMedia({video:!0});h=(await navigator.mediaDevices.enumerateDevices()).filter(C=>C.kind==="videoinput"),v.getTracks().forEach(C=>{C.stop()})}else h=(await navigator.mediaDevices.enumerateDevices()).filter(v=>v.kind==="videoinput");const g=[],m=[];if(this._arrCameras)for(let v of this._arrCameras)v._checked&&m.push(v);for(let v=0;v<h.length;v++){let C,E=h[v];for(let I of m)if(E.deviceId==I.deviceId){C=I;break}C||(C={deviceId:E.deviceId,label:E.label?E.label:"camera "+v,_checked:!1}),C.deviceId&&g.push(C)}return this._arrCameras=g,xe._onLog&&xe._onLog(JSON.stringify(this._arrCameras)),g}async getCameras(){var e,n;if(!(!((n=(e=window==null?void 0:window.navigator)===null||e===void 0?void 0:e.mediaDevices)===null||n===void 0)&&n.enumerateDevices))throw new Error("Failed to access the camera because the browser is too old or the page is loaded from an insecure origin.");const o=(await navigator.mediaDevices.enumerateDevices()).filter(h=>h.kind==="videoinput");return o&&o.length&&!o[0].deviceId?this._getCameras(!0):this._getCameras(!1)}async getAllCameras(){return this.getCameras()}async setResolution(e,n,o){if(typeof e!="number"||e<=0)throw new TypeError("Invalid 'width'.");if(typeof n!="number"||n<=0)throw new TypeError("Invalid 'height'.");if(typeof j(this,Xe,"f").video!="object"&&(j(this,Xe,"f").video={}),o?(j(this,Xe,"f").video.width={exact:e},j(this,Xe,"f").video.height={exact:n}):(j(this,Xe,"f").video.width={ideal:e},j(this,Xe,"f").video.height={ideal:n}),this.state==="closed"||this.videoSrc||this.state==="opening"&&j(this,qt,"f"))return null;j(this,rt,"f").fire("before:resolution:change",[],{target:this,async:!1}),await j(this,ye,"m",_r).call(this);try{this.resetSoftwareScale()}catch{}const h=this.getResolution();return{width:h.width,height:h.height}}getResolution(){if(this.state==="opened"&&this.videoSrc&&j(this,Oe,"f"))return{width:j(this,Oe,"f").videoWidth,height:j(this,Oe,"f").videoHeight};if(j(this,ke,"f")){const e=j(this,ke,"f").getSettings();return{width:e.width,height:e.height}}if(this.isVideoLoaded())return{width:j(this,Oe,"f").videoWidth,height:j(this,Oe,"f").videoHeight};{const e={width:0,height:0};let n=j(this,Xe,"f").video.width||0,o=j(this,Xe,"f").video.height||0;return n&&(e.width=n.exact||n.ideal||n),o&&(e.height=o.exact||o.ideal||o),e}}async getResolutions(e){var n,o,h,g,m,v,C,E,I,R,L;if(!(!((o=(n=window==null?void 0:window.navigator)===null||n===void 0?void 0:n.mediaDevices)===null||o===void 0)&&o.getUserMedia))throw new Error("Failed to access the camera because the browser is too old or the page is loaded from an insecure origin.");let N="";const Y=(X,K)=>{const J=j(this,Xi,"f").get(X);if(!J||!J.length)return!1;for(let te of J)if(te.width===K.width&&te.height===K.height)return!0;return!1};if(this._mediaStream){N=(L=j(this,Bt,"f"))===null||L===void 0?void 0:L.deviceId;let X=j(this,Xi,"f").get(N);if(X&&!e)return JSON.parse(JSON.stringify(X));X=[],j(this,Xi,"f").set(N,X),Fe(this,En,!0,"f");try{for(let K of this.detectedResolutions){await j(this,ke,"f").applyConstraints({width:{ideal:K.width},height:{ideal:K.height}}),j(this,ye,"m",Gt).call(this);const J=j(this,ke,"f").getSettings(),te={width:J.width,height:J.height};Y(N,te)||X.push({width:te.width,height:te.height})}}catch(K){throw j(this,ye,"m",ks).call(this),Fe(this,En,!1,"f"),K}try{await j(this,ye,"m",Rn).call(this)}catch(K){if(K.name==="AbortError")return X;throw K}finally{Fe(this,En,!1,"f")}return X}{const X=async(te,ne,pe)=>{const he={video:{deviceId:{exact:te},width:{ideal:ne},height:{ideal:pe}}};let le=null;try{le=await navigator.mediaDevices.getUserMedia(he)}catch{return null}if(!le)return null;const be=le.getVideoTracks();let y=null;try{const _e=be[0].getSettings();y={width:_e.width,height:_e.height}}catch{const Ce=document.createElement("video");Ce.srcObject=le,y={width:Ce.videoWidth,height:Ce.videoHeight},Ce.srcObject=null}return be.forEach(_e=>{_e.stop()}),y};let K=((m=(g=(h=j(this,Xe,"f"))===null||h===void 0?void 0:h.video)===null||g===void 0?void 0:g.deviceId)===null||m===void 0?void 0:m.exact)||((E=(C=(v=j(this,Xe,"f"))===null||v===void 0?void 0:v.video)===null||C===void 0?void 0:C.deviceId)===null||E===void 0?void 0:E.ideal)||((R=(I=j(this,Xe,"f"))===null||I===void 0?void 0:I.video)===null||R===void 0?void 0:R.deviceId);if(!K)return[];let J=j(this,Xi,"f").get(K);if(J&&!e)return JSON.parse(JSON.stringify(J));J=[],j(this,Xi,"f").set(K,J);for(let te of this.detectedResolutions){const ne=await X(K,te.width,te.height);ne&&!Y(K,ne)&&J.push({width:ne.width,height:ne.height})}return J}}async setMediaStreamConstraints(e,n){if(!(o=>{return o!==null&&(h=o,Object.prototype.toString.call(h)==="[object Object]");var h})(e))throw new TypeError("Invalid 'mediaStreamConstraints'.");Fe(this,Xe,JSON.parse(JSON.stringify(e)),"f"),Fe(this,ci,null,"f"),n&&j(this,ye,"m",_r).call(this)}getMediaStreamConstraints(){return JSON.parse(JSON.stringify(j(this,Xe,"f")))}resetMediaStreamConstraints(){Fe(this,Xe,this.defaultConstraints?JSON.parse(JSON.stringify(this.defaultConstraints)):null,"f")}getCameraCapabilities(){if(!j(this,ke,"f")||this.state!=="opened")throw new Error("Camera is not open.");return j(this,ke,"f").getCapabilities?j(this,ke,"f").getCapabilities():{}}getCameraSettings(){if(!j(this,ke,"f")||this.state!=="opened")throw new Error("Camera is not open.");return j(this,ke,"f").getSettings()}async turnOnTorch(){if(!j(this,ke,"f")||this.state!=="opened")throw new Error("Camera is not open.");const e=this.getCameraCapabilities();if(!(e!=null&&e.torch))throw Error("Not supported.");await j(this,ke,"f").applyConstraints({advanced:[{torch:!0}]})}async turnOffTorch(){if(!j(this,ke,"f")||this.state!=="opened")throw new Error("Camera is not open.");const e=this.getCameraCapabilities();if(!(e!=null&&e.torch))throw Error("Not supported.");await j(this,ke,"f").applyConstraints({advanced:[{torch:!1}]})}async setColorTemperature(e,n){var o;if(typeof e!="number")throw new TypeError("Invalid 'value'.");if(!j(this,ke,"f")||this.state!=="opened")throw new Error("Camera is not open.");const h=(o=this.getCameraCapabilities())===null||o===void 0?void 0:o.colorTemperature;if(!h)throw Error("Not supported.");return n&&(e<h.min?e=h.min:e>h.max&&(e=h.max),e=Ct(e,h.min,h.step,h.max)),await j(this,ke,"f").applyConstraints({advanced:[{colorTemperature:e,whiteBalanceMode:"manual"}]}),e}getColorTemperature(){return this.getCameraSettings().colorTemperature||0}async setExposureCompensation(e,n){var o;if(typeof e!="number")throw new TypeError("Invalid 'value'.");if(!j(this,ke,"f")||this.state!=="opened")throw new Error("Camera is not open.");const h=(o=this.getCameraCapabilities())===null||o===void 0?void 0:o.exposureCompensation;if(!h)throw Error("Not supported.");return n&&(e<h.min?e=h.min:e>h.max&&(e=h.max),e=Ct(e,h.min,h.step,h.max)),await j(this,ke,"f").applyConstraints({advanced:[{exposureCompensation:e}]}),e}getExposureCompensation(){return this.getCameraSettings().exposureCompensation||0}async setFrameRate(e,n){var o;if(typeof e!="number")throw new TypeError("Invalid 'value'.");if(!j(this,ke,"f")||this.state!=="opened")throw new Error("Camera is not open.");let h=(o=this.getCameraCapabilities())===null||o===void 0?void 0:o.frameRate;if(!h)throw Error("Not supported.");n&&(e<h.min?e=h.min:e>h.max&&(e=h.max));const g=this.getResolution();return await j(this,ke,"f").applyConstraints({width:{ideal:Math.max(g.width,g.height)},frameRate:e}),e}getFrameRate(){return this.getCameraSettings().frameRate}async setFocus(e,n){if(typeof e!="object"||Array.isArray(e)||e==null)throw new TypeError("Invalid 'settings'.");if(!j(this,ke,"f")||this.state!=="opened")throw new Error("Camera is not open.");const o=this.getCameraCapabilities(),h=o==null?void 0:o.focusMode,g=o==null?void 0:o.focusDistance;if(!h)throw Error("Not supported.");if(typeof e.mode!="string")throw TypeError("Invalid 'mode'.");const m=e.mode.toLowerCase();if(!h.includes(m))throw Error("Unsupported focus mode.");if(m==="manual"){if(!g)throw Error("Manual focus unsupported.");if(e.hasOwnProperty("distance")){let v=e.distance;n&&(v<g.min?v=g.min:v>g.max&&(v=g.max),v=Ct(v,g.min,g.step,g.max)),this._focusParameters.focusArea=null,await j(this,ke,"f").applyConstraints({advanced:[{focusMode:m,focusDistance:v}]})}else{if(!e.area)throw new Error("'distance' or 'area' should be specified in 'manual' mode.");{const v=e.area.centerPoint;let C=e.area.width,E=e.area.height;if(!C||!E){const I=this.getResolution();C||(C=2*Math.round(Math.min(I.width,I.height)/this._focusParameters.defaultFocusAreaSizeRatio/2)+"px"),E||(E=2*Math.round(Math.min(I.width,I.height)/this._focusParameters.defaultFocusAreaSizeRatio/2)+"px")}this._focusParameters.focusArea={centerPoint:{x:v.x,y:v.y},width:C,height:E},await j(this,ye,"m",Qo).call(this,v,C,E)}}}else this._focusParameters.focusArea=null,await j(this,ke,"f").applyConstraints({advanced:[{focusMode:m}]})}getFocus(){const e=this.getCameraSettings(),n=e.focusMode;return n?n==="manual"?this._focusParameters.focusArea?{mode:"manual",area:JSON.parse(JSON.stringify(this._focusParameters.focusArea))}:{mode:"manual",distance:e.focusDistance}:{mode:n}:null}async enableTapToFocus(){Fe(this,Tn,!0,"f")}disableTapToFocus(){Fe(this,Tn,!1,"f")}isTapToFocusEnabled(){return j(this,Tn,"f")}async setZoom(e){if(typeof e!="object"||Array.isArray(e)||e==null)throw new TypeError("Invalid 'settings'.");if(typeof e.factor!="number")throw new TypeError("Illegal type of 'factor'.");if(e.factor<1)throw new RangeError("Invalid 'factor'.");if(this.state!=="opened")throw new Error("Video is not playing.");e.centerPoint?j(this,ye,"m",ea).call(this,e.centerPoint):this.resetScaleCenter();try{if(j(this,ye,"m",ph).call(this,j(this,ui,"f"))){const n=await this.setHardwareScale(e.factor,!0);let o=this.getHardwareScale();o==1&&n!=1&&(o=n),e.factor>o?this.setSoftwareScale(e.factor/o):this.setSoftwareScale(1)}else await this.setHardwareScale(1),this.setSoftwareScale(e.factor)}catch(n){const o=n.message||n;if(o!=="Not supported."&&o!=="Camera is not open.")throw n;this.setSoftwareScale(e.factor)}}getZoom(){if(this.state!=="opened")throw new Error("Video is not playing.");let e=1;try{e=this.getHardwareScale()}catch(n){if((n.message||n)!=="Camera is not open.")throw n}return{factor:e*j(this,hi,"f")}}async resetZoom(){await this.setZoom({factor:1})}async setHardwareScale(e,n){var o;if(typeof e!="number")throw new TypeError("Invalid 'value'.");if(e<1)throw new RangeError("Invalid 'value'.");if(!j(this,ke,"f")||this.state!=="opened")throw new Error("Camera is not open.");const h=(o=this.getCameraCapabilities())===null||o===void 0?void 0:o.zoom;if(!h)throw Error("Not supported.");return n&&(e<h.min?e=h.min:e>h.max&&(e=h.max),e=Ct(e,h.min,h.step,h.max)),await j(this,ke,"f").applyConstraints({advanced:[{zoom:e}]}),e}getHardwareScale(){return this.getCameraSettings().zoom||1}setSoftwareScale(e,n){if(typeof e!="number")throw new TypeError("Invalid 'value'.");if(e<1)throw new RangeError("Invalid 'value'.");if(this.state!=="opened")throw new Error("Video is not playing.");n&&j(this,ye,"m",ea).call(this,n),Fe(this,hi,e,"f"),this.updateVideoElWhenSoftwareScaled()}getSoftwareScale(){return j(this,hi,"f")}resetScaleCenter(){if(this.state!=="opened")throw new Error("Video is not playing.");const e=this.getResolution();Fe(this,ui,{x:e.width/2,y:e.height/2},"f")}resetSoftwareScale(){this.setSoftwareScale(1),this.resetScaleCenter()}getFrameData(e){if(this.disposed)throw Error("The 'Camera' instance has been disposed.");if(!this.isVideoLoaded()||j(this,En,"f"))return null;const n=Date.now();xe._onLog&&xe._onLog("getFrameData() START: "+n);const o=j(this,Oe,"f").videoWidth,h=j(this,Oe,"f").videoHeight;let g={sx:0,sy:0,sWidth:o,sHeight:h,dWidth:o,dHeight:h};e!=null&&e.position&&(g=JSON.parse(JSON.stringify(e.position)));let m=Be.RGBA;e!=null&&e.pixelFormat&&(m=e.pixelFormat);let v=j(this,hi,"f");e!=null&&e.scale&&(v=e.scale);let C=j(this,ui,"f");if(e!=null&&e.scaleCenter){if(typeof e.scaleCenter.x!="string"||typeof e.scaleCenter.y!="string")throw new Error("Invalid scale center.");let L=0,N=0;if(e.scaleCenter.x.endsWith("px"))L=parseFloat(e.scaleCenter.x);else{if(!e.scaleCenter.x.endsWith("%"))throw new Error("Invalid scale center.");L=parseFloat(e.scaleCenter.x)/100*o}if(e.scaleCenter.y.endsWith("px"))N=parseFloat(e.scaleCenter.y);else{if(!e.scaleCenter.y.endsWith("%"))throw new Error("Invalid scale center.");N=parseFloat(e.scaleCenter.y)/100*h}if(isNaN(L)||isNaN(N))throw new Error("Invalid scale center.");C.x=Math.round(L),C.y=Math.round(N)}let E=null;if(e!=null&&e.bufferContainer&&(E=e.bufferContainer),o==0||h==0)return null;v!==1&&(g.sWidth=Math.round(g.sWidth/v),g.sHeight=Math.round(g.sHeight/v),g.sx=Math.round((1-1/v)*C.x+g.sx/v),g.sy=Math.round((1-1/v)*C.y+g.sy/v));const I=this.imageDataGetter.getImageData(j(this,Oe,"f"),o,h,g,{pixelFormat:m,bufferContainer:E});if(!I)return null;const R=Date.now();return xe._onLog&&xe._onLog("getFrameData() END: "+R),{data:I.data,width:I.width,height:I.height,pixelFormat:I.pixelFormat,timeSpent:R-n,timeStamp:R,toCanvas:j(this,qo,"f")}}on(e,n){if(!j(this,Jo,"f").includes(e.toLowerCase()))throw new Error(`Event '${e}' does not exist.`);j(this,rt,"f").on(e,n)}off(e,n){j(this,rt,"f").off(e,n)}async dispose(){this.tapFocusEventBoundEl=null,await this.close(),this.releaseVideoEl(),j(this,rt,"f").dispose(),this.imageDataGetter.dispose(),document.removeEventListener("visibilitychange",j(this,gs,"f")),Fe(this,ps,!0,"f")}}var Tr,Bs,Dn,Ji,Ns,In,zl,mh,Pe,ta,ia,ve,we,vr,si,zi,ms,_s,vs,br,$i,ys,oi,Lt,ze,de,zt,na,$e,_h,vh,ra,sa;Oe=new WeakMap,ke=new WeakMap,hs=new WeakMap,us=new WeakMap,Xe=new WeakMap,Bt=new WeakMap,ci=new WeakMap,Cn=new WeakMap,fs=new WeakMap,qt=new WeakMap,gi=new WeakMap,Rt=new WeakMap,En=new WeakMap,Tn=new WeakMap,mr=new WeakMap,ds=new WeakMap,bn=new WeakMap,Hi=new WeakMap,hi=new WeakMap,ui=new WeakMap,qo=new WeakMap,rt=new WeakMap,Jo=new WeakMap,Xi=new WeakMap,Sn=new WeakMap,gs=new WeakMap,ps=new WeakMap,ye=new WeakSet,Xl=async function(){const t=this.getMediaStreamConstraints();if(typeof t.video=="boolean"&&(t.video={}),!t.video.deviceId){if(j(this,ci,"f"))delete t.video.facingMode,t.video.deviceId={exact:j(this,ci,"f")};else if(this.ifSaveLastUsedCamera&&xe.isStorageAvailable&&window.localStorage.getItem("dce_last_camera_id")){delete t.video.facingMode,t.video.deviceId={ideal:window.localStorage.getItem("dce_last_camera_id")};const e=JSON.parse(window.localStorage.getItem("dce_last_apply_width")),n=JSON.parse(window.localStorage.getItem("dce_last_apply_height"));e&&n&&(t.video.width=e,t.video.height=n)}else if(!this.ifSkipCameraInspection){const e=async h=>{let g=null;return h==="environment"&&["Android","HarmonyOS","iPhone","iPad"].includes(tt.OS)?(await this._getCameras(!1),j(this,ye,"m",Gt).call(this),g=xe.findBestCamera(this._arrCameras,"environment",{getMainCameraInIOS:this.selectIOSRearMainCameraAsDefault})):h||["Android","HarmonyOS","iPhone","iPad"].includes(tt.OS)||(await this._getCameras(!1),j(this,ye,"m",Gt).call(this),g=xe.findBestCamera(this._arrCameras,null,{getMainCameraInIOS:this.selectIOSRearMainCameraAsDefault})),g};let n=t.video.facingMode;n instanceof Array&&n.length&&(n=n[0]),typeof n=="object"&&(n=n.exact||n.ideal);const o=await e(n);o&&(delete t.video.facingMode,t.video.deviceId={exact:o})}}return t},Gt=function(){if(j(this,qt,"f")){const t=new Error("The operation was interrupted.");throw t.name="AbortError",t}},wo=async function(t){var e,n;if(!(!((n=(e=window==null?void 0:window.navigator)===null||e===void 0?void 0:e.mediaDevices)===null||n===void 0)&&n.getUserMedia))throw new Error("Failed to access the camera because the browser is too old or the page is loaded from an insecure origin.");let o;try{xe._onLog&&xe._onLog("======try getUserMedia========");let h=[0,500],g=null;const m=async v=>{for(let C of h){C&&(await new Promise(E=>setTimeout(E,C)),j(this,ye,"m",Gt).call(this));try{xe._onLog&&xe._onLog("ask "+JSON.stringify(v)),o=await navigator.mediaDevices.getUserMedia(v),j(this,ye,"m",Gt).call(this);break}catch(E){if(E.name==="NotFoundError"||E.name==="NotAllowedError"||E.name==="AbortError"||E.name==="OverconstrainedError")throw E;g=E,xe._onLog&&xe._onLog(E.message||E)}}};if(await m(t),o||(xe._onLog&&xe._onLog("======try getUserMedia again========"),xe._onLog&&xe._onLog(t),await m(t)),o||(h=[1e3,2e3],await m(t)),o||await m(t),!o)throw g;return o}catch(h){throw o==null||o.getTracks().forEach(g=>{g.stop()}),h.name==="NotFoundError"&&(DOMException?h=new DOMException("No camera available, please use a device with an accessible camera.",h.name):(h=new Error("No camera available, please use a device with an accessible camera.")).name="NotFoundError"),h}},Co=function(){this._mediaStream&&(this._mediaStream.getTracks().forEach(t=>{t.stop()}),this._mediaStream=null),Fe(this,ke,null,"f")},Rn=async function(){Fe(this,qt,!1,"f");const t=Fe(this,fs,Symbol(),"f");if(j(this,gi,"f")&&j(this,Rt,"f")==="pending"){try{await j(this,gi,"f")}catch{}j(this,ye,"m",Gt).call(this)}return t!==j(this,fs,"f")?void 0:Fe(this,gi,(async()=>{Fe(this,Rt,"pending","f");try{if(this.videoSrc){if(!j(this,Oe,"f"))throw new Error("'videoEl' should be set.");await xe.playVideo(j(this,Oe,"f"),this.videoSrc,this.cameraOpenTimeout),j(this,ye,"m",Gt).call(this)}else{let n=await j(this,ye,"m",Xl).call(this);j(this,ye,"m",Co).call(this);let o=await j(this,ye,"m",wo).call(this,n);await this._getCameras(!1),j(this,ye,"m",Gt).call(this);const h=()=>{const C=o.getVideoTracks();let E,I;if(C.length&&(E=C[0]),E){const R=E.getSettings();if(R){for(let L of this._arrCameras)if(R.deviceId===L.deviceId){L._checked=!0,L.label=E.label,I=L;break}}}return I},g=j(this,Xe,"f");if(typeof g.video=="object"){let C=g.video.facingMode;if(C instanceof Array&&C.length&&(C=C[0]),typeof C=="object"&&(C=C.exact||C.ideal),!(j(this,ci,"f")||this.ifSaveLastUsedCamera&&xe.isStorageAvailable&&window.localStorage.getItem("dce_last_camera_id")||this.ifSkipCameraInspection||g.video.deviceId)){const E=h(),I=xe.findBestCamera(this._arrCameras,C,{getMainCameraInIOS:this.selectIOSRearMainCameraAsDefault});I&&I!=(E==null?void 0:E.deviceId)&&(o.getTracks().forEach(R=>{R.stop()}),n.video.deviceId={exact:I},o=await j(this,ye,"m",wo).call(this,n),j(this,ye,"m",Gt).call(this))}}const m=h();m!=null&&m.deviceId&&(Fe(this,ci,m&&m.deviceId,"f"),this.ifSaveLastUsedCamera&&xe.isStorageAvailable&&(window.localStorage.setItem("dce_last_camera_id",j(this,ci,"f")),typeof n.video=="object"&&n.video.width&&n.video.height&&(window.localStorage.setItem("dce_last_apply_width",JSON.stringify(n.video.width)),window.localStorage.setItem("dce_last_apply_height",JSON.stringify(n.video.height))))),j(this,Oe,"f")&&(await xe.playVideo(j(this,Oe,"f"),o,this.cameraOpenTimeout),j(this,ye,"m",Gt).call(this)),this._mediaStream=o;const v=o.getVideoTracks();v!=null&&v.length&&Fe(this,ke,v[0],"f"),Fe(this,Bt,m,"f")}}catch(n){throw j(this,ye,"m",ks).call(this),Fe(this,Rt,null,"f"),n}Fe(this,Rt,"fulfilled","f")})(),"f")},_r=async function(){var t;if(this.state==="closed"||this.videoSrc)return;const e=(t=j(this,Bt,"f"))===null||t===void 0?void 0:t.deviceId,n=this.getResolution();await j(this,ye,"m",Rn).call(this);const o=this.getResolution();e&&e!==j(this,Bt,"f").deviceId&&j(this,rt,"f").fire("camera:changed",[j(this,Bt,"f").deviceId,e],{target:this,async:!0}),n.width==o.width&&n.height==o.height||j(this,rt,"f").fire("resolution:changed",[{width:o.width,height:o.height},{width:n.width,height:n.height}],{target:this,async:!0}),j(this,rt,"f").fire("played",null,{target:this,async:!0})},ks=function(){j(this,ye,"m",Co).call(this),Fe(this,Bt,null,"f"),j(this,Oe,"f")&&(j(this,Oe,"f").srcObject=null,this.videoSrc&&(j(this,Oe,"f").pause(),j(this,Oe,"f").currentTime=0)),Fe(this,qt,!0,"f");try{this.resetSoftwareScale()}catch{}},xt=async function t(e,n){const o=X=>{if(!j(this,ke,"f")||!this.isVideoPlaying||X.focusTaskId!=this._focusParameters.curFocusTaskId){j(this,ke,"f")&&this.isVideoPlaying||(this._focusParameters.isDoingFocus=0);const K=new Error(`Focus task ${X.focusTaskId} canceled.`);throw K.name="DeprecatedTaskError",K}this._focusParameters.isDoingFocus===1&&Date.now()-X.timeStart>this._focusParameters.focusCancelableTime&&(this._focusParameters.isDoingFocus=-1)};let h;n=Ct(n,this._focusParameters.fds.min,this._focusParameters.fds.step,this._focusParameters.fds.max),await j(this,ke,"f").applyConstraints({advanced:[{focusMode:"manual",focusDistance:n}]}),o(e),h=this._focusParameters.oldDistance==null?this._focusParameters.kTimeout*Math.max(Math.abs(1/this._focusParameters.fds.min-1/n),Math.abs(1/this._focusParameters.fds.max-1/n))+this._focusParameters.minTimeout:this._focusParameters.kTimeout*Math.abs(1/this._focusParameters.oldDistance-1/n)+this._focusParameters.minTimeout,this._focusParameters.oldDistance=n,await new Promise(X=>{setTimeout(X,h)}),o(e);let g=e.focusL-e.focusW/2,m=e.focusT-e.focusH/2,v=e.focusW,C=e.focusH;const E=this.getResolution();if(g>=E.width||m>=E.height)throw new Error("Invalid area.");g+v>E.width&&(v=E.width-g),m+C>E.height&&(C=E.height-m),g=Math.round(g),m=Math.round(m),v=Math.round(v),C=Math.round(C);const I=4*E.width*E.height*this._focusParameters.defaultTempBufferContainerLenRatio,R=4*v*C;let L=this._focusParameters.tempBufferContainer;if(L){const X=L.length;I>X&&I>=R?L=new Uint8Array(I):R>X&&R>=I&&(L=new Uint8Array(R))}else L=this._focusParameters.tempBufferContainer=new Uint8Array(Math.max(I,R));if(!this.imageDataGetter.getImageData(j(this,Oe,"f"),E.width,E.height,{sx:g,sy:m,sWidth:v,sHeight:C,dWidth:v,dHeight:C},{pixelFormat:Be.RGBA,bufferContainer:L}))return j(this,ye,"m",t).call(this,e,n);const N=L;let Y=0;for(let X=0,K=R-8;X<K;++X){let J=N[X]-N[X+8];++X;let te=N[X]-N[X+8];++X;let ne=N[X]-N[X+8];++X,Y+=J*J+te*te+ne*ne}return-Y},dn=async function t(e,n,o,h,g,m,v){let C;if(n=Ct(n,this._focusParameters.fds.min,this._focusParameters.fds.step,this._focusParameters.fds.max),h=Ct(h,this._focusParameters.fds.min,this._focusParameters.fds.step,this._focusParameters.fds.max),m?m=Ct(m,this._focusParameters.fds.min,this._focusParameters.fds.step,this._focusParameters.fds.max):(m=Ct(Math.sqrt((n||this._focusParameters.fds.step)*(h||this._focusParameters.fds.step)),this._focusParameters.fds.min,this._focusParameters.fds.step,this._focusParameters.fds.max),v=await j(this,ye,"m",xt).call(this,e,m)),v<=o&&v<=g?C=3:o<g&&o<v?C=1:g<o&&g<v&&(C=2),(h-n)/2<=this._focusParameters.fds.step)return C===3||(C===1?await j(this,ke,"f").applyConstraints({advanced:[{focusMode:"manual",focusDistance:n}]}):C===2&&await j(this,ke,"f").applyConstraints({advanced:[{focusMode:"manual",focusDistance:h}]})),!0;if(C===1)return await j(this,ye,"m",t).call(this,e,n,o,m,v);if(C===2)return await j(this,ye,"m",t).call(this,e,m,v,h,g);if(C!==3)return o=await j(this,ye,"m",xt).call(this,e,n),g=await j(this,ye,"m",xt).call(this,e,h),await j(this,ye,"m",t).call(this,e,n,o,h,g);let E=Ct(Math.sqrt((n||this._focusParameters.fds.step)*(m||this._focusParameters.fds.step)),this._focusParameters.fds.min,this._focusParameters.fds.step,this._focusParameters.fds.max),I=Ct(Math.sqrt((h||this._focusParameters.fds.step)*(m||this._focusParameters.fds.step)),this._focusParameters.fds.min,this._focusParameters.fds.step,this._focusParameters.fds.max);if(Math.abs(1/this._focusParameters.oldDistance-1/E)<=Math.abs(1/this._focusParameters.oldDistance-1/I)){let R=await j(this,ye,"m",xt).call(this,e,E);if(R<v)return await j(this,ye,"m",t).call(this,e,n,o,m,v,E,R);if(R==v)return await j(this,ye,"m",t).call(this,e,E,R,m,v);let L=await j(this,ye,"m",xt).call(this,e,I);if(R>v&&v<L)return await j(this,ye,"m",t).call(this,e,E,R,I,L,m,v);if(v==L)return await j(this,ye,"m",t).call(this,e,m,v,I,L);if(v>L)return await j(this,ye,"m",t).call(this,e,m,v,h,g,I,L)}else{let R=await j(this,ye,"m",xt).call(this,e,I);if(v>R)return await j(this,ye,"m",t).call(this,e,m,v,h,g,I,R);if(v==R)return await j(this,ye,"m",t).call(this,e,m,v,I,R);let L=await j(this,ye,"m",xt).call(this,e,E);if(L>v&&v<R)return await j(this,ye,"m",t).call(this,e,E,L,I,R,m,v);if(L==v)return await j(this,ye,"m",t).call(this,e,E,L,m,v);if(L<v)return await j(this,ye,"m",t).call(this,e,n,o,m,v,E,L)}return!1},Qo=async function(t,e,n,o,h){var g;if(this._focusParameters.isDoingFocus==1)return!1;if(!t||typeof t.x!="string"||typeof t.y!="string")throw new Error("Invalid 'centerPoint'.");if(!e||typeof e!="string")throw new Error("Invalid 'width'.");if(!n||typeof n!="string")throw new Error("Invalid 'height'.");const m=this.getResolution();let v=0,C=0;if(t.x.endsWith("px"))v=parseFloat(t.x);else{if(!t.x.endsWith("%"))throw new Error("Invalid 'centerPoint'.");v=parseFloat(t.x)/100*m.width}if(t.y.endsWith("px"))C=parseFloat(t.y);else{if(!t.y.endsWith("%"))throw new Error("Invalid 'centerPoint'.");C=parseFloat(t.y)/100*m.height}if(isNaN(v)||isNaN(C)||v<0||v>m.width||C<0||C>m.height)throw new Error("Invalid 'centerPoint'.");let E=0;if(e.endsWith("px"))E=parseFloat(e);else{if(!e.endsWith("%"))throw new Error("Invalid 'width'.");E=parseFloat(e)/100*m.width}if(isNaN(E)||E<0)throw new Error("Invalid 'width'.");let I=0;if(n.endsWith("px"))I=parseFloat(n);else{if(!n.endsWith("%"))throw new Error("Invalid 'height'.");I=parseFloat(n)/100*m.height}if(isNaN(I)||I<0)throw new Error("Invalid 'height'.");if(j(this,hi,"f")!==1){const N=j(this,hi,"f"),Y=j(this,ui,"f");E/=N,I/=N,v=(1-1/N)*Y.x+v/N,C=(1-1/N)*Y.y+C/N}if(!this._focusSupported)throw new Error("Manual focus unsupported.");if(!this._focusParameters.fds&&(this._focusParameters.fds=(g=this.getCameraCapabilities())===null||g===void 0?void 0:g.focusDistance,!this._focusParameters.fds))throw this._focusSupported=!1,new Error("Manual focus unsupported.");this._focusParameters.kTimeout==null&&(this._focusParameters.kTimeout=(this._focusParameters.maxTimeout-this._focusParameters.minTimeout)/(1/this._focusParameters.fds.min-1/this._focusParameters.fds.max)),this._focusParameters.isDoingFocus=1;const R={focusL:v,focusT:C,focusW:E,focusH:I,focusTaskId:++this._focusParameters.curFocusTaskId,timeStart:Date.now()},L=async(N,Y,X)=>{try{(Y==null||Y<this._focusParameters.fds.min)&&(Y=this._focusParameters.fds.min),(X==null||X>this._focusParameters.fds.max)&&(X=this._focusParameters.fds.max),this._focusParameters.oldDistance=null;let K=Ct(Math.sqrt(X*(Y||this._focusParameters.fds.step)),this._focusParameters.fds.min,this._focusParameters.fds.step,this._focusParameters.fds.max),J=Ct(Math.sqrt((Y||this._focusParameters.fds.step)*K),this._focusParameters.fds.min,this._focusParameters.fds.step,this._focusParameters.fds.max),te=Ct(Math.sqrt(K*X),this._focusParameters.fds.min,this._focusParameters.fds.step,this._focusParameters.fds.max),ne=await j(this,ye,"m",xt).call(this,N,te),pe=await j(this,ye,"m",xt).call(this,N,J),he=await j(this,ye,"m",xt).call(this,N,K);if(pe>he&&he<ne){const le=await j(this,ye,"m",dn).call(this,N,J,pe,te,ne,K,he);return this._focusParameters.isDoingFocus=0,le}if(pe<he&&pe<ne){let le=await j(this,ye,"m",xt).call(this,N,Y);const be=await j(this,ye,"m",dn).call(this,N,Y,le,K,he,J,pe);return this._focusParameters.isDoingFocus=0,be}if(he>ne&&pe>ne){let le=await j(this,ye,"m",xt).call(this,N,X);const be=await j(this,ye,"m",dn).call(this,N,K,he,X,le,te,ne);return this._focusParameters.isDoingFocus=0,be}if(pe==he&&he<ne){const le=await j(this,ye,"m",dn).call(this,N,J,pe,K,he);return this._focusParameters.isDoingFocus=0,le}if(he==ne&&pe>he){const le=await j(this,ye,"m",dn).call(this,N,K,he,te,ne);return this._focusParameters.isDoingFocus=0,le}return L(N,Y,X)}catch(K){if(K.name!=="DeprecatedTaskError")throw K}};return L(R,o,h)},ea=function(t){if(this.state!=="opened")throw new Error("Video is not playing.");if(!t||typeof t.x!="string"||typeof t.y!="string")throw new Error("Invalid 'center'.");const e=this.getResolution();let n=0,o=0;if(t.x.endsWith("px"))n=parseFloat(t.x);else{if(!t.x.endsWith("%"))throw new Error("Invalid scale center.");n=parseFloat(t.x)/100*e.width}if(t.y.endsWith("px"))o=parseFloat(t.y);else{if(!t.y.endsWith("%"))throw new Error("Invalid scale center.");o=parseFloat(t.y)/100*e.height}if(isNaN(n)||isNaN(o))throw new Error("Invalid scale center.");Fe(this,ui,{x:n,y:o},"f")},ph=function(t){if(this.state!=="opened")throw new Error("Video is not playing.");const e=this.getResolution();return t&&t.x==e.width/2&&t.y==e.height/2},xe.browserInfo=tt,xe.onWarning=(yo=window==null?void 0:window.console)===null||yo===void 0?void 0:yo.warn;class pi{constructor(e){Tr.add(this),Bs.set(this,void 0),Dn.set(this,0),Ji.set(this,void 0),Ns.set(this,0),In.set(this,!1),Ee(this,Bs,e,"f")}startCharging(){S(this,In,"f")||(pi._onLog&&pi._onLog("start charging."),S(this,Tr,"m",mh).call(this),Ee(this,In,!0,"f"))}stopCharging(){S(this,Ji,"f")&&clearTimeout(S(this,Ji,"f")),S(this,In,"f")&&(pi._onLog&&pi._onLog("stop charging."),Ee(this,Dn,Date.now()-S(this,Ns,"f"),"f"),Ee(this,In,!1,"f"))}}Bs=new WeakMap,Dn=new WeakMap,Ji=new WeakMap,Ns=new WeakMap,In=new WeakMap,Tr=new WeakSet,zl=function(){ot.cfd(1),pi._onLog&&pi._onLog("charge 1.")},mh=function t(){S(this,Dn,"f")==0&&S(this,Tr,"m",zl).call(this),Ee(this,Ns,Date.now(),"f"),S(this,Ji,"f")&&clearTimeout(S(this,Ji,"f")),Ee(this,Ji,setTimeout(()=>{Ee(this,Dn,0,"f"),S(this,Tr,"m",t).call(this)},S(this,Bs,"f")-S(this,Dn,"f")),"f")};const $l=new Map([[Te.IPF_GRAYSCALED,Be.GREY],[Te.IPF_ABGR_8888,Be.RGBA],[Te.IPF_ARGB_8888,Be.BGRA]]),Kl=new Map([[Be.GREY,Te.IPF_GRAYSCALED],[Be.RGBA,Te.IPF_ABGR_8888],[Be.BGRA,Te.IPF_ARGB_8888]]),Eo=typeof BigInt=="function"?{BF_NULL:BigInt(0),BF_ALL:BigInt(18446744073709552e3),BF_DEFAULT:BigInt(4265345023),BF_ONED:BigInt(3147775),BF_GS1_DATABAR:BigInt(260096),BF_CODE_39:BigInt(1),BF_CODE_128:BigInt(2),BF_CODE_93:BigInt(4),BF_CODABAR:BigInt(8),BF_ITF:BigInt(16),BF_EAN_13:BigInt(32),BF_EAN_8:BigInt(64),BF_UPC_A:BigInt(128),BF_UPC_E:BigInt(256),BF_INDUSTRIAL_25:BigInt(512),BF_CODE_39_EXTENDED:BigInt(1024),BF_GS1_DATABAR_OMNIDIRECTIONAL:BigInt(2048),BF_GS1_DATABAR_TRUNCATED:BigInt(4096),BF_GS1_DATABAR_STACKED:BigInt(8192),BF_GS1_DATABAR_STACKED_OMNIDIRECTIONAL:BigInt(16384),BF_GS1_DATABAR_EXPANDED:BigInt(32768),BF_GS1_DATABAR_EXPANDED_STACKED:BigInt(65536),BF_GS1_DATABAR_LIMITED:BigInt(131072),BF_PATCHCODE:BigInt(262144),BF_CODE_32:BigInt(16777216),BF_PDF417:BigInt(33554432),BF_QR_CODE:BigInt(67108864),BF_DATAMATRIX:BigInt(134217728),BF_AZTEC:BigInt(268435456),BF_MAXICODE:BigInt(536870912),BF_MICRO_QR:BigInt(1073741824),BF_MICRO_PDF417:BigInt(524288),BF_GS1_COMPOSITE:BigInt(2147483648),BF_MSI_CODE:BigInt(1048576),BF_CODE_11:BigInt(2097152),BF_TWO_DIGIT_ADD_ON:BigInt(4194304),BF_FIVE_DIGIT_ADD_ON:BigInt(8388608),BF_MATRIX_25:BigInt(68719476736),BF_POSTALCODE:BigInt(0x3f0000000000000),BF_NONSTANDARD_BARCODE:BigInt(4294967296),BF_USPSINTELLIGENTMAIL:BigInt(4503599627370496),BF_POSTNET:BigInt(9007199254740992),BF_PLANET:BigInt(0x40000000000000),BF_AUSTRALIANPOST:BigInt(0x80000000000000),BF_RM4SCC:BigInt(72057594037927940),BF_KIX:BigInt(0x200000000000000),BF_DOTCODE:BigInt(8589934592),BF_PHARMACODE_ONE_TRACK:BigInt(17179869184),BF_PHARMACODE_TWO_TRACK:BigInt(34359738368),BF_PHARMACODE:BigInt(51539607552)}:{BF_NULL:"0x00",BF_ALL:"0xFFFFFFFFFFFFFFFF",BF_DEFAULT:"0xFE3BFFFF",BF_ONED:"0x003007FF",BF_GS1_DATABAR:"0x0003F800",BF_CODE_39:"0x1",BF_CODE_128:"0x2",BF_CODE_93:"0x4",BF_CODABAR:"0x8",BF_ITF:"0x10",BF_EAN_13:"0x20",BF_EAN_8:"0x40",BF_UPC_A:"0x80",BF_UPC_E:"0x100",BF_INDUSTRIAL_25:"0x200",BF_CODE_39_EXTENDED:"0x400",BF_GS1_DATABAR_OMNIDIRECTIONAL:"0x800",BF_GS1_DATABAR_TRUNCATED:"0x1000",BF_GS1_DATABAR_STACKED:"0x2000",BF_GS1_DATABAR_STACKED_OMNIDIRECTIONAL:"0x4000",BF_GS1_DATABAR_EXPANDED:"0x8000",BF_GS1_DATABAR_EXPANDED_STACKED:"0x10000",BF_GS1_DATABAR_LIMITED:"0x20000",BF_PATCHCODE:"0x00040000",BF_CODE_32:"0x01000000",BF_PDF417:"0x02000000",BF_QR_CODE:"0x04000000",BF_DATAMATRIX:"0x08000000",BF_AZTEC:"0x10000000",BF_MAXICODE:"0x20000000",BF_MICRO_QR:"0x40000000",BF_MICRO_PDF417:"0x00080000",BF_GS1_COMPOSITE:"0x80000000",BF_MSI_CODE:"0x100000",BF_CODE_11:"0x200000",BF_TWO_DIGIT_ADD_ON:"0x400000",BF_FIVE_DIGIT_ADD_ON:"0x800000",BF_MATRIX_25:"0x1000000000",BF_POSTALCODE:"0x3F0000000000000",BF_NONSTANDARD_BARCODE:"0x100000000",BF_USPSINTELLIGENTMAIL:"0x10000000000000",BF_POSTNET:"0x20000000000000",BF_PLANET:"0x40000000000000",BF_AUSTRALIANPOST:"0x80000000000000",BF_RM4SCC:"0x100000000000000",BF_KIX:"0x200000000000000",BF_DOTCODE:"0x200000000",BF_PHARMACODE_ONE_TRACK:"0x400000000",BF_PHARMACODE_TWO_TRACK:"0x800000000",BF_PHARMACODE:"0xC00000000"};class Re extends Uo{static set _onLog(e){Ee(Re,ta,e,"f",ia),xe._onLog=e,pi._onLog=e}static get _onLog(){return S(Re,ta,"f",ia)}static async detectEnvironment(){return await(async()=>({wasm:hd,worker:ud,getUserMedia:sh,camera:await fd(),browser:gt.browser,version:gt.version,OS:gt.OS}))()}static async testCameraAccess(){const e=await xe.testCameraAccess();return e.ok?{ok:!0,message:"Successfully accessed the camera."}:e.errorName==="InsecureContext"?{ok:!1,message:"Insecure context."}:e.errorName==="OverconstrainedError"||e.errorName==="NotFoundError"?{ok:!1,message:"No camera detected."}:e.errorName==="NotAllowedError"?{ok:!1,message:"No permission to access camera."}:e.errorName==="AbortError"?{ok:!1,message:"Some problem occurred which prevented the device from being used."}:e.errorName==="NotReadableError"?{ok:!1,message:"A hardware error occurred."}:e.errorName==="SecurityError"?{ok:!1,message:"User media support is disabled."}:{ok:!1,message:e.errorMessage}}static async createInstance(e){var n,o;if(e&&!(e instanceof it))throw new TypeError("Invalid view.");if(!((n=bt.license)===null||n===void 0)&&n.LicenseManager){if(!(!((o=bt.license)===null||o===void 0)&&o.LicenseManager.bCallInitLicense))throw new Error("License is not set.");await ot.loadWasm(["license"]),await bt.license.dynamsoft()}const h=new Re(e);return Re.onWarning&&(location&&location.protocol==="file:"?setTimeout(()=>{Re.onWarning&&Re.onWarning({id:1,message:"The page is opened over file:// and Dynamsoft Camera Enhancer may not work properly. Please open the page via https://."})},0):window.isSecureContext!==!1&&navigator&&navigator.mediaDevices&&navigator.mediaDevices.getUserMedia||setTimeout(()=>{Re.onWarning&&Re.onWarning({id:2,message:"Dynamsoft Camera Enhancer may not work properly in a non-secure context. Please open the page via https://."})},0)),h}get video(){return S(this,ve,"f").getVideoEl()}set videoSrc(e){if(!S(this,ve,"f"))throw new Error("Camera manager is null.");S(this,we,"f")&&(S(this,we,"f")._hideDefaultSelection=!0),S(this,ve,"f").videoSrc=e}get videoSrc(){var e;return(e=S(this,ve,"f"))===null||e===void 0?void 0:e.videoSrc}set ifSaveLastUsedCamera(e){if(!S(this,ve,"f"))throw new Error("Camera manager is null.");S(this,ve,"f").ifSaveLastUsedCamera=e}get ifSaveLastUsedCamera(){var e;return(e=S(this,ve,"f"))===null||e===void 0?void 0:e.ifSaveLastUsedCamera}set ifSkipCameraInspection(e){if(!S(this,ve,"f"))throw new Error("Camera manager is null.");S(this,ve,"f").ifSkipCameraInspection=e}get ifSkipCameraInspection(){var e;return(e=S(this,ve,"f"))===null||e===void 0?void 0:e.ifSkipCameraInspection}set cameraOpenTimeout(e){if(!S(this,ve,"f"))throw new Error("Camera manager is null.");S(this,ve,"f").cameraOpenTimeout=e}get cameraOpenTimeout(){var e;return(e=S(this,ve,"f"))===null||e===void 0?void 0:e.cameraOpenTimeout}set singleFrameMode(e){if(!["disabled","image","camera"].includes(e))throw new Error("Invalid value.");if(this.isOpen())throw new Error("It is not allowed to change `singleFrameMode` when the camera is open.");Ee(this,ms,e,"f")}get singleFrameMode(){return S(this,ms,"f")}get _isFetchingStarted(){return S(this,oi,"f")}get disposed(){return S(this,na,"f")}constructor(e){if(super(),Pe.add(this),ve.set(this,void 0),we.set(this,void 0),vr.set(this,"closed"),si.set(this,void 0),zi.set(this,!1),ms.set(this,void 0),this._onCameraSelChange=async()=>{this.isOpen()&&S(this,we,"f")&&!S(this,we,"f").disposed&&await this.selectCamera(S(this,we,"f")._selCam.value)},this._onResolutionSelChange=async()=>{if(!this.isOpen()||!S(this,we,"f")||S(this,we,"f").disposed)return;let n,o;if(S(this,we,"f")._selRsl&&S(this,we,"f")._selRsl.selectedIndex!=-1){let h=S(this,we,"f")._selRsl.options[S(this,we,"f")._selRsl.selectedIndex];n=parseInt(h.getAttribute("data-width")),o=parseInt(h.getAttribute("data-height"))}await this.setResolution({width:n,height:o})},this._onCloseBtnClick=async()=>{this.isOpen()&&S(this,we,"f")&&!S(this,we,"f").disposed&&this.close()},_s.set(this,(n,o,h,g)=>{const m=Date.now(),v={sx:g.x,sy:g.y,sWidth:g.width,sHeight:g.height,dWidth:g.width,dHeight:g.height},C=Math.max(v.dWidth,v.dHeight);if(this.canvasSizeLimit&&C>this.canvasSizeLimit){const R=this.canvasSizeLimit/C;v.dWidth>v.dHeight?(v.dWidth=this.canvasSizeLimit,v.dHeight=Math.round(v.dHeight*R)):(v.dWidth=Math.round(v.dWidth*R),v.dHeight=this.canvasSizeLimit)}const E=S(this,ve,"f").imageDataGetter.getImageData(n,o,h,v,{pixelFormat:$l.get(this.getPixelFormat())});let I=null;if(E){const R=Date.now();let L;E.pixelFormat===Be.GREY?L=E.width:L=4*E.width;let N=!0;v.sx===0&&v.sy===0&&v.sWidth===o&&v.sHeight===h&&(N=!1),I={bytes:E.data,width:E.width,height:E.height,stride:L,format:Kl.get(E.pixelFormat),tag:{imageId:this._imageId==Number.MAX_VALUE?this._imageId=0:++this._imageId,type:Ls.ITT_FILE_IMAGE,isCropped:N,cropRegion:{left:g.x,top:g.y,right:g.x+g.width,bottom:g.y+g.height,isMeasuredInPercentage:!1},originalWidth:o,originalHeight:h,currentWidth:E.width,currentHeight:E.height,timeSpent:R-m,timeStamp:R},toCanvas:S(this,vs,"f"),isDCEFrame:!0}}return I}),this._onSingleFrameAcquired=n=>{let o;o=S(this,we,"f")?S(this,we,"f").getConvertedRegion():Qr.convert(S(this,$i,"f"),n.width,n.height),o||(o={x:0,y:0,width:n.width,height:n.height});const h=S(this,_s,"f").call(this,n,n.width,n.height,o);S(this,si,"f").fire("singleFrameAcquired",[h],{async:!1,copy:!1})},vs.set(this,function(){if(!(this.bytes instanceof Uint8Array||this.bytes instanceof Uint8ClampedArray))throw new TypeError("Invalid bytes.");if(typeof this.width!="number"||this.width<=0)throw new Error("Invalid width.");if(typeof this.height!="number"||this.height<=0)throw new Error("Invalid height.");const n=document.createElement("canvas");let o;if(n.width=this.width,n.height=this.height,this.format===Te.IPF_GRAYSCALED){o=new Uint8ClampedArray(this.width*this.height*4);for(let h=0;h<o.length;h+=4)o[h]=this.bytes[h/4],o[h+1]=this.bytes[h/4],o[h+2]=this.bytes[h/4],o[h+3]=255}else o=new Uint8ClampedArray(this.bytes.buffer);return n.getContext("2d").putImageData(new ImageData(o,this.width,this.height),0,0),n}),br.set(this,void 0),$i.set(this,void 0),ys.set(this,Te.IPF_ABGR_8888),oi.set(this,!1),this._imageId=-1,Lt.set(this,void 0),this.fetchInterval=0,ze.set(this,{enhancedFocus:!1,autoZoom:!1,tapToFocus:!1}),de.set(this,{minValue:1,maxValue:999,autoFocusFrameArray:[],autoFocusFrameLimit:[5,3],autoZoomDetectionArea:.5,autoZoomTargetBorder:.9,autoZoomIdealArea:[0,.05],autoZoomInFrameArray:[],autoZoomInFrameLimit:[5,3],autoZoomInMaxTimes:5,autoZoomInMinStep:Math.pow(10,.2),autoZoomInIdealModuleSize:6,autoZoomOutFrameCount:0,autoZoomOutFrameLimit:3,autoZoomOutStepRate:1/3,autoZoomOutStepRate_2:.05,autoZoomOutMinStep:2,frameArrayInIdealZoom:[],frameLimitInIdealZoom:[5,3],nextActionInIdealZoom:"focus",noIntermediateResultsCount:[],enableZoomOutInIdealZoom:!1}),zt.set(this,void 0),na.set(this,!1),this.isCameraEnhancer=!0,e&&!(e instanceof it))throw new TypeError("Invalid view.");Ee(this,si,new ah,"f"),Ee(this,ve,new xe,"f"),this._imageDataGetter=S(this,ve,"f").imageDataGetter,S(this,ve,"f").updateVideoElWhenSoftwareScaled=()=>{if(!this.video)return;const n=S(this,ve,"f").getSoftwareScale();if(n<1)throw new RangeError("Invalid scale value.");S(this,we,"f")&&!S(this,we,"f").disposed?(this.video.style.transform=n===1?"":`scale(${n})`,S(this,we,"f")._updateVideoContainer()):this.video.style.transform=n===1?"":`scale(${n})`},["iPhone","iPad","Android","HarmonyOS"].includes(gt.OS)?S(this,ve,"f").setResolution(1280,720):S(this,ve,"f").setResolution(1920,1080),navigator&&navigator.mediaDevices&&navigator.mediaDevices.getUserMedia?this.singleFrameMode="disabled":this.singleFrameMode="image",e&&this.setCameraView(e),this._on("before:camera:change",()=>{S(this,zt,"f").stopCharging();const n=S(this,we,"f");n&&!n.disposed&&(n._startLoading(),n.clearAllInnerDrawingItems())}),this._on("camera:changed",()=>{this.clearBuffer()}),this._on("before:resolution:change",()=>{const n=S(this,we,"f");n&&!n.disposed&&(n._startLoading(),n.clearAllInnerDrawingItems())}),this._on("resolution:changed",()=>{this.clearBuffer(),e.eventHandler.fire("content:updated",null,{async:!1})}),this._on("paused",()=>{S(this,zt,"f").stopCharging();const n=S(this,we,"f");n&&n.disposed}),this._on("resumed",()=>{const n=S(this,we,"f");n&&n.disposed}),this._on("tapfocus",()=>{S(this,ze,"f").tapToFocus&&S(this,zt,"f").startCharging()}),this._intermediateResultReceiver={},this._intermediateResultReceiver.onTaskResultsReceived=async(n,o)=>{var h,g,m,v;if(S(this,Pe,"m",$e).call(this)||!this.isOpen()||this.isPaused())return;const C=n.intermediateResultUnits;Re._onLog&&(Re._onLog("intermediateResultUnits:"),Re._onLog(C));let E=!1,I=!1;for(let R of C){if(R.unitType===An.IRUT_DECODED_BARCODES&&R.decodedBarcodes.length){E=!0;break}R.unitType===An.IRUT_LOCALIZED_BARCODES&&R.localizedBarcodes.length&&(I=!0)}if(Re._onLog&&(Re._onLog("hasLocalizedBarcodes:"),Re._onLog(I)),S(this,ze,"f").autoZoom||S(this,ze,"f").enhancedFocus)if(E)S(this,de,"f").autoZoomInFrameArray.length=0,S(this,de,"f").autoZoomOutFrameCount=0,S(this,de,"f").frameArrayInIdealZoom.length=0,S(this,ze,"f").autoZoom&&S(this,ze,"f").enhancedFocus&&(S(this,de,"f").nextActionInIdealZoom="focus"),S(this,de,"f").autoFocusFrameArray.length=0,S(this,de,"f").noIntermediateResultsCount=0;else{const R=async N=>{await this.setZoom(N),S(this,ze,"f").autoZoom&&S(this,zt,"f").startCharging()},L=async N=>{await this.setFocus(N),S(this,ze,"f").enhancedFocus&&S(this,zt,"f").startCharging()};if(I){const N=C[0].originalImageTag,Y=((h=N.cropRegion)===null||h===void 0?void 0:h.left)||0,X=((g=N.cropRegion)===null||g===void 0?void 0:g.top)||0,K=!((m=N.cropRegion)===null||m===void 0)&&m.right?N.cropRegion.right-Y:N.originalWidth,J=!((v=N.cropRegion)===null||v===void 0)&&v.bottom?N.cropRegion.bottom-X:N.originalHeight,te=N.currentWidth,ne=N.currentHeight;let pe;{let he,le,be,y,_e;{const l=this.video.videoWidth*(1-S(this,de,"f").autoZoomDetectionArea)/2,s=this.video.videoWidth*(1+S(this,de,"f").autoZoomDetectionArea)/2,a=s,u=l,i=this.video.videoHeight*(1-S(this,de,"f").autoZoomDetectionArea)/2,r=i,c=this.video.videoHeight*(1+S(this,de,"f").autoZoomDetectionArea)/2;_e=[{x:l,y:i},{x:s,y:r},{x:a,y:c},{x:u,y:c}]}Re._onLog&&(Re._onLog("detectionArea:"),Re._onLog(_e));const Ce=[];{const l=(s,a)=>{const u=(r,c)=>{if(!r&&!c)throw new Error("Invalid arguments.");return function(p,f,d){let _=!1;const w=p.length;if(w<=2)return!1;for(let T=0;T<w;T++){const x=p[T],b=p[(T+1)%w];if(gd(x,b,{x:f,y:d}))return!0;_o(x.y-d)>0!=_o(b.y-d)>0&&_o(f-(d-x.y)*(x.x-b.x)/(x.y-b.y)-x.x)<0&&(_=!_)}return _}(c,r.x,r.y)},i=(r,c)=>!!(Vr([r[0],r[1]],[r[2],r[3]],[c[0].x,c[0].y],[c[1].x,c[1].y])||Vr([r[0],r[1]],[r[2],r[3]],[c[1].x,c[1].y],[c[2].x,c[2].y])||Vr([r[0],r[1]],[r[2],r[3]],[c[2].x,c[2].y],[c[3].x,c[3].y])||Vr([r[0],r[1]],[r[2],r[3]],[c[3].x,c[3].y],[c[0].x,c[0].y]));return!!(u({x:s[0].x,y:s[0].y},a)||u({x:s[1].x,y:s[1].y},a)||u({x:s[2].x,y:s[2].y},a)||u({x:s[3].x,y:s[3].y},a))||!!(u({x:a[0].x,y:a[0].y},s)||u({x:a[1].x,y:a[1].y},s)||u({x:a[2].x,y:a[2].y},s)||u({x:a[3].x,y:a[3].y},s))||!!(i([a[0].x,a[0].y,a[1].x,a[1].y],s)||i([a[1].x,a[1].y,a[2].x,a[2].y],s)||i([a[2].x,a[2].y,a[3].x,a[3].y],s)||i([a[3].x,a[3].y,a[0].x,a[0].y],s))};for(let s of C)if(s.unitType===An.IRUT_LOCALIZED_BARCODES)for(let a of s.localizedBarcodes){if(!a)continue;const u=a.location.points;u.forEach(i=>{it._transformCoordinates(i,Y,X,K,J,te,ne)}),l(_e,u)&&Ce.push(a)}if(Re._debug&&S(this,we,"f")){const s=this.__layer||(this.__layer=S(this,we,"f")._createDrawingLayer(99));s.clearDrawingItems();const a=this.__styleId2||(this.__styleId2=ue.createDrawingStyle({strokeStyle:"red"}));for(let u of C)if(u.unitType===An.IRUT_LOCALIZED_BARCODES)for(let i of u.localizedBarcodes){if(!i)continue;const r=i.location.points,c=new Xo({points:r},a);s.addDrawingItems([c])}}}if(Re._onLog&&(Re._onLog("intersectedResults:"),Re._onLog(Ce)),!Ce.length)return;let ge;if(Ce.length){let l=Ce.filter(s=>s.possibleFormats==Eo.BF_QR_CODE||s.possibleFormats==Eo.BF_DATAMATRIX);if(l.length||(l=Ce.filter(s=>s.possibleFormats==Eo.BF_ONED),l.length||(l=Ce)),l.length){const s=u=>{const i=u.location.points,r=(i[0].x+i[1].x+i[2].x+i[3].x)/4,c=(i[0].y+i[1].y+i[2].y+i[3].y)/4;return(r-te/2)*(r-te/2)+(c-ne/2)*(c-ne/2)};ge=l[0];let a=s(ge);if(l.length!=1)for(let u=1;u<l.length;u++){const i=s(l[u]);(l[u].confidence>1.1*ge.confidence||l[u].confidence>.9*ge.confidence&&i<a)&&(ge=l[u],a=i)}}}if(Re._onLog&&(Re._onLog("highPriorityResult:"),Re._onLog(ge)),ge){const l=ge.location.points;he=Math.min(l[0].x,l[1].x,l[2].x,l[3].x),le=Math.max(l[0].x,l[1].x,l[2].x,l[3].x),be=Math.min(l[0].y,l[1].y,l[2].y,l[3].y),y=Math.max(l[0].y,l[1].y,l[2].y,l[3].y),pe={points:[{x:he,y:be},{x:le,y:be},{x:le,y},{x:he,y}],result:ge}}}if(Re._onLog&&(Re._onLog("boundingRect:"),Re._onLog(pe)),!pe)return;if(Re._debug&&S(this,we,"f")&&(pe!=null&&pe.points)){const he=this.__layer||(this.__layer=S(this,we,"f")._createDrawingLayer(99)),le=this.__styleId1||(this.__styleId1=ue.createDrawingStyle({strokeStyle:"blue"})),be=new Xo({points:pe.points},le);he.addDrawingItems([be])}if(S(this,de,"f").autoZoomOutFrameCount=0,S(this,de,"f").noIntermediateResultsCount=0,S(this,ze,"f").autoZoom){const he=S(this,de,"f").autoZoomIdealArea[1];let le=(1-S(this,de,"f").autoZoomTargetBorder)/2;const be=pe.points[0].x/K,y=(K-pe.points[2].x)/K,_e=pe.points[0].y/J,Ce=(J-pe.points[2].y)/J;if(be>he&&y>he&&_e>he&&Ce>he&&pe.result.moduleSize<S(this,de,"f").autoZoomInIdealModuleSize){if(S(this,de,"f").autoZoomInFrameArray.push(!0),S(this,de,"f").autoZoomInFrameArray.splice(0,S(this,de,"f").autoZoomInFrameArray.length-S(this,de,"f").autoZoomInFrameLimit[0]),S(this,de,"f").frameArrayInIdealZoom.length=0,S(this,ze,"f").enhancedFocus&&(S(this,de,"f").nextActionInIdealZoom="focus",L({mode:"continuous"}).catch(()=>{})),S(this,de,"f").autoZoomInFrameArray.filter(ge=>ge===!0).length>=S(this,de,"f").autoZoomInFrameLimit[1]){S(this,de,"f").autoZoomInFrameArray.length=0;const ge=[(.5-le)/(.5-be),(.5-le)/(.5-y),(.5-le)/(.5-_e),(.5-le)/(.5-Ce)].filter(i=>i>0),l=Math.min(...ge,S(this,de,"f").autoZoomInIdealModuleSize/pe.result.moduleSize),s=this.getZoomSettings().factor;let a=Math.max(Math.pow(s*l,1/S(this,de,"f").autoZoomInMaxTimes),S(this,de,"f").autoZoomInMinStep);a=Math.min(a,l);let u=s*a;u=Math.max(S(this,de,"f").minValue,u),u=Math.min(S(this,de,"f").maxValue,u);try{await R({factor:u})}catch(i){const r=i.message||i;console.warn(r)}this.clearBuffer()}}else if(S(this,de,"f").autoZoomInFrameArray.length=0,S(this,de,"f").frameArrayInIdealZoom.push(!0),S(this,de,"f").frameArrayInIdealZoom.splice(0,S(this,de,"f").frameArrayInIdealZoom.length-S(this,de,"f").frameLimitInIdealZoom[0]),S(this,de,"f").frameArrayInIdealZoom.filter(ge=>ge===!0).length>=S(this,de,"f").frameLimitInIdealZoom[1])if(S(this,de,"f").frameArrayInIdealZoom.length=0,S(this,de,"f").nextActionInIdealZoom==="focus"&&S(this,ze,"f").enhancedFocus){const ge=pe.points;try{await L({mode:"manual",area:{centerPoint:{x:(ge[0].x+ge[2].x)/2+"px",y:(ge[0].y+ge[2].y)/2+"px"},width:ge[2].x-ge[0].x+"px",height:ge[2].y-ge[0].y+"px"}})}catch(l){const s=l.message||l;console.warn(s)}this.clearBuffer()}else{if(S(this,de,"f").nextActionInIdealZoom!=="zoomOut"&&S(this,ze,"f").enhancedFocus)throw new Error("Invalid action.");if(S(this,de,"f").enableZoomOutInIdealZoom){le=S(this,de,"f").autoZoomIdealArea[1]+S(this,de,"f").autoZoomOutStepRate_2;const ge=[(.5-le)/(.5-be),(.5-le)/(.5-y),(.5-le)/(.5-_e),(.5-le)/(.5-Ce)].filter(s=>s>0);let l=Math.min(...ge)*this.getZoomSettings().factor;l=Math.max(S(this,de,"f").minValue,l),l=Math.min(S(this,de,"f").maxValue,l);try{await R({factor:l})}catch(s){const a=s.message||s;console.warn(a)}this.clearBuffer(),S(this,ze,"f").enhancedFocus&&(S(this,de,"f").nextActionInIdealZoom="focus",L({mode:"continuous"}).catch(()=>{}))}}}if(!S(this,ze,"f").autoZoom&&S(this,ze,"f").enhancedFocus&&(S(this,de,"f").autoFocusFrameArray.push(!0),S(this,de,"f").autoFocusFrameArray.splice(0,S(this,de,"f").autoFocusFrameArray.length-S(this,de,"f").autoFocusFrameLimit[0]),S(this,de,"f").autoFocusFrameArray.filter(he=>he===!0).length>=S(this,de,"f").autoFocusFrameLimit[1])){S(this,de,"f").autoFocusFrameArray.length=0;try{const he=pe.points;await L({mode:"manual",area:{centerPoint:{x:(he[0].x+he[2].x)/2+"px",y:(he[0].y+he[2].y)/2+"px"},width:he[2].x-he[0].x+"px",height:he[2].y-he[0].y+"px"}})}catch(he){const le=he.message||he;console.warn(le)}this.clearBuffer()}}else{if(S(this,de,"f").noIntermediateResultsCount++,S(this,ze,"f").autoZoom){if(S(this,de,"f").autoZoomInFrameArray.push(!1),S(this,de,"f").autoZoomInFrameArray.splice(0,S(this,de,"f").autoZoomInFrameArray.length-S(this,de,"f").autoZoomInFrameLimit[0]),S(this,de,"f").autoZoomOutFrameCount++,S(this,de,"f").frameArrayInIdealZoom.push(!1),S(this,de,"f").frameArrayInIdealZoom.splice(0,S(this,de,"f").frameArrayInIdealZoom.length-S(this,de,"f").frameLimitInIdealZoom[0]),S(this,de,"f").autoZoomOutFrameCount>=S(this,de,"f").autoZoomOutFrameLimit){S(this,de,"f").autoZoomOutFrameCount=0;const N=this.getZoomSettings().factor;let Y=N-Math.max((N-1)*S(this,de,"f").autoZoomOutStepRate,S(this,de,"f").autoZoomOutMinStep);Y=Math.max(S(this,de,"f").minValue,Y),Y=Math.min(S(this,de,"f").maxValue,Y);try{await R({factor:Y})}catch(X){const K=X.message||X;console.warn(K)}this.clearBuffer()}S(this,ze,"f").enhancedFocus&&(S(this,de,"f").nextActionInIdealZoom="focus",L({mode:"continuous"}).catch(()=>{}))}!S(this,ze,"f").autoZoom&&S(this,ze,"f").enhancedFocus&&(S(this,de,"f").autoFocusFrameArray.length=0,L({mode:"continuous"}).catch(()=>{}))}}},Ee(this,zt,new pi(1e4),"f")}setCameraView(e){if(!(e instanceof it))throw new TypeError("Invalid view.");if(e.disposed)throw new Error("The camera view has been disposed.");if(this.isOpen())throw new Error("It is not allowed to change camera view when the camera is open.");this.releaseCameraView(),e._singleFrameMode=this.singleFrameMode,e._onSingleFrameAcquired=this._onSingleFrameAcquired,this.videoSrc&&(S(this,we,"f")._hideDefaultSelection=!0),S(this,Pe,"m",$e).call(this)||S(this,ve,"f").setVideoEl(e.getVideoElement()),Ee(this,we,e,"f"),this.addListenerToView()}getCameraView(){return S(this,we,"f")}releaseCameraView(){S(this,we,"f")&&(this.removeListenerFromView(),S(this,we,"f").disposed||(S(this,we,"f")._singleFrameMode="disabled",S(this,we,"f")._onSingleFrameAcquired=null,S(this,we,"f")._hideDefaultSelection=!1),S(this,ve,"f").releaseVideoEl(),Ee(this,we,null,"f"))}addListenerToView(){if(!S(this,we,"f"))return;if(S(this,we,"f").disposed)throw new Error("'cameraView' has been disposed.");const e=S(this,we,"f");S(this,Pe,"m",$e).call(this)||this.videoSrc||(e._innerComponent&&(S(this,ve,"f").tapFocusEventBoundEl=e._innerComponent),e._selCam&&e._selCam.addEventListener("change",this._onCameraSelChange),e._selRsl&&e._selRsl.addEventListener("change",this._onResolutionSelChange)),e._btnClose&&e._btnClose.addEventListener("click",this._onCloseBtnClick)}removeListenerFromView(){if(!S(this,we,"f")||S(this,we,"f").disposed)return;const e=S(this,we,"f");S(this,ve,"f").tapFocusEventBoundEl=null,e._selCam&&e._selCam.removeEventListener("change",this._onCameraSelChange),e._selRsl&&e._selRsl.removeEventListener("change",this._onResolutionSelChange),e._btnClose&&e._btnClose.removeEventListener("click",this._onCloseBtnClick)}getCameraState(){return S(this,Pe,"m",$e).call(this)?S(this,vr,"f"):new Map([["closed","closed"],["opening","opening"],["opened","open"]]).get(S(this,ve,"f").state)}isOpen(){return this.getCameraState()==="open"}getVideoEl(){return this.video}async open(){const e=S(this,we,"f");if(e!=null&&e.disposed)throw new Error("'cameraView' has been disposed.");e&&(e._singleFrameMode=this.singleFrameMode,S(this,Pe,"m",$e).call(this)?e._clickIptSingleFrameMode():(S(this,ve,"f").setVideoEl(e.getVideoElement()),e._startLoading()));let n={width:0,height:0,deviceId:""};if(!S(this,Pe,"m",$e).call(this)){try{await S(this,ve,"f").open()}catch(h){throw e&&e._stopLoading(),h}S(this,zi,"f")&&this.turnOnTorch().catch(()=>{});const o=this.getResolution();n.width=o.width,n.height=o.height,n.deviceId=this.getSelectedCamera().deviceId}return Ee(this,vr,"open","f"),e&&(e._innerComponent.style.display="",S(this,Pe,"m",$e).call(this)||(e._stopLoading(),e._renderCamerasInfo(this.getSelectedCamera(),S(this,ve,"f")._arrCameras),e._renderResolutionInfo({width:n.width,height:n.height}),e.eventHandler.fire("content:updated",null,{async:!0}),e.eventHandler.fire("videoEl:resized",null,{async:!0}))),S(this,si,"f").fire("opened",null,{target:this,async:!0}),n}close(){const e=S(this,we,"f");if(e!=null&&e.disposed)throw new Error("'cameraView' has been disposed.");this.stopFetching(),this.clearBuffer(),S(this,Pe,"m",$e).call(this)||S(this,ve,"f").close(),Ee(this,vr,"closed","f"),S(this,zt,"f").stopCharging(),e&&(e._innerComponent.style.display="none",S(this,Pe,"m",$e).call(this)&&e._innerComponent.removeElement("content"),e._stopLoading()),S(this,si,"f").fire("closed",null,{target:this,async:!0})}pause(){if(S(this,Pe,"m",$e).call(this))throw new Error("'pause()' is invalid in 'singleFrameMode'.");S(this,ve,"f").pause()}isPaused(){var e;return!S(this,Pe,"m",$e).call(this)&&((e=this.video)===null||e===void 0?void 0:e.paused)===!0}async resume(){if(S(this,Pe,"m",$e).call(this))throw new Error("'resume()' is invalid in 'singleFrameMode'.");await S(this,ve,"f").resume()}async selectCamera(e){if(!e)throw new Error("Invalid value.");let n;n=typeof e=="string"?e:e.deviceId,await S(this,ve,"f").setCamera(n),Ee(this,zi,!1,"f");const o=this.getResolution(),h=S(this,we,"f");return h&&!h.disposed&&(h._stopLoading(),h._renderCamerasInfo(this.getSelectedCamera(),S(this,ve,"f")._arrCameras),h._renderResolutionInfo({width:o.width,height:o.height})),{width:o.width,height:o.height,deviceId:this.getSelectedCamera().deviceId}}getSelectedCamera(){return S(this,ve,"f").getCamera()}async getAllCameras(){return S(this,ve,"f").getCameras()}async setResolution(e){await S(this,ve,"f").setResolution(e.width,e.height),S(this,zi,"f")&&this.turnOnTorch().catch(()=>{});const n=this.getResolution(),o=S(this,we,"f");return o&&!o.disposed&&(o._stopLoading(),o._renderResolutionInfo({width:n.width,height:n.height})),{width:n.width,height:n.height,deviceId:this.getSelectedCamera().deviceId}}getResolution(){return S(this,ve,"f").getResolution()}getAvailableResolutions(){var e;return(e=S(this,ve,"f"))===null||e===void 0?void 0:e.getResolutions()}_on(e,n){["opened","closed","singleframeacquired","frameaddedtobuffer"].includes(e.toLowerCase())?S(this,si,"f").on(e,n):S(this,ve,"f").on(e,n)}_off(e,n){["opened","closed","singleframeacquired","frameaddedtobuffer"].includes(e.toLowerCase())?S(this,si,"f").off(e,n):S(this,ve,"f").off(e,n)}on(e,n){const o=e.toLowerCase(),h=new Map([["cameraopen","opened"],["cameraclose","closed"],["camerachange","camera:changed"],["resolutionchange","resolution:changed"],["played","played"],["singleframeacquired","singleFrameAcquired"],["frameaddedtobuffer","frameAddedToBuffer"]]).get(o);if(!h)throw new Error("Invalid event.");this._on(h,n)}off(e,n){const o=e.toLowerCase(),h=new Map([["cameraopen","opened"],["cameraclose","closed"],["camerachange","camera:changed"],["resolutionchange","resolution:changed"],["played","played"],["singleframeacquired","singleFrameAcquired"],["frameaddedtobuffer","frameAddedToBuffer"]]).get(o);if(!h)throw new Error("Invalid event.");this._off(h,n)}getVideoSettings(){var e;return(e=S(this,ve,"f"))===null||e===void 0?void 0:e.getMediaStreamConstraints()}async updateVideoSettings(e){var n;await((n=S(this,ve,"f"))===null||n===void 0?void 0:n.setMediaStreamConstraints(e,!0))}getCapabilities(){var e;return(e=S(this,ve,"f"))===null||e===void 0?void 0:e.getCameraCapabilities()}getCameraSettings(){return S(this,ve,"f").getCameraSettings()}async turnOnTorch(){var e;if(S(this,Pe,"m",$e).call(this))throw new Error("'turnOnTorch()' is invalid in 'singleFrameMode'.");await((e=S(this,ve,"f"))===null||e===void 0?void 0:e.turnOnTorch()),Ee(this,zi,!0,"f")}async turnOffTorch(){var e;if(S(this,Pe,"m",$e).call(this))throw new Error("'turnOffTorch()' is invalid in 'singleFrameMode'.");await((e=S(this,ve,"f"))===null||e===void 0?void 0:e.turnOffTorch()),Ee(this,zi,!1,"f")}async setColorTemperature(e){if(S(this,Pe,"m",$e).call(this))throw new Error("'setColorTemperature()' is invalid in 'singleFrameMode'.");await S(this,ve,"f").setColorTemperature(e,!0)}getColorTemperature(){return S(this,ve,"f").getColorTemperature()}async setExposureCompensation(e){var n;if(S(this,Pe,"m",$e).call(this))throw new Error("'setExposureCompensation()' is invalid in 'singleFrameMode'.");await((n=S(this,ve,"f"))===null||n===void 0?void 0:n.setExposureCompensation(e,!0))}getExposureCompensation(){var e;return(e=S(this,ve,"f"))===null||e===void 0?void 0:e.getExposureCompensation()}async _setZoom(e){var n;if(S(this,Pe,"m",$e).call(this))throw new Error("'setZoom()' is invalid in 'singleFrameMode'.");await((n=S(this,ve,"f"))===null||n===void 0?void 0:n.setZoom(e))}async setZoom(e){await this._setZoom(e)}getZoomSettings(){var e;return(e=S(this,ve,"f"))===null||e===void 0?void 0:e.getZoom()}async resetZoom(){var e;if(S(this,Pe,"m",$e).call(this))throw new Error("'resetZoom()' is invalid in 'singleFrameMode'.");await((e=S(this,ve,"f"))===null||e===void 0?void 0:e.resetZoom())}async setFrameRate(e){var n;if(S(this,Pe,"m",$e).call(this))throw new Error("'setFrameRate()' is invalid in 'singleFrameMode'.");await((n=S(this,ve,"f"))===null||n===void 0?void 0:n.setFrameRate(e,!0))}getFrameRate(){var e;return(e=S(this,ve,"f"))===null||e===void 0?void 0:e.getFrameRate()}async setFocus(e){var n;if(S(this,Pe,"m",$e).call(this))throw new Error("'setFocus()' is invalid in 'singleFrameMode'.");await((n=S(this,ve,"f"))===null||n===void 0?void 0:n.setFocus(e,!0))}getFocusSettings(){var e;return(e=S(this,ve,"f"))===null||e===void 0?void 0:e.getFocus()}setAutoZoomRange(e){S(this,de,"f").minValue=e.min,S(this,de,"f").maxValue=e.max}getAutoZoomRange(){return{min:S(this,de,"f").minValue,max:S(this,de,"f").maxValue}}async enableEnhancedFeatures(e){var n,o;if(!(!((o=(n=bt.license)===null||n===void 0?void 0:n.LicenseManager)===null||o===void 0)&&o.bPassValidation))throw new Error("License is not verified, or license is invalid.");if(ot.bSupportDce4Module!==0)throw new Error("Please set a license containing the DCE module.");e&Oi.EF_ENHANCED_FOCUS&&(S(this,ze,"f").enhancedFocus=!0),e&Oi.EF_AUTO_ZOOM&&(S(this,ze,"f").autoZoom=!0),e&Oi.EF_TAP_TO_FOCUS&&(S(this,ze,"f").tapToFocus=!0,S(this,ve,"f").enableTapToFocus())}disableEnhancedFeatures(e){e&Oi.EF_ENHANCED_FOCUS&&(S(this,ze,"f").enhancedFocus=!1,this.setFocus({mode:"continuous"}).catch(()=>{})),e&Oi.EF_AUTO_ZOOM&&(S(this,ze,"f").autoZoom=!1,this.resetZoom().catch(()=>{})),e&Oi.EF_TAP_TO_FOCUS&&(S(this,ze,"f").tapToFocus=!1,S(this,ve,"f").disableTapToFocus()),S(this,Pe,"m",vh).call(this)&&S(this,Pe,"m",_h).call(this)||S(this,zt,"f").stopCharging()}_setScanRegion(e){if(e!=null&&!Pa(e)&&!on(e))throw TypeError("Invalid 'region'.");Ee(this,$i,e?JSON.parse(JSON.stringify(e)):null,"f"),S(this,we,"f")&&!S(this,we,"f").disposed&&S(this,we,"f").setScanRegion(e)}setScanRegion(e){this._setScanRegion(e),S(this,we,"f")&&!S(this,we,"f").disposed&&(e===null?S(this,we,"f").setScanRegionMaskVisible(!1):S(this,we,"f").setScanRegionMaskVisible(!0))}getScanRegion(){return JSON.parse(JSON.stringify(S(this,$i,"f")))}setErrorListener(e){if(!e)throw new TypeError("Invalid 'listener'");Ee(this,br,e,"f")}hasNextImageToFetch(){return!(this.getCameraState()!=="open"||!S(this,ve,"f").isVideoLoaded()||S(this,Pe,"m",$e).call(this))}startFetching(){if(S(this,Pe,"m",$e).call(this))throw Error("'startFetching()' is unavailable in 'singleFrameMode'.");S(this,oi,"f")||(Ee(this,oi,!0,"f"),S(this,Pe,"m",ra).call(this))}stopFetching(){S(this,oi,"f")&&(Re._onLog&&Re._onLog("DCE: stop fetching loop: "+Date.now()),S(this,Lt,"f")&&clearTimeout(S(this,Lt,"f")),Ee(this,oi,!1,"f"))}fetchImage(){if(S(this,Pe,"m",$e).call(this))throw new Error("'fetchImage()' is unavailable in 'singleFrameMode'.");if(!this.video)throw new Error("The video element does not exist.");if(this.video.readyState!==4)throw new Error("The video is not loaded.");const e=this.getResolution();if(!(e!=null&&e.width)||!(e!=null&&e.height))throw new Error("The video is not loaded.");let n;if(n=Qr.convert(S(this,$i,"f"),e.width,e.height),n||(n={x:0,y:0,width:e.width,height:e.height}),n.x>e.width||n.y>e.height)throw new Error("Invalid scan region.");n.x+n.width>e.width&&(n.width=e.width-n.x),n.y+n.height>e.height&&(n.height=e.height-n.y);const o={sx:n.x,sy:n.y,sWidth:n.width,sHeight:n.height,dWidth:n.width,dHeight:n.height},h=Math.max(o.dWidth,o.dHeight);if(this.canvasSizeLimit&&h>this.canvasSizeLimit){const C=this.canvasSizeLimit/h;o.dWidth>o.dHeight?(o.dWidth=this.canvasSizeLimit,o.dHeight=Math.round(o.dHeight*C)):(o.dWidth=Math.round(o.dWidth*C),o.dHeight=this.canvasSizeLimit)}const g=S(this,ve,"f").getFrameData({position:o,pixelFormat:$l.get(this.getPixelFormat())});if(!g)return null;let m;g.pixelFormat===Be.GREY?m=g.width:m=4*g.width;let v=!0;return o.sx===0&&o.sy===0&&o.sWidth===e.width&&o.sHeight===e.height&&(v=!1),{bytes:g.data,width:g.width,height:g.height,stride:m,format:Kl.get(g.pixelFormat),tag:{imageId:this._imageId==Number.MAX_VALUE?this._imageId=0:++this._imageId,type:Ls.ITT_VIDEO_FRAME,isCropped:v,cropRegion:{left:n.x,top:n.y,right:n.x+n.width,bottom:n.y+n.height,isMeasuredInPercentage:!1},originalWidth:e.width,originalHeight:e.height,currentWidth:g.width,currentHeight:g.height,timeSpent:g.timeSpent,timeStamp:g.timeStamp},toCanvas:S(this,vs,"f"),isDCEFrame:!0}}setImageFetchInterval(e){this.fetchInterval=e,S(this,oi,"f")&&(S(this,Lt,"f")&&clearTimeout(S(this,Lt,"f")),Ee(this,Lt,setTimeout(()=>{this.disposed||S(this,Pe,"m",ra).call(this)},e),"f"))}getImageFetchInterval(){return this.fetchInterval}setPixelFormat(e){Ee(this,ys,e,"f")}getPixelFormat(){return S(this,ys,"f")}takePhoto(e){if(!this.isOpen())throw new Error("Not open.");if(S(this,Pe,"m",$e).call(this))throw new Error("'takePhoto()' is unavailable in 'singleFrameMode'.");const n=document.createElement("input");n.setAttribute("type","file"),n.setAttribute("accept",".jpg,.jpeg,.icon,.gif,.svg,.webp,.png,.bmp"),n.setAttribute("capture",""),n.style.position="fixed",n.style.left="-1px",n.style.top="-1px",n.style.width="1px",n.style.height="1px",n.style.backgroundColor="transparent",n.style.color="transparent",n.addEventListener("click",()=>{const o=this.isOpen();this.close(),window.addEventListener("focus",()=>{o&&this.open(),n.remove()},{once:!0})}),n.addEventListener("change",async()=>{const o=n.files[0],h=await(async E=>{let I=null,R=null;if(typeof createImageBitmap<"u")try{if(I=await createImageBitmap(E),I)return I}catch{}var L;return I||(R=await(L=E,new Promise((N,Y)=>{let X=URL.createObjectURL(L),K=new Image;K.src=X,K.onload=()=>{URL.revokeObjectURL(K.src),N(K)},K.onerror=J=>{Y(new Error("Can't convert blob to image : "+(J instanceof Event?J.type:J)))}}))),R})(o),g=h instanceof HTMLImageElement?h.naturalWidth:h.width,m=h instanceof HTMLImageElement?h.naturalHeight:h.height;let v=Qr.convert(S(this,$i,"f"),g,m);v||(v={x:0,y:0,width:g,height:m});const C=S(this,_s,"f").call(this,h,g,m,v);e&&e(C)}),document.body.appendChild(n),n.click()}convertToPageCoordinates(e){const n=S(this,Pe,"m",sa).call(this,e);return{x:n.pageX,y:n.pageY}}convertToClientCoordinates(e){const n=S(this,Pe,"m",sa).call(this,e);return{x:n.clientX,y:n.clientY}}dispose(){this.close(),S(this,ve,"f").dispose(),this.releaseCameraView(),this.__proto__=null;for(let e in this)delete this[e];Object.defineProperty(this,"isCameraEnhancer",{value:!0}),Object.defineProperty(this,"disposed",{value:!0})}}var Kt,Zl,yr,ws;ta=Re,ve=new WeakMap,we=new WeakMap,vr=new WeakMap,si=new WeakMap,zi=new WeakMap,ms=new WeakMap,_s=new WeakMap,vs=new WeakMap,br=new WeakMap,$i=new WeakMap,ys=new WeakMap,oi=new WeakMap,Lt=new WeakMap,ze=new WeakMap,de=new WeakMap,zt=new WeakMap,na=new WeakMap,Pe=new WeakSet,$e=function(){return this.singleFrameMode!=="disabled"},_h=function(){return!this.videoSrc&&S(this,ve,"f").state==="opened"},vh=function(){for(let t in S(this,ze,"f"))if(S(this,ze,"f")[t]==1)return!0;return!1},ra=function t(){if(this.disposed)return;if(this.getCameraState()!=="open"||!S(this,oi,"f"))return S(this,Lt,"f")&&clearTimeout(S(this,Lt,"f")),void Ee(this,Lt,setTimeout(()=>{this.disposed||S(this,Pe,"m",t).call(this)},this.fetchInterval),"f");const e=()=>{var n;let o;Re._onLog&&Re._onLog("DCE: start fetching a frame into buffer: "+Date.now());try{o=this.fetchImage()}catch(h){const g=h.message||h;if(g==="The video is not loaded.")return;if(!((n=S(this,br,"f"))===null||n===void 0)&&n.onErrorReceived)return void setTimeout(()=>{var m;(m=S(this,br,"f"))===null||m===void 0||m.onErrorReceived(Go.EC_IMAGE_READ_FAILED,g)},0);throw h}o?(this.addImageToBuffer(o),Re._onLog&&Re._onLog("DCE: finish fetching a frame into buffer: "+Date.now()),S(this,si,"f").fire("frameAddedToBuffer",null,{async:!0})):Re._onLog&&Re._onLog("DCE: get a invalid frame, abandon it: "+Date.now())};if(this.getImageCount()>=this.getMaxImageCount())switch(this.getBufferOverflowProtectionMode()){case nn.BOPM_BLOCK:break;case nn.BOPM_UPDATE:e()}else e();S(this,Lt,"f")&&clearTimeout(S(this,Lt,"f")),Ee(this,Lt,setTimeout(()=>{this.disposed||S(this,Pe,"m",t).call(this)},this.fetchInterval),"f")},sa=function(t){if(!S(this,we,"f"))throw new Error("Camera view is not set.");if(S(this,we,"f").disposed)throw new Error("'cameraView' has been disposed.");if(!this.isOpen())throw new Error("Not open.");if(!S(this,Pe,"m",$e).call(this)&&!S(this,ve,"f").isVideoLoaded())throw new Error("Video is not loaded.");if(S(this,Pe,"m",$e).call(this)&&!S(this,we,"f")._cvsSingleFrameMode)throw new Error("No image is selected.");const e=S(this,we,"f")._innerComponent.getBoundingClientRect(),n=e.left,o=e.top,h=n+window.scrollX,g=o+window.scrollY,{width:m,height:v}=S(this,we,"f")._innerComponent.getBoundingClientRect();if(m<=0||v<=0)throw new Error("Unable to get content dimensions. Camera view may not be rendered on the page.");let C,E,I;if(S(this,Pe,"m",$e).call(this)){const te=S(this,we,"f")._innerComponent.getElement("content");C=te.width,E=te.height,I="contain"}else{const te=this.getVideoEl();C=te.videoWidth,E=te.videoHeight,I=S(this,we,"f").getVideoFit()}const R=m/v,L=C/E;let N,Y,X,K,J=1;if(I==="contain")R<L?(J=m/C,N=n+t.x*J,Y=o+t.y*J+(v-E*J)/2,X=h+t.x*J,K=g+t.y*J+(v-E*J)/2):(J=v/E,N=n+t.x*J+(m-C*J)/2,Y=o+t.y*J,X=h+t.x*J+(m-C*J)/2,K=g+t.y*J);else if(I==="cover")if(R<L){J=v/E;let te=t.x*J-(C*J-m)/2;te=Math.max(te,0),te=Math.min(te,m),N=n+te,Y=o+t.y*J,X=h+te,K=g+t.y*J}else{J=m/C;let te=t.y*J-(E*J-v)/2;te=Math.max(te,0),te=Math.min(te,v),N=n+t.x*J,Y=o+te,X=h+t.x*J,K=g+te}return{clientX:N,clientY:Y,pageX:X,pageY:K}},Re._debug=!1,ia={value:void 0},Re.browserInfo=gt;class Dt{static get beepSoundSource(){return S(Dt,Kt,"f",ws)}static set beepSoundSource(e){Ee(Dt,Kt,e,"f",ws),Ee(Dt,Kt,new eo({src:[S(Dt,Kt,"f",ws)],onplayerror:(n,o)=>{console.warn(`Sound '${n}' playback failure: ${o}`)}}),"f",yr)}static vibrate(){if(!navigator||!navigator.vibrate)throw new Error("Not supported.");navigator.vibrate(Dt.vibrateDuration)}static beep(){S(Dt,Kt,"f",yr)&&(S(Dt,Kt,"f",yr).stop(),S(Dt,Kt,"f",yr).play())}}Kt=Dt,Dt.vibrateDuration=300,yr={value:new eo({src:[S(Dt,Kt,"f",Zl={value:"data:audio/mpeg;base64,SUQzBAAAAAAAI1RTU0UAAAAPAAADTGF2ZjU4LjI5LjEwMAAAAAAAAAAAAAAA/+M4wAAAAAAAAAAAAEluZm8AAAAPAAAABQAAAkAAgICAgICAgICAgICAgICAgICAgKCgoKCgoKCgoKCgoKCgoKCgoKCgwMDAwMDAwMDAwMDAwMDAwMDAwMDg4ODg4ODg4ODg4ODg4ODg4ODg4P//////////////////////////AAAAAExhdmM1OC41NAAAAAAAAAAAAAAAACQEUQAAAAAAAAJAk0uXRQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA/+MYxAANQAbGeUEQAAHZYZ3fASqD4P5TKBgocg+Bw/8+CAYBA4XB9/4EBAEP4nB9+UOf/6gfUCAIKyjgQ/Kf//wfswAAAwQA/+MYxAYOqrbdkZGQAMA7DJLCsQxNOij///////////+tv///3RWiZGBEhsf/FO/+LoCSFs1dFVS/g8f/4Mhv0nhqAieHleLy/+MYxAYOOrbMAY2gABf/////////////////usPJ66R0wI4boY9/8jQYg//g2SPx1M0N3Z0kVJLIs///Uw4aMyvHJJYmPBYG/+MYxAgPMALBucAQAoGgaBoFQVBUFQWDv6gZBUFQVBUGgaBr5YSgqCoKhIGg7+IQVBUFQVBoGga//SsFSoKnf/iVTEFNRTMu/+MYxAYAAANIAAAAADEwMFVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVV"})],onplayerror:(t,e)=>{console.warn(`Sound '${t}' playback failure: ${e}`)}})},ws={value:S(Dt,Kt,"f",Zl)};/*!
 * Dynamsoft JavaScript Library
 * @product Dynamsoft Capture Vision Router JS Edition
 * @website http://www.dynamsoft.com
 * @copyright Copyright 2024, Dynamsoft Corporation
 * @author Dynamsoft
 * @version "2.0.31"
 * @fileoverview Dynamsoft JavaScript Library for Capture Vision
 * More info on cvr JS: https://www.dynamsoft.com/capture-vision/docs/web/programming/javascript/api-reference/capture-vision-router/capture-vision-router-module.html
 */const ql=t=>t&&typeof t=="object"&&typeof t.then=="function";class gn extends Promise{constructor(e){let n,o;super((h,g)=>{n=h,o=g}),this._s="pending",this.resolve=h=>{this.isPending&&(ql(h)?this.task=h:(this._s="fulfilled",n(h)))},this.reject=h=>{this.isPending&&(this._s="rejected",o(h))},this.task=e}get status(){return this._s}get isPending(){return this._s==="pending"}get isFulfilled(){return this._s==="fulfilled"}get isRejected(){return this._s==="rejected"}get task(){return this._task}set task(e){let n;this._task=e,ql(e)?n=e:typeof e=="function"&&(n=new Promise(e)),n&&(async()=>{try{const o=await n;e===this._task&&this.resolve(o)}catch(o){e===this._task&&this.reject(o)}})()}get isEmpty(){return this._task==null}}class Ed{constructor(){this.intermediateResultReceiverSet=new Set}addResultReceiver(e){if(typeof e!="object")throw new Error("Invalid receiver.");this.intermediateResultReceiverSet.add(e)}removeResultReceiver(e){this.intermediateResultReceiverSet.delete(e)}}var Td={onTaskResultsReceived:!1,onTaskResultsReceivedForDce:!1,onPredetectedRegionsReceived:!1,onLocalizedBarcodesReceived:!1,onDecodedBarcodesReceived:!1,onLocalizedTextLinesReceived:!1,onRecognizedTextLinesReceived:!1,onDetectedQuadsReceived:!1,onNormalizedImagesReceived:!1,onColourImageUnitReceived:!1,onScaledDownColourImageUnitReceived:!1,onGrayscaleImageUnitReceived:!1,onTransformedGrayscaleImageUnitReceived:!1,onEnhancedGrayscaleImageUnitReceived:!1,onBinaryImageUnitReceived:!1,onTextureDetectionResultUnitReceived:!1,onTextureRemovedGrayscaleImageUnitReceived:!1,onTextureRemovedBinaryImageUnitReceived:!1,onContoursUnitReceived:!1,onLineSegmentsUnitReceived:!1,onTextZonesUnitReceived:!1,onTextRemovedBinaryImageUnitReceived:!1,onLongLinesUnitReceived:!1,onCornersUnitReceived:!1,onCandidateQuadEdgesUnitReceived:!1,onCandidateBarcodeZonesUnitReceived:!1,onScaledUpBarcodeImageUnitReceived:!1,onDeformationResistedBarcodeImageUnitReceived:!1,onComplementedBarcodeImageUnitReceived:!1};const yh=typeof self>"u",ka=(()=>{if(!yh&&document.currentScript){let t=document.currentScript.src,e=t.indexOf("?");if(e!=-1)t=t.substring(0,e);else{let n=t.indexOf("#");n!=-1&&(t=t.substring(0,n))}return t.substring(0,t.lastIndexOf("/")+1)}return"./"})(),wh=t=>{if(t==null&&(t="./"),!yh){let e=document.createElement("a");e.href=t,t=e.href}return t.endsWith("/")||(t+="/"),t};var To;We.cvr==null&&(We.cvr=ka),Un.cvr={js:!0,wasm:!0},bt.cvr={};const bo="1.0.0";We.std.version&&Dr(We.std.version,bo)<0&&(We.std.version=bo,We.std.path=wh(ka+`../../dynamsoft-capture-vision-std@${bo}/dist/`));const So="2.0.30";We.dip.version&&Dr(We.dip.version,So)<0&&(We.dip.version=So,We.dip.path=wh(ka+`../../dynamsoft-image-processing@${So}/dist/`));var js,Jl,oa,Ri;async function Ql(t,e){return await new Promise((n,o)=>{let h=new XMLHttpRequest;h.open("GET",t,!0),h.responseType=e,h.send(),h.onloadend=async()=>{n(h.response)},h.onerror=()=>{o(new Error("Network Error: "+h.statusText))}})}`${(To=Zi.cvr)===null||To===void 0?void 0:To.worker}`,function(t){t[t.ISS_BUFFER_EMPTY=0]="ISS_BUFFER_EMPTY",t[t.ISS_EXHAUSTED=1]="ISS_EXHAUSTED"}(js||(js={})),function(t){t[t.IRUT_NULL=0]="IRUT_NULL",t[t.IRUT_COLOUR_IMAGE=1]="IRUT_COLOUR_IMAGE",t[t.IRUT_SCALED_DOWN_COLOUR_IMAGE=2]="IRUT_SCALED_DOWN_COLOUR_IMAGE",t[t.IRUT_GRAYSCALE_IMAGE=4]="IRUT_GRAYSCALE_IMAGE",t[t.IRUT_TRANSOFORMED_GRAYSCALE_IMAGE=8]="IRUT_TRANSOFORMED_GRAYSCALE_IMAGE",t[t.IRUT_ENHANCED_GRAYSCALE_IMAGE=16]="IRUT_ENHANCED_GRAYSCALE_IMAGE",t[t.IRUT_PREDETECTED_REGIONS=32]="IRUT_PREDETECTED_REGIONS",t[t.IRUT_BINARY_IMAGE=64]="IRUT_BINARY_IMAGE",t[t.IRUT_TEXTURE_DETECTION_RESULT=128]="IRUT_TEXTURE_DETECTION_RESULT",t[t.IRUT_TEXTURE_REMOVED_GRAYSCALE_IMAGE=256]="IRUT_TEXTURE_REMOVED_GRAYSCALE_IMAGE",t[t.IRUT_TEXTURE_REMOVED_BINARY_IMAGE=512]="IRUT_TEXTURE_REMOVED_BINARY_IMAGE",t[t.IRUT_CONTOURS=1024]="IRUT_CONTOURS",t[t.IRUT_LINE_SEGMENTS=2048]="IRUT_LINE_SEGMENTS",t[t.IRUT_TEXT_ZONES=4096]="IRUT_TEXT_ZONES",t[t.IRUT_TEXT_REMOVED_BINARY_IMAGE=8192]="IRUT_TEXT_REMOVED_BINARY_IMAGE",t[t.IRUT_CANDIDATE_BARCODE_ZONES=16384]="IRUT_CANDIDATE_BARCODE_ZONES",t[t.IRUT_LOCALIZED_BARCODES=32768]="IRUT_LOCALIZED_BARCODES",t[t.IRUT_SCALED_UP_BARCODE_IMAGE=65536]="IRUT_SCALED_UP_BARCODE_IMAGE",t[t.IRUT_DEFORMATION_RESISTED_BARCODE_IMAGE=131072]="IRUT_DEFORMATION_RESISTED_BARCODE_IMAGE",t[t.IRUT_COMPLEMENTED_BARCODE_IMAGE=262144]="IRUT_COMPLEMENTED_BARCODE_IMAGE",t[t.IRUT_DECODED_BARCODES=524288]="IRUT_DECODED_BARCODES",t[t.IRUT_LONG_LINES=1048576]="IRUT_LONG_LINES",t[t.IRUT_CORNERS=2097152]="IRUT_CORNERS",t[t.IRUT_CANDIDATE_QUAD_EDGES=4194304]="IRUT_CANDIDATE_QUAD_EDGES",t[t.IRUT_DETECTED_QUADS=8388608]="IRUT_DETECTED_QUADS",t[t.IRUT_LOCALIZED_TEXT_LINES=16777216]="IRUT_LOCALIZED_TEXT_LINES",t[t.IRUT_RECOGNIZED_TEXT_LINES=33554432]="IRUT_RECOGNIZED_TEXT_LINES",t[t.IRUT_NORMALIZED_IMAGES=67108864]="IRUT_NORMALIZED_IMAGES",t[t.IRUT_ALL=134217727]="IRUT_ALL"}(Jl||(Jl={})),function(t){t[t.CRIT_ORIGINAL_IMAGE=1]="CRIT_ORIGINAL_IMAGE",t[t.CRIT_BARCODE=2]="CRIT_BARCODE",t[t.CRIT_TEXT_LINE=4]="CRIT_TEXT_LINE",t[t.CRIT_DETECTED_QUAD=8]="CRIT_DETECTED_QUAD",t[t.CRIT_NORMALIZED_IMAGE=16]="CRIT_NORMALIZED_IMAGE",t[t.CRIT_PARSED_RESULT=32]="CRIT_PARSED_RESULT"}(oa||(oa={})),function(t){t[t.IPF_BINARY=0]="IPF_BINARY",t[t.IPF_BINARYINVERTED=1]="IPF_BINARYINVERTED",t[t.IPF_GRAYSCALED=2]="IPF_GRAYSCALED",t[t.IPF_NV21=3]="IPF_NV21",t[t.IPF_RGB_565=4]="IPF_RGB_565",t[t.IPF_RGB_555=5]="IPF_RGB_555",t[t.IPF_RGB_888=6]="IPF_RGB_888",t[t.IPF_ARGB_8888=7]="IPF_ARGB_8888",t[t.IPF_RGB_161616=8]="IPF_RGB_161616",t[t.IPF_ARGB_16161616=9]="IPF_ARGB_16161616",t[t.IPF_ABGR_8888=10]="IPF_ABGR_8888",t[t.IPF_ABGR_16161616=11]="IPF_ABGR_16161616",t[t.IPF_BGR_888=12]="IPF_BGR_888",t[t.IPF_BINARY_8=13]="IPF_BINARY_8",t[t.IPF_NV12=14]="IPF_NV12"}(Ri||(Ri={}));const Jn=oa;function ec(t){const e={barcodeResultItems:[],textLineResultItems:[],quadsResultItems:[],normalizedImageResultItems:[],parsedResultItems:[]};return t.items.forEach(n=>{n.type===Jn.CRIT_BARCODE?e.barcodeResultItems.push(n):n.type===Jn.CRIT_TEXT_LINE?e.textLineResultItems.push(n):n.type===Jn.CRIT_DETECTED_QUAD?e.quadsResultItems.push(n):n.type===Jn.CRIT_NORMALIZED_IMAGE?e.normalizedImageResultItems.push(n):n.type===Jn.CRIT_PARSED_RESULT&&e.parsedResultItems.push(n)}),e}function bd(t){let e,n=t.bytes;if(!(n&&n instanceof Uint8Array))throw Error("Parameter type error");if(Number(t.format)===Ri.IPF_BGR_888){const o=n.length/3;e=new Uint8ClampedArray(4*o);for(let h=0;h<o;++h)e[4*h]=n[3*h],e[4*h+1]=n[3*h+1],e[4*h+2]=n[3*h+2],e[4*h+3]=255}else if(Number(t.format)===Ri.IPF_RGB_888){const o=n.length/3;e=new Uint8ClampedArray(4*o);for(let h=0;h<o;++h)e[4*h]=n[3*h+2],e[4*h+1]=n[3*h+1],e[4*h+2]=n[3*h],e[4*h+3]=255}else if(Number(t.format)===Ri.IPF_GRAYSCALED){const o=n.length;e=new Uint8ClampedArray(4*o);for(let h=0;h<o;h++)e[4*h]=e[4*h+1]=e[4*h+2]=n[h],e[4*h+3]=255}else if(Number(t.format)===Ri.IPF_BINARY_8){const o=n.length,h=t.width,g=t.height,m=t.stride;e=new Uint8ClampedArray(h*g*4);for(let v=0;v<o;v++){let C=n[v],E=v%m,I=Math.floor(v/m);for(let R=0;R<8;R++){let L=E+R,N=4*(I*h+L);if(L>=h)break;e[N]=e[N+1]=e[N+2]=(128&C)/128*255,e[N+3]=255,C<<=1}}}else if(Number(t.format)===Ri.IPF_ABGR_8888){const o=n.length/4;e=new Uint8ClampedArray(n.length);for(let h=0;h<o;++h)e[4*h]=n[4*h],e[4*h+1]=n[4*h+1],e[4*h+2]=n[4*h+2],e[4*h+3]=n[4*h+3]}else if(Number(t.format)===Ri.IPF_ARGB_8888){const o=n.length/4;e=new Uint8ClampedArray(n.length);for(let h=0;h<o;++h)e[4*h]=n[4*h],e[4*h+1]=n[4*h+1],e[4*h+2]=n[4*h+2],e[4*h+3]=n[4*h+3]}return new ImageData(e,t.width,t.height)}function Sd(t,e){let n=t;n.toCanvas=()=>aa(e),n.toImage=o=>function(h,g){const m=aa(g);let v=new Image,C=m.toDataURL(h);return v.src=C,v}(o,e),n.toBlob=o=>tc(o,e),n.saveToFile=async(o,h)=>{if(!o)return null;if(typeof o!="string")throw new TypeError("FileName must be of type string.");return async function(g,m,v){return await new Promise(async(C,E)=>{try{const I=m.split(".");let R=I[I.length-1];const L=await tc(`image/${R}`,g);I.length<=1&&(R="png");const N=new File([L],m,{type:`image/${R}`});if(v){const Y=URL.createObjectURL(N),X=document.createElement("a");X.href=Y,X.download=m,X.click()}return C(N)}catch{return E()}})}(e,o,h)}}function aa(t){const e=document.createElement("canvas");return e.width=t.width,e.height=t.height,e.getContext("2d",{willReadFrequently:!0}).putImageData(t,0,0),e}async function tc(t,e){const n=aa(e);return new Promise((o,h)=>{n.toBlob(g=>o(g),t)})}const Id=typeof BigInt=="function";class Ge{constructor(){this._maxCvsSideLength=["iPhone","Android","HarmonyOS"].includes(ot.browserInfo.OS)?2048:4096,this._isa=null,this._dsImage=null,this._instanceID=void 0,this._bPauseScan=!0,this._bNeedOutputOriginalImage=!1,this._canvas=null,this._irrRegistryState=Td,this._resultReceiverSet=new Set,this._isaStateListenerSet=new Set,this._resultFilterSet=new Set,this._intermediateResultReceiverSet=new Set,this._intermediateResultManager=null,this._templateName="Default",this._bOpenDetectVerify=!1,this._bOpenNormalizeVerify=!1,this._bOpenBarcodeVerify=!1,this._bOpenLabelVerify=!1,this._minImageCaptureInterval=0,this._averageProcessintTimeArray=[],this._averageFetchImageTimeArray=[],this._currentSettings=null,this._averageTime=999,this.captureInParallel=!0,this.bDestroyed=!1,this._singleFrameModeCallbackBind=this._singleFrameModeCallback.bind(this),this._promiseStartScan=null}get maxCvsSideLength(){return this._maxCvsSideLength}set maxCvsSideLength(e){this._maxCvsSideLength=e}get isa(){return this._isa}set isa(e){this._isa=e}get disposed(){return this.bDestroyed}_checkIsDisposed(){if(this.disposed)throw new Error('"CaptureVisionRouter" instance has been disposed')}static async createInstance(){if(!bt.license)throw Error("Module `license` is not existed.");await bt.license.dynamsoft(),await li(["dip","cvr"]);const e=new Ge,n=new gn;let o=qe();return Ye[o]=async h=>{var g;if(h.success)e._instanceID=h.instanceID,e._currentSettings=await e.outputSettings("*"),`${(g=Zi.cvr)===null||g===void 0?void 0:g.worker}${h.version}`,ot.bSupportDce4Module===0&&(e._intermediateResultManager=e.getIntermediateResultManager(!0)),n.resolve(e);else{const m=Error(h.message);h.stack&&(m.stack=h.stack),n.reject(m)}},Ue.postMessage({type:"cvr_createInstance",id:o}),n}async _singleFrameModeCallback(e){this.isa.getCameraView().setScanLaserVisible(!0);for(let m of this._resultReceiverSet)this._bNeedOutputOriginalImage&&m.onOriginalImageResultReceived&&m.onOriginalImageResultReceived({imageData:e});const n={bytes:new Uint8Array(e.bytes),width:e.width,height:e.height,stride:e.stride,format:e.format,tag:e.tag},o=await this.capture(n,this._templateName,!0);o.originalImageTag=e.tag;for(let m of this._resultReceiverSet)m.isDce&&m.onCapturedResultReceived(o,{isDetectVerifyOpen:!1,isNormalizeVerifyOpen:!1,isBarcodeVerifyOpen:!1,isLabelVerifyOpen:!1});const h={originalImageHashId:o.originalImageHashId,originalImageTag:o.originalImageTag,errorCode:o.errorCode,errorString:o.errorString},g=ec(o);for(let m of this._resultReceiverSet)if(m.onDecodedBarcodesReceived&&g.barcodeResultItems.length&&m.onDecodedBarcodesReceived(Object.assign(Object.assign({},h),{barcodeResultItems:g.barcodeResultItems})),m.onRecognizedTextLinesReceived&&g.textLineResultItems.length&&m.onRecognizedTextLinesReceived(Object.assign(Object.assign({},h),{textLineResultItems:g.textLineResultItems})),m.onDetectedQuadsReceived&&g.quadsResultItems.length&&m.onDetectedQuadsReceived(Object.assign(Object.assign({},h),{quadsResultItems:g.quadsResultItems})),m.onNormalizedImagesReceived&&g.normalizedImageResultItems.length&&m.onNormalizedImagesReceived(Object.assign(Object.assign({},h),{normalizedImageResultItems:g.normalizedImageResultItems})),m.onParsedResultsReceived&&g.parsedResultItems.length&&m.onParsedResultsReceived(Object.assign(Object.assign({},h),{parsedResultItems:g.parsedResultItems})),m.onCapturedResultReceived&&!m.isDce){if(this._bNeedOutputOriginalImage){const v=o.items.findIndex(C=>C.type===1);v!==-1&&(o.items[v].imageData=e)}m.onCapturedResultReceived(o)}}setInput(e){if(this._checkIsDisposed(),e){if(this.isa=e,e.isCameraEnhancer){this._intermediateResultManager&&(this.isa._intermediateResultReceiver.isDce=!0,this._intermediateResultManager.addResultReceiver(this.isa._intermediateResultReceiver));const n=this.isa.getCameraView();if(n){const o=n._capturedResultReceiver;o.isDce=!0,this._resultReceiverSet.add(o)}}}else this.isa=null}getInput(){return this._isa}addImageSourceStateListener(e){if(this._checkIsDisposed(),typeof e!="object")return console.warn("Invalid ISA state listener.");e&&Object.keys(e)&&this._isaStateListenerSet.add(e)}removeImageSourceStateListener(e){return this._checkIsDisposed(),this._isaStateListenerSet.delete(e)}addResultReceiver(e){if(this._checkIsDisposed(),typeof e!="object")throw new Error("Invalid receiver.");e&&Object.keys(e).length&&(this._resultReceiverSet.add(e),this._setCrrRegistry())}removeResultReceiver(e){this._checkIsDisposed(),this._resultReceiverSet.delete(e),this._setCrrRegistry()}async _setCrrRegistry(){const e={onCapturedResultReceived:!1,onDecodedBarcodesReceived:!1,onRecognizedTextLinesReceived:!1,onDetectedQuadsReceived:!1,onNormalizedImagesReceived:!1,onParsedResultsReceived:!1};for(let h of this._resultReceiverSet)h.isDce||(e.onCapturedResultReceived=!!h.onCapturedResultReceived,e.onDecodedBarcodesReceived=!!h.onDecodedBarcodesReceived,e.onRecognizedTextLinesReceived=!!h.onRecognizedTextLinesReceived,e.onDetectedQuadsReceived=!!h.onDetectedQuadsReceived,e.onNormalizedImagesReceived=!!h.onNormalizedImagesReceived,e.onParsedResultsReceived=!!h.onParsedResultsReceived);const n=new gn;let o=qe();return Ye[o]=async h=>{if(h.success)n.resolve();else{let g=new Error(h.message);g.stack=h.stack+`
`+g.stack,n.reject()}},Ue.postMessage({type:"cvr_setCrrRegistry",id:o,instanceID:this._instanceID,body:{receiver:JSON.stringify(e)}}),n}async addResultFilter(e){if(this._checkIsDisposed(),typeof e!="object")return console.warn("Invalid filter.");if(e&&Object.keys(e)){this._resultFilterSet.add(e),this._handleFilterSwitch();for(let n of this._resultFilterSet)await this._enableResultCrossVerification(n.verificationEnabled),await this._enableResultDeduplication(n.duplicateFilterEnabled),await this._setDuplicateForgetTime(n.duplicateForgetTime)}}async removeResultFilter(e){this._checkIsDisposed(),this._resultFilterSet.delete(e),this._handleFilterSwitch();for(let n of this._resultFilterSet)await this._enableResultCrossVerification(n.verificationEnabled),await this._enableResultDeduplication(n.duplicateFilterEnabled),await this._setDuplicateForgetTime(n.duplicateForgetTime)}_handleFilterSwitch(){this._bOpenBarcodeVerify=!1,this._bOpenLabelVerify=!1,this._bOpenDetectVerify=!1,this._bOpenNormalizeVerify=!1;for(let e of this._resultFilterSet)e.isResultCrossVerificationEnabled(Se.CRIT_BARCODE)&&(this._bOpenBarcodeVerify=!0),e.isResultCrossVerificationEnabled(Se.CRIT_TEXT_LINE)&&(this._bOpenLabelVerify=!0),e.isResultCrossVerificationEnabled(Se.CRIT_DETECTED_QUAD)&&(this._bOpenDetectVerify=!0),e.isResultCrossVerificationEnabled(Se.CRIT_NORMALIZED_IMAGE)&&(this._bOpenNormalizeVerify=!0)}async startCapturing(e="Default"){if(this._checkIsDisposed(),!this._bPauseScan)return;if(!this.isa)throw new Error("'ImageSourceAdapter' is not set. call 'setInput' before 'startCapturing'");const n=await this.containsTask(e);return await li(n),this.isa.isCameraEnhancer&&(n.includes("ddn")?this.isa.setPixelFormat(Te.IPF_ABGR_8888):this.isa.setPixelFormat(Te.IPF_GRAYSCALED)),this.isa.singleFrameMode!==void 0&&this.isa.singleFrameMode!=="disabled"?(this._templateName=e,void this.isa.on("singleFrameAcquired",this._singleFrameModeCallbackBind)):(this.isa.getColourChannelUsageType()===ei.CCUT_AUTO&&this.isa.setColourChannelUsageType(n.includes("ddn")?ei.CCUT_FULL_CHANNEL:ei.CCUT_Y_CHANNEL_ONLY),this._promiseStartScan&&this._promiseStartScan.isPending?this._promiseStartScan:(this._promiseStartScan=new gn((o,h)=>{if(this.disposed)return;let g=qe();Ye[g]=async m=>{if(this._promiseStartScan&&!this._promiseStartScan.isFulfilled){if(!m.success){let v=new Error(m.message);return v.stack=m.stack+`
`+v.stack,h(v)}for(let v of this._resultFilterSet)await this.addResultFilter(v);this._bPauseScan=!1,this._bNeedOutputOriginalImage=m.bNeedOutputOriginalImage,this._loopReadVideoTimeoutId&&clearTimeout(this._loopReadVideoTimeoutId),this._loopReadVideoTimeoutId=setTimeout(async()=>{this._minImageCaptureInterval!==-1&&this.isa.startFetching(),this._loopReadVideo(e),o()},0),this.isa.isCameraEnhancer&&this.isa.getCameraView().setScanLaserVisible(!0)}},Ue.postMessage({type:"cvr_startCapturing",id:g,instanceID:this._instanceID,body:{templateName:e}})}),await this._promiseStartScan))}stopCapturing(){this._checkIsDisposed(),this.isa&&(this.isa.isCameraEnhancer&&(this.isa.getCameraView().setScanLaserVisible(!1),this.isa.singleFrameMode!==void 0&&this.isa.singleFrameMode!=="disabled")?this.isa.off("singleFrameAcquired",this._singleFrameModeCallbackBind):(this.isa.stopFetching(),this._clearVerifyList(),this._averageProcessintTimeArray=[],this._averageTime=999,this._bPauseScan=!0,this._promiseStartScan=null,this.isa.setColourChannelUsageType(ei.CCUT_AUTO)))}async _clearVerifyList(){let e=qe();const n=new gn;return Ye[e]=async o=>{if(o.success)return n.resolve();{let h=new Error(o.message);return h.stack=o.stack+`
`+h.stack,n.reject(h)}},Ue.postMessage({type:"cvr_clearVerifyList",id:e,instanceID:this._instanceID}),n}async _getIntermediateResult(){this._checkIsDisposed();let e=qe();const n=new gn;return Ye[e]=async o=>{if(o.success)n.resolve(o.result);else{let h=new Error(o.message);h.stack=o.stack+`
`+h.stack,n.reject(h)}},Ue.postMessage({type:"cvr_getIntermediateResult",id:e,instanceID:this._instanceID}),n}async containsTask(e){return this._checkIsDisposed(),await new Promise((n,o)=>{let h=qe();Ye[h]=async g=>{if(g.success)return n(JSON.parse(g.tasks));{let m=new Error(g.message);return m.stack=g.stack+`
`+m.stack,o(m)}},Ue.postMessage({type:"cvr_containsTask",id:h,instanceID:this._instanceID,body:{templateName:e}})})}async _loopReadVideo(e){if(this.disposed||this._bPauseScan)return;if(this.isa.isBufferEmpty()){if(this.isa.hasNextImageToFetch())for(let h of this._isaStateListenerSet)h.onImageSourceStateReceived&&h.onImageSourceStateReceived(js.ISS_BUFFER_EMPTY);else if(!this.isa.hasNextImageToFetch())for(let h of this._isaStateListenerSet)h.onImageSourceStateReceived&&h.onImageSourceStateReceived(js.ISS_EXHAUSTED)}if(this._minImageCaptureInterval===-1||this.isa.isBufferEmpty())try{this.isa.isBufferEmpty()&&Ge._onLog&&Ge._onLog("buffer is empty so fetch image"),Ge._onLog&&Ge._onLog(`DCE: start fetching a frame: ${Date.now()}`),this._dsImage=this.isa.fetchImage(),Ge._onLog&&Ge._onLog(`DCE: finish fetching a frame: ${Date.now()}`),this.isa.setImageFetchInterval(this._averageTime)}catch{return void this._reRunCurrnetFunc(e)}else if(this.isa.setImageFetchInterval(this._averageTime-(this._dsImage&&this._dsImage.tag?this._dsImage.tag.timeSpent:0)),this._dsImage=this.isa.getImage(),this._dsImage.tag&&Date.now()-this._dsImage.tag.timeStamp>200)return void this._reRunCurrnetFunc(e);if(!this._dsImage)return void this._reRunCurrnetFunc(e);for(let h of this._resultReceiverSet)this._bNeedOutputOriginalImage&&h.onOriginalImageResultReceived&&h.onOriginalImageResultReceived({imageData:this._dsImage});const n=Date.now();let o=null;this._captureDsimage(this._dsImage,e,!0).then(async h=>{if(Ge._onLog&&Ge._onLog("no js handle time: "+(Date.now()-n)),o=h,this._bPauseScan)return void this._reRunCurrnetFunc(e);const g=Date.now(),m=o.intermediateResult;if(m){if(m.taskSet)for(let I of m.taskSet.intermediateResultUnits)I.originalImageTag=this._dsImage.tag?this._dsImage.tag:null;for(let I of this._intermediateResultReceiverSet){if(m.taskSet&&I.onTaskResultsReceived&&I.onTaskResultsReceived({intermediateResultUnits:m.taskSet.intermediateResultUnits},m.taskSet.info),m.sectionSet)for(let R in m.sectionSet){for(let L of m.sectionSet[R].asStage)I[R]&&I[R](L.result,L.info);for(let L of m.sectionSet[R].asSection)I[R]&&I[R](L.result,L.info)}if(m.stageSet)for(let R in m.stageSet)for(let L of m.stageSet[R])I[R]&&I[R](L.result,L.info)}}o.originalImageTag=this._dsImage.tag?this._dsImage.tag:null;for(let I of this._resultReceiverSet)if(I.isDce){const R=Date.now();if(I.onCapturedResultReceived(o,{isDetectVerifyOpen:this._bOpenDetectVerify,isNormalizeVerifyOpen:this._bOpenNormalizeVerify,isBarcodeVerifyOpen:this._bOpenBarcodeVerify,isLabelVerifyOpen:this._bOpenLabelVerify}),Ge._onLog){const L=Date.now()-R;L>10&&Ge._onLog(`draw result time: ${L}`)}}for(let I of this._resultFilterSet)I.onDecodedBarcodesReceived(o.items),I.onRecognizedTextLinesReceived(o.items),I.onDetectedQuadsReceived(o.items),I.onNormalizedImagesReceived(o.items);const v=ec(o),C={originalImageHashId:o.originalImageHashId,originalImageTag:o.originalImageTag,errorCode:o.errorCode,errorString:o.errorString};for(let I of this._resultReceiverSet)I.onDecodedBarcodesReceived&&v.barcodeResultItems.length&&I.onDecodedBarcodesReceived(Object.assign(Object.assign({},C),{barcodeResultItems:v.barcodeResultItems.filter(R=>!R.isFilter)})),I.onRecognizedTextLinesReceived&&v.textLineResultItems.length&&I.onRecognizedTextLinesReceived(Object.assign(Object.assign({},C),{textLineResultItems:v.textLineResultItems.filter(R=>!R.isFilter)})),I.onDetectedQuadsReceived&&v.quadsResultItems.length&&I.onDetectedQuadsReceived(Object.assign(Object.assign({},C),{quadsResultItems:v.quadsResultItems.filter(R=>!R.isFilter)})),I.onNormalizedImagesReceived&&v.normalizedImageResultItems.length&&I.onNormalizedImagesReceived(Object.assign(Object.assign({},C),{normalizedImageResultItems:v.normalizedImageResultItems.filter(R=>!R.isFilter)})),I.onParsedResultsReceived&&v.parsedResultItems.length&&I.onParsedResultsReceived(Object.assign(Object.assign({},C),{parsedResultItems:v.parsedResultItems.filter(R=>!R.isFilter)})),I.onCapturedResultReceived&&!I.isDce&&(o.items=o.items.filter(R=>!R.isFilter),I.onCapturedResultReceived(o));if(Ge._onLog){const I=Date.now()-g;I>10&&Ge._onLog(`callback dispatch time: ${I}`)}const E=Date.now();if(this._minImageCaptureInterval>-1&&(this._averageProcessintTimeArray.length===5&&this._averageProcessintTimeArray.shift(),this._averageFetchImageTimeArray.length===5&&this._averageFetchImageTimeArray.shift(),this._averageProcessintTimeArray.push(Date.now()-n),this._averageFetchImageTimeArray.push(this._dsImage&&this._dsImage.tag?this._dsImage.tag.timeSpent:0),this._averageTime=Math.min(...this._averageProcessintTimeArray)-Math.max(...this._averageFetchImageTimeArray),this._averageTime=this._averageTime>0?this._averageTime:0,Ge._onLog&&(Ge._onLog(`minImageCaptureInterval: ${this._minImageCaptureInterval}`),Ge._onLog(`averageProcessintTimeArray: ${this._averageProcessintTimeArray}`),Ge._onLog(`averageFetchImageTimeArray: ${this._averageFetchImageTimeArray}`),Ge._onLog(`averageTime: ${this._averageTime}`))),Ge._onLog){const I=Date.now()-E;I>10&&Ge._onLog(`fetch image calculate time: ${I}`)}Ge._onLog&&Ge._onLog(`time finish decode: ${Date.now()}`),Ge._onLog&&Ge._onLog("main time: "+(Date.now()-n)),Ge._onLog&&Ge._onLog("===================================================="),this._loopReadVideoTimeoutId&&clearTimeout(this._loopReadVideoTimeoutId),this._minImageCaptureInterval>0&&this._minImageCaptureInterval>=this._averageTime?this._loopReadVideoTimeoutId=setTimeout(()=>{this._loopReadVideo(e)},this._minImageCaptureInterval-this._averageTime):this._loopReadVideoTimeoutId=setTimeout(()=>{this._loopReadVideo(e)},Math.max(this._minImageCaptureInterval,0))}).catch(h=>{this.isa.stopFetching(),this._loopReadVideoTimeoutId&&clearTimeout(this._loopReadVideoTimeoutId),this._loopReadVideoTimeoutId=setTimeout(()=>{this.isa.startFetching(),this._loopReadVideo(e)},Math.max(this._minImageCaptureInterval,1e3)),h.message!=="platform error"&&setTimeout(()=>{throw h},0)}).finally(()=>{o&&o.intermediateResult&&delete o.intermediateResult})}_reRunCurrnetFunc(e){this._loopReadVideoTimeoutId&&clearTimeout(this._loopReadVideoTimeoutId),this._loopReadVideoTimeoutId=setTimeout(()=>{this._loopReadVideo(e)},0)}async capture(e,n="Default",o=!1){this._checkIsDisposed();const h=await this.containsTask(n);let g;if(await li(h),(m=e)&&typeof m=="object"&&!Array.isArray(m)&&"bytes"in m&&"width"in m&&"height"in m&&"stride"in m&&"format"in m)g=await this._captureDsimage(e,n,o);else if(typeof e=="string")g=e.substring(0,11)=="data:image/"?await this._captureBase64(e,n,o):await this._captureUrl(e,n,o);else if(e instanceof Blob)g=await this._captureBlob(e,n,o);else if(e instanceof HTMLImageElement)g=await this._captureImage(e,n,o);else if(e instanceof HTMLCanvasElement)g=await this._captureCanvas(e,n,o);else if(e instanceof HTMLVideoElement)g=await this._captureVideo(e,n,o);else{if(!(e instanceof Uint8Array||e instanceof ArrayBuffer||e instanceof Uint8ClampedArray))throw new TypeError("'capture(imageOrFile, templateName)': Type of 'imageOrFile' should be 'DSImageData', 'Url', 'Base64', 'Blob', 'Uint8Array', 'ArrayBuffer', 'Uint8ClampedArray', 'HTMLImageElement', 'HTMLCanvasElement', 'HTMLVideoElement'.");g=await this._captureBlob(new Blob([new Uint8Array(e)],{type:"image/png"}),n,o)}var m;const v=await this._getIntermediateResult();if(v)for(let C of this._intermediateResultReceiverSet){if(v.taskSet&&C.onTaskResultsReceived&&C.onTaskResultsReceived({intermediateResultUnits:v.taskSet.intermediateResultUnits},v.taskSet.info),v.sectionSet)for(let E in v.sectionSet){for(let I of v.sectionSet[E].asStage)C[E]&&C[E](I.result,I.info);for(let I of v.sectionSet[E].asSection)C[E]&&C[E](I.result,I.info)}if(v.stageSet)for(let E in v.stageSet)for(let I of v.stageSet[E])C[E]&&C[E](I.result,I.info)}return g}async _captureDsimage(e,n,o=!1){return await this._captureInWorker(e,n,o)}async _captureUrl(e,n,o=!1){let h=await Ql(e,"blob");return await this._captureBlob(h,n,o)}async _captureBase64(e,n,o=!1){e=e.substring(e.indexOf(",")+1);let h=atob(e),g=h.length,m=new Uint8Array(g);for(;g--;)m[g]=h.charCodeAt(g);return await this._captureBlob(new Blob([m]),n,o)}async _captureBlob(e,n,o=!1){let h=null,g=null;if(typeof createImageBitmap<"u")try{h=await createImageBitmap(e)}catch{}h||(g=await async function(v){return await new Promise((C,E)=>{let I=URL.createObjectURL(v),R=new Image;R.src=I,R.onload=()=>{URL.revokeObjectURL(R.dbrObjUrl),C(R)},R.onerror=L=>{E(new Error("Can't convert blob to image : "+(L instanceof Event?L.type:L)))}})}(e));let m=await this._captureImage(h||g,n,o);return h&&h.close(),m}async _captureImage(e,n,o=!1){let h,g,m=e instanceof HTMLImageElement?e.naturalWidth:e.width,v=e instanceof HTMLImageElement?e.naturalHeight:e.height,C=Math.max(m,v);if(C>this.maxCvsSideLength){let I=this.maxCvsSideLength/C;h=Math.round(m*I),g=Math.round(v*I)}else h=m,g=v;this._canvas||(this._canvas=document.createElement("canvas"));const E=this._canvas;return E.width===h&&E.height===g||(E.width=h,E.height=g),E.ctx2d||(E.ctx2d=E.getContext("2d",{willReadFrequently:!0})),E.ctx2d.drawImage(e,0,0,m,v,0,0,h,g),e.dbrObjUrl&&URL.revokeObjectURL(e.dbrObjUrl),await this._captureCanvas(E,n,o)}async _captureCanvas(e,n,o=!1){if(e.crossOrigin&&e.crossOrigin!="anonymous")throw"cors";if([e.width,e.height].includes(0))throw Error("The width or height of the 'canvas' is 0.");const h=e.ctx2d||e.getContext("2d",{willReadFrequently:!0}),g={bytes:Uint8Array.from(h.getImageData(0,0,e.width,e.height).data),width:e.width,height:e.height,stride:4*e.width,format:10};return await this._captureInWorker(g,n,o)}async _captureVideo(e,n,o=!1){if(e.crossOrigin&&e.crossOrigin!="anonymous")throw"cors";let h,g,m=e.videoWidth,v=e.videoHeight,C=Math.max(m,v);if(C>this._maxCvsSideLength){let I=this._maxCvsSideLength/C;h=Math.round(m*I),g=Math.round(v*I)}else h=m,g=v;this._canvas||(this._canvas=document.createElement("canvas"));const E=this._canvas;return E.width===h&&E.height===g||(E.width=h,E.height=g),E.ctx2d||(E.ctx2d=E.getContext("2d",{willReadFrequently:!0})),E.ctx2d.drawImage(e,0,0,m,v,0,0,h,g),await this._captureCanvas(E,n,o)}async _captureInWorker(e,n,o=!1){const{bytes:h,width:g,height:m,stride:v,format:C}=e;let E=qe();const I=new gn;return Ye[E]=async R=>{var L;if(!R.success){let N=new Error(R.message);return N.stack=R.stack+`
`+N.stack,I.reject(N)}{const N=Date.now();Ge._onLog&&(Ge._onLog(`get result time from worker: ${N}`),Ge._onLog("worker to main time consume: "+(N-R.workerReturnMsgTime)));try{const Y=R.captureResult;e.bytes=R.bytes;for(let X=0;X<Y.items.length;X++)if(Y.items[X].type===Se.CRIT_NORMALIZED_IMAGE){const K=bd(Y.items[X].imageData);Sd(Y.items[X],K)}else Y.items[X].type===Se.CRIT_ORIGINAL_IMAGE?Y.items[X].imageData=e:Y.items[X].type===Se.CRIT_PARSED_RESULT&&((L=bt.dcp)===null||L===void 0||L.handleParsedResultItem(Y.items[X]));return I.resolve(Y)}catch(Y){return I.reject(Y)}}},Ge._onLog&&Ge._onLog(`send buffer to worker: ${Date.now()}`),Ue.postMessage({type:"cvr_capture",id:E,instanceID:this._instanceID,body:{bytes:h,width:g,height:m,stride:v,format:C,templateName:n||"",bScanner:o}},[h.buffer]),I}async initSettings(e){return this._checkIsDisposed(),e&&["string","object"].includes(typeof e)?(typeof e=="string"&&(/^(https:\/\/www\.|http:\/\/www\.|https:\/\/|http:\/\/)|^[a-zA-Z0-9]{2,}(\.[a-zA-Z0-9]{2,})(\.[a-zA-Z0-9]{2,})?/.test(e)&&(e=await Ql(e,"text")),this._currentSettings=JSON.parse(e)),typeof e=="object"&&(this._currentSettings=e,e=JSON.stringify(e)),await new Promise((n,o)=>{let h=qe();Ye[h]=async g=>{if(g.success){const m=JSON.parse(g.response);if(m.exception!==0){let E=new Error(m.description?m.description:"Init Settings Failed.");return E.errorCode=m.exception,o(E)}let v=[],C=JSON.parse(e).CaptureVisionTemplates;for(let E=0;E<C.length;E++){let I=await this.containsTask(C[E].Name);v=v.concat(I)}return await li([...new Set(v)]),this._bNeedOutputOriginalImage=this._currentSettings.CaptureVisionTemplates[0].OutputOriginalImage===1,n(m)}{let m=new Error(g.message);return m.stack=g.stack+`
`+m.stack,o(m)}},Ue.postMessage({type:"cvr_initSettings",id:h,instanceID:this._instanceID,body:{settings:e}})})):console.error("Invalid template.")}async outputSettings(e){return this._checkIsDisposed(),await new Promise((n,o)=>{let h=qe();Ye[h]=async g=>{if(g.success){const m=JSON.parse(g.settings);if(m.errorCode!==0){let v=new Error(m.errorString);return v.errorCode=m.errorCode,o(v)}return delete m.errorCode,delete m.errorString,n(m)}{let m=new Error(g.message);return m.stack=g.stack+`
`+m.stack,o(m)}},Ue.postMessage({type:"cvr_outputSettings",id:h,instanceID:this._instanceID,body:{templateName:e||"Default"}})})}async outputSettingsToFile(e,n,o){const h=await this.outputSettings(e),g=new Blob([JSON.stringify(h,null,2,function(m,v){return v instanceof Array?JSON.stringify(v):v},2)],{type:"application/json"});if(o){const m=document.createElement("a");m.href=URL.createObjectURL(g),n.endsWith(".json")&&(n=n.replace(".json","")),m.download=`${n}.json`,m.onclick=()=>{setTimeout(()=>{URL.revokeObjectURL(m.href)},500)},m.click()}return g}async getSimplifiedSettings(e="Default"){this._checkIsDisposed();const n=await this.containsTask(e);return await li(n),await new Promise((o,h)=>{let g=qe();Ye[g]=async m=>{if(m.success){const v=JSON.parse(m.settings,(C,E)=>Id&&C==="barcodeFormatIds"?BigInt(E):E);if(v.minImageCaptureInterval=this._minImageCaptureInterval,v.code!==0){let C=new Error(v.codeString);return C.errorCode=v.errorCode,h(C)}return delete v.code,delete v.codeString,o(v)}{let v=new Error(m.message);return v.stack=m.stack+`
`+v.stack,h(v)}},Ue.postMessage({type:"cvr_getSimplifiedSettings",id:g,instanceID:this._instanceID,body:{templateName:e}})})}async updateSettings(e,n){this._checkIsDisposed();const o=await this.containsTask(e);return await li(o),await new Promise((h,g)=>{let m=qe();Ye[m]=async v=>{if(v.success){const C=JSON.parse(v.response);if(n.minImageCaptureInterval&&n.minImageCaptureInterval>=-1&&(this._minImageCaptureInterval=n.minImageCaptureInterval),this._bNeedOutputOriginalImage=v.bNeedOutputOriginalImage,C.exception!==0){let E=new Error(C.description?C.description:"Update Settings Failed.");return E.errorCode=C.exception,g(E)}return this._currentSettings=await this.outputSettings("*"),h(C)}{let C=new Error(v.message);return C.stack=v.stack+`
`+C.stack,g(C)}},Ue.postMessage({type:"cvr_updateSettings",id:m,instanceID:this._instanceID,body:{settings:n,templateName:e}})})}async resetSettings(){return this._checkIsDisposed(),await new Promise((e,n)=>{let o=qe();Ye[o]=async h=>{if(h.success){const g=JSON.parse(h.response);if(g.exception!==0){let m=new Error(g.description?g.description:"Reset Settings Failed.");return m.errorCode=g.exception,n(m)}return this._currentSettings=await this.outputSettings("*"),e(g)}{let g=new Error(h.message);return g.stack=h.stack+`
`+g.stack,n(g)}},Ue.postMessage({type:"cvr_resetSettings",id:o,instanceID:this._instanceID})})}getIntermediateResultManager(e){if(this._checkIsDisposed(),!e&&ot.bSupportIRTModule!==0)throw new Error("The current license does not support the use of intermediate results.");return this._intermediateResultManager||(this._intermediateResultManager=new Ed,this._intermediateResultManager.addResultReceiver=async n=>{if(typeof n!="object")throw new Error("Invalid receiver.");return this._intermediateResultReceiverSet.add(n),this._handleIntermediateResultReceiver(),await(async()=>await new Promise((o,h)=>{let g=qe();Ye[g]=async m=>{if(m.success)return o();{let v=new Error(m.message);return v.stack=m.stack+`
`+v.stack,h(v)}},Ue.postMessage({type:"cvr_setIrrRegistry",id:g,instanceID:this._instanceID,body:{receiverObj:this._irrRegistryState}})}))()},this._intermediateResultManager.removeResultReceiver=async n=>(this._intermediateResultReceiverSet.delete(n),this._handleIntermediateResultReceiver(),await new Promise((o,h)=>{let g=qe();Ye[g]=async m=>{if(m.success)return o();{let v=new Error(m.message);return v.stack=m.stack+`
`+v.stack,h(v)}},Ue.postMessage({type:"cvr_setIrrRegistry",id:g,instanceID:this._instanceID,body:{receiverObj:this._irrRegistryState}})})),this._intermediateResultManager.getOriginalImage=async n=>this._dsImage),this._intermediateResultManager}_handleIntermediateResultReceiver(){for(let e in this._irrRegistryState)this._irrRegistryState[e]=!1;for(let e of this._intermediateResultReceiverSet)if(e.isDce)this._irrRegistryState.onTaskResultsReceivedForDce=!0;else for(let n in e)this._irrRegistryState[n]||(this._irrRegistryState[n]=!!e[n])}async _enableResultCrossVerification(e){return this._checkIsDisposed(),await new Promise((n,o)=>{let h=qe();Ye[h]=async g=>{if(g.success)return n(g.result);{let m=new Error(g.message);return m.stack=g.stack+`
`+m.stack,o(m)}},Ue.postMessage({type:"cvr_enableResultCrossVerification",id:h,instanceID:this._instanceID,body:{verificationEnabled:e}})})}async _enableResultDeduplication(e){return this._checkIsDisposed(),await new Promise((n,o)=>{let h=qe();Ye[h]=async g=>{if(g.success)return n(g.result);{let m=new Error(g.message);return m.stack=g.stack+`
`+m.stack,o(m)}},Ue.postMessage({type:"cvr_enableResultDeduplication",id:h,instanceID:this._instanceID,body:{duplicateFilterEnabled:e}})})}async _setDuplicateForgetTime(e){return this._checkIsDisposed(),await new Promise((n,o)=>{let h=qe();Ye[h]=async g=>{if(g.success)return n(g.result);{let m=new Error(g.message);return m.stack=g.stack+`
`+m.stack,o(m)}},Ue.postMessage({type:"cvr_setDuplicateForgetTime",id:h,instanceID:this._instanceID,body:{duplicateForgetTime:e}})})}async _getDuplicateForgetTime(e){return this._checkIsDisposed(),await new Promise((n,o)=>{let h=qe();Ye[h]=async g=>{if(g.success)return n(g.time);{let m=new Error(g.message);return m.stack=g.stack+`
`+m.stack,o(m)}},Ue.postMessage({type:"cvr_getDuplicateForgetTime",id:h,instanceID:this._instanceID,body:{type:e}})})}async parseRequiredResources(e){return this._checkIsDisposed(),await new Promise((n,o)=>{let h=qe();Ye[h]=async g=>{if(g.success)return n(JSON.parse(g.resources));{let m=new Error(g.message);return m.stack=g.stack+`
`+m.stack,o(m)}},Ue.postMessage({type:"cvr_parseRequiredResources",id:h,instanceID:this._instanceID,body:{templateName:e}})})}async _setThresholdValue(e,n,o){return await new Promise((h,g)=>{let m=qe();Ye[m]=async v=>{if(v.success)return h();{let C=new Error(v.message);return C.stack=v.stack+`
`+C.stack,g(C)}},Ue.postMessage({type:"cvr_setThresholdValue",id:m,instanceID:this._instanceID,body:{threshold:e,leftLimit:n,rightLimit:o}})})}contains(e,n){return function(o,h){let g=h.x,m=h.y,v=o[0].x,C=o[0].y,E=o[1].x,I=o[1].y,R=o[2].x,L=o[2].y,N=o[3].x,Y=o[3].y,X=ne(g,m,v,C,E,I),K=ne(g,m,E,I,R,L),J=ne(g,m,R,L,N,Y),te=ne(g,m,N,Y,v,C);function ne(pe,he,le,be,y,_e){return(pe-le)*(_e-be)-(he-be)*(y-le)}return X>=0&&K>=0&&J>=0&&te>=0||X<=0&&K<=0&&J<=0&&te<=0}(e,n)}async dispose(){this._checkIsDisposed(),this._promiseStartScan&&this.stopCapturing(),this.isa=null,this._resultReceiverSet.clear(),this._isaStateListenerSet.clear(),this._resultFilterSet.clear(),this.bDestroyed=!0;let e=qe();Ye[e]=n=>{if(!n.success){let o=new Error(n.message);throw o.stack=n.stack+`
`+o.stack,o}},Ue.postMessage({type:"cvr_dispose",id:e,instanceID:this._instanceID})}}class xd{constructor(){this.onCapturedResultReceived=null,this.onOriginalImageResultReceived=null}}/*!
 * Dynamsoft JavaScript Library
 * @product Dynamsoft Utility JS Edition
 * @website https://www.dynamsoft.com
 * @copyright Copyright 2024, Dynamsoft Corporation
 * @author Dynamsoft
 * @version 1.0.21
 * @fileoverview Dynamsoft JavaScript Library for Core
 * More info DU JS: https://www.dynamsoft.com/capture-vision/docs/web/programming/javascript/api-reference/utility/utility-module.html
 */class Ad{constructor(){this.verificationEnabled={[Se.CRIT_BARCODE]:!1,[Se.CRIT_TEXT_LINE]:!0,[Se.CRIT_DETECTED_QUAD]:!0,[Se.CRIT_NORMALIZED_IMAGE]:!1},this.duplicateFilterEnabled={[Se.CRIT_BARCODE]:!1,[Se.CRIT_TEXT_LINE]:!1,[Se.CRIT_DETECTED_QUAD]:!1,[Se.CRIT_NORMALIZED_IMAGE]:!1},this.duplicateForgetTime={[Se.CRIT_BARCODE]:3e3,[Se.CRIT_TEXT_LINE]:3e3,[Se.CRIT_DETECTED_QUAD]:3e3,[Se.CRIT_NORMALIZED_IMAGE]:3e3},this._allowType=[2,4,8,16]}enableResultCrossVerification(e,n){this._allowType.includes(e)&&(this.verificationEnabled[e]=n)}isResultCrossVerificationEnabled(e){return this.verificationEnabled[e]}enableResultDeduplication(e,n){this._allowType.includes(e)&&(this.duplicateFilterEnabled[e]=n)}isResultDeduplicationEnabled(e){return this.duplicateFilterEnabled[e]}setDuplicateForgetTime(e,n){n>18e4&&(n=18e4),n<0&&(n=0),this.duplicateForgetTime[e]=n}getDuplicateForgetTime(e){return this.duplicateForgetTime[e]}getFilteredResultItemTypes(){let e=0;const n=[Se.CRIT_BARCODE,Se.CRIT_TEXT_LINE,Se.CRIT_DETECTED_QUAD];for(let o=0;o<n.length;o++)(this.verificationEnabled[n[o]]||this.duplicateFilterEnabled[n[o]])&&(e|=n[o]);return e}onDecodedBarcodesReceived(e){if(this.isResultCrossVerificationEnabled(Se.CRIT_BARCODE))for(let n=0;n<e.length;n++)e[n]&&e[n].type===Se.CRIT_BARCODE&&!e[n].verified&&(e[n].isFilter=!0);if(this.isResultDeduplicationEnabled(Se.CRIT_BARCODE))for(let n=0;n<e.length;n++)e[n]&&e[n].type===Se.CRIT_BARCODE&&e[n].duplicate&&(e[n].isFilter=!0)}onRecognizedTextLinesReceived(e){if(this.isResultCrossVerificationEnabled(Se.CRIT_TEXT_LINE))for(let n=0;n<e.length;n++)e[n]&&e[n].type===Se.CRIT_TEXT_LINE&&!e[n].verified&&(e[n].isFilter=!0);if(this.isResultDeduplicationEnabled(Se.CRIT_TEXT_LINE))for(let n=0;n<e.length;n++)e[n]&&e[n].type===Se.CRIT_TEXT_LINE&&e[n].duplicate&&(e[n].isFilter=!0)}onDetectedQuadsReceived(e){if(this.isResultCrossVerificationEnabled(Se.CRIT_DETECTED_QUAD))for(let n=0;n<e.length;n++)e[n]&&e[n].type===Se.CRIT_DETECTED_QUAD&&!e[n].verified&&(e[n].isFilter=!0);if(this.isResultDeduplicationEnabled(Se.CRIT_DETECTED_QUAD))for(let n=0;n<e.length;n++)e[n]&&e[n].type===Se.CRIT_DETECTED_QUAD&&e[n].duplicate&&(e[n].isFilter=!0)}onNormalizedImagesReceived(e){if(this.isResultCrossVerificationEnabled(Se.CRIT_NORMALIZED_IMAGE))for(let n=0;n<e.length;n++)e[n]&&e[n].type===Se.CRIT_NORMALIZED_IMAGE&&!e[n].verified&&(e[n].isFilter=!0);if(this.isResultDeduplicationEnabled(Se.CRIT_NORMALIZED_IMAGE))for(let n=0;n<e.length;n++)e[n]&&e[n].type===Se.CRIT_NORMALIZED_IMAGE&&e[n].duplicate&&(e[n].isFilter=!0)}}const Od=t=>(Ac("data-v-4799025e"),t=t(),Oc(),t),Rd=Od(()=>Yt("br",null,null,-1)),Dd=$s({__name:"VideoCapture",setup(t){const e=Mn(null),n=Mn(null),o=Mn(null),h=async()=>{try{const g=await it.createInstance(),m=await Re.createInstance(g);n.value.append(g.getUIElement());const v=await Ge.createInstance();v.setInput(m);const C=new xd;C.onDecodedBarcodesReceived=I=>{if(I.barcodeResultItems.length){o.value.textContent="",console.log(I);for(let R of I.barcodeResultItems)o.value.append(`${R.formatString}: ${R.text}`,document.createElement("br"),document.createElement("hr"))}},v.addResultReceiver(C);const E=new Ad;return E.enableResultCrossVerification(Se.CRIT_BARCODE,!0),E.enableResultDeduplication(Se.CRIT_BARCODE,!0),E.setDuplicateForgetTime(Se.CRIT_BARCODE,3e3),await v.addResultFilter(E),await m.open(),await v.startCapturing("ReadSingleBarcode"),{cameraView:g,cameraEnhancer:m,router:v}}catch(g){let m=g.message||g;throw console.error(m),alert(m),g}};return Ta(async()=>{e.value=h()}),ba(async()=>{if(e.value){const{cameraView:g,cameraEnhancer:m,router:v}=await e.value;v.dispose(),m.dispose(),g.dispose()}console.log("VideoCapture Component Unmount")}),(g,m)=>(tn(),xa("div",null,[Yt("div",{ref_key:"uiContainer",ref:n,class:"div-ui-container"},null,512),Xc(" Results: "),Rd,Yt("div",{ref_key:"resultsContainer",ref:o,class:"div-results-container"},null,512)]))}});const Ba=(t,e)=>{const n=t.__vccOpts||t;for(const[o,h]of e)n[o]=h;return n},Ld=Ba(Dd,[["__scopeId","data-v-4799025e"]]),Fd={class:"div-image-capture"},Md=$s({__name:"ImageCapture",setup(t){const e=Mn(null),n=async o=>{try{const g=await(await e.value).capture(o.target.files[0],"ReadBarcodes_SpeedFirst");let m="";for(let v of g.items)console.log(v.text),m+=v.text+`
`;m!==""&&alert(m),g.items.length||alert("No barcode found")}catch(h){let g=h.message||h;console.error(g),alert(g)}o.target.value=""};return Ta(async()=>{e.value=Ge.createInstance()}),ba(async()=>{e.value&&(await e.value).dispose(),console.log("ImageCapture Component Unmount")}),(o,h)=>(tn(),xa("div",Fd,[Yt("input",{type:"file",accept:".jpg,.jpeg,.icon,.gif,.svg,.webp,.png,.bmp",onChange:n},null,32)]))}});const Pd=Ba(Md,[["__scopeId","data-v-d0323d9a"]]),kd=t=>(Ac("data-v-ea3c68b8"),t=t(),Oc(),t),Bd={class:"div-hello-world"},Nd=kd(()=>Yt("h1",null,"Hello World for Vue 3",-1)),jd={class:"container"},Ud=$s({__name:"HelloWorld",setup(t){const e=Mn(!0),n=Mn(!1),o=()=>{e.value=!0,n.value=!1},h=()=>{e.value=!1,n.value=!0};return(g,m)=>(tn(),xa("div",Bd,[Nd,Yt("div",null,[Yt("button",{style:Sr({marginRight:"10px",backgroundColor:e.value?"rgb(255,174,55)":"white"}),onClick:o},"Decode Video",4),Yt("button",{style:Sr({backgroundColor:n.value?"rgb(255,174,55)":"white"}),onClick:h},"Decode Image",4)]),Yt("div",jd,[e.value?(tn(),Is(Ld,{key:0})):rl("",!0),n.value?(tn(),Is(Pd,{key:1})):rl("",!0)])]))}});const Gd=Ba(Ud,[["__scopeId","data-v-ea3c68b8"]]),Vd=$s({__name:"App",setup(t){return(e,n)=>(tn(),Is(Gd))}});Wf(Vd).mount("#app");
